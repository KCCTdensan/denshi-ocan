(()=>{var c4=Object.create;var QT=Object.defineProperty;var h4=Object.getOwnPropertyDescriptor;var d4=Object.getOwnPropertyNames;var p4=Object.getPrototypeOf,f4=Object.prototype.hasOwnProperty;var sv=(ji=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(ji,{get:(cs,pr)=>(typeof require!="undefined"?require:cs)[pr]}):ji)(function(ji){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+ji+'" is not supported')});var fE=(ji,cs)=>()=>(cs||ji((cs={exports:{}}).exports,cs),cs.exports);var m4=(ji,cs,pr,V)=>{if(cs&&typeof cs=="object"||typeof cs=="function")for(let re of d4(cs))!f4.call(ji,re)&&re!==pr&&QT(ji,re,{get:()=>cs[re],enumerable:!(V=h4(cs,re))||V.enumerable});return ji};var mE=(ji,cs,pr)=>(pr=ji!=null?c4(p4(ji)):{},m4(cs||!ji||!ji.__esModule?QT(pr,"default",{value:ji,enumerable:!0}):pr,ji));var ZT=fE(()=>{(()=>{var ji={1113:function(V){V.exports=function(re){var ae={};function E(z){if(ae[z])return ae[z].exports;var P=ae[z]={i:z,l:!1,exports:{}};return re[z].call(P.exports,P,P.exports,E),P.l=!0,P.exports}return E.m=re,E.c=ae,E.d=function(z,P,L){E.o(z,P)||Object.defineProperty(z,P,{enumerable:!0,get:L})},E.r=function(z){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(z,"__esModule",{value:!0})},E.t=function(z,P){if(1&P&&(z=E(z)),8&P||4&P&&typeof z=="object"&&z&&z.__esModule)return z;var L=Object.create(null);if(E.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:z}),2&P&&typeof z!="string")for(var k in z)E.d(L,k,function(C){return z[C]}.bind(null,k));return L},E.n=function(z){var P=z&&z.__esModule?function(){return z.default}:function(){return z};return E.d(P,"a",P),P},E.o=function(z,P){return Object.prototype.hasOwnProperty.call(z,P)},E.p="",E(E.s=0)}([function(re,ae,E){"use strict";E.r(ae),E.d(ae,"encode",function(){return Ae}),E.d(ae,"decode",function(){return _i}),E.d(ae,"decodeAsync",function(){return Ci}),E.d(ae,"decodeArrayStream",function(){return ss}),E.d(ae,"decodeStream",function(){return tn}),E.d(ae,"Decoder",function(){return Mn}),E.d(ae,"Encoder",function(){return he}),E.d(ae,"ExtensionCodec",function(){return be}),E.d(ae,"ExtData",function(){return _}),E.d(ae,"EXT_TIMESTAMP",function(){return $}),E.d(ae,"encodeDateToTimeSpec",function(){return q}),E.d(ae,"encodeTimeSpecToTimestamp",function(){return j}),E.d(ae,"decodeTimestampToTimeSpec",function(){return ue}),E.d(ae,"encodeTimestampExtension",function(){return Q}),E.d(ae,"decodeTimestampExtension",function(){return xe});var z=function(ye,J){var Me=typeof Symbol=="function"&&ye[Symbol.iterator];if(!Me)return ye;var Ee,ke,ee=Me.call(ye),ie=[];try{for(;(J===void 0||J-- >0)&&!(Ee=ee.next()).done;)ie.push(Ee.value)}catch(X){ke={error:X}}finally{try{Ee&&!Ee.done&&(Me=ee.return)&&Me.call(ee)}finally{if(ke)throw ke.error}}return ie},P=function(){for(var ye=[],J=0;J<arguments.length;J++)ye=ye.concat(z(arguments[J]));return ye},L=typeof process<"u"&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function k(ye){for(var J=ye.length,Me=0,Ee=0;Ee<J;){var ke=ye.charCodeAt(Ee++);if((4294967168&ke)!=0)if((4294965248&ke)==0)Me+=2;else{if(ke>=55296&&ke<=56319&&Ee<J){var ee=ye.charCodeAt(Ee);(64512&ee)==56320&&(++Ee,ke=((1023&ke)<<10)+(1023&ee)+65536)}Me+=(4294901760&ke)==0?3:4}else Me++}return Me}var C=L?new TextEncoder:void 0,M=typeof process<"u"?200:0,I=C?.encodeInto?function(ye,J,Me){C.encodeInto(ye,J.subarray(Me))}:function(ye,J,Me){J.set(C.encode(ye),Me)};function b(ye,J,Me){for(var Ee=J,ke=Ee+Me,ee=[],ie="";Ee<ke;){var X=ye[Ee++];if((128&X)==0)ee.push(X);else if((224&X)==192){var te=63&ye[Ee++];ee.push((31&X)<<6|te)}else if((240&X)==224){te=63&ye[Ee++];var me=63&ye[Ee++];ee.push((31&X)<<12|te<<6|me)}else if((248&X)==240){var Le=(7&X)<<18|(te=63&ye[Ee++])<<12|(me=63&ye[Ee++])<<6|63&ye[Ee++];Le>65535&&(Le-=65536,ee.push(Le>>>10&1023|55296),Le=56320|1023&Le),ee.push(Le)}else ee.push(X);ee.length>=4096&&(ie+=String.fromCharCode.apply(String,P(ee)),ee.length=0)}return ee.length>0&&(ie+=String.fromCharCode.apply(String,P(ee))),ie}var T=L?new TextDecoder:null,A=typeof process<"u"?200:0,_=function(ye,J){this.type=ye,this.data=J};function D(ye,J,Me){var Ee=Math.floor(Me/4294967296),ke=Me;ye.setUint32(J,Ee),ye.setUint32(J+4,ke)}function B(ye,J){return 4294967296*ye.getInt32(J)+ye.getUint32(J+4)}var $=-1;function j(ye){var J,Me=ye.sec,Ee=ye.nsec;if(Me>=0&&Ee>=0&&Me<=17179869183){if(Ee===0&&Me<=4294967295){var ke=new Uint8Array(4);return(J=new DataView(ke.buffer)).setUint32(0,Me),ke}var ee=Me/4294967296,ie=4294967295&Me;return ke=new Uint8Array(8),(J=new DataView(ke.buffer)).setUint32(0,Ee<<2|3&ee),J.setUint32(4,ie),ke}return ke=new Uint8Array(12),(J=new DataView(ke.buffer)).setUint32(0,Ee),D(J,4,Me),ke}function q(ye){var J=ye.getTime(),Me=Math.floor(J/1e3),Ee=1e6*(J-1e3*Me),ke=Math.floor(Ee/1e9);return{sec:Me+ke,nsec:Ee-1e9*ke}}function Q(ye){return ye instanceof Date?j(q(ye)):null}function ue(ye){var J=new DataView(ye.buffer,ye.byteOffset,ye.byteLength);switch(ye.byteLength){case 4:return{sec:J.getUint32(0),nsec:0};case 8:var Me=J.getUint32(0);return{sec:4294967296*(3&Me)+J.getUint32(4),nsec:Me>>>2};case 12:return{sec:B(J,4),nsec:J.getUint32(0)};default:throw new Error("Unrecognized data size for timestamp: "+ye.length)}}function xe(ye){var J=ue(ye);return new Date(1e3*J.sec+J.nsec/1e6)}var Se={type:$,encode:Q,decode:xe},be=function(){function ye(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Se)}return ye.prototype.register=function(J){var Me=J.type,Ee=J.encode,ke=J.decode;if(Me>=0)this.encoders[Me]=Ee,this.decoders[Me]=ke;else{var ee=1+Me;this.builtInEncoders[ee]=Ee,this.builtInDecoders[ee]=ke}},ye.prototype.tryToEncode=function(J,Me){for(var Ee=0;Ee<this.builtInEncoders.length;Ee++)if((ke=this.builtInEncoders[Ee])!=null&&(ee=ke(J,Me))!=null)return new _(-1-Ee,ee);for(Ee=0;Ee<this.encoders.length;Ee++){var ke,ee;if((ke=this.encoders[Ee])!=null&&(ee=ke(J,Me))!=null)return new _(Ee,ee)}return J instanceof _?J:null},ye.prototype.decode=function(J,Me,Ee){var ke=Me<0?this.builtInDecoders[-1-Me]:this.decoders[Me];return ke?ke(J,Me,Ee):new _(Me,J)},ye.defaultCodec=new ye,ye}();function pe(ye){return ye instanceof Uint8Array?ye:ArrayBuffer.isView(ye)?new Uint8Array(ye.buffer,ye.byteOffset,ye.byteLength):ye instanceof ArrayBuffer?new Uint8Array(ye):Uint8Array.from(ye)}var we=function(ye){var J=typeof Symbol=="function"&&Symbol.iterator,Me=J&&ye[J],Ee=0;if(Me)return Me.call(ye);if(ye&&typeof ye.length=="number")return{next:function(){return ye&&Ee>=ye.length&&(ye=void 0),{value:ye&&ye[Ee++],done:!ye}}};throw new TypeError(J?"Object is not iterable.":"Symbol.iterator is not defined.")},he=function(){function ye(J,Me,Ee,ke,ee,ie,X){J===void 0&&(J=be.defaultCodec),Ee===void 0&&(Ee=100),ke===void 0&&(ke=2048),ee===void 0&&(ee=!1),ie===void 0&&(ie=!1),X===void 0&&(X=!1),this.extensionCodec=J,this.context=Me,this.maxDepth=Ee,this.initialBufferSize=ke,this.sortKeys=ee,this.forceFloat32=ie,this.ignoreUndefined=X,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return ye.prototype.encode=function(J,Me){if(Me>this.maxDepth)throw new Error("Too deep objects in depth "+Me);J==null?this.encodeNil():typeof J=="boolean"?this.encodeBoolean(J):typeof J=="number"?this.encodeNumber(J):typeof J=="string"?this.encodeString(J):this.encodeObject(J,Me)},ye.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},ye.prototype.ensureBufferSizeToWrite=function(J){var Me=this.pos+J;this.view.byteLength<Me&&this.resizeBuffer(2*Me)},ye.prototype.resizeBuffer=function(J){var Me=new ArrayBuffer(J),Ee=new Uint8Array(Me),ke=new DataView(Me);Ee.set(this.bytes),this.view=ke,this.bytes=Ee},ye.prototype.encodeNil=function(){this.writeU8(192)},ye.prototype.encodeBoolean=function(J){J===!1?this.writeU8(194):this.writeU8(195)},ye.prototype.encodeNumber=function(J){Number.isSafeInteger(J)?J>=0?J<128?this.writeU8(J):J<256?(this.writeU8(204),this.writeU8(J)):J<65536?(this.writeU8(205),this.writeU16(J)):J<4294967296?(this.writeU8(206),this.writeU32(J)):(this.writeU8(207),this.writeU64(J)):J>=-32?this.writeU8(224|J+32):J>=-128?(this.writeU8(208),this.writeI8(J)):J>=-32768?(this.writeU8(209),this.writeI16(J)):J>=-2147483648?(this.writeU8(210),this.writeI32(J)):(this.writeU8(211),this.writeI64(J)):this.forceFloat32?(this.writeU8(202),this.writeF32(J)):(this.writeU8(203),this.writeF64(J))},ye.prototype.writeStringHeader=function(J){if(J<32)this.writeU8(160+J);else if(J<256)this.writeU8(217),this.writeU8(J);else if(J<65536)this.writeU8(218),this.writeU16(J);else{if(!(J<4294967296))throw new Error("Too long string: "+J+" bytes in UTF-8");this.writeU8(219),this.writeU32(J)}},ye.prototype.encodeString=function(J){var Me=J.length;if(L&&Me>M){var Ee=k(J);this.ensureBufferSizeToWrite(5+Ee),this.writeStringHeader(Ee),I(J,this.bytes,this.pos),this.pos+=Ee}else Ee=k(J),this.ensureBufferSizeToWrite(5+Ee),this.writeStringHeader(Ee),function(ke,ee,ie){for(var X=ke.length,te=ie,me=0;me<X;){var Le=ke.charCodeAt(me++);if((4294967168&Le)!=0){if((4294965248&Le)==0)ee[te++]=Le>>6&31|192;else{if(Le>=55296&&Le<=56319&&me<X){var Ye=ke.charCodeAt(me);(64512&Ye)==56320&&(++me,Le=((1023&Le)<<10)+(1023&Ye)+65536)}(4294901760&Le)==0?(ee[te++]=Le>>12&15|224,ee[te++]=Le>>6&63|128):(ee[te++]=Le>>18&7|240,ee[te++]=Le>>12&63|128,ee[te++]=Le>>6&63|128)}ee[te++]=63&Le|128}else ee[te++]=Le}}(J,this.bytes,this.pos),this.pos+=Ee},ye.prototype.encodeObject=function(J,Me){var Ee=this.extensionCodec.tryToEncode(J,this.context);if(Ee!=null)this.encodeExtension(Ee);else if(Array.isArray(J))this.encodeArray(J,Me);else if(ArrayBuffer.isView(J))this.encodeBinary(J);else{if(typeof J!="object")throw new Error("Unrecognized object: "+Object.prototype.toString.apply(J));this.encodeMap(J,Me)}},ye.prototype.encodeBinary=function(J){var Me=J.byteLength;if(Me<256)this.writeU8(196),this.writeU8(Me);else if(Me<65536)this.writeU8(197),this.writeU16(Me);else{if(!(Me<4294967296))throw new Error("Too large binary: "+Me);this.writeU8(198),this.writeU32(Me)}var Ee=pe(J);this.writeU8a(Ee)},ye.prototype.encodeArray=function(J,Me){var Ee,ke,ee=J.length;if(ee<16)this.writeU8(144+ee);else if(ee<65536)this.writeU8(220),this.writeU16(ee);else{if(!(ee<4294967296))throw new Error("Too large array: "+ee);this.writeU8(221),this.writeU32(ee)}try{for(var ie=we(J),X=ie.next();!X.done;X=ie.next()){var te=X.value;this.encode(te,Me+1)}}catch(me){Ee={error:me}}finally{try{X&&!X.done&&(ke=ie.return)&&ke.call(ie)}finally{if(Ee)throw Ee.error}}},ye.prototype.countWithoutUndefined=function(J,Me){var Ee,ke,ee=0;try{for(var ie=we(Me),X=ie.next();!X.done;X=ie.next())J[X.value]!==void 0&&ee++}catch(te){Ee={error:te}}finally{try{X&&!X.done&&(ke=ie.return)&&ke.call(ie)}finally{if(Ee)throw Ee.error}}return ee},ye.prototype.encodeMap=function(J,Me){var Ee,ke,ee=Object.keys(J);this.sortKeys&&ee.sort();var ie=this.ignoreUndefined?this.countWithoutUndefined(J,ee):ee.length;if(ie<16)this.writeU8(128+ie);else if(ie<65536)this.writeU8(222),this.writeU16(ie);else{if(!(ie<4294967296))throw new Error("Too large map object: "+ie);this.writeU8(223),this.writeU32(ie)}try{for(var X=we(ee),te=X.next();!te.done;te=X.next()){var me=te.value,Le=J[me];this.ignoreUndefined&&Le===void 0||(this.encodeString(me),this.encode(Le,Me+1))}}catch(Ye){Ee={error:Ye}}finally{try{te&&!te.done&&(ke=X.return)&&ke.call(X)}finally{if(Ee)throw Ee.error}}},ye.prototype.encodeExtension=function(J){var Me=J.data.length;if(Me===1)this.writeU8(212);else if(Me===2)this.writeU8(213);else if(Me===4)this.writeU8(214);else if(Me===8)this.writeU8(215);else if(Me===16)this.writeU8(216);else if(Me<256)this.writeU8(199),this.writeU8(Me);else if(Me<65536)this.writeU8(200),this.writeU16(Me);else{if(!(Me<4294967296))throw new Error("Too large extension object: "+Me);this.writeU8(201),this.writeU32(Me)}this.writeI8(J.type),this.writeU8a(J.data)},ye.prototype.writeU8=function(J){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,J),this.pos++},ye.prototype.writeU8a=function(J){var Me=J.length;this.ensureBufferSizeToWrite(Me),this.bytes.set(J,this.pos),this.pos+=Me},ye.prototype.writeI8=function(J){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,J),this.pos++},ye.prototype.writeU16=function(J){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,J),this.pos+=2},ye.prototype.writeI16=function(J){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,J),this.pos+=2},ye.prototype.writeU32=function(J){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,J),this.pos+=4},ye.prototype.writeI32=function(J){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,J),this.pos+=4},ye.prototype.writeF32=function(J){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,J),this.pos+=4},ye.prototype.writeF64=function(J){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,J),this.pos+=8},ye.prototype.writeU64=function(J){this.ensureBufferSizeToWrite(8),function(Me,Ee,ke){var ee=ke/4294967296,ie=ke;Me.setUint32(Ee,ee),Me.setUint32(Ee+4,ie)}(this.view,this.pos,J),this.pos+=8},ye.prototype.writeI64=function(J){this.ensureBufferSizeToWrite(8),D(this.view,this.pos,J),this.pos+=8},ye}(),Ie={};function Ae(ye,J){J===void 0&&(J=Ie);var Me=new he(J.extensionCodec,J.context,J.maxDepth,J.initialBufferSize,J.sortKeys,J.forceFloat32,J.ignoreUndefined);return Me.encode(ye,1),Me.getUint8Array()}function Ue(ye){return(ye<0?"-":"")+"0x"+Math.abs(ye).toString(16).padStart(2,"0")}var Qe=function(){function ye(J,Me){J===void 0&&(J=16),Me===void 0&&(Me=16),this.maxKeyLength=J,this.maxLengthPerKey=Me,this.caches=[];for(var Ee=0;Ee<this.maxKeyLength;Ee++)this.caches.push([])}return ye.prototype.canBeCached=function(J){return J>0&&J<=this.maxKeyLength},ye.prototype.get=function(J,Me,Ee){var ke=this.caches[Ee-1],ee=ke.length;e:for(var ie=0;ie<ee;ie++){for(var X=ke[ie],te=X.bytes,me=0;me<Ee;me++)if(te[me]!==J[Me+me])continue e;return X.value}return null},ye.prototype.store=function(J,Me){var Ee=this.caches[J.length-1],ke={bytes:J,value:Me};Ee.length>=this.maxLengthPerKey?Ee[Math.random()*Ee.length|0]=ke:Ee.push(ke)},ye.prototype.decode=function(J,Me,Ee){var ke=this.get(J,Me,Ee);if(ke!=null)return ke;var ee=b(J,Me,Ee),ie=Uint8Array.prototype.slice.call(J,Me,Me+Ee);return this.store(ie,ee),ee},ye}(),ht=function(ye,J){var Me,Ee,ke,ee,ie={label:0,sent:function(){if(1&ke[0])throw ke[1];return ke[1]},trys:[],ops:[]};return ee={next:X(0),throw:X(1),return:X(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function X(te){return function(me){return function(Le){if(Me)throw new TypeError("Generator is already executing.");for(;ie;)try{if(Me=1,Ee&&(ke=2&Le[0]?Ee.return:Le[0]?Ee.throw||((ke=Ee.return)&&ke.call(Ee),0):Ee.next)&&!(ke=ke.call(Ee,Le[1])).done)return ke;switch(Ee=0,ke&&(Le=[2&Le[0],ke.value]),Le[0]){case 0:case 1:ke=Le;break;case 4:return ie.label++,{value:Le[1],done:!1};case 5:ie.label++,Ee=Le[1],Le=[0];continue;case 7:Le=ie.ops.pop(),ie.trys.pop();continue;default:if(!((ke=(ke=ie.trys).length>0&&ke[ke.length-1])||Le[0]!==6&&Le[0]!==2)){ie=0;continue}if(Le[0]===3&&(!ke||Le[1]>ke[0]&&Le[1]<ke[3])){ie.label=Le[1];break}if(Le[0]===6&&ie.label<ke[1]){ie.label=ke[1],ke=Le;break}if(ke&&ie.label<ke[2]){ie.label=ke[2],ie.ops.push(Le);break}ke[2]&&ie.ops.pop(),ie.trys.pop();continue}Le=J.call(ye,ie)}catch(Ye){Le=[6,Ye],Ee=0}finally{Me=ke=0}if(5&Le[0])throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}([te,me])}}},lt=function(ye){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J,Me=ye[Symbol.asyncIterator];return Me?Me.call(ye):(ye=typeof __values=="function"?__values(ye):ye[Symbol.iterator](),J={},Ee("next"),Ee("throw"),Ee("return"),J[Symbol.asyncIterator]=function(){return this},J);function Ee(ke){J[ke]=ye[ke]&&function(ee){return new Promise(function(ie,X){(function(te,me,Le,Ye){Promise.resolve(Ye).then(function(rt){te({value:rt,done:Le})},me)})(ie,X,(ee=ye[ke](ee)).done,ee.value)})}}},Et=function(ye){return this instanceof Et?(this.v=ye,this):new Et(ye)},Mt=function(ye,J,Me){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ee,ke=Me.apply(ye,J||[]),ee=[];return Ee={},ie("next"),ie("throw"),ie("return"),Ee[Symbol.asyncIterator]=function(){return this},Ee;function ie(Ye){ke[Ye]&&(Ee[Ye]=function(rt){return new Promise(function(Wt,mn){ee.push([Ye,rt,Wt,mn])>1||X(Ye,rt)})})}function X(Ye,rt){try{(Wt=ke[Ye](rt)).value instanceof Et?Promise.resolve(Wt.value.v).then(te,me):Le(ee[0][2],Wt)}catch(mn){Le(ee[0][3],mn)}var Wt}function te(Ye){X("next",Ye)}function me(Ye){X("throw",Ye)}function Le(Ye,rt){Ye(rt),ee.shift(),ee.length&&X(ee[0][0],ee[0][1])}},ln=new DataView(new ArrayBuffer(0)),Tn=new Uint8Array(ln.buffer),xn=function(){try{ln.getInt8(0)}catch(ye){return ye.constructor}throw new Error("never reached")}(),Qn=new xn("Insufficient data"),Cn=new Qe,Mn=function(){function ye(J,Me,Ee,ke,ee,ie,X,te){J===void 0&&(J=be.defaultCodec),Ee===void 0&&(Ee=4294967295),ke===void 0&&(ke=4294967295),ee===void 0&&(ee=4294967295),ie===void 0&&(ie=4294967295),X===void 0&&(X=4294967295),te===void 0&&(te=Cn),this.extensionCodec=J,this.context=Me,this.maxStrLength=Ee,this.maxBinLength=ke,this.maxArrayLength=ee,this.maxMapLength=ie,this.maxExtLength=X,this.cachedKeyDecoder=te,this.totalPos=0,this.pos=0,this.view=ln,this.bytes=Tn,this.headByte=-1,this.stack=[]}return ye.prototype.setBuffer=function(J){this.bytes=pe(J),this.view=function(Me){if(Me instanceof ArrayBuffer)return new DataView(Me);var Ee=pe(Me);return new DataView(Ee.buffer,Ee.byteOffset,Ee.byteLength)}(this.bytes),this.pos=0},ye.prototype.appendBuffer=function(J){if(this.headByte!==-1||this.hasRemaining()){var Me=this.bytes.subarray(this.pos),Ee=pe(J),ke=new Uint8Array(Me.length+Ee.length);ke.set(Me),ke.set(Ee,Me.length),this.setBuffer(ke)}else this.setBuffer(J)},ye.prototype.hasRemaining=function(J){return J===void 0&&(J=1),this.view.byteLength-this.pos>=J},ye.prototype.createNoExtraBytesError=function(J){var Me=this.view,Ee=this.pos;return new RangeError("Extra "+(Me.byteLength-Ee)+" byte(s) found at buffer["+J+"]")},ye.prototype.decodeSingleSync=function(){var J=this.decodeSync();if(this.hasRemaining())throw this.createNoExtraBytesError(this.pos);return J},ye.prototype.decodeSingleAsync=function(J){var Me,Ee,ke,ee;return function(ie,X,te,me){return new(te||(te=Promise))(function(Le,Ye){function rt(gn){try{mn(me.next(gn))}catch(_n){Ye(_n)}}function Wt(gn){try{mn(me.throw(gn))}catch(_n){Ye(_n)}}function mn(gn){var _n;gn.done?Le(gn.value):(_n=gn.value,_n instanceof te?_n:new te(function(In){In(_n)})).then(rt,Wt)}mn((me=me.apply(ie,X||[])).next())})}(this,void 0,void 0,function(){var ie,X,te,me,Le,Ye,rt,Wt;return ht(this,function(mn){switch(mn.label){case 0:ie=!1,mn.label=1;case 1:mn.trys.push([1,6,7,12]),Me=lt(J),mn.label=2;case 2:return[4,Me.next()];case 3:if((Ee=mn.sent()).done)return[3,5];if(te=Ee.value,ie)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(te);try{X=this.decodeSync(),ie=!0}catch(gn){if(!(gn instanceof xn))throw gn}this.totalPos+=this.pos,mn.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return me=mn.sent(),ke={error:me},[3,12];case 7:return mn.trys.push([7,,10,11]),Ee&&!Ee.done&&(ee=Me.return)?[4,ee.call(Me)]:[3,9];case 8:mn.sent(),mn.label=9;case 9:return[3,11];case 10:if(ke)throw ke.error;return[7];case 11:return[7];case 12:if(ie){if(this.hasRemaining())throw this.createNoExtraBytesError(this.totalPos);return[2,X]}throw Ye=(Le=this).headByte,rt=Le.pos,Wt=Le.totalPos,new RangeError("Insufficient data in parcing "+Ue(Ye)+" at "+Wt+" ("+rt+" in the current buffer)")}})})},ye.prototype.decodeArrayStream=function(J){return this.decodeMultiAsync(J,!0)},ye.prototype.decodeStream=function(J){return this.decodeMultiAsync(J,!1)},ye.prototype.decodeMultiAsync=function(J,Me){return Mt(this,arguments,function(){var Ee,ke,ee,ie,X,te,me,Le,Ye;return ht(this,function(rt){switch(rt.label){case 0:Ee=Me,ke=-1,rt.label=1;case 1:rt.trys.push([1,13,14,19]),ee=lt(J),rt.label=2;case 2:return[4,Et(ee.next())];case 3:if((ie=rt.sent()).done)return[3,12];if(X=ie.value,Me&&ke===0)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(X),Ee&&(ke=this.readArraySize(),Ee=!1,this.complete()),rt.label=4;case 4:rt.trys.push([4,9,,10]),rt.label=5;case 5:return[4,Et(this.decodeSync())];case 6:return[4,rt.sent()];case 7:return rt.sent(),--ke==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((te=rt.sent())instanceof xn))throw te;return[3,10];case 10:this.totalPos+=this.pos,rt.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return me=rt.sent(),Le={error:me},[3,19];case 14:return rt.trys.push([14,,17,18]),ie&&!ie.done&&(Ye=ee.return)?[4,Et(Ye.call(ee))]:[3,16];case 15:rt.sent(),rt.label=16;case 16:return[3,18];case 17:if(Le)throw Le.error;return[7];case 18:return[7];case 19:return[2]}})})},ye.prototype.decodeSync=function(){e:for(;;){var J=this.readHeadByte(),Me=void 0;if(J>=224)Me=J-256;else if(J<192)if(J<128)Me=J;else if(J<144){if((ke=J-128)!=0){this.pushMapState(ke),this.complete();continue e}Me={}}else if(J<160){if((ke=J-144)!=0){this.pushArrayState(ke),this.complete();continue e}Me=[]}else{var Ee=J-160;Me=this.decodeUtf8String(Ee,0)}else if(J===192)Me=null;else if(J===194)Me=!1;else if(J===195)Me=!0;else if(J===202)Me=this.readF32();else if(J===203)Me=this.readF64();else if(J===204)Me=this.readU8();else if(J===205)Me=this.readU16();else if(J===206)Me=this.readU32();else if(J===207)Me=this.readU64();else if(J===208)Me=this.readI8();else if(J===209)Me=this.readI16();else if(J===210)Me=this.readI32();else if(J===211)Me=this.readI64();else if(J===217)Ee=this.lookU8(),Me=this.decodeUtf8String(Ee,1);else if(J===218)Ee=this.lookU16(),Me=this.decodeUtf8String(Ee,2);else if(J===219)Ee=this.lookU32(),Me=this.decodeUtf8String(Ee,4);else if(J===220){if((ke=this.readU16())!==0){this.pushArrayState(ke),this.complete();continue e}Me=[]}else if(J===221){if((ke=this.readU32())!==0){this.pushArrayState(ke),this.complete();continue e}Me=[]}else if(J===222){if((ke=this.readU16())!==0){this.pushMapState(ke),this.complete();continue e}Me={}}else if(J===223){if((ke=this.readU32())!==0){this.pushMapState(ke),this.complete();continue e}Me={}}else if(J===196){var ke=this.lookU8();Me=this.decodeBinary(ke,1)}else if(J===197)ke=this.lookU16(),Me=this.decodeBinary(ke,2);else if(J===198)ke=this.lookU32(),Me=this.decodeBinary(ke,4);else if(J===212)Me=this.decodeExtension(1,0);else if(J===213)Me=this.decodeExtension(2,0);else if(J===214)Me=this.decodeExtension(4,0);else if(J===215)Me=this.decodeExtension(8,0);else if(J===216)Me=this.decodeExtension(16,0);else if(J===199)ke=this.lookU8(),Me=this.decodeExtension(ke,1);else if(J===200)ke=this.lookU16(),Me=this.decodeExtension(ke,2);else{if(J!==201)throw new Error("Unrecognized type byte: "+Ue(J));ke=this.lookU32(),Me=this.decodeExtension(ke,4)}this.complete();for(var ee=this.stack;ee.length>0;){var ie=ee[ee.length-1];if(ie.type===0){if(ie.array[ie.position]=Me,ie.position++,ie.position!==ie.size)continue e;ee.pop(),Me=ie.array}else{if(ie.type===1){if((X=typeof Me)!="string"&&X!=="number")throw new Error("The type of key must be string or number but "+typeof Me);ie.key=Me,ie.type=2;continue e}if(ie.map[ie.key]=Me,ie.readCount++,ie.readCount!==ie.size){ie.key=null,ie.type=1;continue e}ee.pop(),Me=ie.map}}return Me}var X},ye.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},ye.prototype.complete=function(){this.headByte=-1},ye.prototype.readArraySize=function(){var J=this.readHeadByte();switch(J){case 220:return this.readU16();case 221:return this.readU32();default:if(J<160)return J-144;throw new Error("Unrecognized array type byte: "+Ue(J))}},ye.prototype.pushMapState=function(J){if(J>this.maxMapLength)throw new Error("Max length exceeded: map length ("+J+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:J,key:null,readCount:0,map:{}})},ye.prototype.pushArrayState=function(J){if(J>this.maxArrayLength)throw new Error("Max length exceeded: array length ("+J+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:J,array:new Array(J),position:0})},ye.prototype.decodeUtf8String=function(J,Me){var Ee;if(J>this.maxStrLength)throw new Error("Max length exceeded: UTF-8 byte length ("+J+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+Me+J)throw Qn;var ke,ee=this.pos+Me;return ke=this.stateIsMapKey()&&((Ee=this.cachedKeyDecoder)===null||Ee===void 0?void 0:Ee.canBeCached(J))?this.cachedKeyDecoder.decode(this.bytes,ee,J):L&&J>A?function(ie,X,te){var me=ie.subarray(X,X+te);return T.decode(me)}(this.bytes,ee,J):b(this.bytes,ee,J),this.pos+=Me+J,ke},ye.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===1},ye.prototype.decodeBinary=function(J,Me){if(J>this.maxBinLength)throw new Error("Max length exceeded: bin length ("+J+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(J+Me))throw Qn;var Ee=this.pos+Me,ke=this.bytes.subarray(Ee,Ee+J);return this.pos+=Me+J,ke},ye.prototype.decodeExtension=function(J,Me){if(J>this.maxExtLength)throw new Error("Max length exceeded: ext length ("+J+") > maxExtLength ("+this.maxExtLength+")");var Ee=this.view.getInt8(this.pos+Me),ke=this.decodeBinary(J,Me+1);return this.extensionCodec.decode(ke,Ee,this.context)},ye.prototype.lookU8=function(){return this.view.getUint8(this.pos)},ye.prototype.lookU16=function(){return this.view.getUint16(this.pos)},ye.prototype.lookU32=function(){return this.view.getUint32(this.pos)},ye.prototype.readU8=function(){var J=this.view.getUint8(this.pos);return this.pos++,J},ye.prototype.readI8=function(){var J=this.view.getInt8(this.pos);return this.pos++,J},ye.prototype.readU16=function(){var J=this.view.getUint16(this.pos);return this.pos+=2,J},ye.prototype.readI16=function(){var J=this.view.getInt16(this.pos);return this.pos+=2,J},ye.prototype.readU32=function(){var J=this.view.getUint32(this.pos);return this.pos+=4,J},ye.prototype.readI32=function(){var J=this.view.getInt32(this.pos);return this.pos+=4,J},ye.prototype.readU64=function(){var J,Me,Ee=(J=this.view,Me=this.pos,4294967296*J.getUint32(Me)+J.getUint32(Me+4));return this.pos+=8,Ee},ye.prototype.readI64=function(){var J=B(this.view,this.pos);return this.pos+=8,J},ye.prototype.readF32=function(){var J=this.view.getFloat32(this.pos);return this.pos+=4,J},ye.prototype.readF64=function(){var J=this.view.getFloat64(this.pos);return this.pos+=8,J},ye}(),Ar={};function _i(ye,J){J===void 0&&(J=Ar);var Me=new Mn(J.extensionCodec,J.context,J.maxStrLength,J.maxBinLength,J.maxArrayLength,J.maxMapLength,J.maxExtLength);return Me.setBuffer(ye),Me.decodeSingleSync()}var si=function(ye,J){var Me,Ee,ke,ee,ie={label:0,sent:function(){if(1&ke[0])throw ke[1];return ke[1]},trys:[],ops:[]};return ee={next:X(0),throw:X(1),return:X(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function X(te){return function(me){return function(Le){if(Me)throw new TypeError("Generator is already executing.");for(;ie;)try{if(Me=1,Ee&&(ke=2&Le[0]?Ee.return:Le[0]?Ee.throw||((ke=Ee.return)&&ke.call(Ee),0):Ee.next)&&!(ke=ke.call(Ee,Le[1])).done)return ke;switch(Ee=0,ke&&(Le=[2&Le[0],ke.value]),Le[0]){case 0:case 1:ke=Le;break;case 4:return ie.label++,{value:Le[1],done:!1};case 5:ie.label++,Ee=Le[1],Le=[0];continue;case 7:Le=ie.ops.pop(),ie.trys.pop();continue;default:if(!((ke=(ke=ie.trys).length>0&&ke[ke.length-1])||Le[0]!==6&&Le[0]!==2)){ie=0;continue}if(Le[0]===3&&(!ke||Le[1]>ke[0]&&Le[1]<ke[3])){ie.label=Le[1];break}if(Le[0]===6&&ie.label<ke[1]){ie.label=ke[1],ke=Le;break}if(ke&&ie.label<ke[2]){ie.label=ke[2],ie.ops.push(Le);break}ke[2]&&ie.ops.pop(),ie.trys.pop();continue}Le=J.call(ye,ie)}catch(Ye){Le=[6,Ye],Ee=0}finally{Me=ke=0}if(5&Le[0])throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}([te,me])}}},mi=function(ye){return this instanceof mi?(this.v=ye,this):new mi(ye)},Qi=function(ye,J,Me){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ee,ke=Me.apply(ye,J||[]),ee=[];return Ee={},ie("next"),ie("throw"),ie("return"),Ee[Symbol.asyncIterator]=function(){return this},Ee;function ie(Ye){ke[Ye]&&(Ee[Ye]=function(rt){return new Promise(function(Wt,mn){ee.push([Ye,rt,Wt,mn])>1||X(Ye,rt)})})}function X(Ye,rt){try{(Wt=ke[Ye](rt)).value instanceof mi?Promise.resolve(Wt.value.v).then(te,me):Le(ee[0][2],Wt)}catch(mn){Le(ee[0][3],mn)}var Wt}function te(Ye){X("next",Ye)}function me(Ye){X("throw",Ye)}function Le(Ye,rt){Ye(rt),ee.shift(),ee.length&&X(ee[0][0],ee[0][1])}};function Di(ye){if(ye==null)throw new Error("Assertion Failure: value must not be null nor undefined")}function Kr(ye){return ye[Symbol.asyncIterator]!=null?ye:function(J){return Qi(this,arguments,function(){var Me,Ee,ke,ee;return si(this,function(ie){switch(ie.label){case 0:Me=J.getReader(),ie.label=1;case 1:ie.trys.push([1,,9,10]),ie.label=2;case 2:return[4,mi(Me.read())];case 3:return Ee=ie.sent(),ke=Ee.done,ee=Ee.value,ke?[4,mi(void 0)]:[3,5];case 4:return[2,ie.sent()];case 5:return Di(ee),[4,mi(ee)];case 6:return[4,ie.sent()];case 7:return ie.sent(),[3,2];case 8:return[3,10];case 9:return Me.releaseLock(),[7];case 10:return[2]}})})}(ye)}function Ci(ye,J){return J===void 0&&(J=Ar),function(Me,Ee,ke,ee){return new(ke||(ke=Promise))(function(ie,X){function te(Ye){try{Le(ee.next(Ye))}catch(rt){X(rt)}}function me(Ye){try{Le(ee.throw(Ye))}catch(rt){X(rt)}}function Le(Ye){var rt;Ye.done?ie(Ye.value):(rt=Ye.value,rt instanceof ke?rt:new ke(function(Wt){Wt(rt)})).then(te,me)}Le((ee=ee.apply(Me,Ee||[])).next())})}(this,void 0,void 0,function(){var Me;return function(Ee,ke){var ee,ie,X,te,me={label:0,sent:function(){if(1&X[0])throw X[1];return X[1]},trys:[],ops:[]};return te={next:Le(0),throw:Le(1),return:Le(2)},typeof Symbol=="function"&&(te[Symbol.iterator]=function(){return this}),te;function Le(Ye){return function(rt){return function(Wt){if(ee)throw new TypeError("Generator is already executing.");for(;me;)try{if(ee=1,ie&&(X=2&Wt[0]?ie.return:Wt[0]?ie.throw||((X=ie.return)&&X.call(ie),0):ie.next)&&!(X=X.call(ie,Wt[1])).done)return X;switch(ie=0,X&&(Wt=[2&Wt[0],X.value]),Wt[0]){case 0:case 1:X=Wt;break;case 4:return me.label++,{value:Wt[1],done:!1};case 5:me.label++,ie=Wt[1],Wt=[0];continue;case 7:Wt=me.ops.pop(),me.trys.pop();continue;default:if(!((X=(X=me.trys).length>0&&X[X.length-1])||Wt[0]!==6&&Wt[0]!==2)){me=0;continue}if(Wt[0]===3&&(!X||Wt[1]>X[0]&&Wt[1]<X[3])){me.label=Wt[1];break}if(Wt[0]===6&&me.label<X[1]){me.label=X[1],X=Wt;break}if(X&&me.label<X[2]){me.label=X[2],me.ops.push(Wt);break}X[2]&&me.ops.pop(),me.trys.pop();continue}Wt=ke.call(Ee,me)}catch(mn){Wt=[6,mn],ie=0}finally{ee=X=0}if(5&Wt[0])throw Wt[1];return{value:Wt[0]?Wt[1]:void 0,done:!0}}([Ye,rt])}}}(this,function(Ee){return Me=Kr(ye),[2,new Mn(J.extensionCodec,J.context,J.maxStrLength,J.maxBinLength,J.maxArrayLength,J.maxMapLength,J.maxExtLength).decodeSingleAsync(Me)]})})}function ss(ye,J){J===void 0&&(J=Ar);var Me=Kr(ye);return new Mn(J.extensionCodec,J.context,J.maxStrLength,J.maxBinLength,J.maxArrayLength,J.maxMapLength,J.maxExtLength).decodeArrayStream(Me)}function tn(ye,J){J===void 0&&(J=Ar);var Me=Kr(ye);return new Mn(J.extensionCodec,J.context,J.maxStrLength,J.maxBinLength,J.maxArrayLength,J.maxMapLength,J.maxExtLength).decodeStream(Me)}}])},4563:(V,re,ae)=>{"use strict";ae.r(re),ae.d(re,{Abs:()=>Xt,Acos:()=>nr,Acosh:()=>yr,AdadeltaOptimizer:()=>Wp,AdagradOptimizer:()=>ku,AdamOptimizer:()=>jp,AdamaxOptimizer:()=>Id,Add:()=>Tr,AddN:()=>qi,All:()=>ai,Any:()=>Vr,ArgMax:()=>ui,ArgMin:()=>Zi,Asin:()=>ks,Asinh:()=>Mr,Atan:()=>jr,Atan2:()=>qs,Atanh:()=>Xr,AvgPool:()=>Bi,AvgPool3D:()=>le,AvgPool3DGrad:()=>de,AvgPoolGrad:()=>Ki,BatchMatMul:()=>_e,BatchToSpaceND:()=>Ne,Bincount:()=>He,BroadcastArgs:()=>gt,BroadcastTo:()=>ct,Callback:()=>t2,CallbackList:()=>De,Cast:()=>Yt,Ceil:()=>Qt,ClipByValue:()=>At,Complex:()=>Pt,ComplexAbs:()=>hn,Concat:()=>zn,Conv2D:()=>Kn,Conv2DBackpropFilter:()=>hr,Conv2DBackpropInput:()=>Rr,Conv3D:()=>Nr,Conv3DBackpropFilterV2:()=>kr,Conv3DBackpropInputV2:()=>ki,Cos:()=>Ji,Cosh:()=>vs,CropAndResize:()=>Qr,Cumsum:()=>Ei,CustomCallback:()=>Rt,DataStorage:()=>Qi,DenseBincount:()=>oa,DepthToSpace:()=>la,DepthwiseConv2dNative:()=>bs,DepthwiseConv2dNativeBackpropFilter:()=>ua,DepthwiseConv2dNativeBackpropInput:()=>Ao,Diag:()=>Eo,Dilation2D:()=>dl,Dilation2DBackpropFilter:()=>Ol,Dilation2DBackpropInput:()=>Pl,ENV:()=>wn,EarlyStopping:()=>n2,Einsum:()=>Bl,Elu:()=>Bo,EluGrad:()=>Ul,Environment:()=>xt,Equal:()=>pl,Erf:()=>Uo,Exp:()=>zo,ExpandDims:()=>xs,Expm1:()=>rd,FFT:()=>Jf,Fill:()=>gp,FlipLeftRight:()=>vu,Floor:()=>fl,FloorDiv:()=>id,FromPixels:()=>ph,FusedBatchNorm:()=>yp,FusedConv2D:()=>Wl,FusedDepthwiseConv2D:()=>_o,GatherNd:()=>em,GatherV2:()=>vp,GraphModel:()=>m2,Greater:()=>bp,GreaterEqual:()=>sd,History:()=>_t,IFFT:()=>tm,Identity:()=>ad,Imag:()=>od,InputSpec:()=>ce,IsFinite:()=>bu,IsInf:()=>to,IsNan:()=>$s,KernelBackend:()=>Di,LRN:()=>Ap,LRNGrad:()=>nm,LayerVariable:()=>Y,LayersModel:()=>Nt,LeakyRelu:()=>rc,Less:()=>ml,LessEqual:()=>xu,LinSpace:()=>Da,Log:()=>Vs,Log1p:()=>ic,LogSoftmax:()=>av,LogicalAnd:()=>xp,LogicalNot:()=>wp,LogicalOr:()=>wu,Max:()=>Ep,MaxPool:()=>Sp,MaxPool3D:()=>Tp,MaxPool3DGrad:()=>im,MaxPoolGrad:()=>rm,MaxPoolWithArgmax:()=>sm,Maximum:()=>ld,Mean:()=>nh,Min:()=>ud,Minimum:()=>rh,MirrorPad:()=>Mp,Mod:()=>ih,MomentumOptimizer:()=>Ru,Multinomial:()=>un,Multiply:()=>Ts,Neg:()=>cd,NonMaxSuppressionV3:()=>Au,NonMaxSuppressionV4:()=>sc,NonMaxSuppressionV5:()=>Cp,NotEqual:()=>_p,OP_SCOPE_SUFFIX:()=>bh,OneHot:()=>ac,OnesLike:()=>Ga,Optimizer:()=>Aa,OptimizerConstructors:()=>tu,Pack:()=>sh,PadV2:()=>zl,Pool:()=>Hg,Pow:()=>Fn,Prelu:()=>$l,Prod:()=>gl,RMSPropOptimizer:()=>Xp,RNN:()=>Ju,Range:()=>am,Rank:()=>Yl,Real:()=>Rs,RealDiv:()=>Oo,Reciprocal:()=>oc,Reduction:()=>ka,Relu:()=>Si,Relu6:()=>lc,Reshape:()=>Ta,ResizeBilinear:()=>Hs,ResizeBilinearGrad:()=>je,ResizeNearestNeighbor:()=>hd,ResizeNearestNeighborGrad:()=>ah,Reverse:()=>dd,RotateWithOffset:()=>um,Round:()=>va,Rsqrt:()=>no,SGDOptimizer:()=>Ml,ScatterNd:()=>Vl,Select:()=>oh,Selu:()=>yl,Sequential:()=>sn,Sigmoid:()=>$o,Sign:()=>To,Sin:()=>vl,Sinh:()=>So,Slice:()=>Hl,Softmax:()=>Ip,Softplus:()=>Gl,SpaceToBatchND:()=>bl,SparseFillEmptyRows:()=>kp,SparseReshape:()=>uh,SparseSegmentMean:()=>pd,SparseSegmentSum:()=>xl,SparseToDense:()=>Vo,SplitV:()=>lh,Sqrt:()=>Eu,Square:()=>ch,SquaredDifference:()=>cc,Step:()=>Go,StridedSlice:()=>wl,StringNGrams:()=>fd,StringSplit:()=>hh,StringToHashBucketFast:()=>md,Sub:()=>Mo,Sum:()=>uc,SymbolicTensor:()=>ve,Tan:()=>Wn,Tanh:()=>Al,Tensor:()=>Ni,TensorBuffer:()=>Hi,Tile:()=>Fa,TopK:()=>om,Transform:()=>lm,Transpose:()=>Ho,Unique:()=>dh,Unpack:()=>Ma,UnsortedSegmentSum:()=>gd,Variable:()=>mh,ZerosLike:()=>yd,_FusedMatMul:()=>vd,abs:()=>_s,acos:()=>g0,acosh:()=>vm,add:()=>fn,addN:()=>qp,all:()=>bm,any:()=>kd,argMax:()=>yc,argMin:()=>Kp,asin:()=>y0,asinh:()=>v0,atan:()=>b0,atan2:()=>x0,atanh:()=>w0,avgPool:()=>Nd,avgPool3d:()=>wc,backend:()=>x1,backend_util:()=>$,basicLSTMCell:()=>T1,batchNorm:()=>Ld,batchNorm2d:()=>Hv,batchNorm3d:()=>Gv,batchNorm4d:()=>Wv,batchToSpaceND:()=>Yp,bincount:()=>E0,booleanMaskAsync:()=>H0,broadcastArgs:()=>jv,broadcastTo:()=>Dd,broadcast_util:()=>C,browser:()=>M,buffer:()=>ci,callbacks:()=>R_,cast:()=>En,ceil:()=>S0,clipByValue:()=>Xa,clone:()=>Cu,complex:()=>Jl,concat:()=>Ti,concat1d:()=>Xv,concat2d:()=>qv,concat3d:()=>Kv,concat4d:()=>Yv,constraints:()=>q,conv1d:()=>wm,conv2d:()=>Du,conv2dTranspose:()=>Am,conv3d:()=>M0,conv3dTranspose:()=>Zv,copyRegisteredKernels:()=>Su,cos:()=>Qp,cosh:()=>Em,cosineWindow:()=>mf,cumsum:()=>Sm,customGrad:()=>ja,data:()=>si,denseBincount:()=>Jv,deprecationWarn:()=>b1,depthToSpace:()=>_0,depthwiseConv2d:()=>Fd,deregisterOp:()=>L_,device_util:()=>P,diag:()=>M1,dilation2d:()=>C0,disableDeprecationWarnings:()=>SE,dispose:()=>ni,disposeVariables:()=>TE,div:()=>yn,divNoNan:()=>I0,dot:()=>eb,dropout:()=>Dc,einsum:()=>tb,elu:()=>Pd,enableDebugMode:()=>EE,enableProdMode:()=>AE,enclosingPowerOfTwo:()=>W0,engine:()=>gc,env:()=>Ge,equal:()=>so,erf:()=>k0,exp:()=>ao,expandDims:()=>qa,expm1:()=>R0,eye:()=>Tm,fft:()=>Nc,fill:()=>Ch,findBackend:()=>NE,findBackendFactory:()=>LE,floor:()=>Ac,floorDiv:()=>m0,fused:()=>D,gather:()=>Ec,gatherND:()=>Fm,gather_util:()=>I,getBackend:()=>kE,getGradient:()=>cm,getKernel:()=>Lp,getKernelsForBackend:()=>Dp,grad:()=>w1,grads:()=>A1,greater:()=>Ka,greaterEqual:()=>Ya,ifft:()=>Fh,imag:()=>Zp,image:()=>Jo,inTopKAsync:()=>Pm,initializers:()=>Q,input:()=>di,io:()=>L,irfft:()=>cf,isFinite:()=>nb,isInf:()=>rb,isNaN:()=>N0,keep:()=>wa,kernel_impls:()=>j,layers:()=>ue,leakyRelu:()=>Od,less:()=>Mm,lessEqual:()=>Sc,linalg:()=>bb,linspace:()=>ib,loadGraphModel:()=>lC,loadLayersModel:()=>vi,localResponseNormalization:()=>L0,log:()=>lo,log1p:()=>Fu,logSigmoid:()=>sb,logSoftmax:()=>_m,logSumExp:()=>P0,logicalAnd:()=>Yo,logicalNot:()=>Jp,logicalOr:()=>Cm,logicalXor:()=>ab,losses:()=>j1,matMul:()=>oi,math:()=>k,max:()=>uo,maxPool:()=>ef,maxPool3d:()=>O0,maxPoolWithArgmax:()=>ob,maximum:()=>Tl,mean:()=>ws,memory:()=>f0,meshgrid:()=>_1,metrics:()=>xe,min:()=>tf,minimum:()=>Ud,mirrorPad:()=>B0,mod:()=>U0,model:()=>ri,models:()=>Se,moments:()=>nf,movingAverage:()=>db,mul:()=>qe,multiRNNCell:()=>C1,multinomial:()=>rf,neg:()=>ps,nextFrame:()=>xb,norm:()=>Qo,notEqual:()=>ru,oneHot:()=>Md,ones:()=>co,onesLike:()=>ho,op:()=>at,outerProduct:()=>I1,pad:()=>iu,pad1d:()=>k1,pad2d:()=>R1,pad3d:()=>lb,pad4d:()=>Mc,pool:()=>z0,pow:()=>Sl,prelu:()=>zd,print:()=>xv,prod:()=>Im,profile:()=>ME,rand:()=>ub,randomGamma:()=>L1,randomNormal:()=>cb,randomUniform:()=>Gi,range:()=>Rh,ready:()=>IE,real:()=>Pu,reciprocal:()=>Nh,registerBackend:()=>Vv,registerCallbackConstructor:()=>ns,registerGradient:()=>Gg,registerKernel:()=>hm,registerOp:()=>N_,regularizers:()=>be,relu:()=>po,relu6:()=>su,removeBackend:()=>RE,reshape:()=>pt,reverse:()=>Pi,reverse1d:()=>Cc,reverse2d:()=>Rm,reverse3d:()=>Vd,reverse4d:()=>af,rfft:()=>Gd,round:()=>Ou,rsqrt:()=>Bu,scalar:()=>Jn,scatterND:()=>G0,scatter_util:()=>b,selu:()=>Uu,separableConv2d:()=>Lh,sequential:()=>ii,serialization:()=>A,setBackend:()=>CE,setPlatform:()=>DE,setdiff1dAsync:()=>$0,sigmoid:()=>ds,sign:()=>Hd,signal:()=>W1,sin:()=>Ic,sinh:()=>Dh,slice:()=>hi,slice1d:()=>of,slice2d:()=>lf,slice3d:()=>uf,slice4d:()=>kc,slice_util:()=>T,softmax:()=>Rc,softplus:()=>Tc,spaceToBatchND:()=>_c,sparse:()=>_f,sparseToDense:()=>Ba,spectral:()=>G1,split:()=>Oa,sqrt:()=>rs,square:()=>es,squaredDifference:()=>hf,squeeze:()=>au,stack:()=>Qa,step:()=>zu,stridedSlice:()=>Wd,string:()=>Yd,sub:()=>Un,sum:()=>Yn,sumOutType:()=>gh,tan:()=>$u,tanh:()=>kh,tensor:()=>Xo,tensor1d:()=>ga,tensor2d:()=>Ph,tensor3d:()=>_v,tensor4d:()=>Nm,tensor5d:()=>Oh,tensor6d:()=>hb,tensor_util:()=>z,test_util:()=>_,tidy:()=>bt,tile:()=>oo,time:()=>_E,topk:()=>Lm,train:()=>$h,transpose:()=>xi,truncatedNormal:()=>Bh,unique:()=>Lc,unregisterGradient:()=>El,unregisterKernel:()=>bi,unsortedSegmentSum:()=>df,unstack:()=>ts,upcastType:()=>_a,util:()=>E,valueAndGrad:()=>E1,valueAndGrads:()=>S1,variable:()=>V0,variableGrads:()=>Cd,version:()=>a4,version_converter:()=>g2,version_core:()=>v1,version_layers:()=>Er,where:()=>Ia,whereAsync:()=>Dm,zeros:()=>js,zerosLike:()=>wi});var E={};ae.r(E),ae.d(E,{arraysEqual:()=>Ye,assert:()=>ee,assertNonNegativeIntegerDimensions:()=>nc,assertNonNull:()=>X,assertShapesMatch:()=>ie,bytesFromStringArray:()=>Ir,bytesPerElement:()=>xr,checkConversionForErrors:()=>Kt,clamp:()=>tn,computeStrides:()=>Rn,createScalarValue:()=>ql,createShuffledIndices:()=>gn,decodeString:()=>hc,distSquared:()=>ke,encodeString:()=>Co,fetch:()=>jg,fingerPrint64:()=>Ri,flatten:()=>te,getArrayFromDType:()=>St,getTypedArrayFromDType:()=>Pr,hasEncodingLoss:()=>cr,hexToLong:()=>Xl,indexToLoc:()=>$e,inferDtype:()=>hs,inferFromImplicitShape:()=>Yr,isBoolean:()=>gi,isFunction:()=>ti,isInt:()=>rt,isNumber:()=>yi,isPromise:()=>et,isScalarShape:()=>Le,isString:()=>Sr,isTypedArray:()=>ir,isValidDtype:()=>vn,locToIndex:()=>zs,makeOnesTypedArray:()=>Fi,makeZerosNestedTypedArray:()=>aa,makeZerosTypedArray:()=>li,nearestDivisor:()=>Vi,nearestLargerEven:()=>ye,now:()=>ha,parseAxisParam:()=>Zn,randUniform:()=>Ee,repeatedTry:()=>In,rightPad:()=>_n,shuffle:()=>Ci,shuffleCombo:()=>ss,sizeFromShape:()=>me,sizeToSquarishShape:()=>mn,squeezeShape:()=>Ii,sum:()=>Me,swap:()=>J,tanh:()=>Wt,toNestedArray:()=>Xi,toTypedArray:()=>Mu});var z={};ae.r(z),ae.d(z,{assertTypesMatch:()=>zp,getTensorsInContainer:()=>jo,isTensorInList:()=>yh,makeTypesMatch:()=>ls});var P={};ae.r(P),ae.d(P,{isBrowser:()=>Kg,isMobile:()=>qg,mockIsMobile:()=>uv});var L={};ae.r(L),ae.d(L,{browserFiles:()=>o1,browserHTTPRequest:()=>mm,concatenateArrayBuffers:()=>eu,copyModel:()=>r1,decodeWeights:()=>xh,encodeWeights:()=>fc,fromMemory:()=>u1,getLoadHandlers:()=>Zg,getModelArtifactsForJSON:()=>Yg,getModelArtifactsInfoForJSON:()=>Gp,getSaveHandlers:()=>Qg,http:()=>i0,isHTTPScheme:()=>r0,listModels:()=>t1,loadWeights:()=>Sv,moveModel:()=>i1,registerLoadRouter:()=>Xx,registerSaveRouter:()=>jx,removeModel:()=>n1,weightsLoaderFactory:()=>Tv,withSaveHandler:()=>c1});var k={};ae.r(k),ae.d(k,{confusionMatrix:()=>h1});var C={};ae.r(C),ae.d(C,{assertAndGetBroadcastShape:()=>Zr,getBroadcastDims:()=>Th,getReductionAxes:()=>Qs});var M={};ae.r(M),ae.d(M,{fromPixels:()=>Iv,fromPixelsAsync:()=>d1,toPixels:()=>p1});var I={};ae.r(I),ae.d(I,{prepareAndValidate:()=>gm});var b={};ae.r(b),ae.d(b,{calculateShapes:()=>_d,validateInput:()=>o0,validateUpdateShape:()=>a0});var T={};ae.r(T),ae.d(T,{assertParamsValid:()=>l0,computeFlatOffset:()=>h0,computeOutShape:()=>u0,getNormalizedAxes:()=>m1,isSliceContinous:()=>c0,maskToAxes:()=>f1,parseSliceParams:()=>ym,sliceInfo:()=>d0,startForAxis:()=>Pv,startIndicesWithElidedDims:()=>Lv,stopForAxis:()=>Ov,stopIndicesWithElidedDims:()=>Dv,stridesForAxis:()=>Fv,stridesWithElidedDims:()=>kv});var A={};ae.r(A),ae.d(A,{Serializable:()=>_h,SerializationMap:()=>ko,registerClass:()=>dn});var _={};ae.r(_),ae.d(_,{TEST_EPSILON_FLOAT16:()=>Uv,encodeStrings:()=>y1,expectArrayBuffersEqual:()=>wE,expectArraysClose:()=>g1,expectArraysEqual:()=>vE,expectNumbersClose:()=>bE,expectPromiseToFail:()=>yE,expectValuesInRange:()=>xE,testEpsilon:()=>p0});var D={};ae.r(D),ae.d(D,{conv2d:()=>bf,depthwiseConv2d:()=>Vu,matMul:()=>Hu});var B={};ae.r(B),ae.d(B,{collectGatherOpShapeInfo:()=>Lo,computeOutShape:()=>ny,segOpComputeOptimalWindowSize:()=>ng});var $={};ae.r($),ae.d($,{ERF_A1:()=>el,ERF_A2:()=>Xm,ERF_A3:()=>qm,ERF_A4:()=>tl,ERF_A5:()=>J0,ERF_P:()=>Z0,PARALLELIZE_THRESHOLD:()=>Gm,SELU_SCALE:()=>Jd,SELU_SCALEALPHA:()=>Oc,applyActivation:()=>yf,assertAndGetBroadcastShape:()=>Zr,assertAxesAreInnerMostDims:()=>ma,assertParamsConsistent:()=>As,assignToTypedArray:()=>zc,axesAreInnerMostDims:()=>D0,calculateShapes:()=>_d,checkEinsumDimSizes:()=>Gc,checkPadOnDimRoundingMode:()=>Ca,combineLocations:()=>F0,complexWithEvenIndex:()=>Gh,complexWithOddIndex:()=>Bc,computeConv2DInfo:()=>ta,computeConv3DInfo:()=>bc,computeDefaultPad:()=>A0,computeDilation2DInfo:()=>vc,computeOptimalWindowSize:()=>Vh,computeOutAndReduceShapes:()=>fa,computeOutShape:()=>No,computePool2DInfo:()=>Ko,computePool3DInfo:()=>Nu,convertConv2DDataFormat:()=>nu,decodeEinsumEquation:()=>Vc,eitherStridesOrDilationsAreOne:()=>pa,expandShapeToKeepDim:()=>Ls,exponent:()=>$c,exponents:()=>wb,fromStringArrayToUint8:()=>rg,fromUint8ToStringArray:()=>Do,getAxesPermutation:()=>Ws,getBroadcastDims:()=>Th,getComplexWithIndex:()=>Uc,getEinsumComputePath:()=>kf,getEinsumPermutation:()=>Hc,getFusedBiasGradient:()=>gf,getFusedDyActivation:()=>Fc,getImageCenter:()=>Zd,getInnerMostAxes:()=>Zs,getPermuted:()=>Gu,getReductionAxes:()=>Qs,getReshaped:()=>Cf,getReshapedPermuted:()=>If,getSliceBeginCoords:()=>Wm,getSliceSize:()=>jm,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>Nf,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>Ym,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>Qm,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>ey,getSparseReshapeInputOutputMismatchErrorMessage:()=>tg,getSparseReshapeInputOutputMultipleErrorMessage:()=>eg,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>Zm,getSparseReshapeNegativeOutputDimErrorMessage:()=>Jm,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>ty,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>X1,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>Es,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>cu,getUndoAxesPermutation:()=>Bd,isIdentityPermutation:()=>Km,log:()=>Rp,mergeRealAndImagArrays:()=>Wu,prepareAndValidate:()=>gm,prepareSplitSize:()=>Rf,segment_util:()=>B,shouldFuse:()=>vf,slice_util:()=>T,splitRealAndImagArrays:()=>Hh,tupleValuesAreOne:()=>Lu,upcastType:()=>_a,validateInput:()=>o0,validateUpdateShape:()=>a0,warn:()=>Pa});var j={};ae.r(j),ae.d(j,{nonMaxSuppressionV3Impl:()=>Xd,nonMaxSuppressionV4Impl:()=>qd,nonMaxSuppressionV5Impl:()=>Kd,whereImpl:()=>pf});var q={};ae.r(q),ae.d(q,{maxNorm:()=>ew,minMaxNorm:()=>Sy,nonNeg:()=>cg,unitNorm:()=>Kc});var Q={};ae.r(Q),ae.d(Q,{constant:()=>ow,glorotNormal:()=>fw,glorotUniform:()=>pw,heNormal:()=>mw,heUniform:()=>gw,identity:()=>hw,leCunNormal:()=>yw,leCunUniform:()=>y,ones:()=>aw,orthogonal:()=>r,randomNormal:()=>uw,randomUniform:()=>lw,truncatedNormal:()=>cw,varianceScaling:()=>dw,zeros:()=>sw});var ue={};ae.r(ue),ae.d(ue,{Layer:()=>Pe,RNN:()=>Ju,RNNCell:()=>$y,activation:()=>vM,add:()=>_M,alphaDropout:()=>c_,average:()=>CM,averagePooling1d:()=>yA,averagePooling2d:()=>vA,averagePooling3d:()=>bA,avgPool1d:()=>OM,avgPool2d:()=>UM,avgPool3d:()=>$M,avgPooling1d:()=>BM,avgPooling2d:()=>zM,avgPooling3d:()=>VM,batchNormalization:()=>DM,bidirectional:()=>n_,concatenate:()=>IM,conv1d:()=>uM,conv2d:()=>cM,conv2dTranspose:()=>hM,conv3d:()=>dM,conv3dTranspose:()=>pM,convLstm2d:()=>ZM,convLstm2dCell:()=>JM,cropping2D:()=>mM,dense:()=>bM,depthwiseConv2d:()=>yM,dot:()=>LM,dropout:()=>xM,elu:()=>rM,embedding:()=>MM,flatten:()=>AM,gaussianDropout:()=>u_,gaussianNoise:()=>l_,globalAveragePooling1d:()=>HM,globalAveragePooling2d:()=>GM,globalMaxPool1d:()=>i_,globalMaxPool2d:()=>s_,globalMaxPooling1d:()=>QE,globalMaxPooling2d:()=>ZE,gru:()=>jM,gruCell:()=>XM,input:()=>di,inputLayer:()=>nM,layerNormalization:()=>FM,leakyReLU:()=>sM,lstm:()=>qM,lstmCell:()=>KM,masking:()=>h_,maxPool1d:()=>a_,maxPool2d:()=>o_,maxPooling1d:()=>JE,maxPooling2d:()=>e2,maxPooling3d:()=>WM,maximum:()=>kM,minimum:()=>RM,multiply:()=>NM,permute:()=>TM,prelu:()=>aM,reLU:()=>iM,repeatVector:()=>EM,reshape:()=>SM,rnn:()=>e_,separableConv2d:()=>fM,simpleRNN:()=>YM,simpleRNNCell:()=>QM,softmax:()=>oM,spatialDropout1d:()=>wM,stackedRNNCells:()=>t_,thresholdedReLU:()=>lM,timeDistributed:()=>r_,upSampling2d:()=>gM,zeroPadding2d:()=>PM});var xe={};ae.r(xe),ae.d(xe,{MAPE:()=>A_,MSE:()=>T_,binaryAccuracy:()=>d_,binaryCrossentropy:()=>p_,categoricalAccuracy:()=>m_,categoricalCrossentropy:()=>g_,cosineProximity:()=>b_,mape:()=>E_,meanAbsoluteError:()=>x_,meanAbsolutePercentageError:()=>w_,meanSquaredError:()=>S_,mse:()=>M_,precision:()=>y_,recall:()=>v_,sparseCategoricalAccuracy:()=>f_});var Se={};ae.r(Se),ae.d(Se,{modelFromJSON:()=>$t});var be={};ae.r(be),ae.d(be,{l1:()=>C_,l1l2:()=>__,l2:()=>I_});var pe={};ae.r(pe),ae.d(pe,{json:()=>D_});var we={};ae.r(we),ae.d(we,{json:()=>F_});var he={};ae.r(he),ae.d(he,{json:()=>P_});var Ie={};ae.r(Ie),ae.d(Ie,{json:()=>O_});var Ae={};ae.r(Ae),ae.d(Ae,{json:()=>B_});var Ue={};ae.r(Ue),ae.d(Ue,{json:()=>U_});var Qe={};ae.r(Qe),ae.d(Qe,{json:()=>z_});var ht={};ae.r(ht),ae.d(ht,{json:()=>$_});var lt={};ae.r(lt),ae.d(lt,{json:()=>V_});var Et={};ae.r(Et),ae.d(Et,{json:()=>H_});var Mt={};ae.r(Mt),ae.d(Mt,{json:()=>G_});var ln={};ae.r(ln),ae.d(ln,{json:()=>W_});var Tn={};ae.r(Tn),ae.d(Tn,{json:()=>j_});var xn={};ae.r(xn),ae.d(xn,{json:()=>X_});var Qn={};ae.r(Qn),ae.d(Qn,{json:()=>q_});var Cn={};ae.r(Cn),ae.d(Cn,{json:()=>K_});var Mn={};ae.r(Mn),ae.d(Mn,{json:()=>Y_});var Ar={};ae.r(Ar),ae.d(Ar,{json:()=>Q_});var _i={};ae.r(_i),ae.d(_i,{json:()=>Z_});var si={};ae.r(si),ae.d(si,{CSVDataset:()=>C2,Dataset:()=>_g,FileDataSource:()=>L2,TextLineDataset:()=>T2,URLDataSource:()=>D2,array:()=>EC,csv:()=>RC,func:()=>NC,generator:()=>LC,microphone:()=>FC,version_data:()=>F2,webcam:()=>DC,zip:()=>SC});var mi={};ae.r(mi),ae.d(mi,{addImpl:()=>V2,bincountImpl:()=>HA,bincountReduceImpl:()=>q2,ceilImpl:()=>K2,concatImpl:()=>Y2,equalImpl:()=>J2,expImpl:()=>tS,expm1Impl:()=>rS,floorImpl:()=>aS,gatherNdImpl:()=>oS,gatherV2Impl:()=>lS,greaterEqualImpl:()=>cS,greaterImpl:()=>uS,lessEqualImpl:()=>dS,lessImpl:()=>hS,linSpaceImpl:()=>pS,logImpl:()=>fS,maxImpl:()=>mS,maximumImpl:()=>yS,minimumImpl:()=>vS,multiplyImpl:()=>GA,negImpl:()=>xS,notEqualImpl:()=>wS,prodImpl:()=>SS,rangeImpl:()=>TS,rsqrtImpl:()=>MS,sigmoidImpl:()=>GC,simpleAbsImpl:()=>G2,sliceImpl:()=>X2,sparseFillEmptyRowsImpl:()=>IS,sparseReshapeImpl:()=>kS,sparseSegmentReductionImpl:()=>YA,sqrtImpl:()=>k3,squaredDifferenceImpl:()=>RS,stridedSliceImpl:()=>NS,stringNGramsImpl:()=>LS,stringSplitImpl:()=>DS,stringToHashBucketFastImpl:()=>FS,subImpl:()=>iS,tileImpl:()=>PS,topKImpl:()=>BS,transposeImpl:()=>$A,uniqueImpl:()=>zS});class Qi{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Di{refCount(t){return Kr("refCount")}incRef(t){return Kr("incRef")}timerAvailable(){return!0}time(t){return Kr("time")}read(t){return Kr("read")}readSync(t){return Kr("readSync")}readToGPU(t,n){return Kr("readToGPU")}numDataIds(){return Kr("numDataIds")}disposeData(t,n){return Kr("disposeData")}write(t,n,s){return Kr("write")}move(t,n,s,a,l){return Kr("move")}memory(){return Kr("memory")}floatPrecision(){return Kr("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return Kr("dispose")}}function Kr(i){throw new Error(`'${i}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function Ci(i){let t=i.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,J(i,t,n)}function ss(i,t){if(i.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${i.length}Second array length was ${t.length}`);let n=i.length,s=0;for(;n>0;)s=Math.random()*n|0,n--,J(i,n,s),J(t,n,s)}function tn(i,t,n){return Math.max(i,Math.min(t,n))}function ye(i){return i%2==0?i:i+1}function J(i,t,n){let s=i[t];i[t]=i[n],i[n]=s}function Me(i){let t=0;for(let n=0;n<i.length;n++)t+=i[n];return t}function Ee(i,t){let n=Math.random();return t*n+(1-n)*i}function ke(i,t){let n=0;for(let s=0;s<i.length;s++){let a=Number(i[s])-Number(t[s]);n+=a*a}return n}function ee(i,t){if(!i)throw new Error(typeof t=="string"?t:t())}function ie(i,t,n=""){ee(Ye(i,t),()=>n+` Shapes ${i} and ${t} must match`)}function X(i){ee(i!=null,()=>"The input to the tensor constructor must be a non-null value.")}function te(i,t=[],n=!1){if(t==null&&(t=[]),Array.isArray(i)||ir(i)&&!n)for(let s=0;s<i.length;++s)te(i[s],t,n);else t.push(i);return t}function me(i){if(i.length===0)return 1;let t=i[0];for(let n=1;n<i.length;n++)t*=i[n];return t}function Le(i){return i.length===0}function Ye(i,t){if(i===t)return!0;if(i==null||t==null||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(i[n]!==t[n])return!1;return!0}function rt(i){return i%1==0}function Wt(i){if(Math.tanh!=null)return Math.tanh(i);if(i===1/0)return 1;if(i===-1/0)return-1;{let t=Math.exp(2*i);return(t-1)/(t+1)}}function mn(i){let t=Math.ceil(Math.sqrt(i));return[t,Math.ceil(i/t)]}function gn(i){let t=new Uint32Array(i);for(let n=0;n<i;++n)t[n]=n;return Ci(t),t}function _n(i,t){return t<=i.length?i:i+" ".repeat(t-i.length)}function In(i,t=s=>0,n){return new Promise((s,a)=>{let l=0,u=()=>{if(i())return void s();l++;let h=t(l);n!=null&&l>=n?a():setTimeout(u,h)};u()})}function Yr(i,t){let n=1,s=-1;for(let l=0;l<i.length;++l)if(i[l]>=0)n*=i[l];else if(i[l]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${l}`);s=l}else if(i[l]<0)throw Error(`Shapes can not be < 0. Found ${i[l]} at dim ${l}`);if(s===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${i}`);return i}if(n===0)throw Error(`Cannot infer the missing size in [${i}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);let a=i.slice();return a[s]=t/n,a}function Zn(i,t){let n=t.length;return ee((i=i==null?t.map((s,a)=>a):[].concat(i)).every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${i}`),ee(i.every(s=>rt(s)),()=>`All values in axis param must be integers but got axis ${i}`),i.map(s=>s<0?n+s:s)}function Ii(i,t){let n=[],s=[],a=t!=null&&Array.isArray(t)&&t.length===0,l=t==null||a?null:Zn(t,i).sort(),u=0;for(let h=0;h<i.length;++h){if(l!=null){if(l[u]===h&&i[h]!==1)throw new Error(`Can't squeeze axis ${h} since its dim '${i[h]}' is not 1`);(l[u]==null||l[u]>h)&&i[h]===1&&(n.push(i[h]),s.push(h)),l[u]<=h&&u++}i[h]!==1&&(n.push(i[h]),s.push(h))}return{newShape:n,keptDims:s}}function Pr(i,t){let n=null;if(i==null||i==="float32")n=new Float32Array(t);else if(i==="int32")n=new Int32Array(t);else{if(i!=="bool")throw new Error(`Unknown data type ${i}`);n=new Uint8Array(t)}return n}function St(i,t){let n=null;if(i==null||i==="float32")n=new Float32Array(t);else if(i==="int32")n=new Int32Array(t);else if(i==="bool")n=new Uint8Array(t);else{if(i!=="string")throw new Error(`Unknown data type ${i}`);n=new Array(t)}return n}function Kt(i,t){for(let n=0;n<i.length;n++){let s=i[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function vn(i){return i==="bool"||i==="complex64"||i==="float32"||i==="int32"||i==="string"}function cr(i,t){return!(t==="complex64"||t==="float32"&&i!=="complex64"||t==="int32"&&i!=="float32"&&i!=="complex64"||t==="bool"&&i==="bool")}function ir(i){return i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array||i instanceof Uint8ClampedArray}function xr(i){if(i==="float32"||i==="int32")return 4;if(i==="complex64")return 8;if(i==="bool")return 1;throw new Error(`Unknown dtype ${i}`)}function Ir(i){if(i==null)return 0;let t=0;return i.forEach(n=>t+=n.length),t}function Sr(i){return typeof i=="string"||i instanceof String}function gi(i){return typeof i=="boolean"}function yi(i){return typeof i=="number"}function hs(i){return Array.isArray(i)?hs(i[0]):i instanceof Float32Array?"float32":i instanceof Int32Array||i instanceof Uint8Array||i instanceof Uint8ClampedArray?"int32":yi(i)?"float32":Sr(i)?"string":gi(i)?"bool":"float32"}function ti(i){return!!(i&&i.constructor&&i.call&&i.apply)}function Vi(i,t){for(let n=t;n<i;++n)if(i%n==0)return n;return i}function Rn(i){let t=i.length;if(t<2)return[];let n=new Array(t-1);n[t-2]=i[t-1];for(let s=t-3;s>=0;--s)n[s]=n[s+1]*i[s+1];return n}function wo(i,t,n,s=!1){let a=new Array;if(t.length===1){let l=t[0]*(s?2:1);for(let u=0;u<l;u++)a[u]=n[i+u]}else{let l=t[0],u=t.slice(1),h=u.reduce((f,d)=>f*d)*(s?2:1);for(let f=0;f<l;f++)a[f]=wo(i+f*h,u,n,s)}return a}function Xi(i,t,n=!1){if(i.length===0)return t[0];let s=i.reduce((a,l)=>a*l)*(n?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${i}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return wo(0,i,t,n)}function Fi(i,t){let n=li(i,t);for(let s=0;s<n.length;s++)n[s]=1;return n}function li(i,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(i);if(t==="int32")return new Int32Array(i);if(t==="bool")return new Uint8Array(i);throw new Error(`Unknown data type ${t}`)}function aa(i,t){let n=i.reduce((s,a)=>s*a,1);if(t==null||t==="float32")return Xi(i,new Float32Array(n));if(t==="int32")return Xi(i,new Int32Array(n));if(t==="bool")return Xi(i,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function nc(i){i.forEach(t=>{ee(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${i}].`)})}function zs(i,t,n){if(t===0)return 0;if(t===1)return i[0];let s=i[i.length-1];for(let a=0;a<i.length-1;++a)s+=n[a]*i[a];return s}function $e(i,t,n){if(t===0)return[];if(t===1)return[i];let s=new Array(t);for(let a=0;a<s.length-1;++a)s[a]=Math.floor(i/n[a]),i-=s[a]*n[a];return s[s.length-1]=i,s}function et(i){return i&&i.then&&typeof i.then=="function"}class xt{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Vt,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(Ge().getBool("IS_TEST")||Ge().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${n}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,s){if(this.flagRegistry[t]={evaluationFn:n,setHook:s},this.urlFlags[t]!=null){let a=this.urlFlags[t];Ge().getBool("IS_TEST")||Ge().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${a}.`),this.set(t,a)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];let n=this.evaluateFlag(t);if(et(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(this.global===void 0||this.global.location===void 0||this.global.location.search===void 0)return;let t=this.getQueryParams(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach(n=>{let[s,a]=n.split(":");this.urlFlags[s]=function(l,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error(`Could not parse value flag value ${u} for flag ${l}.`)}(s,a)})}}function Vt(i){let t={};return i.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(function(a,l,u){a[decodeURIComponent(l)]=decodeURIComponent(u||"")}(t,s[0],s[1]),s.join("="))),t}function Ge(){return wn}let nn,wn=null;function qn(){if(nn==null){let i;if(typeof window<"u")i=window;else if(ae.g!==void 0)i=ae.g;else if(typeof process<"u")i=process;else{if(typeof self>"u")throw new Error("Could not find a global object");i=self}nn=i}return nn}function Sn(i,t){let n=function(){let s=qn();return s._tfGlobals==null&&(s._tfGlobals=new Map),s._tfGlobals}();if(n.has(i))return n.get(i);{let s=t();return n.set(i,s),n.get(i)}}let Xt="Abs",nr="Acos",yr="Acosh",Tr="Add",qi="AddN",ai="All",Vr="Any",ui="ArgMax",Zi="ArgMin",ks="Asin",Mr="Asinh",jr="Atan",Xr="Atanh",qs="Atan2",Bi="AvgPool",Ki="AvgPoolGrad",le="AvgPool3D",de="AvgPool3DGrad",_e="BatchMatMul",Ne="BatchToSpaceND",He="Bincount",ct="BroadcastTo",gt="BroadcastArgs",Yt="Cast",Qt="Ceil",At="ClipByValue",Pt="Complex",hn="ComplexAbs",zn="Concat",Kn="Conv2D",hr="Conv2DBackpropFilter",Rr="Conv2DBackpropInput",Nr="Conv3D",kr="Conv3DBackpropFilterV2",ki="Conv3DBackpropInputV2",Ji="Cos",vs="Cosh",Ei="Cumsum",Qr="CropAndResize",oa="DenseBincount",la="DepthToSpace",bs="DepthwiseConv2dNative",ua="DepthwiseConv2dNativeBackpropFilter",Ao="DepthwiseConv2dNativeBackpropInput",Eo="Diag",dl="Dilation2D",Pl="Dilation2DBackpropInput",Ol="Dilation2DBackpropFilter",Oo="RealDiv",Bl="Einsum",Bo="Elu",Ul="EluGrad",Uo="Erf",pl="Equal",zo="Exp",xs="ExpandDims",rd="Expm1",Jf="FFT",gp="Fill",vu="FlipLeftRight",fl="Floor",id="FloorDiv",yp="FusedBatchNorm",vp="GatherV2",em="GatherNd",bp="Greater",sd="GreaterEqual",ad="Identity",tm="IFFT",od="Imag",bu="IsFinite",to="IsInf",$s="IsNan",rc="LeakyRelu",ml="Less",xu="LessEqual",Da="LinSpace",Vs="Log",ic="Log1p",xp="LogicalAnd",wp="LogicalNot",wu="LogicalOr",av="LogSoftmax",Ap="LRN",nm="LRNGrad",Ep="Max",ld="Maximum",Sp="MaxPool",rm="MaxPoolGrad",Tp="MaxPool3D",im="MaxPool3DGrad",sm="MaxPoolWithArgmax",nh="Mean",ud="Min",rh="Minimum",Mp="MirrorPad",ih="Mod",un="Multinomial",Ts="Multiply",cd="Neg",_p="NotEqual",Au="NonMaxSuppressionV3",sc="NonMaxSuppressionV4",Cp="NonMaxSuppressionV5",Ga="OnesLike",ac="OneHot",sh="Pack",zl="PadV2",Hg="Pool",Fn="Pow",$l="Prelu",gl="Prod",am="Range",Rs="Real",oc="Reciprocal",Si="Relu",Ta="Reshape",hd="ResizeNearestNeighbor",ah="ResizeNearestNeighborGrad",Hs="ResizeBilinear",je="ResizeBilinearGrad",lc="Relu6",dd="Reverse",va="Round",no="Rsqrt",Vl="ScatterNd",oh="Select",yl="Selu",Hl="Slice",vl="Sin",So="Sinh",To="Sign",$o="Sigmoid",Gl="Softplus",Eu="Sqrt",uc="Sum",bl="SpaceToBatchND",lh="SplitV",Ip="Softmax",kp="SparseFillEmptyRows",uh="SparseReshape",pd="SparseSegmentMean",xl="SparseSegmentSum",Vo="SparseToDense",cc="SquaredDifference",ch="Square",wl="StridedSlice",fd="StringNGrams",hh="StringSplit",md="StringToHashBucketFast",Mo="Sub",Wn="Tan",Al="Tanh",Fa="Tile",om="TopK",lm="Transform",Ho="Transpose",dh="Unique",Ma="Unpack",gd="UnsortedSegmentSum",yd="ZerosLike",Go="Step",ph="FromPixels",um="RotateWithOffset",vd="_FusedMatMul",Wl="FusedConv2D",_o="FusedDepthwiseConv2D";function Pa(...i){Ge().getBool("IS_TEST")||Ge().getBool("PROD")||console.warn(...i)}function Rp(...i){Ge().getBool("IS_TEST")||Ge().getBool("PROD")||console.log(...i)}let bd=Sn("kernelRegistry",()=>new Map),Np=Sn("gradRegistry",()=>new Map);function Lp(i,t){let n=Fp(i,t);return bd.get(n)}function cm(i){return Np.get(i)}function Dp(i){let t=bd.entries(),n=[];for(;;){let{done:s,value:a}=t.next();if(s)break;let[l,u]=a,[h]=l.split("_");h===i&&n.push(u)}return n}function hm(i){let{kernelName:t,backendName:n}=i,s=Fp(t,n);bd.has(s)&&Pa(`The kernel '${t}' for backend '${n}' is already registered`),bd.set(s,i)}function Gg(i){let{kernelName:t}=i;Np.has(t)&&Ge().getBool("DEBUG")&&Pa(`Overriding the gradient for '${t}'`),Np.set(t,i)}function bi(i,t){let n=Fp(i,t);if(!bd.has(n))throw new Error(`The kernel '${i}' for backend '${t}' is not registered`);bd.delete(n)}function El(i){if(!Np.has(i))throw new Error(`The gradient '${i}' for backend is not registered`);Np.delete(i)}function Su(i,t){Dp(i).forEach(n=>{hm(Object.assign({},n,{backendName:t}))})}function Fp(i,t){return`${t}_${i}`}var jl=ae(3720);let Wo=ae.n(jl)()||jl;function Xl(i){return Wo.fromString(i,!0,16)}let Wg=Xl("c3a5c85c97cb3127"),Tu=Xl("b492b66fbe98f273"),ba=Xl("9ae16a3b2f90404f");function Pp(i){return i.xor(i.shru(47))}function Gs(i,t,n){let s=i.slice(t,t+n);return Wo.fromBytes(Array.from(s),!0,!0)}function as(i,t){return Gs(i,t,8)}function ca(i,t){return Gs(i,t,4)}function os(i,t){return t===0?i:i.shru(t).or(i.shl(64-t))}function Ui(i,t,n=Xl("9ddfea08eb382d69")){let s=i.xor(t).mul(n);s=s.xor(s.shru(47));let a=t.xor(s).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function fh(i,t,n,s){return function(a,l,u,h,f,d){f=f.add(a),d=os(d.add(f).add(h),21);let m=f;return f=(f=f.add(l)).add(u),d=d.add(os(f,44)),[f.add(h),d.add(m)]}(as(i,t),as(i,t+8),as(i,t+16),as(i,t+24),n,s)}function Ri(i,t=i.length){let n=Wo.fromNumber(81,!0);if(t<=32)return t<=16?function(x,R=x.length){if(R>=8){let N=ba.add(2*R),F=as(x,0).add(ba),H=as(x,R-8);return Ui(os(H,37).mul(N).add(F),os(F,25).add(H).mul(N),N)}if(R>=4){let N=ba.add(2*R);return Ui(ca(x,0).shl(3).add(R),ca(x,R-4),N)}if(R>0){let N=x[0]+(x[R>>1]<<8),F=R+(x[R-1]<<2);return Pp(ba.mul(N).xor(Wg.mul(F))).mul(ba)}return ba}(i,t):function(x,R=x.length){let N=ba.add(2*R),F=as(x,0).mul(Tu),H=as(x,8),W=as(x,R-8).mul(N),G=as(x,R-16).mul(ba);return Ui(os(F.add(H),43).add(os(W,30)).add(G),F.add(os(H.add(ba),18)).add(W),N)}(i,t);if(t<=64)return function(x,R=x.length){let N=ba.add(2*R),F=as(x,0).mul(ba),H=as(x,8),W=as(x,R-8).mul(N),G=as(x,R-16).mul(ba),se=os(F.add(H),43).add(os(W,30)).add(G),ge=Ui(se,F.add(os(H.add(ba),18)).add(W),N),Ce=as(x,16).mul(N),Be=as(x,24),Ve=se.add(as(x,R-32)).mul(N),ze=ge.add(as(x,R-24)).mul(N);return Ui(os(Ce.add(Be),43).add(os(Ve,30)).add(ze),Ce.add(os(Be.add(F),18)).add(Ve),N)}(i,t);let s=n,a=n.mul(Tu).add(113),l=Pp(a.mul(ba).add(113)).mul(ba),u=[Wo.UZERO,Wo.UZERO],h=[Wo.UZERO,Wo.UZERO];s=s.mul(ba).add(as(i,0));let f=0,d=64*(t-1>>6),m=d+(t-1&63)-63;do s=os(s.add(a).add(u[0]).add(as(i,f+8)),37).mul(Tu),a=os(a.add(u[1]).add(as(i,f+48)),42).mul(Tu),s=s.xor(h[1]),a=a.add(u[0]).add(as(i,f+40)),l=os(l.add(h[0]),33).mul(Tu),u=fh(i,f,u[1].mul(Tu),s.add(h[0])),h=fh(i,f+32,l.add(h[1]),a.add(as(i,f+16))),[l,s]=[s,l],f+=64;while(f!==d);let g=Tu.add(l.and(255).shl(1));return f=m,h[0]=h[0].add(t-1&63),u[0]=u[0].add(h[0]),h[0]=h[0].add(u[0]),s=os(s.add(a).add(u[0]).add(as(i,f+8)),37).mul(g),a=os(a.add(u[1]).add(as(i,f+48)),42).mul(g),s=s.xor(h[1].mul(9)),a=a.add(u[0].mul(9).add(as(i,f+40))),l=os(l.add(h[0]),33).mul(g),u=fh(i,f,u[1].mul(g),s.add(h[0])),h=fh(i,f+32,l.add(h[1]),a.add(as(i,f+16))),[l,s]=[s,l],Ui(Ui(u[0],h[0],g).add(Pp(a).mul(Wg)).add(l),Ui(u[1],h[1],g).add(s),g)}function ql(i,t){return t==="string"?Co(i):Mu([i],t)}function Mu(i,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(i)&&(i=te(i)),Ge().getBool("DEBUG")&&Kt(i,t),function(n,s){return n instanceof Float32Array&&s==="float32"||n instanceof Int32Array&&s==="int32"||n instanceof Uint8Array&&s==="bool"}(i,t))return i;if(t==null||t==="float32"||t==="complex64")return new Float32Array(i);if(t==="int32")return new Int32Array(i);if(t==="bool"){let n=new Uint8Array(i.length);for(let s=0;s<n.length;++s)Math.round(i[s])!==0&&(n[s]=1);return n}throw new Error(`Unknown data type ${t}`)}function ha(){return Ge().platform.now()}function jg(i,t){return Ge().platform.fetch(i,t)}function Co(i,t="utf-8"){return t=t||"utf-8",Ge().platform.encode(i,t)}function hc(i,t="utf-8"){return t=t||"utf-8",Ge().platform.decode(i,t)}class dm{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new lr)}profileKernel(t,n,s){let a,l=()=>{a=s()},u,h=ha();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(l);else{l();for(let f of a)f.dataSync();u=Promise.resolve({kernelMs:ha()-h})}if(Ge().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let f=0;f<a.length;f++){let d=a[f];d.data().then(m=>{ov(m,d.dtype,t)})}return{kernelName:t,outputs:a,inputs:n,timeMs:u.then(f=>f.kernelMs),extraInfo:u.then(f=>f.getExtraProfileInfo!=null?f.getExtraProfileInfo():"")}}logKernelProfile(t){let{kernelName:n,outputs:s,timeMs:a,inputs:l,extraInfo:u}=t;s.forEach(h=>{Promise.all([h.data(),a,u]).then(f=>{this.logger.logKernelProfile(n,h,f[0],f[1],l,f[2])})})}}function ov(i,t,n){if(t!=="float32")return!1;for(let s=0;s<i.length;s++){let a=i[s];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${n}'`),!0}return!1}class lr{logKernelProfile(t,n,s,a,l,u){let h=typeof a=="number"?_n(`${a}ms`,9):a.error,f=_n(t,25),d=n.rank,m=n.size,g=_n(n.shape.toString(),14),x="";for(let R in l){let N=l[R];if(N!=null){let F=N.shape||n.shape,H=F.length;x+=`${R}: ${H}D ${H>0?F:""} `}}console.log(`%c${f}	%c${h}	%c${d}D ${g}	%c${m}	%c${x}	%c${u}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function lv(i,t,n,s){let a=Rn(t),l=function(d,m,g,x){let R=me(m),N=x[x.length-1],F=new Array(N).fill(0),H=m.length,W=g==="complex64"?Kl(d):d;if(H>1)for(let G=0;G<R/N;G++){let se=G*N;for(let ge=0;ge<N;ge++)F[ge]=Math.max(F[ge],Op(W[se+ge],0,g).length)}return F}(i,t,n,a),u=t.length,h=xd(i,t,n,a,l),f=["Tensor"];return s&&(f.push(`  dtype: ${n}`),f.push(`  rank: ${u}`),f.push(`  shape: [${t}]`),f.push("  values:")),f.push(h.map(d=>"    "+d).join(`
`)),f.join(`
`)}function Op(i,t,n){let s;return s=Array.isArray(i)?`${parseFloat(i[0].toFixed(7))} + ${parseFloat(i[1].toFixed(7))}j`:Sr(i)?`'${i}'`:n==="bool"?Io(i):parseFloat(i.toFixed(7)).toString(),_n(s,t)}function Io(i){return i===0?"false":"true"}function xd(i,t,n,s,a,l=!0){let u=n==="complex64"?2:1,h=t[0],f=t.length;if(f===0)return n==="complex64"?[Op(Kl(i)[0],0,n)]:n==="bool"?[Io(i[0])]:[i[0].toString()];if(f===1){if(h>20){let F=3*u,H=Array.from(i.slice(0,F)),W=Array.from(i.slice((h-3)*u,h*u));return n==="complex64"&&(H=Kl(H),W=Kl(W)),["["+H.map((G,se)=>Op(G,a[se],n)).join(", ")+", ..., "+W.map((G,se)=>Op(G,a[h-3+se],n)).join(", ")+"]"]}return["["+(n==="complex64"?Kl(i):Array.from(i)).map((F,H)=>Op(F,a[H],n)).join(", ")+"]"]}let d=t.slice(1),m=s.slice(1),g=s[0]*u,x=[];if(h>20){for(let F=0;F<3;F++){let H=F*g,W=H+g;x.push(...xd(i.slice(H,W),d,n,m,a,!1))}x.push("...");for(let F=h-3;F<h;F++){let H=F*g,W=H+g;x.push(...xd(i.slice(H,W),d,n,m,a,F===h-1))}}else for(let F=0;F<h;F++){let H=F*g,W=H+g;x.push(...xd(i.slice(H,W),d,n,m,a,F===h-1))}let R=f===2?",":"";x[0]="["+x[0]+R;for(let F=1;F<x.length-1;F++)x[F]=" "+x[F]+R;let N=`,
`;for(let F=2;F<f;F++)N+=`
`;return x[x.length-1]=" "+x[x.length-1]+"]"+(l?"":N),x}function Kl(i){let t=[];for(let n=0;n<i.length;n+=2)t.push([i[n],i[n+1]]);return t}class Hi{constructor(t,n,s){if(this.dtype=n,this.shape=t.slice(),this.size=me(t),s!=null){let a=s.length;ee(a===this.size,()=>`Length of values '${a}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||St(n,this.size),this.strides=Rn(t)}set(t,...n){n.length===0&&(n=[0]),ee(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);let s=this.locToIndex(n);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(let a of t){if(a<0||a>=this.shape[n]){let l=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(l)}n++}let s=t[t.length-1];for(let a=0;a<t.length-1;++a)s+=this.strides[a]*t[a];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let s=0;s<t.length-1;++s)n+=this.strides[s]*t[s];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];let n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(t/this.strides[s]),t-=n[s]*this.strides[s];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return Wa().makeTensor(this.values,this.shape,this.dtype)}}let Wa=null,Ns=null,Or=null;class Ni{constructor(t,n,s,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=me(t),this.strides=Rn(t),this.dataId=s,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let t=await this.data();return Ns.buffer(this.shape,this.dtype,t)}bufferSync(){return Ns.buffer(this.shape,this.dtype,this.dataSync())}async array(){let t=await this.data();return Xi(this.shape,t,this.dtype==="complex64")}arraySync(){return Xi(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let t=Wa().read(this.dataId);if(this.dtype==="string"){let n=await t;try{return n.map(s=>hc(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),Wa().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();let t=Wa().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>hc(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();let t=await Wa().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(Wa().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Ns.print(this,t)}clone(){return this.throwIfDisposed(),Ns.clone(this)}toString(t=!1){return lv(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Ns.cast(this,t)}variable(t=!0,n,s){return this.throwIfDisposed(),Wa().makeVariable(this,t,n,s)}}function Bt(){return Sn("Tensor",()=>Ni)}Object.defineProperty(Ni,Symbol.hasInstance,{value:i=>!!i&&i.data!=null&&i.dataSync!=null&&i.throwIfDisposed!=null}),Bt();class mh extends Ni{constructor(t,n,s,a){super(t.shape,t.dtype,t.dataId,a),this.trainable=n,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Ye(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Wa().disposeTensor(this),this.dataId=t.dataId,Wa().incRef(this,null)}dispose(){Wa().disposeVariable(this),this.isDisposedInternal=!0}}var Yl,Ql,Zl,Bp,Up;Object.defineProperty(mh,Symbol.hasInstance,{value:i=>i instanceof Ni&&i.assign!=null&&i.assign instanceof Function}),function(i){i.R0="R0",i.R1="R1",i.R2="R2",i.R3="R3",i.R4="R4",i.R5="R5",i.R6="R6"}(Yl||(Yl={})),function(i){i.float32="float32",i.int32="int32",i.bool="int32",i.complex64="complex64"}(Ql||(Ql={})),function(i){i.float32="float32",i.int32="int32",i.bool="bool",i.complex64="complex64"}(Zl||(Zl={})),function(i){i.float32="float32",i.int32="float32",i.bool="float32",i.complex64="complex64"}(Bp||(Bp={})),function(i){i.float32="complex64",i.int32="complex64",i.bool="complex64",i.complex64="complex64"}(Up||(Up={}));let Xg={float32:Bp,int32:Ql,bool:Zl,complex64:Up};function _a(i,t){if(i==="string"||t==="string"){if(i==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${i} with ${t}`)}return Xg[i][t]}function gh(i){return _a(i,"int32")}function ls(i,t){if(i.dtype===t.dtype)return[i,t];let n=_a(i.dtype,t.dtype);return[i.cast(n),t.cast(n)]}function zp(i,t){ee(i.dtype===t.dtype,()=>`The dtypes of the first(${i.dtype}) and second(${t.dtype}) input must match`)}function yh(i,t){return t.some(n=>n.id===i.id)}function jo(i){let t=[];return pm(i,t,new Set),t}function pm(i,t,n){if(i==null)return;if(i instanceof Ni)return void t.push(i);if(s=i,!Array.isArray(s)&&typeof s!="object")return;var s;let a=i;for(let l in a){let u=a[l];n.has(u)||(n.add(u),pm(u,t,n))}}function wd(i){return i.kernelName!=null}class Ks{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(let t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Ad{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ks}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let s=t[n];if(await this.initializeBackend(s).success)return void await this.setBackend(s)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{let{asyncInit:n}=this.initializeBackend(t);if(n)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,s=1){return t in this.registryFactory?(Pa(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;let{success:n,asyncInit:s}=this.initializeBackend(t);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new dm(this.backendInstance),!0}setupRegisteredKernels(){Dp(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){Dp(t).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[t])})}initializeBackend(t){let n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{let s=n.factory();if(!s||s instanceof Di||typeof s.then!="function")return this.registry[t]=s,{success:!0,asyncInit:!1};{let a=++this.pendingBackendInitId,l=s.then(u=>!(a<this.pendingBackendInitId||(this.registry[t]=u,this.pendingBackendInit=null,0))).catch(u=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Pa(`Initialization of backend ${t} failed`),Pa(u.stack||u.message)),!1));return this.pendingBackendInit=l,{success:l,asyncInit:!0}}}catch(s){return Pa(`Initialization of backend ${t} failed`),Pa(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let s=t[n],{success:a,asyncInit:l}=this.initializeBackend(s);if(l||a)return{name:s,asyncInit:l}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){let s=this.state.tensorInfo.get(n),a=s.backend,l=this.readSync(n),u=a.refCount(n);a.disposeData(n,!0),s.backend=t,t.move(n,l,s.shape,s.dtype,u),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let s,a=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=t}return this.scopedRun(()=>this.startScope(a),()=>this.endScope(s),()=>(s=n(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(t,n,s){t();try{let a=s();return n(),a}catch(a){throw n(),a}}nextTensorId(){return Ad.nextTensorId++}nextVariableId(){return Ad.nextVariableId++}clone(t){let n=st.runKernel(ad,{x:t}),s={x:t};return this.addTapeNode(this.state.activeScope.name,s,[n],a=>({x:()=>{let l={x:a};return st.runKernel(Yt,l,{dtype:"float32"})}}),[],{}),n}runKernel(t,n,s){if(this.backendName==null&&this.backend,Lp(t,this.backendName)==null)throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,s){let a=this.backend.numDataIds(),l=0;s.forEach(f=>{l+=f.dtype==="complex64"?3:1});let u=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],h=a-n-l-u;if(h>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${h} data ids) after running '${t}'`)}runKernelFunc(t){let n,s=[],a=this.isTapeOn(),l=this.state.numBytes,u=this.state.numTensors,h,f;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),this.backendName==null&&this.backend;let d=wd(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(wd(t)){let{kernelName:N,inputs:F,attrs:H}=t;this.backendName==null&&this.backend;let W=Lp(N,this.backendName);ee(W!=null,()=>`Cannot find registered kernel '${N}' for backend '${this.backendName}'`),h=()=>{let G=this.backend.numDataIds();f=W.kernelFunc({inputs:F,attrs:H,backend:this.backend});let se=Array.isArray(f)?f:[f];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(N,G,se);let ge=se.map(Ce=>{if(Ce.rank!=null)return Ce;let{dataId:Be,shape:Ve,dtype:ze}=Ce;return this.makeTensorFromDataId(Be,Ve,ze)});if(a){let Ce=this.getTensorsForGradient(N,F,ge);s=this.saveTensorsForBackwardMode(Ce)}return ge}}else{let{forwardFunc:N}=t,F=H=>{a&&(s=H.map(W=>this.keep(this.clone(W))))};h=()=>{let H=this.backend.numDataIds();f=this.tidy(()=>N(this.backend,F));let W=Array.isArray(f)?f:[f];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,H,W),W}}let{inputs:m,attrs:g}=t,x=wd(t)?null:t.backwardsFunc,R;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(R=this.profiler.profileKernel(d,m,()=>h()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(R),n=R.outputs):n=h()}),a&&this.addTapeNode(d,m,n,x,s,g),this.state.profiling&&this.state.activeProfile.kernels.push({name:d,bytesAdded:this.state.numBytes-l,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(m).map(N=>m[N]!=null?m[N].shape:null),outputShapes:n.map(N=>N.shape),kernelTimeMs:R.timeMs,extraInfo:R.extraInfo}),Array.isArray(f)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(t,n,s){let a=cm(t);if(a!=null){let l=a.inputsToSave||[],u=a.outputsToSave||[],h;a.saveAllInputs?(ee(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),h=Object.keys(n).map(d=>n[d])):h=l.map(d=>n[d]);let f=s.filter((d,m)=>u[m]);return h.concat(f)}return[]}makeTensor(t,n,s,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",a=a||this.backend;let l=t;s==="string"&&Sr(t[0])&&(l=t.map(f=>Co(f)));let u=a.write(l,n,s),h=new Ni(n,s,u,this.nextTensorId());if(this.trackTensor(h,a),s==="string"){let f=this.state.tensorInfo.get(u),d=Ir(l);this.state.numBytes+=d-f.bytes,f.bytes=d}return h}makeTensorFromDataId(t,n,s,a){let l=new Ni(n,s=s||"float32",t,this.nextTensorId());return this.trackTensor(l,a),l}makeVariable(t,n=!0,s,a){s=s||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.cast(a));let l=new mh(t,n,s,this.nextTensorId());if(this.state.registeredVariables[l.name]!=null)throw new Error(`Variable with name ${l.name} was already registered`);return this.state.registeredVariables[l.name]=l,this.incRef(l,this.backend),l}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*xr(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof mh||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;let n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){let s=t.size*xr(t.dtype);this.state.numBytes-=s}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(let t in this.state.registeredVariables){let n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){let t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;let n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,s,a,l,u){let h={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:s,saved:l},f=cm(t);f!=null&&(a=f.gradFunc),a!=null&&(h.gradient=d=>(d=d.map((m,g)=>{if(m==null){let x=s[g],R=li(x.size,x.dtype);return this.makeTensor(R,x.shape,x.dtype)}return m}),a(d.length>1?d:d[0],l,u))),this.state.activeTape.push(h)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){let n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){let n=jo(t),s=new Set(n.map(l=>l.id));for(let l=0;l<this.state.activeScope.track.length;l++){let u=this.state.activeScope.track[l];u.kept||s.has(u.id)||u.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(l=>{l.kept||l.scopeId!==a.id||this.track(l)})}gradients(t,n,s,a=!1){if(ee(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);let l=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));ee(l instanceof Ni,()=>"The result y returned by f() must be a tensor.");let u=function(h,f,d){let m={},g={};for(let F=0;F<f.length;F++)m[f[F].id]=!0;for(let F=0;F<h.length;F++){let H=h[F],W=H.inputs;for(let G in W){let se=W[G],ge=!1;for(let Ce=0;Ce<f.length;Ce++)if(m[se.id]){H.outputs.forEach(Be=>m[Be.id]=!0),ge=!0,g[H.id]=!0;break}if(ge)break}}let x={};x[d.id]=!0;let R={};for(let F=h.length-1;F>=0;F--){let H=h[F],W=H.inputs;for(let G=0;G<H.outputs.length;G++)if(x[H.outputs[G].id]){for(let se in W)x[W[se].id]=!0,R[H.id]=!0;break}}let N=[];for(let F=0;F<h.length;F++){let H=h[F];if(g[H.id]&&R[H.id]){let W={};for(let se in H.inputs){let ge=H.inputs[se];m[ge.id]&&(W[se]=ge)}let G=Object.assign({},H);G.inputs=W,G.outputs=H.outputs,N.push(G)}}return N}(this.state.activeTape,n,l);if(!a&&u.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let h={};h[l.id]=s??function(d){let m=Fi(me(d),"float32");return st.makeTensor(m,d,"float32")}(l.shape),function(d,m,g,x){for(let R=m.length-1;R>=0;R--){let N=m[R],F=[];if(N.outputs.forEach(W=>{let G=d[W.id];G!=null?F.push(G):F.push(null)}),N.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${N.kernelName}.`);let H=N.gradient(F);for(let W in N.inputs){if(!(W in H))throw new Error(`Cannot backprop through input ${W}. Available gradients found: ${Object.keys(H)}.`);let G=g(()=>H[W]());if(G.dtype!=="float32")throw new Error(`Error in gradient for op ${N.kernelName}. The gradient of input ${W} must have 'float32' dtype, but has '${G.dtype}'`);let se=N.inputs[W];if(!Ye(G.shape,se.shape))throw new Error(`Error in gradient for op ${N.kernelName}. The gradient of input '${W}' has shape '${G.shape}', which does not match the shape of the input '${se.shape}'`);if(d[se.id]==null)d[se.id]=G;else{let ge=d[se.id];d[se.id]=x(ge,G),ge.dispose()}}}}(h,u,d=>this.tidy(d),Ed);let f=n.map(d=>h[d.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(d=>{for(let m of d.saved)m.dispose()}),this.state.activeTape=null),{value:l,grads:f}})}customGrad(t){return ee(ti(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{let s;ee(n.every(l=>l instanceof Ni),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let a={};return n.forEach((l,u)=>{a[u]=l}),this.runKernelFunc({forwardFunc:(l,u)=>(s=t(...n,u),ee(s.value instanceof Ni,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ee(ti(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),backwardsFunc:(l,u)=>{let h=s.gradFunc(l,u),f=Array.isArray(h)?h:[h];ee(f.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ee(f.every(m=>m instanceof Ni),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let d={};return f.forEach((m,g)=>{d[g]=()=>m}),d},inputs:a})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){let n=ha(),s=await this.backend.time(t);return s.wallMs=ha()-n,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ks;for(let t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function $p(){let i=qn();if(i._tfengine==null){let n=new xt(i);i._tfengine=new Ad(n)}var t;return t=i._tfengine.ENV,wn=t,Wa=()=>i._tfengine,i._tfengine}Ad.nextTensorId=0,Ad.nextVariableId=0;let st=$p();function Ed(i,t){let n={a:i,b:t};return st.runKernel(Tr,n)}let xa;function uv(i){xa=i}function qg(i){if(xa!==void 0)return xa;if(i||typeof navigator<"u"&&navigator!=null){if(i||(i=navigator),i.product==="ReactNative")return!0;let t=i.userAgent||i.vendor||(typeof window<"u"?window.opera:"");if(!t){let n=i;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Kg(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}let da=Ge();function ro(i,t){let n=i;if(ir(i))return t==="string"?[]:[i.length];if(!Array.isArray(i))return[];let s=[];for(;Array.isArray(n)||ir(n)&&t!=="string";)s.push(n.length),n=n[0];return Array.isArray(i)&&Ge().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Ys(i,s,[]),s}function Ys(i,t,n){if(n=n||[],!Array.isArray(i)&&!ir(i))return void ee(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);ee(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${i.length} elements`),ee(i.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${i.length} elements`);let s=t.slice(1);for(let a=0;a<i.length;++a)Ys(i[a],s,n.concat(a))}function vh(i,t,n,s){if(i!=="string_or_numeric"){if(i==null)throw new Error("Expected dtype cannot be null.");if(i!=="numeric"&&i!==t||i==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${i} tensor, but got ${t} tensor`)}}function Oe(i,t,n,s="numeric"){if(i instanceof Ni)return vh(s,i.dtype,t,n),i;let a=hs(i);if(a!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(a=s),vh(s,a,t,n),i==null||!ir(i)&&!Array.isArray(i)&&typeof i!="number"&&typeof i!="boolean"&&typeof i!="string"){let h=i==null?"null":i.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${h}'`)}let l=ro(i,a);ir(i)||Array.isArray(i)||(i=[i]);let u=a!=="string"?Mu(i,a):te(i,[],!0);return st.makeTensor(u,l,a)}function dc(i,t,n,s="numeric"){if(!Array.isArray(i))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return i.map((a,l)=>Oe(a,`${t}[${l}]`,n,s))}da.registerFlag("DEBUG",()=>!1,i=>{i&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),da.registerFlag("IS_BROWSER",()=>Kg()),da.registerFlag("IS_NODE",()=>typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0),da.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),da.registerFlag("PROD",()=>!1),da.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>da.getBool("DEBUG")),da.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),da.registerFlag("IS_TEST",()=>!1),da.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0),da.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);let bh="__op";function at(i){let t=Object.keys(i);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0],s=i[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=bh;let a=(...l)=>{st.startScope(n);try{let u=s(...l);return et(u)&&console.error("Cannot return a Promise inside of tidy."),st.endScope(u),u}catch(u){throw st.endScope(null),u}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}let Jl=at({complex_:function(i,t){let n=Oe(i,"real","complex"),s=Oe(t,"imag","complex");ie(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);let a={real:n,imag:s};return st.runKernel(Pt,a)}});function pc(i,t,n,s){if(s==null&&(s=hs(i)),s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ir(i)&&!Array.isArray(i)&&typeof i!="number"&&typeof i!="boolean"&&typeof i!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){nc(t);let a=me(t),l=me(n);ee(a===l,()=>`Based on the provided shape, [${t}], the tensor should have ${a} values but has ${l}`);for(let u=0;u<n.length;++u){let h=n[u],f=u!==n.length-1||h!==me(t.slice(u));ee(n[u]===t[u]||!f,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return ir(i)||Array.isArray(i)||(i=[i]),t=t||n,i=s!=="string"?Mu(i,s):te(i,[],!0),st.makeTensor(i,t,s)}function Xo(i,t,n){return pc(i,t,ro(i,n),n)}let qo={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function fc(i,t){let n=[],s=[],a=Array.isArray(i)?i.map(l=>l.name):Object.keys(i);for(let l=0;l<a.length;++l){let u=a[l],h=Array.isArray(i)?i[l].tensor:i[u];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${u}': ${h.dtype}`);let f={name:u,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){let d=new Promise(async m=>{let g=await h.bytes(),x=g.reduce((F,H)=>F+H.length,0)+4*g.length,R=new Uint8Array(x),N=0;for(let F=0;F<g.length;F++){let H=g[F],W=new Uint8Array(new Uint32Array([H.length]).buffer);R.set(W,N),N+=4,R.set(H,N),N+=H.length}m(R)});s.push(d)}else s.push(h.data());t!=null&&(f.group=t),n.push(f)}return{data:Vp(await Promise.all(s)),specs:n}}function xh(i,t){let n={},s,a=0;for(let l of t){let u=l.name,h=l.dtype,f=l.shape,d=me(f),m;if("quantization"in l){let g=l.quantization;if(g.dtype==="uint8"||g.dtype==="uint16"){if(!("min"in g)||!("scale"in g))throw new Error(`Weight ${l.name} with quantization ${g.dtype} doesn't have corresponding metadata min and scale.`)}else{if(g.dtype!=="float16")throw new Error(`Weight ${l.name} has unknown quantization dtype ${g.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if(h!=="float32")throw new Error(`Weight ${l.name} is quantized with ${g.dtype} which only supports weights of type float32 not ${h}.`)}let x=qo[g.dtype],R=i.slice(a,a+d*x),N=g.dtype==="uint8"?new Uint8Array(R):new Uint16Array(R);if(h==="float32")if(g.dtype==="uint8"||g.dtype==="uint16"){m=new Float32Array(N.length);for(let F=0;F<N.length;F++){let H=N[F];m[F]=H*g.scale+g.min}}else{if(g.dtype!=="float16")throw new Error(`Unsupported quantization type ${g.dtype} for weight type float32.`);s===void 0&&(s=Wx()),m=s(N)}else{if(h!=="int32")throw new Error(`Unsupported dtype in weight '${u}': ${h}`);if(g.dtype!=="uint8"&&g.dtype!=="uint16")throw new Error(`Unsupported quantization type ${g.dtype} for weight type int32.`);m=new Int32Array(N.length);for(let F=0;F<N.length;F++){let H=N[F];m[F]=Math.round(H*g.scale+g.min)}}a+=d*x}else if(h==="string"){let g=me(l.shape);m=[];for(let x=0;x<g;x++){let R=new Uint32Array(i.slice(a,a+4))[0];a+=4;let N=new Uint8Array(i.slice(a,a+R));m.push(N),a+=R}}else{let g=qo[h],x=i.slice(a,a+d*g);if(h==="float32")m=new Float32Array(x);else if(h==="int32")m=new Int32Array(x);else if(h==="bool")m=new Uint8Array(x);else{if(h!=="complex64")throw new Error(`Unsupported dtype in weight '${u}': ${h}`);{m=new Float32Array(x);let R=new Float32Array(m.length/2),N=new Float32Array(m.length/2);for(let W=0;W<R.length;W++)R[W]=m[2*W],N[W]=m[2*W+1];let F=Xo(R,f,"float32"),H=Xo(N,f,"float32");n[u]=Jl(F,H),F.dispose(),H.dispose()}}a+=d*g}h!=="complex64"&&(n[u]=Xo(m,f,h))}return n}function Vp(i){if(i===null)throw new Error(`Invalid input value: ${JSON.stringify(i)}`);let t=0,n=[];i.forEach(l=>{if(t+=l.byteLength,n.push(l.byteLength===l.buffer.byteLength?l:new l.constructor(l)),!(l instanceof Float32Array||l instanceof Int32Array||l instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${l.constructor.name}`)});let s=new Uint8Array(t),a=0;return n.forEach(l=>{s.set(new Uint8Array(l.buffer),a),a+=l.byteLength}),s.buffer}let Hp=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function cv(i){return Hp?Buffer.byteLength(i):new Blob([i]).size}function eu(i){if(i.length===1)return i[0];let t=0;i.forEach(a=>{t+=a.byteLength});let n=new Uint8Array(t),s=0;return i.forEach(a=>{n.set(new Uint8Array(a),s),s+=a.byteLength}),n.buffer}function hv(i){for(i=i.trim();i.endsWith("/");)i=i.slice(0,i.length-1);let t=i.split("/");return t[t.length-1]}function dv(i,t){let n={modelTopology:i.modelTopology,format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,weightsManifest:t};return i.signature!=null&&(n.signature=i.signature),i.userDefinedMetadata!=null&&(n.userDefinedMetadata=i.userDefinedMetadata),i.modelInitializer!=null&&(n.modelInitializer=i.modelInitializer),i.trainingConfig!=null&&(n.trainingConfig=i.trainingConfig),n}async function Yg(i,t){let n={modelTopology:i.modelTopology,format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy};if(i.trainingConfig!=null&&(n.trainingConfig=i.trainingConfig),i.weightsManifest!=null){let[s,a]=await t(i.weightsManifest);n.weightSpecs=s,n.weightData=a}return i.signature!=null&&(n.signature=i.signature),i.userDefinedMetadata!=null&&(n.userDefinedMetadata=i.userDefinedMetadata),i.modelInitializer!=null&&(n.modelInitializer=i.modelInitializer),n}function Gp(i){if(i.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:i.modelTopology==null?0:cv(JSON.stringify(i.modelTopology)),weightSpecsBytes:i.weightSpecs==null?0:cv(JSON.stringify(i.weightSpecs)),weightDataBytes:i.weightData==null?0:i.weightData.byteLength}}function Wx(){let i=function(){let s=l=>{let u=l<<13,h=0;for(;(8388608&u)==0;)h-=8388608,u<<=1;return u&=-8388609,h+=947912704,u|h},a=new Uint32Array(2048);a[0]=0;for(let l=1;l<1024;l++)a[l]=s(l);for(let l=1024;l<2048;l++)a[l]=939524096+(l-1024<<13);return a}(),t=function(){let s=new Uint32Array(64);s[0]=0,s[31]=1199570944,s[32]=2147483648,s[63]=3347054592;for(let a=1;a<31;a++)s[a]=a<<23;for(let a=33;a<63;a++)s[a]=2147483648+(a-32<<23);return s}(),n=function(){let s=new Uint32Array(64);for(let a=0;a<64;a++)s[a]=1024;return s[0]=s[32]=0,s}();return s=>{let a=new ArrayBuffer(4*s.length),l=new Uint32Array(a);for(let u=0;u<s.length;u++){let h=s[u],f=i[n[h>>10]+(1023&h)]+t[h>>10];l[u]=f}return new Float32Array(a)}}class Ms{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ms.instance==null&&(Ms.instance=new Ms),Ms.instance}static registerSaveRouter(t){Ms.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Ms.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Ms.getHandlers(t,"save")}static getLoadHandlers(t,n){return Ms.getHandlers(t,"load",n)}static getHandlers(t,n,s){let a=[];return(n==="load"?Ms.getInstance().loadRouters:Ms.getInstance().saveRouters).forEach(l=>{let u=l(t,s);u!==null&&a.push(u)}),a}}let jx=i=>Ms.registerSaveRouter(i),Xx=i=>Ms.registerLoadRouter(i),Qg=i=>Ms.getSaveHandlers(i),Zg=(i,t)=>Ms.getLoadHandlers(i,t),Jg="tensorflowjs",wh="models_store",mc="model_info_store";function pv(){if(!Ge().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let i=typeof window>"u"?self:window,t=i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB||i.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function e0(i){let t=i.result;t.createObjectStore(wh,{keyPath:"modelPath"}),t.createObjectStore(mc,{keyPath:"modelPath"})}class Ah{constructor(t){if(this.indexedDB=pv(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((s,a)=>{let l=this.indexedDB.open(Jg,1);l.onupgradeneeded=()=>e0(l),l.onsuccess=()=>{let u=l.result;if(n==null){let h=u.transaction(wh,"readonly"),f=h.objectStore(wh).get(this.modelPath);f.onsuccess=()=>{if(f.result==null)return u.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(f.result.modelArtifacts)},f.onerror=d=>(u.close(),a(f.error)),h.oncomplete=()=>u.close()}else{let h=Gp(n),f=u.transaction(mc,"readwrite"),d=f.objectStore(mc),m=d.put({modelPath:this.modelPath,modelArtifactsInfo:h}),g;m.onsuccess=()=>{g=u.transaction(wh,"readwrite");let x=g.objectStore(wh).put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:h});x.onsuccess=()=>s({modelArtifactsInfo:h}),x.onerror=R=>{d=f.objectStore(mc);let N=d.delete(this.modelPath);N.onsuccess=()=>(u.close(),a(x.error)),N.onerror=F=>(u.close(),a(x.error))}},m.onerror=x=>(u.close(),a(m.error)),f.oncomplete=()=>{g==null?u.close():g.oncomplete=()=>u.close()}}},l.onerror=u=>a(l.error)})}}Ah.URL_SCHEME="indexeddb://";let fv=i=>{return Ge().getBool("IS_BROWSER")&&!Array.isArray(i)&&i.startsWith(Ah.URL_SCHEME)?(t=i.slice(Ah.URL_SCHEME.length),new Ah(t)):null;var t};Ms.registerSaveRouter(fv),Ms.registerLoadRouter(fv);class qx{constructor(){this.indexedDB=pv()}async listModels(){return new Promise((t,n)=>{let s=this.indexedDB.open(Jg,1);s.onupgradeneeded=()=>e0(s),s.onsuccess=()=>{let a=s.result,l=a.transaction(mc,"readonly"),u=l.objectStore(mc).getAll();u.onsuccess=()=>{let h={};for(let f of u.result)h[f.modelPath]=f.modelArtifactsInfo;t(h)},u.onerror=h=>(a.close(),n(u.error)),l.oncomplete=()=>a.close()},s.onerror=a=>n(s.error)})}async removeModel(t){var n;return t=(n=t).startsWith(Ah.URL_SCHEME)?n.slice(Ah.URL_SCHEME.length):n,new Promise((s,a)=>{let l=this.indexedDB.open(Jg,1);l.onupgradeneeded=()=>e0(l),l.onsuccess=()=>{let u=l.result,h=u.transaction(mc,"readwrite"),f=h.objectStore(mc),d=f.get(t),m;d.onsuccess=()=>{if(d.result==null)return u.close(),a(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{let g=f.delete(t),x=()=>{m=u.transaction(wh,"readwrite");let R=m.objectStore(wh).delete(t);R.onsuccess=()=>s(d.result.modelArtifactsInfo),R.onerror=N=>a(d.error)};g.onsuccess=x,g.onerror=R=>(x(),u.close(),a(d.error))}},d.onerror=g=>(u.close(),a(d.error)),h.oncomplete=()=>{m==null?u.close():m.oncomplete=()=>u.close()}},l.onerror=u=>a(l.error)})}}let _u="/",Sd="tensorflowjs_models",mv="info",Kx="model_topology",Yx="weight_specs",Qx="weight_data",Zx="model_metadata";function gv(i){return{info:[Sd,i,mv].join(_u),topology:[Sd,i,Kx].join(_u),weightSpecs:[Sd,i,Yx].join(_u),weightData:[Sd,i,Qx].join(_u),modelMetadata:[Sd,i,Zx].join(_u)}}function yv(i){for(let t of Object.values(i))window.localStorage.removeItem(t)}function Jx(i){let t=i.split(_u);if(t.length<3)throw new Error(`Invalid key format: ${i}`);return t.slice(1,t.length-1).join(_u)}class Eh{constructor(t){if(!Ge().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=gv(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let n=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),a=Gp(t);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,function(u){if(Hp)return Buffer.from(u).toString("base64");let h=new Uint8Array(u),f="";for(let d=0,m=h.length;d<m;d++)f+=String.fromCharCode(h[d]);return btoa(f)}(t.weightData));let l={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(l)),{modelArtifactsInfo:a}}catch{throw yv(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=a;let l=this.LS.getItem(this.keys.modelMetadata);if(l!=null){let h=JSON.parse(l);n.format=h.format,n.generatedBy=h.generatedBy,n.convertedBy=h.convertedBy,h.signature!=null&&(n.signature=h.signature),h.userDefinedMetadata!=null&&(n.userDefinedMetadata=h.userDefinedMetadata),h.modelInitializer!=null&&(n.modelInitializer=h.modelInitializer),h.trainingConfig!=null&&(n.trainingConfig=h.trainingConfig)}let u=this.LS.getItem(this.keys.weightData);if(u==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=function(h){if(Hp){let m=Buffer.from(h,"base64");return m.buffer.slice(m.byteOffset,m.byteOffset+m.byteLength)}let f=atob(h),d=new Uint8Array(f.length);for(let m=0;m<f.length;++m)d.set([f.charCodeAt(m)],m);return d.buffer}(u),n}}Eh.URL_SCHEME="localstorage://";let vv=i=>{return Ge().getBool("IS_BROWSER")&&!Array.isArray(i)&&i.startsWith(Eh.URL_SCHEME)?(t=i.slice(Eh.URL_SCHEME.length),new Eh(t)):null;var t};Ms.registerSaveRouter(vv),Ms.registerLoadRouter(vv);class e1{constructor(){ee(Ge().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),ee(typeof window>"u"||window.localStorage!==void 0,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let t={},n=Sd+_u,s=_u+mv;for(let a=0;a<this.LS.length;++a){let l=this.LS.key(a);l.startsWith(n)&&l.endsWith(s)&&(t[Jx(l)]=JSON.parse(this.LS.getItem(l)))}return t}async removeModel(t){var n;let s=gv(t=(n=t).startsWith(Eh.URL_SCHEME)?n.slice(Eh.URL_SCHEME.length):n);if(this.LS.getItem(s.info)==null)throw new Error(`Cannot find model at path '${t}'`);let a=JSON.parse(this.LS.getItem(s.info));return yv(s),a}}let Td="://";class io{constructor(){this.managers={}}static getInstance(){return io.instance==null&&(io.instance=new io),io.instance}static registerManager(t,n){ee(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(Td)&&(t=t.slice(0,t.indexOf(Td))),ee(t.length>0,()=>"scheme must not be an empty string.");let s=io.getInstance();ee(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=n}static getManager(t){let n=this.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(this.getInstance().managers)}}function fm(i){if(i.indexOf(Td)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${io.getSchemes().join(",")}`);return{scheme:i.split(Td)[0],path:i.split(Td)[1]}}async function bv(i,t,n=!1){ee(i!==t,()=>`Old path and new path are the same: '${i}'`);let s=Ms.getLoadHandlers(i);ee(s.length>0,()=>`Copying failed because no load handler is found for source URL ${i}.`),ee(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${i}.`);let a=s[0],l=Ms.getSaveHandlers(t);ee(l.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),ee(l.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${t}.`);let u=l[0],h=fm(i).scheme,f=fm(i).path,d=h===fm(i).scheme,m=await a.load();n&&d&&await io.getManager(h).removeModel(f);let g=await u.save(m);return n&&!d&&await io.getManager(h).removeModel(f),g.modelArtifactsInfo}async function t1(){let i=io.getSchemes(),t={};for(let n of i){let s=await io.getManager(n).listModels();for(let a in s)t[n+Td+a]=s[a]}return t}async function n1(i){let t=fm(i);return io.getManager(t.scheme).removeModel(t.path)}async function r1(i,t){return bv(i,t,!1)}async function i1(i,t){return bv(i,t,!0)}class s1{fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}}if(Ge().get("IS_BROWSER")){Ge().setPlatform("browser",new s1);try{io.registerManager(Eh.URL_SCHEME,new e1)}catch{}try{io.registerManager(Ah.URL_SCHEME,new qx)}catch{}}let t0;function ci(i,t="float32",n){return t=t||"float32",nc(i),new Hi(i,t,n)}Ge().get("IS_NODE")&&Ge().setPlatform("node",new class{constructor(){this.util=ae(1758),this.textEncoder=new this.util.TextEncoder}fetch(i,t){return Ge().global.fetch!=null?Ge().global.fetch(i,t):(t0==null&&(t0=ae(8352)),t0(i,t))}now(){let i=process.hrtime();return 1e3*i[0]+i[1]/1e6}encode(i,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(i)}decode(i,t){return i.length===0?"":new this.util.TextDecoder(t).decode(i)}});let En=at({cast_:function(i,t){let n=Oe(i,"x","cast");if(!vn(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");let s={x:n},a={dtype:t};return st.runKernel(Yt,s,a)}}),Cu=at({clone_:function(i){let t={x:Oe(i,"x","clone","string_or_numeric")};return st.runKernel(ad,t)}});function xv(i,t=!1){console.log(i.toString(t))}function wv(i){return new Promise(t=>setTimeout(t)).then(i)}$p(),Ns={buffer:ci,cast:En,clone:Cu,print:xv};class Sh{constructor(t){if(!Ge().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Sh.URL_SCHEME)&&(t=t.slice(Sh.URL_SCHEME.length)),t!=null&&t.length!==0||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let s=dv(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),a=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=a,await wv(()=>l.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=n,await wv(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Gp(t)}}}}Sh.URL_SCHEME="downloads://";class a1{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise((t,n)=>{let s=new FileReader;s.onload=a=>{let l=JSON.parse(a.target.result),u=l.modelTopology;if(u==null)return void n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(l.weightsManifest==null)return void n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(this.weightsFiles.length===0)return void t({modelTopology:u});let h=Yg(l,f=>this.loadWeights(f));t(h)},s.onerror=a=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(t){let n=[],s=[];for(let u of t)n.push(...u.weights),s.push(...u.paths);let a=this.checkManifestAndWeightFiles(t),l=s.map(u=>this.loadWeightsFile(u,a[u]));return Promise.all(l).then(u=>[n,eu(u)])}loadWeightsFile(t,n){return new Promise((s,a)=>{let l=new FileReader;l.onload=u=>{let h=u.target.result;s(h)},l.onerror=u=>a(`Failed to weights data from file of path '${t}'.`),l.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(t){let n=[],s=this.weightsFiles.map(l=>hv(l.name)),a={};for(let l of t)l.paths.forEach(u=>{let h=hv(u);if(n.indexOf(h)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${h}'`);if(n.push(h),s.indexOf(h)===-1)throw new Error(`Weight file with basename '${h}' is not provided.`);a[u]=this.weightsFiles[s.indexOf(h)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return a}}function o1(i){return new a1(i)}function Av(i,t,n,s){(function(l){ee(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")})(i),function(l,u){ee(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),ee(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),ee(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}(n=n??0,s=s??1);let a=0;return Promise.all(i.map(l=>(l.then(u=>{let h=n+ ++a/i.length*(s-n);return t(h),u}),l)))}async function Ev(i,t){t==null&&(t={});let n=t.fetchFunc==null?Ge().platform.fetch:t.fetchFunc,s=i.map(l=>n(l,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?await Promise.all(s):await Av(s,t.onProgress,0,.5)).map(l=>l.arrayBuffer());return t.onProgress==null?await Promise.all(a):await Av(a,t.onProgress,.5,1)}async function Sv(i,t="",n,s){return Tv(a=>Ev(a,{requestInit:s}))(i,t,n)}function Tv(i){return async(t,n="",s)=>{let a=t.map(()=>!1),l={},u=s!=null?s.map(()=>!1):[],h=[];if(t.forEach((R,N)=>{let F=0;R.weights.forEach(H=>{let W="quantization"in H?H.quantization.dtype:H.dtype,G=qo[W]*me(H.shape),se=()=>{a[N]=!0,l[N]==null&&(l[N]=[]),l[N].push({manifestEntry:H,groupOffset:F,sizeBytes:G})};s!=null?s.forEach((ge,Ce)=>{ge===H.name&&(se(),u[Ce]=!0)}):se(),h.push(H.name),F+=G})}),!u.every(R=>R)){let R=s.filter((N,F)=>!u[F]);throw new Error(`Could not find weights in manifest with names: ${R.join(", ")}. 
Manifest JSON has weights with names: ${h.join(", ")}.`)}let f=a.reduce((R,N,F)=>(N&&R.push(F),R),[]),d=[];f.forEach(R=>{t[R].paths.forEach(N=>{let F=n+(n.endsWith("/")?"":"/")+N;d.push(F)})});let m=await i(d),g={},x=0;return f.forEach(R=>{let N=t[R].paths.length,F=0;for(let se=0;se<N;se++)F+=m[x+se].byteLength;let H=new ArrayBuffer(F),W=new Uint8Array(H),G=0;for(let se=0;se<N;se++){let ge=new Uint8Array(m[x+se]);W.set(ge,G),G+=ge.byteLength}l[R].forEach(se=>{let ge=xh(H.slice(se.groupOffset,se.groupOffset+se.sizeBytes),[se.manifestEntry]);for(let Ce in ge)g[Ce]=ge[Ce]}),x+=N}),g}}Ms.registerSaveRouter(i=>Ge().getBool("IS_BROWSER")&&!Array.isArray(i)&&i.startsWith(Sh.URL_SCHEME)?function(t="model"){return new Sh(t)}(i.slice(Sh.URL_SCHEME.length)):null);class n0{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(ee(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Ge().platform.fetch,ee(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&ee(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;let s=dv(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);n.body.append("model.json",new Blob([JSON.stringify(s)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");let a=await this.fetch(this.path,n);if(a.ok)return{modelArtifactsInfo:Gp(t),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async load(){let t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let u=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?u+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":u+=" Please make sure the server is serving valid JSON for this request.",new Error(u)}let s=n.modelTopology,a=n.weightsManifest;if(s==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return Yg(n,l=>this.loadWeights(l))}async loadWeights(t){let n=Array.isArray(this.path)?this.path[1]:this.path,[s,a]=function(d){let m=d.lastIndexOf("/"),g=d.lastIndexOf("?");return[d.substring(0,m)+"/",g>m?d.substring(g):""]}(n),l=this.weightPathPrefix||s,u=[];for(let d of t)u.push(...d.weights);let h=[],f=[];for(let d of t)for(let m of d.paths)this.weightUrlConverter!=null?f.push(this.weightUrlConverter(m)):h.push(l+m+a);return this.weightUrlConverter&&h.push(...await Promise.all(f)),[u,eu(await Ev(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function r0(i){return i.match(n0.URL_SCHEME_REGEX)!=null}n0.URL_SCHEME_REGEX=/^https?:\/\//;let Mv=(i,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(n=Array.isArray(i)?i.every(s=>r0(s)):r0(i),n)return i0(i,t)}return null};function i0(i,t){return new n0(i,t)}function mm(i,t){return i0(i,t)}Ms.registerSaveRouter(Mv),Ms.registerLoadRouter(Mv);class s0{constructor(t){this.modelArtifacts=t}async load(){return this.modelArtifacts}}class l1{constructor(t){this.saveHandler=t}async save(t){return this.saveHandler(t)}}function u1(i,t,n,s){return arguments.length===1?i.modelTopology!=null||i.weightSpecs!=null?new s0(i):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new s0({modelTopology:i})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new s0({modelTopology:i,weightSpecs:t,weightData:n,trainingConfig:s}))}function c1(i){return new l1(i)}let oi=at({matMul_:function(i,t,n=!1,s=!1){let a=Oe(i,"a","matMul"),l=Oe(t,"b","matMul");[a,l]=ls(a,l);let u={a,b:l},h={transposeA:n,transposeB:s};return st.runKernel(_e,u,h)}}),Md=at({oneHot_:function(i,t,n=1,s=0){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let a={indices:Oe(i,"indices","oneHot","int32")},l={depth:t,onValue:n,offValue:s};return st.runKernel(ac,a,l)}}),xi=at({transpose_:function(i,t){let n=Oe(i,"x","transpose");if(t==null&&(t=n.shape.map((l,u)=>u).reverse()),ee(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${t}.`),t.forEach(l=>{ee(l>=0&&l<n.rank,()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+` but got ${t}`)}),n.rank<=1)return n.clone();let s={x:n},a={perm:t};return st.runKernel(Ho,s,a)}}),h1=at({confusionMatrix_:function(i,t,n){let s=Oe(i,"labels","confusionMatrix"),a=Oe(t,"predictions","confusionMatrix");ee(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),ee(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),ee(a.rank===1,()=>`Expected the rank of predictions to be 1, but got ${a.rank}`),ee(s.shape[0]===a.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`),ee(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);let l=Md(En(s,"int32"),n),u=Md(En(a,"int32"),n),h=xi(l),f=oi(h,u);return En(f,"int32")}});function Th(i,t){let n=i.length,s=[];for(let a=0;a<n;a++){let l=n-1-a,u=i[l]||1;(t[t.length-1-a]||1)>1&&u===1&&s.unshift(l)}return s}function Qs(i,t){let n=[];for(let s=0;s<t.length;s++){let a=i[i.length-s-1],l=t.length-s-1,u=t[l];(a==null||a===1&&u>1)&&n.unshift(l)}return n}function Zr(i,t){let n=[],s=Math.max(i.length,t.length);for(let a=0;a<s;a++){let l=i[i.length-a-1];l==null&&(l=1);let u=t[t.length-a-1];if(u==null&&(u=1),l===1)n.unshift(u);else if(u===1)n.unshift(l);else{if(l!==u)throw Error(`Operands could not be broadcast together with shapes ${i} and ${t}.`);n.unshift(l)}}return n}function _v(i,t,n){if(X(i),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let s=ro(i,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return pc(i,t,s,n)}let Mh;function Cv(i,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(i==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,a=!1,l=!1,u=!1,h=!1;if(i.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&i instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)l=!0;else if(i.getContext!=null)u=!0;else{if(!(typeof ImageBitmap<"u"&&i instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${i.constructor.name}`);h=!0}if(a&&a&&i.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Lp(ph,st.backendName)!=null){let x={pixels:i},R={numChannels:t};return st.runKernel(ph,x,R)}let[f,d]=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],m,g;if(u)m=i.getContext("2d").getImageData(0,0,f,d).data;else if(s||n)m=i.data;else if(l||a||h){if(Mh==null)if(typeof document>"u"){if(typeof OffscreenCanvas>"u"||typeof OffscreenCanvasRenderingContext2D>"u")throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Mh=new OffscreenCanvas(1,1).getContext("2d")}else Mh=document.createElement("canvas").getContext("2d");Mh.canvas.width=f,Mh.canvas.height=d,Mh.drawImage(i,0,0,f,d),m=Mh.getImageData(0,0,f,d).data}if(t===4)g=new Int32Array(m);else{let x=f*d;g=new Int32Array(x*t);for(let R=0;R<x;R++)for(let N=0;N<t;++N)g[R*t+N]=m[4*R+N]}return _v(g,[d,f,t],"int32")}async function d1(i,t=3){let n=null;if(Ge().getBool("WRAP_TO_IMAGEBITMAP")&&function(s){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")&&!(s instanceof ImageBitmap)&&function(a){return a!=null&&a.width!==0&&a.height!==0}(s)&&!function(a){return a!=null&&a.data instanceof Uint8Array}(s)}(i)){let s;try{s=await createImageBitmap(i,{premultiplyAlpha:"none"})}catch{s=null}n=s!=null&&s.width===i.width&&s.height===i.height?s:i}else n=i;return Cv(n,t)}async function p1(i,t){let n=Oe(i,"img","toPixels");if(!(i instanceof Ni)){let d=n;n=En(d,"int32"),d.dispose()}if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);let[s,a]=n.shape.slice(0,2),l=n.rank===2?1:n.shape[2];if(l>4||l===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${l}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);let u=await n.data(),h=n.dtype==="float32"?255:1,f=new Uint8ClampedArray(a*s*4);for(let d=0;d<s*a;++d){let m=[0,0,0,255];for(let x=0;x<l;x++){let R=u[d*l+x];if(n.dtype==="float32"){if(R<0||R>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${R}.`)}else if(n.dtype==="int32"&&(R<0||R>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${R}.`);l===1?(m[0]=R*h,m[1]=R*h,m[2]=R*h):m[x]=R*h}let g=4*d;f[g+0]=Math.round(m[0]),f[g+1]=Math.round(m[1]),f[g+2]=Math.round(m[2]),f[g+3]=Math.round(m[3])}if(t!=null){t.width=a,t.height=s;let d=t.getContext("2d"),m=new ImageData(f,a,s);d.putImageData(m,0,0)}return n!==i&&n.dispose(),f}let Iv=at({fromPixels_:Cv});function gm(i,t){let n=i.shape.length,s=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${n}`);if(me(i.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${i.shape}.`);let a=t.shape,l=a[a.length-1],u=1;for(let g=0;g<a.length-1;++g)u*=a[g];let h=i.shape,f=a.slice();f.pop();let d=1;for(let g=l;g<n;++g)d*=h[g],f.push(h[g]);let m=[...Rn(i.shape).map(g=>g/d),1].slice(0,l);return[f,u,d,m]}function a0(i,t,n){let s=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,l=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${i}, sliceDim: ${s}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(l+` update.rank < ${a}. `);if(i.length<s+(n.rank-a))throw new Error(l+` Output shape length < ${s+(n.rank-a)}`);if(n.rank!==a+i.length-s)throw new Error(l+" update.rank != "+(a+i.length-s));for(let u=0;u<a;++u)if(n.shape[u]!==t.shape[u])throw new Error(l+` updates.shape[${u}] (${n.shape[u]}) != indices.shape[${u}] (${t.shape[u]}).`);for(let u=0;u<n.rank-a;++u)if(n.shape[u+a]!==i[u+s])throw new Error(l+` updates.shape[${u+a}] (${n.shape[u+a]}) != shape[${u+a}] (${i[u+a]})`)}function o0(i,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(i.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${i.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(i.size===0)throw new Error(`Updates specified for empty output. updates shape: ${i.shape}`)}a0(n,t,i)}function _d(i,t,n){let s=t.shape.length,a=s>1?t.shape[s-1]:1,l=n.length,u=1;for(let f=a;f<l;++f)u*=n[f];let h=a<1?1:a;return{sliceRank:a,numUpdates:me(t.shape)/h,sliceSize:u,strides:[...Rn(n.slice(0,a)),1],outputSize:me(n)}}function l0(i,t,n){let s=i.shape.length;ee(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),ee(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let a=0;a<s;++a)ee(t[a]+n[a]<=i.shape[a],()=>`Error in slice${s}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${i.shape[a]})`)}function f1(i){let t=[],n=0;for(;i>0;)1&i&&t.push(n),i/=2,n++;return t}function u0(i,t,n){let s=[];for(let a=0;a<i.length;a++)s[a]=Math.ceil((t[a]-i[a])/n[a]);return s}function kv(i,t,n,s){let a=[...i];for(let l=a.length;l<s.length;l++)a.push(1);for(let l=0;l<n;l++)l===0?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Rv(i,t,n){return n<=i?n:n-(t-1)}function Nv(i,t){let n=[];for(let s=0;s<i;s++)n.push(t+s);return n}function m1(i,t,n,s,a,l,u,h,f){let d=i.length,m=new Array(d),g=new Array(d),x=new Array(d);if(t.length&&n>0){let R=t[0],N=n+1;m=Lv(u,R,N,s,i),g=Dv(h,R,N,a,i),x=kv(l,R,N,i)}else for(let R=0;R<d;R++)m[R]=Pv(u,s,l,i,R,f),g[R]=Ov(h,a,l,i,R,f),x[R]=Fv(l,R,f);return{begin:m,end:g,strides:x}}function Lv(i,t,n,s,a){let l=[...a],u=Nv(n,t);for(let h=0;h<l.length;h++)if(u.indexOf(h)>-1)l[h]=0;else{let f=Rv(t,n,h),d=s[f];i&1<<f&&(d=0),l[h]=d}return l}function Dv(i,t,n,s,a){let l=[...a],u=Nv(n,t);for(let h=0;h<l.length;h++)if(u.indexOf(h)>-1)l[h]=Number.MAX_SAFE_INTEGER;else{let f=Rv(t,n,h),d=s[f];i&1<<f&&(d=Number.MAX_SAFE_INTEGER),l[h]=d}for(let h=0;h<l.length;h++){let f=a[h];l[h]<0&&(l[h]+=f),l[h]=tn(0,l[h],a[h])}return l}function Fv(i,t,n){let s=i[t];return(n&1<<t||s==null)&&(s=1),s}function Pv(i,t,n,s,a,l){let u=t[a],h=n[a]||1;(i&1<<a||l&1<<a||u==null)&&(u=h>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);let f=s[a];return u<0&&(u+=f),u=tn(0,u,f-1),u}function Ov(i,t,n,s,a,l){let u=t[a],h=n[a]||1;(i&1<<a||l&1<<a||u==null)&&(u=h>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);let f=s[a];return u<0&&(u+=f),u=h>0?tn(0,u,f):tn(-1,u,f-1),u}function c0(i,t,n){let s=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){s=a;break}for(let a=s+1;a<n.length;a++)if(t[a]>0||n[a]!==i[a])return!1;return!0}function h0(i,t){let n=i.length>0?i[i.length-1]:1;for(let s=0;s<i.length-1;s++)n+=i[s]*t[s];return n}function ym(i,t,n){let s,a=i.shape.length,l;return s=typeof t=="number"?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),s.forEach(u=>{ee(u!==-1,()=>"slice() does not support negative begin indexing.")}),l=n==null?new Array(a).fill(-1):typeof n=="number"?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,l=l.map((u,h)=>u>=0?u:(ee(u===-1,()=>`Negative size values should be exactly -1 but got ${u} for the slice() size at index ${h}.`),i.shape[h]-s[h])),[s,l]}function d0(i,t,n,s,a,l,u,h,f){let d;if(s==null?(d=new Array(t.length),d.fill(1)):d=s,u!=null&&(u&u-1)!=0)throw new Error("Multiple ellipses in slice is not allowed.");let m=!1,g={dims:d.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:d.slice(),beginMask:a,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f};for(let G=0;G<g.dims;G++)m&&(1<<G&h)!=0&&g.numAddAxisAfterEllipsis++,1<<G&u&&(m=!0);m||(g.ellipsisMask|=1<<g.dims,g.dims++);let x={dims:i.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};(function(G,se){se.beginMask=0,se.endMask=0,se.shrinkAxisMask=0;let ge=0;se.beginValid=G.begin!=null,se.endValid=G.end!=null,se.begin=new Array(se.dims),se.end=new Array(se.dims),se.strides=new Array(se.dims),se.finalShapeGatherIndices=[],se.finalShapeGatherIndicesSparse=[],se.inputShapeGatherIndicesSparse=new Array(se.dims);for(let Ce=0;Ce<G.dims;Ce++)if(1<<Ce&G.ellipsisMask){let Be=Math.min(se.dims-(G.dims-Ce)+1+G.numAddAxisAfterEllipsis,se.dims);for(;ge<Be;ge++)se.begin[ge]=0,se.end[ge]=0,se.strides[ge]=1,se.beginMask|=1<<ge,se.endMask|=1<<ge,se.finalShapeGatherIndices.push(ge),se.finalShapeGatherIndicesSparse.push(-1),se.inputShapeGatherIndicesSparse[ge]=Ce}else if(1<<Ce&G.newAxisMask)se.finalShapeGatherIndices.push(-2),se.finalShapeGatherIndicesSparse.push(-1);else{if(ge===se.begin.length)throw Error(`Index out of range using input dim ${ge}; input has only ${se.dims} dims, ${se.begin.length}.`);G.begin!=null&&(se.begin[ge]=G.begin[Ce]),G.end!=null&&(se.end[ge]=G.end[Ce]),se.strides[ge]=G.strides[Ce],G.beginMask&1<<Ce&&(se.beginMask|=1<<ge),G.endMask&1<<Ce&&(se.endMask|=1<<ge),G.shrinkAxisMask&1<<Ce?(se.finalShapeGatherIndices.push(-1),se.finalShapeGatherIndicesSparse.push(-1),se.shrinkAxisMask|=1<<ge):(se.finalShapeGatherIndices.push(ge),se.finalShapeGatherIndicesSparse.push(Ce)),se.inputShapeGatherIndicesSparse[ge]=Ce,ge++}})(g,x);let R=!0,N=!0,F=!0,H=[],W=[];for(let G=0;G<i.length;++G){if(x.strides[G]===0)throw Error(`strides[${G}] must be non-zero`);let se=!!(x.shrinkAxisMask&1<<G),ge=i[G];if(ge===-1){H.push(se?1:-1);continue}let Ce=[x.beginMask&1<<G,x.endMask&1<<G],Be=[x.strides[G]>0?0:-1,x.strides[G]>0?ge:ge-1];if(se&&x.strides[G]<=0)throw Error("only stride 1 allowed on non-range indexing.");F=F&&x.strides[G]===1;let Ve=!!(x.beginMask&1<<G&&x.endMask&1<<G);if(x.beginValid&&x.endValid){if(se){let ot=x.begin[G]<0?ge+x.begin[G]:x.begin[G];if(x.begin[G]=ot,x.end[G]=x.begin[G]+1,ot<0||ot>=ge)throw Error(`slice index ${x.begin[G]} of dimension ${G} out of bounds.`)}else x.begin[G]=Bv(x.begin[G],0,x.strides[G],ge,Ce,Be),x.end[G]=Bv(x.end[G],1,x.strides[G],ge,Ce,Be);let tt=x.strides[G]===1&&x.begin[G]===0&&x.end[G]===ge;R=R&&tt,N=N&&(G===0&&x.strides[G]===1||tt)}else R=R&&x.strides[G]===1&&Ve,N=N&&(G===0&&x.strides[G]===1||Ve);let ze,Xe=!1;if(x.beginValid&&x.endValid?(ze=x.end[G]-x.begin[G],Xe=!0):se?(ze=1,Xe=!0):Ve&&ge>=0&&(ze=x.strides[G]<0?-ge:ge,Xe=!0),Xe){let tt;tt=ze===0||ze<0!=x.strides[G]<0?0:Math.trunc(ze/x.strides[G])+(ze%x.strides[G]!=0?1:0),H.push(tt)}else H.push(-1)}for(let G=0;G<x.finalShapeGatherIndices.length;++G){let se=x.finalShapeGatherIndices[G];se>=0?W.push(H[se]):se===-2&&W.push(1)}return{finalShapeSparse:W.filter((G,se)=>x.finalShapeGatherIndices[se]!==-2),finalShape:W,isIdentity:R,sliceDim0:N,isSimpleSlice:F,begin:x.begin,end:x.end,strides:x.strides}}function Bv(i,t,n,s,a,l){if(a[t])return n>0?l[t]:l[t+1&1];{let u=i<0?s+i:i;return u<l[0]?l[0]:u>l[1]?l[1]:u}}class _h{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class ko{constructor(){this.classNameMap={}}static getMap(){return ko.instance==null&&(ko.instance=new ko),ko.instance}static register(t){ko.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function dn(i){ee(i.className!=null,()=>"Class being registered does not have the static className property defined."),ee(typeof i.className=="string",()=>"className is required to be a string, but got type "+typeof i.className),ee(i.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),ko.register(i)}let Uv=.1;function g1(i,t,n){return n==null&&(n=p0()),zv(i,t,(s,a)=>$v(s,a,n))}function p0(){return st.backend.floatPrecision()===32?.001:Uv}function zv(i,t,n){let s=!0;if((ir(i)||ir(t))&&(s=!1),ir(i)&&ir(t)&&(s=!0),s){let u=i.constructor.name,h=t.constructor.name;if(u!==h)throw new Error(`Arrays are of different type. Actual: ${u}. Expected: ${h}`)}if(Array.isArray(i)&&Array.isArray(t)){let u=ro(i),h=ro(t);if(!Ye(u,h))throw new Error(`Arrays have different shapes. Actual: [${u}]. Expected: [${h}]`)}let a=ir(i)?i:te(i),l=ir(t)?t:te(t);if(a.length!==l.length)throw new Error(`Arrays have different lengths actual: ${a.length} vs expected: ${l.length}.
Actual:   ${a}.
Expected: ${l}.`);for(let u=0;u<l.length;++u){let h=a[u],f=l[u];if(!n(h,f))throw new Error(`Arrays differ: actual[${u}] = ${h}, expected[${u}] = ${f}.
Actual:   ${a}.
Expected: ${l}.`)}}function yE(i,t){i().then(()=>t.fail(),()=>t())}function vE(i,t){let n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return Sr(i)||Sr(i[0])||Sr(t)||Sr(t[0])?zv(i,n,(s,a)=>s==a):zv(i,t,(s,a)=>$v(s,a,0))}function bE(i,t,n){if(n==null&&(n=p0()),!$v(i,t,n))throw new Error(`Numbers differ: actual === ${i}, expected === ${t}`)}function $v(i,t,n){return!isFinite(i)&&!isFinite(t)||!(isNaN(i)||isNaN(t)||Math.abs(i-t)>n)}function xE(i,t,n){for(let s=0;s<i.length;s++)if(i[s]<t||i[s]>n)throw new Error(`Value out of range:${i[s]} low: ${t}, high: ${n}`)}function wE(i,t){let n=new Float32Array(i),s=new Float32Array(t);if(n.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${n.length}`);for(let a=0;a<s.length;a++)if(n[a]!==s[a])throw new Error(`Expected ArrayBuffer value at ${a} to be ${s[a]} but got ${n[a]} instead`)}function y1(i){for(let t=0;t<i.length;t++){let n=i[t];Array.isArray(n)?y1(n):i[t]=Co(n)}return i}let v1="3.13.0";function AE(){Ge().set("PROD",!0)}function EE(){Ge().set("DEBUG",!0)}function SE(){Ge().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function b1(i){Ge().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(i+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function TE(){st.disposeVariables()}function gc(){return st}function f0(){return st.memory()}function ME(i){return st.profile(i)}function bt(i,t){return st.tidy(i,t)}function ni(i){jo(i).forEach(t=>t.dispose())}function wa(i){return st.keep(i)}function _E(i){return st.time(i)}function CE(i){return st.setBackend(i)}function IE(){return st.ready()}function kE(){return st.backendName}function RE(i){st.removeBackend(i)}function NE(i){return st.findBackend(i)}function LE(i){return st.findBackendFactory(i)}function Vv(i,t,n=1){return st.registerBackend(i,t,n)}function x1(){return st.backend}function DE(i,t){Ge().setPlatform(i,t)}Or=b1;let fn=at({add_:function(i,t){let n=Oe(i,"a","add"),s=Oe(t,"b","add");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(Tr,a)}}),m0=at({floorDiv_:function(i,t){let n=Oe(i,"a","floorDiv"),s=Oe(t,"b","floorDiv");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(id,a)}}),yn=at({div_:function(i,t){let n=Oe(i,"a","div"),s=Oe(t,"b","div");if([n,s]=ls(n,s),n.dtype==="int32"&&s.dtype==="int32")return m0(n,s);let a={a:n,b:s};return st.runKernel(Oo,a,{})}}),qe=at({mul_:function(i,t){let n=Oe(i,"a","mul"),s=Oe(t,"b","mul");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(Ts,a)}}),rs=at({sqrt_:function(i){let t={x:Oe(i,"x","sqrt","float32")};return st.runKernel(Eu,t)}}),es=at({square_:function(i){let t=Oe(i,"x","square");return st.runKernel("Square",{x:t},{})}}),wi=at({zerosLike_:function(i){let t={x:Oe(i,"x","zerosLike")};return st.runKernel(yd,t)}});function w1(i){return ee(ti(i),()=>"The f passed in grad(f) must be a function"),(t,n)=>{let s=Oe(t,"x","tf.grad","string_or_numeric"),a=n!=null?Oe(n,"dy","tf.grad"):null;return st.tidy(()=>{let{value:l,grads:u}=st.gradients(()=>i(s),[s],a);return a!=null&&ie(l.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Iu(u),u[0]})}}function A1(i){return ee(ti(i),()=>"The f passed in grads(f) must be a function"),(t,n)=>{ee(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");let s=dc(t,"args","tf.grads","string_or_numeric"),a=n!=null?Oe(n,"dy","tf.grads"):null;return st.tidy(()=>{let{value:l,grads:u}=st.gradients(()=>i(...s),s,a);return a!=null&&ie(l.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Iu(u),u})}}function E1(i){return ee(ti(i),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{ee(t instanceof Ni,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),ee(n==null||n instanceof Ni,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");let{grads:s,value:a}=st.gradients(()=>i(t),[t],n);return Iu(s),{grad:s[0],value:a}}}function S1(i){return ee(ti(i),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{ee(Array.isArray(t)&&t.every(a=>a instanceof Ni),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),ee(n==null||n instanceof Ni,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");let s=st.gradients(()=>i(...t),t,n);return n!=null&&ie(s.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Iu(s.grads),s}}function Cd(i,t){ee(ti(i),()=>"The f passed in variableGrads(f) must be a function"),ee(t==null||Array.isArray(t)&&t.every(f=>f instanceof mh),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let n=t!=null;if(!n){t=[];for(let f in st.registeredVariables)t.push(st.registeredVariables[f])}let s=n?t.filter(f=>!f.trainable):null,a=t.length;ee((t=t.filter(f=>f.trainable)).length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let{value:l,grads:u}=st.gradients(i,t,null,!0);ee(u.some(f=>f!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ee(l.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${l.rank} tensor`);let h={};return t.forEach((f,d)=>{u[d]!=null&&(h[f.name]=u[d])}),s?.forEach(f=>h[f.name]=null),{value:l,grads:h}}function ja(i){return st.customGrad(i)}function Iu(i){if(i.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Jn(i,t){if((ir(i)&&t!=="string"||Array.isArray(i))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&ir(i)&&!(i instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return pc(i,[],[],t)}class Aa extends _h{minimize(t,n=!1,s){let{value:a,grads:l}=this.computeGradients(t,s);if(s!=null){let u=s.map(h=>({name:h.name,tensor:l[h.name]}));this.applyGradients(u)}else this.applyGradients(l);return ni(l),n?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return Cd(t,n)}dispose(){this.iterations_!=null&&ni(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Jn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Aa,Symbol.hasInstance,{value:i=>i.minimize!=null&&i.computeGradients!=null&&i.applyGradients!=null});class Wp extends Aa{constructor(t,n,s=null){super(),this.learningRate=t,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=st.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,s)=>{let a=st.registeredVariables[n];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${n}/accum_grad`,variable:bt(()=>wi(a).variable(!1))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${n}/accum_var`,variable:bt(()=>wi(a).variable(!1))});let l=Array.isArray(t)?t[s].tensor:t[n];if(l==null)return;let u=this.accumulatedGrads[s].variable,h=this.accumulatedUpdates[s].variable;bt(()=>{let f=fn(qe(u,this.rho),qe(es(l),1-this.rho)),d=qe(yn(rs(fn(h,this.epsilon)),rs(fn(u,this.epsilon))),l),m=fn(qe(h,this.rho),qe(es(d),1-this.rho));u.assign(f),h.assign(m);let g=fn(qe(d,-this.learningRate),a);a.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ni(this.accumulatedGrads.map(t=>t.variable)),ni(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){let t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){let n=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(!1)})),this.accumulatedUpdates=t.slice(n,2*n).map(s=>({originalName:s.name,variable:s.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}function Ch(i,t,n){let s={shape:i,value:t,dtype:n};return st.runKernel(gp,{},s)}Wp.className="Adadelta",dn(Wp);class ku extends Aa{constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,s)=>{let a=st.registeredVariables[n];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${n}/accumulator`,variable:bt(()=>Ch(a.shape,this.initialAccumulatorValue).variable(!1))});let l=Array.isArray(t)?t[s].tensor:t[n];if(l==null)return;let u=this.accumulatedGrads[s].variable;bt(()=>{let h=fn(u,es(l));u.assign(h);let f=fn(qe(yn(l,rs(fn(h,st.backend.epsilon()))),-this.learningRate),a);a.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ni(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t),this.accumulatedGrads=t.map(n=>({originalName:n.name,variable:n.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}ku.className="Adagrad",dn(ku);let Sl=at({pow_:function(i,t){let n=Oe(i,"base","pow"),s=Oe(t,"exp","pow");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(Fn,a)}}),Un=at({sub_:function(i,t){let n=Oe(i,"a","sub"),s=Oe(t,"b","sub");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(Mo,a)}});class jp extends Aa{constructor(t,n,s,a=null){super(),this.learningRate=t,this.beta1=n,this.beta2=s,this.epsilon=a,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],bt(()=>{this.accBeta1=Jn(n).variable(),this.accBeta2=Jn(s).variable()}),a==null&&(this.epsilon=st.backend.epsilon())}applyGradients(t){let n=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);bt(()=>{let s=Un(1,this.accBeta1),a=Un(1,this.accBeta2);n.forEach((l,u)=>{let h=st.registeredVariables[l];this.accumulatedFirstMoment[u]==null&&(this.accumulatedFirstMoment[u]={originalName:`${l}/m`,variable:bt(()=>wi(h).variable(!1))}),this.accumulatedSecondMoment[u]==null&&(this.accumulatedSecondMoment[u]={originalName:`${l}/v`,variable:bt(()=>wi(h).variable(!1))});let f=Array.isArray(t)?t[u].tensor:t[l];if(f==null)return;let d=this.accumulatedFirstMoment[u].variable,m=this.accumulatedSecondMoment[u].variable,g=fn(qe(d,this.beta1),qe(f,1-this.beta1)),x=fn(qe(m,this.beta2),qe(es(f),1-this.beta2)),R=yn(g,s),N=yn(x,a);d.assign(g),m.assign(x);let F=fn(qe(yn(R,fn(rs(N),this.epsilon)),-this.learningRate),h);h.assign(F)}),this.accBeta1.assign(qe(this.accBeta1,this.beta1)),this.accBeta2.assign(qe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ni(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&ni(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){let t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),bt(()=>{this.accBeta1.assign(Sl(this.beta1,this.iterations_+1)),this.accBeta2.assign(Sl(this.beta2,this.iterations_+1))});let n=t.length/2;this.accumulatedFirstMoment=t.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(!1)})),this.accumulatedSecondMoment=t.slice(n,2*n).map(s=>({originalName:s.name,variable:s.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}jp.className="Adam",dn(jp);let _s=at({abs_:function(i){let t=Oe(i,"x","abs");if(t.dtype==="complex64"){let n={x:t};return st.runKernel(hn,n)}{let n={x:t};return st.runKernel(Xt,n)}}}),Tl=at({maximum_:function(i,t){let n=Oe(i,"a","maximum"),s=Oe(t,"b","maximum");[n,s]=ls(n,s),n.dtype==="bool"&&(n=En(n,"int32"),s=En(s,"int32")),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(ld,a)}});class Id extends Aa{constructor(t,n,s,a=null,l=0){super(),this.learningRate=t,this.beta1=n,this.beta2=s,this.epsilon=a,this.decay=l,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],bt(()=>{this.iteration=Jn(0).variable(),this.accBeta1=Jn(n).variable()}),a==null&&(this.epsilon=st.backend.epsilon())}applyGradients(t){let n=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);bt(()=>{let s=Un(1,this.accBeta1),a=yn(-this.learningRate,fn(qe(this.iteration,this.decay),1));n.forEach((l,u)=>{let h=st.registeredVariables[l];this.accumulatedFirstMoment[u]==null&&(this.accumulatedFirstMoment[u]={originalName:`${l}/m`,variable:wi(h).variable(!1)}),this.accumulatedWeightedInfNorm[u]==null&&(this.accumulatedWeightedInfNorm[u]={originalName:`${l}/v`,variable:wi(h).variable(!1)});let f=Array.isArray(t)?t[u].tensor:t[l];if(f==null)return;let d=this.accumulatedFirstMoment[u].variable,m=this.accumulatedWeightedInfNorm[u].variable,g=fn(qe(d,this.beta1),qe(f,1-this.beta1)),x=qe(m,this.beta2),R=_s(f),N=Tl(x,R);d.assign(g),m.assign(N);let F=fn(qe(yn(a,s),yn(g,fn(N,this.epsilon))),h);h.assign(F)}),this.iteration.assign(fn(this.iteration,1)),this.accBeta1.assign(qe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ni(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&ni(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}Id.className="Adamax",dn(Id);class Ml extends Aa{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,s)=>{let a=Array.isArray(t)?t[s].tensor:t[n];if(a==null)return;let l=st.registeredVariables[n];bt(()=>{let u=fn(qe(this.c,a),l);l.assign(u)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=wa(Jn(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if((t=await this.extractIterations(t)).length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}Ml.className="SGD",dn(Ml);class Ru extends Ml{constructor(t,n,s=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Jn(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,s)=>{let a=st.registeredVariables[n];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${n}/momentum`,variable:bt(()=>wi(a).variable(!1))});let l=this.accumulations[s].variable,u=Array.isArray(t)?t[s].tensor:t[n];u!=null&&bt(()=>{let h,f=fn(qe(this.m,l),u);h=this.useNesterov?fn(qe(this.c,fn(u,qe(f,this.m))),a):fn(qe(this.c,f),a),l.assign(f),a.assign(h)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ni(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t),this.accumulations=t.map(n=>({originalName:n.name,variable:n.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}Ru.className="Momentum",dn(Ru);class Xp extends Aa{constructor(t,n=.9,s=0,a=null,l=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=s,this.epsilon=a,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=l,a==null&&(this.epsilon=st.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,s)=>{let a=st.registeredVariables[n],l=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${n}/rms`,variable:bt(()=>wi(a).variable(l))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${n}/momentum`,variable:bt(()=>wi(a).variable(l))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${n}/mg`,variable:bt(()=>wi(a).variable(l))});let u=Array.isArray(t)?t[s].tensor:t[n];if(u==null)return;let h=this.accumulatedMeanSquares[s].variable,f=this.accumulatedMoments[s].variable;bt(()=>{let d=fn(qe(h,this.decay),qe(es(u),1-this.decay));if(this.centered){let m=this.accumulatedMeanGrads[s].variable,g=fn(qe(m,this.decay),qe(u,1-this.decay)),x=yn(qe(u,this.learningRate),rs(Un(d,fn(es(g),this.epsilon)))),R=fn(qe(f,this.momentum),x);h.assign(d),m.assign(g),f.assign(R);let N=Un(a,R);a.assign(N)}else{let m=fn(qe(h,this.decay),qe(es(u),1-this.decay)),g=fn(qe(f,this.momentum),yn(qe(u,this.learningRate),rs(fn(m,this.epsilon))));h.assign(m),f.assign(g);let x=Un(a,g);a.assign(x)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ni(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ni(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&ni(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){let t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);let n=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,n).map(a=>({originalName:a.name,variable:a.tensor.variable(s)})),this.accumulatedMoments=t.slice(n,2*n).map(a=>({originalName:a.name,variable:a.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(a=>({originalName:a.name,variable:a.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}Xp.className="RMSProp",dn(Xp);class tu{static sgd(t){return new Ml(t)}static momentum(t,n,s=!1){return new Ru(t,n,s)}static rmsprop(t,n=.9,s=0,a=null,l=!1){return new Xp(t,n,s,a,l)}static adam(t=.001,n=.9,s=.999,a=null){return new jp(t,n,s,a)}static adadelta(t=.001,n=.95,s=null){return new Wp(t,n,s)}static adamax(t=.002,n=.9,s=.999,a=null,l=0){return new Id(t,n,s,a,l)}static adagrad(t,n=.1){return new ku(t,n)}}let g0=at({acos_:function(i){let t={x:Oe(i,"x","acos")};return st.runKernel(nr,t)}}),vm=at({acosh_:function(i){let t={x:Oe(i,"x","acosh")};return st.runKernel(yr,t)}}),qp=at({addN_:function(i){ee(Array.isArray(i),()=>"The argument passed to tf.addN() must be a list of tensors"),ee(i.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${i.length}`);let t=i.map((a,l)=>Oe(a,`tensors${l}`,"addN")),n=t[0];t.forEach(a=>{if(a.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(a=>{if(!Ye(a.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let s=t;return st.runKernel(qi,s)}}),bm=at({all_:function(i,t=null,n=!1){let s={x:Oe(i,"x","all","bool")},a={axis:t,keepDims:n};return st.runKernel(ai,s,a)}}),kd=at({any_:function(i,t=null,n=!1){let s={x:Oe(i,"x","any","bool")},a={axis:t,keepDims:n};return st.runKernel(Vr,s,a)}}),yc=at({argMax_:function(i,t=0){let n={x:Oe(i,"x","argMax")},s={axis:t};return st.runKernel(ui,n,s)}}),Kp=at({argMin_:function(i,t=0){let n={x:Oe(i,"x","argMin")},s={axis:t};return st.runKernel(Zi,n,s)}}),y0=at({asin_:function(i){let t={x:Oe(i,"x","asin")};return st.runKernel(ks,t)}}),v0=at({asinh_:function(i){let t={x:Oe(i,"x","asinh")};return st.runKernel(Mr,t)}}),b0=at({atan_:function(i){let t={x:Oe(i,"x","atan")};return st.runKernel(jr,t)}}),x0=at({atan2_:function(i,t){let n=Oe(i,"a","atan2"),s=Oe(t,"b","atan2");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(qs,a)}}),w0=at({atanh_:function(i){let t={x:Oe(i,"x","atanh")};return st.runKernel(Xr,t)}});function vc(i,t,n,s,a="NHWC",l){return ta(i,[...t,i[3]],n,l,s,null,null,nu(a))}function Ko(i,t,n,s,a,l,u="channelsLast"){let[h,f]=Rd(t),d;if(u==="channelsLast")d=[h,f,i[3],i[3]];else{if(u!=="channelsFirst")throw new Error(`Unknown dataFormat ${u}`);d=[h,f,i[1],i[1]]}return ta(i,d,n,s,a,l,!1,u)}function Nu(i,t,n,s,a,l,u="NDHWC"){let[h,f,d]=xm(t),m,g;if(u==="NDHWC")g="channelsLast",m=[h,f,d,i[4],i[4]];else{if(u!=="NCDHW")throw new Error(`Unknown dataFormat ${u}`);g="channelsFirst",m=[h,f,d,i[1],i[1]]}return bc(i,m,n,s,a,!1,g,l)}function ta(i,t,n,s,a,l,u=!1,h="channelsLast"){let[f,d,m,g]=[-1,-1,-1,-1];if(h==="channelsLast")[f,d,m,g]=i;else{if(h!=="channelsFirst")throw new Error(`Unknown dataFormat ${h}`);[f,g,d,m]=i}let[x,R,,N]=t,[F,H]=Rd(n),[W,G]=Rd(s),se=Ih(x,W),ge=Ih(R,G),{padInfo:Ce,outHeight:Be,outWidth:Ve}=function(tt,ot,ut,ft,kt,Ut,It,Lt,zt){let Gt,qt,Ot;if(typeof tt=="number"){Gt={top:tt,bottom:tt,left:tt,right:tt,type:tt===0?"VALID":"NUMBER"};let jt=function(on,bn,An,Bn,Pn){Bn==null&&(Bn=A0(on,bn,An));let mr=on[1];return[xc((on[0]-bn+2*Bn)/An+1,Pn),xc((mr-bn+2*Bn)/An+1,Pn)]}([ot,ut],Ut,ft,tt,Lt);qt=jt[0],Ot=jt[1]}else if(tt==="same"){qt=Math.ceil(ot/ft),Ot=Math.ceil(ut/kt);let jt=Math.max(0,(qt-1)*ft+Ut-ot),on=Math.max(0,(Ot-1)*kt+It-ut),bn=Math.floor(jt/2),An=jt-bn,Bn=Math.floor(on/2);Gt={top:bn,bottom:An,left:Bn,right:on-Bn,type:"SAME"}}else if(tt==="valid")Gt={top:0,bottom:0,left:0,right:0,type:"VALID"},qt=Math.ceil((ot-Ut+1)/ft),Ot=Math.ceil((ut-It+1)/kt);else{if(typeof tt!="object")throw Error(`Unknown padding parameter: ${tt}`);{let jt=zt==="channelsLast"?tt[1][0]:tt[2][0],on=zt==="channelsLast"?tt[1][1]:tt[2][1],bn=zt==="channelsLast"?tt[2][0]:tt[3][0],An=zt==="channelsLast"?tt[2][1]:tt[3][1];Gt={top:jt,bottom:on,left:bn,right:An,type:jt===0&&on===0&&bn===0&&An===0?"VALID":"EXPLICIT"},qt=xc((ot-Ut+jt+on)/ft+1,Lt),Ot=xc((ut-It+bn+An)/kt+1,Lt)}}return{padInfo:Gt,outHeight:qt,outWidth:Ot}}(a,d,m,F,H,se,ge,l,h),ze=u?N*g:N,Xe;return h==="channelsFirst"?Xe=[f,ze,Be,Ve]:h==="channelsLast"&&(Xe=[f,Be,Ve,ze]),{batchSize:f,dataFormat:h,inHeight:d,inWidth:m,inChannels:g,outHeight:Be,outWidth:Ve,outChannels:ze,padInfo:Ce,strideHeight:F,strideWidth:H,filterHeight:x,filterWidth:R,effectiveFilterHeight:se,effectiveFilterWidth:ge,dilationHeight:W,dilationWidth:G,inShape:i,outShape:Xe,filterShape:t}}function bc(i,t,n,s,a,l=!1,u="channelsLast",h){let[f,d,m,g,x]=[-1,-1,-1,-1,-1];if(u==="channelsLast")[f,d,m,g,x]=i;else{if(u!=="channelsFirst")throw new Error(`Unknown dataFormat ${u}`);[f,x,d,m,g]=i}let[R,N,F,,H]=t,[W,G,se]=xm(n),[ge,Ce,Be]=xm(s),Ve=Ih(R,ge),ze=Ih(N,Ce),Xe=Ih(F,Be),{padInfo:tt,outDepth:ot,outHeight:ut,outWidth:ft}=function(It,Lt,zt,Gt,qt,Ot,jt,on,bn,An,Bn){let Pn,mr,_r,vr;if(typeof It=="number"){Pn={top:It,bottom:It,left:It,right:It,front:It,back:It,type:It===0?"VALID":"NUMBER"};let gr=function(Wr,pi,Oi,$r,qr,Ai){qr==null&&(qr=A0(Wr,pi,$r));let ia=Wr[1],$a=Wr[2];return[xc((Wr[0]-pi+2*qr)/$r+1,Ai),xc((ia-pi+2*qr)/$r+1,Ai),xc(($a-pi+2*qr)/$r+1,Ai),1]}([Lt,zt,Gt,1],on,0,qt,It,Bn);mr=gr[0],_r=gr[1],vr=gr[2]}else if(It==="same"){mr=Math.ceil(Lt/qt),_r=Math.ceil(zt/Ot),vr=Math.ceil(Gt/jt);let gr=(mr-1)*qt+on-Lt,Wr=(_r-1)*Ot+bn-zt,pi=(vr-1)*jt+An-Gt,Oi=Math.floor(gr/2),$r=gr-Oi,qr=Math.floor(Wr/2),Ai=Wr-qr,ia=Math.floor(pi/2);Pn={top:qr,bottom:Ai,left:ia,right:pi-ia,front:Oi,back:$r,type:"SAME"}}else{if(It!=="valid")throw Error(`Unknown padding parameter: ${It}`);Pn={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},mr=Math.ceil((Lt-on+1)/qt),_r=Math.ceil((zt-bn+1)/Ot),vr=Math.ceil((Gt-An+1)/jt)}return{padInfo:Pn,outDepth:mr,outHeight:_r,outWidth:vr}}(a,d,m,g,W,G,se,Ve,ze,Xe,h),kt=l?H*x:H,Ut;return u==="channelsFirst"?Ut=[f,kt,ot,ut,ft]:u==="channelsLast"&&(Ut=[f,ot,ut,ft,kt]),{batchSize:f,dataFormat:u,inDepth:d,inHeight:m,inWidth:g,inChannels:x,outDepth:ot,outHeight:ut,outWidth:ft,outChannels:kt,padInfo:tt,strideDepth:W,strideHeight:G,strideWidth:se,filterDepth:R,filterHeight:N,filterWidth:F,effectiveFilterDepth:Ve,effectiveFilterHeight:ze,effectiveFilterWidth:Xe,dilationDepth:ge,dilationHeight:Ce,dilationWidth:Be,inShape:i,outShape:Ut,filterShape:t}}function A0(i,t,n,s=1){let a=Ih(t,s);return Math.floor((i[0]*(n-1)-n+a)/2)}function Rd(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}function xm(i){return typeof i=="number"?[i,i,i]:i}function Ih(i,t){return t<=1?i:i+(i-1)*(t-1)}function xc(i,t){if(!t)return Math.trunc(i);switch(t){case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"floor":return Math.floor(i);default:throw new Error(`Unknown roundingMode ${t}`)}}function Lu(i){let[t,n,s]=Rd(i);return t===1&&n===1&&s===1}function pa(i,t){return Lu(i)||Lu(t)}function nu(i){if(i==="NHWC")return"channelsLast";if(i==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${i}`)}function Ca(i,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${i}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")ee(rt(t),()=>`Error in ${i}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else{if(typeof t!="object")throw Error(`Error in ${i}: Unknown padding parameter: ${t}`);t.forEach(s=>{s.forEach(a=>{ee(rt(a),()=>`Error in ${i}: pad must be an integer when using dimRoundingMode ${n} but got pad ${a}.`)})})}}}let pt=at({reshape_:function(i,t){let n={x:Oe(i,"x","reshape","string_or_numeric")},s={shape:t};return st.runKernel(Ta,n,s)}}),Nd=at({avgPool_:function(i,t,n,s,a){let l=Oe(i,"x","avgPool","float32");ee(pa(n,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`);let u=l,h=!1;l.rank===3&&(h=!0,u=pt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),ee(u.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${u.rank}.`),Ca("avgPool",s,a);let f={x:u},d={filterSize:t,strides:n,pad:s,dimRoundingMode:a},m=st.runKernel(Bi,f,d);return m=En(m,l.dtype),h?pt(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),wc=at({avgPool3d_:function(i,t,n,s,a,l="NDHWC"){let u=Oe(i,"x","avgPool3d","float32"),h=u,f=!1;u.rank===4&&(f=!0,h=pt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),ee(h.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${h.rank}.`),ee(l==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${l}`),Ca("avgPool3d",s,a);let d={x:h},m={filterSize:t,strides:n,pad:s,dimRoundingMode:a,dataFormat:l},g=st.runKernel(le,d,m);return g=En(g,h.dtype),f?pt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),Ti=at({concat_:function(i,t=0){ee(i.length>=1,()=>"Pass at least one tensor to concat");let n=dc(i,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(l=>{if(l.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${l.dtype}. `)}),n.length===1)return Cu(n[0]);let s=n,a={axis:t};return st.runKernel(zn,s,a)}}),ds=at({sigmoid_:function(i){let t={x:Oe(i,"x","sigmoid","float32")};return st.runKernel($o,t)}}),hi=at({slice_:function(i,t,n){let s=Oe(i,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");let a={x:s},l={begin:t,size:n};return st.runKernel(Hl,a,l)}}),kh=at({tanh_:function(i){let t={x:Oe(i,"x","tanh","float32")};return st.runKernel(Al,t)}}),T1=at({basicLSTMCell_:function(i,t,n,s,a,l){let u=Oe(i,"forgetBias","basicLSTMCell"),h=Oe(t,"lstmKernel","basicLSTMCell"),f=Oe(n,"lstmBias","basicLSTMCell"),d=Oe(s,"data","basicLSTMCell"),m=Oe(a,"c","basicLSTMCell"),g=Oe(l,"h","basicLSTMCell"),x=Ti([d,g],1),R=oi(x,h),N=fn(R,f),F=N.shape[0],H=N.shape[1]/4,W=[F,H],G=hi(N,[0,0],W),se=hi(N,[0,H],W),ge=hi(N,[0,2*H],W),Ce=hi(N,[0,3*H],W),Be=fn(qe(ds(G),kh(se)),qe(m,ds(fn(u,ge))));return[Be,qe(kh(Be),ds(Ce))]}}),Yp=at({batchToSpaceND_:function(i,t,n){let s=Oe(i,"x","batchToSpaceND"),a=t.reduce((h,f)=>h*f);ee(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),ee(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),ee(s.shape[0]%a==0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`);let l={x:s},u={blockShape:t,crops:n};return st.runKernel(Ne,l,u)}}),Ld=at({batchNorm_:function(i,t,n,s,a,l){l==null&&(l=.001);let u=Oe(i,"x","batchNorm"),h=Oe(t,"mean","batchNorm"),f=Oe(n,"variance","batchNorm"),d,m;a!=null&&(d=Oe(a,"scale","batchNorm")),s!=null&&(m=Oe(s,"offset","batchNorm")),ee(h.rank===f.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ee(m==null||h.rank===m.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ee(d==null||h.rank===d.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let g={x:function(N){let F;return F=N.rank===0||N.rank===1?pt(N,[1,1,1,N.size]):N.rank===2?pt(N,[1,1,N.shape[0],N.shape[1]]):N.rank===3?pt(N,[1,N.shape[0],N.shape[1],N.shape[2]]):N,F}(u),scale:d,offset:m,mean:h,variance:f},x={varianceEpsilon:l},R=st.runKernel(yp,g,x);return pt(R,u.shape)}}),Hv=at({batchNorm2d_:function(i,t,n,s,a,l){let u=Oe(i,"x","batchNorm"),h=Oe(t,"mean","batchNorm"),f=Oe(n,"variance","batchNorm"),d,m;return a!=null&&(d=Oe(a,"scale","batchNorm")),s!=null&&(m=Oe(s,"offset","batchNorm")),ee(u.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${u.rank}.`),ee(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${h.rank}.`),ee(f.rank===2||f.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${f.rank}.`),d!=null&&ee(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${d.rank}.`),m!=null&&ee(m.rank===2||m.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${m.rank}.`),Ld(u,h,f,m,d,l)}}),Gv=at({batchNorm3d_:function(i,t,n,s,a,l){let u=Oe(i,"x","batchNorm"),h=Oe(t,"mean","batchNorm"),f=Oe(n,"variance","batchNorm"),d,m;return a!=null&&(d=Oe(a,"scale","batchNorm")),s!=null&&(m=Oe(s,"offset","batchNorm")),ee(u.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${u.rank}.`),ee(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${h.rank}.`),ee(f.rank===3||f.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${f.rank}.`),d!=null&&ee(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${d.rank}.`),m!=null&&ee(m.rank===3||m.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${m.rank}.`),Ld(u,h,f,m,d,l)}}),Wv=at({batchNorm4d_:function(i,t,n,s,a,l){let u=Oe(i,"x","batchNorm"),h=Oe(t,"mean","batchNorm"),f=Oe(n,"variance","batchNorm"),d,m;return a!=null&&(d=Oe(a,"scale","batchNorm")),s!=null&&(m=Oe(s,"offset","batchNorm")),ee(u.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${u.rank}.`),ee(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${h.rank}.`),ee(f.rank===4||f.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${f.rank}.`),d!=null&&ee(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${d.rank}.`),m!=null&&ee(m.rank===4||m.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${m.rank}.`),Ld(u,h,f,m,d,l)}}),E0=at({bincount_:function(i,t,n){let s=Oe(i,"x","bincount"),a=Oe(t,"weights","bincount");ee(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),ee(n>=0,()=>`size must be non-negative, but got ${n}.`),ee(a.size===s.size||a.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${a.shape}.`);let l={x:s,weights:a},u={size:n};return st.runKernel(He,l,u)}}),jv=at({broadcastArgs_:function(i,t){let n=Oe(i,"s0","broadcastArgs","int32"),s=Oe(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);let a={s0:n,s1:s};return st.runKernel(gt,a)}}),Dd=at({broadcastTo_:function(i,t){let n=Oe(i,"broadcastTo","x"),s=n.shape;if(t.some(f=>!(f>0)||f%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){let f=n.shape.slice();for(;f.length<t.length;)f.unshift(1);n=pt(n,f)}let a=n.shape,l=Array.from(t);for(let f=t.length-1;f>=0;f--)if(a[f]===t[f])l[f]=1;else if(n.shape[f]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(l.map((f,d)=>f>1?d:-1).filter(f=>f>=0).length===0)return Cu(n);let u={x:n},h={reps:l};return st.runKernel(Fa,u,h)}}),S0=at({ceil_:function(i){let t={x:Oe(i,"x","ceil","float32")};return st.runKernel(Qt,t)}}),Xa=at({clipByValue_:function(i,t,n){let s=Oe(i,"x","clipByValue");ee(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`);let a={x:s},l={clipValueMin:t,clipValueMax:n};return st.runKernel(At,a,l)}}),Xv=at({concat1d_:function(i){return Ti(i,0)}}),qv=at({concat2d_:function(i,t){return Ti(i,t)}}),Kv=at({concat3d_:function(i,t){return Ti(i,t)}}),Yv=at({concat4d_:function(i,t){return Ti(i,t)}}),Du=at({conv2d_:function(i,t,n,s,a="NHWC",l=[1,1],u){let h=Oe(i,"x","conv2d","float32"),f=Oe(t,"filter","conv2d","float32"),d=h,m=!1;h.rank===3&&(m=!0,d=pt(h,[1,h.shape[0],h.shape[1],h.shape[2]])),ee(d.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${d.rank}.`),ee(f.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${f.rank}.`),Ca("conv2d",s,u);let g=a==="NHWC"?d.shape[3]:d.shape[1];ee(g===f.shape[2],()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${f.shape[2]}.`),ee(pa(n,l),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`);let x={x:d,filter:f},R={strides:n,pad:s,dataFormat:a,dilations:l,dimRoundingMode:u},N=st.runKernel(Kn,x,R);return m?pt(N,[N.shape[1],N.shape[2],N.shape[3]]):N}}),wm=at({conv1d_:function(i,t,n,s,a="NWC",l=1,u){let h=Oe(i,"x","conv1d"),f=Oe(t,"filter","conv1d"),d=h,m=!1;h.rank===2&&(m=!0,d=pt(h,[1,h.shape[0],h.shape[1]])),ee(d.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${d.rank}.`),ee(f.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${f.rank}.`),Ca("conv1d",s,u),ee(d.shape[2]===f.shape[1],()=>`Error in conv1d: depth of input (${d.shape[2]}) must match input depth for filter ${f.shape[1]}.`),ee(pa(n,l),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${l}'`),ee(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let g=pt(f,[1,f.shape[0],f.shape[1],f.shape[2]]),x=pt(d,[d.shape[0],1,d.shape[1],d.shape[2]]),R=Du(x,g,[1,n],s,"NHWC",[1,l],u);return pt(R,m?[R.shape[2],R.shape[3]]:[R.shape[0],R.shape[2],R.shape[3]])}}),T0=at({conv2DBackpropInput_:function(i,t,n,s,a,l="NHWC",u){ee(i.length===t.rank,()=>`Length of inShape (${i.length}) and rank of dy (${t.rank}) must match`);let h=i,f=t,d=!1;t.rank===3&&(d=!0,f=pt(t,[1,t.shape[0],t.shape[1],t.shape[2]]),h=[1,i[0],i[1],i[2]]),ee(h.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${h.length}.`),ee(f.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${f.rank}`),ee(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);let m=l==="NHWC"?h[3]:h[1],g=l==="NHWC"?f.shape[3]:f.shape[1];ee(m===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${m}) must match input depth for filter ${n.shape[2]}.`),ee(g===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${g}) must match output depth for filter ${n.shape[3]}.`),Ca("conv2dDerInput",a,u);let x={dy:f,filter:n},R={strides:s,pad:a,dataFormat:l,dimRoundingMode:u,inputShape:h},N=st.runKernel(Rr,x,R);return d?pt(N,[N.shape[1],N.shape[2],N.shape[3]]):N}}),Am=at({conv2dTranspose_:function(i,t,n,s,a,l){let u=Oe(i,"x","conv2dTranspose"),h=Oe(t,"filter","conv2dTranspose");return T0(n,u,h,s,a,"NHWC",l)}}),M0=at({conv3d_:function(i,t,n,s,a="NDHWC",l=[1,1,1]){let u=Oe(i,"x","conv3d"),h=Oe(t,"filter","conv3d"),f=u,d=!1;u.rank===4&&(d=!0,f=pt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),ee(f.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${f.rank}.`),ee(h.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${h.rank}.`),ee(f.shape[4]===h.shape[3],()=>`Error in conv3d: depth of input (${f.shape[4]}) must match input depth for filter ${h.shape[3]}.`),ee(pa(n,l),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`),ee(a==="NDHWC",()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`);let m={x:f,filter:h},g={strides:n,pad:s,dataFormat:a,dilations:l},x=st.runKernel(Nr,m,g);return d?pt(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}}),Qv=at({conv3DBackpropInput_:function(i,t,n,s,a){ee(i.length===t.rank,()=>`Length of inShape (${i.length}) and rank of dy (${t.rank}) must match`);let l=i,u=t,h=!1;t.rank===4&&(h=!0,u=pt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),l=[1,i[0],i[1],i[2],i[3]]);let f=l[4],d=u.shape[4];ee(l.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${l.length}.`),ee(u.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${u.rank}`),ee(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),ee(f===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${f}) must match input depth for filter ${n.shape[3]}.`),ee(d===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[4]}.`);let m={dy:u,filter:n},g={pad:a,strides:s,inputShape:l},x=st.runKernel(ki,m,g);return h?pt(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}}),Zv=at({conv3dTranspose_:function(i,t,n,s,a){let l=Oe(i,"x","conv3dTranspose"),u=Oe(t,"filter","conv3dTranspose");return Qv(n,l,u,s,a)}}),Qp=at({cos_:function(i){let t={x:Oe(i,"x","cos","float32")};return st.runKernel(Ji,t)}}),Em=at({cosh_:function(i){let t={x:Oe(i,"x","cosh","float32")};return st.runKernel(vs,t)}}),Sm=at({cumsum_:function(i,t=0,n=!1,s=!1){let a={x:Oe(i,"x","cumsum")},l={axis:t,exclusive:n,reverse:s};return st.runKernel(Ei,a,l)}}),Jv=at({denseBincount_:function(i,t,n,s=!1){let a=Oe(i,"x","denseBincount"),l=Oe(t,"weights","denseBincount");ee(a.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`),ee(a.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`),ee(n>=0,()=>`size must be non-negative, but got ${n}.`),ee(l.size===a.size||l.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${l.shape}.`);let u={x:a,weights:l},h={size:n,binaryOutput:s};return st.runKernel(oa,u,h)}}),_0=at({depthToSpace_:function(i,t,n="NHWC"){let s=Oe(i,"x","depthToSpace","float32"),a=n==="NHWC"?s.shape[1]:s.shape[2],l=n==="NHWC"?s.shape[2]:s.shape[3],u=n==="NHWC"?s.shape[3]:s.shape[1];ee(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),ee(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t}  for depthToSpace with input shape
    ${s.shape}`),ee(l*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${l} and ${t} for depthToSpace with input shape
        ${s.shape}`),ee(u%(t*t)==0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${u} for depthToSpace with input shape ${s.shape}`);let h={x:s},f={blockSize:t,dataFormat:n};return st.runKernel(la,h,f)}}),Fd=at({depthwiseConv2d_:function(i,t,n,s,a="NHWC",l=[1,1],u){let h=Oe(i,"x","depthwiseConv2d","float32"),f=Oe(t,"filter","depthwiseConv2d","float32"),d=h,m=!1;h.rank===3&&(m=!0,d=pt(h,[1,h.shape[0],h.shape[1],h.shape[2]])),ee(d.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),ee(f.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),ee(d.shape[3]===f.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),Ca("depthwiseConv2d",s,u);let g={x:d,filter:f},x={strides:n,pad:s,dataFormat:a,dilations:l,dimRoundingMode:u},R=st.runKernel(bs,g,x);return m?pt(R,[R.shape[1],R.shape[2],R.shape[3]]):R}}),M1=at({diag_:function(i){let t={x:Oe(i,"x","diag")};return st.runKernel(Eo,t)}}),C0=at({dilation2d_:function(i,t,n,s,a=[1,1],l="NHWC"){let u=Oe(i,"x","dilation2d"),h=Oe(t,"filter","dilation2d");ee(u.rank===3||u.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${u.rank}.`),ee(h.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${h.rank}.`),ee(l==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${l}`);let f=u,d=!1;u.rank===3&&(f=pt(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=!0);let m={x:f,filter:h},g={strides:n,pad:s,dilations:a},x=st.runKernel(dl,m,g);return d?pt(x,[x.shape[1],x.shape[2],x.shape[3]]):x}}),so=at({equal_:function(i,t){let n=Oe(i,"a","equal","string_or_numeric"),s=Oe(t,"b","equal","string_or_numeric");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(pl,a)}}),Ia=at({where_:function(i,t,n){let s=Oe(t,"a","where"),a=Oe(n,"b","where"),l=Oe(i,"condition","where","bool"),u=Zr(Zr(l.shape,s.shape),a.shape),h={condition:Dd(l,u),t:Dd(s,u),e:Dd(a,u)};return st.runKernel(oh,h)}}),I0=at({divNoNan_:function(i,t){let n=Oe(i,"a","div"),s=Oe(t,"b","div");[n,s]=ls(n,s);let a=yn(n,s),l=wi(a),u=so(s,l);return Ia(u,l,a)}}),eb=at({dot_:function(i,t){let n=Oe(i,"t1","dot"),s=Oe(t,"t2","dot");ee(!(n.rank!==1&&n.rank!==2||s.rank!==1&&s.rank!==2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);let a=n.rank===1?n.size:n.shape[1],l=s.rank===1?s.size:s.shape[0];if(ee(a===l,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${l}.`),n.rank===1&&s.rank===1){let u=pt(n,[1,-1]),h=pt(s,[-1,1]),f=oi(u,h);return pt(f,[])}if(n.rank===1&&s.rank===2){let u=pt(n,[1,-1]),h=pt(s,[s.shape[0],s.shape[1]]),f=oi(u,h);return pt(f,[f.size])}if(n.rank===2&&s.rank===1){let u=pt(s,[-1,1]),h=oi(n,u);return pt(h,[h.size])}{let u=pt(s,[s.shape[0],s.shape[1]]);return oi(n,u)}}}),tb=at({einsum_:function(i,...t){let n=t.map((a,l)=>Oe(a,`tensors${l}`,"einsum")),s={equation:i};return st.runKernel(Bl,n,s)}}),Pd=at({elu_:function(i){let t={x:Oe(i,"x","elu","float32")};return st.runKernel(Bo,t)}}),k0=at({erf_:function(i){let t=Oe(i,"x","erf");ee(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=En(t,"float32"));let n={x:t};return st.runKernel(Uo,n)}}),ao=at({exp_:function(i){let t={x:Oe(i,"x","exp")};return st.runKernel(zo,t)}}),qa=at({expandDims_:function(i,t=0){let n=Oe(i,"x","expandDims","string_or_numeric");ee(t<=n.rank,()=>"Axis must be <= rank of the tensor");let s={input:n},a={dim:t};return st.runKernel(xs,s,a)}}),R0=at({expm1_:function(i){let t={x:Oe(i,"x","expm1")};return st.runKernel(rd,t)}}),oo=at({tile_:function(i,t){let n=Oe(i,"x","tile","string_or_numeric");ee(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);let s={x:n},a={reps:t};return st.runKernel(Fa,s,a)}}),Tm=at({eye_:function(i,t,n,s="float32"){t==null&&(t=i);let a=ci([i,t],s),l=i<=t?i:t;for(let h=0;h<l;++h)a.set(1,h,h);let u=pt(a.toTensor(),[i,t]);if(n==null)return u;if(n.length===1)return oo(qa(u,0),[n[0],1,1]);if(n.length===2)return oo(qa(qa(u,0),0),[n[0],n[1],1,1]);if(n.length===3)return oo(qa(qa(qa(u,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}}),Ac=at({floor_:function(i){let t={x:Oe(i,"x","floor","float32")};return st.runKernel(fl,t)}}),Ec=at({gather_:function(i,t,n=0,s=0){let a={x:Oe(i,"x","gather"),indices:Oe(t,"indices","gather","int32")},l={axis:n,batchDims:s};return st.runKernel(vp,a,l)}}),Ka=at({greater_:function(i,t){let n=Oe(i,"a","greater","string_or_numeric"),s=Oe(t,"b","greater","string_or_numeric");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(bp,a)}}),Ya=at({greaterEqual_:function(i,t){let n=Oe(i,"a","greaterEqual","string_or_numeric"),s=Oe(t,"b","greaterEqual","string_or_numeric");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(sd,a)}}),Zp=at({imag_:function(i){let t={input:Oe(i,"input","imag")};return st.runKernel(od,t)}}),nb=at({isFinite_:function(i){let t={x:Oe(i,"x","isFinite")};return st.runKernel(bu,t)}}),rb=at({isInf_:function(i){let t={x:Oe(i,"x","isInf")};return st.runKernel(to,t)}}),N0=at({isNaN_:function(i){let t={x:Oe(i,"x","isNaN")};return st.runKernel($s,t)}}),Od=at({leakyRelu_:function(i,t=.2){let n={x:Oe(i,"x","leakyRelu")},s={alpha:t};return st.runKernel(rc,n,s)}}),Mm=at({less_:function(i,t){let n=Oe(i,"a","less","string_or_numeric"),s=Oe(t,"b","less","string_or_numeric");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(ml,a)}}),Sc=at({lessEqual_:function(i,t){let n=Oe(i,"a","lessEqual","string_or_numeric"),s=Oe(t,"b","lessEqual","string_or_numeric");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(xu,a)}});function ib(i,t,n){if(n<=0)throw new Error("The number of values should be positive.");let s={start:i,stop:t,num:n};return st.runKernel(Da,{},s)}let L0=at({localResponseNormalization_:function(i,t=5,n=1,s=1,a=.5){let l=Oe(i,"x","localResponseNormalization");ee(l.rank===4||l.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${l.rank}.`),ee(rt(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let u=l,h=!1;l.rank===3&&(h=!0,u=pt(l,[1,l.shape[0],l.shape[1],l.shape[2]]));let f={x:u},d={depthRadius:t,bias:n,alpha:s,beta:a},m=st.runKernel(Ap,f,d);return h?pt(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),lo=at({log_:function(i){let t={x:Oe(i,"x","log","float32")};return st.runKernel(Vs,t)}}),Fu=at({log1p_:function(i){let t={x:Oe(i,"x","log1p")};return st.runKernel(ic,t)}}),ps=at({neg_:function(i){let t={x:Oe(i,"x","neg")};return st.runKernel(cd,t)}}),Tc=at({softplus_:function(i){let t={x:Oe(i,"x","softplus")};return st.runKernel(Gl,t)}}),sb=at({logSigmoid_:function(i){let t=Oe(i,"x","logSigmoid");return ja(n=>({value:ps(Tc(ps(n))),gradFunc:s=>qe(s,ds(ps(n)))}))(t)}}),uo=at({max_:function(i,t=null,n=!1){let s={x:Oe(i,"x","max")},a={reductionIndices:t,keepDims:n};return st.runKernel(Ep,s,a)}}),Yn=at({sum_:function(i,t=null,n=!1){let s=Oe(i,"x","sum");s.dtype==="bool"&&(s=En(s,"int32"));let a={x:s},l={axis:t,keepDims:n};return st.runKernel(uc,a,l)}}),_m=at({logSoftmax_:function(i,t=-1){let n=Oe(i,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return ja((s,a)=>{let l=uo(s,t,!0),u=Un(s,l),h=Un(En(u,"float32"),lo(Yn(ao(u),t,!0)));return a([h]),{value:h,gradFunc:(f,d)=>{let[m]=d,g=ao(m);return Un(f,qe(Yn(f,t,!0),g))}}})(n)}});function D0(i,t){for(let n=0;n<i.length;++n)if(i[i.length-n-1]!==t-1-n)return!1;return!0}function F0(i,t,n){let s=i.length+t.length,a=[],l=0,u=0;for(let h=0;h<s;h++)n.indexOf(h)===-1?a.push(i[l++]):a.push(t[u++]);return a}function fa(i,t){let n=[],s=i.length;for(let a=0;a<s;a++)t.indexOf(a)===-1&&n.push(i[a]);return[n,t.map(a=>i[a])]}function Ls(i,t){return F0(i,t.map(n=>1),t)}function ma(i,t,n){ee(D0(t,n),()=>`${i} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function Ws(i,t){if(D0(i,t))return null;let n=[];for(let s=0;s<t;++s)i.indexOf(s)===-1&&n.push(s);return i.forEach(s=>n.push(s)),n}function Bd(i){return i.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function Zs(i,t){let n=[];for(let s=t-i;s<t;++s)n.push(s);return n}let P0=at({logSumExp_:function(i,t=null,n=!1){let s=Oe(i,"x","logSumExp"),a=Zn(t,s.shape),l=uo(s,a,!0),u=Un(s,l),h=ao(u),f=Yn(h,a),d=lo(f),m=fn(pt(l,d.shape),d);if(n){let g=Ls(m.shape,a);return pt(m,g)}return m}}),Yo=at({logicalAnd_:function(i,t){let n=Oe(i,"a","logicalAnd","bool"),s=Oe(t,"b","logicalAnd","bool");Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(xp,a)}}),Jp=at({logicalNot_:function(i){let t={x:Oe(i,"x","logicalNot","bool")};return st.runKernel(wp,t)}}),Cm=at({logicalOr_:function(i,t){let n=Oe(i,"a","logicalOr","bool"),s=Oe(t,"b","logicalOr","bool");Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(wu,a)}}),ab=at({logicalXor_:function(i,t){let n=Oe(i,"a","logicalXor","bool"),s=Oe(t,"b","logicalXor","bool");return Zr(n.shape,s.shape),Yo(Cm(i,t),Jp(Yo(i,t)))}}),ef=at({maxPool_:function(i,t,n,s,a){let l=Oe(i,"x","maxPool"),u=l,h=!1;l.rank===3&&(h=!0,u=pt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),ee(u.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${u.rank}.`),ee(pa(n,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`),Ca("maxPool",s,a);let f={x:u},d={filterSize:t,strides:n,pad:s,dimRoundingMode:a},m=st.runKernel(Sp,f,d);return h?pt(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),O0=at({maxPool3d_:function(i,t=[1,1,1],n,s,a,l="NDHWC"){let u=Oe(i,"x","maxPool3d"),h=u,f=!1;u.rank===4&&(f=!0,h=pt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),ee(h.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${h.rank}.`),ee(l==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${l}`),Ca("maxPool3d",s,a);let d={x:h},m={filterSize:t,strides:n,pad:s,dimRoundingMode:a,dataFormat:l},g=st.runKernel(Tp,d,m);return f?pt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),ob=at({maxPoolWithArgmax_:function(i,t,n,s,a=!1){let l={x:Oe(i,"x","maxPoolWithArgmax")},u={filterSize:t,strides:n,pad:s,includeBatchInIndex:a},h=st.runKernel(sm,l,u);return{result:h[0],indexes:h[1]}}}),ws=at({mean_:function(i,t=null,n=!1){let s={x:Oe(i,"x","mean")},a={axis:t,keepDims:n};return st.runKernel(nh,s,a)}});function js(i,t="float32"){if(t==="complex64"){let s=js(i,"float32"),a=js(i,"float32");return Jl(s,a)}let n=li(me(i),t);return st.makeTensor(n,i,t)}function co(i,t="float32"){if(t==="complex64"){let s=co(i,"float32"),a=js(i,"float32");return Jl(s,a)}let n=Fi(me(i),t);return st.makeTensor(n,i,t)}function _1(i,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(i===void 0)return[];let s=Oe(i,"x","meshgrid",i instanceof Ni?i.dtype:"float32");if(t===void 0)return[s];let a=Oe(t,"y","meshgrid",t instanceof Ni?t.dtype:"float32"),l=me(s.shape),u=me(a.shape);return n==="xy"?(s=pt(s,[1,-1]),a=pt(a,[-1,1]),[oi(co([u,1],s.dtype),s),oi(a,co([1,l],a.dtype))]):(s=pt(s,[-1,1]),a=pt(a,[1,-1]),[oi(s,co([1,u],s.dtype)),oi(co([l,1],a.dtype),a)])}let tf=at({min_:function(i,t=null,n=!1){let s={x:Oe(i,"x","min")},a={axis:t,keepDims:n};return st.runKernel(ud,s,a)}}),Ud=at({minimum_:function(i,t){let n=Oe(i,"a","minimum"),s=Oe(t,"b","minimum");[n,s]=ls(n,s),n.dtype==="bool"&&(n=En(n,"int32"),s=En(s,"int32")),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(rh,a)}}),B0=at({mirrorPad_:function(i,t,n){ee(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);let s=Oe(i,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ee(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);let a=n==="reflect"?1:0;for(let h=0;h<s.rank;h++)ee(t[h].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ee(t[h][0]>=0&&t[h][0]<=s.shape[h]-a&&t[h][1]>=0&&t[h][1]<=s.shape[h]-a,()=>`Padding in dimension ${h} cannot be greater than or equal to ${s.shape[h]-a} or less than 0 for input of shape ${s.shape}`);let l={paddings:t,mode:n},u={x:s};return st.runKernel(Mp,u,l)}}),U0=at({mod_:function(i,t){let n=Oe(i,"a","mod"),s=Oe(t,"b","mod");[n,s]=ls(n,s);let a={a:n,b:s};return st.runKernel(ih,a)}}),nf=at({moments_:function(i,t=null,n=!1){let s=Zn(t,(i=Oe(i,"x","moments")).shape),a=ws(i,s,n),l=a.shape;n||(l=Ls(a.shape,s));let u=es(Un(En(i,"float32"),pt(a,l)));return{mean:a,variance:ws(u,s,n)}}}),C1=at({multiRNNCell_:function(i,t,n,s){let a=Oe(t,"data","multiRNNCell"),l=dc(n,"c","multiRNNCell"),u=dc(s,"h","multiRNNCell"),h=a,f=[];for(let g=0;g<i.length;g++){let x=i[g](h,l[g],u[g]);f.push(x[0]),f.push(x[1]),h=x[1]}let d=[],m=[];for(let g=0;g<f.length;g+=2)d.push(f[g]),m.push(f[g+1]);return[d,m]}}),rf=at({multinomial_:function(i,t,n,s=!1){let a=Oe(i,"logits","multinomial"),l=a.size,u=a.rank;if(l<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${l}.`);if(u>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${u}`);n=n||Math.random();let h={logits:u===1?pt(a,[1,-1]):a},f={numSamples:t,seed:n,normalized:s},d=st.runKernel(un,h,f);return u===1?pt(d,[d.size]):d}}),ru=at({notEqual_:function(i,t){let n=Oe(i,"a","notEqual","string_or_numeric"),s=Oe(t,"b","notEqual","string_or_numeric");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(_p,a)}}),ho=at({onesLike_:function(i){let t={x:Oe(i,"x","onesLike")};return st.runKernel(Ga,t)}}),I1=at({outerProduct_:function(i,t){let n=Oe(i,"v1","outerProduct"),s=Oe(t,"v2","outerProduct");ee(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);let a=pt(n,[-1,1]),l=pt(s,[1,-1]);return oi(a,l)}}),iu=at({pad_:function(i,t,n=0){let s=Oe(i,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:t,constantValue:n},l={x:s};return st.runKernel(zl,l,a)}}),k1=at({pad1d_:function(i,t,n=0){return ee(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),iu(i,[t],n)}}),R1=at({pad2d_:function(i,t,n=0){return ee(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),iu(i,t,n)}}),lb=at({pad3d_:function(i,t,n=0){return ee(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),iu(i,t,n)}}),Mc=at({pad4d_:function(i,t,n=0){return ee(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),iu(i,t,n)}}),_c=at({spaceToBatchND_:function(i,t,n){let s=Oe(i,"x","spaceToBatchND");ee(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),ee(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),ee(s.shape.reduce((u,h,f)=>f>0&&f<=t.length?u&&(h+n[f-1][0]+n[f-1][1])%t[f-1]==0:u,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);let a={x:s},l={blockShape:t,paddings:n};return st.runKernel(bl,a,l)}}),z0=at({pool_:function(i,t,n,s,a,l,u){a==null&&(a=[1,1]),l==null&&(l=1),s===0&&(s="valid");let h=Oe(i,"x","maxPool"),f=h,d=!1;h.rank===3&&(d=!0,f=pt(h,[1,h.shape[0],h.shape[1],h.shape[2]])),ee(pa(l,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${l} and dilations '${a}'`);let m=Ko(f.shape,t,l,a,s),g=[m.dilationHeight,m.dilationWidth],x;x=s==="same"?function(ge,Ce){let Be=ge.map((Xe,tt)=>Xe+(Xe-1)*(Ce[tt]-1)).map(Xe=>Xe-1),Ve=Be.map(Xe=>Math.floor(Xe/2)),ze=Be.map((Xe,tt)=>Xe-Ve[tt]);return Be.map((Xe,tt)=>[Ve[tt],ze[tt]])}([m.filterHeight,m.filterWidth],g):[[0,0],[0,0]];let R=g[0]===1&&g[1]===1,[N,F]=function(ge,Ce,Be){let Ve=Be.map(ut=>ut[0]),ze=Be.map(ut=>ut[1]),Xe=ge.concat(Ve,ze),tt=Ce.map((ut,ft)=>(ut-Xe[ft]%ut)%ut),ot=ze.map((ut,ft)=>ut+tt[ft]);return[Ce.map((ut,ft)=>[Ve[ft],ot[ft]]),Ce.map((ut,ft)=>[0,tt[ft]])]}([m.inHeight,m.inWidth],g,x),H=R?s:"valid",W=R?f:_c(f,g,N),G=(n==="avg"?()=>Nd(W,t,l,H,u):()=>ef(W,t,l,H,u))(),se=R?G:Yp(G,g,F);return d?pt(se,[se.shape[1],se.shape[2],se.shape[3]]):se}}),zd=at({prelu_:function(i,t){let n={x:Oe(i,"x","prelu"),alpha:Oe(t,"alpha","prelu")};return st.runKernel($l,n)}}),Im=at({prod_:function(i,t=null,n=!1){let s=Oe(i,"x","prod");s.dtype==="bool"&&(s=En(s,"int32"));let a={x:s},l={axis:t,keepDims:n};return st.runKernel(gl,a,l)}}),ub=at({rand_:function(i,t,n){let s=me(i),a=null;if(n==null||n==="float32")a=new Float32Array(s);else if(n==="int32")a=new Int32Array(s);else{if(n!=="bool")throw new Error(`Unknown data type ${n}`);a=new Uint8Array(s)}for(let l=0;l<s;l++)a[l]=t();return st.makeTensor(a,i,n)}});var $d=ae(6377);class sf{constructor(t,n,s,a,l){this.mean=t,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);let u=l||Math.random();this.random=$d.alea(u.toString())}nextValue(){if(!isNaN(this.nextVal)){let a=this.nextVal;return this.nextVal=NaN,a}let t,n,s=!1;for(;!s;){let a,l,u;do a=2*this.random()-1,l=2*this.random()-1,u=a*a+l*l;while(u>=1||u===0);let h=Math.sqrt(-2*Math.log(u)/u);t=this.mean+this.stdDev*a*h,n=this.mean+this.stdDev*l*h,this.truncated&&!this.isValidTruncated(t)||(s=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class km{constructor(t,n,s,a){this.alpha=t,this.beta=1/n,this.dtype=s;let l=a||Math.random();this.randu=$d.alea(l.toString()),this.randn=new sf(0,1,s,!1,this.randu()),this.d=t<1?t+.6666666666666666:t-.3333333333333333,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,n,s,a,l,u;for(;;){do a=this.randn.nextValue(),u=1+this.c*a;while(u<=0);if(u*=u*u,t=a*a,n=1-.331*t*t,s=.5*t+this.d*(1-u+Math.log(u)),l=this.randu(),l<n||Math.log(l)<s)break}return u=1/this.beta*this.d*u,this.alpha<1&&(u*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(u)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}}class N1{constructor(t=0,n=1,s,a){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=s,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=$d.alea(a)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}let L1=at({randomGamma_:function(i,t,n=1,s="float32",a){if(n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);let l=new km(t,n,s,a),u=ci(i,s);for(let h=0;h<u.values.length;h++)u.values[h]=l.nextValue();return u.toTensor()}}),cb=at({randomNormal_:function(i,t=0,n=1,s,a){if(s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);let l=new sf(t,n,s,!1,a),u=ci(i,s);for(let h=0;h<u.values.length;h++)u.values[h]=l.nextValue();return u.toTensor()}}),Gi=at({randomUniform_:function(i,t=0,n=1,s="float32",a){let l=ci(i,s),u=new N1(t,n,null,a);for(let h=0;h<l.values.length;h++)l.values[h]=u.nextValue();return l.toTensor()}});function Rh(i,t,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");let a={start:i,stop:t,step:n,dtype:s};return st.runKernel(am,{},a)}let Pu=at({real_:function(i){let t={input:Oe(i,"input","real")};return st.runKernel(Rs,t)}}),Nh=at({reciprocal_:function(i){let t={x:Oe(i,"x","reciprocal")};return st.runKernel(oc,t)}}),po=at({relu_:function(i){let t={x:Oe(i,"x","relu")};return st.runKernel(Si,t)}}),su=at({relu6_:function(i){let t={x:Oe(i,"x","relu6")};return st.runKernel(lc,t)}}),Pi=at({reverse_:function(i,t){let n={x:Oe(i,"x","reverse")},s={dims:t};return st.runKernel(dd,n,s)}}),Cc=at({reverse1d_:function(i){let t=Oe(i,"x","reverse");return ee(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Pi(t,0)}}),Rm=at({reverse2d_:function(i,t){let n=Oe(i,"x","reverse");return ee(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),Pi(n,t)}}),Vd=at({reverse3d_:function(i,t){let n=Oe(i,"x","reverse");return ee(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),Pi(n,t)}}),af=at({reverse4d_:function(i,t){let n=Oe(i,"x","reverse");return ee(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),Pi(n,t)}}),Ou=at({round_:function(i){let t={x:Oe(i,"x","round")};return st.runKernel(va,t)}}),Bu=at({rsqrt_:function(i){let t={x:Oe(i,"x","rsqrt","float32")};return st.runKernel(no,t)}}),Uu=at({selu_:function(i){let t={x:Oe(i,"x","selu")};return st.runKernel(yl,t)}}),Lh=at({separableConv2d_:function(i,t,n,s,a,l=[1,1],u="NHWC"){let h=Oe(i,"x","separableConv2d"),f=Oe(t,"depthwiseFilter","separableConv2d"),d=Oe(n,"pointwiseFilter","separableConv2d"),m=h,g=!1;if(h.rank===3&&(g=!0,m=pt(h,[1,h.shape[0],h.shape[1],h.shape[2]])),u==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ee(m.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${m.rank}.`),ee(f.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${f.rank}.`),ee(d.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${f.rank}.`),ee(d.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${d.shape[0]}.`),ee(d.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${d.shape[1]}.`);let x=f.shape[2],R=f.shape[3];ee(d.shape[2]===x*R,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${x*R}, but got ${d.shape[2]}.`);let N=Fd(m,f,s,a,u,l),F=Du(N,d,1,"valid",u);return g?pt(F,[F.shape[1],F.shape[2],F.shape[3]]):F}}),$0=async function(i,t){let n=Oe(i,"x","setdiff1d"),s=Oe(t,"y","setdiff1d");ee(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),ee(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),ee(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);let a=await n.data(),l=await s.data(),u=new Set(l),h=0;for(let m=0;m<a.length;m++)u.has(a[m])||h++;let f=new Hi([h],n.dtype),d=new Hi([h],"int32");for(let m=0,g=0;m<a.length;m++)u.has(a[m])||(f.values[g]=a[m],d.values[g]=m,g++);return[f.toTensor(),d.toTensor()]},Hd=at({sign_:function(i){let t={x:Oe(i,"x","sign")};return st.runKernel(To,t)}}),Ic=at({sin_:function(i){let t={x:Oe(i,"x","sin","float32")};return st.runKernel(vl,t)}}),Dh=at({sinh_:function(i){let t={x:Oe(i,"x","sinh")};return st.runKernel(So,t)}}),of=at({slice1d_:function(i,t,n){let s=Oe(i,"x","slice1d");return ee(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),hi(s,[t],[n])}}),lf=at({slice2d_:function(i,t,n){let s=Oe(i,"x","slice2d");return ee(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),hi(s,t,n)}}),uf=at({slice3d_:function(i,t,n){let s=Oe(i,"x","slice3d");return ee(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),hi(s,t,n)}}),kc=at({slice4d_:function(i,t,n){let s=Oe(i,"x","slice4d");return ee(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),hi(s,t,n)}}),Rc=at({softmax_:function(i,t=-1){let n=Oe(i,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);let s={logits:n},a={dim:t};return st.runKernel(Ip,s,a)}}),Nc=at({fft_:function(i){ee(i.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${i.dtype}.`);let t={input:i};return st.runKernel(Jf,t)}}),Fh=at({ifft_:function(i){ee(i.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${i.dtype}.`);let t={input:i};return st.runKernel(tm,t)}}),cf=at({irfft_:function(i){let t=i.shape[i.shape.length-1],n=i.size/t,s;if(t<=2){let a=pt(i,[n,t]);s=Fh(a)}else{let a=[n,2*(t-1)],l=pt(Pu(i),[n,t]),u=pt(Zp(i),[n,t]),h=Pi(hi(l,[0,1],[n,t-2]),1),f=qe(Pi(hi(u,[0,1],[n,t-2]),1),Jn(-1)),d=Ti([l,h],1),m=Ti([u,f],1),g=pt(Jl(d,m),[a[0],a[1]]);s=Fh(g)}if(s=Pu(s),i.rank===3&&i.shape[0]!==0){let a=s,l=i.shape[0];s=pt(s,[l,s.shape[0]/l,s.shape[1]]),a.dispose()}return s}}),Oa=at({split_:function(i,t,n=0){let s={x:Oe(i,"x","split")},a={numOrSizeSplits:t,axis:n};return st.runKernel(lh,s,a)}}),Gd=at({rfft_:function(i,t){ee(i.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${i.dtype}`);let n=i.shape[i.shape.length-1],s=i.size/n,a;if(t!=null&&t<n){let N=i.shape.map(H=>0),F=i.shape.map(H=>H);F[i.shape.length-1]=t,a=hi(i,N,F),n=t}else if(t!=null&&t>n){let N=i.shape.map(F=>F);N[i.shape.length-1]=t-n,a=Ti([i,js(N)],i.shape.length-1),n=t}else a=i;let l=wi(a),u=pt(Jl(a,l),[s,n]),h=Nc(u),f=Math.floor(n/2)+1,d=Pu(h),m=Zp(h),g=Oa(d,[f,n-f],d.shape.length-1),x=Oa(m,[f,n-f],m.shape.length-1),R=a.shape.slice();return R[a.shape.length-1]=f,pt(Jl(g[0],x[0]),R)}}),hf=at({squaredDifference_:function(i,t){let n=Oe(i,"a","squaredDifference"),s=Oe(t,"b","squaredDifference");[n,s]=ls(n,s),Zr(n.shape,s.shape);let a={a:n,b:s};return st.runKernel(cc,a,{})}}),au=at({squeeze_:function(i,t){let n=Oe(i,"x","squeeze");return pt(n,Ii(n.shape,t).newShape)}}),Qa=at({stack_:function(i,t=0){let n=dc(i,"tensors","stack","string_or_numeric");ee(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&ee(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");let s=n,a={axis:t};return st.runKernel(sh,s,a)}}),zu=at({step_:function(i,t=0){let n={x:Oe(i,"x","step")},s={alpha:t};return st.runKernel(Go,n,s)}}),Wd=at({stridedSlice_:function(i,t,n,s,a=0,l=0,u=0,h=0,f=0){let d={x:Oe(i,"x","stridedSlice","string_or_numeric")},m={begin:t,end:n,strides:s,beginMask:a,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f};return st.runKernel(wl,d,m)}}),$u=at({tan_:function(i){let t={x:Oe(i,"x","tan","float32")};return st.runKernel(Wn,t)}});function ga(i,t){X(i);let n=ro(i,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return pc(i,null,n,t)}function Ph(i,t,n){if(X(i),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let s=ro(i,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return pc(i,t,s,n)}function Nm(i,t,n){if(X(i),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let s=ro(i,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return pc(i,t,s,n)}function Oh(i,t,n){if(X(i),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let s=ro(i,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return pc(i,t,s,n)}function hb(i,t,n){if(X(i),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let s=ro(i,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return pc(i,t=t||s,s,n)}let Lm=at({topk_:function(i,t=1,n=!0){let s=Oe(i,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);let l={x:s},u={k:t,sorted:n},[h,f]=st.runKernel(om,l,u);return{values:h,indices:f}}}),Bh=at({truncatedNormal_:function(i,t=0,n=1,s,a){if(s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");let l=new sf(t,n,s,!0,a),u=ci(i,s);for(let h=0;h<u.values.length;h++)u.values[h]=l.nextValue();return u.toTensor()}}),Lc=at({unique_:function(i,t=0){let n=Oe(i,"x","unique","string_or_numeric");ee(n.rank>0,()=>"The input tensor must be at least 1D");let s={x:n},a={axis:t},[l,u]=st.runKernel(dh,s,a);return{values:l,indices:u}}}),df=at({unsortedSegmentSum_:function(i,t,n){let s=Oe(i,"x","unsortedSegmentSum"),a=Oe(t,"segmentIds","unsortedSegmentSum","int32");ee(rt(n),()=>"numSegments must be of dtype int");let l={x:s,segmentIds:a},u={numSegments:n};return st.runKernel(gd,l,u)}}),ts=at({unstack_:function(i,t=0){let n=Oe(i,"x","unstack","string_or_numeric");ee(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);let s={value:n},a={axis:t};return st.runKernel(Ma,s,a)}});function V0(i,t=!0,n,s){return st.makeVariable(i,t,n,s)}function pf(i,t){let n=[];for(let l=0;l<t.length;l++)t[l]&&n.push(l);let s=ci(i,"int32"),a=ci([n.length,i.length],"int32");for(let l=0;l<n.length;l++){let u=s.indexToLoc(n[l]),h=l*i.length;a.values.set(u,h)}return a.toTensor()}let Dm=async function(i){let t=Oe(i,"condition","whereAsync","bool"),n=await t.data(),s=pf(t.shape,n);return i!==t&&t.dispose(),s},H0=async function(i,t,n){let s=Oe(i,"tensor","boolMask"),a=Oe(t,"mask","boolMask","bool"),l=n??0,u=a.rank,h=s.shape;ee(u>0,()=>"mask cannot be scalar"),ie(h.slice(l,l+u),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let f=1;for(let F=l;F<l+u;F++)f*=h[F];let d=h.slice(0,l).concat([f],h.slice(l+u)),m=pt(s,d),g=pt(a,[-1]),x=await Dm(g),R=au(x,[1]),N=Ec(m,R,l);return i!==s&&s.dispose(),t!==a&&a.dispose(),R.dispose(),m.dispose(),g.dispose(),x.dispose(),N};function ff(i,t,n=null){if(i.rank===0)return _s(i);if(i.rank!==1&&n===null)return ff(pt(i,[-1]),t,n);if(i.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return Yn(_s(i),n);if(t===1/0)return uo(_s(i),n);if(t===-1/0)return tf(_s(i),n);if(t==="euclidean"||t===2)return rs(Yn(Sl(_s(i),Jn(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return uo(Yn(_s(i),n[0]),n[1]-1);if(t===1/0)return uo(Yn(_s(i),n[1]),n[0]);if(t===-1/0)return tf(Yn(_s(i),n[1]),n[0]);if(t==="fro"||t==="euclidean")return rs(Yn(es(i),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}let Qo=at({norm_:function(i,t="euclidean",n=null,s=!1){let a=ff(i=Oe(i,"x","norm"),t,n),l=a.shape;if(s){let u=Zn(n,i.shape);l=Ls(a.shape,u)}return pt(a,l)}}),db=at({movingAverage_:function(i,t,n,s,a=!0){let l=Oe(i,"v","movingAverage"),u=Oe(t,"x","movingAverage"),h=Oe(n,"decay","movingAverage");zp(l,u),ee(Ye(l.shape,u.shape),()=>"Shape mismatch in v and x");let f=Jn(1),d=Un(f,h),m=qe(Un(u,l),d);if(a){ee(s!=null,()=>"When using zeroDebias: true, step is required.");let g=Oe(s,"step","movingAverage");m=yn(m,Un(f,Sl(h,g)))}return fn(l,m)}}),G0=at({scatterND_:function(i,t,n){let s=Oe(i,"indices","scatterND","int32"),a=Oe(t,"updates","scatterND");o0(a,s,n);let l={indices:s,updates:a},u={shape:n};return st.runKernel(Vl,l,u)}}),Ba=at({sparseToDense_:function(i,t,n,s=0){let a=Oe(i,"sparseIndices","sparseToDense","int32"),l=Oe(t,"sparseValues","sparseToDense"),u=Oe(s,"defaultValue","sparseToDense",l.dtype);(function(d,m,g,x){if(d.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${d.dtype}.`);if(d.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${d.shape}.`);let R=d.rank>0?d.shape[0]:1,N=d.rank>1?d.shape[1]:1;if(g.length!==N)throw new Error(`outputShape has incorrect number of elements:, ${g.length}, should be: ${N}.`);let F=m.size;if(m.rank!==0&&(m.rank!==1||F!==R))throw new Error(`sparseValues has incorrect shape ${m.shape}, should be [] or [${R}]`);if(m.dtype!==x.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(a,l,n,u);let h={sparseIndices:a,sparseValues:l,defaultValue:u},f={outputShape:n};return st.runKernel(Vo,h,f)}}),Fm=at({gatherND_:function(i,t){let n=Oe(t,"indices","gatherND","int32"),s={params:Oe(i,"x","gatherND","string_or_numeric"),indices:n};return st.runKernel(em,s)}}),Dc=at({dropout_:function(i,t,n,s){let a=Oe(i,"x","dropout");if(ee(a.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`),ee(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return i instanceof Ni?a.clone():a;let l=function(f,d){if(d==null)return f.shape.slice();if(Ye(f.shape,d))return d;if(f.shape.length===d.length){let m=[];for(let g=0;g<f.shape.length;g++)d[g]==null&&f.shape[g]!=null?m.push(f.shape[g]):m.push(d[g]);return m}return d}(a,n),u=1-t,h=yn(Ac(fn(Gi(l,0,1,"float32",s),u)),u);return qe(a,h)}});function W0(i){return Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2))))}function mf(i,t,n){let s=1-i%2,a=new Float32Array(i);for(let l=0;l<i;++l){let u=2*Math.PI*l/(i+s-1);a[l]=t-n*Math.cos(u)}return ga(a,"float32")}let Pm=async function(i,t,n=1){let s=Oe(i,"predictions","inTopK"),a=Oe(t,"targets","inTopK");ee(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),ee(s.rank-1===a.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${a.rank}`),ie(s.shape.slice(0,s.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let l=s.shape[s.shape.length-1];ee(n>0&&n<=l,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${l}), but got ${n}`);let u=await s.data(),h=await a.data(),[f,d]=[u.length/l,l],m=Pr("bool",f);for(let g=0;g<f;g++){let x=g*d,R=u.subarray(x,x+d),N=[];for(let F=0;F<R.length;F++)N.push({value:R[F],index:F});N.sort((F,H)=>H.value-F.value),m[g]=0;for(let F=0;F<n;F++)if(N[F].index===h[g]){m[g]=1;break}}return i!==s&&s.dispose(),t!==a&&a.dispose(),Xo(m,a.shape,"bool")},jd=at({conv2DBackpropFilter_:function(i,t,n,s,a,l="NHWC",u){let h=i;i.rank===3&&(h=pt(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let f=t;f.rank===3&&(f=pt(t,[1,t.shape[0],t.shape[1],t.shape[2]])),ee(h.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${h.shape}.`),ee(f.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${f.shape}.`),ee(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);let d=l==="NHWC"?h.shape[3]:h.shape[1],m=l==="NHWC"?f.shape[3]:f.shape[1];ee(d===n[2],()=>`Error in conv2dDerFilter: depth of input ${d}) must match input depth in filter (${n[2]}.`),ee(m===n[3],()=>`Error in conv2dDerFilter: depth of dy (${m}) must match output depth for filter (${n[3]}).`),Ca("conv2dDerFilter",a,u);let g={x:h,dy:f},x={strides:s,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:n};return st.runKernel(hr,g,x)}});function Fc(i,t,n){if(n==null||n==="linear")return i;if(n==="relu")return qe(i,zu(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function gf(i,t){let n=t,s=Qs(i.shape,t.shape);return s.length>0&&(n=Yn(n,s)),pt(n,i.shape)}function yf(i,t,n,s){if(t==="linear")return i;if(t==="relu")return po(i);if(t==="elu")return Pd(i);if(t==="relu6")return su(i);if(t==="prelu")return zd(i,n);if(t==="leakyrelu")return Od(i,s);if(t==="sigmoid")return ds(i);throw new Error(`Unknown fused activation ${t}.`)}let vf=(i,t)=>!(i>0)||t==="linear",bf=at({fusedConv2d_:function({x:i,filter:t,strides:n,pad:s,dataFormat:a="NHWC",dilations:l=[1,1],dimRoundingMode:u,bias:h,activation:f="linear",preluActivationWeights:d,leakyreluAlpha:m}){if(f=f||"linear",vf(st.state.gradientDepth,f)===!1){let Ce=Du(i,t,n,s,a,l,u);return h!=null&&(Ce=fn(Ce,h)),yf(Ce,f,d,m)}let g=Oe(i,"x","conv2d","float32"),x=Oe(t,"filter","conv2d","float32"),R=g,N=!1;g.rank===3&&(N=!0,R=pt(g,[1,g.shape[0],g.shape[1],g.shape[2]])),ee(R.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${R.rank}.`),ee(x.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${x.rank}.`),Ca("fused conv2d",s,u),ee(R.shape[3]===x.shape[2],()=>`Error in conv2d: depth of input (${R.shape[3]}) must match input depth for filter ${x.shape[2]}.`),ee(pa(n,l),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`),ee(a==="NHWC",()=>`Error in conv2d: got dataFormat of ${a} but only NHWC is currently supported.`);let F=ta(R.shape,x.shape,n,l,s,u),H,W;h!=null&&(H=Oe(h,"bias","fused conv2d"),[H]=ls(H,g),Zr(F.outShape,H.shape)),d!=null&&(W=Oe(d,"prelu weights","fused conv2d"));let G=(Ce,Be)=>{let[Ve,ze,Xe,tt]=Be,ot=Fc(Ce,Xe,f);ee(Lu(l),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${l}'`);let ut=[T0(ze.shape,ot,Ve,n,s),jd(ze,ot,Ve.shape,n,s)];if(tt!=null){let ft=gf(tt,ot);ut.push(ft)}return ut},se={x:R,filter:x,bias:H,preluActivationWeights:W},ge={strides:n,pad:s,dataFormat:a,dilations:l,dimRoundingMode:u,activation:f,leakyreluAlpha:m};return h==null?ja((Ce,Be,Ve)=>{let ze=st.runKernel(Wl,se,ge);return Ve([Be,Ce,ze]),N&&(ze=pt(ze,[ze.shape[1],ze.shape[2],ze.shape[3]])),{value:ze,gradFunc:G}})(R,x):ja((Ce,Be,Ve,ze)=>{let Xe=st.runKernel(Wl,se,ge);return ze([Be,Ce,Xe,Ve]),N&&(Xe=pt(Xe,[Xe.shape[1],Xe.shape[2],Xe.shape[3]])),{value:Xe,gradFunc:G}})(R,x,H)}}),j0=at({depthwiseConv2dNativeBackpropFilter_:function(i,t,n,s,a,l=[1,1],u){let h=i;i.rank===3&&(h=pt(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let f=t;f.rank===3&&(f=pt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let d={x:h,dy:f},m={strides:s,pad:a,dimRoundingMode:u,dilations:l,filterShape:n};return st.runKernel(ua,d,m)}}),Uh=at({depthwiseConv2dNativeBackpropInput_:function(i,t,n,s,a,l=[1,1],u){let h=t,f=!1;t.rank===3&&(f=!0,h=pt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let d={dy:h,filter:n},m={strides:s,pad:a,dimRoundingMode:u,dilations:l,inputShape:i},g=st.runKernel(Ao,d,m);return f?pt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}}),Vu=at({fusedDepthwiseConv2d_:function({x:i,filter:t,strides:n,pad:s,dataFormat:a="NHWC",dilations:l=[1,1],dimRoundingMode:u,bias:h,activation:f="linear",preluActivationWeights:d,leakyreluAlpha:m}){if(vf(st.state.gradientDepth,f)===!1){let Ce=Fd(i,t,n,s,a,l,u);return h!=null&&(Ce=fn(Ce,h)),yf(Ce,f,d,m)}let g=Oe(i,"x","depthwiseConv2d","float32"),x=Oe(t,"filter","depthwiseConv2d","float32"),R=g,N=!1;g.rank===3&&(N=!0,R=pt(g,[1,g.shape[0],g.shape[1],g.shape[2]])),ee(R.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${R.rank}.`),ee(x.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${x.rank}.`),ee(R.shape[3]===x.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${R.shape[3]}) must match the inChannels dimension in filter ${x.shape[2]}.`),l==null&&(l=[1,1]),ee(pa(n,l),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`),Ca("fused depthwiseConv2d",s,u);let F=ta(R.shape,x.shape,n,l,s,u,!0),H,W;h!=null&&(H=Oe(h,"bias","fused conv2d"),[H]=ls(H,g),Zr(F.outShape,H.shape)),d!=null&&(W=Oe(d,"prelu weights","fused depthwiseConv2d"));let G=(Ce,Be)=>{ee(Lu(l),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);let[Ve,ze,Xe,tt]=Be,ot=Fc(Ce,Xe,f),ut=Uh(ze.shape,ot,Ve,n,s,l,u),ft=j0(ze,ot,Ve.shape,n,s,l,u);return tt!=null?[ut,ft,gf(H,ot)]:[ut,ft]},se={x:R,filter:x,bias:H,preluActivationWeights:W},ge={strides:n,pad:s,dataFormat:a,dilations:l,dimRoundingMode:u,activation:f,leakyreluAlpha:m};return h==null?ja((Ce,Be,Ve)=>{let ze=st.runKernel(_o,se,ge);return Ve([Be,Ce,ze]),N&&(ze=pt(ze,[ze.shape[1],ze.shape[2],ze.shape[3]])),{value:ze,gradFunc:G}})(R,x):ja((Ce,Be,Ve,ze)=>{let Xe=st.runKernel(_o,se,ge);return ze([Be,Ce,Xe,Ve]),N&&(Xe=pt(Xe,[Xe.shape[1],Xe.shape[2],Xe.shape[3]])),{value:Xe,gradFunc:G}})(R,x,H)}}),Hu=at({fusedMatMul_:function({a:i,b:t,transposeA:n=!1,transposeB:s=!1,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(vf(st.state.gradientDepth,l)===!1){let tt=oi(i,t,n,s);return a!=null&&(tt=fn(tt,a)),yf(tt,l,u,h)}let f=Oe(i,"a","fused matMul"),d=Oe(t,"b","fused matMul");[f,d]=ls(f,d);let m=n?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?d.shape[d.rank-1]:d.shape[d.rank-2],x=n?f.shape[f.rank-1]:f.shape[f.rank-2],R=s?d.shape[d.rank-2]:d.shape[d.rank-1],N=f.shape.slice(0,-2),F=d.shape.slice(0,-2),H=me(N),W=me(F);ee(m===g,()=>`Error in fused matMul: inner shapes (${m}) and (${g}) of Tensors with shapes ${f.shape} and ${d.shape} and transposeA=${n} and transposeB=${s} must match.`);let G=Zr(f.shape.slice(0,-2),d.shape.slice(0,-2)).concat([x,R]),se=pt(f,n?[H,m,x]:[H,x,m]),ge=pt(d,s?[W,R,g]:[W,g,R]),Ce,Be;a!=null&&(Ce=Oe(a,"bias","fused matMul"),[Ce]=ls(Ce,f),Zr(G,Ce.shape)),u!=null&&(Be=Oe(u,"prelu weights","fused matMul"));let Ve=(tt,ot)=>{let[ut,ft,kt,Ut]=ot,It=Fc(pt(tt,kt.shape),kt,l),Lt,zt;return n||s?!n&&s?(Lt=oi(It,ft,!1,!1),zt=oi(It,ut,!0,!1)):n&&!s?(Lt=oi(ft,It,!1,!0),zt=oi(ut,It,!1,!1)):(Lt=oi(ft,It,!0,!0),zt=oi(It,ut,!0,!0)):(Lt=oi(It,ft,!1,!0),zt=oi(ut,It,!0,!1)),a!=null?[Lt,zt,gf(Ut,It)]:[Lt,zt]},ze={a:se,b:ge,bias:Ce,preluActivationWeights:Be},Xe={transposeA:n,transposeB:s,activation:l,leakyreluAlpha:h};return a==null?ja((tt,ot,ut)=>{let ft=st.runKernel(vd,ze,Xe);return ut([tt,ot,ft]),{value:pt(ft,G),gradFunc:Ve}})(se,ge):ja((tt,ot,ut,ft)=>{let kt=st.runKernel(vd,ze,Xe);return ft([tt,ot,kt,ut]),{value:pt(kt,G),gradFunc:Ve}})(se,ge,Ce)}}),ou=at({hammingWindow_:function(i){return mf(i,.54,.46)}}),zh=at({hannWindow_:function(i){return mf(i,.5,.5)}}),xf=at({frame_:function(i,t,n,s=!1,a=0){let l=0,u=[];for(;l+t<=i.size;)u.push(hi(i,l,t)),l+=n;if(s)for(;l<i.size;){let h=l+t-i.size,f=Ti([hi(i,l,t-h),Ch([h],a)]);u.push(f),l+=n}return u.length===0?Ph([],[0,t]):pt(Ti(u),[u.length,t])}}),Om=at({stft_:function(i,t,n,s,a=zh){s==null&&(s=W0(t));let l=xf(i,t,n),u=qe(l,a(t));return Gd(u,s)}}),X0=at({cropAndResize_:function(i,t,n,s,a="bilinear",l=0){let u=Oe(i,"image","cropAndResize"),h=Oe(t,"boxes","cropAndResize","float32"),f=Oe(n,"boxInd","cropAndResize","int32"),d=h.shape[0];ee(u.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${u.rank}.`),ee(h.rank===2&&h.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${d},4] but had shape ${h.shape}.`),ee(f.rank===1&&f.shape[0]===d,()=>`Error in cropAndResize: boxInd must be have size [${d}] but had shape ${h.shape}.`),ee(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),ee(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),ee(a==="bilinear"||a==="nearest",()=>`method must be bilinear or nearest, but was ${a}`);let m={image:u,boxes:h,boxInd:f},g={method:a,extrapolationValue:l,cropSize:s};return st.runKernel(Qr,m,g)}}),Bm=at({flipLeftRight_:function(i){let t=Oe(i,"image","flipLeftRight","float32");ee(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let n={image:t};return st.runKernel(vu,n,{})}}),q0=at({grayscaleToRGB_:function(i){let t=Oe(i,"image","grayscaleToRGB"),n=t.rank-1,s=t.shape[n];ee(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),ee(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);let a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,oo(t,a)}}),Ro=at({rotateWithOffset_:function(i,t,n=0,s=.5){let a=Oe(i,"image","rotateWithOffset","float32");ee(a.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`);let l={image:a},u={radians:t,fillValue:n,center:s};return st.runKernel(um,l,u)}});function lu(i,t,n,s,a,l){s==null&&(s=.5),a==null&&(a=Number.NEGATIVE_INFINITY),l==null&&(l=0);let u=i.shape[0];return n=Math.min(n,u),ee(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),ee(i.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${i.rank}'`),ee(i.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${i.shape[1]}`),ee(t.rank===1,()=>"scores must be a 1D tensor"),ee(t.shape[0]===u,()=>`scores has incompatible shape with boxes. Expected ${u}, but was ${t.shape[0]}`),ee(0<=l&&l<=1,()=>`softNmsSigma must be in [0, 1], but was '${l}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:a,softNmsSigma:l}}let K0=at({nonMaxSuppression_:function(i,t,n,s=.5,a=Number.NEGATIVE_INFINITY){let l=Oe(i,"boxes","nonMaxSuppression","float32"),u=Oe(t,"scores","nonMaxSuppression","float32"),h=lu(l,u,n,s,a),f={maxOutputSize:n=h.maxOutputSize,iouThreshold:s=h.iouThreshold,scoreThreshold:a=h.scoreThreshold};return st.runKernel(Au,{boxes:l,scores:u},f)}});function Y0(i,t,n){let s=function(l,u,h){return function(f,d,m){let g=0,x=f.length,R=0,N=!1;for(;g<x;){R=g+(x-g>>>1);let F=m(d,f[R]);F>0?g=R+1:(x=R,N=!F)}return N?g:-g-1}(l,u,h||Um)}(i,t,n),a=s<0?-(s+1):s;i.splice(a,0,t)}function Um(i,t){return i>t?1:i<t?-1:0}function Xd(i,t,n,s,a){return wf(i,t,n,s,a,0)}function qd(i,t,n,s,a,l){return wf(i,t,n,s,a,0,!1,l,!0)}function Kd(i,t,n,s,a,l){return wf(i,t,n,s,a,l,!0)}function wf(i,t,n,s,a,l,u=!1,h=!1,f=!1){let d=[];for(let H=0;H<t.length;H++)t[H]>a&&d.push({score:t[H],boxIndex:H,suppressBeginIndex:0});d.sort(fb);let m=l>0?-.5/l:0,g=[],x=[];for(;g.length<n&&d.length>0;){let H=d.pop(),{score:W,boxIndex:G,suppressBeginIndex:se}=H;if(W<a)break;let ge=!1;for(let Ce=g.length-1;Ce>=se;--Ce){let Be=pb(i,G,g[Ce]);if(Be>=s){ge=!0;break}if(H.score=H.score*D1(s,m,Be),H.score<=a)break}H.suppressBeginIndex=g.length,ge||(H.score===W?(g.push(G),x.push(H.score)):H.score>a&&Y0(d,H,fb))}let R=g.length,N=n-R;h&&N>0&&(g.push(...new Array(N).fill(0)),x.push(...new Array(N).fill(0)));let F={selectedIndices:g};return u&&(F.selectedScores=x),f&&(F.validOutputs=R),F}function pb(i,t,n){let s=i.subarray(4*t,4*t+4),a=i.subarray(4*n,4*n+4),l=Math.min(s[0],s[2]),u=Math.min(s[1],s[3]),h=Math.max(s[0],s[2]),f=Math.max(s[1],s[3]),d=Math.min(a[0],a[2]),m=Math.min(a[1],a[3]),g=Math.max(a[0],a[2]),x=Math.max(a[1],a[3]),R=(h-l)*(f-u),N=(g-d)*(x-m);if(R<=0||N<=0)return 0;let F=Math.max(l,d),H=Math.max(u,m),W=Math.min(h,g),G=Math.min(f,x),se=Math.max(W-F,0)*Math.max(G-H,0);return se/(R+N-se)}function D1(i,t,n){let s=Math.exp(t*n*n);return n<=i?s:0}function fb(i,t){return i.score-t.score||i.score===t.score&&t.boxIndex-i.boxIndex}let F1=at({nonMaxSuppressionWithScore_:function(i,t,n,s=.5,a=Number.NEGATIVE_INFINITY,l=0){let u=Oe(i,"boxes","nonMaxSuppression"),h=Oe(t,"scores","nonMaxSuppression"),f=lu(u,h,n,s,a,l),d={boxes:u,scores:h},m={maxOutputSize:n=f.maxOutputSize,iouThreshold:s=f.iouThreshold,scoreThreshold:a=f.scoreThreshold,softNmsSigma:l=f.softNmsSigma},g=st.runKernel(Cp,d,m);return{selectedIndices:g[0],selectedScores:g[1]}}}),Af=at({nonMaxSuppressionPadded_:function(i,t,n,s=.5,a=Number.NEGATIVE_INFINITY,l=!1){let u=Oe(i,"boxes","nonMaxSuppression"),h=Oe(t,"scores","nonMaxSuppression"),f=lu(u,h,n,s,a,null),d={boxes:u,scores:h},m={maxOutputSize:f.maxOutputSize,iouThreshold:f.iouThreshold,scoreThreshold:f.scoreThreshold,padToMaxOutputSize:l},g=st.runKernel(sc,d,m);return{selectedIndices:g[0],validOutputs:g[1]}}}),mb=at({resizeBilinear_:function(i,t,n=!1,s=!1){let a=Oe(i,"images","resizeBilinear");ee(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ee(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),ee(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let l=a,u=!1;a.rank===3&&(u=!0,l=pt(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=t,h={images:l},f={alignCorners:n,halfPixelCenters:s,size:t},d=st.runKernel(Hs,h,f);return u?pt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),gb=at({resizeNearestNeighbor_:function(i,t,n=!1,s=!1){let a=Oe(i,"images","resizeNearestNeighbor");ee(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ee(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),ee(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ee(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let l=a,u=!1;a.rank===3&&(u=!0,l=pt(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=t,h={images:l},f={alignCorners:n,halfPixelCenters:s,size:t},d=st.runKernel(hd,h,f);return u?pt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),P1=at({threshold_:function(i,t="binary",n=!1,s=.5){let a=Oe(i,"image","threshold"),l=a.shape[0]*a.shape[1],u,h,f,d,m=qe(ga([s]),255);if(ee(a.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`),ee(a.shape[2]===3||a.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`),ee(a.dtype==="int32"||a.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`),ee(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),a.shape[2]===3){[u,h,f]=Oa(a,[1,1,1],-1);let x=qe(u,.2989),R=qe(h,.587),N=qe(f,.114);d=fn(fn(x,R),N)}else d=i;t==="otsu"&&(m=function(x,R){let N,F,H,W,G,se,ge=ga([-1]),Ce=ga([0]),Be=ga([0]);for(let Ve=0;Ve<x.size-1;Ve++){N=hi(x,0,Ve+1),F=hi(x,Ve+1),G=yn(Yn(N),R),se=yn(Yn(F),R);let ze=Yn(qe(N,Rh(0,N.size)));H=yn(ze,Yn(N));let Xe=Ch(F.shape,N.size),tt=fn(Rh(0,F.size),Xe),ot=qe(F,tt);W=yn(Yn(ot),Yn(F));let ut=Un(H,W),ft=Un(H,W),kt=qe(G,se);Be=qe(qe(kt,ut),ft);let Ut=Ka(Be,Ce);Ce=Ia(Ut,Be,Ce),ge=Ia(Ut,ga([Ve]),ge)}return ge}(E0(En(Ou(d),"int32"),Xo([]),256),l));let g=n?Sc(d,m):Ka(d,m);return En(qe(g,255),"int32")}}),O1=at({transform_:function(i,t,n="nearest",s="constant",a=0,l){let u=Oe(i,"image","transform","float32"),h=Oe(t,"transforms","transform","float32");ee(u.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${u.rank}.`),ee(h.rank===2&&(h.shape[0]===u.shape[0]||h.shape[0]===1)&&h.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),ee(l==null||l.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${l}.`);let f={image:u,transforms:h},d={interpolation:n,fillMode:s,fillValue:a,outputShape:l};return st.runKernel(lm,f,d)}}),Ef=at({bandPart_:function(i,t,n){ee(t%1==0,()=>`bandPart(): numLower must be an integer, got ${t}.`),ee(n%1==0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);let s=Oe(i,"a","bandPart");ee(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);let a=s.shape,[l,u]=s.shape.slice(-2);if(!(t<=l))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${l}).`);if(!(n<=u))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${u}).`);t<0&&(t=l),n<0&&(n=u);let h=pt(Rh(0,l,1,"int32"),[-1,1]),f=Rh(0,u,1,"int32"),d=Un(h,f),m=Yo(Sc(d,Jn(+t,"int32")),Ya(d,Jn(-n,"int32"))),g=js([l,u],s.dtype);return pt(Qa(ts(pt(s,[-1,l,u])).map(x=>Ia(m,x,g))),a)}}),zm=at({gramSchmidt_:function(i){let t;if(Array.isArray(i)){t=!1,ee(i!=null&&i.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let a=i[0].shape[0];for(let l=1;l<i.length;++l)ee(i[l].shape[0]===a,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${i[l].shape[0]} vs. ${a})`)}else t=!0,i=Oa(i,i.shape[0],0).map(a=>au(a,[0]));ee(i.length<=i[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${i.length}) exceeds number of dimensions (${i[0].shape[0]}).`);let n=[],s=i;for(let a=0;a<i.length;++a)n.push(st.tidy(()=>{let l=s[a];if(a>0)for(let u=0;u<a;++u){let h=qe(Yn(qe(n[u],l)),n[u]);l=Un(l,h)}return yn(l,Qo(l,"euclidean"))}));return t?Qa(n,0):n}});function $m(i,t=!1){return st.tidy(()=>{ee(i.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${i.shape.length}D Tensor.`);let n=i.shape[0],s=i.shape[1],a=Tm(n),l=Cu(i),u=Ph([[1]],[1,1]),h=Cu(u),f=n>=s?s:n;for(let d=0;d<f;++d){let m=l,g=h,x=a;[h,l,a]=st.tidy(()=>{let R=hi(l,[d,d],[n-d,1]),N=Qo(R),F=hi(l,[d,d],[1,1]),H=Ia(Ka(F,0),Ph([[-1]]),Ph([[1]])),W=Un(F,qe(H,N)),G=yn(R,W);h=G.shape[0]===1?Cu(u):Ti([u,hi(G,[1,0],[G.shape[0]-1,G.shape[1]])],0);let se=ps(yn(oi(H,W),N)),ge=hi(l,[d,0],[n-d,s]),Ce=qe(se,h),Be=xi(h);if(d===0)l=Un(ge,oi(Ce,oi(Be,ge)));else{let Xe=Un(ge,oi(Ce,oi(Be,ge)));l=Ti([hi(l,[0,0],[d,s]),Xe],0)}let Ve=xi(Ce),ze=hi(a,[0,d],[n,a.shape[1]-d]);if(d===0)a=Un(ze,oi(oi(ze,h),Ve));else{let Xe=Un(ze,oi(oi(ze,h),Ve));a=Ti([hi(a,[0,0],[n,d]),Xe],1)}return[h,l,a]}),ni([m,g,x])}return!t&&n>s&&(a=hi(a,[0,0],[n,s]),l=hi(l,[0,0],[s,s])),[a,l]})}let Sf=at({qr_:function(i,t=!1){if(ee(i.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${i.rank}`),i.rank===2)return $m(i,t);{let n=i.shape.slice(0,i.shape.length-2).reduce((u,h)=>u*h),s=ts(pt(i,[n,i.shape[i.shape.length-2],i.shape[i.shape.length-1]]),0),a=[],l=[];return s.forEach(u=>{let[h,f]=$m(u,t);a.push(h),l.push(f)}),[pt(Qa(a,0),i.shape),pt(Qa(l,0),i.shape)]}}});var ka;(function(i){i[i.NONE=0]="NONE",i[i.MEAN=1]="MEAN",i[i.SUM=2]="SUM",i[i.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ka||(ka={}));let Zo=at({computeWeightedLoss_:function(i,t,n=ka.SUM_BY_NONZERO_WEIGHTS){let s=Oe(i,"losses","computeWeightedLoss"),a=null;t!=null&&(a=Oe(t,"weights","computeWeightedLoss"));let l=a==null?s:qe(s,a);if(n===ka.NONE)return l;if(n===ka.SUM)return Yn(l);if(n===ka.MEAN){if(a==null)return ws(l);{let u=s.size/a.size,h=yn(Yn(l),Yn(a));return u>1?yn(h,Jn(u)):h}}if(n===ka.SUM_BY_NONZERO_WEIGHTS){if(a==null)return yn(Yn(l),Jn(s.size));{let u=qe(a,co(s.shape)),h=En(Yn(ru(u,Jn(0))),"float32");return yn(Yn(l),h)}}throw Error(`Unknown reduction: ${n}`)}}),Vm=at({absoluteDifference_:function(i,t,n,s=ka.SUM_BY_NONZERO_WEIGHTS){let a=Oe(i,"labels","absoluteDifference"),l=Oe(t,"predictions","absoluteDifference"),u=null;n!=null&&(u=Oe(n,"weights","absoluteDifference")),ie(a.shape,l.shape,"Error in absoluteDifference: ");let h=_s(Un(a,l));return Zo(h,u,s)}}),Hm=at({cosineDistance_:function(i,t,n,s,a=ka.SUM_BY_NONZERO_WEIGHTS){let l=Oe(i,"labels","cosineDistance"),u=Oe(t,"predictions","cosineDistance"),h=null;s!=null&&(h=Oe(s,"weights","cosineDistance")),ie(l.shape,u.shape,"Error in cosineDistance: ");let f=Jn(1),d=Un(f,Yn(qe(l,u),n,!0));return Zo(d,h,a)}}),Q0=at({hingeLoss_:function(i,t,n,s=ka.SUM_BY_NONZERO_WEIGHTS){let a=Oe(i,"labels","hingeLoss"),l=Oe(t,"predictions","hingeLoss"),u=null;n!=null&&(u=Oe(n,"weights","hingeLoss")),ie(a.shape,l.shape,"Error in hingeLoss: ");let h=Jn(1);a=Un(qe(Jn(2),a),h);let f=po(Un(h,qe(a,l)));return Zo(f,u,s)}}),yb=at({huberLoss_:function(i,t,n,s=1,a=ka.SUM_BY_NONZERO_WEIGHTS){let l=Oe(i,"labels","huberLoss"),u=Oe(t,"predictions","huberLoss"),h=null;n!=null&&(h=Oe(n,"weights","huberLoss")),ie(l.shape,u.shape,"Error in huberLoss: ");let f=Jn(s),d=_s(Un(u,l)),m=Ud(d,f),g=Un(d,m),x=fn(qe(Jn(.5),es(m)),qe(f,g));return Zo(x,h,a)}}),Tf=at({logLoss_:function(i,t,n,s=1e-7,a=ka.SUM_BY_NONZERO_WEIGHTS){let l=Oe(i,"labels","logLoss"),u=Oe(t,"predictions","logLoss"),h=null;n!=null&&(h=Oe(n,"weights","logLoss")),ie(l.shape,u.shape,"Error in logLoss: ");let f=Jn(1),d=Jn(s),m=ps(qe(l,lo(fn(u,d)))),g=qe(Un(f,l),lo(fn(Un(f,u),d))),x=Un(m,g);return Zo(x,h,a)}}),uu=at({meanSquaredError_:function(i,t,n,s=ka.SUM_BY_NONZERO_WEIGHTS){let a=Oe(i,"labels","meanSquaredError"),l=Oe(t,"predictions","meanSquaredError"),u=null;n!=null&&(u=Oe(n,"weights","meanSquaredError")),ie(a.shape,l.shape,"Error in meanSquaredError: ");let h=hf(a,l);return Zo(h,u,s)}}),B1=at({sigmoidCrossEntropy_:function(i,t,n,s=0,a=ka.SUM_BY_NONZERO_WEIGHTS){let l=Oe(i,"multiClassLabels","sigmoidCrossEntropy"),u=Oe(t,"logits","sigmoidCrossEntropy"),h=null;if(n!=null&&(h=Oe(n,"weights","sigmoidCrossEntropy")),ie(l.shape,u.shape,"Error in sigmoidCrossEntropy: "),s>0){let d=Jn(s),m=Jn(1),g=Jn(.5);l=fn(qe(l,Un(m,d)),qe(g,d))}let f=function(d,m){let g=Oe(d,"labels","sigmoidCrossEntropyWithLogits"),x=Oe(m,"logits","sigmoidCrossEntropyWithLogits");ie(g.shape,x.shape,"Error in sigmoidCrossEntropyWithLogits: ");let R=po(x),N=qe(x,g),F=Fu(ao(ps(_s(x))));return fn(Un(R,N),F)}(l,u);return Zo(f,h,a)}}),vb=at({softmaxCrossEntropy_:function(i,t,n,s=0,a=ka.SUM_BY_NONZERO_WEIGHTS){let l=Oe(i,"onehotLabels","softmaxCrossEntropy"),u=Oe(t,"logits","softmaxCrossEntropy"),h=null;if(n!=null&&(h=Oe(n,"weights","softmaxCrossEntropy")),ie(l.shape,u.shape,"Error in softmaxCrossEntropy: "),s>0){let d=Jn(s),m=Jn(1),g=Jn(l.shape[1]);l=fn(qe(l,Un(m,d)),yn(d,g))}let f=function(d,m,g=-1){if(g===-1&&(g=m.rank-1),g!==m.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${m.rank} and dim was ${g}`);return ja((x,R,N)=>{let F=P0(R,[g],!0),H=Un(En(R,"float32"),F);N([x,H]);let W=ps(qe(H,x));return{value:Yn(W,[g]),gradFunc:(G,se)=>{let[ge,Ce]=se,Be=Ls(G.shape,[g]);return[qe(pt(G,Be),Un(En(ge,"float32"),ao(Ce))),qe(pt(G,Be),Un(ao(Ce),En(ge,"float32")))]}}})(d,m)}(l,u);return Zo(f,h,a)}}),Pc=at({sparseFillEmptyRows_:function(i,t,n,s){let a=Oe(i,"indices","sparseFillEmptyRows","int32"),l=Oe(t,"values","sparseFillEmptyRows"),u=Oe(n,"denseShape","sparseFillEmptyRows","int32"),h=Oe(s,"defaultValue","sparseFillEmptyRows",l.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${a.shape}`);if(l.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${l.shape}`);if(u.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${u.shape}`);if(h.rank!==0)throw new Error(`Default value should be a scalar but received shape ${h.shape}`);let f={indices:a,values:l,denseShape:u,defaultValue:h},d=st.runKernel(kp,f);return{outputIndices:d[0],outputValues:d[1],emptyRowIndicator:d[2],reverseIndexMap:d[3]}}}),Mf=at({sparseReshape_:function(i,t,n){let s=Oe(i,"inputIndices","sparseReshape","int32"),a=Oe(t,"inputShape","sparseReshape","int32"),l=Oe(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(a.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(l.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${l.shape}`);let u={inputIndices:s,inputShape:a,newShape:l},h=st.runKernel(uh,u);return{outputIndices:h[0],outputShape:h[1]}}}),U1=at({sparseSegmentMean_:function(i,t,n){let s=Oe(i,"data","sparseSegmentMean"),a=Oe(t,"indices","sparseSegmentMean","int32"),l=Oe(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${a.shape}`);if(l.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${l.shape}`);let u={data:s,indices:a,segmentIds:l};return st.runKernel(pd,u)}}),z1=at({sparseSegmentSum_:function(i,t,n){let s=Oe(i,"data","sparseSegmentSum"),a=Oe(t,"indices","sparseSegmentSum","int32"),l=Oe(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${a.shape}`);if(l.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${l.shape}`);let u={data:s,indices:a,segmentIds:l};return st.runKernel(xl,u)}}),$1=at({stringNGrams_:function(i,t,n,s,a,l,u,h){let f=Oe(i,"data","stringNGrams","string");if(f.dtype!=="string")throw new Error("Data must be of datatype string");if(f.shape.length!==1)throw new Error(`Data must be a vector, saw: ${f.shape}`);let d=Oe(t,"dataSplits","stringNGrams");if(d.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let m={separator:n,nGramWidths:s,leftPad:a,rightPad:l,padWidth:u,preserveShortSequences:h},g={data:f,dataSplits:d},x=st.runKernel(fd,g,m);return{nGrams:x[0],nGramsSplits:x[1]}}}),V1=at({stringSplit_:function(i,t,n=!0){let s=Oe(i,"input","stringSplit","string"),a=Oe(t,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(a.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let l={skipEmpty:n},u={input:s,delimiter:a},h=st.runKernel(hh,u,l);return{indices:h[0],values:h[1],shape:h[2]}}}),H1=at({stringToHashBucketFast_:function(i,t){let n=Oe(i,"input","stringToHashBucketFast","string"),s={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let a={input:n};return st.runKernel(md,a,s)}}),G1={fft:Nc,ifft:Fh,rfft:Gd,irfft:cf},W1={hammingWindow:ou,hannWindow:zh,frame:xf,stft:Om},Jo={flipLeftRight:Bm,grayscaleToRGB:q0,resizeNearestNeighbor:gb,resizeBilinear:mb,rotateWithOffset:Ro,cropAndResize:X0,nonMaxSuppression:K0,nonMaxSuppressionAsync:async function(i,t,n,s=.5,a=Number.NEGATIVE_INFINITY){let l=Oe(i,"boxes","nonMaxSuppressionAsync"),u=Oe(t,"scores","nonMaxSuppressionAsync"),h=lu(l,u,n,s,a);n=h.maxOutputSize,s=h.iouThreshold,a=h.scoreThreshold;let f=await Promise.all([l.data(),u.data()]),d=f[0],m=f[1],{selectedIndices:g}=Xd(d,m,n,s,a);return l!==i&&l.dispose(),u!==t&&u.dispose(),ga(g,"int32")},nonMaxSuppressionWithScore:F1,nonMaxSuppressionWithScoreAsync:async function(i,t,n,s=.5,a=Number.NEGATIVE_INFINITY,l=0){let u=Oe(i,"boxes","nonMaxSuppressionAsync"),h=Oe(t,"scores","nonMaxSuppressionAsync"),f=lu(u,h,n,s,a,l);n=f.maxOutputSize,s=f.iouThreshold,a=f.scoreThreshold,l=f.softNmsSigma;let d=await Promise.all([u.data(),h.data()]),m=d[0],g=d[1],{selectedIndices:x,selectedScores:R}=Kd(m,g,n,s,a,l);return u!==i&&u.dispose(),h!==t&&h.dispose(),{selectedIndices:ga(x,"int32"),selectedScores:ga(R)}},nonMaxSuppressionPadded:Af,nonMaxSuppressionPaddedAsync:async function(i,t,n,s=.5,a=Number.NEGATIVE_INFINITY,l=!1){let u=Oe(i,"boxes","nonMaxSuppressionAsync"),h=Oe(t,"scores","nonMaxSuppressionAsync"),f=lu(u,h,n,s,a,null),d=f.maxOutputSize,m=f.iouThreshold,g=f.scoreThreshold,[x,R]=await Promise.all([u.data(),h.data()]),{selectedIndices:N,validOutputs:F}=qd(x,R,d,m,g,l);return u!==i&&u.dispose(),h!==t&&h.dispose(),{selectedIndices:ga(N,"int32"),validOutputs:Jn(F,"int32")}},threshold:P1,transform:O1},bb={bandPart:Ef,gramSchmidt:zm,qr:Sf},j1={absoluteDifference:Vm,computeWeightedLoss:Zo,cosineDistance:Hm,hingeLoss:Q0,huberLoss:yb,logLoss:Tf,meanSquaredError:uu,sigmoidCrossEntropy:B1,softmaxCrossEntropy:vb},_f={sparseFillEmptyRows:Pc,sparseReshape:Mf,sparseSegmentMean:U1,sparseSegmentSum:z1},Yd={stringNGrams:$1,stringSplit:V1,stringToHashBucketFast:H1},$h={sgd:tu.sgd,momentum:tu.momentum,adadelta:tu.adadelta,adagrad:tu.adagrad,rmsprop:tu.rmsprop,adamax:tu.adamax,adam:tu.adam},Qd=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:i=>i();function xb(){return new Promise(i=>Qd(()=>i()))}function As(i,t){let n=i[0].length;i.forEach((a,l)=>{ee(a.length===n,()=>`Error in concat${n}D: rank of tensors[${l}] must be the same as the rank of the rest (${n})`)}),ee(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);let s=i[0];i.forEach((a,l)=>{for(let u=0;u<n;u++)ee(u===t||a[u]===s[u],()=>`Error in concat${n}D: Shape of tensors[${l}] (${a}) does not match the shape of the rest (${s}) along the non-concatenated axis ${l}.`)})}function No(i,t){let n=i[0].slice();for(let s=1;s<i.length;s++)n[t]+=i[s][t];return n}let Gm=30;function Vh(i){return i<=Gm?i:Vi(i,Math.floor(Math.sqrt(i)))}function Zd(i,t,n){return[n*(typeof i=="number"?i:i[0]),t*(typeof i=="number"?i:i[1])]}function Cf(i,t,n,s=!0){let a=[];if(s)a=a.concat(t.slice(0)),a.push(i[0]/n),a=a.concat(i.slice(1));else{a=a.concat(i[0]);let l=t.length;for(let u=0;u<l;++u)a=a.concat([i[u+1]/t[u],t[u]]);a=a.concat(i.slice(l+1))}return a}function Gu(i,t,n=!0){let s=[];if(n){s.push(t);for(let a=t+1;a<i;++a)a<=2*t?(s.push(a),s.push(a-(t+1))):s.push(a)}else{let a=[],l=[];for(let u=1;u<i;++u)u>=2*t+1||u%2==1?l.push(u):a.push(u);s.push(...a),s.push(0),s.push(...l)}return s}function If(i,t,n,s=!0){let a=[];s?a.push(i[0]/n):a.push(i[0]*n);for(let l=1;l<i.length;++l)l<=t.length?s?a.push(t[l-1]*i[l]):a.push(i[l]/t[l-1]):a.push(i[l]);return a}function Wm(i,t){let n=[0];for(let s=0;s<t;++s)n.push(i[s][0]);return n}function jm(i,t,n){let s=i.slice(0,1);for(let a=0;a<n;++a)s.push(i[a+1]-t[a][0]-t[a][1]);return s}let Oc=1.7580993408473768,Jd=1.0507009873554805,Z0=.3275911,el=.254829592,Xm=-.284496736,qm=1.421413741,tl=-1.453152027,J0=1.061405429;function Wu(i,t){if(i.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${i.length}, imag: ${t.length}.`);let n=new Float32Array(2*i.length);for(let s=0;s<n.length;s+=2)n[s]=i[s/2],n[s+1]=t[s/2];return n}function Hh(i){let t=new Float32Array(i.length/2),n=new Float32Array(i.length/2);for(let s=0;s<i.length;s+=2)t[s/2]=i[s],n[s/2]=i[s+1];return{real:t,imag:n}}function Gh(i){let t=Math.ceil(i.length/4),n=new Float32Array(t),s=new Float32Array(t);for(let a=0;a<i.length;a+=4)n[Math.floor(a/4)]=i[a],s[Math.floor(a/4)]=i[a+1];return{real:n,imag:s}}function Bc(i){let t=Math.floor(i.length/4),n=new Float32Array(t),s=new Float32Array(t);for(let a=2;a<i.length;a+=4)n[Math.floor(a/4)]=i[a],s[Math.floor(a/4)]=i[a+1];return{real:n,imag:s}}function Uc(i,t){return{real:i[2*t],imag:i[2*t+1]}}function zc(i,t,n,s){i[2*s]=t,i[2*s+1]=n}function wb(i,t){let n=new Float32Array(i/2),s=new Float32Array(i/2);for(let a=0;a<Math.ceil(i/2);a++){let l=(t?2:-2)*Math.PI*(a/i);n[a]=Math.cos(l),s[a]=Math.sin(l)}return{real:n,imag:s}}function $c(i,t,n){let s=(n?2:-2)*Math.PI*(i/t);return{real:Math.cos(s),imag:Math.sin(s)}}let ep=/->/g;function Vc(i,t){let n=((i=i.replace(/\s/g,"")).length-i.replace(ep,"").length)/2;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');let[s,a]=i.split("->");ee(s.indexOf("...")===-1,()=>'The ellipsis notation ("...") is not supported yet.');let l=s.split(","),u=l.length;if(t!==u)throw new Error(`Expected ${u} input tensors, received ${t}`);if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let h=[];for(let g=0;g<a.length;++g){let x=a[g];if(!l.some(R=>R.indexOf(x)!==-1))throw new Error(`Output subscripts contain the label ${x} not present in the input subscripts.`);h.indexOf(x)===-1&&h.push(x)}for(let g=0;g<s.length;++g){let x=s[g];h.indexOf(x)===-1&&x!==","&&h.push(x)}let f=new Array(l.length);for(let g=0;g<u;++g){if(new Set(l[g].split("")).size!==l[g].length)throw new Error(`Found duplicate axes in input component ${l[g]}. Support for duplicate axes in input is not implemented yet.`);f[g]=[];for(let x=0;x<l[g].length;++x)f[g].push(h.indexOf(l[g][x]))}let d=h.length,m=[];for(let g=a.length;g<d;++g)m.push(g);return{allDims:h,summedDims:m,idDims:f}}function Hc(i,t){let n=new Array(i);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;let s=[];for(let a=0;a<i;++a)n[a]===-1&&s.push(a);return n=n.filter(a=>a!==-1),{permutationIndices:n,expandDims:s}}function Gc(i,t,n){let s=new Array(i);for(let a=0;a<n.length;++a){let l=n[a].shape;for(let u=0;u<t[a].length;++u)s[t[a][u]]===void 0?s[t[a][u]]=l[u]:ee(s[t[a][u]]===l[u],()=>`Expected dimension ${s[t[a][u]]} at axis ${u} of input shaped ${JSON.stringify(l)}, but got dimension ${l[u]}`)}}function kf(i,t){let n=i,s=[],a=0;i.length===0&&n.push(-1),a=i.length+1;for(let u=0;u<a;++u)s.push([]);let l=[];for(let u=0;u<n.length;++u){let h=Ab(t,n[u]);for(let f of h)l.indexOf(f)===-1&&(s[u].push(f),l.push(f))}return{path:n,steps:s}}function Km(i){return i.every((t,n)=>t===n)}function Ab(i,t){let n=[];for(let s=0;s<i.length;++s)i[s].length!==0&&i[s].indexOf(t)===-1&&t!==-1||n.push(s);return n}function Rf(i,t,n=0){let s=[];if(typeof t=="number")ee(i.shape[n]%t==0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(i.shape[n]/t);else{ee(t.reduce((l,u)=>(u===-1&&(l+=1),l),0)<=1,()=>"There should be only one negative value in split array.");let a=t.indexOf(-1);if(a!==-1){let l=t.reduce((u,h)=>h>0?u+h:u);t[a]=i.shape[n]-l}ee(i.shape[n]===t.reduce((l,u)=>l+u),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}function Nf(i){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${i}`}function Ym(i,t){return`indices(${i}, 0) is invalid: ${t} < 0`}function Qm(i,t,n){return`indices(${i}, 0) is invalid: ${t} >= ${n}`}function Zm(i,t){return`only one output dimension may be -1, not both ${i} and ${t}`}function Jm(i,t){return`size ${i} must be non-negative, not ${t}`}function ey(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function eg(i,t){return`Input to reshape is a SparseTensor with ${me(i)}
  dense values, but the requested shape requires a multiple of ${me(t)}. inputShape=${i} outputShape= ${t}`}function tg(i,t){return`Input to reshape is a tensor with ${me(i)} dense values, but the requested shape has ${me(t)}. inputShape=${i} outputShape=${t}`}function X1(){return"segment ids must be >= 0"}function Es(){return"segment ids are not increasing"}function cu(i,t){return`Segment id ${i} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function ty(i,t,n){return`Bad: indices[${i}] == ${t} out of range [0, ${n})`}function ng(i,t){let n,s=!1;for(i<=Gm?(n=i,s=!0):n=Vi(i,Math.floor(Math.sqrt(i)));!s;)n>t||n===i?s=!0:n=Vi(i,n+1);return n}function ny(i,t,n){let s=[],a=i.length;for(let l=0;l<a;l++)l!==t?s.push(i[l]):s.push(n);return s}function Lo(i,t,n,s){let a=t.shape.length,l=i.shape.length;if(s!==0&&(s<-a||s>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${s}`);if(s<0&&(s+=a),s>l)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${l}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let g=0;g<s;++g)if(i.shape[g]!==t.shape[g])throw new Error(`x.shape[${g}]: ${i.shape[g]} should be equal to indices.shape[${g}]: ${t.shape[g]}.`);let u=i.shape[n],h=[],f=1,d=1,m=1;for(let g=0;g<s;++g)h.push(i.shape[g]),f*=i.shape[g];for(let g=s;g<n;g++)h.push(i.shape[g]),d*=i.shape[g];for(let g=s;g<a;g++)h.push(t.shape[g]);for(let g=n+1;g<l;g++)h.push(i.shape[g]),m*=i.shape[g];return{batchSize:f,sliceSize:m,outerSize:d,dimSize:u,outputShape:h}}function Do(i){try{return i.map(t=>hc(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function rg(i){return i.map(t=>Co(t))}let tp={kernelName:Xt,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,zu(En(n,"float32"),-1))}}},Eb={kernelName:nr,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>{let s=es(En(n,"float32")),a=rs(Un(Jn(1),s));return ps(yn(i,a))}}}},np={kernelName:yr,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>{let s=rs(Un(es(En(n,"float32")),1));return yn(i,s)}}}},Wh={kernelName:Tr,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=i,u=Qs(n.shape,a);return u.length>0&&(l=Yn(l,u)),pt(l,n.shape)},b:()=>{let l=i,u=Qs(s.shape,a);return u.length>0&&(l=Yn(l,u)),pt(l,s.shape)}}}},Lf={kernelName:qi,saveAllInputs:!0,gradFunc:(i,t)=>{let n={};return t.forEach((s,a)=>{n[a]=()=>i.clone()}),n}},Df={kernelName:ui,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>wi(n)}}},q1={kernelName:Zi,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>wi(n)}}},K1={kernelName:ks,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,rs(Un(Jn(1),es(En(n,"float32")))))}}},jh={kernelName:Mr,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>{let s=rs(fn(Jn(1),es(En(n,"float32"))));return yn(i,s)}}}},ry={kernelName:qs,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=fn(es(n),es(s)),u=qe(i,yn(s,l)),h=Qs(n.shape,a);return h.length>0&&(u=Yn(u,h)),pt(u,n.shape)},b:()=>{let l=fn(es(n),es(s)),u=ps(qe(i,yn(n,l))),h=Qs(s.shape,a);return h.length>0&&(u=Yn(u,h)),pt(u,s.shape)}}}},Sb={kernelName:jr,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,fn(es(En(n,"float32")),1))}}},Za={kernelName:Xr,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,Un(Jn(1),es(En(n,"float32"))))}}},ju=at({avgPool3dGrad_:function(i,t,n,s,a,l){let u=Oe(i,"dy","avgPool3dGrad"),h=Oe(t,"input","avgPool3dGrad"),f=u,d=h,m=!1;h.rank===4&&(m=!0,f=pt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=pt(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),ee(f.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${f.rank}.`),ee(d.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),Ca("avgPool3dGrad",a,l);let g={dy:f,input:d},x={filterSize:n,strides:s,pad:a,dimRoundingMode:l},R=st.runKernel(de,g,x);return m?pt(R,[R.shape[1],R.shape[2],R.shape[3],R.shape[4]]):R}}),hu={kernelName:le,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=n;return{x:()=>ju(i,s,a,l,u,h)}}},Y1=at({avgPoolGrad_:function(i,t,n,s,a){let l=Oe(i,"dy","avgPoolGrad"),u=Oe(t,"input","avgPoolGrad");ee(u.rank===l.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${l.rank})`);let h=u,f=l,d=!1;u.rank===3&&(d=!0,h=pt(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=pt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),ee(f.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${f.rank}.`),ee(h.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${h.rank}.`);let m={dy:f,input:h},g={filterSize:n,strides:s,pad:a},x=st.runKernel(Ki,m,g);return d?pt(x,[x.shape[1],x.shape[2],x.shape[3]]):x}}),Q1={kernelName:Bi,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{filterSize:a,strides:l,pad:u}=n;return{x:()=>Y1(i,s,a,l,u)}}},Ff={kernelName:_e,inputsToSave:["a","b"],gradFunc:(i,t,n)=>{let[s,a]=t,{transposeA:l,transposeB:u}=n;return l||u?!l&&u?{a:()=>oi(i,a,!1,!1),b:()=>oi(i,s,!0,!1)}:l&&!u?{a:()=>oi(a,i,!1,!0),b:()=>oi(s,i,!1,!1)}:{a:()=>oi(a,i,!0,!0),b:()=>oi(i,s,!0,!0)}:{a:()=>oi(i,a,!1,!0),b:()=>oi(s,i,!0,!1)}}},Tb={kernelName:Ne,gradFunc:(i,t,n)=>{let{blockShape:s,crops:a}=n;return{x:()=>_c(i,s,a)}}},Mb={kernelName:ct,gradFunc:(i,t,n)=>{let s=n,a=s.inputShape,l=s.shape,u=Array.from(l);for(let f=a.length-1;f>=0;f--)if(a[f]===l[f])u[f]=1;else if(a[f]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${l}].`);let h=[];for(let f=0;f<u.length;f++)u[f]>1&&h.push(f);return{x:()=>Yn(i,h,!0)}}},_b={kernelName:Yt,gradFunc:i=>({x:()=>i.clone()})},_l={kernelName:Qt,gradFunc:i=>({x:()=>wi(i)})},iy={kernelName:At,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{clipValueMin:a,clipValueMax:l}=n;return{x:()=>Ia(Yo(Ya(s,a),Sc(s,l)),i,wi(i))}}},Cb={kernelName:hn,inputsToSave:["x"],gradFunc:tp.gradFunc},Ib={kernelName:zn,saveAllInputs:!0,gradFunc:(i,t,n)=>{let s=t.map(h=>h.shape),{axis:a}=n,l=Zn(a,t[0].shape)[0],u=s.map(h=>h[l]);return Oa(i,u,l).map(h=>()=>h)}},kb={kernelName:Kn,inputsToSave:["x","filter"],gradFunc:(i,t,n)=>{let[s,a]=t,{dilations:l,strides:u,pad:h,dataFormat:f}=n;return ee(Lu(l),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${l}'`),{x:()=>T0(s.shape,i,a,u,h,f),filter:()=>jd(s,i,a.shape,u,h,f)}}},sy={kernelName:Rr,inputsToSave:["dy","filter"],gradFunc:(i,t,n)=>{let[s,a]=t,{strides:l,pad:u,dataFormat:h,dimRoundingMode:f}=n;return{dy:()=>Du(i,a,l,u,h,1,f),filter:()=>jd(i,s,a.shape,l,u,h,f)}}},Rb=at({conv3DBackpropFilter_:function(i,t,n,s,a){let l=i;i.rank===4&&(l=pt(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]));let u=t;u.rank===4&&(u=pt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),ee(l.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${l.shape}.`),ee(u.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${u.shape}.`),ee(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),ee(l.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${l.shape[4]}) must match input depth in filter (${n[3]}.`),ee(u.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${u.shape[4]}) must match output depth for filter (${n[4]}).`);let h={x:l,dy:u},f={strides:s,pad:a,filterShape:n};return st.runKernel(kr,h,f)}}),ay={kernelName:Nr,inputsToSave:["x","filter"],gradFunc:(i,t,n)=>{let{dilations:s,strides:a,pad:l}=n;ee(Lu(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let[u,h]=t;return{x:()=>Qv(u.shape,i,h,a,l),filter:()=>Rb(u,i,h.shape,a,l)}}},Nb={kernelName:Ji,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(ps(Ic(En(n,"float32"))),i)}}},Pf={kernelName:vs,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(Dh(En(n,"float32")),i)}}},oy={kernelName:Ei,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{axis:a,exclusive:l,reverse:u}=n;return{x:()=>{let h=Ws([a],s.rank),f=Sm(i,a,l,!u);return h!=null&&(f=xi(f,h)),f}}}},Lb={kernelName:bs,inputsToSave:["x","filter"],gradFunc:(i,t,n)=>{let{dilations:s,strides:a,pad:l,dimRoundingMode:u}=n,h=s??[1,1];ee(Lu(h),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${h}'`);let[f,d]=t;return ee(f.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${f.rank}.`),ee(d.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${d.rank}.`),ee(f.shape[3]===d.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),ee(pa(a,h),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${h}'.`),Ca("depthwiseConv2d",l,u),{x:()=>Uh(f.shape,i,d,a,l,h,u),filter:()=>j0(f,i,d.shape,a,l,h,u)}}},ly={kernelName:dl,inputsToSave:["x","filter"],gradFunc:(i,t,n)=>{let[s,a]=t,l={x:s,filter:a,dy:i},u={x:s,filter:a,dy:i};return{x:()=>st.runKernel(Pl,l,n),filter:()=>st.runKernel(Ol,u,n)}}},Db={kernelName:Bo,outputsToSave:[!0],gradFunc:(i,t)=>{let[n]=t,s={dy:i,y:n};return{x:()=>st.runKernel(Ul,s)}}},uy={kernelName:Uo,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t,s=qe(ao(ps(es(n))),2/Math.sqrt(Math.PI));return{x:()=>qe(i,s)}}},cy={kernelName:zo,outputsToSave:[!0],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,n)}}},hy={kernelName:xs,inputsToSave:["input"],gradFunc:(i,t)=>{let[n]=t;return{input:()=>pt(i,n.shape)}}},dy={kernelName:rd,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,ao(n))}}},Of={kernelName:fl,gradFunc:i=>({x:()=>wi(i)})},Fb={kernelName:id,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=yn(i,En(s,"float32")),u=Qs(n.shape,a);return u.length>0?pt(Yn(l,u),n.shape):l},b:()=>{let l=qe(i,En(n,"float32")),u=Qs(s.shape,a);u.length>0&&(l=pt(Yn(l,u),s.shape));let h=es(s);return ps(yn(l,En(h,"float32")))}}}},ig={kernelName:yp,inputsToSave:["x","mean","variance","scale"],gradFunc:(i,t,n)=>{let{varianceEpsilon:s}=n,[a,l,u,h]=t,f=h??Jn(1),d=Qs(l.shape,a.shape),m=[];if(l.rank===1){for(let F=0;F<a.shape.length-1;++F)m.push(a.shape[F]);m.push(1)}let g=Un(a,l),x=qe(i,f),R=Bu(fn(u,Jn(s))),N=qe(qe(qe(R,R),R),Jn(-.5));return{x:()=>l.rank===1?pt(qe(qe(i,oo(pt(R,[1,1,1,l.shape[0]]),m)),f),a.shape):pt(qe(qe(i,R),f),a.shape),mean:()=>{let F=qe(qe(R,Jn(-1)),x);return l.rank===1&&(F=Yn(F,d)),pt(F,l.shape)},variance:()=>{let F=qe(qe(N,g),x);return l.rank===1&&(F=Yn(F,d)),pt(F,l.shape)},scale:()=>{let F=qe(g,R),H=qe(i,F);return l.rank===1&&(H=Yn(H,d)),pt(H,l.shape)},offset:()=>{let F=i;return l.rank===1&&(F=Yn(F,d)),pt(F,l.shape)}}}},py={kernelName:vp,inputsToSave:["x","indices"],gradFunc:(i,t,n)=>{let[s,a]=t,{axis:l}=n,u=Zn(l,s.shape)[0];return{x:()=>{let h=s.shape,f=a.size,d=h.slice(0,u),m=d.length,g=h.slice(l,h.length).slice(1),x=g.length,R=fy(0,m),N=fy(m+1,m+1+x),F=Pb([d,[f],g]),H=pt(i,F),W=pt(a,[f]),G=Pb([[m],R,N]),se=xi(H,G),ge=df(se,W,s.shape[u]),Ce=Bd(G);return ge=xi(ge,Ce),ge},indices:()=>a}}};function fy(i,t){let n=[];for(let s=i;s<t;++s)n.push(s);return n}function Pb(i){let t=[];for(let n=0;n<i.length;++n)for(let s=0;s<i[n].length;++s)t.push(i[n][s]);return t}let Z1={kernelName:sd,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t;return{a:()=>wi(n),b:()=>wi(s)}}},Ob={kernelName:ad,gradFunc:i=>({x:()=>En(i,"float32")})},Bb={kernelName:bu,gradFunc:i=>({x:()=>wi(i)})},Ub={kernelName:to,gradFunc:i=>({x:()=>wi(i)})},sg={kernelName:$s,gradFunc:i=>({x:()=>wi(i)})},my={kernelName:rc,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{alpha:a}=n,l=Ka(s,0);return{x:()=>Ia(l,i,qe(i,a))}}},zb={kernelName:ic,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,fn(n,1))}}},$b={kernelName:Vs,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,En(n,"float32"))}}},Vb={kernelName:av,inputsToSave:[],outputsToSave:[!0],gradFunc:(i,t,n)=>{let[s]=t,{axis:a}=n;return{logits:()=>{let l=ao(s);return Un(i,qe(Yn(i,a,!0),l))}}}},Hb=at({localResponseNormalizationBackprop_:function(i,t,n,s=5,a=1,l=1,u=.5){let h={x:i,y:t,dy:n},f={depthRadius:s,bias:a,alpha:l,beta:u};return st.runKernel(nm,h,f)}}),Gb={kernelName:Ap,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,t,n)=>{let[s,a]=t,{depthRadius:l,bias:u,alpha:h,beta:f}=n;return{x:()=>Hb(s,a,i,l,u,h,f)}}};function Wc(i,t,n,s){return t.rank<n.rank&&(t=pt(t,Ls(t.shape,s))),i.rank<n.rank&&(i=pt(i,Ls(i.shape,s))),{x:()=>qe(i,En(so(n,t),i.dtype))}}let Wb={kernelName:Ep,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,t,n)=>{let s=n,{reductionIndices:a}=s,l=t[0],u=Wc(i,t[1],l,Zn(a,l.shape));return{x:()=>u.x()}}},jb={kernelName:ld,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t;return{a:()=>qe(i,En(Ya(n,s),"float32")),b:()=>qe(i,En(Mm(n,s),"float32"))}}},Xb=at({maxPool3dGrad_:function(i,t,n,s,a,l,u){let h=Oe(i,"dy","maxPool3dGrad"),f=Oe(t,"input","maxPool3dGrad"),d=Oe(n,"output","maxPool3dGrad"),m=h,g=f,x=d,R=!1;f.rank===4&&(R=!0,m=pt(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]]),g=pt(f,[1,f.shape[0],f.shape[1],f.shape[2],f.shape[3]]),x=pt(d,[1,d.shape[0],d.shape[1],d.shape[2],d.shape[3]])),ee(m.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${m.rank}.`),ee(g.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${g.rank}.`),ee(x.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${x.rank}.`),Ca("maxPool3dGrad",l,u);let N={dy:m,input:g,output:x},F={filterSize:s,strides:a,pad:l,dimRoundingMode:u},H=st.runKernel(im,N,F);return R?pt(H,[H.shape[1],H.shape[2],H.shape[3],H.shape[4]]):H}}),Xh={kernelName:Tp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,t,n)=>{let[s,a]=t,{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=n;return{x:()=>Xb(i,s,a,l,u,h,f)}}},qb=at({maxPoolGrad_:function(i,t,n,s,a,l,u){let h=Oe(i,"dy","maxPoolGrad"),f=Oe(t,"input","maxPoolGrad"),d=Oe(n,"output","maxPoolGrad");ee(f.rank===h.rank,()=>`Rank of input (${f.rank}) does not match rank of dy (${h.rank})`),ee(h.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${h.rank}.`),ee(f.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${f.rank}.`),Ca("maxPoolGrad",l,u);let m={dy:h,input:f,output:d},g={filterSize:s,strides:a,pad:l,dimRoundingMode:u};return st.runKernel(rm,m,g)}}),Kb={kernelName:zl,inputsToSave:["x"],gradFunc:(i,t,n)=>{let s=t[0],{paddings:a}=n,l=a.map(u=>u[0]);return{x:()=>hi(i,l,s.shape)}}},jc={kernelName:bl,gradFunc:(i,t,n)=>{let{blockShape:s,paddings:a}=n;return{x:()=>Yp(i,s,a)}}},Yb={kernelName:lh,gradFunc:(i,t,n)=>{let{axis:s}=n;return{x:()=>Ti(i,s)}}},gy=[tp,Eb,np,Wh,Lf,Df,q1,K1,jh,ry,Sb,Za,hu,Q1,Ff,Tb,Mb,_b,_l,iy,Cb,Ib,sy,kb,ay,Nb,Pf,oy,Lb,ly,{kernelName:Oo,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=yn(i,En(s,"float32")),u=Qs(n.shape,a);return u.length>0?pt(Yn(l,u),n.shape):l},b:()=>{let l=qe(i,En(n,"float32")),u=Qs(s.shape,a);u.length>0&&(l=pt(Yn(l,u),s.shape));let h=es(s);return ps(yn(l,En(h,"float32")))}}}},Db,uy,cy,hy,dy,Fb,Of,ig,py,Z1,Ob,Bb,Ub,sg,my,zb,$b,Vb,Gb,Wb,Wb,jb,Xh,{kernelName:Sp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,t,n)=>{let[s,a]=t,{filterSize:l,strides:u,pad:h}=n;return{x:()=>qb(i,s,a,l,u,h)}}},{kernelName:nh,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{axis:a}=n,l=Zn(a,s.shape),u=me(fa(s.shape,l)[1]);return{x:()=>{let h=s.shape.slice();l.forEach(d=>{h[d]=1});let f=pt(i,h);return yn(qe(f,co(s.shape,"float32")),u)}}}},{kernelName:ud,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,t,n)=>{let s=n,{axis:a}=s,[l,u]=t,h=Wc(i,u,l,Zn(a,l.shape));return{x:()=>h.x()}}},{kernelName:rh,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t;return{a:()=>qe(i,En(Sc(n,s),"float32")),b:()=>qe(i,En(Ka(n,s),"float32"))}}},{kernelName:Mp,inputsToSave:["x"],gradFunc:(i,t,n)=>{let s=t[0],{paddings:a}=n,l=a.map(u=>u[0]);return{x:()=>hi(i,l,s.shape)}}},{kernelName:ih,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=Qs(n.shape,a);return l.length>0?pt(Yn(i,l),n.shape):i},b:()=>{let l=qe(i,ps(Ac(yn(n,s)))),u=Qs(s.shape,a);return u.length>0?pt(Yn(l,u),s.shape):l}}}},{kernelName:Ts,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=qe(i,En(s,"float32")),u=Qs(n.shape,a);return u.length>0?pt(Yn(l,u),n.shape):l},b:()=>{let l=qe(i,En(n,"float32")),u=Qs(s.shape,a);return u.length>0?pt(Yn(l,u),s.shape):l}}}},{kernelName:cd,gradFunc:i=>({x:()=>ps(i)})},{kernelName:ac,inputsToSave:["indices"],gradFunc:(i,t)=>{let n=t[0];return{indices:()=>js(n.shape,"float32")}}},{kernelName:Ga,gradFunc:i=>({x:()=>wi(i)})},{kernelName:sh,saveAllInputs:!0,gradFunc:(i,t,n)=>{let{axis:s}=n;return ts(i,s).map(a=>()=>a)}},Kb,Kb,{kernelName:Fn,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(i,t)=>{let[n,s,a]=t,l=n,u=s,h=Zr(l.shape,u.shape);return{a:()=>{let f=En(u,"float32"),d=qe(i,qe(f,Sl(l,Un(f,Jn(1))))),m=Qs(l.shape,h);return m.length>0&&(d=Yn(d,m)),pt(d,l.shape)},b:()=>{let f=Ka(l,0),d=Ia(f,lo(l),wi(l)),m=qe(i,qe(a,d)),g=Qs(u.shape,h);return g.length>0&&(m=Yn(m,g)),pt(m,u.shape)}}}},{kernelName:$l,inputsToSave:["x","alpha"],gradFunc:(i,t)=>{let[n,s]=t,a=Ka(n,0);return{x:()=>Ia(a,i,qe(i,s)),alpha:()=>{let l=Ia(a,wi(i),qe(i,n)),u=Qs(s.shape,i.shape);return u.length>0&&(l=Yn(l,u)),pt(l,s.shape)}}}},{kernelName:oc,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,ps(es(n)))}}},{kernelName:lc,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t,s=qe(Sc(n,6),zu(n));return{x:()=>qe(i,En(s,"float32"))}}},{kernelName:Si,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,En(zu(n),"float32"))}}},{kernelName:Ta,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>pt(i,n.shape)}}},{kernelName:Hs,inputsToSave:["images"],gradFunc:(i,t,n)=>{let[s]=t,a={dy:i,images:s};return{images:()=>st.runKernel(je,a,n)}}},{kernelName:hd,inputsToSave:["images"],gradFunc:(i,t,n)=>{let[s]=t,a={dy:i,images:s};return{images:()=>st.runKernel(ah,a,n)}}},{kernelName:dd,gradFunc:(i,t,n)=>{let{dims:s}=n,a=Zn(s,i.shape);return{x:()=>Pi(i,a)}}},{kernelName:va,gradFunc:i=>({x:()=>wi(i)})},{kernelName:no,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>ps(yn(i,qe(Sl(n,1.5),2)))}}},{kernelName:oh,inputsToSave:["condition"],gradFunc:(i,t)=>{let[n]=t;return{condition:()=>En(wi(n),"float32"),t:()=>qe(i,En(n,i.dtype)),e:()=>qe(i,En(Jp(n),i.dtype))}}},{kernelName:yl,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>{let s=Ka(n,Jn(0)),a=Jn(Oc),l=Jn(Jd),u=qe(i,l),h=qe(qe(i,a),ao(En(n,"float32")));return Ia(s,u,h)}}}},{kernelName:$o,outputsToSave:[!0],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,qe(n,Un(Jn(1),n)))}}},{kernelName:To,gradFunc:i=>({x:()=>wi(i)})},{kernelName:vl,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(Qp(En(n,"float32")),i)}}},{kernelName:So,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(Em(En(n,"float32")),i)}}},{kernelName:Hl,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{begin:a,size:l}=n,u=s.shape,[h,f]=ym(s,a,l),d=[];for(let m=0;m<i.rank;m++)d.push([h[m],u[m]-h[m]-f[m]]);return{x:()=>iu(i,d)}}},{kernelName:Ip,outputsToSave:[!0],gradFunc:(i,t,n)=>{let[s]=t,{dim:a}=n,l=qe(i,s);return{logits:()=>Un(l,qe(Yn(l,[a],!0),s))}}},{kernelName:Gl,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,ds(n))}}},jc,jc,Yb,Yb,{kernelName:Eu,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,qe(rs(En(n,"float32")),2))}}},{kernelName:cc,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Jn(2);return{a:()=>qe(i,qe(a,Un(n,s))),b:()=>qe(i,qe(a,Un(s,n)))}}},{kernelName:ch,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(i,qe(En(n,"float32"),2))}}},{kernelName:Go,gradFunc:i=>({x:()=>wi(i)})},{kernelName:Mo,inputsToSave:["a","b"],gradFunc:(i,t)=>{let[n,s]=t,a=Zr(n.shape,s.shape);return{a:()=>{let l=i,u=Qs(n.shape,a);return u.length>0&&(l=Yn(l,u)),pt(l,n.shape)},b:()=>{let l=i,u=Qs(s.shape,a);return u.length>0&&(l=Yn(l,u)),pt(ps(l),s.shape)}}}},{kernelName:uc,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,a=s.shape.slice(),{axis:l}=n;Zn(l,s.shape).forEach(f=>{a[f]=1});let u=pt(i,a),h=qe(u,co(s.shape,"float32"));return{x:()=>h}}},{kernelName:Wn,inputsToSave:["x"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>yn(i,es(Qp(n)))}}},{kernelName:Al,outputsToSave:[!0],gradFunc:(i,t)=>{let[n]=t;return{x:()=>qe(Un(Jn(1),es(n)),i)}}},{kernelName:Fa,inputsToSave:["x"],gradFunc:(i,t,n)=>{let[s]=t,{reps:a}=n;return{x:()=>{let l=wi(s);if(s.rank===1)for(let u=0;u<a[0];++u)l=fn(l,hi(i,[u*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let u=0;u<a[0];++u)for(let h=0;h<a[1];++h)l=fn(l,hi(i,[u*s.shape[0],h*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let u=0;u<a[0];++u)for(let h=0;h<a[1];++h)for(let f=0;f<a[2];++f)l=fn(l,hi(i,[u*s.shape[0],h*s.shape[1],f*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);for(let u=0;u<a[0];++u)for(let h=0;h<a[1];++h)for(let f=0;f<a[2];++f)for(let d=0;d<a[3];++d)l=fn(l,hi(i,[u*s.shape[0],h*s.shape[1],f*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return l}}}},{kernelName:Ho,gradFunc:(i,t,n)=>{let s=n,{perm:a}=s,l=Bd(a);return{x:()=>xi(i,l)}}},{kernelName:Ma,gradFunc:(i,t,n)=>{let s=n,{axis:a}=s;return{value:()=>Qa(i,a)}}},{kernelName:gd,inputsToSave:["segmentIds"],gradFunc:(i,t)=>{let[n]=t;return{x:()=>function(s,a){let l=Tl(a,wi(a)),u=Ec(s,l),h=Ya(a,Jn(0,"int32")),f=u.rank-h.rank;for(let m=0;m<f;++m)h=qa(h,m+1);h=Yo(h,co(u.shape,"bool"));let d=wi(u);return Ia(h,u,d)}(i,n)}}},{kernelName:yd,gradFunc:i=>({x:()=>wi(i)})}];for(let i of gy)Gg(i);let Xu;function Js(){return Xu==null&&(Xu=x1().epsilon()),Xu}Bt().prototype.abs=function(){return this.throwIfDisposed(),_s(this)},Bt().prototype.acos=function(){return this.throwIfDisposed(),g0(this)},Bt().prototype.acosh=function(){return this.throwIfDisposed(),vm(this)},Bt().prototype.add=function(i){return this.throwIfDisposed(),fn(this,i)},Bt().prototype.all=function(i,t){return this.throwIfDisposed(),bm(this,i,t)},Bt().prototype.any=function(i,t){return this.throwIfDisposed(),kd(this,i,t)},Bt().prototype.argMax=function(i){return this.throwIfDisposed(),yc(this,i)},Bt().prototype.argMin=function(i){return this.throwIfDisposed(),Kp(this,i)},Bt().prototype.asScalar=function(){return this.throwIfDisposed(),ee(this.size===1,()=>"The array must have only 1 element."),pt(this,[])},Bt().prototype.asType=function(i){return this.throwIfDisposed(),En(this,i)},Bt().prototype.as1D=function(){return this.throwIfDisposed(),pt(this,[this.size])},Bt().prototype.as2D=function(i,t){return this.throwIfDisposed(),pt(this,[i,t])},Bt().prototype.as3D=function(i,t,n){return this.throwIfDisposed(),pt(this,[i,t,n])},Bt().prototype.as4D=function(i,t,n,s){return this.throwIfDisposed(),pt(this,[i,t,n,s])},Bt().prototype.as5D=function(i,t,n,s,a){return this.throwIfDisposed(),pt(this,[i,t,n,s,a])},Bt().prototype.asin=function(){return this.throwIfDisposed(),y0(this)},Bt().prototype.asinh=function(){return this.throwIfDisposed(),v0(this)},Bt().prototype.atan=function(){return this.throwIfDisposed(),b0(this)},Bt().prototype.atan2=function(i){return this.throwIfDisposed(),x0(this,i)},Bt().prototype.atanh=function(){return this.throwIfDisposed(),w0(this)},Bt().prototype.avgPool=function(i,t,n,s){return this.throwIfDisposed(),Nd(this,i,t,n,s)},Bt().prototype.batchToSpaceND=function(i,t){return this.throwIfDisposed(),Yp(this,i,t)},Bt().prototype.batchNorm=function(i,t,n,s,a){return this.throwIfDisposed(),Ld(this,i,t,n,s,a)},Bt().prototype.broadcastTo=function(i){return this.throwIfDisposed(),Dd(this,i)},Bt().prototype.cast=function(i){return this.throwIfDisposed(),En(this,i)},Bt().prototype.ceil=function(){return this.throwIfDisposed(),S0(this)},Bt().prototype.clipByValue=function(i,t){return this.throwIfDisposed(),Xa(this,i,t)},Bt().prototype.concat=function(i,t){return this.throwIfDisposed(),i instanceof Ni&&(i=[i]),Ti([this,...i],t)},Bt().prototype.conv1d=function(i,t,n,s,a,l){return this.throwIfDisposed(),wm(this,i,t,n,s,a,l)},Bt().prototype.conv2dTranspose=function(i,t,n,s,a){return this.throwIfDisposed(),Am(this,i,t,n,s,a)},Bt().prototype.conv2d=function(i,t,n,s,a,l){return this.throwIfDisposed(),Du(this,i,t,n,s,a,l)},Bt().prototype.cos=function(){return this.throwIfDisposed(),Qp(this)},Bt().prototype.cosh=function(){return this.throwIfDisposed(),Em(this)},Bt().prototype.cumsum=function(i,t,n){return this.throwIfDisposed(),Sm(this,i,t,n)},Bt().prototype.depthToSpace=function(i,t){return this.throwIfDisposed(),_0(this,i,t)},Bt().prototype.depthwiseConv2d=function(i,t,n,s,a,l){return this.throwIfDisposed(),Fd(this,i,t,n,s,a,l)},Bt().prototype.dilation2d=function(i,t,n,s,a){return this.throwIfDisposed(),C0(this,i,t,n,s,a)},Bt().prototype.divNoNan=function(i){return this.throwIfDisposed(),I0(this,i)},Bt().prototype.div=function(i){return this.throwIfDisposed(),yn(this,i)},Bt().prototype.dot=function(i){return this.throwIfDisposed(),eb(this,i)},Bt().prototype.elu=function(){return this.throwIfDisposed(),Pd(this)},Bt().prototype.equal=function(i){return this.throwIfDisposed(),so(this,i)},Bt().prototype.erf=function(){return this.throwIfDisposed(),k0(this)},Bt().prototype.exp=function(){return this.throwIfDisposed(),ao(this)},Bt().prototype.expandDims=function(i){return this.throwIfDisposed(),qa(this,i)},Bt().prototype.expm1=function(){return this.throwIfDisposed(),R0(this)},Bt().prototype.fft=function(){return this.throwIfDisposed(),Nc(this)},Bt().prototype.flatten=function(){return this.throwIfDisposed(),pt(this,[this.size])},Bt().prototype.floor=function(){return this.throwIfDisposed(),Ac(this)},Bt().prototype.floorDiv=function(i){return this.throwIfDisposed(),m0(this,i)},Bt().prototype.gather=function(i,t){return this.throwIfDisposed(),Ec(this,i,t)},Bt().prototype.greaterEqual=function(i){return this.throwIfDisposed(),Ya(this,i)},Bt().prototype.greater=function(i){return this.throwIfDisposed(),Ka(this,i)},Bt().prototype.ifft=function(){return this.throwIfDisposed(),Fh(this)},Bt().prototype.irfft=function(){return this.throwIfDisposed(),cf(this)},Bt().prototype.isFinite=function(){return this.throwIfDisposed(),nb(this)},Bt().prototype.isInf=function(){return this.throwIfDisposed(),rb(this)},Bt().prototype.isNaN=function(){return this.throwIfDisposed(),N0(this)},Bt().prototype.leakyRelu=function(i){return this.throwIfDisposed(),Od(this,i)},Bt().prototype.lessEqual=function(i){return this.throwIfDisposed(),Sc(this,i)},Bt().prototype.less=function(i){return this.throwIfDisposed(),Mm(this,i)},Bt().prototype.localResponseNormalization=function(i,t,n,s){return this.throwIfDisposed(),L0(this,i,t,n,s)},Bt().prototype.logSigmoid=function(){return this.throwIfDisposed(),sb(this)},Bt().prototype.logSoftmax=function(i){return this.throwIfDisposed(),_m(this,i)},Bt().prototype.logSumExp=function(i,t){return this.throwIfDisposed(),P0(this,i,t)},Bt().prototype.log=function(){return this.throwIfDisposed(),lo(this)},Bt().prototype.log1p=function(){return this.throwIfDisposed(),Fu(this)},Bt().prototype.logicalAnd=function(i){return this.throwIfDisposed(),Yo(this,i)},Bt().prototype.logicalNot=function(){return this.throwIfDisposed(),Jp(this)},Bt().prototype.logicalOr=function(i){return this.throwIfDisposed(),Cm(this,i)},Bt().prototype.logicalXor=function(i){return this.throwIfDisposed(),ab(this,i)},Bt().prototype.matMul=function(i,t,n){return this.throwIfDisposed(),oi(this,i,t,n)},Bt().prototype.maxPool=function(i,t,n,s){return this.throwIfDisposed(),ef(this,i,t,n,s)},Bt().prototype.max=function(i,t){return this.throwIfDisposed(),uo(this,i,t)},Bt().prototype.maximum=function(i){return this.throwIfDisposed(),Tl(this,i)},Bt().prototype.mean=function(i,t){return this.throwIfDisposed(),ws(this,i,t)},Bt().prototype.min=function(i,t){return this.throwIfDisposed(),tf(this,i,t)},Bt().prototype.minimum=function(i){return this.throwIfDisposed(),Ud(this,i)},Bt().prototype.mirrorPad=function(i,t){return this.throwIfDisposed(),B0(this,i,t)},Bt().prototype.mod=function(i){return this.throwIfDisposed(),U0(this,i)},Bt().prototype.mul=function(i){return this.throwIfDisposed(),qe(this,i)},Bt().prototype.neg=function(){return this.throwIfDisposed(),ps(this)},Bt().prototype.norm=function(i,t,n){return this.throwIfDisposed(),Qo(this,i,t,n)},Bt().prototype.notEqual=function(i){return this.throwIfDisposed(),ru(this,i)},Bt().prototype.oneHot=function(i,t=1,n=0){return this.throwIfDisposed(),Md(this,i,t,n)},Bt().prototype.onesLike=function(){return this.throwIfDisposed(),ho(this)},Bt().prototype.pad=function(i,t){return this.throwIfDisposed(),iu(this,i,t)},Bt().prototype.pool=function(i,t,n,s,a,l){return this.throwIfDisposed(),z0(this,i,t,n,s,a,l)},Bt().prototype.pow=function(i){return this.throwIfDisposed(),Sl(this,i)},Bt().prototype.prelu=function(i){return this.throwIfDisposed(),zd(this,i)},Bt().prototype.prod=function(i,t){return this.throwIfDisposed(),Im(this,i,t)},Bt().prototype.reciprocal=function(){return this.throwIfDisposed(),Nh(this)},Bt().prototype.relu=function(){return this.throwIfDisposed(),po(this)},Bt().prototype.relu6=function(){return this.throwIfDisposed(),su(this)},Bt().prototype.reshapeAs=function(i){return this.throwIfDisposed(),pt(this,i.shape)},Bt().prototype.reshape=function(i){return this.throwIfDisposed(),pt(this,i)},Bt().prototype.resizeBilinear=function(i,t,n){return this.throwIfDisposed(),mb(this,i,t,n)},Bt().prototype.resizeNearestNeighbor=function(i,t,n){return this.throwIfDisposed(),gb(this,i,t,n)},Bt().prototype.reverse=function(i){return this.throwIfDisposed(),Pi(this,i)},Bt().prototype.rfft=function(){return this.throwIfDisposed(),Gd(this)},Bt().prototype.round=function(){return this.throwIfDisposed(),Ou(this)},Bt().prototype.rsqrt=function(){return this.throwIfDisposed(),Bu(this)},Bt().prototype.selu=function(){return this.throwIfDisposed(),Uu(this)},Bt().prototype.separableConv2d=function(i,t,n,s,a,l){return this.throwIfDisposed(),Lh(this,i,t,n,s,a,l)},Bt().prototype.sigmoid=function(){return this.throwIfDisposed(),ds(this)},Bt().prototype.sign=function(){return this.throwIfDisposed(),Hd(this)},Bt().prototype.sin=function(){return this.throwIfDisposed(),Ic(this)},Bt().prototype.sinh=function(){return this.throwIfDisposed(),Dh(this)},Bt().prototype.slice=function(i,t){return this.throwIfDisposed(),hi(this,i,t)},Bt().prototype.softmax=function(i){return this.throwIfDisposed(),Rc(this,i)},Bt().prototype.softplus=function(){return this.throwIfDisposed(),Tc(this)},Bt().prototype.spaceToBatchND=function(i,t){return this.throwIfDisposed(),_c(this,i,t)},Bt().prototype.split=function(i,t){return this.throwIfDisposed(),Oa(this,i,t)},Bt().prototype.sqrt=function(){return this.throwIfDisposed(),rs(this)},Bt().prototype.square=function(){return this.throwIfDisposed(),es(this)},Bt().prototype.squaredDifference=function(i){return this.throwIfDisposed(),hf(this,i)},Bt().prototype.squeeze=function(i){return this.throwIfDisposed(),au(this,i)},Bt().prototype.stack=function(i,t){this.throwIfDisposed();let n=i instanceof Ni?[this,i]:[this,...i];return Qa(n,t)},Bt().prototype.step=function(i){return this.throwIfDisposed(),zu(this,i)},Bt().prototype.stridedSlice=function(i,t,n,s,a,l,u,h){return this.throwIfDisposed(),Wd(this,i,t,n,s,a,l,u,h)},Bt().prototype.sub=function(i){return this.throwIfDisposed(),Un(this,i)},Bt().prototype.sum=function(i,t){return this.throwIfDisposed(),Yn(this,i,t)},Bt().prototype.tan=function(){return this.throwIfDisposed(),$u(this)},Bt().prototype.tanh=function(){return this.throwIfDisposed(),kh(this)},Bt().prototype.tile=function(i){return this.throwIfDisposed(),oo(this,i)},Bt().prototype.toBool=function(){return this.throwIfDisposed(),En(this,"bool")},Bt().prototype.toFloat=function(){return this.throwIfDisposed(),En(this,"float32")},Bt().prototype.toInt=function(){return this.throwIfDisposed(),En(this,"int32")},Bt().prototype.topk=function(i,t){return this.throwIfDisposed(),Lm(this,i,t)},Bt().prototype.transpose=function(i){return this.throwIfDisposed(),xi(this,i)},Bt().prototype.unique=function(i){return this.throwIfDisposed(),Lc(this,i)},Bt().prototype.unsortedSegmentSum=function(i,t){return this.throwIfDisposed(),df(this,i,t)},Bt().prototype.unstack=function(i){return this.throwIfDisposed(),ts(this,i)},Bt().prototype.where=function(i,t){return this.throwIfDisposed(),Ia(i,this,t)},Bt().prototype.zerosLike=function(){return this.throwIfDisposed(),wi(this)};class du extends Error{constructor(t){super(t),Object.setPrototypeOf(this,du.prototype)}}class Ea extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ea.prototype)}}class mt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,mt.prototype)}}class Jr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Jr.prototype)}}class ag extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ag.prototype)}}function qu(i,t){if(Array.isArray(i)){let n=[];for(let s=0;s<t;s++)n=n.concat(i);return n}{let n=new Array(t);return n.fill(i),n}}function pu(i,t){if(!i)throw new ag(t)}function og(i,t){let n=0;for(let s of i)s===t&&n++;return n}function Ja(i){return i.length===1?i[0]:i}function fs(i){return Array.isArray(i)?i:[i]}function Ku(i){let t=i.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function qh(i){return i.length<=1||i.indexOf("_")===-1?i:i.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let nl={};function yy(i){if(i==null)return null;let t={};return t.className=i.getClassName(),t.config=i.getConfig(),t}function vy(i){if(i!=null&&typeof i=="object")if(Array.isArray(i))i.forEach(t=>vy(t));else{let t=Object.keys(i);for(let n of t){let s=i[n];s!=null&&typeof s=="object"&&(Array.isArray(s)||s.type!=="ndarray"||typeof s.value!="number"?vy(s):i[n]=s.value)}}}function Bf(i,t={},n={},s="object",a=!1){if(typeof i=="string"){let l=i,u;if(l in n)u=n[l];else if(l in nl)u=nl[l];else if(u=t[l],u==null)throw new mt(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return u}{let l=i;if(l.className==null||l.config==null)throw new mt(`${s}: Improper config format: ${JSON.stringify(l)}.
'className' and 'config' must set.`);let u=l.className,h,f;if(u in n?[h,f]=n[u]:u in nl?[h,f]=nl.className:u in t&&([h,f]=t[u]),h==null)throw new mt(`Unknown ${s}: ${u}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(f!=null){let d={};for(let x of Object.keys(nl))d[x]=nl[x];for(let x of Object.keys(n))d[x]=n[x];l.config.customObjects=d;let m=Object.assign({},nl);for(let x of Object.keys(n))nl[x]=n[x];vy(l.config);let g=f(h,l.config,n,a);return nl=Object.assign({},m),g}{let d=Object.assign({},nl);for(let g of Object.keys(n))nl[g]=n[g];let m=new h(l.config);return nl=Object.assign({},d),m}}}function Mi(i,t){return-1*function(n,s){return n<s?-1:n>s?1:0}(i,t)}function Yu(i){if(i==null)return i;let t=[];for(let n of i)t.indexOf(n)===-1&&t.push(n);return t}function J1(i){if(i==null)throw new mt(`Invalid value in obj: ${JSON.stringify(i)}`);for(let t in i)if(i.hasOwnProperty(t))return!1;return!0}function Xc(i,t,n){if(n!=null&&i.indexOf(n)<0)throw new mt(`${n} is not a valid ${t}.  Valid values are ${i} or null/undefined.`)}function rp(i,t,n=0,s=1/0){return pu(n>=0),pu(s>=n),Array.isArray(i)&&i.length>=n&&i.length<=s&&i.every(a=>typeof a===t)}function na(i,t){Array.isArray(i)?(ee(i.length>0,()=>`${t} is unexpectedly an empty array.`),i.forEach((n,s)=>na(n,`element ${s+1} of ${t}`))):ee(Number.isInteger(i)&&i>0,()=>`Expected ${t} to be a positive integer, but got ${by(i)}.`)}function by(i){return i===null?"null":Array.isArray(i)?"["+i.map(t=>by(t)).join(",")+"]":typeof i=="string"?`"${i}"`:`${i}`}function Qb(i){return i==="relu"?"relu":i==="linear"?"linear":i==="elu"?"elu":null}function lg(i,t){return bt(()=>rs(Yn(qe(i,i),t,!0)))}class Kh extends _h{getConfig(){return{}}}class xy extends Kh{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return bt(()=>{let n=lg(t,this.axis),s=Xa(n,0,this.maxValue);return qe(t,yn(s,fn(Js(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}xy.className="MaxNorm",dn(xy);class wy extends Kh{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return bt(()=>yn(t,fn(Js(),lg(t,this.axis))))}getConfig(){return{axis:this.axis}}}wy.className="UnitNorm",dn(wy);class ug extends Kh{apply(t){return po(t)}}ug.className="NonNeg",dn(ug);class qc extends Kh{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return bt(()=>{let n=lg(t,this.axis),s=fn(qe(this.rate,Xa(n,this.minValue,this.maxValue)),qe(1-this.rate,n));return qe(t,yn(s,fn(Js(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}qc.className="MinMaxNorm",dn(qc);let Ay={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ds(i){return yy(i)}function Ey(i,t={}){return Bf(i,ko.getMap().classNameMap,t,"constraint")}function ea(i){return i==null?null:typeof i=="string"?Ey({className:i in Ay?Ay[i]:i,config:{}}):i instanceof Kh?i:Ey(i)}function ew(i){return new xy(i)}function Kc(i){return new wy(i)}function cg(){return new ug}function Sy(i){return new qc(i)}let Zb=["channelsFirst","channelsLast"],Jb=["nearest","bilinear"],tw=["valid","same","causal"],nw=["max","avg"],ex=["sum","mul","concat","ave"],Yh=new Map;function Xs(i){Xc(Zb,"DataFormat",i)}function fo(i){Xc(tw,"PaddingMode",i)}function tx(i){Xc(nw,"PoolMode",i)}let ip=[];function fu(i,t){ip.push(i);try{let n=t();return ip.pop(),n}catch(n){throw ip.pop(),n}}function Ty(i){if(!Fs(i))throw new Error("Not a valid tensor name: '"+i+"'");return(ip.length===0?"":ip.join("/")+"/")+i}function nx(i){if(!Fs(i))throw new Error("Not a valid tensor name: '"+i+"'");Yh.has(i)||Yh.set(i,0);let t=Yh.get(i);if(Yh.set(i,Yh.get(i)+1),t>0){let n=`${i}_${t}`;return Yh.set(n,1),n}return i}let hg=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Fs(i){return!!i.match(hg)}function Yc(i,t,n){t==null&&(t=0),n==null&&(n=i.length);let s=1;for(let a=t;a<n;++a)s*=i[a];return s}function ms(i){if(i.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<i.length;n++){let s=i[n];s<t&&(t=s)}return t}function Cl(i){if(i.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n++){let s=i[n];s>t&&(t=s)}return t}function rl(i,t){if(t<i)throw new mt(`end (${t}) < begin (${i}) is forbidden.`);let n=[];for(let s=i;s<t;++s)n.push(s);return n}function dg(i,t){return En(i,t)}function Uf(i,t=-1){let n=i.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),pt(i,n)}function Qc(i,t,n){return bt(()=>{switch(i.rank){case 1:return of(i,t,n);case 2:return lf(i,[t,0],[n,i.shape[1]]);case 3:return uf(i,[t,0,0],[n,i.shape[1],i.shape[2]]);case 4:return kc(i,[t,0,0,0],[n,i.shape[1],i.shape[2],i.shape[3]]);case 5:return hi(i,[t,0,0,0,0],[n,i.shape[1],i.shape[2],i.shape[3],i.shape[4]]);case 6:return hi(i,[t,0,0,0,0,0],[n,i.shape[1],i.shape[2],i.shape[3],i.shape[4],i.shape[5]]);default:throw new mt(`sliceAlongFirstAxis() received an unsupported tensor rank: ${i.rank}`)}})}function sp(i,t,n){return bt(()=>{switch(i.rank){case 1:return of(i,t,n);case 2:return lf(i,[0,t],[i.shape[0],n]);case 3:return uf(i,[0,0,t],[i.shape[0],i.shape[1],n]);case 4:return kc(i,[0,0,0,t],[i.shape[0],i.shape[1],i.shape[2],n]);default:throw new mt(`sliceAlongLastAxis() received an unsupported tensor rank: ${i.rank}`)}})}function ap(i,t,n,s){return bt(()=>{switch(i.rank){case 1:return of(i,t,n);case 2:switch(s){case 1:return Qc(i,t,n);case 2:return sp(i,t,n);default:throw new mt(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Qc(i,t,n);case 2:return uf(i,[0,t,0],[i.shape[0],n,i.shape[2]]);case 3:return sp(i,t,n);default:throw new mt(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Qc(i,t,n);case 2:return kc(i,[0,t,0,0],[i.shape[0],n,i.shape[2],i.shape[3]]);case 3:return kc(i,[0,0,t,0],[i.shape[0],i.shape[1],n,i.shape[3]]);case 4:return sp(i,t,n);default:throw new mt(`The axis is not within the rank of the tensor ${s}`)}default:throw new mt(`sliceAlongLastAxis() received an unsupported tensor rank: ${i.rank}`)}})}function My(i,t=-1){let n;return t<0&&(n=i[0].rank,t=n!==0?n:0),t===i[0].rank&&(t=-1),Ti(i,t)}function _y(i,t){switch(i.rank){case 1:return Xv([i,t]);case 2:return qv([i,t],0);case 3:return Kv([i,t],0);case 4:return Yv([i,t],0);default:throw new mt(`concatAlongFirstAxis() received an unsupported tensor rank: ${i.rank}`)}}function Cy(i,t){if(Array.isArray(t)||(t=[t]),i.rank!==t.length)throw new mt(`The length of input n (${t.length}) does not match the number of dimensions in input x (${i.rank})`);return oo(i,t)}function zf(i,t=0,n=1,s,a){return cb(i,t,n,s,a)}function Qu(i,t,n,s){if(i.rank<2||t.rank<2)throw new Jr(`dot requires both inputs to be rank >= 2 but got x shape = ${i.shape} and y shape = ${t.shape}`);if(t.rank>=3&&i.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new Jr(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${i.shape} and  y shape = ${t.shape}`);if(i.rank===2&&t.rank===2)return Hu({a:i,b:t,transposeA:!1,transposeB:!1,bias:s?Iy(i.rank,s,"channelsLast"):null,activation:n});{let a=i.shape.slice(),l=a.pop();i=pt(i,[-1,l]);let u=t.shape.slice(),h=u.pop(),f=u.pop(),d=[...u,h],m=Array.from({length:t.rank},(x,R)=>R===0?t.rank-2:R<=t.rank-2?R-1:R);t=pt(xi(t,m),[f,-1]);let g=[...a,...d];return pt(Hu({a:i,b:t,transposeA:!1,transposeB:!1,bias:s?Iy(i.rank,s,"channelsLast"):null,activation:n}),g)}}function rx(i,t,n){return bt(()=>(t=Array.isArray(t)?ga(t,"int32"):En(t,"int32"),Ec(i,t,n)))}function $f(i){return qe(i,i)}function Iy(i,t,n){let s=t.shape;if(t.rank!==1&&t.rank!==i)throw new mt(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${i}`);if(i===5){if(n==="channelsFirst")return s.length===1?pt(t,[1,s[0],1,1,1]):pt(t,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?pt(t,[1,1,1,1,s[0]]):pt(t,[1].concat(s))}else if(i===4){if(n==="channelsFirst")return s.length===1?pt(t,[1,s[0],1,1]):pt(t,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?pt(t,[1,1,1,s[0]]):pt(t,[1].concat(s))}else if(i===3){if(n==="channelsFirst")return s.length===1?pt(t,[1,s[0],1]):pt(t,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?pt(t,[1,1,s[0]]):pt(t,[1].concat(s))}else if(i<3)return t;throw new mt(`Unsupported input rank by biasAdd: ${t.rank}`)}function Il(i,t,n){return bt(()=>(n==null&&(n="channelsLast"),Xs(n),fn(i,Iy(i.rank,t,n))))}function ix(i,t,n,s){return bt(()=>Dc(i,t,n,s))}function Vf(i,t,n=!1){return n?i():t()}let rw=["fanIn","fanOut","fanAvg"],iw=["normal","uniform","truncatedNormal"];class il extends _h{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class ky extends il{apply(t,n){return js(t,n)}}ky.className="Zeros",dn(ky);class pg extends il{apply(t,n){return co(t,n)}}pg.className="Ones",dn(pg);class Ry extends il{constructor(t){if(super(),typeof t!="object")throw new mt(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new mt(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return bt(()=>qe(Jn(this.value),co(t,n)))}getConfig(){return{value:this.value}}}Ry.className="Constant",dn(Ry);class Ny extends il{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return Gi(t,this.minval,this.maxval,n)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Ny.className="RandomUniform",dn(Ny);class Ly extends il{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if((n=n||"float32")!=="float32"&&n!=="int32")throw new Jr(`randomNormal does not support dType ${n}.`);return zf(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Ly.className="RandomNormal",dn(Ly);class Dy extends il{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if((n=n||"float32")!=="float32"&&n!=="int32")throw new Jr(`truncatedNormal does not support dType ${n}.`);return Bh(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Dy.className="TruncatedNormal",dn(Dy);class Fy extends il{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return bt(()=>{if(t.length!==2||t[0]!==t[1])throw new mt("Identity matrix initializer can only be used for 2D square matrices.");return qe(this.gain,Tm(t[0]))})}getConfig(){return{gain:this.gain}}}Fy.className="Identity",dn(Fy);class eo extends il{constructor(t){if(super(),t.scale<0)throw new mt(`scale must be a positive float. Got: ${t.scale}`);var n;this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,n=this.mode,Xc(rw,"FanMode",n),this.distribution=t.distribution==null?"normal":t.distribution,function(s){Xc(iw,"Distribution",s)}(this.distribution),this.seed=t.seed}apply(t,n){let s=function(h,f="channelsLast"){let d,m;if(Xs(f),h.length===2)d=h[0],m=h[1];else if([3,4,5].indexOf(h.length)!==-1){if(f==="channelsFirst"){let g=Yc(h,2);d=h[1]*g,m=h[0]*g}else if(f==="channelsLast"){let g=Yc(h,0,h.length-2);d=h[h.length-2]*g,m=h[h.length-1]*g}}else{let g=Yc(h);d=Math.sqrt(g),m=Math.sqrt(g)}return[d,m]}(t),a=s[0],l=s[1],u=this.scale;if(this.mode==="fanIn"?u/=Math.max(1,a):this.mode==="fanOut"?u/=Math.max(1,l):u/=Math.max(1,(a+l)/2),this.distribution==="normal"){let h=Math.sqrt(u);if((n=n||"float32")!=="float32"&&n!=="int32")throw new Jr(`${this.getClassName()} does not support dType ${n}.`);return Bh(t,0,h,n,this.seed)}{let h=Math.sqrt(3*u);return Gi(t,-h,h,n)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}eo.className="VarianceScaling",dn(eo);class fg extends eo{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return eo.className}}fg.className="GlorotUniform",dn(fg);class mg extends eo{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return eo.className}}mg.className="GlorotNormal",dn(mg);class gg extends eo{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return eo.className}}gg.className="HeNormal",dn(gg);class yg extends eo{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return eo.className}}yg.className="HeUniform",dn(yg);class vg extends eo{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return eo.className}}vg.className="LeCunNormal",dn(vg);class bg extends eo{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return eo.className}}bg.className="LeCunNormal",dn(bg);class Py extends il{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,this.seed!=null)throw new Jr("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,n){return bt(()=>{if(t.length<2)throw new Jr("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);let s=zf(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),a=bb.gramSchmidt(s);return t[0]>t[1]&&(a=xi(a)),qe(this.gain,a)})}getConfig(){return{gain:this.gain,seed:this.seed}}}Py.className="Orthogonal",dn(Py);let sx={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ax(i,t={}){return Bf(i,ko.getMap().classNameMap,t,"initializer")}function Cs(i){return yy(i)}function Ss(i){if(typeof i=="string"){let t=i in sx?sx[i]:i;if(t==="GlorotNormal")return new mg;if(t==="GlorotUniform")return new fg;if(t==="HeNormal")return new gg;if(t==="HeUniform")return new yg;if(t==="LeCunNormal")return new vg;if(t==="LeCunUniform")return new bg;{let n={};return n.className=t,n.config={},ax(n)}}return i instanceof il?i:ax(i)}function sw(){return new ky}function aw(){return new pg}function ow(i){return new Ry(i)}function lw(i){return new Ny(i)}function uw(i){return new Ly(i)}function cw(i){return new Dy(i)}function hw(i){return new Fy(i)}function dw(i){return new eo(i)}function pw(i){return new fg(i)}function fw(i){return new mg(i)}function mw(i){return new gg(i)}function gw(i){return new yg(i)}function yw(i){return new vg(i)}function y(i){return new bg(i)}function r(i){return new Py(i)}let o=0;function c(){return o++}let p={};function v(i=""){return i in p||(p[i]=0),p[i]+=1,i+p[i].toString()}function w(i){return Array.isArray(i)&&Array.isArray(i[0])}function S(i){return i.length===0?[]:Array.isArray(i[0])?i:[i]}function O(i){let t;if(Array.isArray(i)){if(i.length!==1)throw new mt(`Expected Tensor length to be 1; got ${i.length}`);t=i[0]}else t=i;return t}function U(i){if(Array.isArray(i)&&Array.isArray(i[0])){if(i.length===1)return(i=i)[0];throw new mt(`Expected exactly 1 Shape; got ${i.length}`)}return i}function K(i){let t=0;for(let n of i)n.shape.length===0?t+=1:t+=n.shape.reduce((s,a)=>s*a);return t}class Y{constructor(t,n="float32",s="Variable",a=!0,l=null){this.dtype=n??"float32",this.shape=t.shape,this.id=c(),s=s??"Variable",this.originalName=Ty(s),this.name=nx(this.originalName),this.trainable_=a,this.constraint=l,this.val=V0(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(n,s){if(n.shape.toString()!==s.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(s.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function Z(i){return i.map(t=>t.read())}function ne(i){i.forEach(t=>{t[0].write(t[1])})}class ce{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class ve{constructor(t,n,s,a,l,u,h){this.dtype=t,this.shape=n,this.sourceLayer=s,this.inputs=a,this.callArgs=l,this.outputTensorIndex=h,this.id=c(),u!=null&&(this.originalName=Ty(u),this.name=nx(this.originalName)),this.rank=n.length}}let Fe=0;class fe{constructor(t,n){this.callArgs=n,this.id=Fe++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(let s of t.inboundLayers)s?.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){let t=[];for(let n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let oe=0;class Pe extends _h{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=oe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){let s=this.getClassName();n=Ku(s)+"_"+v(s)}if(this.name=n,this.trainable_=t.trainable==null||t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let l=null;t.batchSize!=null&&(l=t.batchSize),s=[l].concat(t.inputShape)}this.batchInputShape=s;let a=t.dtype;a==null&&(a=t.inputDType),a==null&&(a="float32"),this.dtype=a}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new Ea(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new mt(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Ja(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Ja(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new du(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new du(`Layer ${this.name} is not connected, no input to return.`);return Ja(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new du(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new du(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ja(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=fs(t),this.inputSpec==null||this.inputSpec.length===0)return;let n=fs(this.inputSpec);if(t.length!==n.length)throw new mt(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let s=0;s<t.length;s++){let a=t[s],l=n[s];if(l==null)continue;let u=a.rank;if(l.ndim!=null&&u!==l.ndim)throw new mt(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${l.ndim}, found ndim=${u}`);if(l.maxNDim!=null&&u>l.maxNDim)throw new mt(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${l.maxNDim}, found ndim=${u}`);if(l.minNDim!=null&&u<l.minNDim)throw new mt(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${l.minNDim}, found ndim=${u}.`);if(l.dtype!=null&&a.dtype!==l.dtype)throw new mt(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${l.dtype}, found dtype=${a.dtype}.`);if(l.axes){let h=a.shape;for(let f in l.axes){let d=Number(f),m=l.axes[f],g=d>=0?h[d]:h[h.length+d];if(m!=null&&[m,null].indexOf(g)===-1)throw new mt(`Input ${s} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${m} but got shape ${h}.`)}}if(l.shape!=null)for(let h=0;h<l.shape.length;++h){let f=l.shape[h],d=a.shape[h];if(f!=null&&d!=null&&f!==d)throw new mt(`Input ${s} is incompatible with layer ${this.name}: expected shape=${l.shape}, found shape=${a.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();let s=fs(t),a=!0;for(let u of s)if(!(u instanceof ve)){a=!1;break}let l=!0;for(let u of s)if(u instanceof ve){l=!1;break}if(a===l)throw new mt("Arguments to apply() must be all SymbolicTensors or all Tensors");return fu(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);let u=[];for(let h of fs(t))u.push(h.shape);this.build(Ja(u)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&l&&(this._refCount=1)}if(this.assertInputCompatibility(t),l){let u=this.call(t,n),h=fs(u),f=[];for(let d of h)s.indexOf(d)!==-1&&(d=d.clone()),f.push(d);if(u=Ja(f),this.activityRegularizer!=null)throw new Jr("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}{let u=function(m){m=fs(m);let g=[];for(let x of m)g.push(x.shape);return Ja(g)}(t),h=this.computeOutputShape(u),f,d="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?u[0]:u),f=h!=null&&h.length>0&&Array.isArray(h[0])?h.map((m,g)=>new ve(d,m,this,fs(t),n,this.name,g)):new ve(d,h,this,fs(t),n,this.name),this.addInboundNode(t,f,null,null,u,h,n),this._refCount++,this.activityRegularizer!=null)throw new Jr("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return f}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,a)=>{s!=null&&t[a]!=null&&t[a]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new du(`The layer ${this.name} has never been called and thus has no defined output shape.`);let t=[];for(let n of this.inboundNodes){let s=JSON.stringify(n.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){let n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}throw new du(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ea(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return K(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Z(t?this.trainableWeights:this.weights)}setWeights(t){bt(()=>{let n=this.weights;if(n.length!==t.length)throw new mt(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;let s=[],a=Z(n);for(let l=0;l<a.length;++l){let u=a[l],h=n[l],f=t[l];if(!Ye(u.shape,f.shape))throw new mt(`Layer weight shape ${u.shape} not compatible with provided weight shape ${f.shape}`);s.push([h,f])}ne(s)})}addWeight(t,n,s,a,l,u,h,f){if(this._addedWeightNames.indexOf(t)!==-1)throw new mt(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(a=f!=null?f():Ss("zeros"));let d=a.apply(n,s),m=new Y(d,s,t,u,h);return d.dispose(),l!=null&&this.addLoss(()=>l.apply(m.read())),u==null&&(u=!0),u?this._trainableWeights.push(m):this._nonTrainableWeights.push(m),m}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=fs(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null){if(!Array.isArray(n))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)})}return null}return n}addInboundNode(t,n,s,a,l,u,h=null){let f=fs(t);n=fs(n),s=fs(s),a=fs(a),l=S(l),u=S(u);let d=[],m=[],g=[];for(let x of f)d.push(x.sourceLayer),m.push(x.nodeIndex),g.push(x.tensorIndex);new fe({outboundLayer:this,inboundLayers:d,nodeIndices:m,tensorIndices:g,inputTensors:f,outputTensors:n,inputMasks:s,outputMasks:a,inputShapes:l,outputShapes:u},h);for(let x=0;x<n.length;x++)n[x].sourceLayer=this,n[x].nodeIndex=this.inboundNodes.length-1,n[x].tensorIndex=x}getConfig(){let t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount==0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function Re(i,t,n){if((t==null||n!=null&&n>0)&&(t=i.sourceLayer,n=i.nodeIndex),t.inboundNodes.length===0)return[i];{let s=t.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{let a=[];for(let l=0;l<s.inboundLayers.length;l++){let u=Re(s.inputTensors[l],s.inboundLayers[l],s.nodeIndices[l]);for(let h of u)a.indexOf(h)===-1&&a.push(h)}return a}}}class We extends Pe{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:v("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new mt("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new mt("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new mt("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let s=t.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];let a=new ve(this.dtype,this.batchInputShape,this,[],{},this.name);a.nodeIndex=0,a.tensorIndex=0,new fe({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new mt(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function Je(i){if(i.batchShape==null&&i.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(i.batchShape!=null&&i.shape!=null)throw new mt("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=i.batchShape;i.shape!=null&&t==null&&(t=[null].concat(i.shape));let n=i.dtype;return n==null&&(n="float32"),new We({batchInputShape:t,name:i.name,dtype:n,sparse:i.sparse}).inboundNodes[0].outputTensors[0]}async function dt(i){if(i==null)return;let t=[],n=[],s=[];for(let a in i){let l=i[a];if(typeof l!="number"){let u=l;t.push(u.data()),n.push(a),s.push(u)}}if(t.length>0){let a=await Promise.all(t);for(let l=0;l<a.length;++l)i[n[l]]=a[l][0];ni(s)}}function wt(i){if(i!=null)for(let t in i){let n=i[t];typeof n!="number"&&n.dispose()}}var Dt;We.className="InputLayer",dn(We),function(i){i[i.SILENT=0]="SILENT",i[i.VERBOSE=1]="VERBOSE"}(Dt||(Dt={}));class Ft{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class De{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(let n of this.callbacks)n.setParams(t)}setModel(t){for(let n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(let s of this.callbacks)await s.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(let s of this.callbacks)await s.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(let s of this.callbacks)await s.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(let s of this.callbacks)await s.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(let n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(let n of this.callbacks)await n.onTrainEnd(t)}}class nt extends Ft{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});let s=n.size==null?0:n.size;this.seen+=s;for(let a in n){let l=n[a];if(typeof l=="number")this.totals.hasOwnProperty(a)||(this.totals[a]=0),this.totals[a]=this.totals[a]+l*s;else{let u;a in this.totals?u=this.totals[a]:this.totals[a]=0;let h=bt(()=>fn(this.totals[a],qe(l,s)));this.totals[a]=h,u?.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(let s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:bt(()=>{let a=qe(yn(1,this.seen),this.totals[s]);n[s]=a,this.totals[s].dispose(),wa(n[s])}))}}class _t extends Ft{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(let s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){let t=[],n=[],s=[];for(let l in this.history){let u=this.history[l];for(let h=0;h<u.length;++h)if(typeof u[h]!="number"){let f=u[h];t.push(f.data()),n.push(l),s.push(h)}}let a=await Promise.all(t);for(let l=0;l<a.length;++l)this.history[n[l]][s[l]].dispose(),this.history[n[l]][s[l]]=a[l][0]}}class Rt extends Ft{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||xb,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=125),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");yi(this.yieldEvery)&&(this.maybeWait=function(s,a,l){let u,h=l!=null?l():ha();return(...f)=>{let d=l!=null?l():ha();return d-h<a||(h=d,u=s(...f)),u}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,s){let a=[];this.yield!=null&&(await dt(s),a.push(this.yield(t,n,s))),a.push(this.nextFrameFunc()),await Promise.all(a)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await dt(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){let s=[];this.epochEnd!=null&&(await dt(n),s.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,n){this.batchBegin!=null&&(await dt(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){let s=[];this.batchEnd!=null&&(await dt(n),s.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):yi(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await dt(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await dt(t),await this.trainEnd(t))}}function Tt(i,t){return i==null&&(i={}),i instanceof Ft?[i]:Array.isArray(i)&&i[0]instanceof Ft?i:fs(i).map(n=>new Rt(n,t))}class Ct{constructor(){}static registerCallbackConstructor(t,n){ee(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Ct.checkForDuplicate(n),Ct.constructors[t]==null&&(Ct.constructors[t]=[]),Ct.constructors[t].push(n)}static checkForDuplicate(t){for(let n in Ct.constructors)Ct.constructors[+n].forEach(s=>{if(s===t)throw new mt("Duplicate callback constructor.")})}static clear(){Ct.constructors={}}static createCallbacks(t){let n=[];for(let s in Ct.constructors){let a=+s;t>=a&&n.push(...Ct.constructors[a])}return n.map(s=>new s)}}function Zt(i,t,n,s,a,l,u,h,f){let d=new _t,m=[new nt,...Ct.createCallbacks(t)];i!=null&&m.push(...i),m.push(d);let g=new De(m);return g.setParams({epochs:n,initialEpoch:s,samples:a,steps:l,batchSize:u,verbose:t,doValidation:h,metrics:f}),{callbackList:g,history:d}}function pn(i,t={},n=!1){return Bf(i,ko.getMap().classNameMap,t,"layer",n)}function er(i,t){return bt(()=>{i.dtype!=="float32"&&(i=En(i,"float32"));let n=Yn($f(i),t,!0),s=Ch(n.shape,Js()),a=rs(Tl(n,s));return yn(i,a)})}function ur(i,t){return bt(()=>ws($f(Un(t,i)),-1))}function $n(i,t){return bt(()=>ws(_s(Un(t,i)),-1))}function Jt(i,t){return bt(()=>{let n=Un(i,t),s=Xa(_s(i),Js(),Number.MAX_VALUE),a=_s(yn(n,s));return qe(100,ws(a,-1))})}function kn(i,t,n=!1){return bt(()=>{if(n)t=Rc(t);else{let s=Yn(t,t.shape.length-1,!0);t=yn(t,s)}return t=Xa(t,Js(),1-Js()),ps(Yn(qe(En(i,"float32"),lo(t)),t.shape.length-1))})}function wr(i,t,n=!1){return bt(()=>{let s=En(Ac(function(l){let u=[Yc(l.shape)];return pt(l,u)}(i)),"int32"),a=(t=Xa(t,Js(),1-Js())).shape;return kn(pt(Md(s,a[a.length-1]),a),t,n)})}function yt(i,t){return bt(()=>{let n;return n=Xa(t,Js(),1-Js()),n=lo(yn(n,Un(1,n))),ws(function(s,a){if(!Ye(s.shape,a.shape))throw new mt(`logits and labels must have the same shape, but got shapes ${JSON.stringify(s.shape)} and ${JSON.stringify(a.shape)}`);return bt(()=>{let l=po(a),u=ps(_s(a));return fn(Un(l,qe(a,s)),Fu(ao(u)))})}(i,n),-1)})}function Lr(i,t){return bt(()=>{let n=er(i,-1),s=er(t,-1),a=qe(n,s);return ps(Yn(a,-1))})}Ct.constructors={};let jn={meanSquaredError:ur,meanAbsoluteError:$n,meanAbsolutePercentageError:Jt,meanSquaredLogarithmicError:function(i,t){return bt(()=>{let n=Xa(t,Js(),Number.MAX_VALUE),s=lo(fn(1,n)),a=Xa(i,Js(),Number.MAX_VALUE),l=lo(fn(1,a));return ws($f(Un(s,l)),-1)})},squaredHinge:function(i,t){return bt(()=>{let n=Tl(0,Un(1,qe(i,t)));return ws($f(n),-1)})},hinge:function(i,t){return bt(()=>{let n=Tl(0,Un(1,qe(i,t)));return ws(n,-1)})},categoricalHinge:function(i,t){return bt(()=>{let n=Yn(qe(i,t),-1),s=uo(qe(Un(1,i),t),-1);return Tl(0,fn(1,Un(s,n)))})},logcosh:function(i,t){return bt(()=>{let n=Math.log(2),s=Un(t,i),a=Un(fn(s,Tc(qe(-2,s))),n);return ws(a,-1)})},categoricalCrossentropy:kn,sparseCategoricalCrossentropy:wr,binaryCrossentropy:yt,kullbackLeiblerDivergence:function(i,t){return bt(()=>{let n=Xa(i,Js(),1),s=Xa(t,Js(),1);return Yn(qe(i,lo(yn(n,s))),-1)})},poisson:function(i,t){return bt(()=>{let n=lo(fn(Js(),t));return ws(Un(t,qe(i,n)),-1)})},cosineProximity:Lr};function Dr(i){if(typeof i=="string"){if(i in jn)return jn[i];let t=`Unknown loss ${i}`;throw i.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${i}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new mt(t)}return i}function Hn(i,t){return bt(()=>{let n=qe(.5,ho(t)),s=dg(Ka(t,n),i.dtype);return ws(so(i,s),-1)})}function ei(i,t){return bt(()=>dg(so(yc(i,-1),yc(t,-1)),"float32"))}function Br(i,t){return bt(()=>En(Yn(Yo(so(i,1),so(t,1))),"float32"))}function rn(i,t){return bt(()=>{let n=Br(i,t),s=function(l,u){return bt(()=>En(Yn(Yo(so(l,0),so(u,1))),"float32"))}(i,t),a=fn(n,s);return En(Ia(Ka(a,0),yn(n,a),0),"float32")})}function Nn(i,t){return yt(i,t)}function Dn(i,t){return i.rank===t.rank&&(i=au(i,[i.rank-1])),(t=yc(t,-1)).dtype!==i.dtype&&(t=En(t,i.dtype)),En(so(i,t),"float32")}let rr=kn,Gn=wr,Ur={binaryAccuracy:Hn,categoricalAccuracy:ei,precision:rn,categoricalCrossentropy:rr,sparseCategoricalCrossentropy:Gn,mse:ur,MSE:ur,mae:$n,MAE:$n,mape:Jt,MAPE:Jt,cosine:Lr};function zr(i){if(typeof i=="string"&&i in Ur)return Ur[i];if(typeof i!="string"&&i!=null)return i;throw new mt(`Unknown metric ${i}`)}function fi(i){if(pu(i!==null,`Unknown LossOrMetricFn ${i}`),typeof i=="string")return i;{let t;for(let n of Object.keys(jn))if(jn[n]===i){t=n;break}if(t!==void 0)return t;for(let n of Object.keys(Ur))if(Ur[n]===i){t=n;break}return t!==void 0?t:i.name}}function us(i,t,n=!1){if(i==null||typeof i!="object"||Object.getPrototypeOf(i)!==Object.prototype||!Yi(i))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){let s=JSON.stringify(i);s.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function Yi(i){if(i===null)return!0;if(typeof i=="object"){if(Object.getPrototypeOf(i)===Object.prototype){let t=Object.keys(i);for(let n of t)if(typeof n!="string"||!Yi(i[n]))return!1;return!0}if(Array.isArray(i)){for(let t of i)if(!Yi(t))return!1;return!0}return!1}{let t=typeof i;return t==="string"||t==="number"||t==="boolean"}}function it(i,t,n=console.log){let s="";for(let a=0;a<i.length;++a)a>0&&(s=s.slice(0,s.length-1)+" "),s+=i[a],s=s.slice(0,t[a]),s+=" ".repeat(t[a]-s.length);n(s)}function Ke(i,t,n){let s;try{s=JSON.stringify(i.outputShape)}catch{s="multiple"}it([`${i.name} (${i.getClassName()})`,s,i.countParams().toString()],t,n)}function an(i,t,n,s){let a;try{a=JSON.stringify(i.outputShape)}catch{a="multiple"}let l=[];for(let d of i.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let m=0;m<d.inboundLayers.length;++m){let g=d.inboundLayers[m].name,x=d.nodeIndices[m],R=d.tensorIndices[m];l.push(`${g}[${x}][${R}]`)}let u=i.name,h=i.getClassName(),f=l.length===0?"":l[0];it([`${u} (${h})`,a,i.countParams().toString(),f],t,s);for(let d=1;d<l.length;++d)it(["","","",l[d]],t,s)}function Ln(i,t,n){return(i==="inboundNodes"||i==="outputLayers"||i==="inputLayers")&&t===0&&typeof n=="string"}function dr(i,t){if(i===null)return null;if(typeof i=="string")return qh(i);if(typeof i=="number"||typeof i=="boolean")return i;if(i instanceof Array){let n=[],s=i.length;for(let a=0;a<s;++a){let l=i[a];Ln(t,a,l)?n.push(l):n.push(dr(l,t))}return n}{let n={};for(let s of Object.keys(i)){let a=i[s];if(s==="name"&&typeof a=="string")n[s]=a;else{let l=qh(s);n[l]=dr(a,l)}}return n}}function en(i,t){if(i==null)return null;if(typeof i=="string")return Ku(i);if(typeof i=="number"||typeof i=="boolean")return i;if(i instanceof Array){let n=[],s=i.length;for(let a=0;a<s;++a){let l=i[a];Ln(t,a,l)?n.push(l):n.push(en(l,t))}return n}{let n={};for(let s of Object.keys(i)){let a=i[s];n[Ku(s)]=s!=="name"&&s!=="className"||typeof a!="string"?en(a,s):a}return n}}let Er="3.13.0";class sr{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof sr)for(let n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(let n of t)this.add(n.key,n.value)}}add(t,n,s){if(this.id2Value[t.id]!=null)throw new mt(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=function(a,l){if(a.dtype==null||a.dtype===l.dtype)return l;try{return En(l,a.dtype)}catch{throw new mt(`The dtype of the feed (${l.dtype}) can not be cast to the dtype of the key '${a.name}' (${a.dtype}).`)}}(t,n),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof ve){if(this.id2Value[t.id]==null)throw new mt(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{let n=this.name2Id[t];if(n==null)throw new mt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof ve){if(this.id2Value[t.id]==null)throw new mt(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{let n=this.name2Id[t];if(n==null)throw new mt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&ni(this.id2Mask)}}let Vn={},On={};function Hr(i,t,n,s){let a=n!=null&&n.training,l=Array.isArray(i),u=l?i:[i],h=u.map(N=>N.name),f=[],d=t.names();for(let N of h)d.indexOf(N)!==-1?f.push(t.getValue(N)):f.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);let m=h.join(",")+"|"+t.names().join(","),g,x;if(Vn[m]==null){let N=function(F,H){ee(F!=null&&F.length>0,()=>"Expected at least one fetch, got none");let W=[],G={};if(F.length===1){let se=fr(F[0],H);W=se.sorted,G=se.recipientMap}else{let se=new Set;for(let ge of F){let{sorted:Ce,recipientMap:Be}=fr(ge,H);for(let Ve of Ce)se.has(Ve.name)||(W.push(Ve),se.add(Ve.name));for(let Ve in Be)G[Ve]==null&&(G[Ve]=new Set),Be[Ve].forEach(ze=>G[Ve].add(ze))}}return{sorted:W,recipientCounts:vt(G)}}(u,t);g=N.sorted,x=N.recipientCounts,Vn[m]=g,On[m]=x}g=Vn[m],x={},a||Object.assign(x,On[m]);let R=new sr(t);for(let N=0;N<g.length;++N){if(s!=null){let Xe=f0().numTensors;Xe>s.maxNumTensors&&(s.maxNumTensors=Xe),Xe<s.minNumTensors&&(s.minNumTensors=Xe)}let F=g[N],H=F.sourceLayer;if(H instanceof We)continue;let W=[],G=[],se=[],ge=!1;for(let Xe of F.inputs){let tt=R.getValue(Xe),ot=R.getMask(Xe);W.push(tt),G.push(ot),ot!=null&&(ge=!0),a||(x[Xe.name]--,x[Xe.name]!==0||t.hasKey(Xe)||h.indexOf(Xe.name)!==-1||tt.isDisposed||Xe.sourceLayer.stateful===!0||se.push(tt))}ge&&((n=n||{}).mask=G[0]);let Ce=fs(H.apply(W,n)),Be=null;H.supportsMasking&&(Be=H.computeMask(W,G));let Ve=tr(F),ze=Array.isArray(Ve)?Ve:[Ve];for(let Xe=0;Xe<ze.length;++Xe){R.hasKey(ze[Xe])||R.add(ze[Xe],Ce[Xe],Array.isArray(Be)?Be[0]:Be);let tt=h.indexOf(ze[Xe].name);tt!==-1&&(f[tt]=Ce[Xe])}a||ni(se)}return R.disposeMasks(),l?f:f[0]}function vt(i){let t={};for(let n in i)t[n]=i[n].size;return t}function fr(i,t){let n=new Set,s=[],a={};for(let h of t.names())n.add(h);let l=[],u=[];for(l.push(i);l.length>0;){let h=l[l.length-1];if(n.has(h.name)){l.pop();continue}let f=u[u.length-1]===l.length-1;if(h.inputs.length===0||f)l.pop(),s.push(h),n.add(h.name),f&&u.pop();else{u.push(l.length-1);for(let d of h.inputs)a[d.name]==null&&(a[d.name]=new Set),a[d.name].add(h.name),n.has(d.name)||l.push(d)}}return{sorted:s,recipientMap:a}}function tr(i){let t;if(i.sourceLayer.inboundNodes.length===1)t=i.sourceLayer.output;else{let n=null;for(let s=0;s<i.sourceLayer.inboundNodes.length;++s)for(let a of i.sourceLayer.inboundNodes[s].outputTensors)if(a.id===i.id){n=s;break}t=i.sourceLayer.getOutputAt(n)}return t}class br extends Pe{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){let G=this.getClassName().toLowerCase();this.name=v(G)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Yu(this.inputs).length!==this.inputs.length)throw new mt(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(G=>G.name)}`);Yu(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(G=>G.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let G of this.outputs){let se=G.sourceLayer,ge=G.nodeIndex,Ce=G.tensorIndex;this.outputLayers.push(se),this.outputLayersNodeIndices.push(ge),this.outputLayersTensorIndices.push(Ce)}for(let G of this.inputs){let se=G.sourceLayer,ge=G.nodeIndex,Ce=G.tensorIndex;pu(ge===0,"input layer has >1 nodes"),pu(Ce===0,"input layer has >1 tensors"),this.inputLayers.push(se),this.inputLayersNodeIndices.push(ge),this.inputLayersTensorIndices.push(Ce)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let G=0;G<this.inputLayers.length;G++){let se=this.inputLayers[G];if(!(se instanceof We))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${G} (0-based) originates from layer type ${se.getClassName()}.`);this.inputNames.push(se.name),this.feedInputShapes.push(se.batchInputShape),this.feedInputNames.push(se.name)}for(let G of this.outputLayers)this.outputNames.push(G.name);this.internalInputShapes=this.inputs.map(G=>G.shape),this.internalOutputShapes=this.outputs.map(G=>G.shape);let n={},s={},a={},l={},u={},h=[],f=(G,se,ge,Ce,Be,Ve)=>{Ce!=null&&Be!=null&&Ve!=null||(Ce=G.sourceLayer,Be=G.nodeIndex,Ve=G.tensorIndex);let ze=Ce.inboundNodes[Be];if(ge.indexOf(ze)!==-1)throw new Ea(`The tensor ${G.name} at layer "${Ce.name}" is part of a cycle.`);if(se.indexOf(ze)!==-1)return;this.containerNodes.add(br.nodeKey(Ce,Be)),Ce.id in u||(u[Ce.id]=Object.keys(u).length),ge.indexOf(ze)===-1&&ge.push(ze);let Xe=ze.inboundLayers.length;for(let tt=0;tt<Xe;tt++){let ot=ze.inputTensors[tt],ut=ze.inboundLayers[tt],ft=ze.nodeIndices[tt],kt=ze.tensorIndices[tt];f(ot,se,ge,ut,ft,kt)}for(se.push(ze);ge.indexOf(ze)>=0;)ge.splice(ge.indexOf(ze),1);h.push(ze)},d=[],m=[];for(let G of this.outputs)f(G,d,m);let g=h.slice().reverse();for(let G of g){s[G.id]=G,G.id in n||(n[G.id]=0);let se=n[G.id],ge=a[G.outboundLayer.id]==null?0:a[G.outboundLayer.id];se=Math.max(se,ge),a[G.outboundLayer.id]=se,l[G.outboundLayer.id]=G.outboundLayer,n[G.id]=se;for(let Ce=0;Ce<G.inboundLayers.length;Ce++){let Be=G.inboundLayers[Ce],Ve=G.nodeIndices[Ce],ze=Be.inboundNodes[Ve],Xe=n[ze.id]==null?0:n[ze.id];n[ze.id]=Math.max(se+1,Xe),s[ze.id]=ze}}let x={};for(let G in n){let se=n[G];se in x||(x[se]=[]),x[se].push(s[G])}let R={};for(let G in a){let se=a[G];se in R||(R[se]=[]),R[se].push(l[G])}let N=Object.keys(R).map(G=>parseInt(G,10)).sort(Mi);this.layers=[];for(let G of N){let se=R[G];se.sort((ge,Ce)=>{let Be=u[ge.id],Ve=u[Ce.id];return Be<Ve?-1:Be>Ve?1:0});for(let ge of se)ge instanceof br&&this.internalContainerRefs.push(ge),this.layers.push(ge)}this.layersByDepth=R,N=Object.keys(x).map(G=>parseInt(G,10)).sort(Mi);let F=this.inputs.slice(),H=[];for(let G of N)for(let se of x[G]){let ge=se.outboundLayer;if(ge!=null){for(let Ce of se.inputTensors)if(F.indexOf(Ce)===-1)throw new Ea(`Graph disconnected: cannot obtain value for tensor ${Ce} at layer "${ge.name}". The following previous layers were accessed without issue: ${H}`);for(let Ce of se.outputTensors)F.push(Ce);H.push(ge.name)}}this.nodesByDepth=x;let W=this.layers.map(G=>G.name);for(let G of W){let se=W.filter(ge=>ge===G).length;if(se!==1)throw new Ea(`The name "${G}" is used ${se} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(W))}this.outboundNodes=[],this.inboundNodes=[],new fe({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(G=>null),outputMasks:this.outputs.map(G=>null),inputShapes:this.inputs.map(G=>G.shape),outputShapes:this.outputs.map(G=>G.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(let n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(let n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new mt("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(let n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){let n=[];for(let s of this.layers)n.push(...s.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){let s={},a=0;for(let u of this.layers)for(let h of u.weights){if(s[h.originalName]!=null)throw new mt(`Duplicate weight name: ${h.originalName}`);s[h.originalName]=h,a++}let l=[];for(let u in t){let h=u;if(s[u]==null){let f=u.split("/");h=f.slice(0,-2).concat([f[f.length-1]]).join("/")}if(s[h]!=null)l.push([s[h],t[u]]);else if(n)throw new mt(`Provided weight data has no target variable: ${u}`);delete s[h]}if(n){let u=[];for(let h in s)u.push(h);if(u.length>0)throw new mt(`${u.length} of ${a} weights are not set: ${u}`)}ne(l)}updatedConfig(){let t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${Er}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){let s=en(this.updatedConfig());return n?JSON.stringify(s):s}call(t,n){return bt(()=>{t=fs(t);let s=new sr;for(let a=0;a<this.inputs.length;++a)s.add(this.inputs[a],t[a]);return Hr(this.outputs,s,n)})}computeMask(t,n){return bt(()=>{let s;return t=fs(t),s=n==null?qu(null,t.length):fs(n),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){let n=S(t);if(n.length!==this.inputLayers.length)throw new mt(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);let s={};for(let h=0;h<n.length;h++){let f=this.inputLayers[h],d=n[h];s[f.name+"_0_0"]=d}let a=Object.keys(this.nodesByDepth).map(h=>parseInt(h,10)).sort(Mi);if(a.length>1)for(let h of a){let f=this.nodesByDepth[h];for(let d of f){let m=d.outboundLayer;if(this.inputLayers.map(N=>N.id).indexOf(m.id)!==-1)continue;let g=[];for(let N=0;N<d.inboundLayers.length;N++){let F=d.inboundLayers[N],H=d.nodeIndices[N],W=d.tensorIndices[N],G=s[`${F.name}_${H}_${W}`];g.push(G)}let x=S(m.computeOutputShape(Ja(g))),R=m.inboundNodes.indexOf(d);for(let N=0;N<x.length;N++)s[`${m.name}_${R}_${N}`]=x[N]}}let l=[],u=[];for(let h=0;h<this.outputLayers.length;h++){let f=this.outputLayers[h],d=this.outputLayersNodeIndices[h],m=this.outputLayersTensorIndices[h],g=`${f.name}_${d}_${m}`;u.push(g)}for(let h=0;h<u.length;h++){let f=u[h];pu(f in s),l.push(s[f])}return Ja(l)}runInternalGraph(t,n){n==null&&(n=qu(null,t.length));let s={};for(let f=0;f<this.inputs.length;++f){let d=this.inputs[f],m=t[f],g=n[f];s[d.id]=[m,g]}let a=Object.keys(this.nodesByDepth).map(f=>parseInt(f,10)).sort(Mi);for(let f of a){let d=this.nodesByDepth[f];for(let m of d){let g=m.outboundLayer,x=m.inputTensors,R=m.outputTensors,N=new Array;for(let F of x)F.id in s&&N.push(s[F.id]);if(N.length===x.length){let F,H,W,G,se={};if(m.callArgs!=null&&(se=m.callArgs),N.length===1){let[ge,Ce]=N[0];se.mask==null&&(se.mask=Ce),W=fs(g.call(ge,se)),G=fs(g.computeMask(ge,Ce)),F=[ge],H=[Ce]}else F=N.map(ge=>ge[0]),H=N.map(ge=>ge[1]),se.mask==null&&(se.mask=H),W=fs(g.call(F,se)),G=fs(g.computeMask(F,H));if(g.activityRegularizer)throw new Jr("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let ge=0;ge<R.length;++ge){let Ce=R[ge],Be=W[ge],Ve=G[ge];s[Ce.id]=[Be,Ve]}}}}let l=[],u=[],h=[];for(let f of this.outputs){pu(f.id in s,`Could not compute output ${f.name} : ${f.id}`);let[d,m]=s[f.id];h.push(d.shape),l.push(d),u.push(m)}return[l,u,h]}buildNodeConversionMap(t){let n={},s;for(let a of this.layers){s=a instanceof br?1:0;for(let l=0;l<a.inboundNodes.length;l++){let u=br.nodeKey(a,l);this.containerNodes.has(u)&&(n[u]=s,s+=1)}}return n}getLayer(t,n){if(n!=null){if(this.layers.length<=n)throw new mt(`Was asked to retrieve layer at index ${n}, but model only has ${this.layers.length} layer(s).`);return this.layers[n]}if(t==null)throw new mt("Provide either a layer name or layer index");for(let s of this.layers)if(s.name===t)return s;throw new mt(`No such layer: ${t}`)}calculateLosses(){return bt(()=>{let t=[];for(let n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){let a=br.nodeKey(n,s);this.containerNodes.has(a)&&t.push(...n.calculateLosses())}return t})}getConfig(){let t={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(let u of this.layers){let h=u.getClassName(),f=u.getConfig(),d=[];for(let g=0;g<u.inboundNodes.length;g++){let x=u.inboundNodes[g],R=br.nodeKey(u,g),N={};if(this.containerNodes.has(R)){if(x.callArgs)try{JSON.stringify(x.callArgs),N=x.callArgs}catch{console.warn(`Layer ${u.name} was passed non-serializable keyword arguments: ${x.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),N={}}if(x.inboundLayers.length>0){let F=[];for(let H=0;H<x.inboundLayers.length;H++){let W=x.inboundLayers[H],G=x.nodeIndices[H],se=x.tensorIndices[H],ge=n[br.nodeKey(W,G)];ge==null&&(ge=0),F.push([W.name,ge,se,N])}d.push(F)}}}let m={};m.name=u.name,m.className=h,m.config=f,m.inboundNodes=d,s.push(m)}t.layers=s;let a=[];for(let u=0;u<this.inputLayers.length;u++){let h=this.inputLayers[u],f=this.inputLayersNodeIndices[u],d=br.nodeKey(h,f);if(!this.containerNodes.has(d))continue;let m=n[d];m==null&&(m=0);let g=this.inputLayersTensorIndices[u];a.push([h.name,m,g])}t.inputLayers=a;let l=[];for(let u=0;u<this.outputLayers.length;u++){let h=this.outputLayers[u],f=this.outputLayersNodeIndices[u],d=br.nodeKey(h,f);if(!this.containerNodes.has(d))continue;let m=n[d];m==null&&(m=0);let g=this.outputLayersTensorIndices[u];l.push([h.name,m,g])}return t.outputLayers=l,t}static fromConfig(t,n,s={},a=!1){let l={},u={};function h(H,W){H.name in u?u[H.name].push(W):u[H.name]=[W]}function f(H,W){let G=[],se;for(let ge of W){let Ce=ge[0],Be=ge[1],Ve=ge[2];if(se=ge[3]==null?{}:ge[3],!(Ce in l))return void h(H,W);let ze=l[Ce];if(ze.inboundNodes.length<=Be)return void h(H,W);let Xe=ze.inboundNodes[Be];G.push(Xe.outputTensors[Ve])}G.length>0&&H.apply(Ja(G),se)}function d(H){let W=H.name,G=pn(H,n.customObjects!=null?n.customObjects:{});G.setFastWeightInitDuringBuild(a),l[W]=G,H.inboundNodes.forEach(se=>{if(!(se instanceof Array))throw new mt(`Corrupted configuration, expected array for nodeData: ${se}`);h(G,se)})}let m=n.name,g=n.layers;for(let H of g)d(H);for(;!J1(u);)for(let H of g){let W=l[H.name];if(W.name in u){let G=u[W.name];delete u[W.name];for(let se of G)f(W,se)}}let x=[],R=[],N=n.inputLayers;for(let H of N){let W=H[0],G=H[1],se=H[2];pu(W in l);let ge=l[W].inboundNodes[G].outputTensors;x.push(ge[se])}let F=n.outputLayers;for(let H of F){let W=H[0],G=H[1],se=H[2];pu(W in l);let ge=l[W].inboundNodes[G].outputTensors;R.push(ge[se])}return new t({inputs:x,outputs:R,name:m})}get stateful(){if(this._stateful)throw new mt("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let t of this.layers)if(t.stateful)return!0;return!1}resetStates(){bt(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}function cn(i,t){return function(n,s,a){let l=s.length;if(n==null||Array.isArray(n)&&n.length===0)return s.map(u=>null);if(l===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&s[0]in n?[n[s[0]]]:[n];if(Array.isArray(n)){if(n.length!==l)throw new Error(`Provided ${a} is an array of ${n.length} element(s), but the model has ${l} outputs. Make sure a set of weights is provided for each model output.`);return n}if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){let u=[];return s.forEach(h=>{h in n?u.push(n[h]):u.push(null)}),u}throw new Error(`The model has multiple (${l}) outputs, so ${a} must be either an array with ${l} elements or an object with ${s} keys. Provided ${a} not understood: ${JSON.stringify(n)}`)}(i,t,"classWeight")}async function Fr(i,t,n,s){if(t!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){let a=bt(()=>{if(i.shape.length===1)return Cu(i);if(i.shape.length===2){if(i.shape[1]>1)return yc(i,1);if(i.shape[1]===1)return pt(i,[i.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${i.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${i.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),l=Array.from(await a.data());ni(a);let u=[];return l.forEach(h=>{if(n[h]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${h} exists in the data but not in classWeight`);u.push(n[h])}),ga(u,"float32")}return null}function Li(i,t){return qe(i,t)}function Is(i,t){let n,s,a=t;n=a.xs,s=a.ys,ee(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let l=mo("input",i.inputNames,n),u=mo("output",i.outputNames,s),h=l[0].shape[0];ee(l.length===i.inputs.length,()=>`LayersModel has ${i.inputs.length} inputs, but the dataset provides ${l.length} inputs.  (Expected input keys: ${JSON.stringify(i.inputNames)})`),ee(u.length===i.outputs.length,()=>`LayersModel has ${i.outputs.length} outputs, but the dataset provides ${u.length} outputs.  (Expected output keys: ${JSON.stringify(i.outputNames)})`);for(let f=0;f<l.length;f++)ee(l[f].shape[0]===h,()=>`Batch size mismatch: input ${i.inputNames[f]} has ${l[f].shape[0]}; expected  ${h} based on input ${i.inputNames[0]}.`);for(let f=0;f<u.length;f++)ee(u[f].shape[0]===h,()=>`Batch size mismatch: output ${i.outputNames[f]} has ${u[f].shape[0]}; expected  ${h} based on input ${i.inputNames[0]}.`);return{xs:l,ys:u}}function mo(i,t,n){if(n instanceof Ni)return[n];if(Array.isArray(n))return ee(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${i} keys ${t}.`),n;{let s=[];for(let a of t){if(n[a]==null)throw new mt(`The feature data generated by the dataset lacks the required ${i} key '${a}'.`);s.push(n[a])}return s}}function Ps(i){return typeof i.iterator=="function"}function sl(i){ee(i>0&&Number.isInteger(i),()=>`batchSize is required to be a positive integer, but got ${i}`)}function Fo(i,t,n){return i==null?[null]:Array.isArray(i)?i.map(s=>Qc(s,t,n-t)):Qc(i,t,n-t)}function op(i,t){return bt(()=>i==null?null:Array.isArray(i)?i.map(n=>op(n,t)):rx(i,t.dtype==="int32"?t:En(t,"int32")))}function Oy(i,t){let n=[],s=0,a=null;for(;s<i;)a=s+t,a>=i&&(a=i),n.push([s,a]),s=a;return n}function xg(i){let t=[];i instanceof Ni&&(i=[i]);for(let n=0;n<i.length;++n){let s=i[n];if(s.rank===1)t.push(Uf(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function al(i,t){if(i==null)return;let n=[];if(t instanceof Ni)n.push(t.id);else if(Array.isArray(t))t.forEach(a=>n.push(a.id));else if(t!=null)for(let a in t){let l=t[a];n.push(l.id)}let s=[];if(i instanceof Ni)n.indexOf(i.id)===-1&&s.push(i);else if(Array.isArray(i))i.forEach(a=>{n.indexOf(a.id)===-1&&s.push(a)});else if(i!=null)for(let a in i){let l=i[a];n.indexOf(l.id)===-1&&s.push(l)}s.forEach(a=>{a.isDisposed||a.dispose()})}function By(i){return Array.isArray(i)}function ox(i){return!function(t){return t instanceof Ni}(i)&&!By(i)}function lx(i,t,n,s=!0,a=""){if(t==null||t.length===0){if(i!=null){let u=!1;if(By(i)&&i.length>0)u=!0;else if(ox(i)){for(let h in i)if(i.hasOwnProperty(h)){u=!0;break}}else u=!0;if(u)throw new mt(`Error when checking model ${a} expected no data, but got ${i}`)}return[]}if(i==null)return t.map(u=>null);let l;if(ox(i)){i=i,l=[];for(let u of t){if(i[u]==null)throw new mt(`No data provided for "${u}". Need data for each key in: ${t}`);l.push(i[u])}}else if(By(i)){if((i=i).length!==t.length)throw new mt(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${i}`);l=i}else{if(i=i,t.length>1)throw new mt(`The model ${a} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${i.shape}`);l=[i]}if(l=xg(l),n!=null)for(let u=0;u<t.length;++u){if(n[u]==null)continue;let h=l[u];if(h.shape.length!==n[u].length)throw new mt(`Error when checking ${a}: expected ${t[u]} to have ${n[u].length} dimension(s). but got array with shape ${h.shape}`);for(let f=0;f<n[u].length;++f){if(f===0&&!s)continue;let d=h.shape[f],m=n[u][f];if(m!=null&&m>=0&&d!==m)throw new mt(`${a} expected a batch of elements where each example has shape [${n[u].slice(1,n[u].length)}] (i.e.,tensor shape [*,${n[u].slice(1,n[u].length)}]) but the ${a} received an input with ${h.shape[0]} examples, each with shape [${h.shape.slice(1,h.shape.length)}] (tensor shape [${h.shape}])`)}}return l}function Ze(i,t,n,s=!0,a=""){let l;if(Array.isArray(i)){if(i.length!==t.length)throw new mt(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${i.length} Tensors(s).`);l=i}else{if(t.length>1)throw new mt(`The model expects ${t.length} ${a} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(i.shape)}.`);l=[i]}if(n!=null)for(let u=0;u<t.length;++u){if(n[u]==null)continue;let h=l[u];if(h.shape.length!==n[u].length)throw new mt(`Error when checking ${a}: expected ${t[u]} to have ${n[u].length} dimension(s), but got array with shape ${JSON.stringify(h.shape)}`);for(let f=0;f<n[u].length;++f){if(f===0&&!s)continue;let d=h.shape[f],m=n[u][f];if(m!=null&&m!==d)throw new mt(`Error when checking ${a}: expected ${t[u]} to have shape ${JSON.stringify(n[u])} but got array with shape ${JSON.stringify(h.shape)}.`)}}}class Nt extends br{constructor(t){super(t),this.isTraining=!1}summary(t,n,s=console.log){if(!this.built)throw new mt("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");(function(a,l,u,h=console.log){let f=function(N){let F=!0,H=[],W=[];for(let G in N.nodesByDepth)H.push(N.nodesByDepth[G]);for(let G of H){if(G.length>1||G.length===1&&G[0].inboundLayers.length>1){F=!1;break}W.push(...G)}if(F)for(let G of N.layers){let se=!1;for(let ge of G.inboundNodes)if(W.indexOf(ge)!==-1){if(se){F=!1;break}se=!0}if(!F)break}return F}(a),d=["Layer (type)","Output shape","Param #"],m;if(f?(l=l||65,u=u||[.45,.85,1]):(l=l||98,u=u||[.33,.55,.67,1]),u[u.length-1]<=1&&(u=u.map(N=>Math.floor(l*N))),!f){d.push("Receives inputs"),m=[];for(let N in a.nodesByDepth)m.push(...a.nodesByDepth[N])}h("_".repeat(l)),it(d,u,h),h("=".repeat(l));let g=a.layers;for(let N=0;N<g.length;++N)f?Ke(g[N],u,h):an(g[N],u,m,h),h((N===g.length-1?"=":"_").repeat(l));a.checkTrainableWeightsConsistency();let x=function(N){let F;return F=N.collectedTrainableWeights!=null?K(N.collectedTrainableWeights):K(N.trainableWeights),F}(a),R=K(a.nonTrainableWeights);h(`Total params: ${x+R}`),h(`Trainable params: ${x}`),h(`Non-trainable params: ${R}`),h("_".repeat(l))})(this,t,n,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=function(u){let h={Adagrad:()=>$h.adagrad(.01),Adadelta:()=>$h.adadelta(1,.95,Js()),Adam:()=>$h.adam(.001,.9,.999,Js()),Adamax:()=>$h.adamax(.002,.9,.999,Js(),0),RMSProp:()=>$h.rmsprop(.001,.9,0,Js()),SGD:()=>$h.sgd(.01)};if(h.adagrad=h.Adagrad,h.adadelta=h.Adadelta,h.adam=h.Adam,h.adamax=h.Adamax,h.rmsprop=h.RMSProp,h.sgd=h.SGD,u in h)return h[u]();throw new mt(`Unknown Optimizer ${u}`)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Aa))throw new mt("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(Array.isArray(t.loss)||typeof t.loss=="string"||typeof t.loss=="function")if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new mt(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(h=>Dr(h))}else{let u=Dr(t.loss);this.outputs.forEach(h=>{n.push(u)})}else{t.loss=t.loss;for(let u in t.loss)if(this.outputNames.indexOf(u)===-1)throw new mt(`Unknown entry in loss dictionary: "${u}". Only expected the following keys: ${this.outputNames}`);for(let u of this.outputNames)t.loss[u]==null&&console.warn(`Output "${u}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${u} during training`),n.push(Dr(t.loss[u]))}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let u=0;u<this.outputs.length;++u){let h=this.internalOutputShapes[u],f=this.outputNames[u];this.feedOutputNames.push(f),this.feedOutputShapes.push(h),this.feedLossFns.push(this.lossFunctions[u])}let s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],fu("loss",()=>{for(let u=0;u<this.outputs.length;++u){if(s.indexOf(u)!==-1)continue;let h=this.lossFunctions[u];this.outputs.length>1&&(this.metricsTensors.push([h,u]),this.metricsNames.push(this.outputNames[u]+"_loss"))}});let a=function(u,h){if(u==null||Array.isArray(u)&&u.length===0)return h.map(d=>[]);let f;if(typeof u=="string"||typeof u=="function")f=[u];else{if(!Array.isArray(u)&&typeof u!="object")throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${u}`);f=u}if(Array.isArray(f))return h.map(d=>f);{let d=[];for(let m of h){let g=f.hasOwnProperty(m)?f[m]:[];Array.isArray(g)||(g=[g]),d.push(g)}return d}}(t.metrics,this.outputNames),l=(u,h,f)=>{this.outputNames.length>1&&(h=this.outputNames[u]+"_"+h),this.metricsNames.push(h),this.metricsTensors.push([f,u])};fu("metric",()=>{for(let u=0;u<this.outputs.length;++u)s.indexOf(u)===-1&&(h=>{let f,d,m;for(let g of h){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){let R=this.internalOutputShapes[u],N;R[R.length-1]===1||this.lossFunctions[u]===yt?["accuracy","acc"].indexOf(g)!==-1?d=Hn:["crossentropy","ce"].indexOf(g)!==-1&&(d=Nn):this.lossFunctions[u]===wr?["accuracy","acc"].indexOf(g)!==-1?d=Dn:["crossentropy","ce"].indexOf(g)!==-1&&(d=Gn):["accuracy","acc"].indexOf(g)!==-1?d=ei:["crossentropy","ce"].indexOf(g)!==-1&&(d=rr),["accuracy","acc"].indexOf(g)!==-1?N="acc":["crossentropy","ce"].indexOf(g)!==-1&&(N="ce"),m=d,f=""+N}else m=zr(g),f=""+fi(g);let x;fu(f,()=>{x=m}),l(u,f,x)}})(a[u])}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,s={}){let a=s.batchSize==null?32:s.batchSize;sl(a);let l=this.standardizeUserDataXY(t,n,!0,a);try{let u=l[0].concat(l[1]);this.makeTestFunction();let h=this.testFunction;return Ja(this.testLoop(h,u,a,s.verbose,s.steps))}finally{al(l[0],t),al(l[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),async function(s,a,l){let u=(l=l||{}).batches!=null,h=s.testFunction,f=[];if(l.verbose>0)throw new Jr("Verbose mode is not implemented yet.");ee(!u||l.batches>0&&Number.isInteger(l.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(l.batches)}`);let d=typeof a.next=="function"?a:await a.iterator(),m=0,g=0;for(;!u||g<l.batches;){let x=await d.next();if(f=bt(()=>{if(x.value){let{xs:R,ys:N}=Is(s,x.value),F=R.concat(N),H=bt(()=>h(F));if(ni(F),g===0)for(let G=0;G<H.length;++G)f.push(Jn(0));let W=F[0].shape[0];for(let G=0;G<H.length;++G){let se=H[G],ge=f[G];f[G]=bt(()=>fn(f[G],qe(W,se))),g>0&&ni(ge)}ni(H),m+=W,++g}return f}),x.done){u&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${l.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let x=0;x<f.length;++x){let R=f[x];f[x]=yn(f[x],m),ni(R)}return Ja(f)}(this,t,n)}checkNumSamples(t,n,s,a="steps"){let l;if(s!=null){if(l=null,n!=null)throw new mt(`If ${a} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else{if(t==null)throw new mt(`Either the input data should have a defined shape, or ${a} shoud be specified.`);l=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return l}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new mt("`outputs` is an empty Array, which is not allowed.");let s=Array.isArray(n),a=s?n:[n],l=this.retrieveSymbolicTensors(a),u=new sr;if(t instanceof Ni&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new mt(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let f=0;f<this.inputs.length;++f)u.add(this.inputs[f],t[f])}else for(let f of this.inputs){let d=t[f.name];if(d==null)throw new mt(`No value is provided for the model's input ${f.name}`);u.add(f,d)}let h=Hr(l,u);return s?h:h[0]}retrieveSymbolicTensors(t){let n=qu(null,t.length),s=t.length;for(let a of this.layers){let l=Array.isArray(a.output)?a.output:[a.output],u=l.map(h=>h.name);for(let h=0;h<t.length;++h){let f=u.indexOf(t[h]);if(f!==-1&&(n[h]=l[f],s--),s===0)break}if(s===0)break}if(s>0){let a=[];throw n.forEach((l,u)=>{l==null&&a.push(t[u])}),new mt(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(a)}`)}return n}predictLoop(t,n=32,s=!1){return bt(()=>{let a=this.checkNumSamples(t);if(s)throw new Jr("Verbose predictLoop() is not implemented yet.");let l=Oy(a,n),u=this.outputs.map(h=>[]);for(let h=0;h<l.length;++h)bt(()=>{let f=l[h][0],d=l[h][1],m=Fo(t,f,d),g=[];if(Array.isArray(m))for(let R=0;R<m.length;++R)g.push({key:this.inputs[R],value:m[R]});else g.push({key:this.inputs[0],value:m});let x=new sr(g);return Hr(this.outputs,x)}).forEach((f,d)=>u[d].push(f));return Ja(u.map(h=>Ti(h,0)))})}predict(t,n={}){let s=xg(t);Ze(s,this.inputNames,this.feedInputShapes,!1);try{let a=n.batchSize==null?32:n.batchSize;return sl(a),this.predictLoop(s,a)}finally{al(s,t)}}predictOnBatch(t){Ze(t,this.inputNames,this.feedInputShapes,!0);let n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,s=!0,a){if(this.optimizer_==null)throw new Ea("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let l=[];for(let u=0;u<this.feedOutputShapes.length;++u){let h=this.feedOutputShapes[u];this.feedLossFns[u]===wr?l.push(h.slice(0,h.length-1).concat([1])):l.push(h)}if(function(u,h,f){let d=Yu(u.map(g=>g.shape[0]));d.sort();let m=Yu(h.map(g=>g.shape[0]));if(m.sort(),d.length>1)throw new mt(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(u.map(g=>g.shape))}`);if(m.length>1)throw new mt(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(h.map(g=>g.shape))}`);if(d.length>0&&m.length>0&&!Ye(d,m))throw new mt(`Input Tensors should have the same number of samples as target Tensors. Found ${d[0]} input sample(s) and ${m[0]} target sample(s).`)}(t=lx(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=lx(n,this.feedOutputNames,l,!1,"target")),function(u,h,f){let d=[ur,yt,kn];for(let m=0;m<u.length;++m){let g=u[m],x=h[m],R=f[m];if(x!=null){if(x===kn&&g.shape[g.shape.length-1]===1)throw new mt(`You are passing a target array of shape ${g.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(d.indexOf(x)!==-1){let N=g.shape.slice(1),F=R.slice(1);for(let H=0;H<N.length;++H){let W=N[H],G=F[H];if(G!=null&&W!==G)throw new mt(`A target Tensor with shape ${g.shape} was passed for an output of shape ${R}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&a!=null&&a>0&&t[0].shape[0]%a!=0)throw new mt(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${a}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,s,a,l=!0,u){let[h,f]=this.standardizeUserDataXY(t,n,l,u);if(s!=null)throw new Error("sample weight is not supported yet.");let d=null;if(a!=null){let m=cn(a,this.outputNames);d=[];for(let g=0;g<m.length;++g)d.push(await Fr(f[g],null,m[g]))}return[h,f,d]}testLoop(t,n,s,a=0,l){return bt(()=>{let u=this.checkNumSamples(n,s,l,"steps"),h=[];if(a>0)throw new Jr("Verbose mode is not implemented yet.");if(l!=null)throw new Jr("steps mode in testLoop() is not implemented yet");{let f=Oy(u,s),d=ga(rl(0,u));for(let m=0;m<f.length;++m){let g=f[m][0],x=f[m][1],R=Qc(d,g,x-g),N=op(n,R),F=t(N);if(m===0)for(let H=0;H<F.length;++H)h.push(Jn(0));for(let H=0;H<F.length;++H){let W=F[H];h[H]=fn(h[H],qe(x-g,W))}}for(let m=0;m<h.length;++m)h[m]=yn(h[m],u)}return h})}getDedupedMetricsNames(){let t=this.metricsNames,n=[];for(let s=0;s<t.length;++s){let a=t[s],l=a;og(t,a)>1&&(l+=`_${og(t.slice(0,s),a)}`),n.push(l)}return n}makeTrainFunction(){return t=>{let n=[],s=t.slice(0,this.inputs.length),a=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),l=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),u=[],h=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(()=>{let f=[];for(let x=0;x<this.inputs.length;++x)f.push({key:this.inputs[x],value:s[x]});let d=new sr(f),m=Hr(this.outputs,d,{training:!0}),g;for(let x=0;x<this.lossFunctions.length;++x){let R=(0,this.lossFunctions[x])(a[x],m[x]);l[x]!=null&&(R=Li(R,l[x]));let N=ws(R);n.push(N),g=x===0?R:fn(g,R)}for(let x=0;x<this.metricsTensors.length;++x){let R;if(this.outputs.length>1&&x<this.outputs.length)R=n[x];else{let N=this.metricsTensors[x][0],F=this.metricsTensors[x][1];R=ws(N(a[F],m[F]))}wa(R),u.push(R)}return g=ws(g),this.calculateLosses().forEach(x=>{g=fn(g,x)}),g},!0,h)].concat(u)}}makeTestFunction(){this.testFunction=t=>bt(()=>{let n=[],s,a=t.slice(0,this.inputs.length),l=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),u=[];for(let d=0;d<this.inputs.length;++d)u.push({key:this.inputs[d],value:a[d]});let h=new sr(u),f=Hr(this.outputs,h);for(let d=0;d<this.lossFunctions.length;++d){let m=this.lossFunctions[d],g=ws(m(l[d],f[d]));s=d===0?g:fn(s,g),n.push(s)}for(let d=0;d<this.metricsTensors.length;++d){let m=this.metricsTensors[d][0],g=this.metricsTensors[d][1],x=ws(m(l[g],f[g]));n.push(x)}return n})}async fit(t,n,s={}){return async function(a,l,u,h={}){if(a.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let f,d,m,g,x,R,N,F,H;a.isTraining=!0;try{let W=h.batchSize==null?32:h.batchSize;sl(W);let G=!1,se=await a.standardizeUserData(l,u,h.sampleWeight,h.classWeight,G,W);f=se[0],d=se[1],H=se[2];let ge,Ce=!1;if(h.validationData!=null&&h.validationData.length>0){if(Ce=!0,h.validationData.length!==2)throw h.validationData.length===3?new Jr("validationData including sample weights is not supported yet."):new mt(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${h.validationData} is invalid.`);x=h.validationData[0],R=h.validationData[1];let ut=!0,ft=await a.standardizeUserData(x,R,null,null,ut,W);N=ft[0],F=ft[1],ge=N.concat(F)}else if(h.validationSplit!=null&&h.validationSplit>0&&h.validationSplit<1){Ce=!0;let ut=Math.floor(f[0].shape[0]*(1-h.validationSplit)),ft=f[0].shape[0];N=Fo(f,ut,ft),m=f,f=Fo(f,0,ut),F=Fo(d,ut,ft),g=d,d=Fo(d,0,ut),ge=N.concat(F)}else h.validationSteps!=null&&(Ce=!0);let Be=f.concat(d).concat(H);a.checkTrainableWeightsConsistency();let Ve=a.makeTrainFunction(),ze=a.getDedupedMetricsNames(),Xe,tt;Ce?(a.makeTestFunction(),Xe=a.testFunction,tt=ze.slice().concat(ze.map(ut=>"val_"+ut))):(Xe=null,ge=[],tt=ze.slice());let ot=Tt(h.callbacks,h.yieldEvery);return await async function(ut,ft,kt,Ut,It,Lt,zt,Gt,qt,Ot,jt,on,bn,An,Bn){It==null&&(It=32),Lt==null&&(Lt=1),jt==null&&(jt=!0),bn==null&&(bn=0);let Pn=!1;qt!=null&&Ot!=null&&(Pn=!0);let mr=ut.checkNumSamples(kt,It,An,"steps_per_epoch"),_r;mr!=null&&(_r=rl(0,mr)),zt==null&&(zt=1);let{callbackList:vr,history:gr}=Zt(Gt,zt,Lt,bn,mr,An,It,Pn,on);vr.setModel(ut),ut.history=gr,await vr.onTrainBegin(),ut.stopTraining_=!1;for(let Wr=bn;Wr<Lt;++Wr){await vr.onEpochBegin(Wr);let pi={};{if(jt==="batch")throw new Jr("batch shuffling is not implemneted yet");jt&&Ci(_r);let Oi=ga(_r),$r=Oy(mr,It);for(let qr=0;qr<$r.length;++qr){let Ai={};if(await vr.onBatchBegin(qr,Ai),bt(()=>{let ia=$r[qr][0],$a=$r[qr][1],Va=Qc(Oi,ia,$a-ia);Ai.batch=qr,Ai.size=$a-ia;let sa=op(kt,Va),td=ft(sa);for(let Sa=0;Sa<Ut.length;++Sa){let Ha=Ut[Sa],xo=td[Sa];Ai[Ha]=xo,wa(xo)}if(qr===$r.length-1&&Pn){let Sa=ut.testLoop(qt,Ot,It);for(let Ha=0;Ha<Ut.length;++Ha){let xo=Ut[Ha],tc=Sa[Ha];wa(tc),pi["val_"+xo]=tc}}}),await vr.onBatchEnd(qr,Ai),wt(Ai),ut.stopTraining_)break}Oi.dispose()}if(await vr.onEpochEnd(Wr,pi),ut.stopTraining_)break}return await vr.onTrainEnd(),await ut.history.syncData(),ut.history}(a,Ve,Be,ze,W,h.epochs,h.verbose,ot,Xe,ge,h.shuffle,tt,h.initialEpoch,null)}finally{a.isTraining=!1,al(f,l),al(d,u),al(m,l),al(g,u),al(N,x),al(F,R),H!=null&&ni(H)}}(this,t,n,s)}async fitDataset(t,n){return async function(s,a,l){let u=l.batchesPerEpoch!=null;if(ee(s.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),ee(l!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),ee(l.epochs!=null&&l.epochs>0&&Number.isInteger(l.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${l.epochs}`),ee(!u||l.batchesPerEpoch>0&&Number.isInteger(l.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${l.batchesPerEpoch}`),ee(l.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),s.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");s.isTraining=!0;try{let h=l.validationData!=null,f,d;if(h)if(Ps(l.validationData))ee(l.validationBatches==null||l.validationBatches>0&&Number.isInteger(l.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${l.validationBatches}`);else{let se=function(ge){if(ge.length===3)throw new Jr("Validation with sample weights is not implemented yet.");return{xs:ge[0],ys:ge[1]}}(l.validationData);f=se.xs,d=se.ys}let m=s.makeTrainFunction(),g=s.getDedupedMetricsNames(),x;x=h?g.slice().concat(g.map(se=>"val_"+se)):g.slice();let R=Tt(l.callbacks,l.yieldEvery),N=l.verbose==null?1:l.verbose,{callbackList:F,history:H}=Zt(R,N,l.epochs,null,null,function(se,ge){let Ce=null;return ge.batchesPerEpoch!=null?Ce=ge.batchesPerEpoch:Number.isFinite(se.size)&&(Ce=se.size),Ce}(a,l),null,h,x);F.setModel(s),s.history=H,await F.onTrainBegin(),s.stopTraining_=!1;let W=l.initialEpoch==null?0:l.initialEpoch,G=await a.iterator();for(;W<l.epochs;){let se={};await F.onEpochBegin(W);let ge=0,Ce=0;for(u||(G=await a.iterator());!u||ge<l.batchesPerEpoch;){let Be=await G.next();if(u&&Be.done){console.warn(`You provided \`batchesPerEpoch\` as ${l.batchesPerEpoch}, but your dataset iterator ran out of data after ${ge} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+l.batchesPerEpoch*l.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(Be.value!=null){let{xs:Ve,ys:ze}=Is(s,Be.value),Xe={};Xe.batch=Ce,Xe.size=Ve[0].shape[0],await F.onBatchBegin(Ce,Xe);let tt=[];if(l.classWeight!=null){let ft=cn(l.classWeight,s.outputNames);for(let kt=0;kt<ft.length;++kt)tt.push(await Fr(ze[kt],null,ft[kt]))}let ot=Ve.concat(ze).concat(tt),ut=m(ot);ni(ot);for(let ft=0;ft<g.length;++ft){let kt=g[ft],Ut=ut[ft];Xe[kt]=Ut,wa(Ut)}await F.onBatchEnd(Ce,Xe),wt(Xe),Ce++,ge++}if(u?ge>=l.batchesPerEpoch:Be.done){if(h){let Ve;Ve=Ps(l.validationData)?fs(await s.evaluateDataset(l.validationData,{batches:l.validationBatches})):fs(s.evaluate(f,d,{batchSize:l.validationBatchSize==null?32:l.validationBatchSize,verbose:0}));for(let ze=0;ze<s.metricsNames.length;++ze)se[`val_${s.metricsNames[ze]}`]=Ve[ze]}break}if(s.stopTraining_)break}if(await F.onEpochEnd(W,se),W++,s.stopTraining_)break}return await F.onTrainEnd(),await s.history.syncData(),s.history}finally{s.isTraining=!1}}(this,t,n)}async trainOnBatch(t,n){let s=await this.standardizeUserData(t,n),a=s[0],l=s[1],u=this.makeTrainFunction()(a.concat(l)),h=[];for(let f of u){let d=await f.data();h.push(d[0])}return ni(u),al(s[0],t),al(s[1],n),Ja(h)}getNamedWeights(t){let n=[],s=t!=null&&t.trainableOnly,a=s?this.trainableWeights:this.weights,l=this.getWeights(s);for(let u=0;u<a.length;++u)s&&!a[u].trainable||n.push({name:a[u].originalName,tensor:l[u]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){let t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let n=f0().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-f0().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Ku(this.loss);else if(Array.isArray(this.loss)){for(let n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Ku(n))}else{let n=Object.keys(this.loss);t={};let s=this.loss;for(let a of n){if(typeof s[a]!="string")throw new Error("Serialization of non-string loss is not supported.");t[a]=Ku(s[a])}}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ku(fi(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Ku(fi(t)));{let t={};for(let n in this.metrics)t[n]=Ku(fi(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let n=pn(dr(t.optimizer_config)),s,a;if(typeof t.loss=="string")s=qh(t.loss);else if(Array.isArray(t.loss))s=t.loss.map(l=>qh(l));else if(t.loss!=null){s={};for(let l in t.loss)s[l]=qh(t.loss[l])}if(Array.isArray(t.metrics))a=t.metrics.map(l=>qh(l));else if(t.metrics!=null){a={};for(let l in t.metrics)a[l]=qh(t.metrics[l])}this.compile({loss:s,metrics:a,optimizer:n})}async save(t,n){if(typeof t=="string"){let l=Qg(t);if(l.length===0)throw new mt(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new mt(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new mt("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let s=await fc(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:`TensorFlow.js tfjs-layers v${Er}`,convertedBy:null};if(n!=null&&n.includeOptimizer&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();let l="optimizer",{data:u,specs:h}=await fc(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=eu([s.data,u])}return this.userDefinedMetadata!=null&&(us(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,t.save(a)}setUserDefinedMetadata(t){us(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Nt.className="Model",dn(Nt);class Ht extends Nt{}async function $t(i,t){"modelTopology"in i||(i={modelTopology:i});let n=(i=i).modelTopology;n.model_config!=null&&(n=n.model_config);let s=pn(dr(n),t);if(i.weightsManifest!=null){let a=await Sv(i.weightsManifest,i.pathPrefix,s.weights.map(u=>u.originalName)),l={};for(let u of s.weights)l[u.originalName]=a[u.originalName];s.loadWeights(l),ni(a)}return s}Ht.className="Functional",dn(Ht);class sn extends Nt{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:v("sequential_"),t.layers!=null)for(let n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new mt(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){let n=t instanceof sn||t instanceof Nt,s;if(n){if(s=t,s.outputs.length!==1)throw new mt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new mt("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new mt("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let a=Je({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(a)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new mt(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new mt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=Re(this.outputs[0])}this.inboundNodes=[],new fe({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:qu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(a=>a.shape),outputShapes:this.outputs[0].shape})}else{let a=t.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(U(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Nt({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,s=console.log){this.built||this.build(),super.summary(t,n,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,s={}){if(!this.built)throw new Ea("The model needs to be compiled before being used.");return this.model.evaluate(t,n,s)}async evaluateDataset(t,n){if(!this.built)throw new Ea("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,s={}){if(!this.built)throw new Ea("The model needs to be compiled before being used.");return this.model.fit(t,n,s)}async fitDataset(t,n){if(!this.built)throw new Ea("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,s={},a=!1){let l,u={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new mt("Legacy serialization format not supported yet.");l=n}else ee(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),l=n.layers,delete n.layers,u=n;let h=new t(u);if(!(h instanceof sn))throw new Jr(`Sequential.fromConfig called on non-Sequential input: ${h}`);for(let f of l){let d=pn(f,void 0,a);a&&d.setFastWeightInitDuringBuild(!0),h.add(d)}return h}set stopTraining(t){if(this.model==null)throw new mt("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new mt("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let t=[];for(let n of this.layers){let s={};s.className=n.getClassName(),s.config=n.getConfig(),t.push(s)}return{name:this.name,layers:t}}}function ri(i){return new Nt(i)}function ii(i){return new sn(i)}function vi(i,t){return t==null&&(t={}),async function(n,s){if(s==null&&(s={}),typeof n=="string"){let a=Zg(n,s);if(a.length===0)a.push(mm(n,s));else if(a.length>1)throw new mt(`Found more than one (${a.length}) load handlers for URL '${n}'`);n=a[0]}return async function(a,l,u){if(u==null&&(u={}),a.load==null)throw new mt("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let h=await a.load(),f=h.modelTopology;f.model_config!=null&&(f=f.model_config);let d=u.strict==null||u.strict,m=h.weightData!=null&&h.weightSpecs!=null&&d,g=pn(dr(f),void 0,m),x=h.trainingConfig;if(x!=null&&g.loadTrainingConfig(x),h.userDefinedMetadata!=null&&g.setUserDefinedMetadata(h.userDefinedMetadata),h.weightData!=null){if(h.weightSpecs==null)throw new mt("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:R,optimizerWeights:N}=function(F,H){let W=xh(F,H),G={},se=[];return H.forEach(ge=>{ge.group==="optimizer"?se.push({name:ge.name,tensor:W[ge.name]}):G[ge.name]=W[ge.name]}),{modelWeights:G,optimizerWeights:se}}(h.weightData,h.weightSpecs);g.loadWeights(R,d),g.optimizer!=null&&N.length>0&&await g.optimizer.setWeights(N),ni(R),ni(N.map(F=>F.tensor))}return g}(n,0,s)}(i,t)}function di(i){return Je(i)}function ns(i,t){Ct.registerCallbackConstructor(i,t)}sn.className="Sequential",dn(sn);class Gr extends _h{getConfig(){return{}}}class zi extends Gr{apply(t,n=1){return function(s,a=1){if(a!==1)throw new Jr(`Support for alpha values other than 1 (${a}) is not implemented yet.`);return Pd(s)}(t,n)}}zi.className="elu",dn(zi);class Os extends Gr{apply(t){return Uu(t)}}Os.className="selu",dn(Os);class Zc extends Gr{apply(t){return po(t)}}Zc.className="relu",dn(Zc);class Qh extends Gr{apply(t){return bt(()=>Ud(6,po(t)))}}Qh.className="relu6",dn(Qh);class Wi extends Gr{apply(t){return t}}Wi.className="linear",dn(Wi);class kl extends Gr{apply(t){return ds(t)}}kl.className="sigmoid",dn(kl);class ra extends Gr{apply(t){return function(n){return bt(()=>{let s=fn(.5,qe(.2,n));return Xa(s,0,1)})}(t)}}ra.className="hardSigmoid",dn(ra);class Rl extends Gr{apply(t){return Tc(t)}}Rl.className="softplus",dn(Rl);class Hf extends Gr{apply(t){return function(n){return bt(()=>yn(n,fn(_s(n),1)))}(t)}}Hf.className="softsign",dn(Hf);class Nl extends Gr{apply(t){return kh(t)}}Nl.className="tanh",dn(Nl);class Ll extends Gr{apply(t,n=-1){return Rc(t,n)}}Ll.className="softmax",dn(Ll);class Ra extends Gr{apply(t,n=-1){return _m(t,n)}}Ra.className="logSoftmax",dn(Ra);class lp extends Gr{apply(t,n=1){return bt(()=>qe(ds(qe(t,n)),t))}}lp.className="swish",dn(lp);class ol extends Gr{apply(t){return bt(()=>qe(t,kh(Tc(t))))}}function up(i){return i.getClassName()}function vw(i,t={}){return Bf(i,ko.getMap().classNameMap,t,"activation")}function cp(i){if(i==null)return vw({className:"linear",config:{}});if(typeof i=="string"){let t={};return t.className=i,t.config={},vw(t)}return i instanceof Gr?i:vw(i)}function bw(i){if(i!=null&&typeof i!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${i}`)}ol.className="mish",dn(ol);class FE extends _h{}class Uy extends FE{constructor(t){super(),bw(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return bt(()=>{let n=js([1]);return this.hasL1&&(n=fn(n,Yn(qe(this.l1,_s(t))))),this.hasL2&&(n=fn(n,Yn(qe(this.l2,$f(t))))),pt(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}Uy.className="L1L2",dn(Uy);let PE={l1l2:"L1L2"};function gs(i){return yy(i)}function OE(i,t={}){return Bf(i,ko.getMap().classNameMap,t,"regularizer")}function Bs(i){return i==null?null:typeof i=="string"?OE({className:i in PE?PE[i]:i,config:{}}):i instanceof FE?i:OE(i)}class xw extends Pe{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=O(t);let s=po(t);return this.maxValue!=null&&(s=Xa(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){let t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}xw.className="ReLU",dn(xw);class ww extends Pe{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){let s=O(t);return Od(s,this.alpha)}computeOutputShape(t){return t}getConfig(){let t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}ww.className="LeakyReLU",dn(ww);class Aw extends Pe{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=Ss(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Bs(t.alphaRegularizer),this.alphaConstraint=ea(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if(typeof t.sharedAxes!="number")throw new mt(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){let n=(t=U(t)).slice(1);if(this.sharedAxes!=null)for(let a of this.sharedAxes)n[a-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let s={};if(this.sharedAxes!=null)for(let a=1;a<t.length;++a)s[a]=t[a];this.inputSpec=[new ce({ndim:t.length,axes:s})],this.built=!0}call(t,n){return t=O(t),zd(t,this.alpha.read())}getConfig(){let t={alphaInitializer:Cs(this.alphaInitializer),alphaRegularizer:gs(this.alphaRegularizer),alphaConstraint:Ds(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}Aw.className="PReLU",dn(Aw);class Ew extends Pe{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new Jr(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){let s=O(t);return Pd(s)}computeOutputShape(t){return t}getConfig(){let t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}Ew.className="ELU",dn(Ew);class Sw extends Pe{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){let s=O(t);return qe(s,En(Ka(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){let t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}Sw.className="ThresholdedReLU",dn(Sw);class Tw extends Pe{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new Ll().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){let s=O(t);return this.softmax(s,this.axis)}computeOutputShape(t){return t}getConfig(){let t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}function wg(i,t,n){if(typeof i=="number")return qu(i,t);if(i.length!==t)throw new mt(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${i.length} elements.`);for(let a=0;a<t;++a){let l=i[a];if((s=l)!==parseInt(s.toString(),10))throw new mt(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(i)} including a non-integer number ${l}`)}return i;var s}function Zu(i,t,n,s,a=1){if(i==null)return i;let l;return l=n==="same"?i:i-(t+(t-1)*(a-1))+1,Math.floor((l+s-1)/s)}function Jc(i,t,n,s){if(i==null)return null;if(s==="valid")i=i*t+Cl([n-t,0]);else{if(s!=="same")throw new mt(`Unsupport padding mode: ${s}.`);i*=t}return i}function Mw(i,t){return bt(()=>(Xs(t),t==="channelsFirst"?xi(i,[0,2,3,1]):i))}function BE(i,t){return bt(()=>(Xs(t),t==="channelsFirst"?xi(i,[0,2,3,4,1]):i))}function UE(i,t,n,s=[1,1],a="valid",l,u,h=null){return bt(()=>{if(l==null&&(l="channelsLast"),Xs(l),i.rank!==3&&i.rank!==4)throw new mt(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${i.rank}.`);if(t.rank!==3&&t.rank!==4)throw new mt(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${i.rank}.`);let f=Mw(i,l);if(a==="causal")throw new Jr("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return f=bf({x:f,filter:t,strides:s,pad:a==="same"?"same":"valid",dilations:u,dataFormat:"NHWC",bias:n,activation:h}),l==="channelsFirst"&&(f=xi(f,[0,3,1,2])),f})}Tw.className="Softmax",dn(Tw);class ux extends Pe{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",ux.verifyArgs(n),this.rank=t,na(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Jr(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=wg(n.kernelSize,t,"kernelSize"),this.strides=wg(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,fo(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Xs(this.dataFormat),this.activation=cp(n.activation),this.useBias=n.useBias==null||n.useBias,this.biasInitializer=Ss(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=ea(n.biasConstraint),this.biasRegularizer=Bs(n.biasRegularizer),this.activityRegularizer=Bs(n.activityRegularizer),this.dilationRate=wg(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new mt(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new mt(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new mt(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(pu("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!rp(t.kernelSize,"number",1,3))throw new mt(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){let t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:up(this.activation),useBias:this.useBias,biasInitializer:Cs(this.biasInitializer),biasRegularizer:gs(this.biasRegularizer),activityRegularizer:gs(this.activityRegularizer),biasConstraint:Ds(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class Ag extends ux{constructor(t,n){super(t,n),this.kernel=null,Ag.verifyArgs(n),this.filters=n.filters,na(this.filters,"filters"),this.kernelInitializer=Ss(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=ea(n.kernelConstraint),this.kernelRegularizer=Bs(n.kernelRegularizer)}build(t){t=U(t);let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new mt(`The channel dimension of the input should be defined. Found ${t[n]}`);let s=t[n],a=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(t,n){return bt(()=>{let s;t=O(t);let a=this.bias==null?null:this.bias.read(),l=Qb(this.activation.getClassName());if(l!=null&&this.rank===2)s=UE(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate,l);else{if(this.rank===1)s=function(u,h,f,d=1,m="valid",g,x=1){return bt(()=>{if(g==null&&(g="channelsLast"),Xs(g),u.shape.length!==3)throw new mt(`The input of a conv1dWithBias operation should be 3, but is ${u.shape.length} instead.`);if(h.shape.length!==3)throw new mt(`The kernel for a conv1dWithBias operation should be 3, but is ${h.shape.length} instead`);if(f!=null&&f.shape.length!==1)throw new mt(`The bias for a conv1dWithBias operation should be 1, but is ${h.shape.length} instead`);if(g==="channelsFirst"&&(u=xi(u,[0,2,1])),m==="causal")throw new Jr("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let R=wm(u,h,d,m==="same"?"same":"valid","NWC",x);return f!=null&&(R=Il(R,f)),R})}(t,this.kernel.read(),a,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=UE(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(this.rank!==3)throw new Jr("convolutions greater than 3D are not implemented yet.");s=function(u,h,f,d=[1,1,1],m="valid",g,x){return bt(()=>{if(g==null&&(g="channelsLast"),Xs(g),u.rank!==4&&u.rank!==5)throw new mt(`conv3dWithBias expects input to be of rank 4 or 5, but received ${u.rank}.`);if(h.rank!==4&&h.rank!==5)throw new mt(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${u.rank}.`);let R=BE(u,g);if(m==="causal")throw new Jr("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return R=M0(R,h,d,m==="same"?"same":"valid","NDHWC",x),f!=null&&(R=Il(R,f)),g==="channelsFirst"&&(R=xi(R,[0,4,1,2,3])),R})}(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate)}this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=U(t);let n=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let l=0;l<s.length;++l){let u=Zu(s[l],this.kernelSize[l],this.padding,this.strides[l],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[l]);n.push(u)}let a=[t[0]];return this.dataFormat==="channelsLast"?(a=a.concat(n),a.push(this.filters)):(a.push(this.filters),a=a.concat(n)),a}getConfig(){let t={filters:this.filters,kernelInitializer:Cs(this.kernelInitializer),kernelRegularizer:gs(this.kernelRegularizer),kernelConstraint:Ds(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new mt(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Eg extends Ag{constructor(t){super(2,t),Eg.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!rp(t.kernelSize,"number",1,2))throw new mt(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Eg.className="Conv2D",dn(Eg);class Sg extends Ag{constructor(t){super(3,t),Sg.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&(!Array.isArray(t.kernelSize)||t.kernelSize.length!==1&&t.kernelSize.length!==3))throw new mt(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Sg.className="Conv3D",dn(Sg);class _w extends Eg{constructor(t){if(super(t),this.inputSpec=[new ce({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new mt(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if((t=U(t)).length!==4)throw new mt("Input should have rank 4; Received input shape: "+JSON.stringify(t));let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new mt("The channel dimension of the inputs should be defined. Found `None`.");let s=t[n],a=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ce({ndim:4,axes:{[n]:s}})],this.built=!0}call(t,n){return bt(()=>{let s=O(t);if(s.shape.length!==4)throw new mt(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);let a=s.shape,l=a[0],u,h;this.dataFormat==="channelsFirst"?(u=2,h=3):(u=1,h=2);let f=a[u],d=a[h],m=this.kernelSize[0],g=this.kernelSize[1],x=this.strides[0],R=this.strides[1],N=[l,Jc(f,x,m,this.padding),Jc(d,R,g,this.padding),this.filters];this.dataFormat!=="channelsLast"&&(s=xi(s,[0,2,3,1]));let F=Am(s,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(F=xi(F,[0,3,1,2])),this.bias!=null&&(F=Il(F,this.bias.read(),this.dataFormat)),this.activation!=null&&(F=this.activation.apply(F)),F})}computeOutputShape(t){let n=(t=U(t)).slice(),s,a,l;this.dataFormat==="channelsFirst"?(s=1,a=2,l=3):(s=3,a=1,l=2);let u=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],d=this.strides[1];return n[s]=this.filters,n[a]=Jc(n[a],f,u,this.padding),n[l]=Jc(n[l],d,h,this.padding),n}getConfig(){let t=super.getConfig();return delete t.dilationRate,t}}_w.className="Conv2DTranspose",dn(_w);class Cw extends Sg{constructor(t){if(super(t),this.inputSpec=[new ce({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new mt(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if((t=U(t)).length!==5)throw new mt("Input should have rank 5; Received input shape: "+JSON.stringify(t));let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new mt("The channel dimension of the inputs should be defined. Found `None`.");let s=t[n],a=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ce({ndim:5,axes:{[n]:s}})],this.built=!0}call(t,n){return bt(()=>{let s=O(t);if(s.shape.length!==5)throw new mt(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);let a=s.shape,l=a[0],u,h,f;this.dataFormat==="channelsFirst"?(f=2,u=3,h=4):(f=1,u=2,h=3);let d=a[f],m=a[u],g=a[h],x=this.kernelSize[0],R=this.kernelSize[1],N=this.kernelSize[2],F=this.strides[0],H=this.strides[1],W=this.strides[2],G=[l,Jc(d,F,x,this.padding),Jc(m,H,R,this.padding),Jc(g,W,N,this.padding),this.filters];this.dataFormat!=="channelsLast"&&(s=xi(s,[0,2,3,4,1]));let se=Zv(s,this.kernel.read(),G,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(se=xi(se,[0,4,1,2,3])),this.bias!==null&&(se=Il(se,this.bias.read(),this.dataFormat)),this.activation!==null&&(se=this.activation.apply(se)),se})}computeOutputShape(t){let n=(t=U(t)).slice(),s,a,l,u;this.dataFormat==="channelsFirst"?(s=1,a=2,l=3,u=4):(s=4,a=1,l=2,u=3);let h=this.kernelSize[0],f=this.kernelSize[1],d=this.kernelSize[2],m=this.strides[0],g=this.strides[1],x=this.strides[2];return n[s]=this.filters,n[a]=Jc(n[a],m,h,this.padding),n[l]=Jc(n[l],g,f,this.padding),n[u]=Jc(n[u],x,d,this.padding),n}getConfig(){let t=super.getConfig();return delete t.dilationRate,t}}Cw.className="Conv3DTranspose",dn(Cw);class zE extends Ag{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new mt("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new mt("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new mt(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Ss(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Bs(n.depthwiseRegularizer),this.depthwiseConstraint=ea(n.depthwiseConstraint),this.pointwiseInitializer=Ss(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Bs(n.pointwiseRegularizer),this.pointwiseConstraint=ea(n.pointwiseConstraint)}build(t){if((t=U(t)).length<this.rank+2)throw new mt(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new mt(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);let s=t[n],a=this.kernelSize.concat([s,this.depthMultiplier]),l=[];for(let h=0;h<this.rank;++h)l.push(1);l.push(s*this.depthMultiplier,this.filters);let u=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",a,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,u,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",l,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,u,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,u,this.biasConstraint):this.bias=null,this.inputSpec=[new ce({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(t,n){return bt(()=>{let s;if(t=O(t),this.rank===1)throw new Jr("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=xi(t,[0,2,3,1])),s=Lh(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Il(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=xi(s,[0,3,1,2])),s})}getConfig(){let t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Cs(this.depthwiseInitializer),t.pointwiseInitializer=Cs(this.pointwiseInitializer),t.depthwiseRegularizer=gs(this.depthwiseRegularizer),t.pointwiseRegularizer=gs(this.pointwiseRegularizer),t.depthwiseConstraint=Ds(this.depthwiseConstraint),t.pointwiseConstraint=Ds(this.pointwiseConstraint),t}}zE.className="SeparableConv";class Iw extends zE{constructor(t){super(2,t)}}Iw.className="SeparableConv2D",dn(Iw);class zy extends Ag{constructor(t){super(1,t),zy.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){let t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!rp(t.kernelSize,"number",1,1))throw new mt(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}zy.className="Conv1D",dn(zy);class kw extends Pe{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return bt(()=>{if(t=O(t),this.dataFormat==="channelsLast"){let s=ap(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return ap(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{let s=ap(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return ap(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}kw.className="Cropping2D",dn(kw);class Rw extends Pe{constructor(t){var n;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xs(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,n=this.interpolation,Xc(Jb,"InterpolationFormat",n)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){let n=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,s]}{let n=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],n,s,t[3]]}}call(t,n){return bt(()=>{let s=O(t),a=s.shape;if(this.dataFormat==="channelsFirst"){s=xi(s,[0,2,3,1]);let l=this.size[0]*a[2],u=this.size[1]*a[3],h=this.interpolation==="nearest"?Jo.resizeNearestNeighbor(s,[l,u]):Jo.resizeBilinear(s,[l,u]);return xi(h,[0,3,1,2])}{let l=this.size[0]*a[1],u=this.size[1]*a[2];return this.interpolation==="nearest"?Jo.resizeNearestNeighbor(s,[l,u]):Jo.resizeBilinear(s,[l,u])}})}getConfig(){let t={size:this.size,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}Rw.className="UpSampling2D",dn(Rw);class Nw extends ux{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Ss(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=ea(t.depthwiseConstraint),this.depthwiseRegularizer=Bs(t.depthwiseRegularizer)}build(t){if((t=U(t)).length<4)throw new mt(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);let n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new mt(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);let s=t[n],a=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",a,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return bt(()=>{let s=function(a,l,u=[1,1],h="valid",f,d){return bt(()=>{f==null&&(f="channelsLast"),Xs(f);let m=Mw(a,f);if(a.rank!==4)throw new mt(`Input for depthwiseConv2d is required to be 4-D, but is instead ${a.rank}-D`);if(l.rank!==4)throw new mt(`depthwiseKernel is required to be 4-D, but is instead ${l.rank}-D`);return m=Fd(m,l,u,h==="same"?"same":"valid","NHWC",d),f==="channelsFirst"&&(m=xi(m,[0,3,1,2])),m})}(t=O(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Il(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=U(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],a=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,l=Zu(n,this.kernelSize[0],this.padding,this.strides[0]),u=Zu(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],a,l,u]:[t[0],l,u,a]}getConfig(){let t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Cs(this.depthwiseInitializer),t.depthwiseRegularizer=gs(this.depthwiseRegularizer),t.depthwiseConstraint=Ds(this.depthwiseRegularizer),t}}function $E(i,t,n,s){if(Array.isArray(i)){if(t!=null||n!=null)throw new mt("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=i.slice(i.length-s,i.length),i=i.slice(0,i.length-s)),i.length>1&&(t=i.slice(1,i.length)),i=i[0]}function a(l){return l==null||Array.isArray(l)?l:[l]}return{inputs:i,initialState:t=a(t),constants:n=a(n)}}function VE(i,t,n,s=!1,a,l,u=!1,h=!1){return bt(()=>{let f=t.shape.length;if(f<3)throw new mt(`Input should be at least 3D, but is ${f}D.`);let d=[1,0].concat(rl(2,f));if(t=xi(t,d),l!=null)throw new Jr("The rnn() functoin of the deeplearn.js backend does not support constants yet.");u&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&((a=En(En(a,"bool"),"float32")).rank===f-1&&(a=qa(a,-1)),a=xi(a,d)),s&&(t=Pi(t,0),a!=null&&(a=Pi(a,0)));let m=[],g,x=n,R=t.shape[0],N=ts(t),F,H;a!=null&&(F=ts(a));for(let W=0;W<R;++W){let G=N[W],se=bt(()=>i(G,x));if(a==null)g=se[0],x=se[1];else{let ge=bt(()=>{let Ce=F[W],Be=Un(ho(Ce),Ce);return{output:fn(qe(se[0],Ce),qe(x[0],Be)),newStates:x.map((Ve,ze)=>fn(qe(se[1][ze],Ce),qe(Ve,Be)))}});g=ge.output,x=ge.newStates}h&&m.push(g)}return h&&(H=Qa(m,1)),[g,H,x]})}Nw.className="DepthwiseConv2D",dn(Nw);class Ju extends Pe{constructor(t){let n;if(super(t),t.cell==null)throw new mt("cell property is missing for the constructor of RNN.");if(n=Array.isArray(t.cell)?new dx({cells:t.cell}):t.cell,n.stateSize==null)throw new mt("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences!=null&&t.returnSequences,this.returnState=t.returnState!=null&&t.returnState,this.goBackwards=t.goBackwards!=null&&t.goBackwards,this._stateful=t.stateful!=null&&t.stateful,this.unroll=t.unroll!=null&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new ce({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return this.states_==null?rl(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(t=>null):this.states_}setStates(t){this.states_=t}computeOutputShape(t){w(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);let s=n[0],a;if(a=this.returnSequences?[t[0],t[1],s]:[t[0],s],this.returnState){let l=[];for(let u of n)l.push([t[0],u]);return[a].concat(l)}return a}computeMask(t,n){return bt(()=>{Array.isArray(n)&&(n=n[0]);let s=this.returnSequences?n:null;if(this.returnState){let a=this.states.map(l=>null);return[s].concat(a)}return s})}get states(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<t;++s)n.push(null);return n}return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new Jr("Constants support is not implemented in RNN yet.");w(t)&&(t=t[0]),t=t;let n=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new ce({shape:[n,null,...s]});let a=[t[0]].concat(t.slice(2)),l;if(this.cell.build(a),l=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!Ye(this.stateSpec.map(u=>u.shape[u.shape.length-1]),l))throw new mt(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=l.map(u=>new ce({shape:[null,u]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){bt(()=>{if(!this.stateful)throw new du("Cannot call resetStates() on an RNN Layer that is not stateful.");let s=this.inputSpec[0].shape[0];if(s==null)throw new mt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>js([s,a])):this.states_=[js([s,this.cell.stateSize])];else if(t==null)ni(this.states_),this.keptStates!=null&&(ni(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>js([s,a])):this.states_[0]=js([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new mt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):ni(this.states_);for(let a=0;a<this.states_.length;++a){let l=t[a],u=Array.isArray(this.cell.stateSize)?this.cell.stateSize[a]:this.cell.stateSize,h=[s,u];if(!Ye(l.shape,h))throw new mt(`State ${a} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>wa(a.clone()))})}apply(t,n){let s=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});let l=$E(t,s,a,this.numConstants);t=l.inputs,s=l.initialState,a=l.constants;let u=[],h=[];if(s!=null){n.initialState=s,u=u.concat(s),this.stateSpec=[];for(let f of s)this.stateSpec.push(new ce({shape:f.shape}));h=h.concat(this.stateSpec)}if(a!=null&&(n.constants=a,u=u.concat(a),this.numConstants=a.length),u[0]instanceof ve){let f=[t].concat(u),d=this.inputSpec.concat(h),m=this.inputSpec;this.inputSpec=d;let g=super.apply(f,n);return this.inputSpec=m,g}return super.apply(t,n)}call(t,n){return bt(()=>{let s=n==null?null:n.mask,a=n==null?null:n.training,l=n==null?null:n.initialState;t=O(t),l==null&&(l=this.stateful?this.states_:this.getInitialState(t));let u=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(l.length!==u)throw new mt(`RNN Layer has ${u} state(s) but was passed ${l.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let h={training:a},f=VE((R,N)=>{let F=this.cell.call([R].concat(N),h);return[F[0],F.slice(1)]},t,l,this.goBackwards,s,null,this.unroll,this.returnSequences),d=f[0],m=f[1],g=f[2];this.stateful&&this.resetStates(g,a);let x=this.returnSequences?m:d;return this.returnState?[x].concat(g):x})}getInitialState(t){return bt(()=>{let n=js(t.shape);return n=Yn(n,[1,2]),n=Uf(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Cy(n,[1,s]):n):this.cell.stateSize>1?[Cy(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){let t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);let s=this.cell.getConfig();return this.getClassName()===Ju.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign({},s,t,n)}static fromConfig(t,n,s={}){let a=pn(n.cell,s);return new t(Object.assign(n,{cell:a}))}}Ju.className="RNN",dn(Ju);class $y extends Pe{}class cx extends $y{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,na(this.units,"units"),this.activation=cp(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null||t.useBias,this.kernelInitializer=Ss(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ss(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ss(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Bs(t.kernelRegularizer),this.recurrentRegularizer=Bs(t.recurrentRegularizer),this.biasRegularizer=Bs(t.biasRegularizer),this.kernelConstraint=ea(t.kernelConstraint),this.recurrentConstraint=ea(t.recurrentConstraint),this.biasConstraint=ea(t.biasConstraint),this.dropout=ms([1,Cl([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=ms([1,Cl([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=U(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return bt(()=>{if((t=t).length!==2)throw new mt(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];let a=n.training!=null&&n.training,l;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hp({ones:()=>ho(t),rate:this.dropout,training:a,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hp({ones:()=>ho(s),rate:this.recurrentDropout,training:a,dropoutFunc:this.dropoutFunc}));let u=this.dropoutMask,h=this.recurrentDropoutMask;l=Qu(u!=null?qe(t,u):t,this.kernel.read()),this.bias!=null&&(l=Il(l,this.bias.read())),h!=null&&(s=qe(s,h));let f=fn(l,Qu(s,this.recurrentKernel.read()));return this.activation!=null&&(f=this.activation.apply(f)),[f,f]})}getConfig(){let t=super.getConfig(),n={units:this.units,activation:up(this.activation),useBias:this.useBias,kernelInitializer:Cs(this.kernelInitializer),recurrentInitializer:Cs(this.recurrentInitializer),biasInitializer:Cs(this.biasInitializer),kernelRegularizer:gs(this.kernelRegularizer),recurrentRegularizer:gs(this.recurrentRegularizer),biasRegularizer:gs(this.biasRegularizer),activityRegularizer:gs(this.activityRegularizer),kernelConstraint:Ds(this.kernelConstraint),recurrentConstraint:Ds(this.recurrentConstraint),biasConstraint:Ds(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,n)}}cx.className="SimpleRNNCell",dn(cx);class Lw extends Ju{constructor(t){t.cell=new cx(t),super(t)}call(t,n){return bt(()=>{this.cell.dropoutMask!=null&&(ni(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ni(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let s=n==null?null:n.mask,a=n==null?null:n.training,l=n==null?null:n.initialState;return super.call(t,{mask:s,training:a,initialState:l})})}static fromConfig(t,n){return new t(n)}}Lw.className="SimpleRNN",dn(Lw);class hx extends $y{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new mt("GRUCell does not support reset_after parameter set to true.");this.units=t.units,na(this.units,"units"),this.activation=cp(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=cp(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null||t.useBias,this.kernelInitializer=Ss(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ss(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ss(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Bs(t.kernelRegularizer),this.recurrentRegularizer=Bs(t.recurrentRegularizer),this.biasRegularizer=Bs(t.biasRegularizer),this.kernelConstraint=ea(t.kernelConstraint),this.recurrentConstraint=ea(t.recurrentConstraint),this.biasConstraint=ea(t.biasConstraint),this.dropout=ms([1,Cl([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=ms([1,Cl([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){let n=(t=U(t))[t.length-1];this.kernel=this.addWeight("kernel",[n,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return bt(()=>{if((t=t).length!==2)throw new mt(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);let s=n.training!=null&&n.training,a=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hp({ones:()=>ho(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hp({ones:()=>ho(a),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));let l=this.dropoutMask,u=this.recurrentDropoutMask,h,f,d;0<this.dropout&&this.dropout<1&&(t=qe(t,l[0]));let m=Qu(t,this.kernel.read());this.useBias&&(m=Il(m,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(a=qe(a,u[0]));let g=this.recurrentKernel.read(),[x,R]=Oa(g,[2*this.units,this.units],g.rank-1),N=Qu(a,x),[F,H,W]=Oa(m,3,m.rank-1),[G,se]=Oa(N,2,N.rank-1);h=this.recurrentActivation.apply(fn(F,G)),f=this.recurrentActivation.apply(fn(H,se));let ge=Qu(qe(f,a),R);d=this.activation.apply(fn(W,ge));let Ce=fn(qe(h,a),qe(fn(1,ps(h)),d));return[Ce,Ce]})}getConfig(){let t=super.getConfig(),n={units:this.units,activation:up(this.activation),recurrentActivation:up(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Cs(this.kernelInitializer),recurrentInitializer:Cs(this.recurrentInitializer),biasInitializer:Cs(this.biasInitializer),kernelRegularizer:gs(this.kernelRegularizer),recurrentRegularizer:gs(this.recurrentRegularizer),biasRegularizer:gs(this.biasRegularizer),activityRegularizer:gs(this.activityRegularizer),kernelConstraint:Ds(this.kernelConstraint),recurrentConstraint:Ds(this.recurrentConstraint),biasConstraint:Ds(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,n)}}hx.className="GRUCell",dn(hx);class Dw extends Ju{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new hx(t),super(t)}call(t,n){return bt(()=>{this.cell.dropoutMask!=null&&(ni(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ni(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let s=n==null?null:n.mask,a=n==null?null:n.training,l=n==null?null:n.initialState;return super.call(t,{mask:s,training:a,initialState:l})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}Dw.className="GRU",dn(Dw);class Vy extends $y{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,na(this.units,"units"),this.activation=cp(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=cp(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null||t.useBias,this.kernelInitializer=Ss(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ss(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ss(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=Bs(t.kernelRegularizer),this.recurrentRegularizer=Bs(t.recurrentRegularizer),this.biasRegularizer=Bs(t.biasRegularizer),this.kernelConstraint=ea(t.kernelConstraint),this.recurrentConstraint=ea(t.recurrentConstraint),this.biasConstraint=ea(t.biasConstraint),this.dropout=ms([1,Cl([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=ms([1,Cl([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;let s=(t=U(t))[t.length-1],a;if(this.kernel=this.addWeight("kernel",[s,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){let l=this.biasInitializer,u=this.units;a=new((n=class extends il{apply(h,f){let d=l.apply([u]),m=new pg().apply([u]),g=l.apply([2*u]);return _y(_y(d,m),g)}}).className="CustomInit",n)}else a=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,a,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return bt(()=>{let s=n.training!=null&&n.training;if((t=t).length!==3)throw new mt(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let a=t[1],l=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hp({ones:()=>ho(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hp({ones:()=>ho(a),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));let u=this.dropoutMask,h=this.recurrentDropoutMask,f,d,m,g;0<this.dropout&&this.dropout<1&&(t=qe(t,u[0]));let x=Qu(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(a=qe(a,h[0])),x=fn(x,Qu(a,this.recurrentKernel.read())),this.useBias&&(x=Il(x,this.bias.read()));let[R,N,F,H]=Oa(x,4,x.rank-1);f=this.recurrentActivation.apply(R),d=this.recurrentActivation.apply(N),m=fn(qe(d,l),qe(f,this.activation.apply(F))),g=this.recurrentActivation.apply(H);let W=qe(g,this.activation.apply(m));return[W,W,m]})}getConfig(){let t=super.getConfig(),n={units:this.units,activation:up(this.activation),recurrentActivation:up(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Cs(this.kernelInitializer),recurrentInitializer:Cs(this.recurrentInitializer),biasInitializer:Cs(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:gs(this.kernelRegularizer),recurrentRegularizer:gs(this.recurrentRegularizer),biasRegularizer:gs(this.biasRegularizer),activityRegularizer:gs(this.activityRegularizer),kernelConstraint:Ds(this.kernelConstraint),recurrentConstraint:Ds(this.recurrentConstraint),biasConstraint:Ds(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,n)}}Vy.className="LSTMCell",dn(Vy);class Fw extends Ju{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Vy(t),super(t)}call(t,n){return bt(()=>{this.cell.dropoutMask!=null&&(ni(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ni(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let s=n==null?null:n.mask,a=n==null?null:n.training,l=n==null?null:n.initialState;return super.call(t,{mask:s,training:a,initialState:l})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}Fw.className="LSTM",dn(Fw);class dx extends $y{constructor(t){super(t),this.cells=t.cells}get stateSize(){let t=[];for(let n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return bt(()=>{let s=(t=t).slice(1),a=[];for(let h of this.cells.slice().reverse())Array.isArray(h.stateSize)?a.push(s.splice(0,h.stateSize.length)):a.push(s.splice(0,1));a.reverse();let l=[],u;for(let h=0;h<this.cells.length;++h){let f=this.cells[h];s=a[h],u=h===0?[t[0]].concat(s):[u[0]].concat(s),u=f.call(u,n),l.push(u.slice(1))}s=[];for(let h of l.slice().reverse())s.push(...h);return[u[0]].concat(s)})}build(t){let n;w(t)&&(t=t[0]),t=t,this.cells.forEach((s,a)=>{fu(`RNNCell_${a}`,()=>{s.build(t),n=Array.isArray(s.stateSize)?s.stateSize[0]:s.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){let t=super.getConfig(),n={cells:this.cells.map(s=>({className:s.getClassName(),config:s.getConfig()}))};return Object.assign({},t,n)}static fromConfig(t,n,s={}){let a=[];for(let l of n.cells)a.push(pn(l,s));return new t({cells:a})}get trainableWeights(){if(!this.trainable)return[];let t=[];for(let n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){let n=[];for(let s of this.cells)n.push(...s.trainableWeights);return n.concat(t)}return t}getWeights(){let t=[];for(let n of this.cells)t.push(...n.weights);return Z(t)}setWeights(t){let n=[];for(let s of this.cells){let a=s.weights.length,l=t.splice(a);for(let u=0;u<s.weights.length;++u)n.push([s.weights[u],l[u]])}ne(n)}}function hp(i){let{ones:t,rate:n,training:s=!1,count:a=1,dropoutFunc:l}=i,u=()=>l!=null?l(t(),n):ix(t(),n),h=()=>Vf(u,t,s);return!a||a<=1?wa(h().clone()):Array(a).fill(void 0).map(h).map(f=>wa(f.clone()))}dx.className="StackedRNNCells",dn(dx);class HE extends Ju{constructor(t){if(t.unroll)throw new Jr("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Jr("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new ce({ndim:5})]}call(t,n){return bt(()=>{if(this.cell.dropoutMask!=null&&(ni(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ni(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new mt("ConvRNN2D cell does not support constants");let s=n==null?null:n.mask,a=n==null?null:n.training,l=n==null?null:n.initialState;return super.call(t,{mask:s,training:a,initialState:l})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return bt(()=>{let{stateSize:n}=this.cell,s=t.shape,a=this.computeSingleOutputShape(s),l=js([a[0],...a.slice(2)]);return Array.isArray(n)?Array(n.length).fill(l):[l]})}resetStates(t,n=!1){bt(()=>{if(!this.stateful)throw new du("Cannot call resetStates() on an RNN Layer that is not stateful.");let s=this.inputSpec[0].shape,a=this.computeSingleOutputShape(s),l=[a[0],...a.slice(2)];if(s[0]==null)throw new mt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>js(l)):this.states_=[js(l)];else if(t==null)ni(this.states_),this.keptStates!=null&&(ni(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>js(l)):this.states_[0]=js(l);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new mt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):ni(this.states_);for(let u=0;u<this.states_.length;++u){let h=t[u],f=l;if(!Ye(h.shape,f))throw new mt(`State ${u} is incompatible with layer ${this.name}: expected shape=${f}, received shape=${h.shape}`);this.states_[u]=h}}this.states_=this.states_.map(u=>wa(u.clone()))})}computeSingleOutputShape(t){let{dataFormat:n,filters:s,kernelSize:a,padding:l,strides:u,dilationRate:h}=this.cell,f=n==="channelsFirst",d=t[f?3:2],m=t[f?4:3],g=Zu(d,a[0],l,u[0],h[0]),x=Zu(m,a[1],l,u[1],h[1]);return[...t.slice(0,2),...f?[s,g,x]:[g,x,s]]}}HE.className="ConvRNN2D";class px extends Vy{constructor(t){let{filters:n,kernelSize:s,strides:a,padding:l,dataFormat:u,dilationRate:h}=t;super(Object.assign({},t,{units:n})),this.filters=n,na(this.filters,"filters"),this.kernelSize=wg(s,2,"kernelSize"),this.kernelSize.forEach(f=>na(f,"kernelSize")),this.strides=wg(a||1,2,"strides"),this.strides.forEach(f=>na(f,"strides")),this.padding=l||"valid",fo(this.padding),this.dataFormat=u||"channelsLast",Xs(this.dataFormat),this.dilationRate=wg(h||1,2,"dilationRate"),this.dilationRate.forEach(f=>na(f,"dilationRate"))}build(t){var n;t=U(t);let s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new mt(`The channel dimension of the input should be defined. Found ${t[s]}`);let a=t[s],l=this.kernelSize.concat([a,4*this.filters]);this.kernel=this.addWeight("kernel",l,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let u=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let h;if(this.unitForgetBias){let f=this.biasInitializer,d=this.filters;h=new((n=class extends il{apply(m,g){return My([f.apply([d]),co([d]),f.apply([2*d])])}}).className="CustomInit",n)}else h=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,h,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return bt(()=>{if(t.length!==3)throw new mt(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let s=n.training||!1,a=t[0],l=t[1],u=t[2];0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hp({ones:()=>ho(a),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));let h=this.dropoutMask,f=(zt,Gt,qt)=>Gt&&Gt[qt]?qe(Gt[qt],zt):zt,d=f(a,h,0),m=f(a,h,1),g=f(a,h,2),x=f(a,h,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hp({ones:()=>ho(l),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));let R=this.recurrentDropoutMask,N=f(l,R,0),F=f(l,R,1),H=f(l,R,2),W=f(l,R,3),[G,se,ge,Ce]=Oa(this.kernel.read(),4,3),[Be,Ve,ze,Xe]=this.useBias?Oa(this.bias.read(),4):[null,null,null,null];d=this.inputConv(d,G,Be,this.padding),m=this.inputConv(m,se,Ve,this.padding),g=this.inputConv(g,ge,ze,this.padding),x=this.inputConv(x,Ce,Xe,this.padding);let[tt,ot,ut,ft]=Oa(this.recurrentKernel.read(),4,3);N=this.recurrentConv(N,tt),F=this.recurrentConv(F,ot),H=this.recurrentConv(H,ut),W=this.recurrentConv(W,ft);let kt=this.recurrentActivation.apply(fn(d,N)),Ut=this.recurrentActivation.apply(fn(m,F)),It=fn(qe(Ut,u),qe(kt,this.activation.apply(fn(g,H)))),Lt=qe(this.recurrentActivation.apply(fn(x,W)),this.activation.apply(It));return[Lt,Lt,It]})}getConfig(){let t=super.getConfig(),{units:n}=t,s=function(l,u){var h={};for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&u.indexOf(f)<0&&(h[f]=l[f]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function"){var d=0;for(f=Object.getOwnPropertySymbols(l);d<f.length;d++)u.indexOf(f[d])<0&&Object.prototype.propertyIsEnumerable.call(l,f[d])&&(h[f[d]]=l[f[d]])}return h}(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},s,a)}inputConv(t,n,s,a){let l=Du(t,n,this.strides,a||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Il(l,s,this.dataFormat):l}recurrentConv(t,n){return Du(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}px.className="ConvLSTM2DCell",dn(px);class Pw extends HE{constructor(t){let n=new px(t);super(Object.assign({},t,{cell:n}))}static fromConfig(t,n){return new t(n)}}Pw.className="ConvLSTM2D",dn(Pw);class fx extends Pe{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;let n=t.shape,s=[];for(let a=0;a<this.noiseShape.length;++a)s.push(this.noiseShape[a]==null?n[a]:this.noiseShape[a]);return s}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t);if(0<this.rate&&this.rate<1){let a=n.training!=null&&n.training,l=this.getNoiseShape(s);return Vf(()=>ix(s,this.rate,l,this.seed),()=>s,a)}return t})}getConfig(){let t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}fx.className="Dropout",dn(fx);class Ow extends fx{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){let n=t.shape;return[n[0],1,n[2]]}}Ow.className="SpatialDropout1D",dn(Ow);class Bw extends Pe{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,na(this.units,"units"),this.activation=cp(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=Ss(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ss(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=ea(t.kernelConstraint),this.biasConstraint=ea(t.biasConstraint),this.kernelRegularizer=Bs(t.kernelRegularizer),this.biasRegularizer=Bs(t.biasRegularizer),this.activityRegularizer=Bs(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){let n=(t=U(t))[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){let n=(t=U(t)).slice();return n[n.length-1]=this.units,n}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t),a=Qb(this.activation.getClassName()),l;return a!=null?l=Qu(s,this.kernel.read(),a,this.bias?this.bias.read():null):(l=Qu(s,this.kernel.read()),this.bias!=null&&(l=Il(l,this.bias.read())),this.activation!=null&&(l=this.activation.apply(l))),l})}getConfig(){let t={units:this.units,activation:up(this.activation),useBias:this.useBias,kernelInitializer:Cs(this.kernelInitializer),biasInitializer:Cs(this.biasInitializer),kernelRegularizer:gs(this.kernelRegularizer),biasRegularizer:gs(this.biasRegularizer),activityRegularizer:gs(this.activityRegularizer),kernelConstraint:Ds(this.kernelConstraint),biasConstraint:Ds(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}Bw.className="Dense",dn(Bw);class Uw extends Pe{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=U(t);for(let n of t.slice(1))if(n==null)throw new mt(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Yc(t,1)]}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){let a=[0];for(let l=2;l<s.rank;++l)a.push(l);a.push(1),s=xi(s,a)}return function(a){if(a.rank<=1)throw new mt(`batchFlatten requires a minimum rank of 2. Got rank: ${a.rank}.`);let l=[a.shape[0],Yc(a.shape,1)];return pt(a,l)}(s)})}getConfig(){let t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);let n=super.getConfig();return Object.assign(t,n),t}}Uw.className="Flatten",dn(Uw);class zw extends Pe{constructor(t){super(t),this.supportsMasking=!0,this.activation=cp(t.activation)}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t);return this.activation.apply(s)})}getConfig(){let t={activation:up(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}zw.className="Activation",dn(zw);class $w extends Pe{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return bt(()=>{return t=O(t),s=t,a=this.n,bt(()=>{if(s.shape.length!==2)throw new mt(`repeat() expects a rank-2 tensor, but received a rank-${s.shape.length} tensor.`);return Cy(Uf(s,1),[1,a,1])});var s,a})}getConfig(){let t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}$w.className="RepeatVector",dn($w);class Vw extends Pe{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){let s="Total size of new array must be unchanged.",a=n.slice(),l=1,u=null;for(let f=0;f<a.length;++f){let d=a[f];if(this.isUnknown(d)){if(u!==null)throw new mt("Can only specifiy one unknown dimension.");u=f}else l*=d}let h=Yc(t);if(u!==null){if(l===0||h%l!=0)throw new mt(s);a[u]=h/l}else if(h!==l)throw new mt(s);return a}computeOutputShape(t){let n=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t),a=s.shape,l=a.slice(0,1).concat(this.fixUnknownDimension(a.slice(1),this.targetShape));return pt(s,l)})}getConfig(){let t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}Vw.className="Reshape",dn(Vw);class Hw extends Pe{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);let n=rl(1,t.dims.length+1);if(!Ye(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new ce({ndim:this.dims.length+1})]}computeOutputShape(t){let n=(t=U(t)).slice();return this.dims.forEach((s,a)=>{n[a+1]=t[s]}),n}call(t,n){return xi(O(t),this.dimsIncludingBatch)}getConfig(){let t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}Hw.className="Permute",dn(Hw);class Gw extends Pe{constructor(t){super(t??{}),this.supportsMasking=!0,this.maskValue=t!=null?t.maskValue==null?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){let s=O(t);return kd(ru(s,this.maskValue),-1)}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t),a=kd(ru(s,this.maskValue),-1,!0);return qe(s,En(a,s.dtype))})}}Gw.className="Masking",dn(Gw);class Ww extends Pe{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(fs(t.inputLength))}this.inputDim=t.inputDim,na(this.inputDim,"inputDim"),this.outputDim=t.outputDim,na(this.outputDim,"outputDim"),this.embeddingsInitializer=Ss(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Bs(t.embeddingsRegularizer),this.activityRegularizer=Bs(t.activityRegularizer),this.embeddingsConstraint=ea(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return bt(()=>this.maskZero?(t=O(t),ru(t,wi(t))):null)}computeOutputShape(t){if(t=U(t),this.inputLength==null)return[...t,this.outputDim];let n=fs(this.inputLength);if(n.length!==t.length-1)throw new mt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let a=0;a<n.length;++a){let l=n[a],u=t[a+1];if(l!=null&&u!=null&&l!==u)throw new mt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);l==null&&(n[s]=u),s++}}return[t[0],...n,this.outputDim]}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t);s.dtype!=="int32"&&(s=dg(s,"int32"));let a=rx(this.embeddings.read(),pt(s,[s.size]));return pt(a,U(this.computeOutputShape(s.shape)))})}getConfig(){let t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Cs(this.embeddingsInitializer),embeddingsRegularizer:gs(this.embeddingsRegularizer),activityRegularizer:gs(this.activityRegularizer),embeddingsConstraint:Ds(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}Ww.className="Embedding",dn(Ww);class Gf extends Pe{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Jr}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;let s=t.slice(0,t.length-n.length);for(let a=0;a<n.length;++a){let l=t[t.length-n.length+a],u=n[a];if(l==null||u==null||l<0||u<0)s.push(null);else if(l===1)s.push(u);else if(u===1)s.push(l);else{if(l!==u)throw new mt("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));s.push(l)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[U(t)]),(t=t).length<2)throw new mt(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(let l of t)l!=null&&l[0]!==null&&n.push(l[0]);if(n=Yu(n),n.length>1)throw new mt(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let l=1;l<t.length;++l){let u=t[l]==null?null:t[l].slice(1);s=this.computeElementwiseOpOutputShape(s,u)}let a=t.map(l=>l.length);t.indexOf(null)===-1&&Yu(a).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return bt(()=>{if(t=t,this.reshapeRequired){let s=[],a=t.map(l=>l.rank);if(a.indexOf(null)===-1){let l=Cl(a);for(let u of t){let h=u.rank;for(let f=0;f<l-h;++f)u=Uf(u,1);s.push(u)}return this.mergeFunction(s)}{let l=!1;for(let f of t){let d=f.rank;if(d==null){let m=f.shape,g=m[0],x=m.slice(1).concat([g]),R=pt(f,[g].concat(Yc(m.slice(1))));R=xi(R,[1,0]),R=pt(R,x),s.push(R),l=!0}else if(d>1){let m=rl(1,d).concat([0]);s.push(xi(f,m)),l=!0}else s.push(f)}let u=this.mergeFunction(s),h=u.rank;if(l){if(h==null){let f=u.shape,d=f[f.length-1],m=[d].concat(f.slice(0,f.length-1));u=pt(xi(pt(u,[-1,d]),[1,0]),m)}else if(h>1){let f=[h-1].concat(rl(0,h-1));u=xi(u,f)}}return u}}return this.mergeFunction(t)})}computeOutputShape(t){let n;n=(t=t)[0]==null?null:t[0].slice(1);for(let a=1;a<t.length;++a){let l=t[a]==null?null:t[a].slice(1);n=this.computeElementwiseOpOutputShape(n,l)}let s=[];for(let a of t)a!=null&&a[0]!==null&&s.push(a[0]);return s=Yu(s),n=s.length===1?s.concat(n):[null].concat(n),n}computeMask(t,n){return bt(()=>{if(n==null)return null;if(!Array.isArray(n))throw new mt("`mask` should be an Array");if(!Array.isArray(t))throw new mt("`inputs` should be an Array");if(n.length!==t.length)throw new mt(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(a=>a==null))return null;let s=(n=n.map(a=>a==null?a:qa(a,0)))[0];for(let a=1;a<n.length-1;++a)s=Yo(s,n[a]);return s})}}class jw extends Gf{constructor(t){super(t)}mergeFunction(t){return bt(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=fn(n,t[s]);return n})}}jw.className="Add",dn(jw);class Xw extends Gf{constructor(t){super(t)}mergeFunction(t){return bt(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=qe(n,t[s]);return n})}}Xw.className="Multiply",dn(Xw);class qw extends Gf{constructor(t){super(t)}mergeFunction(t){return bt(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=fn(n,t[s]);return qe(1/t.length,n)})}}qw.className="Average",dn(qw);class Kw extends Gf{constructor(t){super(t)}mergeFunction(t){return bt(()=>{let n=t[0];for(let s=1;s<t.length;++s)n=Tl(n,t[s]);return n})}}Kw.className="Maximum",dn(Kw);class Yw extends Gf{constructor(t){super(t)}mergeFunction(t){return bt(()=>{let n=t[0];for(let s=1;s<t.length;++s)n=Ud(n,t[s]);return n})}}Yw.className="Minimum",dn(Yw);class Qw extends Gf{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||t.length===1)throw new mt("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(let a of t)if(a!=null){n=!1;break}if(n)return;let s=[];for(let a=0;a<t.length;++a){let l=t[a].slice();l.splice(this.axis,1);let u=!1;for(let h of s)if(Ye(h,l)){u=!0;break}u||s.push(l)}if(s.length>1)throw new mt("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return bt(()=>My(t,this.axis))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new mt("A `Concatenate` layer should be called on a list of inputs.");let n=t,s=n[0].slice(),a=this.axis<0?s.length+this.axis:this.axis;for(let l of n.slice(1)){if(s[a]==null||l[a]==null){s[a]=null;break}s[a]+=l[a]}return s}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new mt("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new mt("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new mt(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return bt(()=>{let s=!0;if(n.forEach(u=>{u==null||(s=!1)}),s)return null;let a=[];for(let u=0;u<t.length;++u)n[u]==null?a.push(En(ho(t[u]),"bool")):n[u].rank<t[u].rank?a.push(qa(n[u],-1)):a.push(n[u]);let l=Ti(a,this.axis);return bm(l,-1,!1)})}getConfig(){let t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}function Hy(i,t){for(;i<0;)i+=t;return i}Qw.className="Concatenate",dn(Qw);class Zw extends Gf{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize!=null&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){ee(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let n=t[0],s=t[1];if(n.length>3||s.length>3)throw new Jr("Dot layer does not support tensors of 4D or higher rank yet.");let a=this.interpretAxes(n,s);if(n[a[0]]!==s[a[1]])throw new mt(`Dimension incompatibility: ${n[a[0]]} !== ${s[a[1]]}`)}mergeFunction(t){if(t.length!==2)throw new mt(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n,s=t[0],a=t[1];return n=Array.isArray(this.axes)?this.axes.map((l,u)=>Hy(l,t[u].shape.length)):[Hy(this.axes,s.shape.length),Hy(this.axes,a.shape.length)],this.normalize&&(s=er(s,n[0]),a=er(a,n[1])),function(l,u,h){if(l.shape.length>3||u.shape.length>3)throw new Jr("batchDot is not implemented for tensors of 4D or higher rank yet");if(ee(l.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${l.shape.length}`),ee(l.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${u.shape.length}`),typeof h=="number"&&(h=[h,h]),l.dtype==="complex64"||u.dtype==="complex64")throw new Jr("batchDot is not implemented for complex64-type Tensors yet.");let f=l.shape.length,d=u.shape.length;h==null&&(h=[f-1,d-2]);let m=h;return bt(()=>{let g,x;if(f>d){g=f-d;let R=[];for(let N=0;N<g;++N)R.push(1);u=pt(u,u.shape.concat(R))}else if(d>f){g=d-f;let R=[];for(let N=0;N<g;++N)R.push(1);l=pt(l,l.shape.concat(R))}else g=0;if(l.shape.length===2&&u.shape.length===2)x=m[0]===m[1]?Yn(qe(l,u),m[0]):Yn(qe(xi(l,[1,0]),u),m[1]);else{let R=m[0]!==l.shape.length-1,N=m[1]===u.shape.length-1;x=oi(l,u,R,N)}if(g>0){let R;R=f>d?f+d-3:f-1;let N=[];for(let F=R;F<R+g;++F)N.push(F);x=au(x,N)}return x.shape.length===1&&(x=qa(x,1)),x})}(s,a,n)}interpretAxes(t,n){let s;return s=Array.isArray(this.axes)?this.axes:[Hy(this.axes,t.length),Hy(this.axes,n.length)],s}computeOutputShape(t){ee(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let n=t[0].slice(),s=t[1].slice();if(n.length>3||s.length>3)throw new Jr("Dot layer does not support tensors of 4D or higher rank yet.");let a=this.interpretAxes(n,s);n.splice(a[0],1),s.splice(a[1],1),s.splice(0,1);let l=n.concat(s);return l.length===1&&l.push(1),l}computeMask(t,n){return null}getConfig(){let t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}Zw.className="Dot",dn(Zw);class Jw extends Pe{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t);return Vf(()=>fn(zf(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}Jw.className="GaussianNoise",dn(Jw);class eA extends Pe{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return bt(()=>{this.invokeCallHook(t,n);let s=O(t);return this.rate>0&&this.rate<1?Vf(()=>{let a=Math.sqrt(this.rate/(1-this.rate));return qe(s,zf(s.shape,1,a))},()=>s,n.training||!1):s})}}eA.className="GaussianDropout",dn(eA);class tA extends Pe{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||O(t).shape}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return bt(()=>{if(this.rate<1&&this.rate>0){let s=this._getNoiseShape(t);return Vf(()=>{let a=O(t),l=-1.7580993408473766,u=Ya(Gi(s),this.rate);u=dg(u,"float32");let h=((1-this.rate)*(1+this.rate*l**2))**-.5,f=-h*l*this.rate,d=fn(qe(a,u),qe(fn(u,-1),l));return fn(qe(d,h),f)},()=>O(t),n.training||!1)}return t})}}function Gy(i,t,n,s,a,l=.001){let u;if(i.rank===2)u=Hv(i,t,n,s,a,l);else if(i.rank===3)u=Gv(i,t,n,s,a,l);else{if(i.rank!==4)throw new Jr(`batchNormalization is not implemented for array of rank ${i.rank} yet`);u=Wv(i,t,n,s,a,l)}return u}tA.className="AlphaDropout",dn(tA);class nA extends Pe{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null||t.center,this.scale=t.scale==null||t.scale,this.betaInitializer=Ss(t.betaInitializer||"zeros"),this.gammaInitializer=Ss(t.gammaInitializer||"ones"),this.movingMeanInitializer=Ss(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ss(t.movingVarianceInitializer||"ones"),this.betaConstraint=ea(t.betaConstraint),this.gammaConstraint=ea(t.gammaConstraint),this.betaRegularizer=Bs(t.betaRegularizer),this.gammaRegularizer=Bs(t.gammaRegularizer)}build(t){t=U(t);let n=this.axis>=0?this.axis:this.axis+t.length,s=t[n];if(s==null)throw new mt(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new ce({ndim:t.length,axes:{[n]:s}})];let a=[s];this.scale&&(this.gamma=this.addWeight("gamma",a,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",a,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",a,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",a,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return bt(()=>{let s=n.training!=null&&n.training,a=O(t),l=a.shape,u=l.length,h=rl(0,u),f=this.axis>=0?this.axis:this.axis+u;h.splice(f,1);let d=qu(1,u);d[f]=l[f];let m=h.slice();m.sort();let g=!Ye(m,rl(0,u).slice(0,u-1));if(!s)return(()=>{if(g){let H=pt(this.movingMean.read(),d),W=pt(this.movingVariance.read(),d),G=this.center?pt(this.beta.read(),d):null,se=this.scale?pt(this.gamma.read(),d):null;return Gy(a,H,W,G,se,this.epsilon)}return Gy(a,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)})();let[x,R,N]=function(H,W,G,se,ge=.001){return Ye(se.slice().sort(),rl(0,H.rank-1))?function(Ce,Be,Ve,ze,Xe=.001){return bt(()=>{let tt=nf(Ce,ze),ot=tt.mean,ut=tt.variance;return[Gy(Ce,ot,ut,Ve,Be,Xe),ot,ut]})}(H,W,G,se,ge):function(Ce,Be,Ve,ze,Xe=.001){return bt(()=>{let tt=nf(Ce,ze),ot=tt.mean,ut=tt.variance,ft=[];for(let zt of rl(0,Ce.rank))ze.indexOf(zt)!==-1?ft.push(1):ft.push(Ce.shape[zt]);let kt=pt(ot,ft),Ut=pt(ut,ft),It=Be==null?null:pt(Be,ft),Lt=Ve==null?null:pt(Ve,ft);return[Gy(Ce,kt,Ut,Lt,It,Xe),ot,ut]})}(H,W,G,se,ge)}(a,this.gamma.read(),this.beta.read(),h,this.epsilon),F=(H,W,G)=>{bt(()=>{let se=1-G,ge=H.read(),Ce=qe(Un(ge,W),se);H.write(Un(ge,Ce))})};return F(this.movingMean,R,this.momentum),F(this.movingVariance,N,this.momentum),x})}getConfig(){let t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Cs(this.betaInitializer),gammaInitializer:Cs(this.gammaInitializer),movingMeanInitializer:Cs(this.movingMeanInitializer),movingVarianceInitializer:Cs(this.movingVarianceInitializer),betaRegularizer:gs(this.betaRegularizer),gammaRegularizer:gs(this.gammaRegularizer),betaConstraint:Ds(this.betaConstraint),gammaConstraint:Ds(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}nA.className="BatchNormalization",dn(nA);class rA extends Pe{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(let n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null||t.center,this.scale=t.scale==null||t.scale,this.betaInitializer=Ss(t.betaInitializer||"zeros"),this.gammaInitializer=Ss(t.gammaInitializer||"ones"),this.betaRegularizer=Bs(t.betaRegularizer),this.gammaRegularizer=Bs(t.gammaRegularizer),this.supportsMasking=!0}build(t){let n=(t=U(t)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=n);for(let a of this.axis)if(a<0||a>=n)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==Yu(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let s=this.axis.map(a=>t[a]);this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0}call(t,n){let s=O(t),a=s.shape,l=a.length;return bt(()=>{let{mean:u,variance:h}=nf(s,this.axis,!0),f=qu(1,l);for(let N of this.axis)f[N]=a[N];let d=N=>N!=null&&N.shape.length!==l?pt(N,f):N,m=d(this.gamma.read()),g=d(this.beta.read()),x=[],R=[];for(let N=0;N<l;++N)this.axis.indexOf(N)!==-1?(x.push(a[N]),R.push(1)):(x.push(1),R.push(a[N]));return u=oo(u,x),h=oo(h,x),m=oo(m,R),g=oo(g,R),Gy(s,u,h,g,m,this.epsilon)})}getConfig(){let t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Cs(this.betaInitializer),gammaInitializer:Cs(this.gammaInitializer),betaRegularizer:gs(this.betaRegularizer),gammaRegularizer:gs(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}rA.className="LayerNormalization",dn(rA);class iA extends Pe{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new mt(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,s;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new mt(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new mt(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[n,s]}this.inputSpec=[new ce({ndim:4})]}computeOutputShape(t){let n,s;return t=U(t),this.dataFormat==="channelsFirst"?(n=t[2]!=null&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,s=t[3]!=null&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],n,s]):(n=t[1]!=null&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,s=t[2]!=null&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],n,s,t[3]])}call(t,n){return bt(()=>{return s=O(t),a=this.padding,l=this.dataFormat,bt(()=>{if(s.rank!==4)throw new mt(`temporalPadding expects input tensor to be 4-D, but received a ${s.rank}-D tensor.`);if(a==null&&(a=[[1,1],[1,1]]),a.length!==2||a[0].length!==2||a[1].length!==2)throw new mt("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(l==null&&(l="channelsLast"),l!=="channelsLast"&&l!=="channelsFirst")throw new mt(`Unknown data format: ${l}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let u;return u=l==="channelsFirst"?[[0,0],[0,0],a[0],a[1]]:[[0,0],a[0],a[1],[0,0]],iu(s,u)});var s,a,l})}getConfig(){let t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}function mx(i,t,n,s,a,l){return bt(()=>{let u;Xs(a),tx(l),fo(s),n==null&&(n=[1,1]),s==null&&(s="valid"),a==null&&(a="channelsLast"),l==null&&(l="max"),i=Mw(i,a);let h=s==="same"?"same":"valid";return u=l==="max"?ef(i,t,n,h):Nd(i,t,n,h),a==="channelsFirst"&&(u=xi(u,[0,3,1,2])),u})}function GE(i,t,n,s,a,l){return bt(()=>{let u;Xs(a),tx(l),fo(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),a==null&&(a="channelsLast"),l==null&&(l="max"),i=BE(i,a);let h=s==="same"?"same":"valid";return u=l==="max"?O0(i,t,n,h):wc(i,t,n,h),a==="channelsFirst"&&(u=xi(u,[0,4,1,2,3])),u})}iA.className="ZeroPadding2D",dn(iA);class WE extends Pe{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||t.poolSize.length!==1||typeof t.poolSize[0]!="number")throw new mt(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(na(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else{if(!Array.isArray(t.strides)||t.strides.length!==1||typeof t.strides[0]!="number")throw new mt(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}na(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,fo(this.padding),this.inputSpec=[new ce({ndim:3})]}computeOutputShape(t){let n=Zu((t=U(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return bt(()=>{this.invokeCallHook(t,n),t=Uf(O(t),2);let s=this.poolingFunction(O(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return au(s,[2])})}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class sA extends WE{constructor(t){super(t)}poolingFunction(t,n,s,a,l){return Xs(l),fo(a),mx(t,n,s,a,l,"max")}}sA.className="MaxPooling1D",dn(sA);class aA extends WE{constructor(t){super(t)}poolingFunction(t,n,s,a,l){return Xs(l),fo(a),mx(t,n,s,a,l,"avg")}}aA.className="AveragePooling1D",dn(aA);class jE extends Pe{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new mt(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];na(this.poolSize,"poolSize"),na(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xs(this.dataFormat),fo(this.padding),this.inputSpec=[new ce({ndim:4})]}computeOutputShape(t){t=U(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=Zu(n,this.poolSize[0],this.padding,this.strides[0]),s=Zu(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,s]:[t[0],n,s,t[3]]}call(t,n){return bt(()=>(this.invokeCallHook(t,n),this.poolingFunction(O(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class oA extends jE{constructor(t){super(t)}poolingFunction(t,n,s,a,l){return Xs(l),fo(a),mx(t,n,s,a,l,"max")}}oA.className="MaxPooling2D",dn(oA);class lA extends jE{constructor(t){super(t)}poolingFunction(t,n,s,a,l){return Xs(l),fo(a),mx(t,n,s,a,l,"avg")}}lA.className="AveragePooling2D",dn(lA);class XE extends Pe{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new mt(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];na(this.poolSize,"poolSize"),na(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xs(this.dataFormat),fo(this.padding),this.inputSpec=[new ce({ndim:5})]}computeOutputShape(t){t=U(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],a=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=Zu(n,this.poolSize[0],this.padding,this.strides[0]),s=Zu(s,this.poolSize[1],this.padding,this.strides[1]),a=Zu(a,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,s,a]:[t[0],n,s,a,t[4]]}call(t,n){return bt(()=>(this.invokeCallHook(t,n),this.poolingFunction(O(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class uA extends XE{constructor(t){super(t)}poolingFunction(t,n,s,a,l){return Xs(l),fo(a),GE(t,n,s,a,l,"max")}}uA.className="MaxPooling3D",dn(uA);class cA extends XE{constructor(t){super(t)}poolingFunction(t,n,s,a,l){return Xs(l),fo(a),GE(t,n,s,a,l,"avg")}}cA.className="AveragePooling3D",dn(cA);class qE extends Pe{constructor(t){super(t),this.inputSpec=[new ce({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new Jr}}class hA extends qE{constructor(t){super(t||{})}call(t,n){return bt(()=>{let s=O(t);return ws(s,1)})}}hA.className="GlobalAveragePooling1D",dn(hA);class dA extends qE{constructor(t){super(t||{})}call(t,n){return bt(()=>{let s=O(t);return uo(s,1)})}}dA.className="GlobalMaxPooling1D",dn(dA);class KE extends Pe{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xs(this.dataFormat),this.inputSpec=[new ce({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new Jr}getConfig(){let t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class pA extends KE{call(t,n){return bt(()=>{let s=O(t);return this.dataFormat==="channelsLast"?ws(s,[1,2]):ws(s,[2,3])})}}pA.className="GlobalAveragePooling2D",dn(pA);class fA extends KE{call(t,n){return bt(()=>{let s=O(t);return this.dataFormat==="channelsLast"?uo(s,[1,2]):uo(s,[2,3])})}}fA.className="GlobalMaxPooling2D",dn(fA);class YE extends Pe{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null&&this.layer.trainable}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){let t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,s={}){let a=pn(n.layer,s);delete n.layer;let l={layer:a};return Object.assign(l,n),new t(l)}}class mA extends YE{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=U(t)).length<3)throw new mt(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];let n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){let n=[(t=U(t))[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(n),a=t[1];return[s[0],a].concat(s.slice(1))}call(t,n){return bt(()=>VE((s,a)=>[O(this.layer.call(s,n)),[]],t=O(t),[],!1,null,null,!1,!0)[1])}}mA.className="TimeDistributed",dn(mA);class gA extends YE{constructor(t){super(t);let n=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=n,this.forwardLayer=pn(s),n.goBackwards=n.goBackwards!==!0;let a={};var l;if(a.className=t.layer.getClassName(),a.config=n,this.backwardLayer=pn(a),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?"concat":t.mergeMode,l=this.mergeMode,Xc(ex,"BidirectionalMergeMode",l),t.weights)throw new Jr("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){let n=t.length,s=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let n,s,a,l=this.forwardLayer.computeOutputShape(t);return Array.isArray(l)&&Array.isArray(l[0])||(l=[l]),l=l,this.returnState&&(a=l.slice(1)),n=l[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,s=[n]):s=this.mergeMode==null?[n,n.slice()]:[n],this.returnState?this.mergeMode==null?s.concat(a).concat(a.slice()):[n].concat(a).concat(a.slice()):Ja(s)}apply(t,n){let s=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});let l=$E(t,s,a,this.numConstants);if(t=l.inputs,s=l.initialState,a=l.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&a==null)return super.apply(t,n);let u=[],h=[];if(s!=null){let d=s.length;if(d%2>0)throw new mt("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,u.push(...s);let m=s.map(g=>new ce({shape:g.shape}));this.forwardLayer.stateSpec=m.slice(0,d/2),this.backwardLayer.stateSpec=m.slice(d/2),h.push(...m)}if(a!=null)throw new Jr("Support for constants in Bidirectional layers is not implemented yet.");let f=u[0]instanceof ve;for(let d of u)if(d instanceof ve!==f)throw new mt("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(f){let d=[t].concat(u),m=this.inputSpec.concat(h),g=this.inputSpec;this.inputSpec=m;let x=super.apply(d,n);return this.inputSpec=g,x}return super.apply(t,n)}call(t,n){return bt(()=>{let s=n.initialState,a,l,u,h;if(s==null)a=this.forwardLayer.call(t,n),l=this.backwardLayer.call(t,n);else{let f=s.slice(0,s.length/2),d=s.slice(s.length/2);a=this.forwardLayer.call(t,Object.assign(n,{initialState:f})),l=this.backwardLayer.call(t,Object.assign(n,{initialState:d}))}return this.returnState&&(Array.isArray(a)&&(u=a.slice(1).concat(l.slice(1))),a=a[0],l=l[0]),this.returnSequences&&(l=Pi(l,1)),this.mergeMode==="concat"?h=My([a,l]):this.mergeMode==="sum"?h=fn(a,l):this.mergeMode==="ave"?h=qe(.5,fn(a,l)):this.mergeMode==="mul"?h=qe(a,l):this.mergeMode==null&&(h=[a,l]),this.returnState?this.mergeMode==null?h.concat(u):[h].concat(u):h})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){fu(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),fu(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){let s;if(Array.isArray(n)&&(n=n[0]),s=this.returnSequences?this.mergeMode==null?[n,n]:n:this.mergeMode==null?[null,null]:null,this.returnState){let a=this.forwardLayer.states.map(l=>null);return Array.isArray(s)?s.concat(a).concat(a):[s].concat(a).concat(a)}return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){let t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){let s=pn(n.layer);if(delete n.layer,n.numConstants!=null)throw new Jr("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let a=n;return a.layer=s,new t(a)}}function nM(i){return new We(i)}function rM(i){return new Ew(i)}function iM(i){return new xw(i)}function sM(i){return new ww(i)}function aM(i){return new Aw(i)}function oM(i){return new Tw(i)}function lM(i){return new Sw(i)}function uM(i){return new zy(i)}function cM(i){return new Eg(i)}function hM(i){return new _w(i)}function dM(i){return new Sg(i)}function pM(i){return new Cw(i)}function fM(i){return new Iw(i)}function mM(i){return new kw(i)}function gM(i){return new Rw(i)}function yM(i){return new Nw(i)}function vM(i){return new zw(i)}function bM(i){return new Bw(i)}function xM(i){return new fx(i)}function wM(i){return new Ow(i)}function AM(i){return new Uw(i)}function EM(i){return new $w(i)}function SM(i){return new Vw(i)}function TM(i){return new Hw(i)}function MM(i){return new Ww(i)}function _M(i){return new jw(i)}function CM(i){return new qw(i)}function IM(i){return new Qw(i)}function kM(i){return new Kw(i)}function RM(i){return new Yw(i)}function NM(i){return new Xw(i)}function LM(i){return new Zw(i)}function DM(i){return new nA(i)}function FM(i){return new rA(i)}function PM(i){return new iA(i)}function yA(i){return new aA(i)}function OM(i){return yA(i)}function BM(i){return yA(i)}function vA(i){return new lA(i)}function UM(i){return vA(i)}function zM(i){return vA(i)}function bA(i){return new cA(i)}function $M(i){return bA(i)}function VM(i){return bA(i)}function HM(i){return new hA(i)}function GM(i){return new pA(i)}function QE(i){return new dA(i)}function ZE(i){return new fA(i)}function JE(i){return new sA(i)}function e2(i){return new oA(i)}function WM(i){return new uA(i)}function jM(i){return new Dw(i)}function XM(i){return new hx(i)}function qM(i){return new Fw(i)}function KM(i){return new Vy(i)}function YM(i){return new Lw(i)}function QM(i){return new cx(i)}function ZM(i){return new Pw(i)}function JM(i){return new px(i)}function e_(i){return new Ju(i)}function t_(i){return new dx(i)}function n_(i){return new gA(i)}function r_(i){return new mA(i)}gA.className="Bidirectional",dn(gA);let i_=QE,s_=ZE,a_=JE,o_=e2;function l_(i){return new Jw(i)}function u_(i){return new eA(i)}function c_(i){return new tA(i)}function h_(i){return new Gw(i)}function d_(i,t){return Hn(i,t)}function p_(i,t){return Nn(i,t)}function f_(i,t){return Dn(i,t)}function m_(i,t){return ei(i,t)}function g_(i,t){return rr(i,t)}function y_(i,t){return rn(i,t)}function v_(i,t){return function(n,s){return bt(()=>{let a=Br(n,s),l=function(h,f){return bt(()=>En(Yn(Yo(so(h,1),so(f,0))),"float32"))}(n,s),u=fn(a,l);return En(Ia(Ka(u,0),yn(a,u),0),"float32")})}(i,t)}function b_(i,t){return Lr(i,t)}function x_(i,t){return $n(i,t)}function w_(i,t){return Jt(i,t)}function A_(i,t){return Jt(i,t)}function E_(i,t){return Jt(i,t)}function S_(i,t){return ur(i,t)}function T_(i,t){return ur(i,t)}function M_(i,t){return ur(i,t)}function __(i){return new Uy(i)}function C_(i){return bw(t=i),new Uy({l1:t!=null?t.l1:null,l2:0});var t}function I_(i){return bw(t=i),new Uy({l2:t!=null?t.l2:null,l1:0});var t}class t2 extends Ft{constructor(){super(...arguments),this.model=null}setModel(t){if(!(t instanceof Nt))throw new Error("model must be a LayersModel, not some other Container");this.model=t}}function gx(i,t){return i<t}function k_(i,t){return i>t}class n2 extends t2{constructor(t){if(super(),t==null&&(t={}),t.restoreBestWeights)throw new Jr("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=t.monitor||"val_loss",this.minDelta=Math.abs(t.minDelta||0),this.patience=t.patience||0,this.verbose=t.verbose||0,this.mode=t.mode||"auto",this.baseline=t.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=gx:this.mode==="max"||this.monitor.indexOf("acc")!==-1?this.monitorFunc=k_:this.monitorFunc=gx,this.monitorFunc===gx&&(this.minDelta*=-1)}async onTrainBegin(t){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===gx?1/0:-1/0}async onEpochEnd(t,n){await dt(n);let s=this.getMonitorValue(n);s!=null&&(this.monitorFunc(s-this.minDelta,this.best)?(this.best=s,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)))}async onTrainEnd(t){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(t){t==null&&(t={});let n=t[this.monitor];return n==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(t)}`),n}}let R_={earlyStopping:function(i){return new n2(i)}};var mu,r2;Ge().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,i=>{i&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),function(i){i[i.DT_INVALID=0]="DT_INVALID",i[i.DT_FLOAT=1]="DT_FLOAT",i[i.DT_DOUBLE=2]="DT_DOUBLE",i[i.DT_INT32=3]="DT_INT32",i[i.DT_UINT8=4]="DT_UINT8",i[i.DT_INT16=5]="DT_INT16",i[i.DT_INT8=6]="DT_INT8",i[i.DT_STRING=7]="DT_STRING",i[i.DT_COMPLEX64=8]="DT_COMPLEX64",i[i.DT_INT64=9]="DT_INT64",i[i.DT_BOOL=10]="DT_BOOL",i[i.DT_QINT8=11]="DT_QINT8",i[i.DT_QUINT8=12]="DT_QUINT8",i[i.DT_QINT32=13]="DT_QINT32",i[i.DT_BFLOAT16=14]="DT_BFLOAT16",i[i.DT_QINT16=15]="DT_QINT16",i[i.DT_QUINT16=16]="DT_QUINT16",i[i.DT_UINT16=17]="DT_UINT16",i[i.DT_COMPLEX128=18]="DT_COMPLEX128",i[i.DT_HALF=19]="DT_HALF",i[i.DT_RESOURCE=20]="DT_RESOURCE",i[i.DT_VARIANT=21]="DT_VARIANT",i[i.DT_UINT32=22]="DT_UINT32",i[i.DT_UINT64=23]="DT_UINT64",i[i.DT_FLOAT_REF=101]="DT_FLOAT_REF",i[i.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",i[i.DT_INT32_REF=103]="DT_INT32_REF",i[i.DT_UINT8_REF=104]="DT_UINT8_REF",i[i.DT_INT16_REF=105]="DT_INT16_REF",i[i.DT_INT8_REF=106]="DT_INT8_REF",i[i.DT_STRING_REF=107]="DT_STRING_REF",i[i.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",i[i.DT_INT64_REF=109]="DT_INT64_REF",i[i.DT_BOOL_REF=110]="DT_BOOL_REF",i[i.DT_QINT8_REF=111]="DT_QINT8_REF",i[i.DT_QUINT8_REF=112]="DT_QUINT8_REF",i[i.DT_QINT32_REF=113]="DT_QINT32_REF",i[i.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",i[i.DT_QINT16_REF=115]="DT_QINT16_REF",i[i.DT_QUINT16_REF=116]="DT_QUINT16_REF",i[i.DT_UINT16_REF=117]="DT_UINT16_REF",i[i.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",i[i.DT_HALF_REF=119]="DT_HALF_REF",i[i.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",i[i.DT_VARIANT_REF=121]="DT_VARIANT_REF",i[i.DT_UINT32_REF=122]="DT_UINT32_REF",i[i.DT_UINT64_REF=123]="DT_UINT64_REF"}(mu||(mu={})),function(i){let t;(function(n){n[n.LEGACY=0]="LEGACY",n[n.V1=1]="V1",n[n.V2=2]="V2"})(t=i.CheckpointFormatVersion||(i.CheckpointFormatVersion={}))}(r2||(r2={}));let xA={};function N_(i,t){let n={tfOpName:i,category:"custom",inputs:[],attrs:[],customExecutor:t};xA[i]=n}function i2(i){return xA[i]}function L_(i){delete xA[i]}function Te(i,t,n,s,a){let l=t.inputParams[i];if(l&&l.inputIndexStart!==void 0){let h=l.inputIndexStart,f=l.inputIndexEnd===0?void 0:l.inputIndexEnd===void 0?h+1:l.inputIndexEnd;if(l.type==="tensor")return go(t.inputNames[l.inputIndexStart],n,s,a);if(l.type==="tensors")return t.inputNames.slice(h,f).map(g=>go(g,n,s,a));let d=go(t.inputNames.slice(h)[0],n,s,a),m=d.dataSync();return l.type==="number"?m[0]:Xi(d.shape,m)}let u=t.attrParams[i];return u&&u.value}function go(i,t,n,s){let[a,l]=ll(i);if(s!=null){let h=s.getHashTableHandleByName(a);if(h!=null)return h}let u=n.currentContextIds.find(h=>!!t[yx(a,h)]);return u!==void 0?t[yx(a,u)][l]:void 0}function eh(i,t){let[n,s,a]=ll(i);return[yx(n,t&&t.currentContextId),s,a]}function yx(i,t){return t?`${i}-${t}`:i}function ll(i){let t=i.split(":");if(t.length===1)return[i,0,void 0];let n=t[0],s=t.length===3?t[1]:void 0;return[n,Number(t[t.length-1]),s]}function vx(i,t,n){let s=Te("pad",i,t,n);if(s==="explicit"){s=Te("explicitPaddings",i,t,n);let a=[[0,0],[0,0],[0,0],[0,0]];for(let l=0;l<4;l++)a[l][0]=s[2*l],a[l][1]=s[2*l+1];return a}return s}function Zh(i){return i.kept?i:Cu(i)}let D_=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],F_=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],P_=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],O_=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],B_=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],U_=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],z_=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],$_=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],V_=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],H_=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],G_=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],W_=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],j_=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],X_=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],q_=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],K_=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Y_=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Q_=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Z_=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];class s2{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let t=[].concat(...[pe,we,he,Ie,Ae,Ue,Qe,ht,lt,Et,Mt,ln,Tn,xn,Qn,Cn,Mn,Ar,_i].map(n=>n.json));this.opMappers=t.reduce((n,s)=>(n[s.tfOpName]=s,n),{})}transformGraph(t,n={}){let s=t.node,a=[],l=[],u=[],h=s.reduce((F,H)=>(F[H.name]=this.mapNode(H),H.op.startsWith("Placeholder")?a.push(F[H.name]):H.op==="Const"?l.push(F[H.name]):H.input!=null&&H.input.length!==0||u.push(F[H.name]),F),{}),f=[],d=[],m={},g={};n!=null&&(m=this.mapSignatureEntries(n.inputs),g=this.mapSignatureEntries(n.outputs));let x=Object.keys(h);x.forEach(F=>{let H=h[F];H.inputNames.forEach((W,G)=>{let[se,,ge]=eh(W),Ce=h[se];if(Ce.outputs!=null){let Be=Ce.outputs.indexOf(ge);if(Be!==-1){let Ve=`${se}:${Be}`;H.inputNames[G]=Ve}}H.inputs.push(Ce),Ce.children.push(H)})}),Object.keys(g).length===0?x.forEach(F=>{let H=h[F];H.children.length===0&&d.push(H)}):Object.keys(g).forEach(F=>{let[H]=eh(F),W=h[H];W!=null&&(W.signatureKey=g[F],d.push(W))}),Object.keys(m).length>0?Object.keys(m).forEach(F=>{let[H]=eh(F),W=h[H];W&&(W.signatureKey=m[F],f.push(W))}):f=a;let R={};t.library!=null&&t.library.function!=null&&(R=t.library.function.reduce((F,H)=>(F[H.signature.name]=this.mapFunction(H),F),{}));let N={nodes:h,inputs:f,outputs:d,weights:l,placeholders:a,signature:n,functions:R};return u.length>0&&(N.initNodes=u),N}mapSignatureEntries(t){return Object.keys(t||{}).reduce((n,s)=>(n[t[s].name]=s,n),{})}mapNode(t){let n=i2(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});let s={name:t.name,op:t.op,category:n.category,inputNames:(t.input||[]).map(a=>a.startsWith("^")?a.substr(1):a),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((a,l)=>(a[l.name]={type:l.type,inputIndexStart:l.start,inputIndexEnd:l.end},a),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((a,l)=>{let u=l.type,h;switch(l.type){case"string":h=wA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=wA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"string[]":h=IA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=IA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"number":h=EA(t.attr,l.tfName,l.defaultValue||0),h===void 0&&l.tfDeprecatedName&&(h=EA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"number[]":h=CA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=CA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"bool":h=AA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=AA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"bool[]":h=RA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=RA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"shape":h=_A(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=_A(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"shape[]":h=kA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=kA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"dtype":h=TA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=TA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"dtype[]":h=MA(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=MA(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"func":h=o2(t.attr,l.tfName,l.defaultValue),h===void 0&&l.tfDeprecatedName&&(h=o2(t.attr,l.tfDeprecatedName,l.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${l.type} for op: ${t.op}`)}return a[l.name]={value:h,type:u},a},{})),s}mapFunction(t){let n=t.nodeDef,s=[],a={};n!=null&&(a=n.reduce((d,m)=>(d[m.name]=this.mapNode(m),m.op==="Const"&&s.push(d[m.name]),d),{}));let l=[],u=[];t.signature.inputArg.forEach(d=>{let[m]=eh(d.name),g={name:m,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:SA(d.type),type:"dtype"}},children:[]};g.signatureKey=d.name,l.push(g),a[m]=g}),Object.keys(a).forEach(d=>{let m=a[d];m.inputNames.forEach((g,x)=>{let[R,,N]=eh(g),F=a[R];if(F.outputs!=null){let H=F.outputs.indexOf(N);if(H!==-1){let W=`${R}:${H}`;m.inputNames[x]=W}}m.inputs.push(F),F.children.push(m)})});let h=t.ret;t.signature.outputArg.forEach(d=>{let[m,g]=eh(h[d.name]),x=a[m];x!=null&&(x.defaultOutput=g,u.push(x))});let f=this.mapArgsToSignature(t);return{nodes:a,inputs:l,outputs:u,weights:s,placeholders:[],signature:f}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:t.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,t.ret),n),{})}}mapArgToTensorInfo(t,n){let s=t.name;return n!=null&&(s=n[s]),{name:s,dtype:t.type}}}function a2(i,t){let n=Array.isArray(i)?String.fromCharCode.apply(null,i):function(s){let a=Ge().global;if(a.atob!==void 0)return a.atob(s);if(typeof Buffer<"u")return new Buffer(s,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(i);return t?n:n.toLowerCase()}function wA(i,t,n,s=!1){let a=i[t];return a!=null?a2(a.s,s):n}function AA(i,t,n){let s=i[t];return s?s.b:n}function EA(i,t,n){let s=i[t]||{},a=s.i!=null?s.i:s.f!=null?s.f:n;return typeof a=="number"?a:parseInt(a,10)}function SA(i){switch(typeof i=="string"&&(i=mu[i]),i){case mu.DT_FLOAT:case mu.DT_HALF:return"float32";case mu.DT_INT32:case mu.DT_INT64:case mu.DT_INT8:case mu.DT_UINT8:return"int32";case mu.DT_BOOL:return"bool";case mu.DT_DOUBLE:return"float32";case mu.DT_STRING:return"string";default:return null}}function o2(i,t,n){let s=i[t];return s&&s.func?s.func.name:n}function TA(i,t,n){let s=i[t];return s&&s.type?SA(s.type):n}function MA(i,t,n){let s=i[t];return s&&s.list&&s.list.type?s.list.type.map(a=>SA(a)):n}function l2(i){if(!i.unknownRank)return i.dim!=null?i.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function _A(i,t,n){let s=i[t];return s&&s.shape?l2(s.shape):n}function CA(i,t,n){let s=i[t];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(a=>typeof a=="number"?a:parseInt(a,10)):n}function IA(i,t,n,s=!1){let a=i[t];return a&&a.list&&a.list.s?a.list.s.map(l=>a2(l,s)):n}function kA(i,t,n){let s=i[t];return s&&s.list&&s.list.shape?s.list.shape.map(a=>l2(a)):n}function RA(i,t,n){let s=i[t];return s&&s.list&&s.list.b?s.list.b:n}class J_{constructor(t,n,s){this.node=t,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(a=>this.getInput(a)),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce((a,l)=>(a[l]=this.getAttr(l),a),{}))}getInput(t){return go(t,this.tensorMap,this.context)}getAttr(t,n){let s=this.node.rawAttrs[t];if(s.tensor!=null)return go(t,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return EA(this.node.rawAttrs,t,n);if(s.s!=null)return wA(this.node.rawAttrs,t,n);if(s.b!=null)return AA(this.node.rawAttrs,t,n);if(s.shape!=null)return _A(this.node.rawAttrs,t,n);if(s.type!=null)return TA(this.node.rawAttrs,t,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return CA(this.node.rawAttrs,t,n);if(s.list.s!=null)return IA(this.node.rawAttrs,t,n);if(s.list.shape!=null)return kA(this.node.rawAttrs,t,n);if(s.list.b!=null)return RA(this.node.rawAttrs,t,n);if(s.list.type!=null)return MA(this.node.rawAttrs,t,n)}return n}}function gu(i,t,n=""){if(typeof i!="number"&&typeof t!="number"){ee(i.length===t.length,()=>n+` Shapes ${i} and ${t} must match`);for(let s=0;s<i.length;s++){let a=i[s],l=t[s];ee(a<0||l<0||a===l,()=>n+` Shapes ${i} and ${t} must match`)}}}function u2(i){return typeof i!="number"&&!i.some(t=>t<0)}function Wy(i,t,n){let s=NA(i,n),a=!u2(s);if(a&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(a&&t.forEach(l=>{s=NA(l.shape,s)}),!u2(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function NA(i,t){if(typeof i=="number")return t;if(typeof t=="number")return i;if(i.length!==t.length)throw new Error(`Incompatible ranks during merge: ${i} vs. ${t}`);let n=[];for(let s=0;s<i.length;++s){let a=i[s],l=t[s];if(a>=0&&l>=0&&a!==l)throw new Error(`Incompatible shape during merge: ${i} vs. ${t}`);n[s]=a>=0?a:l}return n}class eC{constructor(t,n,s,a,l,u,h){this.name=t,this.dtype=n,this.maxSize=s,this.elementShape=a,this.identicalElementShapes=l,this.dynamicSize=u,this.clearAfterRead=h,this.tensors=[],this.closed_=!1,this.idTensor=Jn(0),wa(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach(n=>{t!=null&&t.has(n.tensor.id)||n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);let n=this.tensors[t];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(t){return t.map(n=>this.read(n))}write(t,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);let s=this.tensors[t]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=n.shape),gu(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);s.tensor=n,wa(n),s.written=!0,this.tensors[t]=s}writeMany(t,n){if(t.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${n.length}.`);t.forEach((s,a)=>this.write(s,n[a]))}gather(t,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(t)t=t.slice(0,this.size());else{t=[];for(let a=0;a<this.size();a++)t.push(a)}if(t.length===0)return Xo([],[0].concat(this.elementShape));let s=this.readMany(t);return gu(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Qa(s,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(this.size()===0)return Xo([],[0].concat(this.elementShape));let n=[];for(let a=0;a<this.size();a++)n.push(a);let s=this.readMany(n);return gu(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Ti(s,0)}scatter(t,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(t.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${n.shape[0]}`);let s=Math.max(...t);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(t,ts(n,0))}split(t,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0,a=t.map(f=>(s+=f,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);let l=s===0?0:n.size/s,u=[];bt(()=>{n=pt(n,[1,s,l]);for(let f=0;f<t.length;++f){let d=[0,f===0?0:a[f-1],0],m=[1,t[f],l];u[f]=pt(hi(n,d,m),this.elementShape)}return u});let h=[];for(let f=0;f<t.length;f++)h[f]=f;this.writeMany(h,u)}}class Tg{constructor(t,n,s,a=-1){this.tensors=t,this.elementShape=n,this.elementDtype=s,t?.forEach(l=>{if(s!==l.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${l.dtype}`);gu(n,l.shape,"TensorList shape mismatch: "),wa(l)}),this.idTensor=Jn(0),this.maxNumElements=a,wa(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Tg([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(n=>{t!=null&&t.has(n.id)||n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);gu(t,this.elementShape,"TensorList shape mismatch: ");let a=Wy(this.elementShape,this.tensors,t);return bt(()=>{let l=this.tensors.map(u=>pt(u,a));return Qa(l,0)})}popBack(t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let s=Wy(this.elementShape,this.tensors,t),a=this.tensors.pop();return gu(a.shape,t,"TensorList shape mismatch: "),pt(a,s)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(gu(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");wa(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);this.tensors.length=t}getItem(t,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);gu(this.tensors[t].shape,n,"TensorList shape mismatch: ");let a=Wy(this.elementShape,this.tensors,n);return pt(this.tensors[t],a)}setItem(t,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);gu(this.elementShape,n.shape,"TensorList shape mismatch: "),wa(n),this.tensors[t]=n}gather(t,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);gu(this.elementShape,s,"TensorList shape mismatch: "),t=t.slice(0,this.size());let a=Wy(this.elementShape,this.tensors,s);return t.length===0?Xo([],[0].concat(a)):bt(()=>{let l=t.map(u=>pt(this.tensors[u],a));return Qa(l,0)})}concat(t,n){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);gu(this.elementShape,n,"TensorList shape mismatch: ");let s=Wy(this.elementShape,this.tensors,n);return this.size()===0?Xo([],[0].concat(s)):bt(()=>{let a=this.tensors.map(l=>pt(l,s));return Ti(a,0)})}}function c2(i,t,n){let[s,a]=Te("fusedOps",i,t,n),l=s==="biasadd",u=!l,h=a==="prelu",f=s==="fusedbatchnorm",d=Te("numArgs",i,t,n);if(l){if(h&&d!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!h&&l&&d!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(f)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let m=Te("strides",i,t,n),g=vx(i,t,n),x=Te("dataFormat",i,t,n).toUpperCase(),R=Te("dilations",i,t,n),[N,F]=Te("args",i,t,n);return u&&(F=N,N=void 0),{stride:m,pad:g,dataFormat:x,dilations:R,biasArg:N,preluArg:F,activationFunc:a,leakyreluAlpha:Te("leakyreluAlpha",i,t,n)}}function LA(i,t,n){return{boxes:Te("boxes",i,t,n),scores:Te("scores",i,t,n),maxOutputSize:Te("maxOutputSize",i,t,n),iouThreshold:Te("iouThreshold",i,t,n),scoreThreshold:Te("scoreThreshold",i,t,n),softNmsSigma:Te("softNmsSigma",i,t,n)}}class tC{constructor(t,n){this.keyDType=t,this.valueDType=n,this.handle=Jn(0),this.tensorMap=new Map,wa(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(t=>t.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Jn(this.size(),"int32")}async import(t,n){this.checkKeyAndValueTensor(t,n);let s=await t.data();return this.tensorMap.forEach(a=>a.dispose()),this.tensorMap.clear(),bt(()=>{let a=ts(n),l=s.length,u=a.length;ee(l===u,()=>`The number of elements doesn't match, keys has ${l} elements, the values has ${u} elements.`);for(let h=0;h<l;h++){let f=s[h],d=a[h];wa(d),this.tensorMap.set(f,d)}return this.handle})}async find(t,n){this.checkKeyAndValueTensor(t,n);let s=await t.data();return bt(()=>{let a=[];for(let l=0;l<s.length;l++){let u=s[l],h=this.findWithDefault(u,n);a.push(h)}return Qa(a)})}findWithDefault(t,n){let s=this.tensorMap.get(t);return s??n}checkKeyAndValueTensor(t,n){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}function h2(i,t,n,s){let a=((l,u,h)=>{switch(l.category){case"arithmetic":return bt(()=>((d,m,g)=>{switch(d.op){case"BiasAdd":case"AddV2":case"Add":return[fn(Te("a",d,m,g),Te("b",d,m,g))];case"AddN":return[qp(Te("tensors",d,m,g))];case"FloorMod":case"Mod":return[U0(Te("a",d,m,g),Te("b",d,m,g))];case"Mul":return[qe(Te("a",d,m,g),Te("b",d,m,g))];case"RealDiv":case"Div":return[yn(Te("a",d,m,g),Te("b",d,m,g))];case"DivNoNan":return[I0(Te("a",d,m,g),Te("b",d,m,g))];case"FloorDiv":return[m0(Te("a",d,m,g),Te("b",d,m,g))];case"Sub":return[Un(Te("a",d,m,g),Te("b",d,m,g))];case"Minimum":return[Ud(Te("a",d,m,g),Te("b",d,m,g))];case"Maximum":return[Tl(Te("a",d,m,g),Te("b",d,m,g))];case"Pow":return[Sl(Te("a",d,m,g),Te("b",d,m,g))];case"SquaredDifference":return[hf(Te("a",d,m,g),Te("b",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"basic_math":return bt(()=>((d,m,g)=>{switch(d.op){case"Abs":case"ComplexAbs":return[_s(Te("x",d,m,g))];case"Acos":return[g0(Te("x",d,m,g))];case"Acosh":return[vm(Te("x",d,m,g))];case"Asin":return[y0(Te("x",d,m,g))];case"Asinh":return[v0(Te("x",d,m,g))];case"Atan":return[b0(Te("x",d,m,g))];case"Atan2":return[x0(Te("x",d,m,g),Te("y",d,m,g))];case"Atanh":return[w0(Te("x",d,m,g))];case"Ceil":return[S0(Te("x",d,m,g))];case"Complex":return[Jl(Te("real",d,m,g),Te("imag",d,m,g))];case"Cos":return[Qp(Te("x",d,m,g))];case"Cosh":return[Em(Te("x",d,m,g))];case"Elu":return[Pd(Te("x",d,m,g))];case"Erf":return[k0(Te("x",d,m,g))];case"Exp":return[ao(Te("x",d,m,g))];case"Expm1":return[R0(Te("x",d,m,g))];case"Floor":return[Ac(Te("x",d,m,g))];case"Log":return[lo(Te("x",d,m,g))];case"Log1p":return[Fu(Te("x",d,m,g))];case"Imag":return[Zp(Te("x",d,m,g))];case"Neg":return[ps(Te("x",d,m,g))];case"Reciprocal":return[Nh(Te("x",d,m,g))];case"Real":return[Pu(Te("x",d,m,g))];case"Relu":return[po(Te("x",d,m,g))];case"Round":return[Ou(Te("x",d,m,g))];case"Selu":return[Uu(Te("x",d,m,g))];case"Sigmoid":return[ds(Te("x",d,m,g))];case"Sin":return[Ic(Te("x",d,m,g))];case"Sign":return[Hd(Te("x",d,m,g))];case"Sinh":return[Dh(Te("x",d,m,g))];case"Softplus":return[Tc(Te("x",d,m,g))];case"Sqrt":return[rs(Te("x",d,m,g))];case"Square":return[es(Te("x",d,m,g))];case"Tanh":return[kh(Te("x",d,m,g))];case"Tan":return[$u(Te("x",d,m,g))];case"ClipByValue":return[Xa(Te("x",d,m,g),Te("clipValueMin",d,m,g),Te("clipValueMax",d,m,g))];case"Relu6":return[su(Te("x",d,m,g))];case"Rsqrt":return[Bu(go(d.inputNames[0],m,g))];case"Prod":return[Im(Te("x",d,m,g),Te("axes",d,m,g))];case"LeakyRelu":return[Od(Te("x",d,m,g),Te("alpha",d,m,g))];case"Prelu":return[zd(Te("x",d,m,g),Te("alpha",d,m,g))];case"IsNan":return[N0(go(d.inputNames[0],m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"control":return(async(d,m,g)=>{switch(d.op){case"If":case"StatelessIf":{let x=Te("thenBranch",d,m,g),R=Te("elseBranch",d,m,g),N=Te("cond",d,m,g),F=Te("args",d,m,g);return(await N.data())[0]?g.functionMap[x].executeFunctionAsync(F,g.tensorArrayMap,g.tensorListMap):g.functionMap[R].executeFunctionAsync(F,g.tensorArrayMap,g.tensorListMap)}case"While":case"StatelessWhile":{let x=Te("body",d,m,g),R=Te("cond",d,m,g),N=Te("args",d,m,g),F=await g.functionMap[R].executeFunctionAsync(N,g.tensorArrayMap,g.tensorListMap),H=N.map(se=>se.id),W=await F[0].data();F.forEach(se=>{se.kept||H.indexOf(se.id)!==-1||se.dispose()});let G=N;for(;W[0];){let se=G;G=await g.functionMap[x].executeFunctionAsync(G,g.tensorArrayMap,g.tensorListMap);let ge=G.map(Be=>Be.id);se.forEach(Be=>{Be.kept||H.indexOf(Be.id)!==-1||ge.indexOf(Be.id)!==-1||Be.dispose()});let Ce=await g.functionMap[R].executeFunctionAsync(G,g.tensorArrayMap,g.tensorListMap);W=await Ce[0].data(),Ce.forEach(Be=>{Be.kept||H.indexOf(Be.id)!==-1||ge.indexOf(Be.id)!==-1||Be.dispose()})}return G}case"LoopCond":return[Zh(Te("pred",d,m,g))];case"Switch":{let x=Te("pred",d,m,g),R=Te("data",d,m,g);return R.kept||(R=Zh(R)),(await x.data())[0]?[void 0,R]:[R,void 0]}case"Merge":{let x=d.inputNames.find(R=>go(R,m,g)!==void 0);return x?[Zh(go(x,m,g))]:void 0}case"Enter":{let x=Te("frameName",d,m,g),R=Te("tensor",d,m,g);return g.enterFrame(x),[Zh(R)]}case"Exit":{let x=Te("tensor",d,m,g);return g.exitFrame(),[Zh(x)]}case"NextIteration":{let x=Te("tensor",d,m,g);return g.nextIteration(),[Zh(x)]}case"TensorArrayV3":{let x=Te("size",d,m,g),R=Te("dtype",d,m,g),N=Te("elementShape",d,m,g),F=Te("dynamicSize",d,m,g),H=Te("clearAfterRead",d,m,g),W=Te("identicalElementShapes",d,m,g),G=Te("name",d,m,g),se=new eC(G,R,x,N,W,F,H);return g.addTensorArray(se),[se.idTensor,Jn(1)]}case"TensorArrayWriteV3":{let x=Te("tensorArrayId",d,m,g),R=Te("index",d,m,g),N=Te("tensor",d,m,g),F=g.getTensorArray(x.id);return F.write(R,N),[F.idTensor]}case"TensorArrayReadV3":{let x=Te("tensorArrayId",d,m,g),R=Te("index",d,m,g);return[g.getTensorArray(x.id).read(R)]}case"TensorArrayGatherV3":{let x=Te("tensorArrayId",d,m,g),R=Te("indices",d,m,g),N=Te("dtype",d,m,g);return[g.getTensorArray(x.id).gather(R,N)]}case"TensorArrayScatterV3":{let x=Te("tensorArrayId",d,m,g),R=Te("indices",d,m,g),N=Te("tensor",d,m,g),F=g.getTensorArray(x.id);return F.scatter(R,N),[F.idTensor]}case"TensorArrayConcatV3":{let x=Te("tensorArrayId",d,m,g),R=g.getTensorArray(x.id),N=Te("dtype",d,m,g);return[R.concat(N)]}case"TensorArraySplitV3":{let x=Te("tensorArrayId",d,m,g),R=Te("tensor",d,m,g),N=Te("lengths",d,m,g),F=g.getTensorArray(x.id);return F.split(N,R),[F.idTensor]}case"TensorArraySizeV3":{let x=Te("tensorArrayId",d,m,g);return[Jn(g.getTensorArray(x.id).size(),"int32")]}case"TensorArrayCloseV3":{let x=Te("tensorArrayId",d,m,g),R=g.getTensorArray(x.id);return R.clearAndClose(),[R.idTensor]}case"TensorListSetItem":{let x=Te("tensorListId",d,m,g),R=Te("index",d,m,g),N=Te("tensor",d,m,g),F=g.getTensorList(x.id);return F.setItem(R,N),[F.idTensor]}case"TensorListGetItem":{let x=Te("tensorListId",d,m,g),R=Te("index",d,m,g),N=Te("elementShape",d,m,g),F=Te("elementDType",d,m,g);return[g.getTensorList(x.id).getItem(R,N,F)]}case"TensorListScatterV2":case"TensorListScatter":{let x=Te("indices",d,m,g),R=function(N,F,H,W){if(F.length!==N.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${F.length} vs. ${N.shape[0]}`);let G=Math.max(...F);if(W!=null&&W!==-1&&G>=W)throw new Error(`Max index must be < array size (${G}  vs. ${W})`);let se=new Tg([],H,N.dtype,W),ge=ts(N,0);return F.forEach((Ce,Be)=>{se.setItem(Ce,ge[Be])}),se}(Te("tensor",d,m,g),x,Te("elementShape",d,m,g),Te("numElements",d,m,g));return g.addTensorList(R),[R.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let x=Te("elementShape",d,m,g),R=Te("elementDType",d,m,g),N;N=d.op==="TensorListReserve"?"numElements":"maxNumElements";let F=function(H,W,G){return new Tg([],H,W,G)}(x,R,Te(N,d,m,g));return g.addTensorList(F),[F.idTensor]}case"TensorListGather":{let x=Te("tensorListId",d,m,g),R=Te("indices",d,m,g),N=Te("elementShape",d,m,g),F=Te("elementDType",d,m,g);return[g.getTensorList(x.id).gather(R,F,N)]}case"TensorListStack":{let x=Te("tensorListId",d,m,g),R=Te("elementShape",d,m,g),N=Te("elementDType",d,m,g),F=Te("numElements",d,m,g);return[g.getTensorList(x.id).stack(R,N,F)]}case"TensorListFromTensor":{let x=function(R,N,F){let H=R.dtype;if(R.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${R.shape}`);if(R.dtype!==F)throw new Error(`Invalid data types; op elements ${R.dtype}, but list elements ${F}`);gu(R.shape.slice(1),N,"TensorList shape mismatch: ");let W=ts(R);return new Tg(W,N,H)}(Te("tensor",d,m,g),Te("elementShape",d,m,g),Te("elementDType",d,m,g));return g.addTensorList(x),[x.idTensor]}case"TensorListConcat":{let x=Te("tensorListId",d,m,g),R=g.getTensorList(x.id),N=Te("dtype",d,m,g),F=Te("elementShape",d,m,g);return[R.concat(N,F)]}case"TensorListPushBack":{let x=Te("tensorListId",d,m,g),R=Te("tensor",d,m,g),N=g.getTensorList(x.id);return N.pushBack(R),[N.idTensor]}case"TensorListPopBack":{let x=Te("tensorListId",d,m,g),R=Te("elementShape",d,m,g),N=Te("elementDType",d,m,g);return[g.getTensorList(x.id).popBack(R,N)]}case"TensorListSplit":{let x=Te("tensor",d,m,g),R=Te("elementShape",d,m,g),N=function(F,H,W){let G=0,se=H.map(ze=>(G+=ze,G));if(G!==F.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${G}, and tensor's shape is: ${F.shape}`);let ge=NA(F.shape.slice(1),W),Ce=G===0?0:F.size/G,Be=bt(()=>{let ze=[];F=pt(F,[1,G,Ce]);for(let Xe=0;Xe<H.length;++Xe){let tt=[0,Xe===0?0:se[Xe-1],0],ot=[1,H[Xe],Ce];ze[Xe]=pt(hi(F,tt,ot),ge)}return F.dispose(),ze}),Ve=new Tg([],W,F.dtype,H.length);for(let ze=0;ze<Be.length;ze++)Ve.setItem(ze,Be[ze]);return Ve}(x,Te("lengths",d,m,g),R);return g.addTensorList(N),[N.idTensor]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h);case"convolution":return bt(()=>((d,m,g)=>{switch(d.op){case"Conv1D":{let x=Te("stride",d,m,g),R=Te("pad",d,m,g),N=Te("dataFormat",d,m,g).toUpperCase(),F=Te("dilation",d,m,g);return[wm(Te("x",d,m,g),Te("filter",d,m,g),x,R,N,F)]}case"Conv2D":{let x=Te("strides",d,m,g),R=vx(d,m,g),N=Te("dataFormat",d,m,g).toUpperCase(),F=Te("dilations",d,m,g);return[Du(Te("x",d,m,g),Te("filter",d,m,g),[x[1],x[2]],R,N,[F[1],F[2]])]}case"_FusedConv2D":{let{stride:x,pad:R,dataFormat:N,dilations:F,biasArg:H,preluArg:W,activationFunc:G,leakyreluAlpha:se}=c2(d,m,g);return[bf({x:Te("x",d,m,g),filter:Te("filter",d,m,g),strides:[x[1],x[2]],pad:R,dataFormat:N,dilations:[F[1],F[2]],bias:H,activation:G,preluActivationWeights:W,leakyreluAlpha:se})]}case"FusedDepthwiseConv2dNative":{let{stride:x,pad:R,dataFormat:N,dilations:F,biasArg:H,preluArg:W,activationFunc:G,leakyreluAlpha:se}=c2(d,m,g);return[Vu({x:Te("x",d,m,g),filter:Te("filter",d,m,g),strides:[x[1],x[2]],pad:R,dataFormat:N,dilations:[F[1],F[2]],bias:H,activation:G,preluActivationWeights:W,leakyreluAlpha:se})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let x=Te("outputShape",d,m,g),R=Te("strides",d,m,g),N=vx(d,m,g);return[Am(Te("x",d,m,g),Te("filter",d,m,g),x,[R[1],R[2]],N)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let x=Te("strides",d,m,g),R=vx(d,m,g),N=Te("dilations",d,m,g),F=Te("dataFormat",d,m,g).toUpperCase();return[Fd(Te("input",d,m,g),Te("filter",d,m,g),[x[1],x[2]],R,F,[N[1],N[2]])]}case"Conv3D":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("dataFormat",d,m,g).toUpperCase(),F=Te("dilations",d,m,g);return[M0(Te("x",d,m,g),Te("filter",d,m,g),[x[1],x[2],x[3]],R,N,[F[1],F[2],F[3]])]}case"AvgPool":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("kernelSize",d,m,g);return[Nd(Te("x",d,m,g),[N[1],N[2]],[x[1],x[2]],R)]}case"MaxPool":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("kernelSize",d,m,g);return[ef(Te("x",d,m,g),[N[1],N[2]],[x[1],x[2]],R)]}case"MaxPoolWithArgmax":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("kernelSize",d,m,g),F=Te("includeBatchInIndex",d,m,g),{result:H,indexes:W}=ob(Te("x",d,m,g),[N[1],N[2]],[x[1],x[2]],R,F);return[H,W]}case"AvgPool3D":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("kernelSize",d,m,g);return[wc(Te("x",d,m,g),[N[1],N[2],N[3]],[x[1],x[2],x[3]],R)]}case"MaxPool3D":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("kernelSize",d,m,g);return[O0(Te("x",d,m,g),[N[1],N[2],N[3]],[x[1],x[2],x[3]],R)]}case"Dilation2D":{let x=Te("strides",d,m,g),R=Te("pad",d,m,g),N=Te("dilations",d,m,g),F=x[1],H=x[2],W=N[1],G=N[2];return[C0(Te("x",d,m,g),Te("filter",d,m,g),[F,H],R,[W,G],"NHWC")]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"creation":return bt(()=>((d,m,g)=>{switch(d.op){case"Fill":{let x=Te("shape",d,m,g),R=Te("dtype",d,m,g);return[Ch(x,Te("value",d,m,g),R)]}case"LinSpace":return[ib(Te("start",d,m,g),Te("stop",d,m,g),Te("num",d,m,g))];case"Multinomial":{let x=Te("logits",d,m,g),R=Te("numSamples",d,m,g),N=Te("seed",d,m,g);return[rf(x,R,N)]}case"OneHot":{let x=Te("indices",d,m,g),R=Te("depth",d,m,g),N=Te("onValue",d,m,g),F=Te("offValue",d,m,g);return[Md(x,R,N,F)]}case"Ones":return[co(Te("shape",d,m,g),Te("dtype",d,m,g))];case"OnesLike":return[ho(Te("x",d,m,g))];case"RandomUniform":return[Gi(Te("shape",d,m,g),Te("minval",d,m,g),Te("maxval",d,m,g),Te("dtype",d,m,g))];case"Range":return[Rh(Te("start",d,m,g),Te("stop",d,m,g),Te("step",d,m,g),Te("dtype",d,m,g))];case"TruncatedNormal":{let x=Te("shape",d,m,g),R=Te("mean",d,m,g),N=Te("stdDev",d,m,g),F=Te("seed",d,m,g);return[Bh(x,R,N,Te("dtype",d,m,g),F)]}case"Zeros":return[js(Te("shape",d,m,g),Te("dtype",d,m,g))];case"ZerosLike":return[wi(Te("x",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"dynamic":return(async(d,m,g)=>{switch(d.op){case"NonMaxSuppressionV5":{let{boxes:x,scores:R,maxOutputSize:N,iouThreshold:F,scoreThreshold:H,softNmsSigma:W}=LA(d,m,g),G=await Jo.nonMaxSuppressionWithScoreAsync(x,R,N,F,H,W);return[G.selectedIndices,G.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:x,scores:R,maxOutputSize:N,iouThreshold:F,scoreThreshold:H}=LA(d,m,g),W=Te("padToMaxOutputSize",d,m,g),G=await Jo.nonMaxSuppressionPaddedAsync(x,R,N,F,H,W);return[G.selectedIndices,G.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:x,scores:R,maxOutputSize:N,iouThreshold:F,scoreThreshold:H}=LA(d,m,g);return[await Jo.nonMaxSuppressionAsync(x,R,N,F,H)]}case"Where":{let x=En(Te("condition",d,m,g),"bool"),R=[await Dm(x)];return x.dispose(),R}case"ListDiff":return $0(Te("x",d,m,g),Te("y",d,m,g));default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h);case"evaluation":return bt(()=>((d,m,g)=>{switch(d.op){case"TopKV2":{let x=Te("x",d,m,g),R=Te("k",d,m,g),N=Te("sorted",d,m,g),F=Lm(x,R,N);return[F.values,F.indices]}case"Unique":{let x=Te("x",d,m,g),R=Lc(x);return[R.values,R.indices]}case"UniqueV2":{let x=Te("x",d,m,g),R=Te("axis",d,m,g),N=Lc(x,R);return[N.values,N.indices]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"image":return bt(()=>((d,m,g)=>{switch(d.op){case"ResizeBilinear":{let x=Te("images",d,m,g),R=Te("size",d,m,g),N=Te("alignCorners",d,m,g),F=Te("halfPixelCenters",d,m,g);return[Jo.resizeBilinear(x,[R[0],R[1]],N,F)]}case"ResizeNearestNeighbor":{let x=Te("images",d,m,g),R=Te("size",d,m,g),N=Te("alignCorners",d,m,g),F=Te("halfPixelCenters",d,m,g);return[Jo.resizeNearestNeighbor(x,[R[0],R[1]],N,F)]}case"CropAndResize":{let x=Te("image",d,m,g),R=Te("boxes",d,m,g),N=Te("boxInd",d,m,g),F=Te("cropSize",d,m,g),H=Te("method",d,m,g),W=Te("extrapolationValue",d,m,g);return[Jo.cropAndResize(x,R,N,F,H,W)]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"graph":return bt(()=>((d,m,g)=>{switch(d.op){case"Const":return m[d.name];case"PlaceholderWithDefault":let x=Te("default",d,m,g);return[go(d.name,m,g)||x];case"Placeholder":return[go(d.name,m,g)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[Zh(Te("x",d,m,g))];case"IdentityN":return Te("x",d,m,g).map(W=>Zh(W));case"Snapshot":return[Zh(Te("x",d,m,g))];case"Shape":return[ga(Te("x",d,m,g).shape,"int32")];case"ShapeN":return Te("x",d,m,g).map(W=>ga(W.shape));case"Size":return[Jn(Te("x",d,m,g).size,"int32")];case"Rank":return[Jn(Te("x",d,m,g).rank,"int32")];case"NoOp":return[Jn(1)];case"Print":let R=Te("x",d,m,g),N=Te("data",d,m,g),F=Te("message",d,m,g),H=Te("summarize",d,m,g);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(F);for(let W=0;W<N.length;W++)console.log(Array.prototype.slice.call(N[W].dataSync()).slice(0,H));return[R];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"logical":return bt(()=>((d,m,g)=>{switch(d.op){case"Equal":return[so(Te("a",d,m,g),Te("b",d,m,g))];case"NotEqual":return[ru(Te("a",d,m,g),Te("b",d,m,g))];case"Greater":return[Ka(Te("a",d,m,g),Te("b",d,m,g))];case"GreaterEqual":return[Ya(Te("a",d,m,g),Te("b",d,m,g))];case"Less":return[Mm(Te("a",d,m,g),Te("b",d,m,g))];case"LessEqual":return[Sc(Te("a",d,m,g),Te("b",d,m,g))];case"LogicalAnd":return[Yo(Te("a",d,m,g),Te("b",d,m,g))];case"LogicalNot":return[Jp(Te("a",d,m,g))];case"LogicalOr":return[Cm(Te("a",d,m,g),Te("b",d,m,g))];case"Select":case"SelectV2":return[Ia(Te("condition",d,m,g),Te("a",d,m,g),Te("b",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"matrices":return bt(()=>((d,m,g)=>{switch(d.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[oi(Te("a",d,m,g),Te("b",d,m,g),Te("transposeA",d,m,g),Te("transposeB",d,m,g))];case"Einsum":return[tb(Te("equation",d,m,g),...Te("tensors",d,m,g))];case"Transpose":return[xi(Te("x",d,m,g),Te("perm",d,m,g))];case"_FusedMatMul":let[x,R]=Te("fusedOps",d,m,g),N=x==="biasadd",F=R==="prelu",H=Te("numArgs",d,m,g),W=Te("leakyreluAlpha",d,m,g);if(N){if(F&&H!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!F&&H!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[G,se]=Te("args",d,m,g);return[Hu({a:Te("a",d,m,g),b:Te("b",d,m,g),transposeA:Te("transposeA",d,m,g),transposeB:Te("transposeB",d,m,g),bias:G,activation:R,preluActivationWeights:se,leakyreluAlpha:W})];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"normalization":return bt(()=>((d,m,g)=>{switch(d.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Ld(Te("x",d,m,g),Te("mean",d,m,g),Te("variance",d,m,g),Te("offset",d,m,g),Te("scale",d,m,g),Te("epsilon",d,m,g))];case"LRN":return[L0(Te("x",d,m,g),Te("radius",d,m,g),Te("bias",d,m,g),Te("alpha",d,m,g),Te("beta",d,m,g))];case"Softmax":return[Rc(Te("x",d,m,g))];case"LogSoftmax":return[_m(Te("x",d,m,g))];case"SparseToDense":return[Ba(Te("sparseIndices",d,m,g),Te("outputShape",d,m,g),Te("sparseValues",d,m,g),Te("defaultValue",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"reduction":return bt(()=>((d,m,g)=>{switch(d.op){case"Max":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[uo(Te("x",d,m,g),F,H)]}case"Mean":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[ws(Te("x",d,m,g),F,H)]}case"Min":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[tf(Te("x",d,m,g),F,H)]}case"Sum":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[Yn(Te("x",d,m,g),F,H)]}case"All":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[bm(Te("x",d,m,g),F,H)]}case"Any":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[kd(Te("x",d,m,g),F,H)]}case"ArgMax":{let F=Te("axis",d,m,g);return[yc(Te("x",d,m,g),F)]}case"ArgMin":{let F=Te("axis",d,m,g);return[Kp(Te("x",d,m,g),F)]}case"Prod":{let F=Te("axis",d,m,g),H=Te("keepDims",d,m,g);return[Im(Te("x",d,m,g),F,H)]}case"Cumsum":{let F=Te("axis",d,m,g),H=Te("exclusive",d,m,g),W=Te("reverse",d,m,g);return[Sm(Te("x",d,m,g),F,H,W)]}case"Bincount":let x=Te("x",d,m,g),R=Te("weights",d,m,g),N=Te("size",d,m,g);return[E0(x,R,N)];case"DenseBincount":{let F=Te("x",d,m,g),H=Te("weights",d,m,g),W=Te("size",d,m,g),G=Te("binaryOutput",d,m,g);return[Jv(F,H,W,G)]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"slice_join":return bt(()=>((d,m,g)=>{switch(d.op){case"ConcatV2":case"Concat":{let x=Te("n",d,m,g),R=Te("axis",d,m,g),N=Te("tensors",d,m,g);return N=N.slice(0,x),[Ti(N,R)]}case"Gather":{let x=Te("x",d,m,g),R=Te("indices",d,m,g);return[Ec(x,En(R,"int32"),0)]}case"GatherV2":{let x=Te("axis",d,m,g),R=Te("batchDims",d,m,g),N=Te("x",d,m,g),F=Te("indices",d,m,g);return[Ec(N,En(F,"int32"),x,R)]}case"Reverse":{let x=Te("dims",d,m,g),R=[];for(let F=0;F<x.length;F++)x[F]&&R.push(F);let N=Te("x",d,m,g);return[Pi(N,R)]}case"ReverseV2":{let x=Te("axis",d,m,g),R=Te("x",d,m,g);return[Pi(R,x)]}case"Slice":{let x=Te("begin",d,m,g),R=Te("size",d,m,g);return[hi(Te("x",d,m,g),x,R)]}case"StridedSlice":{let x=Te("begin",d,m,g),R=Te("end",d,m,g),N=Te("strides",d,m,g),F=Te("beginMask",d,m,g),H=Te("endMask",d,m,g),W=Te("ellipsisMask",d,m,g),G=Te("newAxisMask",d,m,g),se=Te("shrinkAxisMask",d,m,g),ge=Te("x",d,m,g);return[Wd(ge,x,R,N,F,H,W,G,se)]}case"Pack":return bt(()=>{let x=Te("axis",d,m,g),R=Te("tensors",d,m,g),N=R[0].shape,F=au(R[0]).shape,H=R.map(W=>{let G=Ye(W.shape,N);if(!G&&!Ye(au(W).shape,F))throw new Error("the input tensors shape does not match");return G?W:pt(W,N)});return[Qa(H,x)]});case"Unpack":{let x=Te("axis",d,m,g),R=Te("tensor",d,m,g);return ts(R,x)}case"Tile":{let x=Te("reps",d,m,g);return[oo(Te("x",d,m,g),x)]}case"Split":case"SplitV":{let x=Te("axis",d,m,g),R=Te("numOrSizeSplits",d,m,g),N=Te("x",d,m,g);return Oa(N,R,x)}case"ScatterNd":{let x=Te("indices",d,m,g),R=Te("values",d,m,g),N=Te("shape",d,m,g);return[G0(x,R,N)]}case"GatherNd":{let x=Te("x",d,m,g),R=Te("indices",d,m,g);return[Fm(x,R)]}case"SparseToDense":{let x=Te("sparseIndices",d,m,g),R=Te("outputShape",d,m,g),N=Te("sparseValues",d,m,g),F=Te("defaultValue",d,m,g);return[Ba(x,N,R,N.dtype===F.dtype?F:En(F,N.dtype))]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"sparse":return bt(()=>((d,m,g)=>{switch(d.op){case"SparseFillEmptyRows":{let{outputIndices:x,outputValues:R,emptyRowIndicator:N,reverseIndexMap:F}=_f.sparseFillEmptyRows(Te("indices",d,m,g),Te("values",d,m,g),Te("denseShape",d,m,g),Te("defaultValue",d,m,g));return[x,R,N,F]}case"SparseReshape":{let{outputIndices:x,outputShape:R}=_f.sparseReshape(Te("inputIndices",d,m,g),Te("inputShape",d,m,g),Te("newShape",d,m,g));return[x,R]}case"SparseSegmentMean":return[_f.sparseSegmentMean(Te("data",d,m,g),Te("indices",d,m,g),Te("segmentIds",d,m,g))];case"SparseSegmentSum":return[_f.sparseSegmentSum(Te("data",d,m,g),Te("indices",d,m,g),Te("segmentIds",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"spectral":return bt(()=>((d,m,g)=>{switch(d.op){case"FFT":return[Nc(Te("x",d,m,g))];case"IFFT":return[Fh(Te("x",d,m,g))];case"RFFT":return[Gd(Te("x",d,m,g))];case"IRFFT":return[cf(Te("x",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"string":return bt(()=>((d,m,g)=>{switch(d.op){case"StringNGrams":{let{nGrams:x,nGramsSplits:R}=Yd.stringNGrams(Te("data",d,m,g),Te("dataSplits",d,m,g),Te("separator",d,m,g),Te("nGramWidths",d,m,g),Te("leftPad",d,m,g),Te("rightPad",d,m,g),Te("padWidth",d,m,g),Te("preserveShortSequences",d,m,g));return[x,R]}case"StringSplit":{let{indices:x,values:R,shape:N}=Yd.stringSplit(Te("input",d,m,g),Te("delimiter",d,m,g),Te("skipEmpty",d,m,g));return[x,R,N]}case"StringToHashBucketFast":return[Yd.stringToHashBucketFast(Te("input",d,m,g),Te("numBuckets",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"transformation":return bt(()=>((d,m,g)=>{switch(d.op){case"Cast":return[En(Te("x",d,m,g),Te("dtype",d,m,g))];case"ExpandDims":{let x=Te("axis",d,m,g);return[qa(Te("x",d,m,g),x)]}case"Squeeze":{let x=Te("axis",d,m,g);return[au(Te("x",d,m,g),x)]}case"Reshape":return[pt(Te("x",d,m,g),Te("shape",d,m,g))];case"MirrorPad":return[B0(Te("x",d,m,g),Te("padding",d,m,g),Te("mode",d,m,g))];case"PadV2":case"Pad":return[iu(Te("x",d,m,g),Te("padding",d,m,g),Te("constantValue",d,m,g))];case"SpaceToBatchND":{let x=Te("blockShape",d,m,g),R=Te("paddings",d,m,g);return[_c(Te("x",d,m,g),x,R)]}case"BatchToSpaceND":{let x=Te("blockShape",d,m,g),R=Te("crops",d,m,g);return[Yp(Te("x",d,m,g),x,R)]}case"DepthToSpace":{let x=Te("blockSize",d,m,g),R=Te("dataFormat",d,m,g).toUpperCase();return[_0(Te("x",d,m,g),x,R)]}case"BroadcastTo":return[Dd(Te("x",d,m,g),Te("shape",d,m,g))];case"BroadcastArgs":return[jv(Te("s0",d,m,g),Te("s1",d,m,g))];default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h));case"hash_table":return(async(d,m,g,x)=>{switch(d.op){case"HashTable":case"HashTableV2":{let R=Te("keyDType",d,m,g),N=Te("valueDType",d,m,g),F=new tC(R,N);return x.addHashTable(d.name,F),[F.handle]}case"LookupTableImport":case"LookupTableImportV2":{let R=Te("tableHandle",d,m,g,x),N=Te("keys",d,m,g),F=Te("values",d,m,g);return[await x.getHashTableById(R.id).import(N,F)]}case"LookupTableFind":case"LookupTableFindV2":{let R=Te("tableHandle",d,m,g,x),N=Te("keys",d,m,g),F=Te("defaultValue",d,m,g);return[await x.getHashTableById(R.id).find(N,F)]}case"LookupTableSize":case"LookupTableSizeV2":{let R=Te("tableHandle",d,m,g,x);return[x.getHashTableById(R.id).tensorSize()]}default:throw TypeError(`Node type ${d.op} is not implemented`)}})(l,u,h,s);case"custom":let f=i2(l.op);if(f&&f.customExecutor)return f.customExecutor(new J_(l,u,h));throw TypeError(`Custom op ${l.op} is not registered.`);default:throw TypeError(`Unknown op '${l.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(i,t,n);return et(a)?a.then(l=>[].concat(l)):[].concat(a)}class d2{constructor(t={},n={},s={},a={}){this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,n){return{id:t,frameName:n,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let t=[];for(let n=0;n<this.contexts.length-1;n++){let s=this.contexts.slice(0,this.contexts.length-n);t.push(this.contextIdforContexts(s))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;let t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(let n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(t);for(let n in this.tensorListMap)this.tensorListMap[n].clearAndClose(t)}}function p2(i,t,n,s){let a=new Set,l=[],u=null,h=null,f=new Set,d=Object.keys(i).map(x=>ll(x)[0]),m=[];s!=null&&(m=s.map(x=>ll(x.name)[0]));let g=[...t];for(;g.length>0;){let x=g.pop();(f2(x)||sC(x)||aC(x))&&u==null&&(u=x,h=u.children.map(R=>R.name).filter(R=>a.has(R))),a.add(x.name),n[x.name]==null&&d.indexOf(x.name)===-1&&m.indexOf(x.name)===-1&&(x.inputs.length!==0?x.inputs.forEach(R=>{f.has(R.name)||(f.add(R.name),g.push(R))}):l.push(x.name))}return{inputs:i,outputs:t,usedNodes:a,missingInputs:l,dynamicNode:u,syncInputs:h}}let nC=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],rC=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],iC=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function f2(i){return nC.indexOf(i.op)>=0}function sC(i){return rC.indexOf(i.op)>=0}function aC(i){return iC.indexOf(i.op)>=0}class bx{constructor(t,n){this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(s=>{this._functionExecutorMap[s]=new bx(t.functions[s],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let n=Object.keys(t).map(s=>t[s].map(a=>a.id));this._weightIds=[].concat(...n),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let n=t.signatureKey||t.name;return t.defaultOutput?`${n}:${t.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((t,n)=>(t[n]=this._functions[n].signature,t),{})}getCompilationKey(t,n){let s=t.map(l=>l.name).sort(),a=n.map(l=>l.name).sort();return s.join(this.SEPERATOR)+"--"+a.join(this.SEPERATOR)}compile(t,n){let s=p2(t,n,this.weightMap,this._initNodes),{missingInputs:a,dynamicNode:l,syncInputs:u}=s;if(l!=null)throw new Error(`This execution contains the node '${l.name}', which has the dynamic op '${l.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${u}]`);if(a.length>0){let h=n.map(d=>d.name),f=Object.keys(t);throw new Error(`Cannot compute the outputs [${h}] from the provided inputs [${f}]. Missing the following inputs: [${a}]`)}return function(h,f,d){let{usedNodes:m,inputs:g}=d,x=[],R=Object.keys(g).map(W=>ll(W)[0]).map(W=>h.nodes[W]),N=h.initNodes;R.forEach(W=>{m.has(W.name)&&x.push(W)}),h.weights.forEach(W=>{m.has(W.name)&&x.push(W)}),N?.forEach(W=>{m.has(W.name)&&x.push(W)});let F=new Set,H=[];for(;x.length>0;){let W=x.pop();F.add(W.name),f[W.name]||H.push(W),W.children.forEach(G=>{!F.has(G.name)&&m.has(G.name)&&G.inputs.every(se=>F.has(se.name))&&x.push(G)})}return H}(this.graph,this.weightMap,s)}execute(t,n){t=this.mapInputs(t);let s=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n);let a=s.map(g=>this.graph.nodes[ll(g)[0]]),l=n.map(g=>ll(g)[0]),u=l.map(g=>this.graph.nodes[g]);this.resetIntermediateTensors(),u.length===0&&(u=this._outputs);let h=this.getCompilationKey(a,u),f=this.compiledMap.get(h);f==null&&(f=this.compile(t,u),this.compiledMap.set(h,f));let d={},m={};return bt(()=>{let g=new d2(this.weightMap,d,m,this.functionExecutorMap),x=Object.assign({},this.weightMap);Object.keys(t).forEach(F=>{let[H,W]=ll(F),G=[];G[W]=t[F],x[H]=G});let R=this.getFrozenTensorIds(x),N={};for(let F=0;F<f.length;F++){let H=f[F];if(!x[H.name]){let W=h2(H,x,g,this._resourceManager);if(et(W))throw new Error(`The execution of the op '${H.op}' returned a promise. Please use model.executeAsync() instead.`);x[H.name]=W,this.checkTensorForDisposal(H.name,H,x,g,R,l,N)}}return this.parent==null&&g.dispose(R),n.map(F=>go(F,x,g))})}getFrozenTensorIds(t){let n=[].concat.apply([],Object.keys(t).map(s=>t[s]).map(s=>s.map(a=>a.id)));return new Set(n)}checkTensorForDisposal(t,n,s,a,l,u,h){n.category!=="control"&&u.indexOf(t)===-1&&(s[t].forEach(f=>{f!=null&&(h[f.id]=(h[f.id]||0)+n.children.length)}),n.inputs.forEach(f=>{if(f.category!=="control"){let d=function(m,g,x){return g[yx(m,x.currentContextId)]}(f.name,s,a);d?.forEach(m=>{if(m&&!m.kept&&!l.has(m.id)){let g=h[m.id];if(g===1){if(this.keepTensorForDebug){let[x,R]=eh(n.name,a);this.intermediateTensors[x]||(this.intermediateTensors[x]=[]),this.intermediateTensors[x][R]=m}else m.dispose();delete h[m.id]}else g!=null&&h[m.id]--}})}}))}async executeAsync(t,n){return this._executeAsync(t,n)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach(t=>this.intermediateTensors[t].forEach(n=>n.dispose())),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach(t=>{this.tensorsMap[t].forEach(n=>{!n||n.kept||n.isDisposed||this.keepIds.has(n.id)||n.dispose()})})}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(let t in this.intermediateTensors)this.intermediateTensors[t].forEach(n=>n.dispose()),delete this.intermediateTensors[t]}async _executeAsync(t,n,s=!1,a={},l={}){s||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=Ge().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(m){console.warn(m.message)}this.resetIntermediateTensors();let u=new d2(this.weightMap,a,l,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,u,n,s);let h=n.map(m=>go(m,this.tensorsMap,u)),f=h.map(m=>m.id),d=Object.keys(t).map(m=>t[m].id);return this.keepIds=new Set([...f,...d,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&u.dispose(this.keepIds),h}async executeFunctionAsync(t,n,s){let a=t.reduce((l,u,h)=>(l[this.inputs[h].name]=u,l),{});return this._executeAsync(a,this.outputNodes,!0,n,s)}async executeWithControlFlow(t,n,s,a){let l=Object.keys(t),u=l.map(se=>this.graph.nodes[ll(se)[0]]),h=s.map(se=>ll(se)[0]),f=h.map(se=>this.graph.nodes[se]);f.length===0&&(f=this._outputs);let{usedNodes:d,missingInputs:m,dynamicNode:g,syncInputs:x}=p2(t,f,this.weightMap,this._initNodes),R=[...u,...this.graph.weights,...this._initNodes||[]].map(se=>({node:se,contexts:n.currentContext})),N=Object.assign({},this.weightMap);Object.keys(t).forEach(se=>{let[ge,Ce]=ll(se),Be=[];Be[Ce]=t[se],N[ge]=Be});let F={},H=this.getFrozenTensorIds(N),W={};for(;R.length>0;){let se=this.processStack(u,R,n,N,W,H,h,F,d);await Promise.all(se)}g!=null||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let G=f.filter(se=>!f2(se)&&!go(se.name,N,n)).map(se=>se.name);if(G.length>0){let se="";throw g!=null&&(se=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${x}]`),new Error(`Cannot compute the outputs [${G}] from the provided inputs [${l}]. Consider providing the following inputs: [${m}]. ${se}`)}return N}processStack(t,n,s,a,l,u,h,f,d){let m=[];for(;n.length>0;){let g=n.pop();s.currentContext=g.contexts;let x="";if(g.node.op==="Enter"&&Te("isConstant",g.node,a,s)&&([x]=eh(g.node.name,s)),a[g.node.name]==null){let R=h2(g.node,a,s,this._resourceManager);x||([x]=eh(g.node.name,s));let N=s.currentContext;et(R)?m.push(R.then(F=>(a[x]=F,s.currentContext=N,this.checkTensorForDisposal(x,g.node,a,s,u,h,f),this.processChildNodes(g.node,n,s,a,l,d),F))):(a[x]=R,this.checkTensorForDisposal(x,g.node,a,s,u,h,f),this.processChildNodes(g.node,n,s,a,l,d))}else this.processChildNodes(g.node,n,s,a,l,d)}return m}processChildNodes(t,n,s,a,l,u){t.children.forEach(h=>{let[f]=eh(h.name,s);!l[f]&&u.has(h.name)&&(h.op==="Merge"?h.inputNames.some(d=>!!go(d,a,s))&&(l[f]=!0,n.push({contexts:s.currentContext,node:h})):h.inputNames.every(d=>!!go(d,a,s))&&(l[f]=!0,n.push({contexts:s.currentContext,node:h})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(n=>n.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(n=>{let s=t[n],[a]=ll(n),l=this.graph.nodes[a];if(l.attrParams.shape&&l.attrParams.shape.value){let u=l.attrParams.shape.value;ee(u.length===s.shape.length&&s.shape.every((h,f)=>u[f]===-1||u[f]===h),()=>`The shape of dict['${l.name}'] provided in model.execute(dict) must be [${u}], but was [${s.shape}]`)}l.attrParams.dtype&&l.attrParams.dtype.value&&ee(s.dtype===l.attrParams.dtype.value,()=>`The dtype of dict['${l.name}'] provided in model.execute(dict) must be ${l.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(t){let n={};for(let s in t)this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[s]!=null?n[this._signature.inputs[s].name]=t[s]:n[s]=t[s];return n}checkInputs(t){let n=Object.keys(t).filter(s=>{let[a]=ll(s);return this.graph.nodes[a]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(t){return t.map(n=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[n]!=null?this._signature.outputs[n].name:n,{})}checkOutputs(t){t.forEach(n=>{let[s]=ll(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class oC{constructor(t={},n={}){this.hashTableNameToHandle=t,this.hashTableMap=n}addHashTable(t,n){this.hashTableNameToHandle[t]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(let t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(let t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}class m2{constructor(t,n={}){this.modelUrl=t,this.loadOptions=n,this.version="n/a",n==null&&(this.loadOptions={}),this.resourceManager=new oC}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){let t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=mm(t,this.loadOptions);else{let n=Zg(t,this.loadOptions);if(n.length===0)n.push(mm(t,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[t]}'`);this.handler=n[0]}}async load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let t=await this.handler.load();return this.loadSync(t)}loadSync(t){this.artifacts=t;let n=this.artifacts.modelTopology,s;s=this.artifacts.userDefinedMetadata!=null&&this.artifacts.userDefinedMetadata.signature!=null?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=s,this.version=`${n.versions.producer}.${n.versions.minConsumer}`;let a=xh(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new bx(s2.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,t.modelInitializer!=null&&t.modelInitializer.node!=null){let l=s2.Instance.transformGraph(t.modelInitializer);this.initializer=new bx(l),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,n){if(typeof t=="string"){let s=Qg(t);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${t}'`);t=s[0]}if(t.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,n){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof Ni||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce((n,s,a)=>(n[s]=t[a],n),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,n){t=this.normalizeInputs(t),n=this.normalizeOutputs(n);let s=this.executor.execute(t,n);return s.length>1?s:s[0]}async executeAsync(t,n){t=this.normalizeInputs(t),n=this.normalizeOutputs(n);let s=await this.executor.executeAsync(t,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((n,s)=>(n[s]=[t[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function lC(i,t={}){if(i==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&i.load==null&&(i.endsWith("/")||(i+="/"),i=`${i}model.json?tfjs-format=file`);let n=new m2(i,t);return await n.load(),n}let g2="3.13.0";function xx(i,t,n=new Map,s=new Set){if(i==null)return null;if(typeof Blob=="function"&&i instanceof Blob)return i.slice();if(s.has(i))throw new Error("Circular references are not supported.");if(n.has(i))return n.get(i);let a=t(i);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(Mg(i)){let l=Array.isArray(i)?[]:{};s.add(i);for(let u in i){let h=xx(i[u],t,n,s);l[u]=h}return s.delete(i),i.__proto__&&(l.__proto__=i.__proto__),l}throw new Error(`Can't recurse into non-iterable type: ${i}`)}return n.set(i,a.value),a.value}function uC(i,t=v2){return y2(i,t)}function y2(i,t,n=new Set){let s=i[0];if(n.has(s))throw new Error("Circular references are not supported.");let a=t(i);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(Mg(s)){let l=Array.isArray(s)?[]:{};n.add(s);for(let u in s){let h=y2(i.map(f=>f[u]),t,n);l[u]=h}return n.delete(s),l}throw new Error(`Can't recurse into non-iterable type: ${s}`)}return a.value}function v2(i){return i===null?null:Mg(i[0])?{value:null,recurse:!0}:{value:i,recurse:!1}}async function b2(i,t){let n=new Map;xx(i,t,n);for(let s of Array.from(n.keys())){let a=n.get(s);if(et(a)){let l=await a;n.set(s,l)}}return xx(i,t,n)}function Mg(i){let t=!1;if(Ge().get("IS_BROWSER"))t=i instanceof TextDecoder;else{let{StringDecoder:n}=ae(4589);t=i instanceof n}return i!=null&&!ArrayBuffer.isView(i)&&(Array.isArray(i)||typeof i=="object"&&!(i instanceof Ni)&&!(i instanceof Promise)&&!t)}function cC(i){return i instanceof Ni?{value:i.clone(),recurse:!1}:Mg(i)?{value:null,recurse:!0}:{value:i,recurse:!1}}class x2{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,t==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,n){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=n}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(let n of t)this.push(n)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let n=this.wrap(this.begin+t),s=this.get(n);return this.set(n,this.pop()),s}}class wx extends x2{constructor(){super(wx.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){let t=2*this.capacity,n=new Array(t),s=this.length();for(let a=0;a<s;a++)n[a]=this.get(this.wrap(this.begin+a));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}function w2(i){return new hC(i)}function DA(i){return new dC(i)}wx.INITIAL_CAPACITY=32;class Na{async toArray(){let t=[],n=await this.next();for(;!n.done;)t.push(n.value),n=await this.next();return t}async toArrayForTest(){let t=this.prefetch(100),n=[],s=await t.next();for(;!s.done;)n.push(s.value),s=await t.next();return n}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let n=await this.next(),s=t(n.value);for(;!n.done&&s;)n=await this.next(),s=t(n.value)}handleErrors(t){return new bC(this,t)}filter(t){return new yC(this,t)}map(t){return new vC(this,t)}mapAsync(t){return new A2(this,t)}serialMapAsync(t){return new A2(this,t).serial()}flatmap(t){return new xC(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile(n=>n===!0)}rowMajorBatch(t,n=!0){return new gC(this,t,n)}columnMajorBatch(t,n=!0,s=v2){return this.rowMajorBatch(t,n).map(a=>uC(a,s))}concatenate(t,n){return new E2(w2([this,t]),n)}take(t){return t<0||t==null?this:new mC(this,t)}skip(t){return t<0||t==null?this:new fC(this,t)}prefetch(t){return new S2(this,t)}shuffle(t,n){return new AC(this,t,n)}serial(){return new pC(this)}}class hC extends Na{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let t=this.items[this.trav];return this.trav++,{value:(n=t,function(s,a){return xx(s,a)}(n,cC)),done:!1};var n}}class dC extends Na{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class pC extends Na{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class fC extends Na{constructor(t,n){super(),this.upstream=t,this.maxCount=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let t=await this.upstream.next();if(t.done)return t;ni(t.value)}return this.upstream.next()}}class mC extends Na{constructor(t,n){super(),this.upstream=t,this.maxCount=n,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class gC extends Na{constructor(t,n,s=!0){super(),this.upstream=t,this.batchSize=n,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let t=[];for(;t.length<this.batchSize;){let n=await this.upstream.next();if(n.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(n.value)}return{value:t,done:!1}}}class yC extends Na{constructor(t,n){super(),this.upstream=t,this.predicate=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;ni(t.value)}}}class vC extends Na{constructor(t,n){super(),this.upstream=t,this.transform=n}summary(){return`${this.upstream.summary()} -> Map`}async next(){let t=await this.upstream.next();if(t.done)return{value:null,done:!0};let n=jo(t.value),s=this.transform(t.value),a=jo(s);for(let l of n)yh(l,a)||l.dispose();return{value:s,done:!1}}}class bC extends Na{constructor(t,n){super(),this.upstream=t,this.handler=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class A2 extends Na{constructor(t,n){super(),this.upstream=t,this.transform=n}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let t=await this.upstream.next();if(t.done)return{value:null,done:!0};let n=jo(t.value),s=await this.transform(t.value),a=jo(s);for(let l of n)yh(l,a)||l.dispose();return{value:s,done:!1}}}class FA extends Na{constructor(){super(),this.outputQueue=new wx,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class xC extends FA{constructor(t,n){super(),this.upstream=t,this.transform=n}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let t=await this.upstream.next();if(t.done)return!1;let n=jo(t.value),s=this.transform(t.value),a=jo(s);this.outputQueue.pushAll(s);for(let l of n)yh(l,a)||l.dispose();return!0}}class E2 extends Na{constructor(t,n){super(),this.baseErrorHandler=n,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,this.iterator==null){let s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let n=await this.iterator.next();return n.done?(this.iterator=null,this.readFromChain(t)):n}}var dp;(function(i){i[i.FAIL=0]="FAIL",i[i.SHORTEST=1]="SHORTEST",i[i.LONGEST=2]="LONGEST"})(dp||(dp={}));class wC extends Na{constructor(t,n=dp.FAIL){super(),this.iterators=t,this.mismatchMode=n,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(t){await t;let n=0,s=0,a=await b2(this.iterators,function(l){return l instanceof Na?{value:l.next().then(u=>(n++,u.done&&s++,u.value)),recurse:!1}:{value:null,recurse:!0}});if(n===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case dp.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case dp.SHORTEST:return{value:null,done:!0};case dp.LONGEST:}return this.count++,{value:a,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class S2 extends Na{constructor(t,n){super(),this.upstream=t,this.bufferSize=n,this.buffer=new x2(n)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class AC extends S2{constructor(t,n,s){super(t,n),this.upstream=t,this.windowSize=n,this.upstreamExhausted=!1,this.random=$d.alea(s||ha().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let t=this.chooseIndex(),n=await this.buffer.shuffleExcise(t);if(!n.done)return this.refill(),n;this.upstreamExhausted=!0}return{value:null,done:!0}}}class _g{constructor(){this.size=null}batch(t,n=!0){let s=this,a;return ee(t>0,()=>`batchSize needs to be positive, but it is
      ${t}`),a=this.size===1/0||this.size==null?this.size:n?Math.ceil(this.size/t):Math.floor(this.size/t),ul(async()=>(await s.iterator()).columnMajorBatch(t,n,TC),a)}concatenate(t){let n=this,s;return s=this.size===1/0||t.size===1/0?1/0:this.size!=null&&t.size!=null?this.size+t.size:null,ul(async()=>(await n.iterator()).concatenate(await t.iterator()),s)}filter(t){let n=this,s;return s=this.size===1/0?1/0:null,ul(async()=>(await n.iterator()).filter(a=>bt(()=>t(a))),s)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){let n=this;return ul(async()=>(await n.iterator()).map(s=>bt(()=>t(s))),this.size)}mapAsync(t){let n=this;return ul(async()=>(await n.iterator()).mapAsync(t),this.size)}prefetch(t){if(t==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let n=this;return ul(async()=>(await n.iterator()).prefetch(t),this.size)}repeat(t){let n=this,s;return s=this.size!=null&&t>0?this.size*t:t===0?0:this.size!=null&&(t===void 0||t<0)?1/0:null,ul(async()=>{return a=DA(async()=>({value:await n.iterator(),done:!1})).take(t),new E2(a,l);var a,l},s)}skip(t){let n=this,s;return s=this.size!=null&&t>=0&&this.size>=t?this.size-t:this.size!=null&&(this.size<t||t===void 0||t<0)?0:null,ul(async()=>(await n.iterator()).skip(t),s)}shuffle(t,n,s=!0){if(t==null||t<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let a=this,l=$d.alea(n||ha().toString());return ul(async()=>{let u=l.int32();return s&&(u+=l.int32()),(await a.iterator()).shuffle(t,u.toString())},this.size)}take(t){let n=this,s;return s=this.size!=null&&this.size>t?t:this.size!=null&&this.size<=t?this.size:null,ul(async()=>(await n.iterator()).take(t),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function ul(i,t=null){return new class extends _g{constructor(){super(...arguments),this.size=t}async iterator(){return i()}}}function EC(i){return ul(async()=>w2(i),i.length)}function SC(i){if(!Mg(i))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(i))for(let n=0;n<i.length;n++)t=t==null?i[n].size:Math.min(t,i[n].size);else if(i instanceof Object)for(let n in i)t=t==null?i[n].size:Math.min(t,i[n].size);return ul(async()=>function(n,s=dp.FAIL){return new wC(n,s)}(await b2(i,n=>{if(n instanceof _g)return{value:n.iterator(),recurse:!1};if(Mg(n))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}),dp.SHORTEST),t)}function TC(i){if(i===null)return null;return(t=i[0])==null||(n=t)===null||typeof n!="object"&&typeof n!="function"||Array.isArray(t)||typeof t=="object"&&t instanceof Ni||ir(t)?{value:function(s){if(s.length===0)throw new Error("Can't make a batch of zero elements.");return s[0]instanceof Ni?Qa(s):Xo(s)}(i),recurse:!1}:{value:null,recurse:!0};var t,n}_g.MAX_BUFFER_SIZE=1e4;class T2 extends _g{constructor(t){super(),this.input=t}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(t=>(t.endsWith("\r")&&(t=t.slice(0,-1)),t))}}let Ax='"',jy=Symbol("out"),M2=Symbol("field"),Ex=Symbol("quote"),PA=Symbol("quoteafterquote"),_2=Symbol("quoteinquote");class C2 extends _g{constructor(t,n){super(),this.input=t,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new T2(t),n||(n={}),this.hasHeader=n.hasHeader!==!1,this.fullColumnNames=n.columnNames,this.columnConfigs=n.columnConfigs,this.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(ee(n.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=n.delimiter?n.delimiter:","}async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){let t=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&t&&ee(t.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=t);let n=this.fullColumnNames.reduce((a,l)=>(a[l]=a[l]+1||1,a),{}),s=Object.keys(n).filter(a=>n[a]>1);if(ee(s.length===0,()=>"Duplicate column names found: "+s.toString()),this.columnConfigs){for(let a of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(a)===-1)throw new Error('The key "'+a+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){let t=await this.base.iterator(),n=await t.next();if(n.done)throw new Error("No data was found for CSV parsing.");let s=n.value;return this.parseRow(s,!1)}return null}async iterator(){this.columnNamesValidated||await this.setColumnNames();let t=await this.base.iterator();return this.hasHeader&&(t=t.skip(1)),t.map(n=>this.makeDataElement(n))}makeDataElement(t){let n=this.parseRow(t),s={},a={};for(let l=0;l<this.fullColumnNames.length;l++){let u=this.fullColumnNames[l],h=this.columnConfigs?this.columnConfigs[u]:null;if(!this.configuredColumnsOnly||h){let f=n[l],d=null;if(f==="")if(h&&h.default!==void 0)d=h.default;else{if(h&&(h.required||h.isLabel))throw new Error(`Required column ${u} is empty in this line: ${t}`);d=void 0}else{let m=Number(f);if(isNaN(m))d=h&&h.dtype==="bool"?this.getBoolean(f):f;else if(h&&h.dtype)switch(h.dtype){case"float32":d=m;break;case"int32":d=Math.floor(m);break;case"bool":d=this.getBoolean(f);break;default:d=m}else d=m}h&&h.isLabel?a[u]=d:s[u]=d}}return Object.keys(a).length===0?s:{xs:s,ys:a}}getBoolean(t){return t==="1"||t.toLowerCase()==="true"?1:0}parseRow(t,n=!0){let s=[],a=0,l=t.length,u=jy;for(let h=0;h<l;h++)switch(u){case jy:switch(t.charAt(h)){case Ax:a=h+1,u=Ex;break;case this.delimiter:if(a=h+1,this.delimiter===" "&&this.delimWhitespace)break;s.push(""),u=jy;break;default:u=M2,a=h}break;case M2:switch(t.charAt(h)){case this.delimiter:s.push(t.substring(a,h)),u=jy,a=h+1}break;case Ex:switch(t.charAt(h)){case Ax:u=PA}break;case PA:switch(t.charAt(h)){case this.delimiter:s.push(t.substring(a,h-1)),u=jy,a=h+1;break;case Ax:u=Ex;break;default:u=_2}break;case _2:switch(t.charAt(h)){case Ax:u=Ex}}if(u===PA?s.push(t.substring(a,l-1)):s.push(t.substring(a)),n&&s.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${s}`);return s}}class OA extends Na{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;let n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=t.includeSpectrogram!==!1,this.includeWaveform=t.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(t={}){if(Ge().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");let n=new OA(t);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})}catch(s){throw new Error(`Error thrown while initializing video stream: ${s.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");let t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`)}else this.sampleRateHz=this.audioContext.sampleRate;let n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let t,n,s=await this.getAudioData();if(this.includeSpectrogram){let a=this.flattenQueue(s.freqDataQueue);t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){let a=this.flattenQueue(s.timeDataQueue);n=this.getTensorFromAudioDataArray(a,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){let t=[],n=[],s=0;return new Promise(a=>{let l=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&a({freqDataQueue:t,timeDataQueue:n}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++s===this.numFrames&&(clearInterval(l),a({freqDataQueue:t,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){let n=t[0].length,s=new Float32Array(t.length*n);return t.forEach((a,l)=>s.set(a,l*n)),s}getTensorFromAudioDataArray(t,n){let s=new Float32Array(me(n));return s.set(t,s.length-t.length),Xo(s,n)}}class BA extends Na{constructor(t,n){if(super(),this.webcamVideoElement=t,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=ga([0],"int32"),this.webcamConfig.centerCrop){let s=1*this.webcamConfig.resizeWidth/this.webcamVideoElement.width,a=1*this.webcamConfig.resizeHeight/this.webcamVideoElement.height,l=(1-s)/2,u=(1-a)/2,h=l+s,f=a+u;this.cropBox=Ph([u,l,f,h],[1,4])}else this.cropBox=Ph([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(t,n={}){if(Ge().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}let s=new BA(t,n);return await s.start(),s}async start(){this.webcamConfig.facingMode&&ee(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message=`Error thrown while initializing video stream: ${t.message}`,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}})}async next(){if(this.isClosed)return{value:null,done:!0};let t;try{t=Iv(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(!this.resize)return{value:t,done:!1};try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{t.dispose()}}needToResize(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}cropAndResizeFrame(t){return bt(()=>{let n=qa(En(t,"float32"),0),s;s=Jo.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");let a=s.shape;return pt(s,a.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class I2{}class k2 extends Na{split(t){return new MC(this,t)}}class MC extends k2{constructor(t,n){super(),this.upstream=t,this.impl=new _C(t,n)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class _C extends FA{constructor(t,n){super(),this.upstream=t,this.separator=n,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){let t=await this.upstream.next();if(t.done)return this.carryover!==""&&(this.outputQueue.push(this.carryover),this.carryover="",!0);let n=t.value.split(this.separator);n[0]=this.carryover+n[0];for(let s of n.slice(0,-1))this.outputQueue.push(s);return this.carryover=n[n.length-1],!0}}class CC extends Na{decodeUTF8(){return new IC(this)}}class IC extends k2{constructor(t){super(),this.upstream=t,this.impl=new kC(t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class kC extends FA{constructor(t){if(super(),this.upstream=t,Ge().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{let{StringDecoder:n}=ae(4589);this.decoder=new n("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){let t=await this.upstream.next(),n,s;return!t.done&&(n=t.value,s=Ge().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(s),!0)}}class R2 extends CC{constructor(t,n={}){super(),this.file=t,this.options=n,ee(t instanceof Uint8Array||!!Ge().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=n.offset||0,this.chunkSize=n.chunkSize||1048576}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((n,s)=>{let a=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)n(new Uint8Array(this.file.slice(this.offset,a)));else{let l=new FileReader;l.onload=h=>{let f=l.result;if(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),!(f instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));n(f)},l.onabort=h=>s(new Error("Aborted")),l.onerror=h=>s(new Error(h.type));let u=this.file.slice(this.offset,a);l.readAsArrayBuffer(u)}this.offset=a}),done:!1}}}function N2(i){return typeof i=="string"&&i.substr(0,7)==="file://"}class L2 extends I2{constructor(t,n={}){super(),this.input=t,this.options=n}async iterator(){if(N2(this.input)&&Ge().get("IS_NODE")){let t=ae(2993);this.input=t.readFileSync(this.input.substr(7))}return new R2(this.input,this.options)}}class D2 extends I2{constructor(t,n={}){super(),this.url=t,this.fileOptions=n}async iterator(){return N2(this.url)?new L2(this.url,this.fileOptions).iterator():async function(t,n={},s){let a,l;var u;typeof t=="string"?a=t:(a=t.url,l={method:(u=t).method,headers:u.headers,body:u.body,mode:u.mode,credentials:u.credentials,cache:u.cache,redirect:u.redirect,referrer:u.referrer,integrity:u.integrity});let h=await(s||jg)(a,l);if(h.ok){let f=new Uint8Array(await h.arrayBuffer());return new R2(f,n)}throw new Error(h.statusText)}(this.url,this.fileOptions)}}function RC(i,t={}){return new C2(new D2(i),t)}function NC(i){let t=DA(i);return ul(async()=>t)}function LC(i){return ul(async()=>{let t=await i();return DA(()=>t.next())})}async function DC(i,t){return BA.create(i,t)}async function FC(i){return OA.create(i)}let F2="3.13.0";function ar(i,t){Array.isArray(i)||(i=[i]),i.forEach(n=>{n!=null&&ee(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}let PC=pf;class Sx extends Di{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Qi(this,gc())}nextDataId(){return Sx.nextDataId++}write(t,n,s){this.firstUse&&(this.firstUse=!1,Ge().get("IS_NODE")&&Pa(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let a={id:this.nextDataId()};return this.data.set(a,{values:t,dtype:s,refCount:1}),a}makeTensorInfo(t,n,s){let a;if(n==="string"&&s!=null&&s.length>0&&Sr(s[0])){let l=s.map(u=>Co(u));a=this.write(l,t,n)}else a=this.write(s,t,n);return{dataId:a,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){this.data.get(t).refCount++}decRef(t){this.data.has(t)&&this.data.get(t).refCount--}move(t,n,s,a,l){this.data.set(t,{values:n,dtype:a,refCount:l})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){let{dtype:n,complexTensorInfos:s}=this.data.get(t);return n==="complex64"?Wu(this.readSync(s.real.dataId),this.readSync(s.imag.dataId)):this.data.get(t).values}bufferSync(t){let n=this.readSync(t.dataId),s=n;if(t.dtype==="string")try{s=n.map(a=>hc(a))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ci(t.shape,t.dtype,s)}makeOutput(t,n,s){let a=this.write(t,n,s);return gc().makeTensorFromDataId(a,n,s,this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;let{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){let n=ha();return t(),{kernelMs:ha()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){ar([t],"where");let n=this.readSync(t.dataId);return PC(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function is(i,t,n){return({inputs:s,attrs:a,backend:l})=>{let{x:u}=s;if(ar(u,i),u.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");let h=l,f=h.data.get(u.dataId).values,d=me(u.shape),m=n||u.dtype,g=St(m,d);for(let x=0;x<d;++x)g[x]=t(f[x],a);return h.makeTensorInfo(u.shape,m,g)}}function Cg(i,t,n){return({inputs:s,attrs:a,backend:l})=>{let{x:u}=s;if(ar(u,i),u.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");let h=l,f=h.data.get(u.dataId).values,d=n||u.dtype,m=t(f,d,a);return h.makeTensorInfo(u.shape,d,m)}}Sx.nextDataId=0,Vv("cpu",()=>new Sx,1);let P2=is(Bo,i=>i>=0?i:Math.exp(i)-1),OC={kernelName:Bo,backendName:"cpu",kernelFunc:P2};function th(i){let{inputs:t,backend:n}=i,{x:s}=t;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}let BC={kernelName:ad,backendName:"cpu",kernelFunc:th};function O2(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{alpha:l}=s;ar([a],"leakyRelu");let u=me(a.shape),h=n.data.get(a.dataId).values,f=Pr("float32",u);for(let d=0;d<h.length;d++)f[d]=h[d]<0?l*h[d]:h[d];return n.makeTensorInfo(a.shape,"float32",f)}let UC={kernelName:rc,backendName:"cpu",kernelFunc:O2};function ya(i){return(t,n,s,a,l)=>{let u=Zr(t,n),h=u.length,f=Rn(u),d=Pr(l,me(u)),m=t.length,g=n.length,x=Rn(t),R=Rn(n),N=Th(t,u),F=Th(n,u);if(N.length+F.length===0)for(let H=0;H<d.length;++H)d[H]=i(s[H%s.length],a[H%a.length]);else for(let H=0;H<d.length;++H){let W=$e(H,h,f),G=W.slice(-m);N.forEach(Be=>G[Be]=0);let se=zs(G,m,x),ge=W.slice(-g);F.forEach(Be=>ge[Be]=0);let Ce=zs(ge,g,R);d[H]=i(s[se],a[Ce])}return[d,u]}}let zC=ya((i,t)=>i<0?t*i:i);function B2(i){let{inputs:t,backend:n}=i,{x:s,alpha:a}=t;ar([s,a],"prelu");let l=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values,[h,f]=zC(s.shape,a.shape,l,u,"float32");return n.makeTensorInfo(f,"float32",h)}let $C={kernelName:$l,backendName:"cpu",kernelFunc:B2},U2=is(Si,i=>Math.max(0,i)),VC={kernelName:Si,backendName:"cpu",kernelFunc:U2},z2=is(lc,i=>Math.min(Math.max(0,i),6)),HC={kernelName:lc,backendName:"cpu",kernelFunc:z2};function pp(i){return(t,n,s)=>{let a=Pr(n,t.length);for(let l=0;l<t.length;++l)a[l]=i(t[l],s);return a}}let GC=pp(i=>1/(1+Math.exp(-i))),$2=is($o,i=>1/(1+Math.exp(-i))),WC={kernelName:$o,backendName:"cpu",kernelFunc:$2};function UA(i,t,n,s,a){if(n==="linear")return th({inputs:{x:t},backend:i});if(n==="relu")return U2({inputs:{x:t},backend:i});if(n==="elu")return P2({inputs:{x:t},backend:i});if(n==="relu6")return z2({inputs:{x:t},backend:i});if(n==="prelu")return B2({inputs:{x:t,alpha:s},backend:i});if(n==="leakyrelu")return O2({inputs:{x:t},backend:i,attrs:{alpha:a}});if(n==="sigmoid")return $2({inputs:{x:t},backend:i});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function cl(i){let{inputs:t,backend:n}=i,{real:s,imag:a}=t,l=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values,h=n.makeTensorInfo(s.shape,"complex64");return n.data.get(h.dataId).complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",l),imag:n.makeTensorInfo(a.shape,"float32",u)},h}let jC={kernelName:Pt,backendName:"cpu",kernelFunc:cl};function Tx(i,t,n="float32"){if(n==="complex64")return cl({inputs:{real:Tx(i,t,"float32"),imag:Tx(i,t,"float32")},backend:i});let s=li(me(t),n);return i.makeTensorInfo(t,n,s)}function Wf(i){let{inputs:t,backend:n}=i,{input:s}=t,a=n.data.get(s.dataId).complexTensorInfos.real,l=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,l)}let XC={kernelName:Rs,backendName:"cpu",kernelFunc:Wf};function fp(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{dtype:l}=s;if(l==="complex64"){if(a.dtype==="complex64")return th({inputs:{x:a},backend:n});let u=Tx(n,a.shape,a.dtype),h=fp({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),f=cl({inputs:{real:h,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),f}if(a.dtype==="complex64"){let u=Wf({inputs:{input:a},backend:n}),h=fp({inputs:{x:u},backend:n,attrs:{dtype:l}});return n.disposeIntermediateTensorInfo(u),h}if(!cr(a.dtype,l)){let u=th({inputs:{x:a},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:l}}if(l==="int32"){let u=n.data.get(a.dataId).values,h=Int32Array.from(u);return n.makeTensorInfo(a.shape,"int32",h)}if(l==="bool"){let u=n.data.get(a.dataId).values,h=Mu([0],a.dtype),[f,d]=ya((m,g)=>m!==g?1:0)(a.shape,[],u,h,"bool");return n.makeTensorInfo(d,"bool",f)}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${l}`)}let qC={kernelName:Yt,backendName:"cpu",kernelFunc:fp};function La(i,t,n,s){return n==null?({inputs:a,backend:l})=>{let{a:u,b:h}=a,f=l;ar([u,h],i);let d=f.data.get(u.dataId).values,m=f.data.get(h.dataId).values,g=u.dtype==="string"?Do(d):d,x=u.dtype==="string"?Do(m):m,R=s||u.dtype,[N,F]=t(u.shape,h.shape,g,x,R);return f.makeTensorInfo(F,R,N)}:({inputs:a,backend:l})=>{let{a:u,b:h}=a,f=l;if(u.dtype==="complex64"||h.dtype==="complex64"){let d=fp({inputs:{x:u},backend:f,attrs:{dtype:"complex64"}}),m=f.data.get(d.dataId),g=m.complexTensorInfos.real,x=m.complexTensorInfos.imag,R=f.data.get(g.dataId).values,N=f.data.get(x.dataId).values,F=fp({inputs:{x:h},backend:f,attrs:{dtype:"complex64"}}),H=f.data.get(F.dataId),W=H.complexTensorInfos.real,G=H.complexTensorInfos.imag,se=f.data.get(W.dataId).values,ge=f.data.get(G.dataId).values,[Ce,Be,Ve]=n(u.shape,h.shape,R,N,se,ge),ze=f.makeTensorInfo(Ve,"float32",Ce),Xe=f.makeTensorInfo(Ve,"float32",Be),tt=cl({inputs:{real:ze,imag:Xe},backend:f});return f.disposeIntermediateTensorInfo(d),f.disposeIntermediateTensorInfo(F),f.disposeIntermediateTensorInfo(ze),f.disposeIntermediateTensorInfo(Xe),tt}{let d=f.data.get(u.dataId).values,m=f.data.get(h.dataId).values,g=s||u.dtype,[x,R]=t(u.shape,h.shape,d,m,g);return f.makeTensorInfo(R,g,x)}}}function zA(i){return(t,n,s,a,l,u)=>{let h=Zr(t,n),f=me(h),d=h.length,m=Rn(h),g=Pr("float32",f),x=Pr("float32",f),R=Th(t,h),N=Th(n,h),F=Wu(s,a),H=Wu(l,u),W=t.length,G=Rn(t),se=n.length,ge=Rn(n);if(R.length+N.length===0)for(let Ce=0;Ce<g.length;Ce++){let Be=Ce%F.length,Ve=Ce%H.length,ze=i(F[2*Be],F[2*Be+1],H[2*Ve],H[2*Ve+1]);g[Ce]=ze.real,x[Ce]=ze.imag}else for(let Ce=0;Ce<g.length;Ce++){let Be=$e(Ce,d,m),Ve=Be.slice(-W);R.forEach(ut=>Ve[ut]=0);let ze=zs(Ve,W,G),Xe=Be.slice(-se);N.forEach(ut=>Xe[ut]=0);let tt=zs(Xe,se,ge),ot=i(F[2*ze],F[2*ze+1],H[2*tt],H[2*tt+1]);g[Ce]=ot.real,x[Ce]=ot.imag}return[g,x,h]}}let V2=ya((i,t)=>i+t),KC=zA((i,t,n,s)=>({real:i+n,imag:t+s})),Xy=La(Tr,V2,KC),YC={kernelName:Tr,backendName:"cpu",kernelFunc:Xy};function Us(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{shape:l}=s,u=me(a.shape),h=Yr(l,u),f=me(h);ee(u===f,()=>`The new shape (${h}) has ${f} elements and the old shape (${a.shape}) has ${u} elements. The new shape and old shape must have the same number of elements.`),n.incRef(a.dataId);let d=n.data.get(a.dataId);if(d.complexTensorInfos!=null){let m=d.complexTensorInfos.real,g=d.complexTensorInfos.imag;m.shape=h,g.shape=h}return{dataId:a.dataId,shape:h,dtype:a.dtype}}let QC={kernelName:Ta,backendName:"cpu",kernelFunc:Us};function H2(i){let{inputs:t,backend:n,attrs:s}=i,{a,b:l}=t,{transposeA:u,transposeB:h}=s;ar([a,l],"matMul");let f=a.shape.length,d=l.shape.length,m=u?a.shape[f-2]:a.shape[f-1],g=h?l.shape[d-1]:l.shape[d-2],x=u?a.shape[f-1]:a.shape[f-2],R=h?l.shape[d-2]:l.shape[d-1],N=a.shape.slice(0,-2),F=l.shape.slice(0,-2),H=me(N),W=me(F),G=Zr(a.shape.slice(0,-2),l.shape.slice(0,-2)).concat([x,R]);ee(m===g,()=>`Error in matMul: inner shapes (${m}) and (${g}) of Tensors with shapes ${a.shape} and ${l.shape} and transposeA=${u} and transposeB=${h} must match.`);let se=h?[W,R,g]:[W,g,R],ge=Us({inputs:{x:a},backend:n,attrs:{shape:u?[H,m,x]:[H,x,m]}}),Ce=Us({inputs:{x:l},backend:n,attrs:{shape:se}}),Be=u?ge.shape[1]:ge.shape[2],Ve=u?ge.shape[2]:ge.shape[1],ze=h?Ce.shape[1]:Ce.shape[2],Xe=Math.max(H,W),tt=n.data.get(ge.dataId).values,ot=n.data.get(Ce.dataId).values,ut=Rn(ge.shape),ft=Rn(Ce.shape),[kt,Ut,It]=u?[ut[0],1,ut[1]]:[ut[0],ut[1],1],[Lt,zt,Gt]=h?[1,ft[1],ft[0]]:[ft[1],1,ft[0]],qt=Ve*ze,Ot=ci([Xe,Ve,ze],ge.dtype),jt=Ot.values,on=n.blockSize;for(let bn=0;bn<Xe;bn++)for(let An=0;An<Ve;An+=on)for(let Bn=0;Bn<ze;Bn+=on)for(let Pn=0;Pn<Be;Pn+=on){let mr=Math.min(An+on,Ve),_r=Math.min(Bn+on,ze),vr=Math.min(Pn+on,Be);for(let gr=An;gr<mr;gr++)for(let Wr=Bn;Wr<_r;Wr++){let pi=0;for(let Oi=Pn;Oi<vr;Oi++){let $r=Math.min(bn,H-1)*kt,qr=Math.min(bn,W-1)*Gt;pi+=tt[$r+gr*Ut+Oi*It]*ot[Oi*Lt+Wr*zt+qr]}jt[bn*qt+(gr*ze+Wr)]+=pi}}return n.disposeIntermediateTensorInfo(ge),n.disposeIntermediateTensorInfo(Ce),n.makeTensorInfo(G,Ot.dtype,Ot.values)}let ZC={kernelName:_e,backendName:"cpu",kernelFunc:H2},JC={kernelName:vd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{a,b:l,bias:u,preluActivationWeights:h}=t,{transposeA:f,transposeB:d,activation:m,leakyreluAlpha:g}=s,x,R,N,F=[];x=H2({inputs:{a,b:l},attrs:{transposeA:f,transposeB:d},backend:n}),u&&(R=Xy({inputs:{a:x,b:u},backend:n}),F.push(x),x=R),m&&(N=UA(n,x,m,h,g),F.push(x),x=N);for(let H of F)n.disposeIntermediateTensorInfo(H);return x}};function G2(i){let t=new Float32Array(i.length);for(let n=0;n<i.length;++n)t[n]=Math.abs(i[n]);return t}let eI={kernelName:Xt,backendName:"cpu",kernelFunc:i=>{let{x:t}=i.inputs,n=i.backend;ar(t,"abs");let s=new Float32Array(me(t.shape));return s=G2(n.data.get(t.dataId).values),n.makeOutput(s,t.shape,t.dtype)}},tI=is(nr,i=>Math.acos(i)),nI={kernelName:nr,backendName:"cpu",kernelFunc:tI},rI=is(yr,i=>Math.acosh(i)),iI={kernelName:yr,backendName:"cpu",kernelFunc:rI},sI={kernelName:qi,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,s=t;ar(t,"addN");let a=s.map(h=>n.data.get(h.dataId).values),l=ci(s[0].shape,s[0].dtype),u=l.values;for(let h=0;h<s.length;h++){let f=a[h];for(let d=0;d<u.length;d++)u[d]+=f[d]}return n.makeTensorInfo(l.shape,l.dtype,l.values)}};function $A(i,t,n,s,a){let l=t.length,u=me(t),h=Rn(t),f=Rn(a),d=Pr(n,me(a));for(let m=0;m<u;++m){let g=$e(m,l,h),x=new Array(g.length);for(let R=0;R<x.length;R++)x[R]=g[s[R]];d[zs(x,l,f)]=i[m]}return d}function Dl(i){let{inputs:t,attrs:n,backend:s}=i,{x:a}=t,{perm:l}=n;ar(a,"transpose");let u=a.shape.length,h=new Array(u);for(let d=0;d<h.length;d++)h[d]=a.shape[l[d]];let f=$A(s.data.get(a.dataId).values,a.shape,a.dtype,l,h);return{dataId:s.write(f,h,a.dtype),shape:h,dtype:a.dtype}}let aI={kernelName:Ho,backendName:"cpu",kernelFunc:Dl},oI={kernelName:ai,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s;ar(a,"all");let h=Zn(l,a.shape),f=h,d=Ws(f,a.shape.length),m=a;d!=null&&(m=Dl({inputs:{x:a},backend:n,attrs:{perm:d}}),f=Zs(f.length,a.shape.length)),ma("all",f,m.shape.length);let[g,x]=fa(m.shape,f),R=me(x),N=li(me(g),m.dtype),F=n.data.get(m.dataId).values;for(let W=0;W<N.length;++W){let G=W*R,se=F[G];for(let ge=0;ge<R;++ge){let Ce=F[G+ge];se=se&&Ce}N[W]=se}d!=null&&n.disposeIntermediateTensorInfo(m);let H=n.makeTensorInfo(g,m.dtype,N);if(u){let W=Us({inputs:{x:H},backend:n,attrs:{shape:Ls(g,h)}});return n.disposeIntermediateTensorInfo(H),W}return H}},lI={kernelName:Vr,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s;ar(a,"any");let h=Zn(l,a.shape),f=h,d=Ws(f,a.shape.length),m=a;d!=null&&(m=Dl({inputs:{x:a},backend:n,attrs:{perm:d}}),f=Zs(f.length,a.shape.length)),ma("any",f,m.shape.length);let[g,x]=fa(m.shape,f),R=me(x),N=li(me(g),m.dtype),F=n.data.get(m.dataId).values;for(let W=0;W<N.length;++W){let G=W*R,se=F[G];for(let ge=0;ge<R;++ge){let Ce=F[G+ge];se=se||Ce}N[W]=se}d!=null&&n.disposeIntermediateTensorInfo(m);let H=n.makeTensorInfo(g,m.dtype,N);if(u){let W=Us({inputs:{x:H},backend:n,attrs:{shape:Ls(g,h)}});return n.disposeIntermediateTensorInfo(H),W}return H}},uI={kernelName:ui,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l}=s;ar(a,"argMax");let u=Zn(l,a.shape),h=Ws(u,a.shape.length),f=a,d=[];h!=null&&(f=Dl({inputs:{x:a},backend:n,attrs:{perm:h}}),d.push(f),u=Zs(u.length,f.shape.length)),u=[u[0]],ma("argMax",u,f.shape.length);let[m,g]=fa(f.shape,u),x=li(me(m),"int32"),R=me(g),N=n.data.get(f.dataId).values;for(let F=0;F<x.length;++F){let H=F*R,W=N[H],G=0;for(let se=0;se<R;++se){let ge=N[H+se];ge>W&&(W=ge,G=se)}x[F]=G}return d.forEach(F=>n.disposeIntermediateTensorInfo(F)),n.makeTensorInfo(m,"int32",x)}},cI={kernelName:Zi,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l}=s;ar(a,"argMin");let u=Zn(l,a.shape),h=Ws(u,a.shape.length),f=a,d=[];h!=null&&(f=Dl({inputs:{x:a},backend:n,attrs:{perm:h}}),d.push(f),u=Zs(u.length,f.shape.length)),u=[u[0]],ma("argMin",u,f.shape.length);let[m,g]=fa(f.shape,u),x=li(me(m),"int32"),R=me(g),N=n.data.get(f.dataId).values;for(let F=0;F<x.length;++F){let H=F*R,W=N[H],G=0;for(let se=0;se<R;++se){let ge=N[H+se];ge<W&&(W=ge,G=se)}x[F]=G}return d.forEach(F=>n.disposeIntermediateTensorInfo(F)),n.makeTensorInfo(m,"int32",x)}},hI=is(ks,i=>Math.asin(i)),dI={kernelName:ks,backendName:"cpu",kernelFunc:hI},pI=is(Mr,i=>Math.asinh(i)),fI={kernelName:Mr,backendName:"cpu",kernelFunc:pI},mI=is(jr,i=>Math.atan(i)),gI={kernelName:jr,backendName:"cpu",kernelFunc:mI},yI=ya((i,t)=>Math.atan2(i,t)),vI=La(qs,yI),bI={kernelName:qs,backendName:"cpu",kernelFunc:vI},xI=is(Xr,i=>Math.atanh(i)),wI={kernelName:Xr,backendName:"cpu",kernelFunc:xI};function VA(i,t,n,s,a,l){let u=a.strideHeight,h=a.strideWidth,f=a.dilationHeight,d=a.dilationWidth,m=a.effectiveFilterHeight,g=a.effectiveFilterWidth,x=a.padInfo.top,R=a.padInfo.left,N=l==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,F=ci(a.outShape,n),H=F.values,W=a.outShape[1]*a.outShape[2]*a.outShape[3],G=a.outShape[2]*a.outShape[3],se=a.outShape[3];for(let ge=0;ge<a.batchSize;++ge){let Ce=ge*W,Be=ge*s[0];for(let Ve=0;Ve<a.inChannels;++Ve)for(let ze=0;ze<a.outHeight;++ze){let Xe=ze*u-x,tt=Math.max(0,Xe),ot=Math.min(a.inHeight,m+Xe),ut=Ce+ze*G;for(let ft=0;ft<a.outWidth;++ft){let kt=ft*h-R,Ut=Math.max(0,kt),It=Math.min(a.inWidth,g+kt),Lt=N,zt=0,Gt=0;for(let qt=tt;qt<ot;qt+=f){let Ot=Be+qt*s[1];for(let jt=Ut;jt<It;jt+=d){let on=i[Ot+jt*s[2]+Ve];l==="max"&&on>Lt?Lt=on:l==="avg"&&(zt+=on,Gt++)}if(isNaN(Lt))break}H[ut+ft*se+Ve]=l==="avg"?zt/Gt:Lt}}}return F}function W2(i,t,n,s,a=!1,l=!1){let u=ci(s.outShape,"int32"),h=s.strideHeight,f=s.strideWidth,d=s.dilationHeight,m=s.dilationWidth,g=s.effectiveFilterHeight,x=s.effectiveFilterWidth,R=s.padInfo.top,N=s.padInfo.left,F=ci(t,n,i);for(let H=0;H<s.batchSize;++H)for(let W=0;W<s.inChannels;++W)for(let G=0;G<s.outHeight;++G){let se=G*h-R,ge=se;for(;ge<0;)ge+=d;let Ce=Math.min(s.inHeight,g+se);for(let Be=0;Be<s.outWidth;++Be){let Ve=Be*f-N,ze=Ve;for(;ze<0;)ze+=m;let Xe=Math.min(s.inWidth,x+Ve),tt=Number.NEGATIVE_INFINITY,ot=-1;for(let ut=ge;ut<Ce;ut+=d){let ft=ut-se;for(let kt=ze;kt<Xe;kt+=m){let Ut=kt-Ve,It=F.get(H,ut,kt,W);It>tt&&(tt=It,ot=a?l?((H*s.inHeight+ut)*s.inWidth+kt)*s.inChannels+W:(ut*s.inWidth+kt)*s.inChannels+W:ft*x+Ut)}}u.set(ot,H,G,Be,W)}}return u}function j2(i,t,n,s,a,l){let u=a.strideDepth,h=a.strideHeight,f=a.strideWidth,d=a.dilationDepth,m=a.dilationHeight,g=a.dilationWidth,x=a.effectiveFilterDepth,R=a.effectiveFilterHeight,N=a.effectiveFilterWidth,F=a.padInfo.front,H=a.padInfo.top,W=a.padInfo.left,G=l==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,se=ci(a.outShape,n),ge=se.values,Ce=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],Be=a.outShape[2]*a.outShape[3]*a.outShape[4],Ve=a.outShape[3]*a.outShape[4],ze=a.outShape[4];for(let Xe=0;Xe<a.batchSize;++Xe){let tt=Xe*Ce,ot=Xe*s[0];for(let ut=0;ut<a.inChannels;++ut)for(let ft=0;ft<a.outDepth;++ft){let kt=ft*u-F,Ut=kt;for(;Ut<0;)Ut+=d;let It=Math.min(a.inDepth,x+kt),Lt=tt+ft*Be;for(let zt=0;zt<a.outHeight;++zt){let Gt=zt*h-H,qt=Gt;for(;qt<0;)qt+=m;let Ot=Math.min(a.inHeight,R+Gt),jt=Lt+zt*Ve;for(let on=0;on<a.outWidth;++on){let bn=on*f-W,An=bn;for(;An<0;)An+=g;let Bn=Math.min(a.inWidth,N+bn),Pn=jt+on*ze,mr=G,_r=0,vr=0;for(let gr=Ut;gr<It;gr+=d){let Wr=ot+gr*s[1];for(let pi=qt;pi<Ot;pi+=m){let Oi=Wr+pi*s[2];for(let $r=An;$r<Bn;$r+=g){let qr=i[Oi+$r*s[3]+ut];if(l==="max"&&qr>mr?mr=qr:l==="avg"&&(_r+=qr,vr++),isNaN(mr))break}if(isNaN(mr))break}if(isNaN(mr))break}ge[Pn+ut]=l==="avg"?_r/vr:mr}}}}return se}let AI={kernelName:Bi,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t;ar(a,"avgPool");let{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s;ee(pa(u,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${u} and dilations '1'`);let d=Ko(a.shape,l,u,1,h,f),m;if(d.filterWidth===1&&d.filterHeight===1&&Ye(d.inShape,d.outShape))m=th({inputs:{x:a},backend:n});else{let g=n.data.get(a.dataId).values,x=Rn(a.shape),R=VA(g,a.shape,a.dtype,x,d,"avg");m=n.makeTensorInfo(d.outShape,a.dtype,R.values)}return m}},EI={kernelName:le,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{filterSize:l,strides:u,pad:h,dimRoundingMode:f,dataFormat:d}=s;ar(a,"avgPool3d");let m=Nu(a.shape,l,u,1,h,f,d),g=j2(n.data.get(a.dataId).values,a.shape,a.dtype,Rn(a.shape),m,"avg");return n.makeTensorInfo(g.shape,"float32",g.values)}},SI={kernelName:de,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l}=t,{filterSize:u,strides:h,pad:f,dimRoundingMode:d}=s;ar([a,l],"avgPool3DGrad");let m=Nu(l.shape,u,h,1,f,d),g=m.strideDepth,x=m.strideHeight,R=m.strideWidth,N=m.filterDepth,F=m.filterHeight,H=m.filterWidth,W=m.dilationDepth,G=m.dilationHeight,se=m.dilationWidth,ge=m.effectiveFilterDepth,Ce=m.effectiveFilterHeight,Be=m.effectiveFilterWidth,Ve=ge-1-m.padInfo.front,ze=Be-1-m.padInfo.left,Xe=Ce-1-m.padInfo.top,tt=ci(l.shape,"float32"),ot=1/(N*F*H),ut=n.bufferSync(a);for(let ft=0;ft<m.batchSize;++ft)for(let kt=0;kt<m.inChannels;++kt)for(let Ut=0;Ut<m.inDepth;++Ut)for(let It=0;It<m.inHeight;++It)for(let Lt=0;Lt<m.inWidth;++Lt){let zt=Ut-Ve,Gt=It-Xe,qt=Lt-ze,Ot=0;for(let jt=0;jt<ge;jt+=W){let on=(zt+jt)/g;if(!(on<0||on>=m.outDepth||Math.floor(on)!==on))for(let bn=0;bn<Ce;bn+=G){let An=(Gt+bn)/x;if(!(An<0||An>=m.outHeight||Math.floor(An)!==An))for(let Bn=0;Bn<Be;Bn+=se){let Pn=(qt+Bn)/R;Pn<0||Pn>=m.outWidth||Math.floor(Pn)!==Pn||(Ot+=ut.get(ft,on,An,Pn,kt))}}}tt.set(Ot*ot,ft,Ut,It,Lt,kt)}return n.makeTensorInfo(tt.shape,tt.dtype,tt.values)}},TI={kernelName:Ki,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l}=t,u=l;ar([a,l],"avgPoolGrad");let{filterSize:h,strides:f,pad:d}=s,m=Ko(u.shape,h,f,1,d),g=m.strideHeight,x=m.strideWidth,R=m.filterHeight,N=m.filterWidth,F=m.dilationHeight,H=m.dilationWidth,W=m.effectiveFilterHeight,G=m.effectiveFilterWidth,se=G-1-m.padInfo.left,ge=W-1-m.padInfo.top,Ce=ci(u.shape,"float32"),Be=1/(R*N),Ve=n.data.get(a.dataId).values,ze=ci(a.shape,"float32",Ve);for(let Xe=0;Xe<m.batchSize;++Xe)for(let tt=0;tt<m.inChannels;++tt)for(let ot=0;ot<m.inHeight;++ot)for(let ut=0;ut<m.inWidth;++ut){let ft=ot-ge,kt=ut-se,Ut=0;for(let It=0;It<W;It+=F){let Lt=(ft+It)/g;if(!(Lt<0||Lt>=m.outHeight||Math.floor(Lt)!==Lt))for(let zt=0;zt<G;zt+=H){let Gt=(kt+zt)/x;Gt<0||Gt>=m.outWidth||Math.floor(Gt)!==Gt||(Ut+=ze.get(Xe,Lt,Gt,tt))}}Ce.set(Ut*Be,Xe,ot,ut,tt)}return n.makeTensorInfo(Ce.shape,Ce.dtype,Ce.values)}},MI={kernelName:yp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,scale:l,offset:u,mean:h,variance:f}=t;ee(h.shape.length===f.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ee(u==null||h.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ee(l==null||h.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ar([a,h,f,l,u],"batchNorm");let{varianceEpsilon:d}=s;d==null&&(d=.001);let m=n.data.get(a.dataId).values,g=n.data.get(h.dataId).values,x=n.data.get(f.dataId).values,R=l?n.data.get(l.dataId).values:new Float32Array([1]),N=u?n.data.get(u.dataId).values:new Float32Array([0]),F=new Float32Array(m.length),H=N.length,W=R.length,G=x.length,se=g.length,ge=0,Ce=0,Be=0,Ve=0;for(let ze=0;ze<m.length;++ze)F[ze]=N[ge++]+(m[ze]-g[Ce++])*R[Be++]/Math.sqrt(x[Ve++]+d),ge>=H&&(ge=0),Ce>=se&&(Ce=0),Be>=W&&(Be=0),Ve>=G&&(Ve=0);return n.makeTensorInfo(a.shape,a.dtype,F)}};function X2(i,t,n,s,a){let l=c0(s,t,n),u=me(n),h=Rn(s);if(l){let m=h0(t,h);return a==="string"?i.slice(m,m+u):i.subarray(m,m+u)}let f=ci(s,a,a==="string"?Do(i):i),d=ci(n,a);for(let m=0;m<d.size;++m){let g=d.indexToLoc(m),x=g.map((R,N)=>R+t[N]);d.set(f.get(...x),...g)}return a==="string"?rg(d.values):d.values}function jf(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{begin:l,size:u}=s;ar(a,"slice");let[h,f]=ym(a,l,u);l0(a,h,f);let d=X2(n.data.get(a.dataId).values,h,f,a.shape,a.dtype);return n.makeTensorInfo(f,a.dtype,d)}let _I={kernelName:Hl,backendName:"cpu",kernelFunc:jf},CI={kernelName:Ne,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{blockShape:l,crops:u}=s;ar([a],"batchToSpaceND");let h=l.reduce((W,G)=>W*G),f=Cf(a.shape,l,h),d=Gu(f.length,l.length),m=If(a.shape,l,h),g=Wm(u,l.length),x=jm(m,u,l.length),R=Us({inputs:{x:a},backend:n,attrs:{shape:f}}),N=Dl({inputs:{x:R},backend:n,attrs:{perm:d}}),F=Us({inputs:{x:N},backend:n,attrs:{shape:m}}),H=jf({inputs:{x:F},backend:n,attrs:{begin:g,size:x}});return n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),H}};function HA(i,t,n,s,a){let l=me(s),u=li(a,n);for(let h=0;h<i.length;h++){let f=i[h];if(f<0)throw new Error("Input x must be non-negative!");f>=a||(u[f]+=l>0?t[h]:1)}return u}function q2(i,t,n,s=!1){let a=i.shape[0],l=i.shape[1],u=ci([a,n],t.dtype);for(let h=0;h<a;h++)for(let f=0;f<l;f++){let d=i.get(h,f);if(d<0)throw new Error("Input x must be non-negative!");d>=n||(s?u.set(1,h,d):t.size>0?u.set(u.get(h,d)+t.get(h,f),h,d):u.set(u.get(h,d)+1,h,d))}return u}let II={kernelName:He,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,weights:l}=t,{size:u}=s,h=HA(n.data.get(a.dataId).values,n.data.get(l.dataId).values,l.dtype,l.shape,u);return n.makeTensorInfo([u],l.dtype,h)}},kI={kernelName:gt,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{s0:s,s1:a}=t,l=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values,h=Zr(Array.from(l),Array.from(u));return n.makeTensorInfo([h.length],"int32",Int32Array.from(h))}},K2=pp(i=>Math.ceil(i)),RI=Cg(Qt,K2),NI={kernelName:Qt,backendName:"cpu",kernelFunc:RI},LI=is(At,(i,t)=>{let n=t;return i>n.clipValueMax?n.clipValueMax:i<n.clipValueMin?n.clipValueMin:i}),DI={kernelName:At,backendName:"cpu",kernelFunc:LI},FI={kernelName:hn,backendName:"cpu",kernelFunc:i=>{let{x:t}=i.inputs,n=i.backend,s=new Float32Array(me(t.shape)),a=n.data.get(t.dataId),l=a.complexTensorInfos.real,u=a.complexTensorInfos.imag,h=n.data.get(l.dataId).values,f=n.data.get(u.dataId).values;for(let d=0;d<h.length;d++){let m=h[d],g=f[d];s[d]=Math.hypot(m,g)}return n.makeOutput(s,t.shape,"float32")}};function Y2(i,t,n,s){let a=St(n,me(t));if(s&&n!=="string"){let l=0;i.forEach(u=>{let h=me(u.shape);a.set(u.vals,l),l+=h})}else{let l=0;i.forEach(u=>{let h=n==="string"?Do(u.vals):u.vals,f=0;for(let d=0;d<u.shape[0];++d){let m=d*t[1]+l;for(let g=0;g<u.shape[1];++g)a[m+g]=h[f++]}l+=u.shape[1]})}return a}function Ig(i){let{inputs:t,backend:n}=i,{input:s}=t,a=n.data.get(s.dataId).complexTensorInfos.imag,l=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,l)}let PI={kernelName:od,backendName:"cpu",kernelFunc:Ig};function kg(i){let{inputs:t,backend:n,attrs:s}=i,{axis:a}=s,l=Zn(a,t[0].shape)[0],u=No(t.map(N=>N.shape),l);if(me(u)===0)return n.makeTensorInfo(u,t[0].dtype,[]);let h=t.filter(N=>me(N.shape)>0);if(h.length===1)return th({inputs:{x:h[0]},backend:n});if(As(h.map(N=>N.shape),l),h[0].dtype==="complex64"){let N=h.map(se=>Wf({inputs:{input:se},backend:n})),F=h.map(se=>Ig({inputs:{input:se},backend:n})),H=kg({inputs:N,backend:n,attrs:{axis:l}}),W=kg({inputs:F,backend:n,attrs:{axis:l}}),G=cl({inputs:{real:H,imag:W},backend:n});return N.forEach(se=>n.disposeIntermediateTensorInfo(se)),F.forEach(se=>n.disposeIntermediateTensorInfo(se)),n.disposeIntermediateTensorInfo(H),n.disposeIntermediateTensorInfo(W),G}let f=h.map(N=>{let F=me(N.shape.slice(l));return Us({inputs:{x:N},backend:n,attrs:{shape:[-1,F]}})}),d=f.map(N=>({vals:n.data.get(N.dataId).values,shape:N.shape}));u=No(f.map(N=>N.shape),1);let m=f[0].shape[0]===1,g=Y2(d,u,t[0].dtype,m),x=No(h.map(N=>N.shape),l),R=n.makeTensorInfo(x,t[0].dtype,g);return f.forEach(N=>n.disposeIntermediateTensorInfo(N)),R}let OI={kernelName:zn,backendName:"cpu",kernelFunc:kg};function Q2(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dataFormat:f,dilations:d,dimRoundingMode:m}=s;ar([a,l],"conv2d");let g=nu(f),x=ta(a.shape,l.shape,u,d,h,m,!1,g),R=x.filterHeight,N=x.filterWidth,F=x.dilationHeight,H=x.dilationWidth,W=x.padInfo.left,G=x.padInfo.top,se=x.dataFormat==="channelsLast",ge=new Hi(x.outShape,a.dtype),Ce=Rn(a.shape),Be=Rn(l.shape),Ve=Ce[0],ze=se?Ce[1]:Ce[2],Xe=se?Ce[2]:1,tt=se?1:Ce[1],ot=ge.strides[0],ut=se?ge.strides[1]:ge.strides[2],ft=se?ge.strides[2]:1,kt=se?1:ge.strides[1],Ut=n.data.get(a.dataId).values,It=n.data.get(l.dataId).values,Lt=ge.values;for(let zt=0;zt<x.batchSize;++zt){let Gt=zt*Ve,qt=zt*ot;for(let Ot=0;Ot<x.outHeight;++Ot){let jt=qt+Ot*ut,on=Ot*x.strideHeight-G;for(let bn=0;bn<R;++bn){let An=on+bn*F;if(An<0||An>=x.inHeight)continue;let Bn=bn*Be[0],Pn=Gt+An*ze;for(let mr=0;mr<x.outWidth;++mr){let _r=jt+mr*ft,vr=mr*x.strideWidth-W;for(let gr=0;gr<N;++gr){let Wr=vr+gr*H;if(Wr<0||Wr>=x.inWidth)continue;let pi=Pn+Wr*Xe,Oi=Bn+gr*Be[1];for(let $r=0;$r<x.inChannels;++$r){let qr=Ut[pi+$r*tt];for(let Ai=0;Ai<x.outChannels;++Ai)Lt[_r+Ai*kt]+=qr*It[Oi+Ai];Oi+=x.outChannels}}}}}}return n.makeTensorInfo(ge.shape,ge.dtype,Lt)}let BI={kernelName:Kn,backendName:"cpu",kernelFunc:Q2},UI={kernelName:hr,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,dy:l}=t,{strides:u,pad:h,dataFormat:f,dimRoundingMode:d,filterShape:m}=s;ar([a,l],"conv2dBackpropFilter");let g=nu(f),x=ta(a.shape,m,u,1,h,d,!1,g),{strideHeight:R,strideWidth:N,filterHeight:F,filterWidth:H}=x,W=x.dataFormat==="channelsLast",G=new Hi(x.filterShape,"float32"),se=x.padInfo.left,ge=x.padInfo.top,Ce=n.data.get(a.dataId).values,Be=n.data.get(l.dataId).values,Ve=new Hi(a.shape,a.dtype,Ce),ze=new Hi(l.shape,l.dtype,Be);for(let Xe=0;Xe<F;++Xe){let tt=Math.max(0,Math.ceil((ge-Xe)/R)),ot=Math.min(x.outHeight,(x.inHeight+ge-Xe)/R);for(let ut=0;ut<H;++ut){let ft=Math.max(0,Math.ceil((se-ut)/N)),kt=Math.min(x.outWidth,(x.inWidth+se-ut)/N);for(let Ut=0;Ut<x.inChannels;++Ut)for(let It=0;It<x.outChannels;++It){let Lt=0;for(let zt=0;zt<x.batchSize;++zt)for(let Gt=tt;Gt<ot;++Gt){let qt=Xe+Gt*R-ge;for(let Ot=ft;Ot<kt;++Ot){let jt=ut+Ot*N-se;Lt+=W?Ve.get(zt,qt,jt,Ut)*ze.get(zt,Gt,Ot,It):Ve.get(zt,Ut,qt,jt)*ze.get(zt,It,Gt,Ot)}}G.set(Lt,Xe,ut,Ut,It)}}}return n.makeTensorInfo(G.shape,G.dtype,G.values)}},zI={kernelName:Rr,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,filter:l}=t,{inputShape:u,strides:h,pad:f,dataFormat:d,dimRoundingMode:m}=s;ar([a,l],"conv2dBackpropInput");let g=Rn(l.shape),x=Rn(a.shape),R=nu(d),N=ta(u,l.shape,h,1,f,m,!1,R),F=new Hi(N.inShape,"float32"),H=F.values,W=n.data.get(a.dataId).values,G=n.data.get(l.dataId).values,[se,ge,Ce]=g,{batchSize:Be,filterHeight:Ve,filterWidth:ze,inChannels:Xe,inHeight:tt,inWidth:ot,outChannels:ut,outHeight:ft,outWidth:kt,strideHeight:Ut,strideWidth:It}=N;R=N.dataFormat;let Lt=Ve-1-N.padInfo.top,zt=ze-1-N.padInfo.left,Gt=R==="channelsLast",qt=F.strides[0],Ot=Gt?F.strides[1]:F.strides[2],jt=Gt?F.strides[2]:1,on=Gt?1:F.strides[1],bn=x[0],An=Gt?x[1]:x[2],Bn=Gt?x[2]:1,Pn=Gt?1:x[1];for(let mr=0;mr<Be;++mr)for(let _r=0;_r<Xe;++_r)for(let vr=0;vr<tt;++vr){let gr=vr-Lt,Wr=Math.max(0,Math.ceil(gr/Ut)),pi=Math.min(ft,(Ve+gr)/Ut);for(let Oi=0;Oi<ot;++Oi){let $r=Oi-zt,qr=Math.max(0,Math.ceil($r/It)),Ai=Math.min(kt,(ze+$r)/It),ia=0;for(let $a=Wr;$a<pi;++$a){let Va=$a*Ut-gr;for(let sa=qr;sa<Ai;++sa){let td=bn*mr+An*$a+Bn*sa,Sa=se*(Ve-1-Va)+ge*(ze-1-(sa*It-$r))+Ce*_r;for(let Ha=0;Ha<ut;++Ha)ia+=W[td+Pn*Ha]*G[Sa+Ha]}}H[qt*mr+Ot*vr+jt*Oi+on*_r]=ia}}return n.makeTensorInfo(F.shape,F.dtype,F.values)}},$I={kernelName:Nr,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dilations:f}=s;ar([a,l],"conv3d");let d=bc(a.shape,l.shape,u,f,h),{filterDepth:m,filterHeight:g,filterWidth:x,dilationDepth:R,dilationHeight:N,dilationWidth:F,padInfo:H}=d,W=H.front,G=H.left,se=H.top,ge=new Hi(d.outShape,a.dtype),Ce=n.data.get(a.dataId).values,Be=n.data.get(l.dataId).values,Ve=ge.values,ze=Rn(a.shape),Xe=Rn(l.shape);for(let tt=0;tt<d.batchSize;++tt){let ot=tt*ze[0],ut=tt*ge.strides[0];for(let ft=0;ft<d.outDepth;++ft){let kt=ut+ft*ge.strides[1],Ut=ft*d.strideDepth-W;for(let It=0;It<m;++It){let Lt=Ut+It*R;if(Lt<0||Lt>=d.inDepth)continue;let zt=It*Xe[0],Gt=ot+Lt*ze[1];for(let qt=0;qt<d.outHeight;++qt){let Ot=kt+qt*ge.strides[2],jt=qt*d.strideHeight-se;for(let on=0;on<g;++on){let bn=jt+on*N;if(bn<0||bn>=d.inHeight)continue;let An=zt+on*Xe[1],Bn=Gt+bn*ze[2];for(let Pn=0;Pn<d.outWidth;++Pn){let mr=Ot+Pn*d.outChannels,_r=Pn*d.strideWidth-G;for(let vr=0;vr<x;++vr){let gr=_r+vr*F;if(gr<0||gr>=d.inWidth)continue;let Wr=An+vr*Xe[2],pi=Bn+gr*d.inChannels,Oi=Wr;for(let $r=0;$r<d.inChannels;++$r){let qr=Ce[pi+$r];for(let Ai=0;Ai<d.outChannels;++Ai)Ve[mr+Ai]+=qr*Be[Oi+Ai];Oi+=d.outChannels}}}}}}}}return n.makeTensorInfo(ge.shape,ge.dtype,ge.values)}},VI={kernelName:kr,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,dy:l}=t,{strides:u,pad:h,filterShape:f}=s;ar([a,l],"conv3dBackpropFilterV2");let d=Rn(a.shape),m=Rn(l.shape),g=bc(a.shape,f,u,1,h),x=g.strideDepth,R=g.strideHeight,N=g.strideWidth,F=g.filterDepth,H=g.filterHeight,W=g.filterWidth,G=new Hi(g.filterShape,"float32"),se=G.values,[ge,Ce,Be,Ve]=G.strides,ze=n.data.get(l.dataId).values,[Xe,tt,ot,ut]=m,ft=n.data.get(a.dataId).values,[kt,Ut,It,Lt]=d,zt=g.padInfo.front,Gt=g.padInfo.left,qt=g.padInfo.top;for(let Ot=0;Ot<F;++Ot){let jt=Math.max(0,Math.ceil((zt-Ot)/x)),on=Math.min(g.outDepth,(g.inDepth+zt-Ot)/x),bn=Ot*ge;for(let An=0;An<H;++An){let Bn=Math.max(0,Math.ceil((qt-An)/R)),Pn=Math.min(g.outHeight,(g.inHeight+qt-An)/R),mr=An*Ce+bn;for(let _r=0;_r<W;++_r){let vr=Math.max(0,Math.ceil((Gt-_r)/N)),gr=Math.min(g.outWidth,(g.inWidth+Gt-_r)/N),Wr=_r*Be+mr;for(let pi=0;pi<g.inChannels;++pi){let Oi=pi*Ve+Wr;for(let $r=0;$r<g.outChannels;++$r){let qr=0;for(let Ai=0;Ai<g.batchSize;++Ai){let ia=Ai*kt,$a=Ai*Xe;for(let Va=jt;Va<on;++Va){let sa=(Ot+Va*x-zt)*Ut+ia,td=Va*tt+$a;for(let Sa=Bn;Sa<Pn;++Sa){let Ha=(An+Sa*R-qt)*It+sa,xo=Sa*ot+td;for(let tc=vr;tc<gr;++tc){let nd=tc*ut+xo;qr+=ft[(_r+tc*N-Gt)*Lt+Ha+pi]*ze[nd+$r]}}}}se[Oi+$r]=qr}}}}}return n.makeTensorInfo(G.shape,G.dtype,G.values)}},HI={kernelName:ki,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,filter:l}=t,{pad:u,strides:h,inputShape:f}=s;ar([a],"conv3dBackpropInputV2");let d=Rn(a.shape),m=Rn(l.shape),g=bc(f,l.shape,h,1,u),x=new Hi(g.inShape,"float32"),R=x.values,[N,F,H,W]=x.strides,G=n.data.get(a.dataId).values,[se,ge,Ce,Be]=d,Ve=n.data.get(l.dataId).values,[ze,Xe,tt,ot]=m,{batchSize:ut,filterDepth:ft,filterHeight:kt,filterWidth:Ut,inChannels:It,inDepth:Lt,inHeight:zt,inWidth:Gt,outChannels:qt,outDepth:Ot,outHeight:jt,outWidth:on,strideDepth:bn,strideHeight:An,strideWidth:Bn}=g,Pn=ft-1-g.padInfo.front,mr=kt-1-g.padInfo.top,_r=Ut-1-g.padInfo.left;for(let vr=0;vr<ut;++vr)for(let gr=0;gr<It;++gr)for(let Wr=0;Wr<Lt;++Wr){let pi=Wr-Pn,Oi=Math.max(0,Math.ceil(pi/bn)),$r=Math.min(Ot,(ft+pi)/bn);for(let qr=0;qr<zt;++qr){let Ai=qr-mr,ia=Math.max(0,Math.ceil(Ai/An)),$a=Math.min(jt,(kt+Ai)/An);for(let Va=0;Va<Gt;++Va){let sa=Va-_r,td=Math.max(0,Math.ceil(sa/Bn)),Sa=Math.min(on,(Ut+sa)/Bn),Ha=0;for(let xo=Oi;xo<$r;++xo){let tc=xo*bn-pi;for(let nd=ia;nd<$a;++nd){let o4=nd*An-Ai;for(let Hx=td;Hx<Sa;++Hx){let l4=se*vr+ge*xo+Ce*nd+Be*Hx,u4=ze*(ft-1-tc)+Xe*(kt-1-o4)+tt*(Ut-1-(Hx*Bn-sa))+ot*gr;for(let Gx=0;Gx<qt;++Gx)Ha+=G[l4+Gx]*Ve[u4+Gx]}}}R[N*vr+F*Wr+H*qr+W*Va+gr]=Ha}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},GI=is(Ji,i=>Math.cos(i)),WI={kernelName:Ji,backendName:"cpu",kernelFunc:GI},jI=is(vs,i=>Math.cosh(i)),XI={kernelName:vs,backendName:"cpu",kernelFunc:jI},qI={kernelName:Qr,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{image:a,boxes:l,boxInd:u}=t,{cropSize:h,method:f,extrapolationValue:d}=s,[m,g,x,R]=a.shape,N=l.shape[0],[F,H]=h,W=ci([N,F,H,R],"float32"),G=n.data.get(l.dataId).values,se=n.data.get(u.dataId).values,ge=n.data.get(a.dataId).values,Ce=Rn(a.shape),Be=Rn(W.shape);for(let Ve=0;Ve<N;Ve++){let ze=4*Ve,Xe=G[ze],tt=G[ze+1],ot=G[ze+2],ut=G[ze+3],ft=se[Ve];if(ft>=m)continue;let kt=F>1?(ot-Xe)*(g-1)/(F-1):0,Ut=H>1?(ut-tt)*(x-1)/(H-1):0;for(let It=0;It<F;It++){let Lt=F>1?Xe*(g-1)+It*kt:.5*(Xe+ot)*(g-1);if(Lt<0||Lt>g-1)for(let zt=0;zt<H;zt++)for(let Gt=0;Gt<R;Gt++){let qt=Gt+zt*Be[2]+It*Be[1]+Ve*Be[0];W.values[qt]=d}else if(f==="bilinear"){let zt=Math.floor(Lt),Gt=Math.ceil(Lt),qt=Lt-zt;for(let Ot=0;Ot<H;Ot++){let jt=H>1?tt*(x-1)+Ot*Ut:.5*(tt+ut)*(x-1);if(jt<0||jt>x-1){for(let Bn=0;Bn<R;Bn++){let Pn=Bn+Ot*Be[2]+It*Be[1]+Ve*Be[0];W.values[Pn]=d}continue}let on=Math.floor(jt),bn=Math.ceil(jt),An=jt-on;for(let Bn=0;Bn<R;Bn++){let Pn=Bn+on*Ce[2]+zt*Ce[1]+ft*Ce[0],mr=ge[Pn];Pn=Bn+bn*Ce[2]+zt*Ce[1]+ft*Ce[0];let _r=ge[Pn];Pn=Bn+on*Ce[2]+Gt*Ce[1]+ft*Ce[0];let vr=ge[Pn];Pn=Bn+bn*Ce[2]+Gt*Ce[1]+ft*Ce[0];let gr=mr+(_r-mr)*An,Wr=vr+(ge[Pn]-vr)*An;Pn=Bn+Ot*Be[2]+It*Be[1]+Ve*Be[0],W.values[Pn]=gr+(Wr-gr)*qt}}}else for(let zt=0;zt<H;++zt){let Gt=H>1?tt*(x-1)+zt*Ut:.5*(tt+ut)*(x-1);if(Gt<0||Gt>x-1){for(let jt=0;jt<R;jt++){let on=jt+zt*Be[2]+It*Be[1]+Ve*Be[0];W.values[on]=d}continue}let qt=Math.round(Gt),Ot=Math.round(Lt);for(let jt=0;jt<R;jt++){let on=jt+qt*Ce[2]+Ot*Ce[1]+ft*Ce[0],bn=jt+zt*Be[2]+It*Be[1]+Ve*Be[0];W.values[bn]=ge[on]}}}}return n.makeTensorInfo(W.shape,W.dtype,W.values)}},KI={kernelName:Ei,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,exclusive:u,reverse:h}=s;ar(a,"cumsum");let f=Ws([l],a.shape.length),d=a;f!=null&&(d=Dl({inputs:{x:a},backend:n,attrs:{perm:f}}));let m=Zs(1,a.shape.length)[0];if(m!==d.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${m}`);let g=_a(d.dtype,"int32"),x=li(me(d.shape),g),R=n.data.get(d.dataId).values,N=d.shape[d.shape.length-1],F=h?(W,G)=>W+N-G-1:(W,G)=>W+G;for(let W=0;W<R.length;W+=N)for(let G=0;G<N;G++){let se=F(W,G);if(G===0)x[se]=u?0:R[se];else{let ge=F(W,G-1);x[se]=u?R[ge]+x[ge]:R[se]+x[ge]}}let H=n.makeTensorInfo(d.shape,g,x);if(f!=null){let W=Dl({inputs:{x:H},backend:n,attrs:{perm:Bd(f)}});return n.disposeIntermediateTensorInfo(H),n.disposeIntermediateTensorInfo(d),W}return H}},YI={kernelName:oa,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,weights:l}=t,{size:u,binaryOutput:h}=s;if(a.shape.length===1){let f=HA(n.data.get(a.dataId).values,n.data.get(l.dataId).values,l.dtype,l.shape,u);return n.makeTensorInfo([u],l.dtype,f)}if(a.shape.length===2){let f=q2(n.bufferSync(a),n.bufferSync(l),u,h);return n.makeTensorInfo(f.shape,l.dtype,f.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}},QI={kernelName:la,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{blockSize:l,dataFormat:u}=s;ee(u==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${u}`);let h=a.shape[0],f=a.shape[1],d=a.shape[2],m=a.shape[3],g=f*l,x=d*l,R=m/(l*l),N=n.data.get(a.dataId).values,F=new Float32Array(h*g*x*R),H=0;for(let W=0;W<h;++W)for(let G=0;G<g;++G){let se=Math.floor(G/l),ge=G%l;for(let Ce=0;Ce<x;++Ce){let Be=Math.floor(Ce/l),Ve=(ge*l+Ce%l)*R;for(let ze=0;ze<R;++ze){let Xe=ze+Ve+m*(Be+d*(se+f*W));F[H++]=N[Xe]}}}return n.makeTensorInfo([h,g,x,R],a.dtype,F)}};function Z2(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dilations:f,dimRoundingMode:d}=s;ar([a,l],"depthwiseConv2DNative");let m=Rn(a.shape),g=Rn(l.shape),x=f;x==null&&(x=[1,1]),ee(pa(u,x),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${x}'`);let R=ta(a.shape,l.shape,u,x,h,d,!0),{filterHeight:N,filterWidth:F,dilationHeight:H,dilationWidth:W,padInfo:G}=R,se=G.left,ge=G.top,Ce=R.outChannels/R.inChannels,Be=new Hi(R.outShape,a.dtype),Ve=n.data.get(a.dataId).values,ze=n.data.get(l.dataId).values,Xe=Be.values;for(let tt=0;tt<R.batchSize;++tt){let ot=tt*m[0],ut=tt*Be.strides[0];for(let ft=0;ft<R.outHeight;++ft){let kt=ut+ft*Be.strides[1],Ut=ft*R.strideHeight-ge;for(let It=0;It<N;++It){let Lt=Ut+It*H;if(Lt<0||Lt>=R.inHeight)continue;let zt=It*g[0],Gt=ot+Lt*m[1];for(let qt=0;qt<R.outWidth;++qt){let Ot=kt+qt*Be.strides[2],jt=qt*R.strideWidth-se;for(let on=0;on<F;++on){let bn=jt+on*W;if(bn<0||bn>=R.inWidth)continue;let An=zt+on*g[1],Bn=Gt+bn*R.inChannels,Pn=Ot,mr=An;for(let _r=0;_r<R.inChannels;++_r){let vr=Ve[Bn+_r];for(let gr=0;gr<Ce;++gr)Xe[Pn+gr]+=vr*ze[mr+gr];Pn+=Ce,mr+=Ce}}}}}}return n.makeTensorInfo(Be.shape,Be.dtype,Be.values)}let ZI={kernelName:bs,backendName:"cpu",kernelFunc:Z2},JI={kernelName:ua,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,dy:l}=t,{strides:u,dilations:h,pad:f,dimRoundingMode:d,filterShape:m}=s;ar([a,l],"depthwiseConv2dNativeBackpropFilter");let g=ta(a.shape,m,u,h,f,d,!0),{strideHeight:x,strideWidth:R,filterHeight:N,filterWidth:F}=g,H=new Hi(g.filterShape,"float32"),W=g.padInfo.left,G=g.padInfo.top,se=g.outChannels/g.inChannels,ge=n.data.get(a.dataId).values,Ce=new Hi(a.shape,a.dtype,ge),Be=n.data.get(l.dataId).values,Ve=new Hi(l.shape,l.dtype,Be);for(let ze=0;ze<N;++ze){let Xe=Math.max(0,Math.ceil((G-ze)/x)),tt=Math.min(g.outHeight,(g.inHeight+G-ze)/x);for(let ot=0;ot<F;++ot){let ut=Math.max(0,Math.ceil((W-ot)/R)),ft=Math.min(g.outWidth,(g.inWidth+W-ot)/R);for(let kt=0;kt<g.outChannels;++kt){let Ut=Math.trunc(kt/se),It=kt%se,Lt=0;for(let zt=0;zt<g.batchSize;++zt)for(let Gt=Xe;Gt<tt;++Gt){let qt=ze+Gt*x-G;for(let Ot=ut;Ot<ft;++Ot){let jt=ot+Ot*R-W;Lt+=Ce.get(zt,qt,jt,Ut)*Ve.get(zt,Gt,Ot,kt)}}H.set(Lt,ze,ot,Ut,It)}}}return n.makeTensorInfo(H.shape,H.dtype,H.values)}},ek={kernelName:Ao,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,filter:l}=t,{strides:u,dilations:h,pad:f,dimRoundingMode:d,inputShape:m}=s;ar([a,l],"depthwiseConv2DNativeBackpropInput");let g=Rn(a.shape),x=Rn(l.shape),R=ta(m,l.shape,u,h,f,d,!0),N=new Hi(R.inShape,"float32"),F=N.values,[H,W,G]=N.strides,se=n.data.get(a.dataId).values,[ge,Ce,Be]=g,Ve=n.data.get(l.dataId).values,[ze,Xe,tt]=x,{batchSize:ot,filterHeight:ut,filterWidth:ft,inChannels:kt,inHeight:Ut,inWidth:It,outChannels:Lt,outHeight:zt,outWidth:Gt,strideHeight:qt,strideWidth:Ot}=R,jt=ut-1-R.padInfo.top,on=ft-1-R.padInfo.left,bn=Lt/kt;for(let An=0;An<ot;++An)for(let Bn=0;Bn<kt;++Bn)for(let Pn=0;Pn<Ut;++Pn){let mr=Pn-jt,_r=Math.max(0,Math.ceil(mr/qt)),vr=Math.min(zt,(ut+mr)/qt);for(let gr=0;gr<It;++gr){let Wr=gr-on,pi=Math.max(0,Math.ceil(Wr/Ot)),Oi=Math.min(Gt,(ft+Wr)/Ot),$r=0;for(let qr=_r;qr<vr;++qr){let Ai=qr*qt-mr;for(let ia=pi;ia<Oi;++ia){let $a=ge*An+Ce*qr+Be*ia,Va=ze*(ut-1-Ai)+Xe*(ft-1-(ia*Ot-Wr))+tt*Bn;for(let sa=0;sa<bn;++sa)$r+=se[$a+(Bn*bn+sa)]*Ve[Va+sa]}}F[H*An+W*Pn+G*gr+Bn]=$r}}return n.makeTensorInfo(N.shape,N.dtype,N.values)}},tk={kernelName:Eo,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s}=t,a=me(s.shape),l=n.data.get(s.dataId).values,u=ci([a,a],s.dtype),h=u.values;for(let d=0;d<l.length;d++)h[d*a+d]=l[d];let f=[...s.shape,...s.shape];return n.makeTensorInfo(f,u.dtype,u.values)}},nk={kernelName:dl,backendName:"cpu",kernelFunc:({inputs:i,backend:t,attrs:n})=>{let{x:s,filter:a}=i,{strides:l,pad:u,dilations:h}=n,f=t,d=f.data.get(s.dataId).values,m=s.shape.length,g=f.data.get(a.dataId).values,x=a.shape.length,{batchSize:R,inHeight:N,inWidth:F,inChannels:H,outHeight:W,outWidth:G,padInfo:se,strideHeight:ge,strideWidth:Ce,filterHeight:Be,filterWidth:Ve,dilationHeight:ze,dilationWidth:Xe,outShape:tt}=vc(s.shape,a.shape,l,u,"NHWC",h),ot=me(tt),ut=tt.length,ft=St(s.dtype,ot);for(let kt=0;kt<R;++kt)for(let Ut=0;Ut<W;++Ut){let It=Ut*ge-se.top;for(let Lt=0;Lt<G;++Lt){let zt=Lt*Ce-se.left;for(let Gt=0;Gt<H;++Gt){let qt=Number.MIN_SAFE_INTEGER;for(let Ot=0;Ot<Be;++Ot){let jt=It+Ot*ze;if(jt>=0&&jt<N)for(let on=0;on<Ve;++on){let bn=zt+on*Xe;if(bn>=0&&bn<F){let An=zs([kt,jt,bn,Gt],m,Rn(s.shape)),Bn=zs([Ot,on,Gt],x,Rn(a.shape)),Pn=d[An]+g[Bn];Pn>qt&&(qt=Pn)}}}ft[zs([kt,Ut,Lt,Gt],ut,Rn(tt))]=qt}}}return{dataId:f.write(Mu(ft,s.dtype),tt,s.dtype),shape:tt,dtype:s.dtype}}},rk={kernelName:Ol,backendName:"cpu",kernelFunc:({inputs:i,backend:t,attrs:n})=>{let{x:s,filter:a,dy:l}=i,{strides:u,pad:h,dilations:f}=n,d=t,m=Xi(s.shape,d.data.get(s.dataId).values),g=Xi(a.shape,d.data.get(a.dataId).values),{batchSize:x,inHeight:R,inWidth:N,inChannels:F,outHeight:H,outWidth:W,padInfo:G,strideHeight:se,strideWidth:ge,filterHeight:Ce,filterWidth:Be,dilationHeight:Ve,dilationWidth:ze,outShape:Xe}=vc(s.shape,a.shape,u,h,"NHWC",f);ee(l.rank===Xe.length,()=>`Error in ${Ol}, dy must have the same rank as output ${Xe.length}, but got ${l.rank}`);let tt=Xi(Xe,d.data.get(l.dataId).values),ot=aa(a.shape,a.dtype);for(let ut=0;ut<x;++ut)for(let ft=0;ft<H;++ft){let kt=ft*se-G.top;for(let Ut=0;Ut<W;++Ut){let It=Ut*ge-G.left;for(let Lt=0;Lt<F;++Lt){let zt=Number.MIN_SAFE_INTEGER,Gt=0,qt=0;for(let Ot=0;Ot<Ce;++Ot){let jt=kt+Ot*Ve;if(jt>=0&&jt<R)for(let on=0;on<Be;++on){let bn=It+on*ze;if(bn>=0&&bn<N){let An=m[ut][jt][bn][Lt]+g[Ot][on][Lt];An>zt&&(zt=An,Gt=Ot,qt=on)}}}ot[Gt][qt][Lt]+=tt[ut][ft][Ut][Lt]}}}return{dataId:d.write(Mu(ot,s.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},ik={kernelName:Pl,backendName:"cpu",kernelFunc:({inputs:i,backend:t,attrs:n})=>{let{x:s,filter:a,dy:l}=i,{strides:u,pad:h,dilations:f}=n,d=t,m=Xi(s.shape,d.data.get(s.dataId).values),g=Xi(a.shape,d.data.get(a.dataId).values),{batchSize:x,inHeight:R,inWidth:N,inChannels:F,outHeight:H,outWidth:W,padInfo:G,strideHeight:se,strideWidth:ge,filterHeight:Ce,filterWidth:Be,dilationHeight:Ve,dilationWidth:ze,outShape:Xe}=vc(s.shape,a.shape,u,h,"NHWC",f);ee(l.rank===Xe.length,()=>`Error in ${Pl}, dy must have the same rank as output ${Xe.length}, but got ${l.rank}`);let tt=Xi(Xe,d.data.get(l.dataId).values),ot=aa(s.shape,s.dtype);for(let ut=0;ut<x;++ut)for(let ft=0;ft<H;++ft){let kt=ft*se-G.top;for(let Ut=0;Ut<W;++Ut){let It=Ut*ge-G.left;for(let Lt=0;Lt<F;++Lt){let zt=Number.MIN_SAFE_INTEGER,Gt=kt<0?0:kt,qt=It<0?0:It;for(let Ot=0;Ot<Ce;++Ot){let jt=kt+Ot*Ve;if(jt>=0&&jt<R)for(let on=0;on<Be;++on){let bn=It+on*ze;if(bn>=0&&bn<N){let An=m[ut][jt][bn][Lt]+g[Ot][on][Lt];An>zt&&(zt=An,Gt=jt,qt=bn)}}}ot[ut][Gt][qt][Lt]+=tt[ut][ft][Ut][Lt]}}}return{dataId:d.write(Mu(ot,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}},GA=ya((i,t)=>i*t),sk=zA((i,t,n,s)=>({real:i*n-t*s,imag:i*s+t*n})),Mx=La(Ts,GA,sk),ak={kernelName:Ts,backendName:"cpu",kernelFunc:Mx};function qy(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s,h;ar(a,"sum"),h=a.dtype==="bool"?fp({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):th({inputs:{x:a},backend:n});let f=h.shape.length,d=Zn(l,h.shape),m=Ws(d,f),g=d,x=h;m!=null&&(x=Dl({inputs:{x:h},backend:n,attrs:{perm:m}}),g=Zs(g.length,f)),ma("sum",g,x.shape.length);let[R,N]=fa(x.shape,g),F=Tx(n,R,_a(x.dtype,"int32")),H=me(N),W=n.data.get(F.dataId).values,G=n.data.get(x.dataId).values;for(let se=0;se<W.length;++se){let ge=se*H,Ce=0;for(let Be=0;Be<H;++Be)Ce+=G[ge+Be];W[se]=Ce}if(u){let se=F;F=Us({inputs:{x:F},backend:n,attrs:{shape:Ls(F.shape,d)}}),n.disposeIntermediateTensorInfo(se)}return n.disposeIntermediateTensorInfo(h),m!=null&&n.disposeIntermediateTensorInfo(x),F}let ok={kernelName:uc,backendName:"cpu",kernelFunc:qy},lk={kernelName:Bl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{equation:a}=s,l=t,{allDims:u,summedDims:h,idDims:f}=Vc(a,l.length);Gc(u.length,f,l);let{path:d,steps:m}=kf(h,f),g=m.length,x=null,R=u.length,N=[];for(let F=0;F<g;++F){for(let H of m[F]){let{permutationIndices:W,expandDims:G}=Hc(R,f[H]),se;Km(W)?se=l[H]:(se=Dl({inputs:{x:l[H]},backend:n,attrs:{perm:W}}),N.push(se));let ge=se.shape.slice();for(let Ce=0;Ce<G.length;++Ce)ge.splice(G[Ce],0,1);Ye(se.shape,ge)||(se=Us({inputs:{x:se},backend:n,attrs:{shape:ge}}),N.push(se)),x===null?x=se:(x=Mx({inputs:{a:se,b:x},backend:n}),N.push(x))}F<g-1&&(d[F]>=0&&(x=qy({inputs:{x},backend:n,attrs:{axis:d[F]-(u.length-R),keepDims:!1}}),N.push(x)),R--)}for(let F of N)F!==x&&n.disposeIntermediateTensorInfo(F);return x}},uk={kernelName:Ul,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{dy:s,y:a}=t;ar([s,a],"eluGrad");let l=new Float32Array(me(a.shape)),u=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values;for(let f=0;f<u.length;++f){let d=u[f];l[f]=d>=1?h[f]:h[f]*(d+1)}return n.makeTensorInfo(a.shape,"float32",l)}},J2=ya((i,t)=>i===t?1:0),eS=La(pl,J2,null,"bool"),ck={kernelName:pl,backendName:"cpu",kernelFunc:eS},hk=Z0,dk=el,pk=Xm,fk=qm,mk=tl,gk=J0,yk=is(Uo,i=>{let t=Math.sign(i),n=Math.abs(i),s=1/(1+hk*n);return t*(1-((((gk*s+mk)*s+fk)*s+pk)*s+dk)*s*Math.exp(-n*n))}),vk={kernelName:Uo,backendName:"cpu",kernelFunc:yk},tS=pp(i=>Math.exp(i)),nS=Cg(zo,tS,"float32"),bk={kernelName:zo,backendName:"cpu",kernelFunc:nS};function _x(i){let{inputs:t,backend:n,attrs:s}=i,{input:a}=t,{dim:l}=s,u=a.shape.length,h=a.shape.slice(),f=l;return l<0&&(ee(-(u+1)<=l,()=>`Axis must be in the interval [${-(u+1)}, ${u}]`),f=u+l+1),h.splice(f,0,1),Us({inputs:{x:a},backend:n,attrs:{shape:h}})}let xk={kernelName:xs,backendName:"cpu",kernelFunc:_x},rS=pp(i=>Math.expm1(i)),wk=Cg(rd,rS),Ak={kernelName:rd,backendName:"cpu",kernelFunc:wk},Ek=ya((i,t)=>i/t),WA=La(Oo,Ek),jA={kernelName:Oo,backendName:"cpu",kernelFunc:WA},iS=ya((i,t)=>i-t),Sk=zA((i,t,n,s)=>({real:i-n,imag:t-s})),XA=La(Mo,iS,Sk),Tk={kernelName:Mo,backendName:"cpu",kernelFunc:XA};function sS(i,t,n){let s=i.shape,a=s[0],l=s[1],u=n.data.get(i.dataId),h=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,d=[a,l],m=me(d),g=Pr("float32",m),x=Pr("float32",m);for(let H=0;H<a;H++){let W=jf({inputs:{x:h},backend:n,attrs:{begin:[H,0],size:[1,l]}}),G=jf({inputs:{x:f},backend:n,attrs:{begin:[H,0],size:[1,l]}}),se=cl({inputs:{real:W,imag:G},backend:n}),{real:ge,imag:Ce}=Mk(se,t,n),Be=Wu(ge,Ce);for(let Ve=0;Ve<l;Ve++){let ze=Uc(Be,Ve);g[H*l+Ve]=ze.real,x[H*l+Ve]=ze.imag}n.disposeIntermediateTensorInfo(W),n.disposeIntermediateTensorInfo(G),n.disposeIntermediateTensorInfo(se)}let R=n.makeTensorInfo(d,"float32",g),N=n.makeTensorInfo(d,"float32",x),F=cl({inputs:{real:R,imag:N},backend:n});return n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(N),F}function Mk(i,t,n){let s=me(i.shape),a=n.data.get(i.dataId),l=n.data.get(a.complexTensorInfos.real.dataId).values,u=n.data.get(a.complexTensorInfos.imag.dataId).values;if(((h=s)&h-1)==0){let f=qA(l,u,s,t,n),d=[i.shape[0],i.shape[1]];if(t){let m=n.makeTensorInfo(d,"float32",f.real),g=n.makeTensorInfo(d,"float32",f.imag),x=n.makeTensorInfo([],"float32",ql(s,"float32")),R=th({inputs:{x},backend:n}),N=jA.kernelFunc({inputs:{a:m,b:x},backend:n}),F=jA.kernelFunc({inputs:{a:g,b:R},backend:n}),H=n.data.get(N.dataId).values,W=n.data.get(F.dataId).values;return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),{real:H,imag:W}}return f}return Hh(function(f,d,m){let g=new Float32Array(2*d);for(let x=0;x<d;x++){let R=0,N=0;for(let F=0;F<d;F++){let H=$c(x*F,d,m),W=Uc(f,F);R+=W.real*H.real-W.imag*H.imag,N+=W.real*H.imag+W.imag*H.real}m&&(R/=d,N/=d),zc(g,R,N,x)}return g}(Wu(l,u),s,t));var h}function qA(i,t,n,s,a){if(n===1)return{real:i,imag:t};let l=Wu(i,t),u=n/2,h=Gh(l),f=h.real,d=h.imag,m=[f.length],g=a.makeTensorInfo(m,"float32",f),x=a.makeTensorInfo(m,"float32",d),R=cl({inputs:{real:g,imag:x},backend:a}),N=Bc(l),F=N.real,H=N.imag,W=[F.length],G=a.makeTensorInfo(W,"float32",F),se=a.makeTensorInfo(W,"float32",H),ge=cl({inputs:{real:G,imag:se},backend:a}),Ce=qA(f,d,u,s,a),Be=Ce.real,Ve=Ce.imag,ze=[Be.length],Xe=a.makeTensorInfo(ze,"float32",Be),tt=a.makeTensorInfo(ze,"float32",Ve),ot=cl({inputs:{real:Xe,imag:tt},backend:a}),ut=qA(F,H,u,s,a),ft=ut.real,kt=ut.imag,Ut=[ft.length],It=a.makeTensorInfo(Ut,"float32",ft),Lt=a.makeTensorInfo(Ut,"float32",kt),zt=cl({inputs:{real:It,imag:Lt},backend:a}),Gt=wb(n,s),qt=[Gt.real.length],Ot=a.makeTensorInfo(qt,"float32",Gt.real),jt=a.makeTensorInfo(qt,"float32",Gt.imag),on=cl({inputs:{real:Ot,imag:jt},backend:a}),bn=Mx({inputs:{a:on,b:zt},backend:a}),An=Xy({inputs:{a:ot,b:bn},backend:a}),Bn=XA({inputs:{a:ot,b:bn},backend:a}),Pn=Wf({inputs:{input:An},backend:a}),mr=Wf({inputs:{input:Bn},backend:a}),_r=Ig({inputs:{input:An},backend:a}),vr=Ig({inputs:{input:Bn},backend:a}),gr=kg({inputs:[Pn,mr],backend:a,attrs:{axis:0}}),Wr=kg({inputs:[_r,vr],backend:a,attrs:{axis:0}}),pi=a.data.get(gr.dataId).values,Oi=a.data.get(Wr.dataId).values;return a.disposeIntermediateTensorInfo(g),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(se),a.disposeIntermediateTensorInfo(ge),a.disposeIntermediateTensorInfo(Xe),a.disposeIntermediateTensorInfo(tt),a.disposeIntermediateTensorInfo(ot),a.disposeIntermediateTensorInfo(It),a.disposeIntermediateTensorInfo(Lt),a.disposeIntermediateTensorInfo(zt),a.disposeIntermediateTensorInfo(Ot),a.disposeIntermediateTensorInfo(jt),a.disposeIntermediateTensorInfo(on),a.disposeIntermediateTensorInfo(bn),a.disposeIntermediateTensorInfo(An),a.disposeIntermediateTensorInfo(Bn),a.disposeIntermediateTensorInfo(Pn),a.disposeIntermediateTensorInfo(_r),a.disposeIntermediateTensorInfo(mr),a.disposeIntermediateTensorInfo(vr),a.disposeIntermediateTensorInfo(gr),a.disposeIntermediateTensorInfo(Wr),{real:pi,imag:Oi}}let _k={kernelName:Jf,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{input:s}=t,a=me(s.shape),l=s.shape[s.shape.length-1],u=Us({inputs:{x:s},backend:n,attrs:{shape:[a/l,l]}}),h=sS(u,!1,n),f=Us({inputs:{x:h},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),f}};function KA(i){let{backend:t,attrs:n}=i,{shape:s,value:a,dtype:l}=n,u=l||hs(a),h=St(u,me(s));return function(f,d,m){f.fill(d)}(h,a),t.makeTensorInfo(s,u,h)}let Ck={kernelName:gp,backendName:"cpu",kernelFunc:KA},Ik={kernelName:vu,backendName:"cpu",kernelFunc:({inputs:i,attrs:t,backend:n})=>{let{image:s}=i,a=n,l=Pr(s.dtype,me(s.shape)),[u,h,f,d]=s.shape,m=a.data.get(s.dataId).values;for(let g=0;g<u;g++){let x=g*f*h*d;for(let R=0;R<h;R++){let N=R*(f*d);for(let F=0;F<f;F++){let H=F*d;for(let W=0;W<d;W++){let G=Math.round(f-F-1),se=x+N+H+W,ge=m[se];G>=0&&G<f&&(ge=m[x+N+G*d+W]),l[se]=ge}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}},aS=pp(i=>Math.floor(i)),kk=Cg(fl,aS),Rk={kernelName:fl,backendName:"cpu",kernelFunc:kk},Nk=ya((i,t)=>Math.floor(i/t)),Lk=La(id,Nk,null,"int32"),Dk={kernelName:id,backendName:"cpu",kernelFunc:Lk},Fk={kernelName:Wl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l,bias:u,preluActivationWeights:h}=t,{strides:f,pad:d,dataFormat:m,dilations:g,dimRoundingMode:x,activation:R,leakyreluAlpha:N}=s,F=Q2({inputs:{x:a,filter:l},backend:n,attrs:{strides:f,pad:d,dataFormat:m,dilations:g,dimRoundingMode:x}});if(u){let H=F;F=Xy({inputs:{a:F,b:u},backend:n}),n.disposeIntermediateTensorInfo(H)}if(R){let H=F;F=UA(n,F,R,h,N),n.disposeIntermediateTensorInfo(H)}return F}},Pk={kernelName:_o,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l,bias:u,preluActivationWeights:h}=t,{strides:f,pad:d,dataFormat:m,dilations:g,dimRoundingMode:x,activation:R,leakyreluAlpha:N}=s,F=Z2({inputs:{x:a,filter:l},backend:n,attrs:{strides:f,pad:d,dataFormat:m,dilations:g,dimRoundingMode:x}});if(u){let H=F;F=Xy({inputs:{a:F,b:u},backend:n}),n.disposeIntermediateTensorInfo(H)}if(R){let H=F;F=UA(n,F,R,h,N),n.disposeIntermediateTensorInfo(H)}return F}};function oS(i,t,n,s,a,l,u,h,f){let d=ci([s,l],n);for(let m=0;m<s;m++){let g=[],x=0;for(let R=0;R<a;R++){let N=i[m*a+R];x+=N*u[R],g.push(N)}if(x<0||x>=f/l)throw new Error(`Invalid indices: ${g} does not index into ${h}`);for(let R=0;R<l;R++)d.values[m*l+R]=t.get(...t.indexToLoc(x*l+R))}return d}let Ok={kernelName:em,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{params:s,indices:a}=t,l=me(s.shape),u=a.shape,h=u[u.length-1],[f,d,m,g]=gm(s,a);if(d===0)return n.makeTensorInfo(f,s.dtype,[]);let x=oS(n.data.get(a.dataId).values,n.bufferSync(s),s.dtype,d,h,m,g,s.shape,l);return n.makeTensorInfo(f,s.dtype,x.values)}};function lS(i,t,n){let s=ci(n,i.dtype);for(let a=0;a<s.size;++a){let l=s.indexToLoc(a).slice(),u=l[0],h=l[2],f=t.locToIndex([u,h]);l[2]=t.values[f];let d=i.locToIndex(l);0<=d&&d<i.values.length&&(s.values[a]=i.values[d])}return s}let Bk={kernelName:vp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,indices:l}=t,{axis:u,batchDims:h}=s;ar([a,l],"gatherV2");let f=Zn(u,a.shape)[0],d=n.data.get(l.dataId).values,m=a.shape[f];for(let se=0;se<d.length;++se){let ge=d[se];ee(ge<=m-1&&ge>=0,()=>`GatherV2: the index value ${ge} is not in [0, ${m-1}]`)}let g=h;h==null&&(g=0);let x=me(l.shape),R=Lo(a,l,f,g),N=Us({inputs:{x:a},backend:n,attrs:{shape:[R.batchSize,R.outerSize,R.dimSize,R.sliceSize]}}),F=Us({inputs:{x:l},backend:n,attrs:{shape:[R.batchSize,x/R.batchSize]}}),H=[R.batchSize,R.outerSize,x/R.batchSize,R.sliceSize],W=n.bufferSync(F),G=lS(n.bufferSync(N),W,H);return n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),n.makeTensorInfo(R.outputShape,G.dtype,G.values)}},uS=ya((i,t)=>i>t?1:0),Uk=La(bp,uS,null,"bool"),zk={kernelName:bp,backendName:"cpu",kernelFunc:Uk},cS=ya((i,t)=>i>=t?1:0),$k=La(sd,cS,null,"bool"),Vk={kernelName:sd,backendName:"cpu",kernelFunc:$k},Hk={kernelName:tm,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{input:s}=t,a=me(s.shape),l=s.shape[s.shape.length-1],u=Us({inputs:{x:s},backend:n,attrs:{shape:[a/l,l]}}),h=sS(u,!0,n),f=Us({inputs:{x:h},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),f}},Gk=is(bu,i=>Number.isFinite(i)?1:0,"bool"),Wk={kernelName:bu,backendName:"cpu",kernelFunc:Gk},jk=is(to,i=>Math.abs(i)===1/0?1:0,"bool"),Xk={kernelName:to,backendName:"cpu",kernelFunc:jk},qk=is($s,i=>Number.isNaN(i)?1:0,"bool"),Kk={kernelName:$s,backendName:"cpu",kernelFunc:qk},hS=ya((i,t)=>i<t?1:0),Yk=La(ml,hS,null,"bool"),Qk={kernelName:ml,backendName:"cpu",kernelFunc:Yk},dS=ya((i,t)=>i<=t?1:0),Zk=La(xu,dS,null,"bool"),Jk={kernelName:xu,backendName:"cpu",kernelFunc:Zk};function pS(i,t,n){let s=(t-i)/(n-1),a=li(n,"float32");a[0]=i;for(let l=1;l<a.length;l++)a[l]=a[l-1]+s;return a}let eR={kernelName:Da,backendName:"cpu",kernelFunc:function(i){let{backend:t,attrs:n}=i,{start:s,stop:a,num:l}=n,u=pS(s,a,l);return t.makeTensorInfo([u.length],"float32",u)}},fS=pp(i=>Math.log(i)),tR=Cg(Vs,fS),nR={kernelName:Vs,backendName:"cpu",kernelFunc:tR},rR=is(ic,i=>Math.log1p(i)),iR={kernelName:ic,backendName:"cpu",kernelFunc:rR},sR=ya((i,t)=>i&&t),aR=La(xp,sR,null,"bool"),oR={kernelName:xp,backendName:"cpu",kernelFunc:aR},lR=is(wp,i=>i?0:1,"bool"),uR={kernelName:wp,backendName:"cpu",kernelFunc:lR},cR=ya((i,t)=>i||t),hR=La(wu,cR,null,"bool"),dR={kernelName:wu,backendName:"cpu",kernelFunc:hR},pR={kernelName:Ap,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{depthRadius:l,bias:u,alpha:h,beta:f}=s;ar(a,"LRN");let d=a.shape[3],m=d-1,g=n.data.get(a.dataId).values,x=me(a.shape),R=new Float32Array(x);function N(F){let H=F%d,W=F-H+Math.max(0,H-l),G=F-H+Math.min(H+l,m),se=0;for(;W<=G;W++){let ge=g[W];se+=ge*ge}return se}for(let F=0;F<x;F++){let H=N(F),W=g[F]*Math.pow(u+h*H,-f);R[F]=W}return n.makeTensorInfo(a.shape,a.dtype,R)}},fR={kernelName:nm,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,y:l,dy:u}=t,{depthRadius:h,bias:f,alpha:d,beta:m}=s;ar(u,"LRNGrad");let g=me(u.shape),x=u.shape[3],R=n.data.get(u.dataId).values,N=n.data.get(a.dataId).values,F=n.data.get(l.dataId).values,H=new Float32Array(g),W=g;for(let G=0;G<W;G++){let se=G%x,ge=G-se+Math.max(0,se-h),Ce=G-se+Math.min(x,se+h+1),Be=0;for(let Ve=ge;Ve<Ce;Ve++)Be+=Math.pow(N[Ve],2);Be=d*Be+f;for(let Ve=ge;Ve<Ce;Ve++){let ze=-2*d*m*N[Ve]*F[G]/Be;G===Ve&&(ze+=Math.pow(Be,-m)),ze*=R[G],H[Ve]+=ze}}return n.makeTensorInfo(u.shape,a.dtype,H)}};function mS(i,t,n,s){let a=Pr(s,me(n));for(let l=0;l<a.length;++l){let u=l*t,h=i[u];for(let f=0;f<t;++f){let d=i[u+f];(Number.isNaN(d)||d>h)&&(h=d)}a[l]=h}return a}function gS(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{reductionIndices:l,keepDims:u}=s,h=n,f=a.shape,d=f.length,m=Zn(l,f),g=m,x=Ws(g,d),R=h.data.get(a.dataId).values;if(x!=null){let se=new Array(d);for(let ge=0;ge<se.length;ge++)se[ge]=f[x[ge]];R=$A(R,f,a.dtype,x,se),g=Zs(g.length,d),f=se}ar(a,"max"),ma("max",g,d);let[N,F]=fa(f,g),H=mS(R,me(F),N,a.dtype),W=h.write(H,N,a.dtype),G=N;return u&&(G=Ls(N,m)),{dataId:W,shape:G,dtype:a.dtype}}let mR={kernelName:Ep,backendName:"cpu",kernelFunc:gS},yS=ya((i,t)=>Math.max(i,t)),gR=La(ld,yS),yR={kernelName:ld,backendName:"cpu",kernelFunc:gR},vR={kernelName:Sp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t;ar(a,"maxPool");let{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s;ee(pa(u,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${u} and dilations '1'`);let d=Ko(a.shape,l,u,1,h,f),m;if(d.filterWidth===1&&d.filterHeight===1&&Ye(d.inShape,d.outShape))m=th({inputs:{x:a},backend:n});else{let g=n.data.get(a.dataId).values,x=Rn(a.shape),R=VA(g,a.shape,a.dtype,x,d,"max");m=n.makeTensorInfo(d.outShape,a.dtype,R.values)}return m}},bR={kernelName:Tp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{filterSize:l,strides:u,pad:h,dimRoundingMode:f,dataFormat:d}=s;ar(a,"maxPool3d");let m=Nu(a.shape,l,u,1,h,f,d),g=j2(n.data.get(a.dataId).values,a.shape,a.dtype,Rn(a.shape),m,"max");return n.makeTensorInfo(g.shape,"float32",g.values)}},xR={kernelName:im,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l}=t,{filterSize:u,strides:h,pad:f,dimRoundingMode:d}=s;ar([a,l],"maxPool3DGrad");let m=Nu(l.shape,u,h,1,f,d),g=function(tt,ot){let ut=ci(ot.outShape,"int32"),ft=ot.strideDepth,kt=ot.strideHeight,Ut=ot.strideWidth,It=ot.dilationDepth,Lt=ot.dilationHeight,zt=ot.dilationWidth,Gt=ot.effectiveFilterDepth,qt=ot.effectiveFilterHeight,Ot=ot.effectiveFilterWidth,jt=ot.padInfo.front,on=ot.padInfo.top,bn=ot.padInfo.left;for(let An=0;An<ot.batchSize;++An)for(let Bn=0;Bn<ot.inChannels;++Bn)for(let Pn=0;Pn<ot.outDepth;++Pn){let mr=Pn*ft-jt,_r=mr;for(;_r<0;)_r+=It;let vr=Math.min(ot.inDepth,Gt+mr);for(let gr=0;gr<ot.outHeight;++gr){let Wr=gr*kt-on,pi=Wr;for(;pi<0;)pi+=Lt;let Oi=Math.min(ot.inHeight,qt+Wr);for(let $r=0;$r<ot.outWidth;++$r){let qr=$r*Ut-bn,Ai=qr;for(;Ai<0;)Ai+=zt;let ia=Math.min(ot.inWidth,Ot+qr),$a=Number.NEGATIVE_INFINITY,Va=-1;for(let sa=_r;sa<vr;sa+=It){let td=sa-mr;for(let Sa=pi;Sa<Oi;Sa+=Lt){let Ha=Sa-Wr;for(let xo=Ai;xo<ia;xo+=zt){let tc=xo-qr,nd=tt.get(An,sa,Sa,xo,Bn);nd>=$a&&($a=nd,Va=td*qt*Ot+Ha*qt+tc)}}}ut.set(Va,An,Pn,gr,$r,Bn)}}}return ut}(n.bufferSync(l),m),x=m.strideDepth,R=m.strideHeight,N=m.strideWidth,F=m.dilationDepth,H=m.dilationHeight,W=m.dilationWidth,G=m.effectiveFilterDepth,se=m.effectiveFilterHeight,ge=m.effectiveFilterWidth,Ce=G-1-m.padInfo.front,Be=ge-1-m.padInfo.left,Ve=se-1-m.padInfo.top,ze=ci(l.shape,"float32"),Xe=n.bufferSync(a);for(let tt=0;tt<m.batchSize;++tt)for(let ot=0;ot<m.inChannels;++ot)for(let ut=0;ut<m.inDepth;++ut)for(let ft=0;ft<m.inHeight;++ft)for(let kt=0;kt<m.inWidth;++kt){let Ut=ut-Ce,It=ft-Ve,Lt=kt-Be,zt=0;for(let Gt=0;Gt<G;Gt+=F){let qt=(Ut+Gt)/x;if(!(qt<0||qt>=m.outDepth||Math.floor(qt)!==qt))for(let Ot=0;Ot<se;Ot+=H){let jt=(It+Ot)/R;if(!(jt<0||jt>=m.outHeight||Math.floor(jt)!==jt))for(let on=0;on<ge;on+=W){let bn=(Lt+on)/N;if(bn<0||bn>=m.outWidth||Math.floor(bn)!==bn)continue;let An=G*se*ge-1-g.get(tt,qt,jt,bn,ot)===Gt*se*ge+Ot*ge+on?1:0;An!==0&&(zt+=Xe.get(tt,qt,jt,bn,ot)*An)}}}ze.set(zt,tt,ut,ft,kt,ot)}return n.makeTensorInfo(ze.shape,ze.dtype,ze.values)}},wR={kernelName:rm,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l,output:u}=t,h=l;ar([l,u],"maxPoolGrad");let{filterSize:f,strides:d,pad:m,dimRoundingMode:g}=s,x=Ko(h.shape,f,d,1,m,g),R=n.data.get(h.dataId).values,N=ci(x.outShape,h.dtype,W2(R,h.shape,h.dtype,x).values),F=x.strideHeight,H=x.strideWidth,W=x.dilationHeight,G=x.dilationWidth,se=x.effectiveFilterHeight,ge=x.effectiveFilterWidth,Ce=ge-1-x.padInfo.left,Be=se-1-x.padInfo.top,Ve=ci(h.shape,"float32"),ze=n.data.get(a.dataId).values,Xe=ci(a.shape,"float32",ze);for(let tt=0;tt<x.batchSize;++tt)for(let ot=0;ot<x.inChannels;++ot)for(let ut=0;ut<x.inHeight;++ut)for(let ft=0;ft<x.inWidth;++ft){let kt=ut-Be,Ut=ft-Ce,It=0;for(let Lt=0;Lt<se;Lt+=W){let zt=(kt+Lt)/F;if(!(zt<0||zt>=x.outHeight||Math.floor(zt)!==zt))for(let Gt=0;Gt<ge;Gt+=G){let qt=(Ut+Gt)/H;if(qt<0||qt>=x.outWidth||Math.floor(qt)!==qt)continue;let Ot=se*ge-1-N.get(tt,zt,qt,ot)===Lt*ge+Gt?1:0;Ot!==0&&(It+=Xe.get(tt,zt,qt,ot)*Ot)}}Ve.set(It,tt,ut,ft,ot)}return n.makeTensorInfo(Ve.shape,Ve.dtype,Ve.values)}},AR={kernelName:sm,backendName:"cpu",kernelFunc:({inputs:i,attrs:t,backend:n})=>{let{x:s}=i,{filterSize:a,strides:l,pad:u,includeBatchInIndex:h}=t,f=n;ar(s,"MaxPoolWithArgmax");let d=f.data.get(s.dataId).values,m=Ko(s.shape,a,l,[1,1],u),[g,x]=function(F,H,W,G,se){let ge=VA(F,0,W,Rn(H),se,"max"),Ce=W2(F,H,W,se,!0,G);return[ge.values,Ce.values]}(d,s.shape,s.dtype,h,m),R=f.write(g,m.outShape,s.dtype),N=f.write(x,m.outShape,s.dtype);return[{dataId:R,shape:m.outShape,dtype:s.dtype},{dataId:N,shape:m.outShape,dtype:"int32"}]}},ER={kernelName:nh,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s,h=Zn(l,a.shape),f=me(fa(a.shape,h)[1]),d=[],m=n.makeTensorInfo([],"float32",new Float32Array([f]));d.push(m);let g=fp({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});d.push(g);let x=WA({inputs:{a:g,b:m},backend:n});d.push(x);let R=qy({inputs:{x},backend:n,attrs:{axis:l,keepDims:u}});return d.forEach(N=>n.disposeIntermediateTensorInfo(N)),R}},SR={kernelName:ud,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s;ar(a,"min");let h=Zn(l,a.shape),f=h,d=Ws(f,a.shape.length),m=a;d!=null&&(m=Dl({inputs:{x:a},backend:n,attrs:{perm:d}}),f=Zs(f.length,a.shape.length)),ma("min",f,m.shape.length);let[g,x]=fa(m.shape,f),R=me(x),N=li(me(g),m.dtype),F=n.data.get(m.dataId).values;for(let W=0;W<N.length;++W){let G=W*R,se=F[G];for(let ge=0;ge<R;++ge){let Ce=F[G+ge];(Number.isNaN(Ce)||Ce<se)&&(se=Ce)}N[W]=se}d!=null&&n.disposeIntermediateTensorInfo(m);let H=n.makeTensorInfo(g,m.dtype,N);if(u){let W=Us({inputs:{x:H},backend:n,attrs:{shape:Ls(g,h)}});return n.disposeIntermediateTensorInfo(H),W}return H}},vS=ya((i,t)=>Math.min(i,t)),TR=La(rh,vS),MR={kernelName:rh,backendName:"cpu",kernelFunc:TR},_R={kernelName:Mp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{paddings:l,mode:u}=s;ar(a,"mirrorPad");let h=l.map((G,se)=>G[0]+a.shape[se]+G[1]),f=l.map(G=>G[0]),d=l.map((G,se)=>G[0]+a.shape[se]),m=u==="reflect"?0:1,g=n.data.get(a.dataId).values,x=a.shape.length,R=Rn(a.shape),N=me(h),F=h.length,H=Rn(h),W=Pr(a.dtype,N);for(let G=0;G<N;G++){let se=$e(G,F,H);for(let Ce=0;Ce<F;Ce++)se[Ce]<f[Ce]?se[Ce]=2*f[Ce]-se[Ce]-m:se[Ce]>=d[Ce]&&(se[Ce]=2*(d[Ce]-1)-se[Ce]+m);se=se.map((Ce,Be)=>Ce-f[Be]);let ge=zs(se,x,R);W[G]=g[ge]}return{dataId:n.write(W,h,a.dtype),shape:h,dtype:a.dtype}}},CR=ya((i,t)=>{let n=i%t;return i<0&&t<0||i>=0&&t>=0?n:(n+t)%t}),IR=La(ih,CR),kR={kernelName:ih,backendName:"cpu",kernelFunc:IR};function bS(i){let{inputs:t,backend:n,attrs:s}=i,{logits:a}=t,{dim:l}=s,u=a.shape.length,h=l;if(h===-1&&(h=u-1),h!==u-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${u} and dim was ${h}`);let f=Zn([h],a.shape),d=gS({inputs:{x:a},backend:n,attrs:{reductionIndices:f,keepDims:!1}}),m=Ls(d.shape,f),g=Us({inputs:{x:d},backend:n,attrs:{shape:m}}),x=XA({inputs:{a,b:g},backend:n}),R=nS({inputs:{x},backend:n}),N=qy({inputs:{x:R},backend:n,attrs:{axis:f,keepDims:!1}}),F=Us({inputs:{x:N},backend:n,attrs:{shape:m}}),H=WA({inputs:{a:R,b:F},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),H}let RR={kernelName:Ip,backendName:"cpu",kernelFunc:bS},NR={kernelName:un,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{logits:a}=t,{numSamples:l,seed:u,normalized:h}=s;ar(a,"multinomial");let f=h?a:bS({inputs:{logits:a},backend:n,attrs:{dim:-1}}),d=f.shape[0],m=f.shape[1],g=n.data.get(f.dataId).values,x=[d,l],R=li(me(x),"int32");for(let N=0;N<d;++N){let F=N*m,H=new Float32Array(m-1);H[0]=g[F];for(let se=1;se<H.length;++se)H[se]=H[se-1]+g[F+se];let W=$d.alea(u.toString()),G=N*l;for(let se=0;se<l;++se){let ge=W();R[G+se]=H.length;for(let Ce=0;Ce<H.length;Ce++)if(ge<H[Ce]){R[G+se]=Ce;break}}}return h||n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(x,"int32",R)}};function xS(i,t,n){let s=ql(-1,n);return GA([],t,s,i,n)}let LR={kernelName:cd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s}=t;ar(s,"neg");let a=n.data.get(s.dataId).values,[l,u]=xS(a,s.shape,s.dtype);return n.makeTensorInfo(u,s.dtype,l)}},DR=Xd,FR={kernelName:Au,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{boxes:a,scores:l}=t,{maxOutputSize:u,iouThreshold:h,scoreThreshold:f}=s;ar(a,"NonMaxSuppression");let d=n.data.get(a.dataId).values,m=n.data.get(l.dataId).values,{selectedIndices:g}=DR(d,m,u,h,f);return n.makeTensorInfo([g.length],"int32",new Int32Array(g))}},PR=qd,OR={kernelName:sc,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{boxes:a,scores:l}=t,{maxOutputSize:u,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:d}=s;ar(a,"NonMaxSuppressionPadded");let m=n.data.get(a.dataId).values,g=n.data.get(l.dataId).values,{selectedIndices:x,validOutputs:R}=PR(m,g,u,h,f,d);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([],"int32",new Int32Array([R]))]}},BR=Kd,UR={kernelName:Cp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{boxes:a,scores:l}=t,{maxOutputSize:u,iouThreshold:h,scoreThreshold:f,softNmsSigma:d}=s;ar(a,"NonMaxSuppressionWithScore");let m=n.data.get(a.dataId).values,g=n.data.get(l.dataId).values,x=u,R=h,N=f,F=d,{selectedIndices:H,selectedScores:W}=BR(m,g,x,R,N,F);return[n.makeTensorInfo([H.length],"int32",new Int32Array(H)),n.makeTensorInfo([W.length],"float32",new Float32Array(W))]}},wS=ya((i,t)=>i!==t?1:0),zR=La(_p,wS,null,"bool"),$R={kernelName:_p,backendName:"cpu",kernelFunc:zR},VR={kernelName:ac,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{indices:a}=t,{depth:l,onValue:u,offValue:h}=s;ar(a,"oneHot");let f=me(a.shape),d=new Float32Array(f*l);d.fill(h);let m=n.data.get(a.dataId).values;for(let g=0;g<f;++g)m[g]>=0&&m[g]<l&&(d[g*l+m[g]]=u);return n.makeTensorInfo([...a.shape,l],"int32",d)}};function Cx(i){let{inputs:t,backend:n}=i,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){let a=Wf({inputs:{input:s},backend:n}),l=Cx({inputs:{x:a},backend:n}),u=Ig({inputs:{input:s},backend:n}),h=Cx({inputs:{x:u},backend:n}),f=cl({inputs:{real:l,imag:h},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),f}return KA({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}let HR={kernelName:yd,backendName:"cpu",kernelFunc:Cx},GR={kernelName:Ga,backendName:"cpu",kernelFunc:function i(t){let{inputs:n,backend:s}=t,{x:a}=n;if(a.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(a.dtype==="complex64"){let l=Wf({inputs:{input:a},backend:s}),u=i({inputs:{x:l},backend:s}),h=Ig({inputs:{input:a},backend:s}),f=Cx({inputs:{x:h},backend:s}),d=cl({inputs:{real:u,imag:f},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(f),d}return KA({backend:s,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function AS(i){let{inputs:t,backend:n,attrs:s}=i,{axis:a}=s;if(t.length===1)return _x({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let l=t[0].shape,u=t[0].dtype;t.forEach(d=>{ie(l,d.shape,"All tensors passed to stack must have matching shapes"),ee(u===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});let h=[],f=kg({inputs:t.map(d=>{let m=_x({inputs:{input:d},backend:n,attrs:{dim:a}});return h.push(m),m}),backend:n,attrs:{axis:a}});return h.forEach(d=>n.disposeIntermediateTensorInfo(d)),f}let WR={kernelName:sh,backendName:"cpu",kernelFunc:AS},ES={kernelName:zl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{paddings:l,constantValue:u}=s;ar(a,"pad");let h=l.map((W,G)=>W[0]+a.shape[G]+W[1]),f=l.map(W=>W[0]),d=n.data.get(a.dataId).values,m=me(a.shape),g=a.shape.length,x=Rn(a.shape),R=me(h),N=h.length,F=Rn(h),H=Pr(a.dtype,R);u!==0&&H.fill(u);for(let W=0;W<m;W++)H[zs($e(W,g,x).map((G,se)=>G+f[se]),N,F)]=d[W];return{dataId:n.write(H,h,a.dtype),shape:h,dtype:a.dtype}}},jR=ya((i,t)=>Math.pow(i,t)),XR=La(Fn,jR),qR={kernelName:Fn,backendName:"cpu",kernelFunc:XR};function SS(i,t,n,s){let[a,l]=fa(i,s),u=_a(t,"int32"),h=li(me(a),u),f=me(l);for(let d=0;d<h.length;++d){let m=d*f,g=1;for(let x=0;x<f;++x)g*=n[m+x];h[d]=g}return{outVals:h,outShape:a,outDtype:u}}let KR={kernelName:gl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s;ar(a,"prod");let h=a.shape.length,f=Zn(l,a.shape),d=Ws(f,h),m=f,g=a,x=[];d!=null&&(g=Dl({inputs:{x:a},backend:n,attrs:{perm:d}}),x.push(g),m=Zs(m.length,h));let R=n.data.get(g.dataId).values,{outVals:N,outShape:F,outDtype:H}=SS(g.shape,g.dtype,R,m),W=F;return u&&(W=Ls(F,f)),x.forEach(G=>n.disposeIntermediateTensorInfo(G)),n.makeTensorInfo(W,H,N)}};function TS(i,t,n,s){if(i===t||i<t&&n<0||t<i&&n>1)return li(0,s);let a=li(Math.abs(Math.ceil((t-i)/n)),s);t<i&&n===1&&(n=-1),a[0]=i;for(let l=1;l<a.length;l++)a[l]=a[l-1]+n;return a}let YR={kernelName:am,backendName:"cpu",kernelFunc:function(i){let{backend:t,attrs:n}=i,{start:s,stop:a,dtype:l,step:u}=n,h=TS(s,a,u,l);return t.makeTensorInfo([h.length],l,h)}},QR=is(oc,i=>1/i),ZR={kernelName:oc,backendName:"cpu",kernelFunc:QR},JR={kernelName:Hs,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a}=t,{alignCorners:l,halfPixelCenters:u,size:h}=s;ar(a,"resizeBilinear");let f=Rn(a.shape),[d,m]=h,[g,x,R,N]=a.shape,F=n.data.get(a.dataId).values,H=new Float32Array(me([g,d,m,N])),W=[l&&d>1?x-1:x,l&&m>1?R-1:R],G=[l&&d>1?d-1:d,l&&m>1?m-1:m],se=0,ge=W[0]/G[0],Ce=W[1]/G[1];for(let Be=0;Be<g;Be++)for(let Ve=0;Ve<d;Ve++){let ze;ze=u?ge*(Ve+.5)-.5:ge*Ve;let Xe=Math.max(0,Math.floor(ze)),tt=ze-Xe,ot=Math.min(x-1,Math.ceil(ze)),ut=Be*f[0]+Xe*f[1],ft=Be*f[0]+ot*f[1];for(let kt=0;kt<m;kt++){let Ut;Ut=u?Ce*(kt+.5)-.5:Ce*kt;let It=Math.max(0,Math.floor(Ut)),Lt=Ut-It,zt=Math.min(R-1,Math.ceil(Ut)),Gt=ut+It*f[2],qt=ft+It*f[2],Ot=ut+zt*f[2],jt=ft+zt*f[2];for(let on=0;on<N;on++){let bn=F[Gt+on],An=F[qt+on],Bn=bn+(F[Ot+on]-bn)*Lt,Pn=Bn+(An+(F[jt+on]-An)*Lt-Bn)*tt;H[se++]=Pn}}}return n.makeTensorInfo([g,d,m,N],"float32",H)}},e3={kernelName:je,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a,dy:l}=t,{alignCorners:u}=s;ar([l,a],"resizeBilinearGrad");let h=Rn(a.shape),[f,d,m,g]=a.shape,[,x,R]=l.shape,N=new Float32Array(f*d*m*g),F=[u&&x>1?d-1:d,u&&R>1?m-1:m],H=[u&&x>1?x-1:x,u&&R>1?R-1:R],W=F[0]/H[0],G=F[1]/H[1],se=n.data.get(l.dataId).values,ge=0;for(let Ce=0;Ce<f;Ce++){let Be=Ce*h[0];for(let Ve=0;Ve<x;Ve++){let ze=Ve*W,Xe=Math.floor(ze),tt=Math.min(Math.ceil(ze),d-1),ot=Be+Xe*h[1],ut=Be+tt*h[1],ft=ze-Xe,kt=1-ft;for(let Ut=0;Ut<R;Ut++){let It=Ut*G,Lt=Math.floor(It),zt=Math.min(Math.ceil(It),m-1),Gt=It-Lt,qt=1-Gt,Ot=ot+Lt*h[2],jt=ot+zt*h[2],on=ut+Lt*h[2],bn=ut+zt*h[2],An=kt*qt,Bn=kt*Gt,Pn=ft*qt,mr=ft*Gt;for(let _r=0;_r<g;_r++){let vr=se[ge++];N[Ot+_r]+=vr*An,N[jt+_r]+=vr*Bn,N[on+_r]+=vr*Pn,N[bn+_r]+=vr*mr}}}}return n.makeTensorInfo([f,m,d,g],"float32",N)}},t3={kernelName:hd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a}=t,{alignCorners:l,halfPixelCenters:u,size:h}=s;ar(a,"resizeNearestNeighbor");let f=Rn(a.shape),[d,m]=h,[g,x,R,N]=a.shape,F=n.data.get(a.dataId).values,H=new Float32Array(g*d*m*N),W=[l&&d>1?x-1:x,l&&m>1?R-1:R],G=[l&&d>1?d-1:d,l&&m>1?m-1:m],se=W[0]/G[0],ge=W[1]/G[1],Ce=0;for(let Be=0;Be<g;Be++){let Ve=Be*f[0];for(let ze=0;ze<d;ze++){let Xe=u?se*(ze+.5):se*ze,tt=Math.min(x-1,l?Math.round(Xe):Math.floor(Xe));u&&(tt=Math.max(0,tt));let ot=Ve+tt*f[1];for(let ut=0;ut<m;ut++){let ft=u?ge*(ut+.5):ge*ut,kt=Math.min(R-1,l?Math.round(ft):Math.floor(ft));u&&(kt=Math.max(0,kt));let Ut=ot+kt*f[2];for(let It=0;It<N;It++){let Lt=F[Ut+It];H[Ce++]=Lt}}}}return n.makeTensorInfo([g,d,m,N],a.dtype,H)}},n3={kernelName:ah,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a,dy:l}=t,{alignCorners:u}=s;ar([l,a],"resizeNearestNeighborGrad");let h=Rn(a.shape),f=Rn(l.shape),[d,m,g,x]=a.shape,[,R,N]=l.shape,F=new Float32Array(d*m*g*x),H=n.data.get(l.dataId).values,W=[u&&R>1?m-1:m,u&&N>1?g-1:g],G=[u&&R>1?R-1:R,u&&N>1?N-1:N],se=W[0]/G[0],ge=W[1]/G[1],Ce=1/se,Be=1/ge,Ve=2*Math.ceil(Ce)+2,ze=2*Math.ceil(Be)+2;for(let Xe=0;Xe<d;Xe++){let tt=Xe*h[0];for(let ot=0;ot<m;ot++){let ut=tt+ot*h[1],ft=Math.floor(ot*Ce),kt=Math.floor(ft-Ve/2);for(let Ut=0;Ut<g;Ut++){let It=ut+Ut*h[2],Lt=Math.floor(Ut*Be),zt=Math.floor(Lt-ze/2);for(let Gt=0;Gt<x;Gt++){let qt=0;for(let Ot=0;Ot<Ve;Ot++){let jt=Ot+kt;if(jt<0||jt>=R)continue;let on=tt+jt*f[1],bn=jt*se;if(ot===Math.min(m-1,u?Math.round(bn):Math.floor(bn)))for(let An=0;An<ze;An++){let Bn=An+zt;if(Bn<0||Bn>=N)continue;let Pn=on+Bn*f[2],mr=Bn*ge;Ut===Math.min(g-1,u?Math.round(mr):Math.floor(mr))&&(qt+=H[Pn+Gt])}}F[It+Gt]=qt}}}}return n.makeTensorInfo(a.shape,a.dtype,F)}},r3={kernelName:dd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{dims:l}=s;ar(a,"reverse");let u=a.shape.length,h=Zn(l,a.shape);if(u===0)return th({inputs:{x:a},backend:n});let f=new Hi(a.shape,a.dtype),d=n.bufferSync(a);for(let m=0;m<f.size;m++){let g=f.indexToLoc(m),x=g.slice();h.forEach(R=>x[R]=a.shape[R]-1-x[R]),f.set(d.get(...x),...g)}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},i3={kernelName:um,backendName:"cpu",kernelFunc:({inputs:i,attrs:t,backend:n})=>{let{image:s}=i,{radians:a,fillValue:l,center:u}=t,h=n,f=Pr(s.dtype,me(s.shape)),[d,m,g,x]=s.shape,[R,N]=Zd(u,m,g),F=Math.sin(a),H=Math.cos(a),W=h.data.get(s.dataId).values;for(let G=0;G<d;G++){let se=G*g*m*x;for(let ge=0;ge<m;ge++){let Ce=ge*(g*x);for(let Be=0;Be<g;Be++){let Ve=Be*x;for(let ze=0;ze<x;ze++){let Xe=[d,ge,Be,ze],tt=Xe[2],ot=Xe[1],ut=(tt-R)*H-(ot-N)*F,ft=(tt-R)*F+(ot-N)*H;ut=Math.round(ut+R),ft=Math.round(ft+N);let kt=l;typeof l!="number"&&(kt=ze===3?255:l[ze]),ut>=0&&ut<g&&ft>=0&&ft<m&&(kt=W[se+ft*(g*x)+ut*x+ze]),f[se+Ce+Ve+ze]=kt}}}}return{dataId:h.write(f,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}},s3=is(va,i=>{let t=Math.floor(i);return i-t<.5?Math.floor(i):i-t>.5?Math.ceil(i):t%2==0?t:t+1}),a3={kernelName:va,backendName:"cpu",kernelFunc:s3},MS=pp(i=>1/Math.sqrt(i)),o3=Cg(no,MS),l3={kernelName:no,backendName:"cpu",kernelFunc:o3};function _S(i,t,n,s,a,l,u,h,f,d){let m=[s/a,a],g=i.values,x=t.values;if(s===0)return ci(n,t.dtype);let R=ci(m,t.dtype);R.values.fill(f);for(let N=0;N<l;N++){let F=[],H=0;for(let W=0;W<u;W++){let G=g[N*u+W];F.push(G),H+=G*h[W]}if(H<0||H>=s/a)throw new Error(`Invalid indices: ${F} does not index into ${n}`);for(let W=0;W<a;W++)d?R.values[H*a+W]+=x[N*a+W]:R.values[H*a+W]=t.rank===0?x[0]:x[N*a+W]}return R}let u3={kernelName:Vl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{indices:a,updates:l}=t,{shape:u}=s,{sliceRank:h,numUpdates:f,sliceSize:d,strides:m,outputSize:g}=_d(0,a,u),x=_S(n.bufferSync(a),n.bufferSync(l),u,g,d,f,h,m,0,!0);return n.makeTensorInfo(u,x.dtype,x.values)}},c3={kernelName:oh,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{condition:s,t:a,e:l}=t;ar([s,a,l],"select");let u=s.shape.length,h=n.data.get(s.dataId).values,f=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values,m=_a(a.dtype,l.dtype),g=li(me(a.shape),m),x=0,R=u===0||u>1||a.shape.length===1?1:me(a.shape.slice(1));for(let N=0;N<h.length;N++)for(let F=0;F<R;F++)h[N]===1?g[x++]=f[N]:g[x++]=d[N];return n.makeTensorInfo(a.shape,m,g)}},h3=Oc,d3=Jd,p3=is(yl,i=>i>=0?d3*i:h3*(Math.exp(i)-1)),f3={kernelName:yl,backendName:"cpu",kernelFunc:p3},m3=is(To,i=>i<0?-1:i>0?1:0),g3={kernelName:To,backendName:"cpu",kernelFunc:m3},y3=is(vl,i=>Math.sin(i)),v3={kernelName:vl,backendName:"cpu",kernelFunc:y3},b3=is(So,i=>Math.sinh(i)),x3={kernelName:So,backendName:"cpu",kernelFunc:b3},CS=Math.log(11920928955078125e-23)+2,w3=is(Gl,i=>{let t=i>-CS,n=i<CS,s=Math.exp(i),a;return a=n?s:t?i:Math.log(1+s),a}),A3={kernelName:Gl,backendName:"cpu",kernelFunc:w3},E3={kernelName:bl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{blockShape:l,paddings:u}=s;ar([a],"spaceToBatchND");let h=me(l),f=[[0,0]];f.push(...u);for(let H=1+l.length;H<a.shape.length;++H)f.push([0,0]);let d=ES.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:f,constantValue:0}}),m=Cf(d.shape,l,h,!1),g=Gu(m.length,l.length,!1),x=If(d.shape,l,h,!1),R=Us({inputs:{x:d},backend:n,attrs:{shape:m}}),N=Dl({inputs:{x:R},backend:n,attrs:{perm:g}}),F=Us({inputs:{x:N},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(N),F}};function IS(i,t,n,s,a,l,u){let h=t[0],f=l[0],d=new Array(f),m=new Array(h),g=t[1];if(f===0){if(h!==0)throw new Error(Nf(h));return[St(n,0),[0,g],St(a,0),d,m]}let x=!0,R=0,N=new Array(f).fill(0);for(let H=0;H<h;++H){let W=i[H*g];if(W<0)throw new Error(Ym(H,W));if(W>=f)throw new Error(Qm(H,W,f));++N[W],x=x&&W>=R,R=W}let F=!0;for(let H=0;H<f;++H){let W=N[H]===0;d[H]=W,F=F&&!W,N[H]=Math.max(N[H],1),H>0&&(N[H]+=N[H-1])}if(F&&x){let H=i,W=s;for(let G=0;G<h;++G)m[G]=G;return[H,[h,g],W,d,m]}{let H=N[f-1],W=St(n,H*g),G=St(a,H),se=new Array(f).fill(0);for(let ge=0;ge<h;++ge){let Ce=i[ge*g],Be=se[Ce],Ve=(Ce===0?0:N[Ce-1])+Be;se[Ce]++;for(let ze=0;ze<g;++ze)W[Ve*g+ze]=i[ge*g+ze];G[Ve]=s[ge],m[ge]=Ve}for(let ge=0;ge<f;++ge)if(se[ge]===0){let Ce=ge===0?0:N[ge-1];W[Ce*g+0]=ge;for(let Be=1;Be<g;++Be)W[Ce*g+Be]=0;G[Ce]=u}return[W,[H,g],G,d,m]}}let S3={kernelName:kp,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{indices:s,values:a,denseShape:l,defaultValue:u}=t;if(l.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${l.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${a.shape}`);if(u.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${u.shape}`);let h=n.data.get(s.dataId).values,f=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values,m=n.data.get(u.dataId).values[0],[g,x,R,N,F]=IS(h,s.shape,s.dtype,f,a.dtype,d,m);return[n.makeTensorInfo(x,s.dtype,g),n.makeTensorInfo([x[0]],a.dtype,R),n.makeTensorInfo([N.length],"bool",new Uint8Array(N.map(H=>Number(H)))),n.makeTensorInfo([F.length],s.dtype,new Int32Array(F))]}};function kS(i,t,n,s,a){let l=me(s),u=t[0],h=a.length,f=[],d=1,m=-1;for(let F=0;F<h;++F){let H=a[F];if(H===-1){if(m!==-1)throw new Error(Zm(m,F));m=F,f.push(1)}else{if(H<0)throw new Error(Jm(F,H));d*=H,f.push(H)}}if(m!==-1){if(d<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");let F=Math.trunc(l/d);if(d*F!==l)throw new Error(eg(s,f));f[m]=F}if(me(f)!==l)throw new Error(tg(s,f));let g=s.length,x=[];if(g>0){x[g-1]=1;for(let F=g-2;F>=0;--F)x[F]=x[F+1]*s[F+1]}let R=[];if(h>0){R[h-1]=1;for(let F=h-2;F>=0;--F)R[F]=R[F+1]*f[F+1]}let N=St(n,u*h);for(let F=0;F<u;++F){let H=0;for(let W=0;W<g;++W)H+=i[F*g+W]*x[W];for(let W=0;W<h;++W)N[F*h+W]=Math.trunc(H/R[W]),H%=R[W]}return[N,[u,h],f]}let T3={kernelName:uh,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{inputIndices:s,inputShape:a,newShape:l}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(l.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${l.shape}`);let u=Array.from(n.data.get(a.dataId).values),h=n.data.get(s.dataId).values,f=Array.from(n.data.get(l.dataId).values),[d,m,g]=kS(h,s.shape,s.dtype,u,f);return[n.makeTensorInfo(m,s.dtype,d),n.makeTensorInfo([g.length],l.dtype,new Int32Array(g))]}};function YA(i,t,n,s,a,l=!1,u=0){let h=s.length,f=[t[0],i.length/t[0]],d=f[1],m=h>0?a[h-1]+1:0;if(m<0)throw new Error("segment ids must be >= 0");let g=t.slice();g[0]=m;let x=St(n,g.reduce((W,G)=>W*G,1));if(h===0)return m>0&&x.fill(u),[x,g];if(m<=0)throw new Error("segment ids must be >= 0");let R=0,N=1,F=0,H=a[R];for(;;){let W=0;if(N<h){if(W=a[N],H===W){++N;continue}if(H>=W)throw new Error("segment ids are not increasing")}if(H<0||H>=m)throw new Error(cu(H,m));H>F&&x.fill(u,F*d,H*d);for(let G=R;G<N;++G){let se=s[G];if(se<0||se>=f[0])throw new Error(ty(G,s[G],f[0]));for(let ge=0;ge<d;ge++)x[H*d+ge]+=i[se*d+ge]}if(l)for(let G=0;G<d;G++)x[H*d+G]/=N-R;if(R=N,++N,F=H+1,H=W,N>h)break}return F<m&&x.fill(u,F*d,m*d),[x,g]}let M3={kernelName:pd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{data:s,indices:a,segmentIds:l}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${a.shape}`);if(l.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${l.shape}`);if(a.shape[0]!==l.shape[0])throw new Error("segmentIds and indices should have same size.");let u=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,[d,m]=YA(u,s.shape,s.dtype,h,f,!0);return n.makeTensorInfo(m,s.dtype,d)}},_3={kernelName:xl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n}=i,{data:s,indices:a,segmentIds:l}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${a.shape}`);if(l.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${l.shape}`);if(a.shape[0]!==l.shape[0])throw new Error("segmentIds and indices should have same size.");let u=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,[d,m]=YA(u,s.shape,s.dtype,h,f);return n.makeTensorInfo(m,s.dtype,d)}},C3={kernelName:Vo,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{sparseIndices:a,sparseValues:l,defaultValue:u}=t,{outputShape:h}=s,{sliceRank:f,numUpdates:d,sliceSize:m,strides:g,outputSize:x}=_d(0,a,h),R=_S(n.bufferSync(a),n.bufferSync(l),h,x,m,d,f,g,n.data.get(u.dataId).values[0],!1);return n.makeTensorInfo(h,R.dtype,R.values)}},I3={kernelName:lh,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{numOrSizeSplits:l,axis:u}=s,h=Zn(u,a.shape)[0],f=Rf(a,l,h),d=new Array(a.shape.length).fill(0),m=a.shape.slice();return f.map(g=>{let x=[...m];x[h]=g;let R=jf({inputs:{x:a},backend:n,attrs:{begin:d,size:x}});return d[h]+=g,R})}},k3=pp(i=>Math.sqrt(i)),R3=is(Eu,i=>Math.sqrt(i)),N3={kernelName:Eu,backendName:"cpu",kernelFunc:R3},L3={kernelName:ch,backendName:"cpu",kernelFunc:({inputs:i,backend:t})=>{let{x:n}=i,s=t;ar(n,"square");let a=s.data.get(n.dataId).values,l=new Float32Array(a.length);for(let u=0;u<a.length;++u){let h=a[u];l[u]=h*h}return{dataId:s.write(l,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},RS=ya((i,t)=>{let n=i-t;return n*n}),D3=La(cc,RS),F3={kernelName:cc,backendName:"cpu",kernelFunc:D3},P3=is(Go,(i,t)=>{let n=t;return isNaN(i)?NaN:i>0?1:n.alpha}),O3={kernelName:Go,backendName:"cpu",kernelFunc:P3};function NS(i,t,n,s){let a=ci(i,t.dtype);for(let l=0;l<a.size;l++){let u=a.indexToLoc(l),h=new Array(u.length);for(let f=0;f<h.length;f++)h[f]=u[f]*n[f]+s[f];a.set(t.get(...h),...u)}return a}let B3={kernelName:wl,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{begin:l,end:u,strides:h,beginMask:f,endMask:d,ellipsisMask:m,newAxisMask:g,shrinkAxisMask:x}=s;ar(a,"stridedSlice");let{finalShapeSparse:R,finalShape:N,isIdentity:F,sliceDim0:H,isSimpleSlice:W,begin:G,end:se,strides:ge}=d0(a.shape,l,u,h,f,d,m,g,x),Ce;if(F)Ce=Us({inputs:{x:a},backend:n,attrs:{shape:N}});else if(H||W){ee(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let Be=u0(G,se,ge),Ve=jf({inputs:{x:a},backend:n,attrs:{begin:G,size:Be}});Ce=Us({inputs:{x:Ve},backend:n,attrs:{shape:N}}),n.disposeIntermediateTensorInfo(Ve)}else{let Be=NS(R,n.bufferSync(a),ge,G);Ce=n.makeTensorInfo(N,Be.dtype,Be.values)}return Ce}};class U3{constructor(t,n,s,a,l,u){this.separator=Co(t),this.nGramWidths=n,this.leftPad=Co(s),this.rightPad=Co(a),this.padWidth=l,this.preserveShort=u}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){let s=this.getPadWidth(n);return Math.max(0,t+2*s-n+1)}createNGrams(t,n,s,a,l,u){for(let h=0;h<l;++h){let f=this.getPadWidth(u),d=Math.max(0,f-h),m=Math.max(0,f-(l-(h+1))),g=u-(d+m),x=n+(d>0?0:h-f),R=0;R+=d*this.leftPad.length;for(let W=0;W<g;++W)R+=t[x+W].length;R+=m*this.rightPad.length,R+=(d+m+g-1)*this.separator.length,s[a+h]=new Uint8Array(R);let N=s[a+h],F=0,H=W=>W.forEach(G=>N[F++]=G);for(let W=0;W<d;++W)H(this.leftPad),H(this.separator);for(let W=0;W<g-1;++W)H(t[x+W]),H(this.separator);if(g>0){H(t[x+g-1]);for(let W=0;W<m;++W)H(this.separator),H(this.rightPad)}else{for(let W=0;W<m-1;++W)H(this.rightPad),H(this.separator);H(this.rightPad)}}}compute(t,n){let s=t.length,a=n.length;if(a>0){let f=n[0];if(f!==0)throw new Error(`First split value must be 0, got ${f}`);for(let d=1;d<a;++d){let m=n[d]>=f;if(m=m&&n[d]<=s,!m)throw new Error(`Invalid split value ${n[d]}, must be in [${f}, ${s}]`);f=n[d]}if(f!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${f}`)}let l=a-1,u=St("int32",a);if(s===0||a===0){let f=new Array(s);for(let d=0;d<=l;++d)u[d]=0;return[f,u]}u[0]=0;for(let f=1;f<=l;++f){let d=n[f]-n[f-1],m=0;this.nGramWidths.forEach(g=>{m+=this.getNumNGrams(d,g)}),this.preserveShort&&d>0&&m===0&&(m=1),u[f]=u[f-1]+m}let h=new Array(u[l]);for(let f=0;f<l;++f){let d=n[f],m=u[f];if(this.nGramWidths.forEach(g=>{let x=n[f+1]-n[f],R=this.getNumNGrams(x,g);this.createNGrams(t,d,h,m,R,g),m+=R}),this.preserveShort&&m===u[f]){let g=n[f+1]-n[f];if(g===0)continue;let x=g+2*this.padWidth,R=1;this.createNGrams(t,d,h,m,R,x)}}return[h,u]}}function LS(i,t,n,s,a,l,u,h){return new U3(n,s,a,l,u,h).compute(i,t)}let z3={kernelName:fd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{separator:a,nGramWidths:l,leftPad:u,rightPad:h,padWidth:f,preserveShortSequences:d}=s,{data:m,dataSplits:g}=t,x=n.data.get(m.dataId).values,R=n.data.get(g.dataId).values,[N,F]=LS(x,R,a,l,u,h,f,d);return[n.makeTensorInfo([N.length],"string",N),n.makeTensorInfo(g.shape,"int32",F)]}};function $3(i,t,n,s){if(!i.length)return;if(t.length===0){for(let l=0;l<i.length;++l)s.push(i.subarray(l,l+1));return}if(t.length===1){let l=t[0],u=i.indexOf(l);for(;u!==-1;){let h=i.subarray(0,u);n&&h.length===0||s.push(h),u=(i=i.subarray(u+1)).indexOf(l)}return void(n&&i.length===0||s.push(i))}let a=0;for(let l=0;l<i.length+1;l++)if(l===i.length||t.indexOf(i[l])!==-1){let u=i.subarray(a,l);n&&u.length===0||s.push(u),a=l+1}}function DS(i,t,n){let s=i.length,a=[],l=0,u=0,h=new Array(s);for(let x=0;x<s;++x){let R=a.length;$3(i[x],t,n,a);let N=a.length-R;h[x]=N,l+=N,u=Math.max(u,N)}let f=St("int32",2*l),d=new Array(l),m=[s,u],g=0;for(let x=0;x<s;++x)for(let R=0;R<h[x];++R)f[2*g]=x,f[2*g+1]=R,d[g]=a[g],++g;return[f,d,m]}let V3={kernelName:hh,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{skipEmpty:a}=s,{input:l,delimiter:u}=t;if(l.dtype!=="string")throw new Error("Input must be of datatype string");if(l.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${l.shape}`);if(u.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${u.shape}`);let h=n.data.get(l.dataId).values,f=n.data.get(u.dataId).values[0],[d,m,g]=DS(h,f,a),x=m.length;return[n.makeTensorInfo([x,2],"int32",d),n.makeTensorInfo([x],"string",m),n.makeTensorInfo([2],"int32",new Int32Array(g))]}};function FS(i,t){let n=St("int32",i.length);for(let s=0;s<i.length;++s)n[s]=Ri(i[s]).modulo(t).getLowBitsUnsigned();return n}let H3={kernelName:md,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{numBuckets:a}=s,{input:l}=t;if(l.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let u=FS(n.data.get(l.dataId).values,a);return n.makeTensorInfo(l.shape,"int32",u)}},G3=is(Wn,i=>Math.tan(i)),W3={kernelName:Wn,backendName:"cpu",kernelFunc:G3},j3=is(Al,i=>Math.tanh(i));function PS(i,t){let n=new Array(i.rank);for(let a=0;a<n.length;a++)n[a]=i.shape[a]*t[a];let s=ci(n,i.dtype);for(let a=0;a<s.values.length;++a){let l=s.indexToLoc(a),u=new Array(i.rank);for(let f=0;f<u.length;f++)u[f]=l[f]%i.shape[f];let h=i.locToIndex(u);s.values[a]=i.values[h]}return s}let Ky=(i,t)=>{let n=t.value-i.value;return n===0?i.index-t.index:n};function OS(i,t,n=0,s=i.length-1){for(;s>n;){if(s-n>600){let h=s-n+1,f=t-n+1,d=Math.log(h),m=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*m*(h-m)/h)*Math.sign(f-h/2);OS(i,t,Math.max(n,Math.floor(t-f*m/h+g)),Math.min(s,Math.floor(t+(h-f)*m/h+g)))}let a=i[t],l=n,u=s;for(J(i,n,t),Ky(i[s],a)>0&&J(i,n,s);l<u;){for(J(i,l,u),l++,u--;Ky(i[l],a)<0;)l+=1;for(;Ky(i[u],a)>0;)u-=1}Ky(i[n],a)===0?J(i,n,u):(u+=1,J(i,u,s)),u<=t&&(n=u+1),t<=u&&(s=u-1)}}function BS(i,t,n,s,a){let l=t[t.length-1],[u,h]=[i.length/l,l],f=Pr(n,u*s),d=Pr("int32",u*s);for(let g=0;g<u;g++){let x=g*h,R=i.subarray(x,x+h),N=new Array(R.length);R.forEach((G,se)=>N[se]={value:G,index:se}),s<N.length&&(OS(N,s),N=N.slice(0,s)),a&&N.sort(Ky);let F=g*s,H=f.subarray(F,F+s),W=d.subarray(F,F+s);for(let G=0;G<s;G++)H[G]=N[G].value,W[G]=N[G].index}let m=t.slice();return m[m.length-1]=s,[ci(m,n,f),ci(m,"int32",d)]}function US(i,t,n){switch(n){case"reflect":return function(s,a){let l=s;if(l<0)if(a<=1)l=0;else{let u=2*a;l<u&&(l=u*Math.trunc(-l/u)+l),l=l<-a?l+u:-l-1}else if(l>a-1)if(a<=1)l=0;else{let u=2*a;l-=u*Math.trunc(l/u),l>=a&&(l=u-l-1)}return tn(0,l,a-1)}(i,t);case"wrap":return function(s,a){let l=s;if(l<0)if(a<=1)l=0;else{let u=a-1;l+=a*(Math.trunc(-l/u)+1)}else if(l>a-1)if(a<=1)l=0;else{let u=a-1;l-=a*Math.trunc(l/u)}return tn(0,l,a-1)}(i,t);case"nearest":return function(s,a){return tn(0,s,a-1)}(i,t);case"constant":default:return function(s,a){return s}(i)}}function Yy(i,t,n,s,a,l,u,h,f,d,m){return 0<=h&&h<t&&0<=f&&f<n?i[u*s+h*a+f*l+d]:m}function X3(i,t,n,s,a,l,u,h,f,d,m){return Yy(i,t,n,s,a,l,u,Math.round(h),Math.round(f),d,m)}function q3(i,t,n,s,a,l,u,h,f,d,m){let g=Math.floor(h),x=Math.floor(f),R=g+1,N=x+1;return(R-h)*((N-f)*Yy(i,t,n,s,a,l,u,g,x,d,m)+(f-x)*Yy(i,t,n,s,a,l,u,g,N,d,m))+(h-g)*((N-f)*Yy(i,t,n,s,a,l,u,R,x,d,m)+(f-x)*Yy(i,t,n,s,a,l,u,R,N,d,m))}function zS(i,t,n,s){let a=Zn(t,n)[0],l=[1,n[0],1];for(let N=0;N<a;N++)l[0]*=n[N];l[1]=n[a];for(let N=a+1;N<n.length;N++)l[2]*=n[N];let u={},h=new Int32Array(n[a]),f=new Hi(l,s,i),d=[],m=l[0]===1&&l[2]===1;for(let N=0;N<n[a];N++){let F;if(m)F=i[N].toString();else{let H=[];for(let W=0;W<l[0];W++)for(let G=0;G<l[2];G++)H.push(f.get(W,N,G));F=H.join(",")}if(u[F]!==void 0)h[N]=u[F];else{let H=Object.keys(u).length;u[F]=H,h[N]=H,d.push(N)}}let g=l.slice();g[1]=Object.keys(u).length;let x=new Hi(g,s);d.forEach((N,F)=>{for(let H=0;H<l[0];H++)for(let W=0;W<l[2];W++)x.set(f.get(H,N,W),H,F,W)});let R=n.slice();return R[a]=g[1],{outputValues:x.values,outputShape:R,indices:h}}let K3=[JC,eI,nI,iI,YC,sI,oI,lI,uI,cI,dI,fI,gI,bI,wI,AI,EI,SI,TI,ZC,MI,CI,II,kI,qC,NI,DI,jC,FI,OI,BI,UI,zI,$I,VI,HI,WI,XI,qI,KI,YI,QI,ZI,JI,ek,tk,nk,rk,ik,lk,OC,uk,ck,vk,bk,xk,Ak,_k,Ck,Ik,Rk,Dk,Fk,Pk,Ok,Bk,zk,Vk,BC,Hk,PI,Wk,Xk,Kk,UC,Qk,Jk,eR,nR,iR,oR,uR,dR,pR,fR,mR,yR,vR,bR,xR,wR,AR,ER,SR,MR,_R,kR,NR,ak,LR,FR,OR,UR,$R,VR,GR,WR,ES,qR,$C,KR,YR,XC,jA,ZR,VC,HC,QC,JR,e3,t3,n3,r3,i3,a3,l3,u3,c3,f3,WC,g3,v3,x3,_I,RR,A3,E3,S3,T3,M3,_3,C3,I3,N3,L3,F3,O3,B3,z3,V3,H3,Tk,ok,W3,{kernelName:Al,backendName:"cpu",kernelFunc:j3},{kernelName:Fa,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{reps:l}=s;ar(a,"tile");let u=PS(n.bufferSync(a),l);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},{kernelName:om,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{k:l,sorted:u}=s;ar(a,"topk");let h=n.data.get(a.dataId).values,[f,d]=BS(h,a.shape,a.dtype,l,u);return[n.makeTensorInfo(f.shape,f.dtype,f.values),n.makeTensorInfo(d.shape,d.dtype,d.values)]}},{kernelName:lm,backendName:"cpu",kernelFunc:function(i){let{inputs:t,attrs:n,backend:s}=i,{image:a,transforms:l}=t,{interpolation:u,fillMode:h,fillValue:f,outputShape:d}=n,[m,g,x,R]=a.shape,[N,F]=d??[g,x],H=[m,N,F,R],W=Rn(a.shape),G=W[0],se=W[1],ge=W[2],Ce=Pr(a.dtype,me(H));Ce.fill(f);let Be=s.data.get(a.dataId).values,Ve=s.data.get(l.dataId).values;for(let ze=0;ze<m;++ze){let Xe=l.shape[0]===1?Ve:Ve.subarray(8*ze,8*ze+8);for(let tt=0;tt<N;++tt)for(let ot=0;ot<F;++ot)for(let ut=0;ut<R;++ut){let ft,kt=Xe[6]*ot+Xe[7]*tt+1;if(kt===0)continue;let Ut=(Xe[0]*ot+Xe[1]*tt+Xe[2])/kt,It=(Xe[3]*ot+Xe[4]*tt+Xe[5])/kt,Lt=US(Ut,x,h),zt=US(It,g,h);switch(u){case"nearest":ft=X3(Be,g,x,G,se,ge,ze,zt,Lt,ut,f);break;case"bilinear":ft=q3(Be,g,x,G,se,ge,ze,zt,Lt,ut,f);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${u}`)}Ce[ze*G+tt*se+ot*ge+ut]=ft}return s.makeTensorInfo(H,a.dtype,Ce)}return{dataId:s.write(Ce,H,a.dtype),shape:a.shape,dtype:a.dtype}}},aI,{kernelName:dh,backendName:"cpu",kernelFunc:function(i){let{inputs:t,attrs:n,backend:s}=i,{axis:a}=n,{x:l}=t;ar(l,"unique");let u=s.data.get(l.dataId).values,{outputValues:h,outputShape:f,indices:d}=zS(u,a,l.shape,l.dtype);return[s.makeTensorInfo(f,l.dtype,h),s.makeTensorInfo([d.length],"int32",d)]}},{kernelName:Ma,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{value:a}=t,{axis:l}=s;l<0&&(l+=a.shape.length);let u=a.shape.length,h=a.shape[l],f=new Array(u-1),d=0;for(let R=0;R<u;R++)R!==l&&(f[d++]=a.shape[R]);let m=new Array(u).fill(0),g=a.shape.slice();g[l]=1;let x=new Array(h);for(let R=0;R<x.length;R++){m[l]=R;let N=jf({inputs:{x:a},backend:n,attrs:{begin:m,size:g}});x[R]=Us({inputs:{x:N},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(N)}return x}},{kernelName:gd,backendName:"cpu",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,segmentIds:l}=t,{numSegments:u}=s;ar(a,"unsortedSegmentSum");let h=[],f=[],d=a.shape.length-l.shape.length,m=l;for(let x=0;x<d;++x){let R=_x({inputs:{input:m},backend:n,attrs:{dim:x+1}});m=R,f.push(R)}for(let x=0;x<u;++x){let R=ql(x,"int32"),N=n.makeTensorInfo([],"int32",R),F=eS({inputs:{a:N,b:m},backend:n}),H=fp({inputs:{x:F},backend:n,attrs:{dtype:"float32"}}),W=Mx({inputs:{a:H,b:a},backend:n}),G=qy({inputs:{x:W},backend:n,attrs:{axis:0,keepDims:!1}});h.push(G),f.push(N),f.push(F),f.push(H),f.push(W),f.push(G)}let g=AS({inputs:h,backend:n,attrs:{axis:0}});return f.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}},HR];for(let i of K3)hm(i);let Xf={},QA={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ec(i,t){if(!(i in Xf)){let s=function(a,l){if(a!==1&&a!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let u=l??function(h){if(typeof OffscreenCanvas<"u"&&h===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(a);return u.addEventListener("webglcontextlost",h=>{h.preventDefault(),delete Xf[a]},!1),a===1?u.getContext("webgl",QA)||u.getContext("experimental-webgl",QA):u.getContext("webgl2",QA)}(i,t);if(s===null)return console.log("Could not get context for WebGL version",i),null;Xf[i]=s}let n=Xf[i];return n==null||n.isContextLost()?(delete Xf[i],ec(i)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Xf[i])}var Qy,Fl,Ua;function Zy(i,t){return[t,i]}function Ix(i){let t=me(i);return mn(Math.ceil(t/4))}function Rg(i,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(i/2))]}function ZA(i,t){let n=i,s,a,l,u,h,f,d,m,g,x;return Ge().getNumber("WEBGL_VERSION")===2?(s=n.R32F,a=n.R16F,l=n.RGBA16F,u=n.RGBA32F,h=n.RED,d=4,m=1,g=n.HALF_FLOAT,x=n.FLOAT,f=n.RGBA8):(s=i.RGBA,a=i.RGBA,l=i.RGBA,u=n.RGBA,h=i.RGBA,d=4,m=4,g=t!=null?t.HALF_FLOAT_OES:null,x=i.FLOAT,f=i.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:l,internalFormatPackedFloat:u,textureFormatFloat:h,downloadTextureFormat:f,downloadUnpackNumChannels:d,defaultNumChannels:m,textureTypeHalfFloat:g,textureTypeFloat:x}}function or(i,t){let n=t();return Ge().getBool("DEBUG")&&function(s){let a=s.getError();if(a!==s.NO_ERROR)throw new Error("WebGL Error: "+function(l,u){switch(u){case l.NO_ERROR:return"NO_ERROR";case l.INVALID_ENUM:return"INVALID_ENUM";case l.INVALID_VALUE:return"INVALID_VALUE";case l.INVALID_OPERATION:return"INVALID_OPERATION";case l.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case l.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case l.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${u}`}}(s,a))}(i),n}function Y3(i){return!!(Ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||i===0||596e-10<Math.abs(i)&&Math.abs(i)<65504)}function kx(i,t){return Jh(i,()=>i.getExtension(t),'Extension "'+t+'" not supported on this browser.')}(function(i){i[i.DENSE=0]="DENSE",i[i.SHARED_BATCH=1]="SHARED_BATCH"})(Qy||(Qy={})),function(i){i[i.RENDER=0]="RENDER",i[i.UPLOAD=1]="UPLOAD",i[i.PIXELS=2]="PIXELS",i[i.DOWNLOAD=3]="DOWNLOAD"}(Fl||(Fl={})),function(i){i[i.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",i[i.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",i[i.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",i[i.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",i[i.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Ua||(Ua={}));let Q3=/ERROR: [0-9]+:([0-9]+):/g;function JA(i,t){if(or(i,()=>i.validateProgram(t)),i.getProgramParameter(t,i.VALIDATE_STATUS)===!1)throw console.log(i.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function $S(i,t,n,s,a,l,u){let h=i.getAttribLocation(t,n);return h!==-1&&(or(i,()=>i.bindBuffer(i.ARRAY_BUFFER,s)),or(i,()=>i.vertexAttribPointer(h,a,i.FLOAT,!1,l,u)),or(i,()=>i.enableVertexAttribArray(h)),!0)}function Z3(i,t,n,s){or(i,()=>function(a,l,u){(function(h,f){let d=h.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,m=f+h.TEXTURE0;if(m<h.TEXTURE0||m>d)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${d}].`)})(a,u),or(a,()=>a.activeTexture(a.TEXTURE0+u)),or(a,()=>a.bindTexture(a.TEXTURE_2D,l))}(i,t,s)),or(i,()=>i.uniform1i(n,s))}function eE(i,t,n){or(i,()=>i.bindFramebuffer(i.FRAMEBUFFER,n)),or(i,()=>i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0))}function VS(i,t){or(i,()=>i.bindFramebuffer(i.FRAMEBUFFER,t)),or(i,()=>i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,null,0))}function Rx(i){let t=i.checkFramebufferStatus(i.FRAMEBUFFER);if(t!==i.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(n,s){switch(s){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${s}`}}(i,t))}function Jh(i,t,n){let s=or(i,()=>t());if(s==null)throw new Error(n);return s}function Ng(i,t=2){return me(i.slice(0,i.length-t))}function Lg(i){if(i.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[i.length>1?i[i.length-2]:1,i[i.length-1]]}function tE(i){let t=[1,1,1];return i.length===0||i.length===1&&i[0]===1||(t=[Ng(i),...Lg(i)]),t}function Nx(i){return i%2==0}function Lx(i,t){if(Ye(i=i.slice(-2),t=t.slice(-2))||!i.length||!t.length||i[0]===0||i[1]===0||t[0]===0||t[1]===0)return!0;if(i.length!==t.length){let n=i.slice(-1)[0],s=t.slice(-1)[0];if(n===s||Nx(n)&&Nx(s)&&(i[0]===1||t[0]===1))return!0}return i[1]===t[1]&&Nx(i[0])&&Nx(t[0])}let nE,rE;function yu(i,t){return i.getExtension(t)!=null}function HS(i){try{if(ec(i)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function iE(i){let t=ZA(i),n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let s=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,s),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0);let a=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;return i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.deleteTexture(n),i.deleteFramebuffer(s),a}function Jy(i,t){Array.isArray(i)||(i=[i]),i.forEach(n=>{n!=null&&ee(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}let Cr=Ge();function yo(){let i,t,n,s,a,l,u,h,f,d;return Ge().getNumber("WEBGL_VERSION")===2?(i="#version 300 es",t="in",n="out",s="in",a="texture",l="outputColor",u="out vec4 outputColor;",h=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,f="",d=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(i="",t="attribute",n="varying",s="varying",a="texture2D",l="gl_FragColor",u="",h=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,f=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,d=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:i,attribute:t,varyingVs:n,varyingFs:s,texture2D:a,output:l,defineOutput:u,defineSpecialNaN:h,defineSpecialInf:f,defineRound:d}}function qf(i,t,n="index"){let s=Rn(t);return s.map((a,l)=>`int ${i[l]} = ${n} / ${a}; ${l===s.length-1?`int ${i[l+1]} = ${n} - ${i[l]} * ${a}`:`index -= ${i[l]} * ${a}`};`).join("")}function Dx(i,t,n="index"){let s=Rn(t);return s.map((a,l)=>`int ${i[l]} = ${n} / outShapeStrides[${l}]; ${l===s.length-1?`int ${i[l+1]} = ${n} - ${i[l]} * outShapeStrides[${l}]`:`index -= ${i[l]} * outShapeStrides[${l}]`};`).join("")}function sE(i){let t=Rn(i).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}Cr.registerFlag("HAS_WEBGL",()=>Cr.getNumber("WEBGL_VERSION")>0),Cr.registerFlag("WEBGL_VERSION",()=>HS(2)?2:HS(1)?1:0),Cr.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),Cr.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Cr.get("WEBGL_VERSION")===2),Cr.registerFlag("WEBGL_CPU_FORWARD",()=>!0),Cr.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),Cr.registerFlag("WEBGL_PACK",()=>Cr.getBool("HAS_WEBGL")),Cr.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_CLIP",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_PACK_REDUCE",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_LAZILY_UNPACK",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_CONV_IM2COL",()=>Cr.getBool("WEBGL_PACK")),Cr.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(i){if(nE==null){let t=ec(i);nE=t.getParameter(t.MAX_TEXTURE_SIZE)}return nE}(Cr.getNumber("WEBGL_VERSION"))),Cr.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(i){if(rE==null){let t=ec(i);rE=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,rE)}(Cr.getNumber("WEBGL_VERSION"))),Cr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let i=Cr.getNumber("WEBGL_VERSION");return i===0?0:function(t){if(t===0)return 0;let n,s=ec(t);return n=yu(s,"EXT_disjoint_timer_query_webgl2")&&t===2?2:yu(s,"EXT_disjoint_timer_query")?1:0,n}(i)}),Cr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Cr.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!qg()),Cr.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(i){if(i===0)return!1;let t=ec(i);if(i===1){if(!yu(t,"OES_texture_float"))return!1}else if(!yu(t,"EXT_color_buffer_float"))return!1;return iE(t)}(Cr.getNumber("WEBGL_VERSION"))),Cr.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!Cr.getBool("WEBGL_FORCE_F16_TEXTURES")&&Cr.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),Cr.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>function(i){if(i===0)return!1;let t=ec(i);if(i!==1){if(yu(t,"EXT_color_buffer_float"))return iE(t);let n="EXT_color_buffer_half_float";if(yu(t,n)){let s=t.getExtension(n);return function(a,l){let u=ZA(a,l),h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,u.internalFormatHalfFloat,1,1,0,u.textureFormatFloat,u.textureTypeHalfFloat,null);let f=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,f),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,h,0);let d=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.deleteTexture(h),a.deleteFramebuffer(f),d}(t,s)}return!1}return!!yu(t,"OES_texture_float")&&!!yu(t,"WEBGL_color_buffer_float")&&iE(t)}(Cr.getNumber("WEBGL_VERSION"))),Cr.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return(i=Cr.getNumber("WEBGL_VERSION"))===2&&ec(i).fenceSync!=null;var i}),Cr.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Cr.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),Cr.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,i=>{if(i<0&&i!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${i}.`)}),Cr.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>qg()?1:-1,i=>{if(i<0&&i!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${i}.`)}),Cr.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),Cr.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),Cr.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),Cr.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);let GS=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,{getBroadcastDims:WS}=$;function J3(i,t,n){let s=[];if(i.forEach(x=>{let R=me(x.shapeInfo.logicalShape);if(x.shapeInfo.isUniform?s.push(`uniform float ${x.name}${R>1?`[${R}]`:""};`):(s.push(`uniform sampler2D ${x.name};`),s.push(`uniform int offset${x.name};`)),n.enableShapeUniforms){let{uniformShape:N}=aE(n.packedInputs,x.shapeInfo.logicalShape,x.shapeInfo.texShape);switch(N.length){case 1:s.push(`uniform int ${x.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${x.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${x.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${x.name}Shape;`)}s.push(`uniform ivec2 ${x.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;")}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(x=>{s.push(`uniform ${x.type} ${x.name}${x.arrayIndex?`[${x.arrayIndex}]`:""};`)});let a=s.join(`
`),l=i.map(x=>function(R,N,F=!1,H){let W="";W+=F?jS(R,H):Dg(R,H);let G=R.shapeInfo.logicalShape,se=N.logicalShape;return G.length<=se.length&&(W+=F?function(ge,Ce){let Be=ge.name,Ve=Be.charAt(0).toUpperCase()+Be.slice(1),ze="get"+Ve+"AtOutCoords",Xe=ge.shapeInfo.logicalShape.length,tt=Ce.logicalShape.length,ot=WS(ge.shapeInfo.logicalShape,Ce.logicalShape),ut=ys(tt),ft=tt-Xe,kt,Ut=["x","y","z","w","u","v"];kt=Xe===0?"":tt<2&&ot.length>=1?"coords = 0;":ot.map(qt=>`coords.${Ut[qt+ft]} = 0;`).join(`
`);let It="";It=tt<2&&Xe>0?"coords":ge.shapeInfo.logicalShape.map((qt,Ot)=>`coords.${Ut[Ot+ft]}`).join(", ");let Lt="return outputValue;",zt=me(ge.shapeInfo.logicalShape)===1,Gt=me(Ce.logicalShape)===1;if(Xe!==1||zt||Gt){if(zt&&!Gt)Lt=tt===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(ot.length){let qt=Xe-2,Ot=Xe-1;ot.indexOf(qt)>-1&&ot.indexOf(Ot)>-1?Lt="return vec4(outputValue.x);":ot.indexOf(qt)>-1?Lt="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":ot.indexOf(Ot)>-1&&(Lt="return vec4(outputValue.xx, outputValue.zz);")}}else Lt=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 ${ze}() {
      ${ut} coords = getOutputCoords();
      ${kt}
      vec4 outputValue = get${Ve}(${It});
      ${Lt}
    }
  `}(R,N):function(ge,Ce){let Be=ge.name,Ve=Be.charAt(0).toUpperCase()+Be.slice(1),ze="get"+Ve+"AtOutCoords",Xe=Ce.texShape,tt=ge.shapeInfo.texShape,ot=ge.shapeInfo.logicalShape.length,ut=Ce.logicalShape.length;if(!ge.shapeInfo.isUniform&&ot===ut&&ge.shapeInfo.flatOffset==null&&Ye(tt,Xe))return`
      float ${ze}() {
        return sampleTexture(${Be}, resultUV);
      }
    `;let ft=ys(ut),kt=WS(ge.shapeInfo.logicalShape,Ce.logicalShape),Ut=ut-ot,It,Lt=["x","y","z","w","u","v"];It=ot===0?"":ut<2&&kt.length>=1?"coords = 0;":kt.map(Gt=>`coords.${Lt[Gt+Ut]} = 0;`).join(`
`);let zt="";return zt=ut<2&&ot>0?"coords":ge.shapeInfo.logicalShape.map((Gt,qt)=>`coords.${Lt[qt+Ut]}`).join(", "),`
    float ${ze}() {
      ${ft} coords = getOutputCoords();
      ${It}
      return get${Ve}(${zt});
    }
  `}(R,N)),W}(x,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),u=t.texShape,h=yo(),f=function(x){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${x.texture2D}(textureSampler, uv).r;
    }
  `}(h),d,m,g=function(x){return`${x.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${x.varyingFs} vec2 resultUV;
    ${x.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${x.defineSpecialNaN}
    ${x.defineSpecialInf}
    ${x.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${eN}
    ${tN}
    ${nN}
  `}(h);return t.isPacked?(d=function(x,R,N){switch(x.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(F,H,W){let G=[Math.ceil(H[0]/2),Math.ceil(H[1]/2)];return G[0]===1?W?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${G[1]}.0);
      }
    `:G[1]===1?W?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${G[0]}.0);
      }
    `:W?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${G[0]}, ${G[1]}));
      return 2 * (resTexRC.x * ${G[1]} + resTexRC.y);
    }
  `}(0,R,N);case 2:return function(F,H,W){let G=[Math.ceil(H[0]/2),Math.ceil(H[1]/2)];if(Ye(F,H))return W?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${G[0]}, ${G[1]}));
      }
    `;let se=Math.ceil(F[1]/2);return W?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${G[0]}, ${G[1]}));

      int index = resTexRC.x * ${G[1]} + resTexRC.y;
      int r = 2 * (index / ${se});
      int c = imod(index, ${se}) * 2;

      return ivec2(r, c);
    }
  `}(x,R,N);case 3:return function(F,H,W){if(W)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let G=[Math.ceil(H[0]/2),Math.ceil(H[1]/2)],se=Math.ceil(F[2]/2),ge=se*Math.ceil(F[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${G[0]}, ${G[1]}));
      int index = resTexRC.x * ${G[1]} + resTexRC.y;

      int b = index / ${ge};
      index -= b * ${ge};

      int r = 2 * (index / ${se});
      int c = imod(index, ${se}) * 2;

      return ivec3(b, r, c);
    }
  `}(x,R,N);default:return function(F,H,W){if(W)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let G=[Math.ceil(H[0]/2),Math.ceil(H[1]/2)],se=Math.ceil(F[F.length-1]/2),ge=se*Math.ceil(F[F.length-2]/2),Ce=ge,Be="",Ve="b, r, c";for(let ze=2;ze<F.length-1;ze++)Ce*=F[F.length-ze-1],Be=`
      int b${ze} = index / ${Ce};
      index -= b${ze} * ${Ce};
    `+Be,Ve=`b${ze}, `+Ve;return`
    ivec${F.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${G[0]}, ${G[1]}));
      int index = resTexRC.x * ${G[1]} + resTexRC.y;

      ${Be}

      int b = index / ${ge};
      index -= b * ${ge};

      int r = 2 * (index / ${se});
      int c = imod(index, ${se}) * 2;

      return ivec${F.length}(${Ve});
    }
  `}(x,R,N)}}(t.logicalShape,u,n.enableShapeUniforms),m=function(x){return`
    void setOutput(vec4 val) {
      ${x.output} = val;
    }
  `}(h)):(d=function(x,R,N){switch(x.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(F,H,W){return H[0]===1?W?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${H[1]}.0);
      }
    `:H[1]===1?W?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${H[0]}.0);
      }
    `:W?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${H[0]}, ${H[1]}));
      return resTexRC.x * ${H[1]} + resTexRC.y;
    }
  `}(0,R,N);case 2:return function(F,H,W){return Ye(F,H)?W?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${H[0]}, ${H[1]}));
      }
    `:F[1]===1?W?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${H[0]}, ${H[1]}));
        int index = resTexRC.x * ${H[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:F[0]===1?W?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${H[0]}, ${H[1]}));
        int index = resTexRC.x * ${H[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:W?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${H[0]}, ${H[1]}));
      int index = resTexRC.x * ${H[1]} + resTexRC.y;
      int r = index / ${F[1]};
      int c = index - r * ${F[1]};
      return ivec2(r, c);
    }
  `}(x,R,N);case 3:return function(F,H,W){if(W)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Dx(["r","c","d"],F)}
    return ivec3(r, c, d);
  }
`;let G=qf(["r","c","d"],F);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${H[0]}, ${H[1]}));
      int index = resTexRC.x * ${H[1]} + resTexRC.y;
      ${G}
      return ivec3(r, c, d);
    }
  `}(x,R,N);case 4:return function(F,H,W){if(W)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Dx(["r","c","d","d2"],F)}
      return ivec4(r, c, d, d2);
    }
  `;let G=qf(["r","c","d","d2"],F);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${H[0]}, ${H[1]}));
      int index = resTexRC.x * ${H[1]} + resTexRC.y;
      ${G}
      return ivec4(r, c, d, d2);
    }
  `}(x,R,N);case 5:return function(F,H){let W=qf(["r","c","d","d2","d3"],F);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${H[0]},
                             ${H[1]}));

      int index = resTexRC.x * ${H[1]} + resTexRC.y;

      ${W}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(x,R);case 6:return function(F,H){let W=qf(["r","c","d","d2","d3","d4"],F);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${H[0]}, ${H[1]}));
      int index = resTexRC.x * ${H[1]} + resTexRC.y;

      ${W}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(x,R);default:throw new Error(`${x.length}-D output sampling is not yet supported`)}}(t.logicalShape,u,n.enableShapeUniforms),m=function(x){return`
    void setOutput(float val) {
      ${x.output} = vec4(val, 0, 0, 0);
    }
  `}(h)),n.packedInputs&&(g+=rN),[g,f,m,a,d,l,n.userCode].join(`
`)}function Dg(i,t=!1){let n=i.shapeInfo.logicalShape;switch(n.length){case 0:return function(s,a){let l=s.name,u="get"+l.charAt(0).toUpperCase()+l.slice(1);if(s.shapeInfo.isUniform)return`float ${u}() {return ${l};}`;let[h,f]=s.shapeInfo.texShape;if(h===1&&f===1)return`
      float ${u}() {
        return sampleTexture(${l}, halfCR);
      }
    `;let d=Kf(l);if(a)return`
    float ${u}() {
      vec2 uv = uvFromFlat(${l}TexShape[0], ${l}TexShape[1], ${d});
      return sampleTexture(${l}, uv);
    }
  `;let[m,g]=s.shapeInfo.texShape;return`
    float ${u}() {
      vec2 uv = uvFromFlat(${m}, ${g}, ${d});
      return sampleTexture(${l}, uv);
    }
  `}(i,t);case 1:return function(s,a){let l=s.name,u="get"+l.charAt(0).toUpperCase()+l.slice(1);if(s.shapeInfo.isUniform)return`
      float ${u}(int index) {
        ${Fg(s)}
      }
    `;let h=s.shapeInfo.texShape,f=h[0],d=h[1];if(d===1&&f===1)return`
      float ${u}(int index) {
        return sampleTexture(${l}, halfCR);
      }
    `;let m=Kf(l);return d===1?a?`
      float ${u}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${m}) + 0.5) / float(${l}TexShape[0]));
        return sampleTexture(${l}, uv);
      }
    `:`
      float ${u}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${m}) + 0.5) / ${f}.0);
        return sampleTexture(${l}, uv);
      }
    `:f===1?a?`
      float ${u}(int index) {
        vec2 uv = vec2((float(index + ${m}) + 0.5) / float(${l}TexShape[1]), 0.5);
        return sampleTexture(${l}, uv);
      }
    `:`
      float ${u}(int index) {
        vec2 uv = vec2((float(index + ${m}) + 0.5) / ${d}.0, 0.5);
        return sampleTexture(${l}, uv);
      }
    `:a?`
    float ${u}(int index) {
      vec2 uv = uvFromFlat(${l}TexShape[0], ${l}TexShape[1], index + ${m});
      return sampleTexture(${l}, uv);
    }
  `:`
    float ${u}(int index) {
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${m});
      return sampleTexture(${l}, uv);
    }
  `}(i,t);case 2:return function(s,a){let l=s.shapeInfo.logicalShape,u=s.name,h="get"+u.charAt(0).toUpperCase()+u.slice(1),f=s.shapeInfo.texShape;if(f!=null&&Ye(l,f)){if(a)return`
      float ${h}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${u}TexShape[1], ${u}TexShape[0]);
        return sampleTexture(${u}, uv);
      }
    `;let F=f[0];return`
    float ${h}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f[1]}.0, ${F}.0);
      return sampleTexture(${u}, uv);
    }
  `}let{newShape:d,keptDims:m}=Ii(l),g=d;if(g.length<l.length){let F=["row","col"];return`
      ${Dg(Pg(s,g),a)}
      float ${h}(int row, int col) {
        return ${h}(${Og(F,m)});
      }
    `}if(s.shapeInfo.isUniform)return`
      float ${h}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${l[1]}, 1)));
        ${Fg(s)}
      }
    `;let x=f[0],R=f[1],N=Kf(u);return R===1?a?`
      float ${h}(int row, int col) {
        float index = dot(vec3(row, col, ${N}), vec3(${u}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${u}TexShape[0]));
        return sampleTexture(${u}, uv);
      }
    `:`
    float ${h}(int row, int col) {
      float index = dot(vec3(row, col, ${N}), vec3(${l[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${x}.0);
      return sampleTexture(${u}, uv);
    }
  `:x===1?a?`
      float ${h}(int row, int col) {
        float index = dot(vec3(row, col, ${N}), vec3(${u}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${u}TexShape[1]), 0.5);
        return sampleTexture(${u}, uv);
      }
    `:`
    float ${h}(int row, int col) {
      float index = dot(vec3(row, col, ${N}), vec3(${l[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${R}.0, 0.5);
      return sampleTexture(${u}, uv);
    }
  `:a?`
      float ${h}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${u}Shape[1] + col + ${N};
        vec2 uv = uvFromFlat(${u}TexShape[0], ${u}TexShape[1], index);
        return sampleTexture(${u}, uv);
      }
    `:`
  float ${h}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${l[1]} + col + ${N};
    vec2 uv = uvFromFlat(${x}, ${R}, index);
    return sampleTexture(${u}, uv);
  }
`}(i,t);case 3:return function(s,a){let l=s.shapeInfo.logicalShape,u=s.name,h="get"+u.charAt(0).toUpperCase()+u.slice(1),f=l[1]*l[2],d=l[2],{newShape:m,keptDims:g}=Ii(l),x=m;if(x.length<l.length){let G=["row","col","depth"];return`
        ${Dg(Pg(s,x),a)}
        float ${h}(int row, int col, int depth) {
          return ${h}(${Og(G,g)});
        }
      `}if(s.shapeInfo.isUniform)return`
      float ${h}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${f}, ${d}, 1)));
        ${Fg(s)}
      }
    `;let R=s.shapeInfo.texShape,N=R[0],F=R[1],H=s.shapeInfo.flatOffset;if(F===f&&H==null)return a?`
      float ${h}(int row, int col, int depth) {
        int stride1 = ${u}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${u}TexShape[1], ${u}TexShape[0]);
        return sampleTexture(${u}, uv);
      }
    `:`
        float ${h}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${d}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${F}.0, ${N}.0);
          return sampleTexture(${u}, uv);
        }
      `;if(F===d&&H==null)return a?`
      float ${h}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${u}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}TexShape[1], ${u}TexShape[0]);
        return sampleTexture(${u}, uv);
      }
    `:`
    float ${h}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${l[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${F}.0, ${N}.0);
      return sampleTexture(${u}, uv);
    }
  `;let W=Kf(u);return a?`
    float ${h}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${u}Shape[1] * ${u}Shape[2];
      int stride1 = ${u}Shape[2];
      int index = row * ${f} + col * ${d} + depth + ${W};
      vec2 uv = uvFromFlat(${u}TexShape[0], ${u}TexShape[1], index);
      return sampleTexture(${u}, uv);
    }
    `:`
      float ${h}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${f} + col * ${d} + depth + ${W};
        vec2 uv = uvFromFlat(${N}, ${F}, index);
        return sampleTexture(${u}, uv);
      }
  `}(i,t);case 4:return function(s,a){let l=s.shapeInfo.logicalShape,u=s.name,h="get"+u.charAt(0).toUpperCase()+u.slice(1),f=l[3],d=l[2]*f,m=l[1]*d,{newShape:g,keptDims:x}=Ii(l);if(g.length<l.length){let Ce=["row","col","depth","depth2"];return`
      ${Dg(Pg(s,g),a)}
      float ${h}(int row, int col, int depth, int depth2) {
        return ${h}(${Og(Ce,x)});
      }
    `}if(s.shapeInfo.isUniform)return`
      float ${h}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${m}, ${d}, ${f}, 1)));
        ${Fg(s)}
      }
    `;let R=s.shapeInfo.flatOffset,N=s.shapeInfo.texShape,F=N[0],H=N[1],W=`int stride2 = ${u}Shape[3];`,G=`int stride1 = ${u}Shape[2] * stride2;`,se=`int stride0 = ${u}Shape[1] * stride1;`;if(H===m&&R==null)return a?`
      float ${h}(int row, int col, int depth, int depth2) {
        ${W}
        ${G}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${u}TexShape[1], ${u}TexShape[0]);
        return sampleTexture(${u}, uv);
      }
    `:`
      float ${h}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${d}, ${f}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${H}.0, ${F}.0);
        return sampleTexture(${u}, uv);
      }
    `;if(H===f&&R==null)return a?`
      float ${h}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${u}Shape[1] * ${u}Shape[2], ${u}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${u}TexShape[1], ${u}TexShape[0]);
        return sampleTexture(${u}, uv);
      }
    `:`
      float ${h}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${l[1]*l[2]}, ${l[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${H}.0, ${F}.0);
        return sampleTexture(${u}, uv);
      }
    `;let ge=Kf(u);return a?`
    float ${h}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${W}
      ${G}
      ${se}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${u}TexShape[0], ${u}TexShape[1], index + ${ge});
      return sampleTexture(${u}, uv);
    }
  `:`
    float ${h}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${m} + col * ${d} +
          depth * ${f} + depth2;
      vec2 uv = uvFromFlat(${F}, ${H}, index + ${ge});
      return sampleTexture(${u}, uv);
    }
  `}(i,t);case 5:return function(s){let a=s.shapeInfo.logicalShape,l=s.name,u="get"+l.charAt(0).toUpperCase()+l.slice(1),h=a[4],f=a[3]*h,d=a[2]*f,m=a[1]*d,{newShape:g,keptDims:x}=Ii(a);if(g.length<a.length){let W=["row","col","depth","depth2","depth3"];return`
      ${Dg(Pg(s,g))}
      float ${u}(int row, int col, int depth, int depth2, int depth3) {
        return ${u}(${Og(W,x)});
      }
    `}if(s.shapeInfo.isUniform)return`
      float ${u}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${m}, ${d}, ${f}, ${h})) +
          depth3;
        ${Fg(s)}
      }
    `;let R=s.shapeInfo.flatOffset,N=s.shapeInfo.texShape,F=N[0],H=N[1];return H===m&&R==null?`
      float ${u}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${d}, ${f}, ${h}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${H}.0, ${F}.0);
        return sampleTexture(${l}, uv);
      }
    `:H===h&&R==null?`
      float ${u}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${a[1]*a[2]*a[3]},
               ${a[2]*a[3]}, ${a[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${H}.0, ${F}.0);
        return sampleTexture(${l}, uv);
      }
    `:`
    float ${u}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${m} + col * ${d} + depth * ${f} +
          depth2 * ${h} + depth3 + ${Kf(l)};
      vec2 uv = uvFromFlat(${F}, ${H}, index);
      return sampleTexture(${l}, uv);
    }
  `}(i);case 6:return function(s){let a=s.shapeInfo.logicalShape,l=s.name,u="get"+l.charAt(0).toUpperCase()+l.slice(1),{newShape:h,keptDims:f}=Ii(a);if(h.length<a.length){let G=["row","col","depth","depth2","depth3","depth4"];return`
      ${Dg(Pg(s,h))}
      float ${u}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${u}(${Og(G,f)});
      }
    `}let d=a[5],m=a[4]*d,g=a[3]*m,x=a[2]*g,R=a[1]*x;if(s.shapeInfo.isUniform)return`
      float ${u}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${R}, ${x}, ${g}, ${m})) +
          dot(
            vec2(depth3, depth4),
            vec2(${d}, 1)));
        ${Fg(s)}
      }
    `;let N=s.shapeInfo.flatOffset,F=s.shapeInfo.texShape,H=F[0],W=F[1];return W===R&&N==null?`
      float ${u}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${x}, ${g}, ${m}, ${d})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${W}.0, ${H}.0);
        return sampleTexture(${l}, uv);
      }
    `:W===d&&N==null?`
      float ${u}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${a[1]*a[2]*a[3]*a[4]},
               ${a[2]*a[3]*a[4]},
               ${a[3]*a[4]},
               ${a[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${W}.0, ${H}.0);
        return sampleTexture(${l}, uv);
      }
    `:`
    float ${u}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${R} + col * ${x} + depth * ${g} +
          depth2 * ${m} + depth3 * ${d} + depth4 + ${Kf(l)};
      vec2 uv = uvFromFlat(${H}, ${W}, index);
      return sampleTexture(${l}, uv);
    }
  `}(i);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function jS(i,t){switch(i.shapeInfo.logicalShape.length){case 0:return function(n){let s=n.name;return`
    vec4 ${"get"+s.charAt(0).toUpperCase()+s.slice(1)}() {
      return ${yo().texture2D}(${s}, halfCR);
    }
  `}(i);case 1:return function(n,s){let a=n.name,l="get"+a.charAt(0).toUpperCase()+a.slice(1),u=n.shapeInfo.texShape,h=yo();if(s)return`
    vec4 ${l}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${a}TexShape[0]) / 2.0), ceil(float(${a}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${h.texture2D}(${a}, uv);
    }
  `;let f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return`
    vec4 ${l}(int index) {
      vec2 uv = packedUVfrom1D(
        ${f[0]}, ${f[1]}, index);
      return ${h.texture2D}(${a}, uv);
    }
  `}(i,t);case 2:return function(n,s){let a=n.shapeInfo.logicalShape,l=n.name,u="get"+l.charAt(0).toUpperCase()+l.slice(1),h=n.shapeInfo.texShape,f=h[0],d=h[1],m=yo();if(h!=null&&Ye(a,h))return s?`
      vec4 ${u}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}TexShape[1], ${l}TexShape[0]);

        return ${m.texture2D}(${l}, uv);
      }
    `:`
      vec4 ${u}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);

        return ${m.texture2D}(${l}, uv);
      }
    `;if(s)return`
    vec4 ${u}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${l}TexShape[0]) / 2.0), ceil(float(${l}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${l}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${m.texture2D}(${l}, uv);
    }
  `;let g=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)];return`
    vec4 ${u}(int row, int col) {
      vec2 uv = packedUVfrom2D(${Math.ceil(a[1]/2)}, ${g[0]}, ${g[1]}, row, col);
      return ${m.texture2D}(${l}, uv);
    }
  `}(i,t);case 3:return function(n,s){let a=n.shapeInfo.logicalShape,l=n.name,u="get"+l.charAt(0).toUpperCase()+l.slice(1),h=n.shapeInfo.texShape,f=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)];if(a[0]===1){let R=[1,2],N=["b","row","col"];return`
        ${jS(Pg(n,a.slice(1)),s)}
        vec4 ${u}(int b, int row, int col) {
          return ${u}(${Og(N,R)});
        }
      `}let d=yo();if(s)return`
    vec4 ${u}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${l}TexShape[0]) / 2.0), ceil(float(${l}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${l}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${l}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${d.texture2D}(${l}, uv);
    }
  `;let m=f[0],g=f[1],x=Math.ceil(a[2]/2);return`
    vec4 ${u}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${m}, ${g}, ${x*Math.ceil(a[1]/2)}, ${x}, b, row, col);
      return ${d.texture2D}(${l}, uv);
    }
  `}(i,t);default:return function(n,s){let a=n.name,l="get"+a.charAt(0).toUpperCase()+a.slice(1),u=yo();if(s)return`
    vec4 ${l}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${a}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${a}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${a}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${a}TexShape[0]) / 2.0), ceil(float(${a}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${u.texture2D}(${a}, uv);
    }
  `;let h=n.shapeInfo.logicalShape,f=h.length,d=n.shapeInfo.texShape,m=[Math.ceil(d[0]/2),Math.ceil(d[1]/2)],g=m[0],x=m[1],R=Math.ceil(h[f-1]/2),N=R*Math.ceil(h[f-2]/2),F="int b, int row, int col",H=`b * ${N} + (row / 2) * ${R} + (col / 2)`;for(let W=2;W<f-1;W++)F=`int b${W}, `+F,N*=h[f-W-1],H=`b${W} * ${N} + `+H;return`
    vec4 ${l}(${F}) {
      int index = ${H};
      int texR = index / ${x};
      int texC = index - texR * ${x};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${x}, ${g});
      return ${u.texture2D}(${a}, uv);
    }
  `}(i,t)}}let eN=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,tN=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,nN=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,rN=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Kf(i){return`offset${i}`}function Fg(i){let t=i.name,n=me(i.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function ys(i){if(i<=1)return"int";if(i===2)return"ivec2";if(i===3)return"ivec3";if(i===4)return"ivec4";if(i===5)return"ivec5";if(i===6)return"ivec6";throw Error(`GPU for rank ${i} is not yet supported`)}function aE(i,t,n){let{newShape:s,keptDims:a}=Ii(t),l=t.length,u=i&&l===3&&t[0]===1,h=u?t.slice(1):s,f=!i&&l>1&&!Ye(t,n)&&s.length<l||u;return{useSqueezeShape:f,uniformShape:f?h:t,keptDims:a}}function Pg(i,t){let n=JSON.parse(JSON.stringify(i));return n.shapeInfo.logicalShape=t,n}function Og(i,t){return t.map(n=>i[n]).join(", ")}function XS(i,t){if(i.length!==t.length)throw Error(`Binary was compiled with ${i.length} inputs, but was executed with ${t.length} inputs`);i.forEach((n,s)=>{let a=n.logicalShape,l=t[s],u=l.shape;if(!Ye(a,u))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${a} and ${u} must match`);if(n.isUniform&&l.isUniform)return;let h=n.texShape,f=l.isUniform?null:l.texData.texShape;if(!Ye(h,f))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${h} and ${f} must match`)})}function Po(i){return Ge().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&i<=4}class iN{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Qy.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=yo();this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Dx(["r","c","d"],t):qf(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}class sN{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Qy.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=yo();this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Dx(["r","c","d"],t):qf(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}class aN{constructor(t){this.variableNames=["A"],this.outTexUsage=Fl.DOWNLOAD;let n=yo();this.outputShape=t,this.userCode=`
      ${GS}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}class oN{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Fl.DOWNLOAD;let n=yo();this.outputShape=t,this.userCode=`
      ${GS}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}class lN{constructor(t,n=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let s=yo();this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length);let a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${this.enableShapeUniforms?`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`:sE(t)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = ${s.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${s.output} = vec4(${a}, 0., 0., 0.);
      }
    `}}class uN{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let s=yo();this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length);let a="",l="result";n&&(l="floor(result * 255. + 0.5)");for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){let f=2*u+h;a+=`
          localCoords = coords;
          if(localCoords[2] + ${h} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${h};
          if (localCoords[1] + ${u} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${u};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${f}] = values[0];
            } else if (offset == 1) {
              result[${f}] = values[1];
            } else if (offset == 2) {
              result[${f}] = values[2];
            } else {
              result[${f}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`:sE(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${a}

          ${s.output} = ${l};
        }
    `}}function ev(i,t,n,s,a,l){(function(f,d){let m=Ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(f<=0||d<=0)throw new Error(`Requested texture size [${f}x${d}] is invalid.`);if(f>m||d>m)throw new Error(`Requested texture size [${f}x${d}] greater than WebGL maximum on this browser / GPU [${m}x${m}].`)})(t,n);let u=function(f){return Jh(f,()=>f.createTexture(),"Unable to create WebGLTexture.")}(i),h=i.TEXTURE_2D;return or(i,()=>i.bindTexture(h,u)),or(i,()=>i.texParameteri(h,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE)),or(i,()=>i.texParameteri(h,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),or(i,()=>i.texParameteri(h,i.TEXTURE_MIN_FILTER,i.NEAREST)),or(i,()=>i.texParameteri(h,i.TEXTURE_MAG_FILTER,i.NEAREST)),Ge().getNumber("WEBGL_VERSION")===1?or(i,()=>i.texImage2D(h,0,s,t,n,0,a,l,null)):or(i,()=>i.texStorage2D(h,1,s,t,n)),or(i,()=>i.bindTexture(i.TEXTURE_2D,null)),{texture:u,texShape:[n,t]}}function qS(i){return i.internalFormatFloat}function KS(i){return i.internalFormatHalfFloat}function YS(i){return i.downloadTextureFormat}function QS(i){return i.internalFormatPackedFloat}function ZS(i){return i.internalFormatPackedHalfFloat}class oE{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let n=Ge().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,function(l,u){Xf[l]=u}(n,t)):this.gl=ec(n);let s="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(Ge().getNumber("WEBGL_VERSION")===1){let l="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=kx(this.gl,l),yu(this.gl,u))this.textureHalfFloatExtension=kx(this.gl,u);else if(Ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),yu(this.gl,a))this.colorBufferHalfFloatExtension=kx(this.gl,a);else if(Ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",yu(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else{if(!yu(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=function(l){return function(u,h){let f=Jh(u,()=>u.createBuffer(),"Unable to create WebGLBuffer");return or(u,()=>u.bindBuffer(u.ARRAY_BUFFER,f)),or(u,()=>u.bufferData(u.ARRAY_BUFFER,h,u.STATIC_DRAW)),f}(l,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(l){return function(u,h){let f=Jh(u,()=>u.createBuffer(),"Unable to create WebGLBuffer");return or(u,()=>u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,f)),or(u,()=>u.bufferData(u.ELEMENT_ARRAY_BUFFER,h,u.STATIC_DRAW)),f}(l,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(l){return Jh(l,()=>l.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=ZA(this.gl,this.textureHalfFloatExtension)}get debug(){return Ge().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let t=this.gl;or(t,()=>t.finish()),or(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),or(t,()=>t.deleteFramebuffer(this.framebuffer)),or(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),or(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),or(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),function(s,a,l,u){let[h,f]=Zy(a,l);return ev(s,h,f,qS(u),u.textureFormatFloat,s.FLOAT)}(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),function(s,a,l,u){let[h,f]=Zy(a,l);return ev(s,h,f,KS(u),u.textureFormatFloat,u.textureTypeHalfFloat)}(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),function(s,a,l,u){let[h,f]=Zy(a,l);return ev(s,h,f,YS(u),s.RGBA,s.UNSIGNED_BYTE)}(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),function(s,a,l){or(s,()=>s.bindTexture(s.TEXTURE_2D,a)),l.data instanceof Uint8Array?Ge().getNumber("WEBGL_VERSION")===2?or(s,()=>s.texSubImage2D(s.TEXTURE_2D,0,0,0,l.width,l.height,s.RGBA,s.UNSIGNED_BYTE,l.data)):or(s,()=>s.texImage2D(s.TEXTURE_2D,0,s.RGBA,l.width,l.height,0,s.RGBA,s.UNSIGNED_BYTE,l.data)):Ge().getNumber("WEBGL_VERSION")===2?or(s,()=>s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,l)):or(s,()=>s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,l)),or(s,()=>s.bindTexture(s.TEXTURE_2D,null))}(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,s,a){this.throwIfDisposed(),function(l,u,h,f,d,m){let g,x,R;or(l,()=>l.bindTexture(l.TEXTURE_2D,u)),d instanceof Uint8Array?(g=new Uint8Array(h*f*4),x=l.UNSIGNED_BYTE,R=l.RGBA):(g=new Float32Array(h*f*4),x=l.FLOAT,R=m.internalFormatPackedFloat),g.set(d),Ge().getNumber("WEBGL_VERSION")===2?or(l,()=>l.texSubImage2D(l.TEXTURE_2D,0,0,0,h,f,l.RGBA,x,g)):or(l,()=>l.texImage2D(l.TEXTURE_2D,0,R,h,f,0,l.RGBA,x,g)),or(l,()=>l.bindTexture(l.TEXTURE_2D,null))}(this.gl,t,n,s,a,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),function(s,a,l,u){let[h,f]=Rg(a,l);return ev(s,h,f,ZS(u),s.RGBA,u.textureTypeHalfFloat)}(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),function(s,a,l,u){let[h,f]=Rg(a,l);return ev(s,h,f,QS(u),s.RGBA,s.FLOAT)}(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(VS(this.gl,this.framebuffer),this.outputTexture=null),or(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,s){return this.downloadMatrixDriver(t,()=>function(a,l,u,h){let[f,d]=Zy(l,u),m=new Uint8Array(l*u*4);return or(a,()=>a.readPixels(0,0,f,d,h.downloadTextureFormat,a.UNSIGNED_BYTE,m)),new Float32Array(m.buffer)}(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,s,a,l,u){return function(h,f,d,m,g,x,R,N){let F=h,H=new Float32Array(function(W,G){let[se,ge]=Rg(W,G);return se*ge*4}(x,R));return F.bindBuffer(F.PIXEL_PACK_BUFFER,f),F.getBufferSubData(F.PIXEL_PACK_BUFFER,0,H),F.bindBuffer(F.PIXEL_PACK_BUFFER,null),H}(this.gl,t,0,0,0,l,u,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return function(s,a,l){let u=s,h=new Float32Array(l);return u.bindBuffer(u.PIXEL_PACK_BUFFER,a),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,h),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),h}(this.gl,t,n)}createBufferFromTexture(t,n,s){this.bindTextureToFrameBuffer(t);let a=function(l,u,h,f){let d=l.createBuffer();or(l,()=>l.bindBuffer(l.PIXEL_PACK_BUFFER,d));let m=16*u*h;return or(l,()=>l.bufferData(l.PIXEL_PACK_BUFFER,m,l.STREAM_READ)),or(l,()=>l.readPixels(0,0,h,u,l.RGBA,l.FLOAT,0)),or(l,()=>l.bindBuffer(l.PIXEL_PACK_BUFFER,null)),d}(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),a}createAndWaitForFence(){let t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,s;if(Ge().getBool("WEBGL_FENCE_API_ENABLED")){let a=t,l=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{let u=a.clientWaitSync(l,0,0);return u===a.ALREADY_SIGNALED||u===a.CONDITION_SATISFIED},n=l}else Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(t,n,s){return this.downloadMatrixDriver(t,()=>function(a,l,u){let h=new Float32Array(l*u*4);return or(a,()=>a.readPixels(0,0,u,l,a.RGBA,a.FLOAT,h)),h}(this.gl,n,s))}createProgram(t){this.throwIfDisposed();let n=this.gl;this.vertexShader==null&&(this.vertexShader=function(a){let l=yo();return function(u,h){let f=Jh(u,()=>u.createShader(u.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(or(u,()=>u.shaderSource(f,h)),or(u,()=>u.compileShader(f)),u.getShaderParameter(f,u.COMPILE_STATUS)===!1)throw console.log(u.getShaderInfoLog(f)),new Error("Failed to compile vertex shader.");return f}(a,`${l.version}
    precision highp float;
    ${l.attribute} vec3 clipSpacePos;
    ${l.attribute} vec2 uv;
    ${l.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}(n));let s=function(a){return Jh(a,()=>a.createProgram(),"Unable to create WebGLProgram.")}(n);return or(n,()=>n.attachShader(s,this.vertexShader)),or(n,()=>n.attachShader(s,t)),function(a,l){if(or(a,()=>a.linkProgram(l)),a.getProgramParameter(l,a.LINK_STATUS)===!1)throw console.log(a.getProgramInfoLog(l)),new Error("Failed to link vertex and fragment shaders.")}(n,s),this.debug&&JA(n,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=function(a,l,u){return or(a,()=>a.bindBuffer(a.ARRAY_BUFFER,u)),$S(a,l,"clipSpacePos",u,3,20,0)&&$S(a,l,"uv",u,2,20,12)}(n,this.program,this.vertexBuffer)),s}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&or(this.gl,()=>this.gl.deleteProgram(t))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&JA(this.gl,this.program),or(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,s=!0){return this.throwIfDisposed(),s?function(a,l,u){return Jh(a,()=>a.getUniformLocation(l,u),'uniform "'+u+'" not present in program.')}(this.gl,t,n):function(a,l,u){return a.getUniformLocation(l,u)}(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),or(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),Z3(this.gl,t,n,s)}setOutputMatrixTexture(t,n,s){this.setOutputMatrixTextureDriver(t,s,n)}setOutputPackedMatrixTexture(t,n,s){this.throwIfDisposed();let[a,l]=Rg(n,s);this.setOutputMatrixTextureDriver(t,a,l)}setOutputMatrixWriteRegion(t,n,s,a){this.setOutputMatrixWriteRegionDriver(s,t,a,n)}setOutputPackedMatrixWriteRegion(t,n,s,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&JA(this.gl,this.program),Rx(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let t=this.gl;this.debug&&this.debugValidate(),or(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),or(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=kx(this.gl,Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let s=this.gl,a=this.getQueryTimerExtensionWebGL2(),l=s.createQuery();return s.beginQuery(a.TIME_ELAPSED_EXT,l),l}let t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,s=this.getQueryTimerExtensionWebGL2();return void n.endQuery(s.TIME_ELAPSED_EXT)}let t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await In(()=>this.disposed||this.isQueryAvailable(t,Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){let s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}{let s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){let s=this.gl,a=this.getQueryTimerExtensionWebGL2(),l=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),l&&!this.disjoint}{let s=this.getQueryTimerExtensionWebGL1(),a=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),a&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){let t=function(n){let s=0;for(;s<n.length&&n[s]();++s);return s-1}(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){let{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||In(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),eE(this.gl,t,this.framebuffer),this.debug&&Rx(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(eE(this.gl,this.outputTexture,this.framebuffer),this.debug&&Rx(this.gl)):VS(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);let s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,n,s){this.throwIfDisposed();let a=this.gl;eE(a,t,this.framebuffer),this.debug&&Rx(a),this.outputTexture=t,or(a,()=>a.viewport(0,0,n,s)),or(a,()=>a.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(t,n,s,a){this.throwIfDisposed(),or(this.gl,()=>this.gl.scissor(t,n,s,a))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}let{addImpl:cN,bincountImpl:JS,bincountReduceImpl:hN,ceilImpl:dN,concatImpl:pN,equalImpl:fN,expImpl:mN,expm1Impl:gN,floorImpl:yN,gatherNdImpl:vN,gatherV2Impl:bN,greaterImpl:xN,greaterEqualImpl:wN,lessImpl:AN,lessEqualImpl:EN,linSpaceImpl:SN,logImpl:TN,maxImpl:MN,maximumImpl:_N,minimumImpl:CN,multiplyImpl:IN,negImpl:kN,notEqualImpl:RN,prodImpl:NN,rangeImpl:LN,rsqrtImpl:DN,sigmoidImpl:FN,simpleAbsImpl:eT,sliceImpl:PN,sparseFillEmptyRowsImpl:ON,sparseReshapeImpl:BN,sparseSegmentReductionImpl:tT,sqrtImpl:UN,stridedSliceImpl:zN,stringNGramsImpl:$N,stringSplitImpl:VN,stringToHashBucketFastImpl:HN,subImpl:GN,tileImpl:WN,topKImpl:jN,transposeImpl:lE,uniqueImpl:XN}=mi;function nT(i,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${i}.${n}`)}function vo(i,t){return t===1?[i]:nT(i,t)}class qN{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Po(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let n=vo("rc",this.rank),s=ys(this.rank),a=this.getOutOfBoundsCondition(n),l=this.getSetup(n),u=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${a}) {
            setOutput(vec4(0));
          } else {
            ${l}

            setOutput(vec4(${u}));
          }
        }
      `}}getSourceCoordsArr(t){let n=[];for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){let l=`${s===0?"r":"rp1"}, ${a===0?"c":"cp1"}`;for(let u=2;u<this.rank;u++)l=`${t[t.length-1-u]},`+l;n.push(l)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";let n=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],a=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${a};
    `}getOutput(t){let n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}class rT{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length);let s="";for(let u=0;u<4;u++){let h="thisRC = rc;";u%2==1&&(h+="thisRC.z += 1;"),u>1&&(h+="thisRC.y += 1;"),s+=`
        ${h}
        ${u>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${u}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${u>0?"}":""}
      `}var a,l;this.userCode=`
      ${a=n,l=this.enableShapeUniforms,`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${l?function(u,h,f="index"){let d=function(m,g){let x=m.length,R=m.map(F=>`${g}[${F}]`),N=new Array(x-1);N[x-2]=R[x-1];for(let F=x-3;F>=0;--F)N[F]=`(${N[F+1]} * ${R[F+1]})`;return N}(u.map((m,g)=>g),h);return d.map((m,g)=>`int ${u[g]} = ${f} / ${d[g]}; ${g===d.length-1?`int ${u[g+1]} = ${f} - ${u[g]} * ${d[g]}`:`index -= ${u[g]} * ${d[g]}`};`).join("")}(["r","c","d"],"inputShape"):qf(["r","c","d"],a)}
      return ivec3(r, c, d);
    }
  `}
      ${this.enableShapeUniforms?`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`:sE(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}class KN{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,n,s){let a=sT(n,s),l=aT(t,a,s);l in this.freeTextures||(this.freeTextures[l]=[]),l in this.usedTextures||(this.usedTextures[l]=[]);let u=iT(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[l].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=u,this.log();let f=this.freeTextures[l].shift();return this.usedTextures[l].push(f),f}let h;return a===Ua.PACKED_2X2_FLOAT32?h=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):a===Ua.PACKED_2X2_FLOAT16?h=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):a===Ua.UNPACKED_FLOAT32?h=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):a===Ua.UNPACKED_FLOAT16?h=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):a===Ua.PACKED_4X1_UNSIGNED_BYTE&&(h=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[l].push(h),this.numUsedTextures++,this._numBytesAllocated+=u,this.log(),h}releaseTexture(t,n,s,a){if(this.freeTextures==null)return;let l=sT(s,a),u=aT(n,l,a);u in this.freeTextures||(this.freeTextures[u]=[]);let h=iT(n,l,this.gpgpu.gl,this.gpgpu.textureConfig,a),f=Ge().get("WEBGL_DELETE_TEXTURE_THRESHOLD");f!==-1&&this._numBytesAllocated>f?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=h):(this.freeTextures[u].push(t),this.numFreeTextures++,this._numBytesFree+=h),this.numUsedTextures--;let d=this.usedTextures[u],m=d.indexOf(t);if(m<0)throw new Error("Cannot release a texture that was never provided by this texture manager");d.splice(m,1),this.log()}log(){if(!this.logEnabled)return;let t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);let n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(let t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function iT(i,t,n,s,a){let l=function(h,f){switch(h){case Ua.PACKED_2X2_FLOAT32:return QS(f);case Ua.PACKED_2X2_FLOAT16:return ZS(f);case Ua.UNPACKED_FLOAT32:return qS(f);case Ua.UNPACKED_FLOAT16:return KS(f);case Ua.PACKED_4X1_UNSIGNED_BYTE:return YS(f);default:throw new Error(`Unknown physical texture type ${h}`)}}(t,s),u;if(a){let[h,f]=Rg(i[0],i[1]);u=h*f}else{let[h,f]=Zy(i[0],i[1]);u=h*f}return u*function(h,f){let d=h;if(f===d.R32F)return 4;if(f===d.R16F)return 2;if(f===d.RGBA32F||f===h.RGBA)return 16;if(f===d.RGBA16F)return 8;if(f===d.RGBA8)return 4;throw new Error(`Unknown internal format ${f}`)}(n,l)}function sT(i,t){if(i===Fl.UPLOAD)return Ua.PACKED_2X2_FLOAT32;if(i===Fl.RENDER||i==null)return function(n){return Ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Ua.PACKED_2X2_FLOAT32:Ua.UNPACKED_FLOAT32:n?Ua.PACKED_2X2_FLOAT16:Ua.UNPACKED_FLOAT16}(t);if(i===Fl.DOWNLOAD||i===Fl.PIXELS)return Ua.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${i}`)}function aT(i,t,n){return`${i[0]}_${i[1]}_${t}_${n}`}class ed{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}let oT="return abs(x);",Bg="return x;";class Yf{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}class YN{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length);let n=t.length,s=vo("rc",n),a=ys(n),l=function(f,d){if(f===1)return"rc";let m="";for(let g=0;g<f;g++)m+=d[g],g<f-1&&(m+=",");return m}(n,s),u=s.slice(-2),h=n<=1?"rc":`vec2(${u.join(",")})`;this.userCode=`
      void main() {
        ${a} rc = getOutputCoords();
        vec4 packedInput = getA(${l});

        setOutput(getChannel(packedInput, ${h}));
      }
    `}}let QN=pf,uE={},ZN=Ge().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class Fx extends Di{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Ge().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof oE)n=t;else{let a=ec(Ge().getNumber("WEBGL_VERSION"),t);n=new oE(a)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let a=ec(Ge().getNumber("WEBGL_VERSION"));n=new oE(a),this.binaryCache=((s=Ge().getNumber("WEBGL_VERSION"))in uE||(uE[s]={}),uE[s]),this.gpgpuCreatedLocally=!0}var s;this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new KN(this.gpgpu),this.numMBBeforeWarning=Ge().global.screen==null?1024:Ge().global.screen.height*Ge().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Qi(this,gc())}nextDataId(){return Fx.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,n,s){if((Ge().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ge().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let a={id:this.nextDataId()};return this.texData.set(a,{shape:n,dtype:s,values:t,usage:Fl.UPLOAD,refCount:1}),a}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){this.texData.get(t).refCount++}decRef(t){this.texData.has(t)&&this.texData.get(t).refCount--}move(t,n,s,a,l){if(Ge().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:a,values:n,usage:Fl.UPLOAD,refCount:l})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){let n=this.texData.get(t),{values:s,dtype:a,complexTensorInfos:l,slice:u,shape:h,isPacked:f}=n;if(u!=null){let x;x=f?new Yf(h,Bg):new ed(h,Bg);let R=this.runWebGLProgram(x,[{dataId:t,shape:h,dtype:a}],a),N=this.readSync(R.dataId);return this.disposeIntermediateTensorInfo(R),N}if(s!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return s;let d=this.activeTimers!=null,m,g;return d&&(m=ha()),g=a==="complex64"?Wu(this.readSync(l.real.dataId),this.readSync(l.imag.dataId)):this.getValuesFromTexture(t),d&&(this.downloadWaitMs+=ha()-m),this.convertAndCacheOnCPU(t,g)}async read(t){if(this.pendingRead.has(t)){let N=this.pendingRead.get(t);return new Promise(F=>N.push(F))}let n=this.texData.get(t),{values:s,shape:a,slice:l,dtype:u,complexTensorInfos:h,isPacked:f}=n;if(l!=null){let N;N=f?new Yf(a,Bg):new ed(a,Bg);let F=this.runWebGLProgram(N,[{dataId:t,shape:a,dtype:u}],u),H=this.read(F.dataId);return this.disposeIntermediateTensorInfo(F),H}if(s!=null)return this.convertAndCacheOnCPU(t);if(Ge().getBool("DEBUG")&&!Ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ge().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let d,m,g=null;if(u!=="complex64"&&Ge().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(t);let N=this.texData.get(d.dataId);g=this.gpgpu.createBufferFromTexture(N.texture.texture,...Ix(a))}if(this.pendingRead.set(t,[]),u!=="complex64"&&await this.gpgpu.createAndWaitForFence(),u==="complex64"){let N=await Promise.all([this.read(h.real.dataId),this.read(h.imag.dataId)]);m=Wu(N[0],N[1])}else if(g==null)m=this.getValuesFromTexture(t);else{let N=me(a);m=this.gpgpu.downloadFloat32MatrixFromBuffer(g,N)}if(d!=null&&this.disposeIntermediateTensorInfo(d),g!=null){let N=this.gpgpu.gl;or(N,()=>N.deleteBuffer(g))}let x=this.convertAndCacheOnCPU(t,m),R=this.pendingRead.get(t);return this.pendingRead.delete(t),R.forEach(N=>N(x)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&gc().removeDataId(t,this),this.pendingDeletes--),x}readToGPU(t,n={}){let s=this.texData.get(t),{values:a,shape:l,slice:u,dtype:h,isPacked:f,texture:d}=s;if(h==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(u!=null){let R;R=f?new Yf(l,Bg):new ed(l,Bg);let N=this.runWebGLProgram(R,[{dataId:t,shape:l,dtype:h}],h),F=this.readToGPU(N,n);return this.disposeIntermediateTensorInfo(N),F}if(d==null)throw a!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let m=this.decode(t,n.customTexShape),g=gc().makeTensorFromDataId(m.dataId,m.shape,m.dtype),x=this.texData.get(m.dataId);return Object.assign({tensorRef:g},x.texture)}bufferSync(t){let n=this.readSync(t.dataId),s=n;if(t.dtype==="string")try{s=n.map(a=>hc(a))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ci(t.shape,t.dtype,s)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){let s=t[n];if(!Y3(s))throw Ge().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){let{shape:n,dtype:s,isPacked:a}=this.texData.get(t),l=me(n);if(Ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let x=this.decode(t),R=this.texData.get(x.dataId),N=this.gpgpu.downloadMatrixFromPackedTexture(R.texture.texture,...Ix(n)).subarray(0,l);return this.disposeIntermediateTensorInfo(x),N}let u=Ge().getBool("WEBGL_PACK")&&a===!0,h=u?tE(n):n,f=u?new oN(h):new aN(h),d=this.runWebGLProgram(f,[{shape:h,dtype:s,dataId:t}],"float32"),m=this.texData.get(d.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,l);return this.disposeIntermediateTensorInfo(d),g}timerAvailable(){return Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){let n=this.activeTimers,s=[],a=!1;this.programTimersStack==null?(this.programTimersStack=s,a=!0):this.activeTimers.push(s),this.activeTimers=s,t();let l=te(this.activeTimers.map(f=>f.query)).filter(f=>f!=null),u=te(this.activeTimers.map(f=>f.name)).filter(f=>f!=null);this.activeTimers=n,a&&(this.programTimersStack=null);let h={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let f=await Promise.all(l);h.kernelMs=Me(f),h.getExtraProfileInfo=()=>f.map((d,m)=>({name:u[m],ms:d})).map(d=>`${d.name}: ${d.ms}`).join(", ")}else h.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,h})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ha(),endMs:null}}endTimer(t){return Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=ha(),t)}async getQueryTime(t){if(Ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);let n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);let{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){let{texture:n,dtype:s,texShape:a,usage:l,isPacked:u,slice:h}=this.texData.get(t),f=h&&h.origDataId||t,d=this.dataRefCount.get(f);d>1?this.dataRefCount.set(f,d-1):(this.dataRefCount.delete(f),n!=null&&(this.numBytesInGPU-=this.computeBytes(a,s),this.textureManager.releaseTexture(n,a,l,u)));let m=this.texData.get(t);m.texture=null,m.texShape=null,m.isPacked=!1,m.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=ZN){return Ge().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&me(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){Pa("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let n=t.dataSync();return QN(t.shape,n)}packedUnaryOp(t,n,s){let a=new Yf(t.shape,n),l=this.compileAndRun(a,[t],s);return gc().makeTensorFromDataId(l.dataId,l.shape,l.dtype)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){let a=eT(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,a)}if(Ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,oT,t.dtype);let n=new ed(t.shape,oT),s=this.compileAndRun(n,[t]);return gc().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}makeTensorInfo(t,n,s){let a;if(n==="string"&&s!=null&&s.length>0&&Sr(s[0])){let l=s.map(u=>Co(u));a=this.write(l,t,n)}else a=this.write(s,t,n);return this.texData.get(a).usage=null,{dataId:a,shape:t,dtype:n}}makeOutput(t,n,s){let{dataId:a}=this.makeTensorInfo(t,n,s);return gc().makeTensorFromDataId(a,t,n,this)}unpackTensor(t){let n=new YN(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){let n=new qN(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){let s=[Ng(t.shape),...Lg(t.shape)],a={dtype:t.dtype,shape:s,dataId:t.dataId},l=[Ng(n),...Lg(n)],u=new rT(l,s),h=[s],f=this.runWebGLProgram(u,[a],t.dtype,h,!0);return{dataId:f.dataId,shape:n,dtype:f.dtype}}decode(t,n){let s=this.texData.get(t),{isPacked:a,shape:l,dtype:u}=s;n!=null&&ee(me(l)<=n[0]*n[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.");let h=tE(l),f;f=a?new sN(h):new iN(h);let d=[n??Ix(h)];return{dtype:u,shape:l,dataId:this.runWebGLProgram(f,[{shape:h,dtype:u,dataId:t}],u,d,!0,n).dataId}}runWebGLProgram(t,n,s,a,l=!1,u){let h=this.makeTensorInfo(t.outputShape,s),f=this.texData.get(h.dataId);if(t.packedOutput&&(f.isPacked=!0),t.outPackingScheme===Qy.DENSE){let W=u??Ix(t.outputShape);f.texShape=W.map(G=>2*G)}if(t.outTexUsage!=null&&(f.usage=t.outTexUsage),me(h.shape)===0)return f.values=Pr(h.dtype,0),h;let d=[],m=n.map(W=>{if(W.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let G=this.texData.get(W.dataId);if(G.texture==null){if(!t.packedInputs&&me(W.shape)<=Ge().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:W.shape,texData:null,isUniform:!0,uniformValues:G.values};t.packedInputs&&(G.isPacked=!0,G.shape=W.shape)}if(this.uploadToGPU(W.dataId),!!G.isPacked!=!!t.packedInputs)W=G.isPacked?this.unpackTensor(W):this.packTensor(W),d.push(W),G=this.texData.get(W.dataId);else if(G.isPacked&&!Lx(G.shape,W.shape)){let se=W,ge=W.shape;W.shape=G.shape,W=this.packedReshape(W,ge),d.push(W),G=this.texData.get(W.dataId),se.shape=ge}return{shape:W.shape,texData:G,isUniform:!1}});this.uploadToGPU(h.dataId);let g={shape:h.shape,texData:f,isUniform:!1},x=function(W,G,se){let ge="";G.concat(se).forEach(Ve=>{let ze=Ve.texData!=null&&Ve.texData.slice!=null&&Ve.texData.slice.flatOffset>0;if(W.enableShapeUniforms&&!Ve.isUniform){let Xe=Ve.texData.texShape,{useSqueezeShape:tt,uniformShape:ot,keptDims:ut}=aE(W.packedInputs,Ve.shape,Xe),ft="",kt="",Ut="";if(ot.length===1&&W.packedInputs){let jt=[Math.ceil(Xe[0]/2),Math.ceil(Xe[1]/2)];ft=`${jt[0]>1}_${jt[1]>1}`}else if(ot.length!==2||W.packedInputs){if(ot.length>2&&!W.packedInputs){let jt=Rn(ot);Ut=`${jt[0]===Xe[1]}_${jt[jt.length-1]===Xe[1]}`}}else kt=`${ot[0]>1}_${ot[1]>1}`;let It=Ve.shape.length,Lt=ot.length===2&&Ye(Ve.shape,Xe),zt=me(Ve.shape)===1,Gt=Th(Ve.shape,se.shape),qt=!W.packedInputs&&It===se.shape.length&&Ye(Xe,se.texData.texShape),Ot=W.packedInputs||ot.length>2?"":`${Xe[0]>1}_${Xe[1]>1}`;ge+=`${It}_${qt}_${tt?ut:""}_${ot.length}_${zt}_${Gt}_${Lt}_${ft}_${kt}_${Ut}_${Ot}_${ze}`}else{let Xe=Ve.isUniform?"uniform":Ve.texData.texShape;ge+=`${Ve.shape}_${Xe}_${ze}`}});let Ce=W.userCode,Be=W.constructor.name;return Be+="_"+ge+"_"+Ce+`${Ge().getNumber("WEBGL_VERSION")}`,Be}(t,m,g),R=this.getAndSaveBinary(x,()=>function(W,G,se,ge){let Ce=se.map((Ot,jt)=>{let on={logicalShape:Ot.shape,texShape:Ot.isUniform?null:Ot.texData.texShape,isUniform:Ot.isUniform,isPacked:!Ot.isUniform&&Ot.texData.isPacked,flatOffset:null};return Ot.texData!=null&&Ot.texData.slice!=null&&Ot.texData.slice.flatOffset>0&&(on.flatOffset=Ot.texData.slice.flatOffset),{name:G.variableNames[jt],shapeInfo:on}}),Be=Ce.map(Ot=>Ot.shapeInfo),Ve={logicalShape:ge.shape,texShape:ge.texData.texShape,isUniform:!1,isPacked:ge.texData.isPacked,flatOffset:null},ze=J3(Ce,Ve,G),Xe=function(Ot,jt){let on=Jh(Ot,()=>Ot.createShader(Ot.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(or(Ot,()=>Ot.shaderSource(on,jt)),or(Ot,()=>Ot.compileShader(on)),Ot.getShaderParameter(on,Ot.COMPILE_STATUS)===!1)throw function(bn,An){let Bn=Q3.exec(An);if(Bn==null)return console.log(`Couldn't parse line number in error: ${An}`),void console.log(bn);let Pn=+Bn[1],mr=bn.split(`
`),_r=mr.length.toString().length+2,vr=mr.map(($r,qr)=>_n((qr+1).toString(),_r)+$r),gr=0;for(let $r=0;$r<vr.length;$r++)gr=Math.max(vr[$r].length,gr);let Wr=vr.slice(0,Pn-1),pi=vr.slice(Pn-1,Pn),Oi=vr.slice(Pn);console.log(Wr.join(`
`)),console.log(An.split(`
`)[0]),console.log(`%c ${_n(pi[0],gr)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Oi.join(`
`))}(jt,Ot.getShaderInfoLog(on)),new Error("Failed to compile fragment shader.");return on}(W.gl,ze),tt=W.createProgram(Xe),ot=null,ut=W.getUniformLocation(tt,"NAN",!1);Ge().getNumber("WEBGL_VERSION")===1&&(ot=W.getUniformLocation(tt,"INFINITY",!1));let ft=!1,kt={},Ut={},It={};for(let Ot=0;Ot<G.variableNames.length;Ot++){let jt=G.variableNames[Ot];kt[jt]=W.getUniformLocation(tt,jt,ft),kt[`offset${jt}`]=W.getUniformLocation(tt,`offset${jt}`,ft),G.enableShapeUniforms&&(Ut[`${jt}Shape`]=W.getUniformLocation(tt,`${jt}Shape`,ft),It[`${jt}TexShape`]=W.getUniformLocation(tt,`${jt}TexShape`,ft))}let Lt,zt,Gt;G.enableShapeUniforms&&(Lt=W.getUniformLocation(tt,"outShape",ft),Gt=W.getUniformLocation(tt,"outShapeStrides",ft),zt=W.getUniformLocation(tt,"outTexShape",ft));let qt=[];return G.customUniforms&&G.customUniforms.forEach((Ot,jt)=>{qt[jt]=W.getUniformLocation(tt,Ot.name,ft)}),{program:G,fragmentShader:Xe,source:ze,webGLProgram:tt,uniformLocations:kt,customUniformLocations:qt,inShapeInfos:Be,outShapeInfo:Ve,infLoc:ot,nanLoc:ut,inShapesLocations:Ut,inTexShapesLocations:It,outShapeLocation:Lt,outShapeStridesLocation:Gt,outTexShapeLocation:zt}}(this.gpgpu,t,m,g)),N=this.activeTimers!=null,F;N&&(F=this.startTimer()),function(W,G,se,ge,Ce){G.program.enableShapeUniforms||(XS(G.inShapeInfos,se),XS([G.outShapeInfo],[ge]));let Be=ge.texData.texture,Ve=ge.texData.texShape;ge.texData.isPacked?W.setOutputPackedMatrixTexture(Be.texture,Ve[0],Ve[1]):W.setOutputMatrixTexture(Be.texture,Ve[0],Ve[1]),W.setProgram(G.webGLProgram),Ge().getNumber("WEBGL_VERSION")===1&&G.infLoc!==null&&W.gl.uniform1f(G.infLoc,1/0),G.nanLoc!==null&&W.gl.uniform1f(G.nanLoc,NaN),se.forEach((Xe,tt)=>{let ot=G.program.variableNames[tt],ut=G.uniformLocations[ot],ft=G.uniformLocations[`offset${ot}`],kt=G.inShapesLocations[`${ot}Shape`],Ut=G.inTexShapesLocations[`${ot}TexShape`];if(kt){let{uniformShape:It}=aE(G.program.packedInputs,Xe.shape,Xe.texData.texShape);switch(It.length){case 1:W.gl.uniform1iv(kt,new Int32Array(It));break;case 2:W.gl.uniform2iv(kt,new Int32Array(It));break;case 3:W.gl.uniform3iv(kt,new Int32Array(It));break;case 4:W.gl.uniform4iv(kt,new Int32Array(It))}}if(Ut&&W.gl.uniform2i(Ut,Xe.texData.texShape[0],Xe.texData.texShape[1]),ut!=null)if(Xe.isUniform)if(me(Xe.shape)<2)W.gl.uniform1f(ut,Xe.uniformValues[0]);else{let It=Xe.uniformValues;It instanceof Float32Array||(It=new Float32Array(It)),W.gl.uniform1fv(ut,It)}else Xe.texData.slice!=null&&ft!=null&&W.gl.uniform1i(ft,Xe.texData.slice.flatOffset),W.setInputMatrixTexture(Xe.texData.texture.texture,ut,tt)});let ze=G.outShapeLocation;if(ze)switch(ge.shape.length){case 1:W.gl.uniform1iv(ze,new Int32Array(ge.shape));break;case 2:W.gl.uniform2iv(ze,new Int32Array(ge.shape));break;case 3:W.gl.uniform3iv(ze,new Int32Array(ge.shape));break;case 4:W.gl.uniform4iv(ze,new Int32Array(ge.shape))}if(G.outShapeStridesLocation){let Xe=Rn(ge.shape);switch(ge.shape.length){case 2:W.gl.uniform1iv(G.outShapeStridesLocation,new Int32Array(Xe));break;case 3:W.gl.uniform2iv(G.outShapeStridesLocation,new Int32Array(Xe));break;case 4:W.gl.uniform3iv(G.outShapeStridesLocation,new Int32Array(Xe))}}G.outTexShapeLocation&&W.gl.uniform2i(G.outTexShapeLocation,ge.texData.texShape[0],ge.texData.texShape[1]),G.program.customUniforms&&Ce&&G.program.customUniforms.forEach((Xe,tt)=>{let ot=G.customUniformLocations[tt],ut=Ce[tt];if(Xe.type==="float")W.gl.uniform1fv(ot,ut);else if(Xe.type==="vec2")W.gl.uniform2fv(ot,ut);else if(Xe.type==="vec3")W.gl.uniform3fv(ot,ut);else if(Xe.type==="vec4")W.gl.uniform4fv(ot,ut);else if(Xe.type==="int")W.gl.uniform1iv(ot,ut);else if(Xe.type==="ivec2")W.gl.uniform2iv(ot,ut);else if(Xe.type==="ivec3")W.gl.uniform3iv(ot,ut);else{if(Xe.type!=="ivec4")throw Error(`uniform type ${Xe.type} is not supported yet.`);W.gl.uniform4iv(ot,ut)}}),W.executeProgram()}(this.gpgpu,R,m,g,a),d.forEach(W=>this.disposeIntermediateTensorInfo(W)),N&&(F=this.endTimer(F),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(F)}));let H=Ge().get("WEBGL_FLUSH_THRESHOLD");if(H>0){let W=ha();W-this.lastGlFlushTime>H&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=W)}if(!Ge().getBool("WEBGL_LAZILY_UNPACK")&&f.isPacked&&l===!1){let W=this.unpackTensor(h);return this.disposeIntermediateTensorInfo(h),W}return h}compileAndRun(t,n,s,a,l=!1){return s=s||n[0].dtype,this.runWebGLProgram(t,n,s,a,l)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Ge().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=bt(()=>{if(!Ge().get("WEBGL_RENDER_FLOAT32_ENABLED")){let t=Ge().getBool("DEBUG");Ge().set("DEBUG",!1);let n=this.abs(Jn(1e-8)).dataSync()[0];if(Ge().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}uploadToGPU(t){let n=this.texData.get(t),{shape:s,dtype:a,values:l,texture:u,usage:h,isPacked:f}=n;if(u!=null)return;let d=this.activeTimers!=null,m;d&&(m=ha());let g=n.texShape;if(g==null&&(g=function(x,R=!1){let N=Ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");R&&(N*=2,(x=x.map((H,W)=>W>=x.length-2?ye(x[W]):x[W])).length===1&&(x=[2,x[0]])),x.length!==2&&(x=Ii(x).newShape);let F=me(x);if(x.length<=1&&F<=N)return[1,F];if(x.length===2&&x[0]<=N&&x[1]<=N)return x;if(x.length===3&&x[0]*x[1]<=N&&x[2]<=N)return[x[0]*x[1],x[2]];if(x.length===3&&x[0]<=N&&x[1]*x[2]<=N)return[x[0],x[1]*x[2]];if(x.length===4&&x[0]*x[1]*x[2]<=N&&x[3]<=N)return[x[0]*x[1]*x[2],x[3]];if(x.length===4&&x[0]<=N&&x[1]*x[2]*x[3]<=N)return[x[0],x[1]*x[2]*x[3]];if(R){let H=Ng(x),W=2,G=2;return x.length&&([W,G]=Lg(x)),F=H*(W/2)*(G/2),mn(F).map(se=>2*se)}return mn(F)}(s,f),n.texShape=g),l!=null){let x=tE(s),R,N=g[1],F=g[0],H=l instanceof Uint8Array||l instanceof Uint8ClampedArray;!f&&H||([N,F]=Rg(g[0],g[1])),R=f?new uN(x,H):new lN(x,H);let W=H?[F,N]:g,G=this.makeTensorInfo(W,a),se=this.texData.get(G.dataId);se.usage=H?Fl.PIXELS:Fl.UPLOAD,se.texShape=W,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(G.dataId),N,F,l);let ge=[[F,N]],Ce=!0,Be=this.runWebGLProgram(R,[G],a,ge,Ce),Ve=this.texData.get(Be.dataId);n.texture=Ve.texture,n.texShape=Ve.texShape,n.isPacked=Ve.isPacked,n.usage=Ve.usage,this.disposeIntermediateTensorInfo(G),this.texData.delete(Be.dataId),n.values=null,d&&(this.uploadWaitMs+=ha()-m)}else{let x=this.acquireTexture(g,h,a,f);n.texture=x}}convertAndCacheOnCPU(t,n){let s=this.texData.get(t),{dtype:a}=s;return this.releaseGPUData(t),n!=null&&(s.values=function(l,u){if(u==="float32"||u==="complex64")return l;if(u==="int32"||u==="bool"){let h=u==="int32"?new Int32Array(l.length):new Uint8Array(l.length);for(let f=0;f<h.length;++f)h[f]=Math.round(l[f]);return h}throw new Error(`Unknown dtype ${u}`)}(n,a)),s.values}acquireTexture(t,n,s,a){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){let l=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${l} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,a)}computeBytes(t,n){return t[0]*t[1]*xr(n)}}Fx.nextDataId=0,Kg()&&Vv("webgl",()=>new Fx,2);class Ug{constructor(t,n,s){this.variableNames=["A","B"],this.outputShape=Zr(n,s),this.enableShapeUniforms=Po(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}class tv{constructor(t,n,s,a=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Zr(n,s);let l=this.outputShape.length;this.enableShapeUniforms=Po(l);let u="";if(a)if(l===0||me(this.outputShape)===1)u=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(u=`
          ${ys(l)} coords = getOutputCoords();
        `,l===1)this.enableShapeUniforms?u+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:u+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let h=vo("coords",l);this.enableShapeUniforms?u+=`
            bool nextRowOutOfBounds =
              (${h[l-2]} + 1) >= outShape[${l} - 2];
            bool nextColOutOfBounds =
              (${h[l-1]} + 1) >= outShape[${l} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:u+=`
            bool nextRowOutOfBounds =
              (${h[l-2]} + 1) >= ${this.outputShape[l-2]};
            bool nextColOutOfBounds =
              (${h[l-1]} + 1) >= ${this.outputShape[l-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${u}

        setOutput(result);
      }
    `}}function hl(i){let{inputs:t,backend:n}=i,{x:s}=t;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}let JN={kernelName:ad,backendName:"webgl",kernelFunc:hl};function mp(i){let{inputs:t,backend:n}=i,{real:s,imag:a}=t,l=n.makeTensorInfo(s.shape,"complex64"),u=n.texData.get(l.dataId),h=hl({inputs:{x:s},backend:n}),f=hl({inputs:{x:a},backend:n});return u.complexTensorInfos={real:h,imag:f},l}let eL={kernelName:Pt,backendName:"webgl",kernelFunc:mp},lT="return (a < 0.) ? b * a : a;",uT=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,tL={kernelName:rc,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{alpha:l}=s,u=n.makeTensorInfo([],"float32",ql(l,"float32")),h=Ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tv(uT,a.shape,u.shape):new Ug(lT,a.shape,u.shape),f=n.runWebGLProgram(h,[a,u],"float32");return n.disposeIntermediateTensorInfo(u),f}},cT="return (a < 0.) ? b * a : a;",hT=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,nL={kernelName:$l,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s,alpha:a}=t,l=Ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tv(hT,s.shape,a.shape):new Ug(cT,s.shape,a.shape);return n.runWebGLProgram(l,[s,a],"float32")}};function $i({opSnippet:i,packedOpSnippet:t,cpuKernelImpl:n,dtype:s}){return({inputs:a,backend:l})=>{let{x:u}=a,h=l,f=s||u.dtype;if(h.shouldExecuteOnCPU([u])&&n!=null){let m=h.texData.get(u.dataId),g=n(m.values,f);return h.makeTensorInfo(u.shape,f,g)}let d;return d=Ge().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null?new Yf(u.shape,t):new ed(u.shape,i),h.runWebGLProgram(d,[u],f)}}function za({opSnippet:i,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:a,dtype:l}){return({inputs:u,backend:h})=>{let{a:f,b:d}=u,m=h;if(s&&f.dtype==="complex64"){let R=m.texData.get(f.dataId),N=m.texData.get(d.dataId),[F,H]=[[R.complexTensorInfos.real,N.complexTensorInfos.real],[R.complexTensorInfos.imag,N.complexTensorInfos.imag]].map(G=>{let[se,ge]=G,Ce={dataId:se.dataId,dtype:se.dtype,shape:f.shape},Be={dataId:ge.dataId,dtype:ge.dtype,shape:d.shape},Ve=new Ug(i,f.shape,d.shape);return m.runWebGLProgram(Ve,[Ce,Be],_a(se.dtype,ge.dtype))}),W=mp({inputs:{real:F,imag:H},backend:m});return m.disposeIntermediateTensorInfo(F),m.disposeIntermediateTensorInfo(H),W}let g=l||_a(f.dtype,d.dtype);if((f.dtype==="string"||d.dtype==="string"||m.shouldExecuteOnCPU([f,d]))&&a!=null){let R=m.texData.get(f.dataId).values,N=m.texData.get(d.dataId).values,F=f.dtype==="string"?Do(R):R,H=f.dtype==="string"?Do(N):N,[W,G]=a(f.shape,d.shape,F,H,g),se=m.makeTensorInfo(G,g);return m.texData.get(se.dataId).values=W,se}let x;return x=Ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null?new tv(t,f.shape,d.shape,n):new Ug(i,f.shape,d.shape),m.runWebGLProgram(x,[f,d],g)}}function Px(i,t=!1){if(i==="linear")return"return x;";if(i==="relu")return t?`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`:`if (isnan(x)) return x;
  return (x < 0.0) ? 0.0 : x;
`;if(i==="elu")return t?`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`:"return (x >= 0.0) ? x : (exp(x) - 1.0);";if(i==="relu6")return t?`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`:`if (isnan(x)) return x;
  return (x < 0.0) ? 0.0 : min(6.0, x);
`;if(i==="prelu")return t?hT:cT;if(i==="leakyrelu")return t?uT:lT;if(i==="sigmoid")return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${i} has not been implemented for the WebGL backend.`)}class dT{constructor(t,n,s,a=!1,l=!1,u=!1,h=null,f=!1,d=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Po(this.outputShape.length);let m=a?t[1]:t[2],g=Math.ceil(m/2),x=a?"i * 2, rc.y":"rc.y, i * 2",R=l?"rc.z, i * 2":"i * 2, rc.z",N=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],F=l?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],H="",W="";h&&(H=f?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${h}
        }`:d?`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${h}
        }`:`vec4 activation(vec4 x) {
          ${h}
        }`,W="result = activation(result);");let G=u?"result += getBiasAtOutCoords();":"";u&&this.variableNames.push("bias"),f&&this.variableNames.push("preluActivationWeights"),d&&this.variableNames.push("leakyreluAlpha");let se="rc.x",ge="rc.x";t[0]<n[0]?se=`int(min(float(rc.x), ${t[0]-1}.))`:n[0]<t[0]&&(ge=`int(min(float(rc.x), ${n[0]-1}.))`),this.userCode=`
      ${H}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${g}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${g}; i++) {
          int batchA = ${se};
          int batchB = ${ge};
          vec4 a = getMatrixA(batchA, ${x});
          vec4 b = getMatrixB(batchB, ${R});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${N[0]} * ${F[0]});
          result += (${N[1]} * ${F[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${G}

        ${W}

        setOutput(result);
      }
    `}}class pT{constructor(t,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Zr(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}let fT="return a * b;";function cE(i){let{inputs:t,backend:n}=i,{a:s,b:a}=t,l=_a(s.dtype,a.dtype);if(s.dtype==="complex64"){let h=n.texData.get(s.dataId),f=n.texData.get(a.dataId),d=new pT("return areal * breal - aimag * bimag;",s.shape,a.shape),m=new pT("return areal * bimag + aimag * breal;",s.shape,a.shape),g=[{dataId:h.complexTensorInfos.real.dataId,dtype:h.complexTensorInfos.real.dtype,shape:s.shape},{dataId:h.complexTensorInfos.imag.dataId,dtype:h.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:f.complexTensorInfos.real.dataId,dtype:f.complexTensorInfos.real.dtype,shape:a.shape},{dataId:f.complexTensorInfos.imag.dataId,dtype:f.complexTensorInfos.imag.dtype,shape:a.shape}],x=n.runWebGLProgram(d,g,"float32"),R=n.runWebGLProgram(m,g,"float32"),N=mp({inputs:{real:x,imag:R},backend:n});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(R),N}if(n.shouldExecuteOnCPU([s,a])){let h=n.texData.get(s.dataId),f=n.texData.get(a.dataId),[d,m]=IN(s.shape,a.shape,h.values,f.values,l),g=n.makeTensorInfo(m,l);return n.texData.get(g.dataId).values=d,g}let u;return u=Ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tv(fT,s.shape,a.shape):new Ug(fT,s.shape,a.shape),n.runWebGLProgram(u,[s,a],l)}let rL={kernelName:Ts,backendName:"webgl",kernelFunc:cE};function Xn(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{shape:l}=s,u=n,h=me(a.shape),f=Yr(l,h),d=me(f);ee(h===d,()=>`The new shape (${f}) has ${d} elements and the old shape (${a.shape}) has ${h} elements. The new shape and old shape must have the same number of elements.`);let m=u.texData.get(a.dataId);return!m.isPacked||Lx(a.shape,f)||m.texture!==null&&Lx(m.shape,f)?(u.incRef(a.dataId),{dataId:a.dataId,shape:f,dtype:a.dtype}):function(g,x,R){let N=[Ng(g.shape),...Lg(g.shape)],F={dtype:g.dtype,shape:N,dataId:g.dataId},H=[Ng(x),...Lg(x)],W=new rT(H,N),G=[N],se=R.runWebGLProgram(W,[F],g.dtype,G,!0);return{dataId:se.dataId,shape:x,dtype:se.dtype}}(a,f,u)}let iL={kernelName:Ta,backendName:"webgl",kernelFunc:Xn};class mT{constructor(t,n){this.variableNames=["x"];let{windowSize:s,batchSize:a,inSize:l,outSize:u}=t;this.outputShape=[a,u];let h=4*Math.floor(s/4),f=s%4,d="sumValue += dot(values, ones);";if(n!=null){let g=1/n;d=`sumValue += dot(values * ${rt(g)?g.toPrecision(2):g}, ones);`}let m="";l%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${l}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${d}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${d}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${d}
        }
        setOutput(sumValue);
      }
    `}}class sL{constructor(t,n){this.variableNames=["x"];let{windowSize:s,batchSize:a,inSize:l,outSize:u}=t;this.outputShape=[a,u];let h="0.0",f="";n==="prod"?h="1.0":n==="min"?(h="1.0 / 1e-20",f="min"):n==="max"&&(h="-1.0 / 1e-20",f="max");let d=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?d="sumValue":n==="prod"?d="prodValue":n==="all"?d="allValue":n==="any"&&(d="anyValue");let m=4*Math.floor(s/4),g=s%4,x=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${f}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${f}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,R="vec4";n==="all"?(h="1.0",x=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,R="bvec4"):n==="any"&&(h="0.0",x=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,R="bvec4");let N="";l%s>0&&(N=`
        if (inIdx < 0 || inIdx >= ${l}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${h};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${N}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${h});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${m}; i += 4) {
          int inIdx = inOffset + i;
          ${R} values = ${R}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${x}
        }

        int inIdx = inOffset + ${m};
        if (${g===1}) {
          ${R} values = ${R}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${x}
        } else if (${g===2}) {
          ${R} values = ${R}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${x}
        } else if (${g===3}) {
          ${R} values = ${R}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${x}
        }
        setOutput(${d});
      }
    `}}function Qf(i,t,n,s){let a=function(u){let h=[];for(;h.length===0||h[h.length-1].outSize!==1;){let f=h.length?h[h.length-1].outSize:u[1],d=Vh(f);h.push({inSize:f,windowSize:d,outSize:Math.ceil(f/d)})}return h}(i.shape),l=i;for(let u=0;u<a.length;u++){let{inSize:h,windowSize:f,outSize:d}=a[u],m,g;m=n==="mean"?u===0?new mT({windowSize:f,inSize:h,batchSize:i.shape[0],outSize:d},h):new mT({windowSize:f,inSize:h,batchSize:i.shape[0],outSize:d}):new sL({windowSize:f,inSize:h,batchSize:i.shape[0],outSize:d},n),g=l,l=s.runWebGLProgram(m,[l],t),g.dataId!==i.dataId&&s.disposeIntermediateTensorInfo(g)}return l}class aL{constructor(t,n){this.variableNames=["A"];let s=new Array(t.length);for(let u=0;u<s.length;u++)s[u]=t[n[u]];this.outputShape=s,this.rank=s.length;let a=ys(this.rank),l=function(u){let h=u.length;if(h>6)throw Error(`Transpose for rank ${h} is not yet supported`);let f=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],d=new Array(h);for(let m=0;m<u.length;m++)d[u[m]]=f[m];return d.join()}(n);this.userCode=`
    void main() {
      ${a} resRC = getOutputCoords();
      setOutput(getA(${l}));
    }
    `}}class oL{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let s=new Array(t.length);for(let m=0;m<s.length;m++)s[m]=t[n[m]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let a=ys(this.rank),l=nT("rc",this.rank),u=new Array(this.rank);for(let m=0;m<n.length;m++)u[n[m]]=l[m];let h=`vec2(${u.slice(-2).join()})`,f=`++${l[this.rank-1]} < ${s[this.rank-1]}`,d=`getChannel(getA(${u.join()}), ${h})`;this.userCode=`
    void main() {
      ${a} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${d};
      if(${f}) {
        result[1] = ${d};
      }
      --${l[this.rank-1]};
      if(++${l[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${d};
        if(${f}) {
          result[3] = ${d};
        }
      }
      setOutput(result);
    }
    `}}function Ox(i,t,n){let s=Ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oL(i.shape,t):new aL(i.shape,t);return n.runWebGLProgram(s,[i],i.dtype)}function Bx(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s;return function(h,f,d,m){let g=f,x=h.shape.length,R=Zn(g,h.shape),N=R,F=Ws(N,x),H=F!=null,W=h;H&&(W=Ox(h,F,m),N=Zs(N.length,x)),ma("sum",N,x);let[G,se]=fa(W.shape,N),ge=G;d&&(ge=Ls(G,R));let Ce=me(se),Be=Xn({inputs:{x:W},attrs:{shape:[me(h.shape)/Ce,Ce]},backend:m}),Ve=Qf(Be,gh(h.dtype),"sum",m),ze=Xn({inputs:{x:Ve},attrs:{shape:ge},backend:m});return m.disposeIntermediateTensorInfo(Be),m.disposeIntermediateTensorInfo(Ve),H&&m.disposeIntermediateTensorInfo(W),ze}(a,l,u,n)}let lL={kernelName:uc,backendName:"webgl",kernelFunc:Bx};function bo(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{perm:l}=s,u=n,h=a.shape.length,f=new Array(h);for(let m=0;m<f.length;m++)f[m]=a.shape[l[m]];let d;if(u.shouldExecuteOnCPU([a])){let m=u.texData.get(a.dataId).values,g=lE(m,a.shape,a.dtype,l,f);d=u.makeTensorInfo(f,a.dtype),u.texData.get(d.dataId).values=g}else d=Ox(a,l,u);return d}let uL={kernelName:Ho,backendName:"webgl",kernelFunc:bo};function Ux({a:i,b:t,transposeA:n,transposeB:s,backend:a,bias:l=null,preluActivationWeights:u=null,leakyreluAlpha:h=0,activation:f=null}){let d=i.shape.length,m=t.shape.length,g=n?i.shape[d-2]:i.shape[d-1],x=s?t.shape[m-1]:t.shape[m-2],R=n?i.shape[d-1]:i.shape[d-2],N=s?t.shape[m-2]:t.shape[m-1],F=i.shape.slice(0,-2),H=t.shape.slice(0,-2),W=me(F),G=me(H),se=Zr(i.shape.slice(0,-2),t.shape.slice(0,-2)).concat([R,N]);ee(g===x,()=>`Error in matMul: inner shapes (${g}) and (${x}) of Tensors with shapes ${i.shape} and ${t.shape} and transposeA=${n} and transposeB=${s} must match.`);let ge=n?[W,g,R]:[W,R,g],Ce=s?[G,N,x]:[G,x,N],Be=Xn({inputs:{x:i},backend:a,attrs:{shape:ge}}),Ve=Xn({inputs:{x:t},backend:a,attrs:{shape:Ce}}),ze=[Be,Ve],Xe=Math.max(W,G),tt=n?Be.shape[1]:Be.shape[2],ot=l!=null,ut=u!=null,ft=f==="leakyrelu",kt=f!=null?Px(f,!0):null,Ut;if((R===1||N===1)&&tt>1e3&&(ot||ut||ft||kt!=null)===!1){let Lt=Be,zt=Ve;n&&(Lt=bo({inputs:{x:Be},backend:a,attrs:{perm:[0,2,1]}}),ze.push(Lt)),s&&(zt=bo({inputs:{x:Ve},backend:a,attrs:{perm:[0,2,1]}}),ze.push(zt));let Gt=N===1,qt=Lt;N!==1&&(qt=Xn({inputs:{x:Lt},backend:a,attrs:{shape:[Xe,tt,1]}}),ze.push(qt));let Ot=N===1?2:1,jt=zt;Gt&&(jt=Xn({inputs:{x:zt},backend:a,attrs:{shape:[Xe,1,tt]}}),ze.push(jt));let on=cE({inputs:{a:qt,b:jt},backend:a});Ut=Bx({inputs:{x:on},backend:a,attrs:{axis:Ot,keepDims:!0}}),ze.push(on)}else{let Lt=_a(i.dtype,t.dtype),zt=new dT(ge,Ce,[Xe,R,N],n,s,ot,kt,ut,ft),Gt=[Be,Ve];if(l!=null&&Gt.push(l),ut&&Gt.push(u),ft){let qt=a.makeTensorInfo([],"float32",ql(h,"float32"));Gt.push(qt),ze.push(qt)}Ut=a.runWebGLProgram(zt,Gt,Lt)}let It=Xn({inputs:{x:Ut},backend:a,attrs:{shape:se}});ze.push(Ut);for(let Lt of ze)a.disposeIntermediateTensorInfo(Lt);return It}let cL={kernelName:vd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{a,b:l,bias:u,preluActivationWeights:h}=t,{transposeA:f,transposeB:d,activation:m,leakyreluAlpha:g}=s;return Ux({a,b:l,transposeA:f,transposeB:d,backend:n,bias:u,preluActivationWeights:h,leakyreluAlpha:g,activation:m})}},gT="return abs(x);",hL={kernelName:Xt,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s}=t;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){let l=n.texData.get(s.dataId),u=eT(l.values);return n.makeTensorInfo(s.shape,s.dtype,u)}let a;return a=Ge().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Yf(s.shape,gT):new ed(s.shape,gT),n.runWebGLProgram(a,[s],s.dtype)}},dL=$i({opSnippet:`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`}),pL={kernelName:nr,backendName:"webgl",kernelFunc:dL},fL=$i({opSnippet:`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`}),mL={kernelName:yr,backendName:"webgl",kernelFunc:fL},yT="return a + b;",gL=za({opSnippet:yT,packedOpSnippet:yT,supportsComplex:!0,cpuKernelImpl:cN}),yL={kernelName:Tr,backendName:"webgl",kernelFunc:gL};class vL{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((l,u)=>`T${u}`);let s=[];this.variableNames.forEach(l=>{s.push(`float v${l} = get${l}AtOutCoords();`)});let a=this.variableNames.map(l=>`v${l}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${a};
        setOutput(result);
      }
    `}}class bL{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((l,u)=>`T${u}`);let s=[];this.variableNames.forEach(l=>{s.push(`vec4 v${l} = get${l}AtOutCoords();`)});let a=this.variableNames.map(l=>`v${l}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${a};
        setOutput(result);
      }
    `}}let xL={kernelName:qi,backendName:"webgl",kernelFunc:function i(t){let{inputs:n,backend:s}=t,a=n;if(a.length===1)return hl({inputs:{x:a[0]},backend:s});if(a.length>Ge().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let f=Math.floor(a.length/2),d=i({inputs:a.slice(0,f),backend:s}),m=i({inputs:a.slice(f),backend:s});return i({inputs:[d,m],backend:s})}let l=a.map(f=>f.dtype).reduce((f,d)=>_a(f,d)),u=a.map(f=>f.shape),h=Ge().getBool("WEBGL_PACK")?new bL(a[0].shape,u):new vL(a[0].shape,u);return s.runWebGLProgram(h,a,l)}},wL={kernelName:ai,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s,h=a.shape.length,f=Zn(l,a.shape),d=f,m=Ws(d,h),g=a;m!=null&&(g=bo({inputs:{x:a},backend:n,attrs:{perm:m}}),d=Zs(d.length,h)),ma("all",d,h);let[x,R]=fa(g.shape,d),N=Xn({inputs:{x:g},backend:n,attrs:{shape:[-1,me(R)]}}),F=Qf(N,N.dtype,"all",n),H;return H=Xn(u?{inputs:{x:F},backend:n,attrs:{shape:Ls(x,f)}}:{inputs:{x:F},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),m!=null&&n.disposeIntermediateTensorInfo(g),H}},AL={kernelName:Vr,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s,h=a.shape.length,f=Zn(l,a.shape),d=f,m=Ws(d,h),g=a;m!=null&&(g=bo({inputs:{x:a},backend:n,attrs:{perm:m}}),d=Zs(d.length,h)),ma("any",d,h);let[x,R]=fa(g.shape,d),N=Xn({inputs:{x:g},backend:n,attrs:{shape:[-1,me(R)]}}),F=Qf(N,N.dtype,"any",n),H;return H=Xn(u?{inputs:{x:F},backend:n,attrs:{shape:Ls(x,f)}}:{inputs:{x:F},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),m!=null&&n.disposeIntermediateTensorInfo(g),H}};class EL{constructor(t,n,s){this.variableNames=["A"];let{windowSize:a,batchSize:l,outSize:u}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[l,u];let h=n==="max"?">":"<",f=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${a};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${a}; i++) {
          int inIdx = ${f};
          float candidate = getA(batch, inIdx);
          if (candidate ${h} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}class SL{constructor(t,n,s,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ee(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);let l=t[t.length-1],u=Math.ceil(l/n);this.outputShape=t.slice(0,-1),u>1&&this.outputShape.push(u),a||this.variableNames.push("bestIndicesA");let h=this.outputShape,f=h.length,d=ys(f),m=vo("coords",f),g,x;if(u===1){x=f+1;let ze=ys(x);g=`
        ${ze} sourceLocR = ${ze}(${m.join()}, 0);
        ++${m[f-1]};
        ${ze} sourceLocG = ${ze}(${m.join()}, 0);
        ++${m[f-2]};
        ${ze} sourceLocA = ${ze}(${m.join()}, 0);
        --${m[f-1]};
        ${ze} sourceLocB = ${ze}(${m.join()}, 0);
        --${m[f-2]};`}else x=f,g=`
        ${d} sourceLocR = coords;
        ++${m[f-1]};
        ${d} sourceLocG = coords;
        ++${m[f-2]};
        ${d} sourceLocA = coords;
        --${m[f-1]};
        ${d} sourceLocB = coords;
        --${m[f-2]};`;let R=["x","y","z","w","u","v"].slice(0,x),N="."+R[x-1],F=R.map(ze=>"int "+ze),H=vo("sourceLocR",x-1).concat("inIdx.r"),W=vo("sourceLocG",x-1).concat("inIdx.g"),G=vo("sourceLocB",x-1).concat("inIdx.b"),se=vo("sourceLocA",x-1).concat("inIdx.a"),ge=s==="max"?"greaterThan":"lessThan",Ce=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${H.join()}),
                             getBestIndicesAChannel(${W.join()}),
                             getBestIndicesAChannel(${G.join()}),
                             getBestIndicesAChannel(${se.join()})));`,Be=`vec4(
            getAChannel(${H.join()}),
            hasNextCol ? getAChannel(${W.join()}) : 0.,
            hasNextRow ? getAChannel(${G.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${se.join()}) : 0.)`,Ve=a?"":`
      float getBestIndicesAChannel(${F.join()}) {
        return getChannel(getBestIndicesA(${R.join()}),
                                          vec2(${R.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${F.join()}) {
        return getChannel(getA(${R.join()}),
                               vec2(${R.slice(-2).join()}));
      }
      ${Ve}
      void main() {
        ${d} coords = getOutputCoords();
        bool hasNextCol = ${m[f-1]} < ${h[f-1]-1};
        bool hasNextRow = ${m[f-2]} < ${h[f-2]-1};
        ${g}
        ivec4 srcIdx = ivec4(sourceLocR${N}, sourceLocG${N},
          sourceLocB${N}, sourceLocA${N}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${Be};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${Ce}
          vec4 candidate = ${Be};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${ge}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}function vT(i,t,n,s=null){let a=t.shape[0],l=t.shape[1];s!=null&&(a=s.shape[0],l=s.shape[1]);let u=Vh(l),h={windowSize:u,inSize:l,batchSize:a,outSize:Math.ceil(l/u)},f=new EL(h,n,s==null),d=[t];s!=null&&d.push(s);let m=i.runWebGLProgram(f,d,"int32");if(m.shape[1]===1)return m;let g=vT(i,t,n,m);return i.disposeIntermediateTensorInfo(m),g}function bT(i,t,n,s=null){let a=s!=null?s.shape:t.shape,l=Vh(a[a.length-1]),u=new SL(a,l,n,s==null),h=s==null?[t]:[t,s],f=i.runWebGLProgram(u,h,"int32");if(f.shape.length===t.shape.length){let d=bT(i,t,n,f);return i.disposeIntermediateTensorInfo(f),d}return f}function xT(i,t,n,s){let a=[n];if(ma("arg"+s.charAt(0).toUpperCase()+s.slice(1),a,t.shape.length),!Ge().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let l=[],u=i.texData.get(t.dataId),h=t;u!==null&&u.isPacked&&(h=i.unpackTensor(t),l.push(h));let[f,d]=fa(h.shape,a),m=me(d),g=Xn({inputs:{x:h},backend:i,attrs:{shape:[-1,m]}});l.push(g);let x=vT(i,g,s);l.push(x);let R=Xn({inputs:{x},backend:i,attrs:{shape:f}});return l.forEach(N=>i.disposeIntermediateTensorInfo(N)),R}return bT(i,t,s)}let TL={kernelName:ui,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l}=s,u=Zn(l,a.shape),h=Ws(u,a.shape.length),f=a,d=[];h!=null&&(f=bo({inputs:{x:a},backend:n,attrs:{perm:h}}),d.push(f),u=Zs(u.length,f.shape.length)),ma("argMax",[u[0]],f.shape.length);let m=xT(n,f,u[0],"max");return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}},ML={kernelName:Zi,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l}=s,u=Zn(l,a.shape),h=Ws(u,a.shape.length),f=a,d=[];h!=null&&(f=bo({inputs:{x:a},backend:n,attrs:{perm:h}}),d.push(f),u=Zs(u.length,f.shape.length)),ma("argMin",[u[0]],f.shape.length);let m=xT(n,f,u[0],"min");return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}},_L=$i({opSnippet:`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`}),CL={kernelName:ks,backendName:"webgl",kernelFunc:_L},IL=$i({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),kL={kernelName:Mr,backendName:"webgl",kernelFunc:IL},RL=$i({opSnippet:`if (isnan(x)) return x;
  return atan(x);
`}),NL={kernelName:jr,backendName:"webgl",kernelFunc:RL},LL=za({opSnippet:`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,packedOpSnippet:`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`}),DL={kernelName:qs,backendName:"webgl",kernelFunc:LL},FL=$i({opSnippet:`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`}),PL={kernelName:Xr,backendName:"webgl",kernelFunc:FL};class nv{constructor(t,n,s,a=!1,l=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");let u=t.filterWidth,h=t.strideHeight,f=t.strideWidth,d=t.dilationHeight,m=t.dilationWidth,g=t.effectiveFilterHeight,x=t.effectiveFilterWidth,R=t.padInfo.top,N=t.padInfo.left;this.outputShape=t.outShape;let F=n==="avg",H=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,W=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`,G="0.0";if(F||(G="-1.0 / 1e-20"),s){let Ve=">=";return void(this.userCode=`
        const ivec2 strides = ivec2(${h}, ${f});
        const ivec2 pads = ivec2(${R}, ${N});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${g};
              wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${x};
                wC += ${m}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${Ve} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${a?l?H:W:`wR * ${x} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `)}let se=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(se="avgValue / count");let ge=4*Math.floor(u/4),Ce=u%4,Be=`
      if (${F}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${h}, ${f});
      const ivec2 pads = ivec2(${R}, ${N});
      const float initializationValue = ${G};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${G});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${g};
            wR += ${d}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${ge}; wC += 4) {
            int xC = xCCorner + wC * ${m};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${m}, d),
              getValue(batch, xR, xC + 2 * ${m}, d),
              getValue(batch, xR, xC + 3 * ${m}, d)
            );

            ${Be}
          }

          int xC = xCCorner + ${ge};
          if (${Ce===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${Be}
          } else if (${Ce===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${m}, d),
              initializationValue,
              initializationValue
            );

            ${Be}
          } else if (${Ce===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${m}, d),
              getValue(batch, xR, xC + 2 * ${m}, d),
              initializationValue
            );

            ${Be}
          }
        }
        setOutput(${se});
      }
    `}}class hE{constructor(t,n,s,a=!1,l=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");let u=t.filterWidth,h=t.strideDepth,f=t.strideHeight,d=t.strideWidth,m=t.dilationDepth,g=t.dilationHeight,x=t.dilationWidth,R=t.effectiveFilterDepth,N=t.effectiveFilterHeight,F=t.effectiveFilterWidth,H=t.padInfo.front,W=t.padInfo.top,G=t.padInfo.left;this.outputShape=t.outShape;let se=n==="avg",ge="0.0";if(se||(ge="-1.0 / 1e-20"),s){let Xe=">=";return void(this.userCode=`
        const ivec3 strides =
            ivec3(${h}, ${f}, ${d});
        const ivec3 pads = ivec3(${H}, ${W}, ${G});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${R};
              wD += ${m}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${N};
                wR += ${g}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${F};
                  wC += ${x}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${Xe} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${a?l?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${N} * ${F} +
                      wR * ${F} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `)}let Ce=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(Ce="avgValue / count");let Be=4*Math.floor(u/4),Ve=u%4,ze=`
      if (${se}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${h}, ${f}, ${d});
      const ivec3 pads = ivec3(${H}, ${W}, ${G});
      const float initializationValue = ${ge};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${ge});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${R};
            wD += ${m}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${N};
            wR += ${g}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${Be}; wC += 4) {
              int xC = xCCorner + wC * ${x};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${x}, ch),
                getValue(batch, xD, xR, xC + 2 * ${x}, ch),
                getValue(batch, xD, xR, xC + 3 * ${x}, ch)
              );

              ${ze}
            }

            int xC = xCCorner + ${Be};
            if (${Ve===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${ze}
            } else if (${Ve===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${x}, ch),
                initializationValue,
                initializationValue
              );

              ${ze}
            } else if (${Ve===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${x}, ch),
                getValue(batch, xD, xR, xC + 2 * ${x}, ch),
                initializationValue
              );

              ${ze}
            }
          }
          setOutput(${Ce});
        }
      }
    `}}let OL={kernelName:Bi,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t;Jy(a,"avgPool");let{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s;ee(pa(u,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${u} and dilations '1'`);let d=Ko(a.shape,l,u,1,h,f);if(d.filterWidth===1&&d.filterHeight===1&&Ye(d.inShape,d.outShape))return hl({inputs:{x:a},backend:n});let m=new nv(d,"avg",!1);return n.runWebGLProgram(m,[a],"float32")}},BL={kernelName:le,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{filterSize:l,strides:u,pad:h,dimRoundingMode:f,dataFormat:d}=s,m=Nu(a.shape,l,u,[1,1,1],h,f,d),g=new hE(m,"avg",!1);return n.runWebGLProgram(g,[a],"float32")}};class UL{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let n=t.filterHeight,s=t.filterWidth,a=t.strideHeight,l=t.strideWidth,u=t.dilationHeight,h=t.dilationWidth,f=t.effectiveFilterHeight,d=t.effectiveFilterWidth,m=f-1-t.padInfo.top,g=d-1-t.padInfo.left,x=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${m}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          float dyR = float(dyRCorner + wR) / ${a}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${d};
            wC+= ${h}) {
            float dyC = float(dyCCorner + wC) / ${l}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class zL{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let n=t.filterDepth,s=t.filterHeight,a=t.filterWidth,l=t.strideDepth,u=t.strideHeight,h=t.strideWidth,f=t.dilationDepth,d=t.dilationHeight,m=t.dilationWidth,g=t.effectiveFilterDepth,x=t.effectiveFilterHeight,R=t.effectiveFilterWidth,N=g-1-t.padInfo.front,F=x-1-t.padInfo.top,H=R-1-t.padInfo.left,W=1/(n*s*a);this.userCode=`
      const ivec3 pads = ivec3(${N}, ${F}, ${H});
      const float avgMultiplier = float(${W});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${f}) {
          float dyD = float(dyDCorner + wD) / ${l}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${x};
              wR += ${d}) {
            float dyR = float(dyRCorner + wR) / ${u}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${R};
                wC += ${m}) {
              float dyC = float(dyCCorner + wC) / ${h}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let $L={kernelName:de,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l}=t,u=l,{filterSize:h,strides:f,pad:d,dimRoundingMode:m}=s,g=Nu(u.shape,h,f,[1,1,1],d,m),x=new zL(g);return n.runWebGLProgram(x,[a],u.dtype)}},VL={kernelName:Ki,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l}=t,u=l;Jy([a,l],"avgPoolGrad");let{filterSize:h,strides:f,pad:d}=s,m=Ko(u.shape,h,f,1,d),g=new UL(m);return n.runWebGLProgram(g,[a],u.dtype)}},HL={kernelName:_e,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{a,b:l}=t,{transposeA:u,transposeB:h}=s;return Ux({a,b:l,transposeA:u,transposeB:h,backend:n})}};class GL{constructor(t,n,s,a,l,u){this.outputShape=[],this.variableNames=["x","mean","variance"],Zr(t,n),Zr(t,s);let h="0.0";a!=null&&(Zr(t,a),this.variableNames.push("offset"),h="getOffsetAtOutCoords()");let f="1.0";l!=null&&(Zr(t,l),this.variableNames.push("scale"),f="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${h};
        float scale = ${f};
        float inv = scale * inversesqrt(variance + float(${u}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}class WL{constructor(t,n,s,a,l,u){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Zr(t,n),Zr(t,s);let h="vec4(0.0)";a!=null&&(Zr(t,a),this.variableNames.push("offset"),h="getOffsetAtOutCoords()");let f="vec4(1.0)";l!=null&&(Zr(t,l),this.variableNames.push("scale"),f="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${h};
        vec4 scale = ${f};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${u}));

        setOutput((x - mean) * inv + offset);
      }
    `}}let jL={kernelName:yp,backendName:"webgl",kernelFunc:({inputs:i,backend:t,attrs:n})=>{let{x:s,mean:a,variance:l,offset:u,scale:h}=i;ee(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ee(u==null||a.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ee(h==null||a.shape.length===h.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:f}=n;f==null&&(f=.001);let d=[s,a,l],m=null;u!=null&&(m=u.shape,d.push(u));let g=null;h!=null&&(g=h.shape,d.push(h));let x=Ge().getBool("WEBGL_PACK_NORMALIZATION")?new WL(s.shape,a.shape,l.shape,m,g,f):new GL(s.shape,a.shape,l.shape,m,g,f);return t.runWebGLProgram(x,d,d[0].dtype)}};class XL{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;let n=ys(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let s=function(l){if(l===1)return"sourceLoc";if(l<=6)return dE.slice(0,l).map(u=>"sourceLoc."+u).join(",");throw Error(`Slicing for rank ${l} is not yet supported`)}(this.rank),a;a=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${t.map((l,u)=>`sourceLoc.${dE[u]} = start[${u}] + coords.${dE[u]};`).join(`
`)}
      `,this.userCode=`
      void main() {
        ${a}
        setOutput(getSource(${s}));
      }
    `}}let dE=["x","y","z","w","u","v"];class qL{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=ys(this.rank),s=vo("coords",this.rank),a=vo("sourceLoc",this.rank),l=this.rank===1?"sourceLoc":`vec2(${a.slice(-2).join()})`,u=`getChannel(getSource(${a.join()}), ${l})`,h=`
      result.x = ${u};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${a[this.rank-1]};
        result.y = ${u};
        --${a[this.rank-1]};
      }
    `,f=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${a[this.rank-2]};
        result.z = ${u};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${a[this.rank-1]};
          result.w = ${u};
        }
      }
    `,d=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((m,g)=>`start[${g}]`).join()});`:t.map((m,g)=>`${a[g]} = ${s[g]} + start[${g}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${d}
        vec4 result = vec4(0.);
        ${h}
        ${f}
        setOutput(result);
      }
    `}}function zg(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{begin:l,size:u}=s,[h,f]=ym(a,l,u);if(l0(a,h,f),me(f)===0)return n.makeTensorInfo(f,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||a.dtype==="string"){let g=n.texData.get(a.dataId),x=PN(g.values,h,f,a.shape,a.dtype);return n.makeTensorInfo(f,a.dtype,x)}let{isPacked:d}=n.texData.get(a.dataId),m=c0(a.shape,h,f);if(d||!m){let g=Ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qL(f):new XL(f),x=[h];return n.runWebGLProgram(g,[a],a.dtype,x)}return n.uploadToGPU(a.dataId),function(g,x,R,N){let F=N.texData.get(g.dataId),H=N.makeTensorInfo(R,g.dtype),W=N.texData.get(H.dataId);Object.assign(W,F),W.refCount=1,W.shape=R,W.dtype=g.dtype;let G=h0(x,Rn(g.shape));F.slice&&(G+=F.slice.flatOffset),W.slice={flatOffset:G,origDataId:F.slice&&F.slice.origDataId||g.dataId};let se=N.dataRefCount.get(W.slice.origDataId)||1;return N.dataRefCount.set(W.slice.origDataId,se+1),H}(a,h,f,n)}let KL={kernelName:Hl,backendName:"webgl",kernelFunc:zg},YL={kernelName:Ne,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{blockShape:l,crops:u}=s;ee(a.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let h=l.reduce((G,se)=>G*se),f=Cf(a.shape,l,h),d=Gu(f.length,l.length),m=If(a.shape,l,h),g=Wm(u,l.length),x=jm(m,u,l.length),R=[],N=Xn({inputs:{x:a},backend:n,attrs:{shape:f}}),F=bo({inputs:{x:N},backend:n,attrs:{perm:d}}),H=Xn({inputs:{x:F},backend:n,attrs:{shape:m}}),W=zg({inputs:{x:H},backend:n,attrs:{begin:g,size:x}});return R.push(N),R.push(F),R.push(H),R.forEach(G=>n.disposeIntermediateTensorInfo(G)),W}},QL={kernelName:He,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,weights:l}=t,{size:u}=s,h=n.readSync(a.dataId),f=n.readSync(l.dataId),d=JS(h,f,l.dtype,l.shape,u);return n.makeTensorInfo([u],l.dtype,d)}},ZL={kernelName:gt,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{s0:s,s1:a}=t,l=n.readSync(s.dataId),u=n.readSync(a.dataId),h=Zr(Array.from(l),Array.from(u));return n.makeTensorInfo([h.length],"int32",Int32Array.from(h))}},wT=za({opSnippet:"return float(a != b);",cpuKernelImpl:RN,dtype:"bool"}),JL={kernelName:_p,backendName:"webgl",kernelFunc:wT};function rv(i){let{inputs:t,backend:n}=i,{input:s}=t;return hl({inputs:{x:n.texData.get(s.dataId).complexTensorInfos.real},backend:n})}let eD={kernelName:Rs,backendName:"webgl",kernelFunc:rv},tD={kernelName:Yt,backendName:"webgl",kernelFunc:function i(t){let{inputs:n,backend:s,attrs:a}=t,{x:l}=n,{dtype:u}=a;if(u==="complex64"){if(l.dtype==="complex64")return hl({inputs:{x:l},backend:s});let h=js(l.shape),f=i({inputs:{x:l},backend:s,attrs:{dtype:"float32"}}),d=mp({inputs:{real:f,imag:h},backend:s});return h.dispose(),s.disposeIntermediateTensorInfo(f),d}if(l.dtype==="complex64"){let h=rv({inputs:{input:l},backend:s}),f=i({inputs:{x:h},backend:s,attrs:{dtype:u}});return s.disposeIntermediateTensorInfo(h),f}if(!cr(l.dtype,u)){let h=hl({inputs:{x:l},backend:s});return{dataId:h.dataId,shape:h.shape,dtype:u}}if(u==="int32")return function(h,f){let d=new ed(h.shape,"return float(int(x));"),m=f.runWebGLProgram(d,[h],"int32");return{dataId:m.dataId,shape:m.shape,dtype:m.dtype}}(l,s);if(u==="bool"){let h=s.makeTensorInfo([],"bool",Pr("bool",1)),f=wT({inputs:{a:l,b:h},backend:s});return s.disposeIntermediateTensorInfo(h),f}throw new Error(`Error in Cast: failed to cast ${l.dtype} to ${u}`)}},AT="return ceil(x);",nD=$i({opSnippet:AT,packedOpSnippet:AT,cpuKernelImpl:dN}),rD={kernelName:Qt,backendName:"webgl",kernelFunc:nD};class iD{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}class sD{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}let aD={kernelName:At,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{clipValueMin:l,clipValueMax:u}=s,h;h=Ge().getBool("WEBGL_PACK_CLIP")?new sD(a.shape):new iD(a.shape);let f=[[l],[u]];return n.runWebGLProgram(h,[a],a.dtype,f)}};class oD{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}function ET(i,t){return{dataId:t.dataId,dtype:t.dtype,shape:i.shape}}let lD={kernelName:hn,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s}=t,a=n.texData.get(s.dataId),l=new oD(s.shape),u=[ET(s,a.complexTensorInfos.real),ET(s,a.complexTensorInfos.imag)];return n.runWebGLProgram(l,u,u[0].dtype)}};class uD{constructor(t){this.outputShape=[],this.outputShape=No(t,1),this.variableNames=t.map((u,h)=>`T${h}`);let n=new Array(t.length-1);n[0]=t[0][1];for(let u=1;u<n.length;u++)n[u]=n[u-1]+t[u][1];let s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let u=1;u<n.length;u++){let h=n[u-1];s.push(`else if (yC < ${n[u]}) setOutput(getT${u}(yR, yC-${h}));`)}let a=n.length,l=n[n.length-1];s.push(`else setOutput(getT${a}(yR, yC-${l}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}class cD{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=No(t,n);let s=this.outputShape,a=s.length,l=ys(a),u=vo("coords",a),h=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((F,H)=>`T${H}`);let f=new Array(t.length-1);f[0]=t[0][n];for(let F=1;F<f.length;F++)f[F]=f[F-1]+t[F][n];let d=h[n],m=h.slice(-2),g=h.join(),x=`if (${d} < ${f[0]}) {
        return getChannel(
            getT0(${g}), vec2(${m.join()}));
        }`;for(let F=1;F<f.length;F++){let H=f[F-1];x+=`
        if (${d} < ${f[F]}  && ${d} >= ${f[F-1]}) {
          return getChannel(
            getT${F}(${zx(h,d,H)}),
            vec2(${zx(m,d,H)}));
        }`}let R=f.length,N=f[f.length-1];x+=`
        return getChannel(
          getT${R}(${zx(h,d,N)}),
          vec2(${zx(m,d,N)}));`,this.userCode=`
      float getValue(${h.map(F=>"int "+F)}) {
        ${x}
      }

      void main() {
        ${l} coords = getOutputCoords();
        vec4 result = vec4(getValue(${u}), 0., 0., 0.);

        ${u[a-1]} = ${u[a-1]} + 1;
        if (${u[a-1]} < ${s[a-1]}) {
          result.g = getValue(${u});
        }

        ${u[a-2]} = ${u[a-2]} + 1;
        if (${u[a-2]} < ${s[a-2]}) {
          result.a = getValue(${u});
        }

        ${u[a-1]} = ${u[a-1]} - 1;
        if (${u[a-2]} < ${s[a-2]} &&
            ${u[a-1]} < ${s[a-1]}) {
          result.b = getValue(${u});
        }
        setOutput(result);
      }
    `}}function zx(i,t,n){let s=i.indexOf(t);return i.map((a,l)=>l===s?`${a} - ${n}`:a).join()}function $x(i){let{inputs:t,backend:n}=i,{input:s}=t;return hl({inputs:{x:n.texData.get(s.dataId).complexTensorInfos.imag},backend:n})}let hD={kernelName:od,backendName:"webgl",kernelFunc:$x};function $g(i,t,n){let s=i[0].dtype;if(s==="complex64"){let m=i.map(F=>rv({inputs:{input:F},backend:n})),g=i.map(F=>$x({inputs:{input:F},backend:n})),x=$g(m,t,n),R=$g(g,t,n),N=mp({inputs:{real:x,imag:R},backend:n});return m.forEach(F=>n.disposeIntermediateTensorInfo(F)),g.forEach(F=>n.disposeIntermediateTensorInfo(F)),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(R),N}let a=n.shouldExecuteOnCPU(i);if(s==="string"&&(a=!0),a){let m=i.map(W=>{let G=me(W.shape.slice(t));return Xn({inputs:{x:W},backend:n,attrs:{shape:[-1,G]}})}),g=m.map(W=>({vals:n.readSync(W.dataId),shape:W.shape})),x=No(m.map(W=>W.shape),1),R=m[0].shape[0]===1,N=pN(g,x,s,R),F=No(i.map(W=>W.shape),t),H=n.makeTensorInfo(F,s,N);return m.forEach(W=>n.disposeIntermediateTensorInfo(W)),H}if(i.length>Ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let m=Math.floor(i.length/2),g=$g(i.slice(0,m),t,n),x=$g(i.slice(m),t,n),R=$g([g,x],t,n);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),R}if(Ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1){let m=new cD(i.map(g=>g.shape),t);return n.runWebGLProgram(m,i,s)}let{tensors2D:l,outShape:u}=function(m,g,x){let R=No(m.map(N=>N.shape),g);return{tensors2D:m.map(N=>Xn({inputs:{x:N},attrs:{shape:[-1,me(N.shape.slice(g))]},backend:x})),outShape:R}}(i,t,n),h=new uD(l.map(m=>m.shape)),f=n.runWebGLProgram(h,l,s);l.forEach(m=>n.disposeIntermediateTensorInfo(m));let d=Xn({inputs:{x:f},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(f),d}function ST(i){let{inputs:t,backend:n,attrs:s}=i,{axis:a}=s,l=Zn(a,t[0].shape)[0],u=No(t.map(f=>f.shape),l);if(me(u)===0)return n.makeTensorInfo(u,t[0].dtype,[]);let h=t.filter(f=>me(f.shape)>0);return h.length===1?hl({inputs:{x:h[0]},backend:n}):(As(h.map(f=>f.shape),l),$g(h,l,n))}let dD={kernelName:zn,backendName:"webgl",kernelFunc:ST};class TT{constructor(t,n=!1,s=null,a=!1,l=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;let u=t.padInfo.top,h=t.padInfo.left,f=t.strideHeight,d=t.strideWidth,m=t.dilationHeight,g=t.dilationWidth,x=t.filterHeight,R=t.filterWidth,N=4*Math.floor(t.inChannels/4),F=t.inChannels%4,H=t.dataFormat==="channelsLast",W=H?1:2,G=H?2:3,se=H?3:1,ge="",Ce="";s&&(ge=a?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:l?`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:`
          float activation(float x) {
            ${s}
          }
        `,Ce="result = activation(result);");let Be=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${ge}

      const ivec2 strides = ivec2(${f}, ${d});
      const ivec2 pads = ivec2(${u}, ${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${se}];

        ivec2 xRCCorner =
            ivec2(coords[${W}], coords[${G}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${x}; wR++) {
          int xR = xRCorner + wR * ${m};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${R}; wC++) {
            int xC = xCCorner + wC * ${g};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${N}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${H}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${F===1}) {

              if (${H}) {
                dotProd +=
                    getX(batch, xR, xC, ${N}) *
                    getW(wR, wC, ${N}, d2);
              } else {
                dotProd +=
                    getX(batch, ${N}, xR, xC) *
                    getW(wR, wC, ${N}, d2);
              }

            } else if (${F===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${N}, d2),
                getW(wR, wC, ${N} + 1, d2)
              );

              if (${H}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${N}),
                  getX(batch, xR, xC, ${N} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${N}, xR, xC),
                  getX(batch, ${N} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${F===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${N}, d2),
                getW(wR, wC, ${N} + 1, d2),
                getW(wR, wC, ${N} + 2, d2)
              );

              if (${H}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${N}),
                  getX(batch, xR, xC, ${N} + 1),
                  getX(batch, xR, xC, ${N} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${N}, xR, xC),
                  getX(batch, ${N} + 1, xR, xC),
                  getX(batch, ${N} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${Be}
        ${Ce}
        setOutput(result);
      }
    `}}class pD{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let n=t.padInfo.front,s=t.padInfo.top,a=t.padInfo.left,l=t.strideDepth,u=t.strideHeight,h=t.strideWidth,f=t.dilationDepth,d=t.dilationHeight,m=t.dilationWidth,g=t.filterDepth,x=t.filterHeight,R=t.filterWidth,N=4*Math.floor(t.inChannels/4),F=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${l}, ${u}, ${h});
      const ivec3 pads = ivec3(${n}, ${s}, ${a});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${g}; wF++) {
          int xF = xFCorner + wF * ${f};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x}; wR++) {
            int xR = xRCorner + wR * ${d};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${R}; wC++) {
              int xC = xCCorner + wC * ${m};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${N}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${F===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${N}) *
                  getW(wF, wR, wC, ${N}, d2);
              } else if (${F===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${N}),
                  getX(batch, xF, xR, xC, ${N} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${N}, d2),
                  getW(wF, wR, wC, ${N} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${F===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${N}),
                  getX(batch, xF, xR, xC, ${N} + 1),
                  getX(batch, xF, xR, xC, ${N} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${N}, d2),
                  getW(wF, wR, wC, ${N} + 1, d2),
                  getW(wF, wR, wC, ${N} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class fD{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Po(this.outputShape.length);let{dataFormat:s}=n,a=yo(),l=s==="channelsLast",u=l?0:1,h=l?1:2,f=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${t[1]} && pos < ${t[0]}) {`,d="";for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)d+=`
          blockIndex = rc.y + ${g};
          pos = rc.x + ${m};

          ${f}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${u}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${h}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${l}) {
                  innerDims = vec2(d1, ch);
                  result[${2*m+g}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${2*m+g}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${d}

        ${a.output} = result;
      }
    `}}function MT({x:i,filter:t,convInfo:n,backend:s,bias:a=null,preluActivationWeights:l=null,leakyreluAlpha:u=0,activation:h=null}){let f=i.shape,d=s.texData.get(i.dataId),m=n.inChannels,g=f[0]*f[1]*f[2],x=n.outChannels,R=n.dataFormat==="channelsLast",N,F=[];if((g!==1&&x!==1||!(m>1e3))&&d.isPacked&&R&&d.texture!=null&&f[2]%2!=0&&Ye(d.shape.slice(-3),f.slice(-3))){let H=f[0]*f[1]*(f[2]+1),W={dataId:i.dataId,shape:[1,H,n.inChannels],dtype:i.dtype},G=d.shape;d.shape=d.shape.slice(),d.shape[d.shape.length-2]++,ee(Lx(d.shape,W.shape),()=>`packed reshape ${d.shape} to ${W.shape} isn't free`);let se=Xn({inputs:{x:t},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});F.push(se);let ge=Ux({a:W,b:se,backend:s,transposeA:!1,transposeB:!1,bias:a,activation:h,preluActivationWeights:l,leakyreluAlpha:u}),Ce=s.texData.get(ge.dataId);ee(Ce.isPacked,()=>"batchMatMul result is expected to be packed"),d.shape=G,Ce.shape=n.outShape,N=hl({inputs:{x:ge},backend:s}),N.shape=n.outShape,F.push(ge)}else{let H=Xn({inputs:{x:i},backend:s,attrs:{shape:[1,R?f[0]*f[1]*f[2]:f[0]*f[2]*f[3],n.inChannels]}}),W=Xn({inputs:{x:t},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),G=Ux({a:H,b:W,transposeA:!1,transposeB:!1,backend:s,bias:a,activation:h,preluActivationWeights:l,leakyreluAlpha:u});N=Xn({inputs:{x:G},backend:s,attrs:{shape:n.outShape}}),F.push(H),F.push(W),F.push(G)}for(let H of F)s.disposeIntermediateTensorInfo(H);return N}function _T({x:i,filter:t,convInfo:n,backend:s,bias:a=null,preluActivationWeights:l=null,leakyreluAlpha:u=0,activation:h=null}){let{filterWidth:f,filterHeight:d,inChannels:m,outWidth:g,outHeight:x,dataFormat:R}=n,N=R==="channelsLast",F=f*d*m,H=x*g,W=[F,H],G=[],se=Xn({inputs:{x:i},backend:s,attrs:{shape:i.shape.slice(1)}}),ge=Xn({inputs:{x:t},backend:s,attrs:{shape:[1,F,me(t.shape)/F]}});G.push(se),G.push(ge);let Ce=new fD(W,n),Be=[se.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],Ve=s.runWebGLProgram(Ce,[se],"float32",Be),ze=Xn({inputs:{x:Ve},backend:s,attrs:{shape:[1,W[0],W[1]]}});G.push(Ve),G.push(ze);let Xe=a!=null,tt=l!=null,ot=h==="leakyrelu",ut=h?Px(h,!0):null,ft=new dT(ze.shape,ge.shape,[1,H,n.outChannels],!0,!1,Xe,ut,tt,ot),kt=[ze,ge];if(a&&kt.push(a),tt&&kt.push(l),ot){let Lt=s.makeTensorInfo([],"float32",ql(u,"float32"));kt.push(Lt),G.push(Lt)}let Ut=s.runWebGLProgram(ft,kt,"float32"),It=Xn({inputs:{x:Ut},backend:s,attrs:{shape:N?[1,x,g,n.outChannels]:[1,n.outChannels,x,g]}});G.push(Ut);for(let Lt of G)s.disposeIntermediateTensorInfo(Lt);return It}let mD={kernelName:Kn,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dataFormat:f,dilations:d,dimRoundingMode:m}=s,g=nu(f),x=ta(a.shape,l.shape,u,d,h,m,!1,g),R;if(x.filterHeight!==1||x.filterWidth!==1||x.dilationHeight!==1||x.dilationWidth!==1||x.strideHeight!==1||x.strideWidth!==1||x.padInfo.type!=="SAME"&&x.padInfo.type!=="VALID")if(Ge().getBool("WEBGL_CONV_IM2COL")&&a.shape[0]===1)R=_T({x:a,filter:l,convInfo:x,backend:n});else{let F=new TT(x);R=n.runWebGLProgram(F,[a,l],"float32")}else R=MT({x:a,filter:l,convInfo:x,backend:n});let N=Xn({inputs:{x:R},backend:n,attrs:{shape:x.outShape}});return n.disposeIntermediateTensorInfo(R),N}};class gD{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let n=t.strideHeight,s=t.strideWidth,a=t.padInfo.top,l=t.padInfo.left,u=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${a};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${l};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              if (${u}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class yD{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let n=t.filterHeight,s=t.filterWidth,a=t.strideHeight,l=t.strideWidth,u=t.dataFormat==="channelsLast",h=n-1-t.padInfo.top,f=s-1-t.padInfo.left,d=u?1:2,m=u?2:3,g=u?3:1;this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${g}];

        ivec2 dyCorner = ivec2(coords[${d}], coords[${m}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${a}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${l}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${u}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class vD{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let n=t.strideDepth,s=t.strideHeight,a=t.strideWidth,l=t.padInfo.front,u=t.padInfo.top,h=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${l};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${u};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${a} - ${h};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class bD{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let n=t.filterDepth,s=t.filterHeight,a=t.filterWidth,l=t.strideDepth,u=t.strideHeight,h=t.strideWidth,f=n-1-t.padInfo.front,d=s-1-t.padInfo.top,m=a-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${d}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${l}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${u}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${a}; wC++) {
              float dyC = float(dyCCorner + wC) / ${h}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${a} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let xD={kernelName:hr,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,dy:l}=t,{strides:u,pad:h,dataFormat:f,dimRoundingMode:d,filterShape:m}=s,g=nu(f),x=ta(a.shape,m,u,1,h,d,!1,g),R=new gD(x);return n.runWebGLProgram(R,[a,l],"float32")}},wD={kernelName:Rr,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,filter:l}=t,{inputShape:u,strides:h,pad:f,dataFormat:d,dimRoundingMode:m}=s,g=nu(d),x=ta(u,l.shape,h,1,f,m,!1,g),R=new yD(x);return n.runWebGLProgram(R,[a,l],"float32")}},AD={kernelName:Nr,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dilations:f}=s,d=bc(a.shape,l.shape,u,f,h),m=new pD(d);return n.runWebGLProgram(m,[a,l],"float32")}},ED={kernelName:kr,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,dy:l}=t,{strides:u,pad:h,filterShape:f}=s,d=bc(a.shape,f,u,1,h),m=new vD(d);return n.runWebGLProgram(m,[a,l],"float32")}},SD={kernelName:ki,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,filter:l}=t,{pad:u,strides:h,inputShape:f}=s,d=bc(f,l.shape,h,1,u),m=new bD(d);return n.runWebGLProgram(m,[a,l],"float32")}},TD=$i({opSnippet:`if (isnan(x)) return x;
  return cos(x);
`}),MD={kernelName:Ji,backendName:"webgl",kernelFunc:TD},_D=$i({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),CD={kernelName:vs,backendName:"webgl",kernelFunc:_D};class ID{constructor(t,n,s,a,l){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[u,h,f,d]=t,[m]=n,[g,x]=s;this.outputShape=[m,g,x,d];let R=a==="bilinear"?1:0,[N,F]=[h-1+".0",f-1+".0"],[H,W,G]=g>1?[""+(h-1)/(g-1),"(y2-y1) * height_ratio",`y1*${N} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${N}`],[se,ge,Ce]=x>1?[""+(f-1)/(x-1),"(x2-x1) * width_ratio",`x1*${F} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${F}`];this.userCode=`
      const float height_ratio = float(${H});
      const float width_ratio = float(${se});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${u}) {
          return;
        }

        float height_scale = ${W};
        float width_scale = ${ge};

        float in_y = ${G};
        if( in_y < 0.0 || in_y > ${N} ) {
          setOutput(float(${l}));
          return;
        }
        float in_x = ${Ce};
        if( in_x < 0.0 || in_x > ${F} ) {
          setOutput(float(${l}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${R} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}let kD={kernelName:Qr,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n,attrs:s}=i,{image:a,boxes:l,boxInd:u}=t,{cropSize:h,method:f,extrapolationValue:d}=s,m=new ID(a.shape,l.shape,h,f,d);return n.runWebGLProgram(m,[a,l,u],"float32")}};class CT{constructor(t,n,s){this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=t;let a=t.length,l=n?"0.0":`getX(${IT(a,"coords")})`,u=t[t.length-1],h="",f="";n?(h=s?"end != "+(u-1):"end != 0",f=s?"end + 1":"end - 1"):(h=s?`end + pow2 < ${u}`:"end >= pow2",f=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ys(a)} coords = getOutputCoords();
        int end = ${kT(a,"coords")};
        float val = ${l};
        int pow2 = int(pow(2.0, index));
        if (${h}) {
          int idx = ${f};
          ${kT(a,"coords")} = idx;
          val += getX(${IT(a,"coords")});
        }
        setOutput(val);
      }
    `}}function IT(i,t){if(i===1)return`${t}`;if(i===2)return`${t}.x, ${t}.y`;if(i===3)return`${t}.x, ${t}.y, ${t}.z`;if(i===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative sum for rank ${i} is not yet supported`)}function kT(i,t){if(i===1)return`${t}`;if(i===2)return`${t}.y`;if(i===3)return`${t}.z`;if(i===4)return`${t}.w`;throw Error(`Cumulative sum for rank ${i} is not yet supported`)}let RD={kernelName:Ei,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,exclusive:u,reverse:h}=s,f=a.shape.length,d=Ws([l],f),m=a;d!=null&&(m=bo({inputs:{x:a},backend:n,attrs:{perm:d}}));let g=Zs(1,f)[0];if(g!==f-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${a.shape.length-1} but got axis=${l}`);let x=m.shape[g],R=hl({inputs:{x:m},backend:n});for(let N=0;N<=Math.ceil(Math.log2(x))-1;N++){let F=new CT(m.shape,!1,h),H=[[N]],W=R;R=n.runWebGLProgram(F,[R],R.dtype,H),n.disposeIntermediateTensorInfo(W)}if(u){let N=new CT(m.shape,u,h),F=R;R=n.runWebGLProgram(N,[R],R.dtype),n.disposeIntermediateTensorInfo(F)}if(d!=null){let N=bo({inputs:{x:R},backend:n,attrs:{perm:Bd(d)}});return n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(m),N}return R}},ND={kernelName:oa,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,weights:l}=t,{size:u,binaryOutput:h}=s;if(a.shape.length===1){let f=n.readSync(a.dataId),d=n.readSync(l.dataId),m=JS(f,d,l.dtype,l.shape,u);return n.makeTensorInfo([u],l.dtype,m)}if(a.shape.length===2){let f=n.bufferSync(a),d=n.bufferSync(l),m=hN(f,d,u,h);return n.makeTensorInfo(m.shape,l.dtype,m.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}};class LD{constructor(t,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}let DD={kernelName:la,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{blockSize:l,dataFormat:u}=s,h=a.shape[0],f=(u==="NHWC"?a.shape[1]:a.shape[2])*l,d=(u==="NHWC"?a.shape[2]:a.shape[3])*l,m=(u==="NHWC"?a.shape[3]:a.shape[1])/(l*l),g=new LD(u==="NHWC"?[h,f,d,m]:[h,m,f,d],l,u);return n.runWebGLProgram(g,[a],a.dtype)}};class RT{constructor(t,n=!1,s=null,a=!1,l=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Po(this.outputShape.length);let u=t.filterHeight,h=t.filterWidth,f=t.outChannels/t.inChannels,d="",m="";s&&(d=a?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:l?`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:`
          float activation(float x) {
            ${s}
          }
        `,m="result = activation(result);");let g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${d}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${f};
        int q = d2 - d1 * ${f};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${u}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${g}
        ${m}
        setOutput(result);
      }
    `}}class NT{constructor(t,n=!1,s=null,a=!1,l=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Po(this.outputShape.length);let u=t.outChannels/t.inChannels,h=t.padInfo.left,f=t.strideWidth,d=t.dilationWidth,m=t.filterHeight,g=t.filterWidth,x=g,R=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let W=0;W<g;W++)R+=`
          vec4 xTexelC${2*W};
          int xTexelC${2*W}Ready;
          vec4 xTexelC${2*W+1};
          int xTexelC${2*W+1}Ready;
          vec4 xC${W};`;R+=`
    for (int r = 0; r < ${m}; r++) {
      `;for(let W=0;W<g;W++)R+=`
          xTexelC${2*W} = vec4(0.0);
          xTexelC${2*W}Ready = 0;
          xTexelC${2*W+1} = vec4(0.0);
          xTexelC${2*W+1}Ready = 0;
          xC${W} = vec4(0.0);`;R+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let W=0;W<(x+1)/2;W++){let G=2*W;if(R+=`
          xC = xCCorner + ${G*d};
          `,f===1){if(G<g&&(h%2==1?(R+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G}Ready == 0) {
                  xTexelC${G} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${G}.zw = vec2(0.0);
                  }
                  xTexelC${G}Ready = 1;
                }
              `,R+=d===1&&G>0?`
                xC${G} = vec4(xTexelC${G-2}.zw, xTexelC${G}.xy);
                `:`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${G} = vec4(previous.zw, xTexelC${G}.xy);
                  } else {
                    xC${G} = vec4(0.0, 0.0, xTexelC${G}.xy);
                  }
                  `):R+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${G}Ready == 0) {
                  xTexelC${G} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${G}.zw = vec2(0.0);
                  }
                  xTexelC${G}Ready = 1;
                }

                xC${G} = xTexelC${G};
                `,G+1<g)){let se=h%2==0?ye(d):d;d%2==0&&h%2==1||d%2!=0&&h%2!=1?(R+=`
                  xCOffset = xC + imod(pads[1], 2) + ${se};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G+1}Ready == 0) {
                    xTexelC${G+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${G+1}.zw = vec2(0.0);
                    }
                    xTexelC${G+1}Ready = 1;
                  }
                  `,d>1&&(R+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G}Ready == 0) {
                      xTexelC${G} = getX(batch, xR, xCOffset, d1);
                      xTexelC${G}Ready = 1;
                    }
                    `),R+=`
                  xC${G+1} = vec4(xTexelC${G}.zw, xTexelC${G+1}.xy);
                  `):R+=se===1?`
                    xC${G+1} = xTexelC${G};
                    `:`
                    xCOffset = xC + ${se};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G+1}Ready == 0) {
                      xTexelC${G+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${G+1}.zw = vec2(0.0);
                      }
                      xTexelC${G+1}Ready = 1;
                    }

                    xC${G+1} = xTexelC${G+1};
                    `}}else G<g&&(h%2==1?(R+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G}Ready == 0) {
                  xTexelC${G} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${G}.zw = vec2(0.0);
                  }
                  xTexelC${G}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${G+1}Ready == 0) {
                  xTexelC${G+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${G+1}.zw = vec2(0.0);
                  }
                  xTexelC${G+1}Ready = 1;
                }

                xC${G} = vec4(xTexelC${G}.zw, xTexelC${G+1}.zw);
              `,G+1<g&&(R+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${G+1} = vec4(xTexelC${G+1}.xy, final.xy);
                `)):(R+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${G}Ready == 0) {
                  xTexelC${G} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${G}.zw = vec2(0.0);
                  }
                  xTexelC${G}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G+1}Ready == 0) {
                  xTexelC${G+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${G+1}.zw = vec2(0.);
                  }
                  xTexelC${G+1}Ready = 1;
                }

                xC${G} = vec4(
                  xTexelC${G}.xy, xTexelC${G+1}.xy);
              `,G+1<g&&(R+=`
                  xC${G+1} = vec4(xTexelC${G}.zw, xTexelC${G+1}.zw);
                `)));G<g&&(R+=`
            wTexel = getW(r, ${G}, d1, q);
            dotProd += xC${G} * vec4(wTexel.xz, wTexel.xz);
          `,G+1<g&&(R+=`
              wTexel = getW(r, ${G+1}, d1, q);
              dotProd += xC${G+1} * vec4(wTexel.xz, wTexel.xz);
            `))}R+=`
    }
  `,R+=`
      }
    `;let N="",F="";s&&(N=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:l?`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:`vec4 activation(vec4 x) {
          ${s}
        }`,F="result = activation(result);");let H=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${N}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${R}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${H}
        ${F}
        setOutput(result);
      }
    `}}let FD={kernelName:bs,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dilations:f,dimRoundingMode:d}=s,m=f;m==null&&(m=[1,1]),ee(pa(u,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`);let g=ta(a.shape,l.shape,u,m,h,d,!0),x;x=Ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1?new NT(g):new RT(g);let R=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]];return n.runWebGLProgram(x,[a,l],"float32",R)}};class PD{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let n=t.strideHeight,s=t.strideWidth,a=t.padInfo.top,l=t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${u} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${a};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${l};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class OD{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let n=t.filterHeight,s=t.filterWidth,a=t.strideHeight,l=t.strideWidth,u=n-1-t.padInfo.top,h=s-1-t.padInfo.left,f=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${a}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${l}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${f}; dm++) {
              int d2 = d1 * ${f} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let BD={kernelName:ua,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,dy:l}=t,{strides:u,dilations:h,pad:f,dimRoundingMode:d,filterShape:m}=s,g=ta(a.shape,m,u,h,f,d,!0),x=new PD(g);return n.runWebGLProgram(x,[a,l],"float32")}},UD={kernelName:Ao,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,filter:l}=t,{strides:u,dilations:h,pad:f,dimRoundingMode:d,inputShape:m}=s,g=ta(m,l.shape,u,h,f,d,!0),x=new OD(g);return n.runWebGLProgram(x,[a,l],"float32")}};class zD{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}let $D={kernelName:Eo,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s}=t,a=[...s.shape,...s.shape],l=me(s.shape),u=Xn({inputs:{x:s},backend:n,attrs:{shape:[l]}}),h=new zD(l),f=n.runWebGLProgram(h,[u],u.dtype),d=Xn({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(f),d}};class VD{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let{inHeight:n,inWidth:s,padInfo:a,strideHeight:l,strideWidth:u,filterHeight:h,filterWidth:f,dilationHeight:d,dilationWidth:m}=t,{top:g,left:x}=a;this.userCode=`
      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${g}, ${x});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${h}; h++) {
          int hIn = hBeg + h * ${d};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${f}; w++) {
              int wIn = wBeg + w * ${m};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}let HD={kernelName:dl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l}=t,{strides:u,pad:h,dilations:f}=s,d=vc(a.shape,l.shape,u,h,"NHWC",f),m,g=new VD(d);m=n.runWebGLProgram(g,[a,l],"float32");let x=Xn({inputs:{x:m},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(m),x}},GD={kernelName:Bl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{equation:a}=s,l=t,{allDims:u,summedDims:h,idDims:f}=Vc(a,l.length);Gc(u.length,f,l);let{path:d,steps:m}=kf(h,f),g=m.length,x=null,R=u.length,N=[];for(let F=0;F<g;++F){for(let H of m[F]){let{permutationIndices:W,expandDims:G}=Hc(R,f[H]),se;Km(W)?se=l[H]:(se=bo({inputs:{x:l[H]},backend:n,attrs:{perm:W}}),N.push(se));let ge=se.shape.slice();for(let Ce=0;Ce<G.length;++Ce)ge.splice(G[Ce],0,1);Ye(se.shape,ge)||(se=Xn({inputs:{x:se},backend:n,attrs:{shape:ge}}),N.push(se)),x===null?x=se:(x=cE({inputs:{a:se,b:x},backend:n}),N.push(x))}F<g-1&&(d[F]>=0&&(x=Bx({inputs:{x},backend:n,attrs:{axis:d[F]-(u.length-R),keepDims:!1}}),N.push(x)),R--)}for(let F of N)F!==x&&n.disposeIntermediateTensorInfo(F);return x}},WD=$i({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),jD={kernelName:Bo,backendName:"webgl",kernelFunc:WD},XD={kernelName:Ul,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n}=i,{dy:s,y:a}=t,l=Ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tv(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,s.shape,a.shape):new Ug("return (b >= 1.0) ? a : a * (b + 1.0);",s.shape,a.shape);return n.runWebGLProgram(l,[s,a],s.dtype)}},qD=za({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:fN}),KD={kernelName:pl,backendName:"webgl",kernelFunc:qD},YD=$i({opSnippet:`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Z0};
  float a1 = ${el};
  float a2 = ${Xm};
  float a3 = ${qm};
  float a4 = ${tl};
  float a5 = ${J0};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`}),QD={kernelName:Uo,backendName:"webgl",kernelFunc:YD},LT=$i({opSnippet:`if (isnan(x)) return x;
  return exp(x);
`,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:mN,dtype:"float32"}),ZD={kernelName:zo,backendName:"webgl",kernelFunc:LT};function pE(i){let{inputs:t,attrs:n,backend:s}=i,{dim:a}=n,{input:l}=t,u=l.shape.length,h=l.shape.slice(),f=a;return a<0&&(ee(-(u+1)<=a,()=>`Axis must be in the interval [${-(u+1)}, ${u}]`),f=u+a+1),h.splice(f,0,1),Xn({inputs:{x:l},backend:s,attrs:{shape:h}})}let JD={kernelName:xs,backendName:"webgl",kernelFunc:pE},DT="return exp(x) - 1.0;",eF=$i({opSnippet:DT,packedOpSnippet:DT,cpuKernelImpl:gN}),tF={kernelName:rd,backendName:"webgl",kernelFunc:eF};class FT{constructor(t,n,s){this.variableNames=["real","imag"];let a=n[1];this.outputShape=n;let l=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,u=s?`${a}.0`:"1.0",h;if(t==="real")h="return real * expR - imag * expI;";else{if(t!=="imag")throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);h="return real * expI + imag * expR;"}this.userCode=`
      const float exponentMultiplier = ${l};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${h}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${a});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${a}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${u};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}function PT(i,t,n){let s=n.texData.get(i.dataId),a=me(i.shape),l=i.shape[i.shape.length-1],u=Xn({inputs:{x:i},backend:n,attrs:{shape:[a/l,l]}}),h=u.shape,f=new FT("real",h,t),d=new FT("imag",h,t),m=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:h},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:h}],g=n.runWebGLProgram(f,m,"float32"),x=n.runWebGLProgram(d,m,"float32"),R=mp({inputs:{real:g,imag:x},backend:n});n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x);let N=Xn({inputs:{x:R},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(R),N}let nF={kernelName:Jf,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{input:s}=t;return PT(s,!1,n)}};class rF{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}function iv(i){let{backend:t,attrs:n}=i,{shape:s,value:a}=n,{dtype:l}=n;if(l=l||hs(a),l==="string"){let u=St(l,me(s));return u.fill(a),t.makeTensorInfo(s,l,u)}{let u=new rF(s,a),h=[[a]];return t.runWebGLProgram(u,[],l,h)}}let iF={kernelName:gp,backendName:"webgl",kernelFunc:iv};class sF{constructor(t){this.variableNames=["Image"],this.outputShape=[];let n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}let aF={kernelName:vu,backendName:"webgl",kernelFunc:({inputs:i,backend:t})=>{let{image:n}=i,s=t,a=new sF(n.shape);return s.runWebGLProgram(a,[n],n.dtype)}},OT="return floor(x);",oF=$i({opSnippet:OT,packedOpSnippet:OT,cpuKernelImpl:yN}),lF={kernelName:fl,backendName:"webgl",kernelFunc:oF},uF=za({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),cF={kernelName:id,backendName:"webgl",kernelFunc:uF};class hF{constructor(t){this.variableNames=["A"];let n=yo(),[s,a]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${a}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}class dF{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let n=yo(),[s,a]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${a}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}let pF={kernelName:ph,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{pixels:a}=t,{numChannels:l}=s,u=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,h=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,[f,d]=u?[a.videoWidth,a.videoHeight]:[a.width,a.height],m=[d,f],g=[d,f,l];(h||u)&&(Vg==null&&(Vg=document.createElement("canvas").getContext("2d")),Vg.canvas.width=f,Vg.canvas.height=d,Vg.drawImage(a,0,0,f,d),a=Vg.canvas);let x=n.makeTensorInfo(m,"int32");n.texData.get(x.dataId).usage=Fl.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(x.dataId),a);let R=Ge().getBool("WEBGL_PACK")?new dF(g):new hF(g),N=n.runWebGLProgram(R,[x],"int32");return n.disposeData(x.dataId),N}},Vg,fF={kernelName:Wl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l,bias:u,preluActivationWeights:h}=t,{strides:f,pad:d,dataFormat:m,dilations:g,dimRoundingMode:x,activation:R,leakyreluAlpha:N}=s,F=nu(m),H=ta(a.shape,l.shape,f,g,d,x,!1,F),W,G=[];if(H.filterHeight!==1||H.filterWidth!==1||H.dilationHeight!==1||H.dilationWidth!==1||H.strideHeight!==1||H.strideWidth!==1||H.padInfo.type!=="SAME"&&H.padInfo.type!=="VALID")if(Ge().getBool("WEBGL_CONV_IM2COL")&&a.shape[0]===1)W=_T({x:a,filter:l,convInfo:H,backend:n,bias:u,activation:R,preluActivationWeights:h,leakyreluAlpha:N});else{let ge=u!=null,Ce=h!=null,Be=R==="leakyrelu",Ve=R?Px(R,!1):null,ze=new TT(H,ge,Ve,Ce,Be),Xe=[a,l];if(u&&Xe.push(u),h&&Xe.push(h),Be){let tt=n.makeTensorInfo([],"float32",ql(N,"float32"));Xe.push(tt),G.push(tt)}W=n.runWebGLProgram(ze,Xe,"float32")}else W=MT({x:a,filter:l,convInfo:H,backend:n,bias:u,activation:R,preluActivationWeights:h,leakyreluAlpha:N});let se=Xn({inputs:{x:W},backend:n,attrs:{shape:H.outShape}});return G.push(W),G.forEach(ge=>n.disposeIntermediateTensorInfo(ge)),se}},mF={kernelName:_o,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,filter:l,bias:u,preluActivationWeights:h}=t,{strides:f,pad:d,dilations:m,dimRoundingMode:g,activation:x,leakyreluAlpha:R}=s,N=[],F=m;F==null&&(F=[1,1]),ee(pa(f,F),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${f} and dilations '${F}'`);let H=ta(a.shape,l.shape,f,F,d,g,!0),W=Ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&H.strideWidth<=2&&H.outChannels/H.inChannels==1,G=x?Px(x,W):null,se=[a,l],ge=u!=null,Ce=h!=null,Be=x==="leakyrelu";if(ge&&se.push(u),Ce&&se.push(h),Be){let tt=n.makeTensorInfo([],"float32",ql(R,"float32"));se.push(tt),N.push(tt)}let Ve;Ve=W?new NT(H,ge,G,Ce,Be):new RT(H,ge,G,Ce,Be);let ze=[[H.padInfo.top,H.padInfo.left],[H.strideHeight,H.strideWidth],[H.dilationHeight,H.dilationWidth],[H.inHeight,H.inWidth]],Xe=n.runWebGLProgram(Ve,se,"float32",ze);return N.forEach(tt=>n.disposeIntermediateTensorInfo(tt)),Xe}};class gF{constructor(t,n,s){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=s;let a=ys(n.length),l=ys(s.length),u=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${a} strides = ${a}(${this.strides});
         void main() {
          ${l} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${u};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}let yF={kernelName:em,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{params:s,indices:a}=t,l=a.shape,u=l[l.length-1],h=me(s.shape),[f,d,m,g]=gm(s,a),x=Xn({inputs:{x:a},backend:n,attrs:{shape:[d,u]}}),R=Xn({inputs:{x:s},backend:n,attrs:{shape:[me(s.shape)/m,m]}});if(n.shouldExecuteOnCPU([s,a])||s.dtype==="string"){let W=n.readSync(a.dataId),G=n.bufferSync(s),se=vN(W,G,s.dtype,d,u,m,g,s.shape,h);return n.makeTensorInfo(f,s.dtype,se.values)}let N=new gF(u,g,[d,m]),F=n.runWebGLProgram(N,[R,x],R.dtype),H=Xn({inputs:{x:F},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(F),H}};class vF{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;let s=ys(this.rank),a=function(l,u){let h=["resRC.x","resRC.y","resRC.z","resRC.w"],f=[];for(let d=0;d<l.length;d++)d===2?f.push("index"):f.push(`${h[d]}`);return f.join()}(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${a}));
      }
    `}}function BT(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,indices:l}=t,{axis:u,batchDims:h}=s,f=Zn(u,a.shape)[0];if(Ge().get("DEBUG")){let G=n.readSync(l.dataId),se=a.shape[f];for(let ge=0;ge<G.length;++ge){let Ce=G[ge];ee(Ce<=se-1&&Ce>=0,()=>`GatherV2: the index value ${Ce} is not in [0, ${se-1}]`)}}let d=Lo(a,l,f,h),m=me(l.shape),g=[],x=Xn({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),R=Xn({inputs:{x:l},backend:n,attrs:{shape:[d.batchSize,m/d.batchSize]}});g.push(x),g.push(R);let N=[d.batchSize,d.outerSize,m/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,l])||a.dtype==="string"){let G=n.bufferSync(R),se=n.bufferSync(x),ge=bN(se,G,N);return g.forEach(Ce=>n.disposeIntermediateTensorInfo(Ce)),n.makeTensorInfo(d.outputShape,ge.dtype,ge.values)}let F=new vF(x.shape,N),H=n.runWebGLProgram(F,[x,R],x.dtype);g.push(H);let W=Xn({inputs:{x:H},backend:n,attrs:{shape:d.outputShape}});return g.forEach(G=>n.disposeIntermediateTensorInfo(G)),W}let bF={kernelName:vp,backendName:"webgl",kernelFunc:BT},xF=za({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:xN,dtype:"bool"}),wF={kernelName:bp,backendName:"webgl",kernelFunc:xF},AF=za({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:wN}),EF={kernelName:sd,backendName:"webgl",kernelFunc:AF},SF={kernelName:tm,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{input:s}=t;return PT(s,!0,n)}},TF=$i({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),MF={kernelName:bu,backendName:"webgl",kernelFunc:TF},_F=$i({opSnippet:"return float(isinf(x));",dtype:"bool"}),CF={kernelName:to,backendName:"webgl",kernelFunc:_F},IF=$i({opSnippet:"return float(isnan(x));",dtype:"bool"}),kF={kernelName:$s,backendName:"webgl",kernelFunc:IF},RF=za({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:AN,dtype:"bool"}),NF={kernelName:ml,backendName:"webgl",kernelFunc:RF},LF=za({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:EN,dtype:"bool"}),DF={kernelName:xu,backendName:"webgl",kernelFunc:LF},FF={kernelName:Da,backendName:"webgl",kernelFunc:function(i){let{backend:t,attrs:n}=i,{start:s,stop:a,num:l}=n,u=SN(s,a,l);return t.makeTensorInfo([u.length],"float32",u)}},PF=$i({opSnippet:`if (isnan(x)) return x;
  return x < 0.0 ? 0./0. : log(x);
`,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:TN}),OF={kernelName:Vs,backendName:"webgl",kernelFunc:PF},BF=$i({opSnippet:`if (isnan(x)) return x;
  return log(1.0 + x);
`}),UF={kernelName:ic,backendName:"webgl",kernelFunc:BF},zF=za({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),$F={kernelName:xp,backendName:"webgl",kernelFunc:zF},VF=$i({opSnippet:"return float(!(x >= 1.0));"}),HF={kernelName:wp,backendName:"webgl",kernelFunc:VF},GF=za({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),WF={kernelName:wu,backendName:"webgl",kernelFunc:GF};class jF{constructor(t,n,s,a,l){this.variableNames=["x"],this.outputShape=[];let u=n,h=t[3]-1,f;this.outputShape=t;let d=`float(${s}) + float(${a}) * sum`;f=l===.5?`inversesqrt(${d})`:l===1?`1.0/(${d})`:`exp(log(${d}) * float(-${l}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${u}; j <= ${u}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${h}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${f};
        setOutput(val);
      }
    `}}class XF{constructor(t,n,s,a,l){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let u=n,h=t[3]-1,f;this.outputShape=t;let d=`float(${s}) + float(${a}) * sum`;f=l===.5?`inversesqrt(${d})`:l===1?`1.0/(${d})`:`exp(log(${d}) * float(-${l}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${u};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${u}; j <= ${u}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${h}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${f};
        setOutput(result);
      }
    `}}let qF={kernelName:Ap,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{depthRadius:l,bias:u,alpha:h,beta:f}=s,d=Ge().getBool("WEBGL_PACK_NORMALIZATION")?new XF(a.shape,l,u,h,f):new jF(a.shape,l,u,h,f);return n.runWebGLProgram(d,[a],a.dtype)}};class KF{constructor(t,n,s,a,l){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=s,this.alpha=a,this.beta=l,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${a}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${a})
                * float(${l})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${l});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}let YF={kernelName:nm,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n,attrs:s}=i,{x:a,y:l,dy:u}=t,{depthRadius:h,bias:f,alpha:d,beta:m}=s,g=new KF(a.shape,h,f,d,m);return n.runWebGLProgram(g,[a,l,u],a.dtype)}};function UT(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{reductionIndices:l,keepDims:u}=s,h=a.shape.length,f=Zn(l,a.shape),d=f,m=Ws(d,h),g=m!=null,x=n.shouldExecuteOnCPU([a]),R=a;if(g){if(x){let G=n.texData.get(R.dataId).values,se=new Array(h);for(let Ce=0;Ce<se.length;Ce++)se[Ce]=a.shape[m[Ce]];let ge=lE(G,a.shape,a.dtype,m,se);R=n.makeTensorInfo(se,a.dtype),n.texData.get(R.dataId).values=ge}else R=Ox(a,m,n);d=Zs(d.length,h)}ma("max",d,h);let[N,F]=fa(R.shape,d),H,W=N;if(u&&(W=Ls(N,f)),x){let G=n.texData.get(R.dataId).values,se=MN(G,me(F),W,a.dtype);H=n.makeTensorInfo(W,a.dtype),n.texData.get(H.dataId).values=se}else H=function(G,se,ge,Ce){let Be=me(se),Ve=Xn({inputs:{x:G},attrs:{shape:[me(G.shape)/Be,Be]},backend:Ce}),ze=Qf(Ve,G.dtype,"max",Ce),Xe=Xn({inputs:{x:ze},attrs:{shape:ge},backend:Ce});return Ce.disposeIntermediateTensorInfo(Ve),Ce.disposeIntermediateTensorInfo(ze),Xe}(R,F,W,n);return g&&n.disposeIntermediateTensorInfo(R),H}let QF={kernelName:Ep,backendName:"webgl",kernelFunc:UT},ZF=za({opSnippet:`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,packedOpSnippet:`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,cpuKernelImpl:_N}),JF={kernelName:ld,backendName:"webgl",kernelFunc:ZF},eP={kernelName:Sp,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t;Jy(a,"maxPool");let{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s;ee(pa(u,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${u} and dilations '1'`);let d=Ko(a.shape,l,u,1,h,f);if(d.filterWidth===1&&d.filterHeight===1&&Ye(d.inShape,d.outShape))return hl({inputs:{x:a},backend:n});let m=new nv(d,"max",!1);return n.runWebGLProgram(m,[a],a.dtype)}},tP={kernelName:Tp,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{filterSize:l,strides:u,pad:h,dataFormat:f,dimRoundingMode:d}=s,m=Nu(a.shape,l,u,[1,1,1],h,d,f),g=new hE(m,"max",!1);return n.runWebGLProgram(g,[a],a.dtype)}};class nP{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let n=t.strideHeight,s=t.strideWidth,a=t.dilationHeight,l=t.effectiveFilterHeight,u=t.effectiveFilterWidth,h=l-1-t.padInfo.top,f=u-1-t.padInfo.left,d=l*u-1;this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
          wR += ${a}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${d} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${u} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class rP{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let n=t.strideDepth,s=t.strideHeight,a=t.strideWidth,l=t.dilationDepth,u=t.dilationHeight,h=t.dilationWidth,f=t.effectiveFilterDepth,d=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=f-1-t.padInfo.front,x=d-1-t.padInfo.top,R=m-1-t.padInfo.left,N=f*d*m-1;this.userCode=`
      const ivec3 pads = ivec3(${g}, ${x}, ${R});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
           wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${N} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${d} * ${m} +
                  wR * ${m} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let iP={kernelName:im,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l}=t,u=l,{filterSize:h,strides:f,pad:d,dimRoundingMode:m}=s,g=Nu(u.shape,h,f,[1,1,1],d,m),x=new hE(g,"max",!0),R=n.runWebGLProgram(x,[u],u.dtype),N=new rP(g),F=n.runWebGLProgram(N,[a,R],u.dtype);return n.disposeIntermediateTensorInfo(R),F}},sP={kernelName:rm,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{dy:a,input:l,output:u}=t,h=l;Jy([l,u],"maxPoolGrad");let{filterSize:f,strides:d,pad:m,dimRoundingMode:g}=s,x=Ko(h.shape,f,d,1,m,g),R=new nv(x,"max",!0),N=n.runWebGLProgram(R,[h],h.dtype),F=new nP(x),H=n.runWebGLProgram(F,[a,N],h.dtype);return n.disposeIntermediateTensorInfo(N),H}},aP={kernelName:sm,backendName:"webgl",kernelFunc:({inputs:i,attrs:t,backend:n})=>{let{x:s}=i,{filterSize:a,strides:l,pad:u,includeBatchInIndex:h}=t,f=n;ee(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);let d=[1,1];ee(pa(l,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${d}'`);let m=Ko(s.shape,a,l,d,u),[g,x]=function(R,N,F,H){let W=new nv(F,"max",!1),G=H.runWebGLProgram(W,[R],"float32");return W=new nv(F,"max",!0,!0,N),[G,H.runWebGLProgram(W,[R],"float32")]}(s,h,m,f);return[g,x]}},oP={kernelName:nh,backendName:"webgl",kernelFunc:({inputs:i,attrs:t,backend:n})=>{let{x:s}=i,{keepDims:a,axis:l}=t,u=n,h=s.shape.length,f=Zn(l,s.shape),d=f,m=Ws(d,h),g=m!=null,x=u.shouldExecuteOnCPU([s]),R=[],N=s;if(g){if(x){let se=u.texData.get(N.dataId).values,ge=new Array(h);for(let Be=0;Be<ge.length;Be++)ge[Be]=s.shape[m[Be]];let Ce=lE(se,s.shape,s.dtype,m,ge);N=u.makeTensorInfo(ge,s.dtype),u.texData.get(N.dataId).values=Ce}else N=Ox(s,m,u);R.push(N),d=Zs(d.length,h)}ma("sum",d,h);let[F,H]=fa(N.shape,d),W=F;a&&(W=Ls(F,f));let G=function(se,ge,Ce,Be){let Ve=me(ge),ze=Xn({inputs:{x:se},attrs:{shape:[me(se.shape)/Ve,Ve]},backend:Be}),Xe=Qf(ze,"float32","mean",Be),tt=Xn({inputs:{x:Xe},attrs:{shape:Ce},backend:Be});return Be.disposeIntermediateTensorInfo(ze),Be.disposeIntermediateTensorInfo(Xe),tt}(N,H,W,u);for(let se of R)u.disposeIntermediateTensorInfo(se);return G}},lP={kernelName:ud,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s,h=a.shape.length,f=Zn(l,a.shape),d=f,m=Ws(d,h),g=a;m!=null&&(g=bo({inputs:{x:a},backend:n,attrs:{perm:m}}),d=Zs(d.length,a.shape.length)),ma("min",d,h);let[x,R]=fa(g.shape,d),N=Xn({inputs:{x:g},backend:n,attrs:{shape:[-1,me(R)]}}),F=Qf(N,N.dtype,"min",n),H;return H=Xn(u?{inputs:{x:F},backend:n,attrs:{shape:Ls(x,f)}}:{inputs:{x:F},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(F),m!=null&&n.disposeIntermediateTensorInfo(g),H}},uP=za({opSnippet:`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,packedOpSnippet:`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,cpuKernelImpl:CN}),cP={kernelName:rh,backendName:"webgl",kernelFunc:uP};class hP{constructor(t,n,s){this.variableNames=["x"],this.outputShape=n.map((m,g)=>m[0]+t[g]+m[1]);let a=t.length,l=ys(a),u=n.map(m=>m[0]).join(","),h=n.map((m,g)=>m[0]+t[g]).join(","),f=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),d=s==="reflect"?0:1;this.userCode=a!==1?`
      ${l} start = ${l}(${u});
      ${l} end = ${l}(${h});

      void main() {
        ${l} outC = getOutputCoords();
        for (int i = 0; i < ${a}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${d};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${d};
          }
        }
        ${l} coords = outC - start;
        setOutput(getX(${f}));
      }
    `:`
        int start = ${u};
        int end = ${h};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${d};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${d};
          }
          setOutput(getX(outC - start));
        }
      `}}class dP{constructor(t,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((N,F)=>N[0]+t[F]+N[1]);let a=t.length,l=ys(a),u=n.map(N=>N[0]).join(","),h=n.map((N,F)=>N[0]+t[F]).join(","),f=vo("rc",a),d=vo("source",a),m=`${f[a-1]} < ${this.outputShape[a-1]}`,g=a===1?"source":`vec2(${d.slice(-2).join()})`,x=s==="reflect"?0:1,R="";if(a===1){let N=`
        ${l} source = rc;
        if (source < start) {
          source = start * 2 - source - ${x};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${x};
        }
        source -= start;
      `;R=`
        ${l} rc = outputLoc;
        ${N}
        result[0] = getChannel(getX(${d.join()}), ${g});
        ${f[a-1]} += 1;
        if(${m}) {
          ${N}
          result[1] = getChannel(getX(${d.join()}), ${g});
        }
      `}else{let N=`
        ${l} source = rc;
        ${l} lt = ${l}(lessThan(source, start));
        ${l} gte = ${l}(greaterThanEqual(source, end));
        ${l} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${x}) +
                gte * ((end - 1) * 2 - source + ${x});
        source -= start;
      `;R=`
        ${l} rc = outputLoc;
        ${N}
        result[0] = getChannel(getX(${d.join()}), ${g});
        ${f[a-1]} += 1;
        if(${m}) {
          ${N}
          result[1] = getChannel(getX(${d.join()}), ${g});
        }
        rc = outputLoc;
        ${f[a-2]} += 1;
        if(${f[a-2]} < ${this.outputShape[a-2]}) {
          ${N}
          result[2] = getChannel(getX(${d.join()}), ${g});
          ${f[a-1]} += 1;
          if(${m}) {
            ${N}
            result[3] = getChannel(getX(${d.join()}), ${g});
          }
        }
      `}this.userCode=`
      const ${l} start = ${l}(${u});
      const ${l} end = ${l}(${h});

      void main() {
        ${l} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${R}
        setOutput(result);
      }
    `}}let pP={kernelName:Mp,backendName:"webgl",kernelFunc:({inputs:i,backend:t,attrs:n})=>{let{x:s}=i,{paddings:a,mode:l}=n,u=Ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dP(s.shape,a,l):new hP(s.shape,a,l);return t.runWebGLProgram(u,[s],s.dtype)}},fP=za({opSnippet:`if (b == 0.0) return NAN;
  return mod(a, b);`,packedOpSnippet:`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`}),mP={kernelName:ih,backendName:"webgl",kernelFunc:fP};class gP{constructor(t,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}let zT=za({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),yP={kernelName:Oo,backendName:"webgl",kernelFunc:zT},$T="return a - b;",VT=za({opSnippet:$T,packedOpSnippet:$T,supportsComplex:!0,cpuKernelImpl:GN}),vP={kernelName:Mo,backendName:"webgl",kernelFunc:VT};function HT(i){let{inputs:t,backend:n,attrs:s}=i,{logits:a}=t,{dim:l}=s,u=Zn([l],a.shape),h=UT({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),f=Ls(h.shape,u),d=Xn({inputs:{x:h},backend:n,attrs:{shape:f}}),m=VT({inputs:{a,b:d},backend:n}),g=LT({inputs:{x:m},backend:n}),x=Bx({inputs:{x:g},backend:n,attrs:{axis:u,keepDims:!1}}),R=Xn({inputs:{x},backend:n,attrs:{shape:f}}),N=zT({inputs:{a:g,b:R},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(R),N}let bP={kernelName:Ip,backendName:"webgl",kernelFunc:HT},xP={kernelName:un,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{logits:a}=t,{numSamples:l,seed:u,normalized:h}=s,f=h?a:HT({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),d=f.shape[0],m=f.shape[1],g=new gP(d,m,l),x=[[u]],R=n.runWebGLProgram(g,[f],"int32",x);return h||n.disposeIntermediateTensorInfo(f),R}},wP={kernelName:cd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{x:s}=t;if(n.shouldExecuteOnCPU([s])){let l=n.texData.get(s.dataId),[u,h]=kN(l.values,s.shape,s.dtype);return n.makeTensorInfo(h,s.dtype,u)}let a;return a=Ge().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Yf(s.shape,`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`):new ed(s.shape,`if (isnan(x)) return x;
  return -x;
`),n.runWebGLProgram(a,[s],s.dtype)}},AP=Xd,EP={kernelName:Au,backendName:"webgl",kernelFunc:function(i){Pa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:s}=i,{boxes:a,scores:l}=t,{maxOutputSize:u,iouThreshold:h,scoreThreshold:f}=s,d=n.readSync(a.dataId),m=n.readSync(l.dataId),{selectedIndices:g}=AP(d,m,u,h,f);return n.makeTensorInfo([g.length],"int32",new Int32Array(g))}},SP=qd,TP={kernelName:sc,backendName:"webgl",kernelFunc:function(i){Pa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:s}=i,{boxes:a,scores:l}=t,{maxOutputSize:u,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:d}=s,m=n.readSync(a.dataId),g=n.readSync(l.dataId),{selectedIndices:x,validOutputs:R}=SP(m,g,u,h,f,d);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([],"int32",new Int32Array([R]))]}},MP=Kd,_P={kernelName:Cp,backendName:"webgl",kernelFunc:function(i){Pa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:s}=i,{boxes:a,scores:l}=t,{maxOutputSize:u,iouThreshold:h,scoreThreshold:f,softNmsSigma:d}=s,m=n.readSync(a.dataId),g=n.readSync(l.dataId),x=u,R=h,N=f,F=d,{selectedIndices:H,selectedScores:W}=MP(m,g,x,R,N,F);return[n.makeTensorInfo([H.length],"int32",new Int32Array(H)),n.makeTensorInfo([W.length],"float32",new Float32Array(W))]}};class CP{constructor(t,n,s,a){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${a}), float(${s}),
                      float(index == coords.y)));
      }
    `}}let IP={kernelName:ac,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n,attrs:s}=i,{indices:a}=t,{depth:l,onValue:u,offValue:h}=s,f=me(a.shape),d=new CP(f,l,u,h),m=Xn({inputs:{x:a},backend:n,attrs:{shape:[f]}}),g=n.runWebGLProgram(d,[m],a.dtype);n.disposeIntermediateTensorInfo(m);let x=Xn({inputs:{x:g},backend:n,attrs:{shape:[...a.shape,l]}});return n.disposeIntermediateTensorInfo(g),x}};function Vx(i){let{inputs:t,backend:n}=i,{x:s}=t;if(s.dtype==="complex64"){let a=rv({inputs:{input:s},backend:n}),l=Vx({inputs:{x:a},backend:n}),u=$x({inputs:{input:s},backend:n}),h=Vx({inputs:{x:u},backend:n}),f=mp({inputs:{real:l,imag:h},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),f}return iv({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}let kP={kernelName:yd,backendName:"webgl",kernelFunc:Vx},RP={kernelName:Ga,backendName:"webgl",kernelFunc:function i(t){let{inputs:n,backend:s}=t,{x:a}=n;if(a.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(a.dtype==="complex64"){let l=rv({inputs:{input:a},backend:s}),u=i({inputs:{x:l},backend:s}),h=$x({inputs:{input:a},backend:s}),f=Vx({inputs:{x:h},backend:s}),d=mp({inputs:{real:u,imag:f},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(f),d}return iv({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:s})}},NP={kernelName:sh,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{axis:a}=s;if(t.length===1)return pE({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let l=t[0].shape,u=t[0].dtype;t.forEach(d=>{ie(l,d.shape,"All tensors passed to stack must have matching shapes"),ee(u===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});let h=[],f=ST({inputs:t.map(d=>{let m=pE({inputs:{input:d},backend:n,attrs:{dim:a}});return h.push(m),m}),backend:n,attrs:{axis:a}});return h.forEach(d=>n.disposeIntermediateTensorInfo(d)),f}};class LP{constructor(t,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((d,m)=>d[0]+t[m]+d[1]);let a=t.length,l=ys(a),u=n.map(d=>d[0]).join(","),h=n.map((d,m)=>d[0]+t[m]).join(","),f=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=a!==1?`
      ${l} start = ${l}(${u});
      ${l} end = ${l}(${h});

      void main() {
        ${l} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${l} coords = outC - start;
          setOutput(getX(${f}));
        }
      }
    `:`
        int start = ${u};
        int end = ${h};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}class DP{constructor(t,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((F,H)=>F[0]+t[H]+F[1]);let a=t.length,l=ys(a),u=n.map(F=>F[0]).join(","),h=n.map((F,H)=>F[0]+t[H]).join(","),f=vo("rc",a),d=vo("source",a),m=`${f[a-1]} < ${this.outputShape[a-1]}`,g=a===1?"source":`vec2(${d.slice(-2).join()})`,x=[`${l} rc = outputLoc;`,`${f[a-1]} += 1;
       if(${m}) {
      `,a===1?"":`}
       rc = outputLoc;
       ${f[a-2]} += 1;
       if(${f[a-2]} < ${this.outputShape[a-2]}) {`,a===1?"":`  ${f[a-1]} += 1;
         if(${m}) {`],R=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",N="";for(let F=0,H=a===1?2:4;F<H;F++)N+=`
        ${x[F]}
        if (${R}) {
          result[${F}] = float(value);
        } else {
          ${l} source = rc - start;
          result[${F}] = getChannel(getX(${d.join()}), ${g});
        }
      `;N+=a===1?"} ":"}}",this.userCode=`
      const ${l} start = ${l}(${u});
      const ${l} end = ${l}(${h});

      void main() {
        ${l} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${N}
        setOutput(result);
      }
    `}}let GT=i=>{let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{paddings:l,constantValue:u}=s;if(me(a.shape)===0)return iv({backend:n,attrs:{shape:l.map((d,m)=>d[0]+a.shape[m]+d[1]),value:u,dtype:a.dtype}});let h=Ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DP(a.shape,l,u):new LP(a.shape,l,u),f=[[u]];return n.runWebGLProgram(h,[a],a.dtype,f)},FP={kernelName:zl,backendName:"webgl",kernelFunc:GT},PP=za({opSnippet:`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,packedOpSnippet:`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`}),OP={kernelName:Fn,backendName:"webgl",kernelFunc:PP},BP={kernelName:gl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{axis:l,keepDims:u}=s,h=a.shape.length,f=[],d=Zn(l,a.shape),m=d,g=Ws(m,h),x,R=a;if(g!=null&&(R=bo({inputs:{x:a},backend:n,attrs:{perm:g}}),m=Zs(m.length,h),f.push(R)),ma("prod",m,h),n.shouldExecuteOnCPU([R])){let N=n.texData.get(R.dataId).values,{outVals:F,outShape:H,outDtype:W}=NN(R.shape,R.dtype,N,m);x=n.makeTensorInfo(H,W,F)}else{let[N,F]=fa(R.shape,m),H=me(F),W=Xn({inputs:{x:R},backend:n,attrs:{shape:[-1,H]}}),G=Qf(W,gh(a.dtype),"prod",n);x=Xn({inputs:{x:G},backend:n,attrs:{shape:N}}),f.push(W),f.push(G)}if(u){f.push(x);let N=Ls(x.shape,d);x=Xn({inputs:{x},backend:n,attrs:{shape:N}})}return f.forEach(N=>n.disposeIntermediateTensorInfo(N)),x}},WT=i=>{let{backend:t,attrs:n}=i,{start:s,stop:a,step:l,dtype:u}=n,h=LN(s,a,l,u);return t.makeTensorInfo([h.length],u,h)},UP={kernelName:am,backendName:"webgl",kernelFunc:WT},zP=$i({opSnippet:"return 1.0 / x;"}),$P={kernelName:oc,backendName:"webgl",kernelFunc:zP},VP=$i({opSnippet:`if (isnan(x)) return x;
  return (x < 0.0) ? 0.0 : x;
`,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),HP={kernelName:Si,backendName:"webgl",kernelFunc:VP},GP=$i({opSnippet:`if (isnan(x)) return x;
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),WP={kernelName:lc,backendName:"webgl",kernelFunc:GP};class jP{constructor(t,n,s,a,l){this.variableNames=["A"],this.outputShape=[];let[u,h,f,d]=t;this.outputShape=[u,n,s,d];let m=[a&&n>1?h-1:h,a&&s>1?f-1:f],g=[a&&n>1?n-1:n,a&&s>1?s-1:s],x;x=l?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${m[0]/g[0]},
          ${m[1]/g[1]});
      const vec2 inputShapeRC = vec2(${h}.0, ${f}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${x};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}class XP{constructor(t,n,s,a,l){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[u,h,f,d]=t;this.outputShape=[u,n,s,d];let m=[a&&n>1?h-1:h,a&&s>1?f-1:f],g=[a&&n>1?n-1:n,a&&s>1?s-1:s],x;x=l?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${m[0]/g[0]},
          ${m[1]/g[1]},
          ${m[1]/g[1]});
      const vec3 inputShapeRC = vec3(${h}.0, ${f}.0,
                                     ${f}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${x};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${d-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}let qP={kernelName:Hs,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a}=t,{alignCorners:l,halfPixelCenters:u,size:h}=s,[f,d]=h,m=Ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new XP(a.shape,f,d,l,u):new jP(a.shape,f,d,l,u);return n.runWebGLProgram(m,[a],"float32")}};class KP{constructor(t,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;let[,a,l]=n,[,u,h]=t,f=[s&&u>1?a-1:a,s&&h>1?l-1:l],d=[s&&u>1?u-1:u,s&&h>1?h-1:h],m=f[0]/d[0],g=f[1]/d[1],x=1/m,R=1/g,N=2*Math.ceil(x)+2,F=2*Math.ceil(R)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${m});
        const float widthScale = float(${g});

        const float invHeightScale = float(${x});
        const float invWidthScale = float(${R});

        const int winHeight = int(${N});
        const int winWidth = int(${F});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${u}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${h}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${a-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${l-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}let YP={kernelName:je,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a,dy:l}=t,{alignCorners:u}=s,h=new KP(l.shape,a.shape,u);return n.runWebGLProgram(h,[l],l.dtype)}};class QP{constructor(t,n,s,a,l){this.variableNames=["A"],this.outputShape=[];let[u,h,f,d]=t;this.outputShape=[u,n,s,d];let m=[a&&n>1?h-1:h,a&&s>1?f-1:f],g=[a&&n>1?n-1:n,a&&s>1?s-1:s],x=a?"0.5":"0.0",R;R=l?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${m[0]/g[0]},
          ${m[1]/g[1]});
      const vec2 inputShapeRC = vec2(${h}.0, ${f}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${R};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${x})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}class ZP{constructor(t,n,s,a,l){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[u,h,f,d]=t;this.outputShape=[u,n,s,d];let m=[a&&n>1?h-1:h,a&&s>1?f-1:f],g=[a&&n>1?n-1:n,a&&s>1?s-1:s],x=a?"0.5":"0.0",R;R=l?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${m[0]/g[0]},
          ${m[1]/g[1]},
          ${m[1]/g[1]});
      const vec3 inputShapeRC = vec3(${h}.0, ${f}.0,
                                     ${f}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${R};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${x})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${d-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}let JP={kernelName:hd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a}=t,{alignCorners:l,halfPixelCenters:u,size:h}=s,[f,d]=h,m=Ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ZP(a.shape,f,d,l,u):new QP(a.shape,f,d,l,u);return n.runWebGLProgram(m,[a],a.dtype)}};class eO{constructor(t,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;let[,a,l]=n,[,u,h]=t,f=[s&&u>1?a-1:a,s&&h>1?l-1:l],d=[s&&u>1?u-1:u,s&&h>1?h-1:h],m=f[0]/d[0],g=f[1]/d[1],x=1/m,R=1/g,N=2*Math.ceil(x)+2,F=2*Math.ceil(R)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${m});
        const float widthScale = float(${g});

        const float invHeightScale = float(${x});
        const float invWidthScale = float(${R});

        const int winHeight = int(${N});
        const int winWidth = int(${F});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${u}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${h}) {
              continue;
            }

            float sourceFracRow =
              float(${f[0]}) *
                (float(dyR) / float(${d[0]}));

            float sourceFracCol =
                float(${f[1]}) *
                  (float(dyC) / float(${d[1]}));

            int sourceNearestRow = int(min(
                float(int(${a}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${l}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}let tO={kernelName:ah,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{images:a,dy:l}=t,{alignCorners:u}=s,h=new eO(l.shape,a.shape,u);return n.runWebGLProgram(h,[l],l.dtype)}};class nO{constructor(t,n){this.variableNames=["x"];let s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1)return void(this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `);let a=t.map((u,h)=>(f=>n.indexOf(f)!==-1&&t[f]!==1?`${t[f]} - coords[${f}] - 1`:`coords[${f}]`)(h)).join(","),l=ys(s);this.userCode=`
      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}class rO{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;let a=vo("rc",s),l=`${a[s-1]} + 1 < ${this.outputShape[s-1]}`,u=`${a[s-2]} + 1 < ${this.outputShape[s-2]}`,h=ys(s);function f(d){let m=t.map((g,x)=>function(R,N){return n.indexOf(R)!==-1&&t[R]!==1?`${t[R]} - ${N[R]} - 1`:`${N[R]}`}(x,d));return`getChannel(getX(${m.join(",")}), vec2(${m.slice(-2).join(",")}))`}this.userCode=s===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${l}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          ${h} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${function(d){return f(d)}(a.slice())};
          if(${l}){
            result.g = ${function(d){return d[s-1]="("+d[s-1]+" + 1)",f(d)}(a.slice())};
          }
          if(${u}) {
            result.b = ${function(d){return d[s-2]="("+d[s-2]+" + 1)",f(d)}(a.slice())};
            if(${l}) {
              result.a = ${function(d){return d[s-1]="("+d[s-1]+" + 1)",d[s-2]="("+d[s-2]+" + 1)",f(d)}(a.slice())};
            }
          }
          setOutput(result);
        }
    `}}let iO={kernelName:dd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{dims:l}=s,u=a.shape.length,h=Zn(l,a.shape);if(u===0)return hl({inputs:{x:a},backend:n});let f=Ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rO(a.shape,h):new nO(a.shape,h);return n.runWebGLProgram(f,[a],a.dtype)}};class sO{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let s=t[1],a=t[2];this.outputShape=t;let l="";l=typeof n=="number"?`float outputValue = ${n.toFixed(2)};`:`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${l}
          if(coordX >= 0 && coordX < ${a} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}let aO={kernelName:um,backendName:"webgl",kernelFunc:({inputs:i,attrs:t,backend:n})=>{let{image:s}=i,{radians:a,fillValue:l,center:u}=t,h=n,f=new sO(s.shape,l),[d,m]=Zd(u,s.shape[1],s.shape[2]),g=[[d,m,Math.sin(a),Math.cos(a)]];return h.runWebGLProgram(f,[s],s.dtype,g)}},oO=$i({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),lO={kernelName:va,backendName:"webgl",kernelFunc:oO},uO=$i({opSnippet:"return inversesqrt(x);",cpuKernelImpl:DN}),cO={kernelName:no,backendName:"webgl",kernelFunc:uO};class jT{constructor(t,n,s,a,l,u,h=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=u;let f=ys(l.length),d=ys(u.length),m="";s===1?m="i":s===2&&(m="i, j");let g=`getIndices(${m})`,x="";a===1?x="i":a===2&&(x="i, coords[1]");let R=`getUpdates(${x})`,N=n>1?"strides[j]":"strides";this.userCode=`
        ${f} strides = ${f}(${l});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${g});
              flattenedIndex += index * ${N};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${R};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}let hO={kernelName:Vl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{indices:a,updates:l}=t,{shape:u}=s,{sliceRank:h,numUpdates:f,sliceSize:d,strides:m,outputSize:g}=_d(0,a,u),x=[g/d,d];if(g===0)return n.makeTensorInfo(u,a.dtype);let R=Xn({inputs:{x:a},backend:n,attrs:{shape:[f,h]}}),N=Xn({inputs:{x:l},backend:n,attrs:{shape:[f,d]}}),F=n.makeTensorInfo([],"float32",new Float32Array([0])),H=new jT(f,h,R.shape.length,N.shape.length,m,x),W=n.runWebGLProgram(H,[N,R,F],N.dtype),G=Xn({inputs:{x:W},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(W),n.disposeIntermediateTensorInfo(F),G}};class dO{constructor(t,n,s){let a,l;if(this.variableNames=["c","a","b"],this.outputShape=n,s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)l="resRC",a="resRC";else{let h=["resRC.x","resRC.y","resRC.z","resRC.w"],f=[],d=[];for(let m=0;m<n.length;m++)d.push(`${h[m]}`),m<t&&f.push(`${h[m]}`);a=f.join(),l=d.join()}let u=ys(s);this.userCode=`
      void main() {
        ${u} resRC = getOutputCoords();
        float cVal = getC(${a});
        if (cVal >= 1.0) {
          setOutput(getA(${l}));
        } else {
          setOutput(getB(${l}));
        }
      }
    `}}let pO={kernelName:oh,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{condition:s,t:a,e:l}=t,u=new dO(s.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(u,[s,a,l],_a(a.dtype,l.dtype))}},fO=$i({opSnippet:`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Oc};
  float scale = ${Jd};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`}),mO={kernelName:yl,backendName:"webgl",kernelFunc:fO},gO=$i({opSnippet:`if (isnan(x)) return x;
  return 1.0 / (1.0 + exp(-1.0 * x));
`,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:FN}),yO={kernelName:$o,backendName:"webgl",kernelFunc:gO},vO=$i({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),bO={kernelName:To,backendName:"webgl",kernelFunc:vO},xO=$i({opSnippet:`if (isnan(x)) return x;
  return sin(x);
`}),wO={kernelName:vl,backendName:"webgl",kernelFunc:xO},AO=$i({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),EO={kernelName:So,backendName:"webgl",kernelFunc:AO},SO=$i({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),TO={kernelName:Gl,backendName:"webgl",kernelFunc:SO},MO={kernelName:bl,backendName:"webgl",kernelFunc:i=>{let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{blockShape:l,paddings:u}=s;ee(a.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let h=l.reduce((W,G)=>W*G),f=[[0,0]];f.push(...u);for(let W=1+l.length;W<a.shape.length;++W)f.push([0,0]);let d=[],m=GT({inputs:{x:a},backend:n,attrs:{paddings:f,constantValue:0}}),g=Cf(m.shape,l,h,!1),x=Gu(g.length,l.length,!1),R=If(m.shape,l,h,!1),N=Xn({inputs:{x:m},backend:n,attrs:{shape:g}}),F=bo({inputs:{x:N},backend:n,attrs:{perm:x}}),H=Xn({inputs:{x:F},backend:n,attrs:{shape:R}});return d.push(m),d.push(N),d.push(F),d.forEach(W=>n.disposeIntermediateTensorInfo(W)),H}},_O={kernelName:kp,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{indices:s,values:a,denseShape:l,defaultValue:u}=t;if(l.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${l.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${a.shape}`);if(u.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${u.shape}`);let h=n.readSync(s.dataId),f=n.readSync(a.dataId),d=n.readSync(l.dataId),m=n.readSync(u.dataId)[0],[g,x,R,N,F]=ON(h,s.shape,s.dtype,f,a.dtype,d,m);return[n.makeTensorInfo(x,s.dtype,g),n.makeTensorInfo([x[0]],a.dtype,R),n.makeTensorInfo([N.length],"bool",new Uint8Array(N.map(H=>Number(H)))),n.makeTensorInfo([F.length],s.dtype,new Int32Array(F))]}},CO={kernelName:uh,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{inputIndices:s,inputShape:a,newShape:l}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${a.shape}`);if(l.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${l.shape}`);let u=Array.from(n.readSync(a.dataId)),h=n.readSync(s.dataId),f=Array.from(n.readSync(l.dataId)),[d,m,g]=BN(h,s.shape,s.dtype,u,f);return[n.makeTensorInfo(m,s.dtype,d),n.makeTensorInfo([g.length],l.dtype,new Int32Array(g))]}},IO={kernelName:pd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{data:s,indices:a,segmentIds:l}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${a.shape}`);if(l.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${l.shape}`);let u=n.readSync(s.dataId),h=n.readSync(a.dataId),f=n.readSync(l.dataId),[d,m]=tT(u,s.shape,s.dtype,h,f,!0);return n.makeTensorInfo(m,s.dtype,d)}},kO={kernelName:xl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n}=i,{data:s,indices:a,segmentIds:l}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${a.shape}`);if(l.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${l.shape}`);let u=n.readSync(s.dataId),h=n.readSync(a.dataId),f=n.readSync(l.dataId),[d,m]=tT(u,s.shape,s.dtype,h,f);return n.makeTensorInfo(m,s.dtype,d)}},RO={kernelName:Vo,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{sparseIndices:a,sparseValues:l,defaultValue:u}=t,{outputShape:h}=s,{sliceRank:f,numUpdates:d,strides:m,outputSize:g}=_d(0,a,h),x=new jT(d,f,a.shape.length,l.shape.length,m,[g,1],!1),R=n.runWebGLProgram(x,[l,a,u],l.dtype),N=Xn({inputs:{x:R},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(R),N}},NO={kernelName:lh,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{numOrSizeSplits:l,axis:u}=s,h=Zn(u,a.shape)[0],f=Rf(a,l,h),d=a.shape.length,m=new Array(d).fill(0),g=a.shape.slice();return f.map(x=>{let R=[...g];R[h]=x;let N=zg({inputs:{x:a},backend:n,attrs:{begin:m,size:R}});return m[h]+=x,N})}},XT="return sqrt(x);",LO=$i({opSnippet:XT,packedOpSnippet:XT,cpuKernelImpl:UN}),DO={kernelName:Eu,backendName:"webgl",kernelFunc:LO},FO=$i({opSnippet:"return x * x;"}),PO={kernelName:ch,backendName:"webgl",kernelFunc:FO},qT="return (a - b) * (a - b);",OO=za({opSnippet:qT,packedOpSnippet:qT}),BO={kernelName:cc,backendName:"webgl",kernelFunc:OO},UO={kernelName:Go,backendName:"webgl",kernelFunc:function({inputs:i,attrs:t,backend:n}){let{x:s}=i,a=`if (isnan(x)) return x;
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,l=new ed(s.shape,a);return n.runWebGLProgram(l,[s],s.dtype)}};class zO{constructor(t,n,s){this.variableNames=["x"],this.outputShape=s;let a=s.length,l=ys(s.length),u=ys(s.length),h="";if(a===1)h="coords * strides + begin";else{let f=0;h=s.map((d,m)=>(f++,s.length===1?`coords * strides[${m}] + begin[${m}]`:`coords[${f-1}] * strides[${m}] + begin[${m}]`)).join(",")}this.userCode=`
      ${l} begin = ${l}(${t});
      ${l} strides = ${l}(${n});

      void main() {
        ${u} coords = getOutputCoords();
        setOutput(getX(${h}));
      }
    `}}let $O={kernelName:wl,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{begin:l,end:u,strides:h,beginMask:f,endMask:d,ellipsisMask:m,newAxisMask:g,shrinkAxisMask:x}=s,{finalShapeSparse:R,finalShape:N,isIdentity:F,sliceDim0:H,isSimpleSlice:W,begin:G,end:se,strides:ge}=d0(a.shape,l,u,h,f,d,m,g,x),Ce;if(F)Ce=Xn({inputs:{x:a},backend:n,attrs:{shape:N}});else if(H||W){ee(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let Ve=u0(G,se,ge),ze=zg({inputs:{x:a},backend:n,attrs:{begin:G,size:Ve}});Ce=Xn({inputs:{x:ze},backend:n,attrs:{shape:N}}),n.disposeIntermediateTensorInfo(ze)}else if(n.shouldExecuteOnCPU([a])){let Ve=n.readSync(a.dataId),ze=ci(a.shape,a.dtype,Ve),Xe=zN(R,ze,ge,G);Ce=n.makeTensorInfo(N,a.dtype,Xe.values)}else{let Ve=new zO(G,ge,R);Ce=n.runWebGLProgram(Ve,[a],a.dtype)}let Be=Xn({inputs:{x:Ce},backend:n,attrs:{shape:N}});return n.disposeIntermediateTensorInfo(Ce),Be}},VO={kernelName:fd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{separator:a,nGramWidths:l,leftPad:u,rightPad:h,padWidth:f,preserveShortSequences:d}=s,{data:m,dataSplits:g}=t,x=n.readSync(m.dataId),R=n.readSync(g.dataId),[N,F]=$N(x,R,a,l,u,h,f,d);return[n.makeTensorInfo([N.length],"string",N),n.makeTensorInfo(g.shape,"int32",F)]}},HO={kernelName:hh,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{skipEmpty:a}=s,{input:l,delimiter:u}=t;if(l.dtype!=="string")throw new Error("Input must be of datatype string");if(l.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${l.shape}`);if(u.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${u.shape}`);let h=n.readSync(l.dataId),f=n.readSync(u.dataId)[0],[d,m,g]=VN(h,f,a),x=m.length;return[n.makeTensorInfo([x,2],"int32",d),n.makeTensorInfo([x],"string",m),n.makeTensorInfo([2],"int32",new Int32Array(g))]}},GO={kernelName:md,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{numBuckets:a}=s,{input:l}=t;if(l.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let u=n.readSync(l.dataId),h=HN(u,a);return n.makeTensorInfo(l.shape,"int32",h)}},WO=$i({opSnippet:"return tan(x);"}),jO={kernelName:Wn,backendName:"webgl",kernelFunc:WO},XO=$i({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),qO={kernelName:Al,backendName:"webgl",kernelFunc:XO};class KO{constructor(t,n){this.variableNames=["A"];let s=new Array(t.length);for(let u=0;u<s.length;u++)s[u]=t[u]*n[u];this.outputShape=s,this.rank=s.length;let a=ys(this.rank),l=function(u){let h=u.length;if(h>5)throw Error(`Tile for rank ${h} is not yet supported`);if(h===1)return`imod(resRC, ${u[0]})`;let f=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],d=[];for(let m=0;m<u.length;m++)d.push(`imod(${f[m]}, ${u[m]})`);return d.join()}(t);this.userCode=`
      void main() {
        ${a} resRC = getOutputCoords();
        setOutput(getA(${l}));
      }
    `}}function KT(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{reps:l}=s;if(a.dtype==="string"||a.shape.length>5){let h=n.readSync(a.dataId),f=a.dtype==="string"?h.map(g=>hc(g)):h,d=ci(a.shape,a.dtype,f),m=WN(d,l);return n.makeTensorInfo(m.shape,m.dtype,m.values)}let u=new KO(a.shape,l);return n.runWebGLProgram(u,[a],a.dtype)}let YO={kernelName:Fa,backendName:"webgl",kernelFunc:KT};class QO{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class ZO{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}function Zf(i,t){t!==null&&i.disposeIntermediateTensorInfo(t)}function YT(i){let t=1;for(;t<i;)t*=2;return t}let JO={kernelName:om,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a}=t,{k:l,sorted:u}=s,h=Ge().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),f=Ge().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),d=a.shape,m=d[d.length-1];if(n.shouldExecuteOnCPU([a])||m<h||l>f){let Xe=n.readSync(a.dataId),[tt,ot]=jN(Xe,d,a.dtype,l,u);return[n.makeTensorInfo(tt.shape,tt.dtype,tt.values),n.makeTensorInfo(ot.shape,ot.dtype,ot.values)]}if(l===0)return d[d.length-1]=0,[n.makeTensorInfo(d,a.dtype,[]),n.makeTensorInfo(d,"int32",[])];if(m===1)return[a,iv({attrs:{shape:d,dtype:"int32",value:0},backend:n})];let g=n.texData.get(a.dataId),x=g!==null&&g.isPacked,R=x?n.unpackTensor(a):a,N=me(d)/m,F=Xn({inputs:{x:R},attrs:{shape:[N,m]},backend:n});x&&Zf(n,R);let H=YT(l),W=YT(m),G=null,se=()=>G===null?[F,F]:[F,G],ge=(Xe,tt,ot)=>{let ut=se(),ft=new QO(ot),kt=[[m],[G===null?1:0],[Number.NEGATIVE_INFINITY],[Xe],[tt]],Ut=G;G=n.runWebGLProgram(ft,ut,"int32",kt),Zf(n,Ut)};for(let Xe=1;Xe<H;Xe*=2){let tt=2*Xe;for(let ot=Xe;ot>=1;ot/=2)ge(tt,ot,[N,W])}for(let Xe=W;Xe>H;Xe/=2){let tt=se(),ot=new ZO([N,Xe/2]),ut=[[m],[G===null?1:0],[H]],ft=G;G=n.runWebGLProgram(ot,tt,"int32",ut),Zf(n,ft);let kt=H/2,Ut=2*kt;for(let It=kt;It>=1;It/=2)ge(Ut,It,G.shape)}let Ce=G;G=zg({inputs:{x:G},backend:n,attrs:{begin:0,size:[N,l]}}),Zf(n,Ce);let Be=BT({inputs:{x:F,indices:G},backend:n,attrs:{axis:1,batchDims:1}});Zf(n,F);let Ve=d.slice(0,-1);Ve.push(l),Ce=G,G=Xn({inputs:{x:G},attrs:{shape:Ve},backend:n}),Zf(n,Ce);let ze=Be;return Be=Xn({inputs:{x:Be},attrs:{shape:Ve},backend:n}),Zf(n,ze),[Be,G]}};class e4{constructor(t,n,s,a,l,u){this.variableNames=["Image","Transforms"],this.outputShape=u;let h=s==="nearest"?1:2,f;switch(a){case"constant":f=1;break;case"reflect":f=2;break;case"wrap":f=3;break;case"nearest":f=4;break;default:f=1}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${f} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${f} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${f} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${l});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${l});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${h} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}let t4={kernelName:lm,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{image:a,transforms:l}=t,{interpolation:u,fillMode:h,fillValue:f,outputShape:d}=s,[m,g,x,R]=a.shape,[N,F]=d??[g,x],H=new e4(g,x,u,h,f,[m,N,F,R]);return n.runWebGLProgram(H,[a,l],"float32")}},n4={kernelName:dh,backendName:"webgl",kernelFunc:function(i){let{inputs:t,attrs:n,backend:s}=i,{axis:a}=n,{x:l}=t;Jy(l,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let u=s.readSync(l.dataId),{outputValues:h,outputShape:f,indices:d}=XN(u,a,l.shape,l.dtype);return[s.makeTensorInfo(f,l.dtype,h),s.makeTensorInfo([d.length],"int32",d)]}},r4={kernelName:Ma,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{value:a}=t,{axis:l}=s;l<0&&(l+=a.shape.length);let u=a,h=u.shape.length,f=a.shape[l],d=new Array(h-1),m=0;for(let F=0;F<h;F++)F!==l&&(d[m++]=u.shape[F]);let g=[],x=new Array(h).fill(0),R=u.shape.slice();R[l]=1;let N=new Array(f);for(let F=0;F<N.length;F++){x[l]=F;let H=zg({inputs:{x:u},backend:n,attrs:{begin:x,size:R}}),W=Xn({inputs:{x:H},backend:n,attrs:{shape:d}});N[F]=W,g.push(H)}return g.forEach(F=>n.disposeIntermediateTensorInfo(F)),N}};class i4{constructor(t,n){this.variableNames=["x","segmentIds"];let s=t.windowSize,a=t.batchSize,l=t.inSize,u=t.numSegments,h=u*Math.ceil(l/s);this.outputShape=[a,h];let f=4*Math.floor(s/4),d=s%4,m=`
        sumValue += dot(values, segFilter);
    `,g="";l%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${l}) {
          return initializationValue;
        }
      `);let x="";l%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${l}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${u})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${u})));

        float sumValue = 0.0;

        for (int i = 0; i < ${f}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${f};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(sumValue);
      }
    `}}let s4=[cL,hL,pL,mL,yL,xL,wL,AL,TL,ML,CL,kL,NL,DL,PL,OL,BL,$L,VL,HL,jL,YL,QL,ZL,tD,rD,aD,eL,lD,dD,mD,xD,wD,AD,ED,SD,MD,CD,kD,RD,ND,DD,FD,BD,UD,$D,HD,GD,jD,XD,KD,QD,ZD,JD,tF,nF,iF,aF,lF,cF,pF,fF,mF,yF,bF,wF,EF,JN,SF,hD,MF,CF,kF,tL,NF,DF,FF,OF,UF,$F,HF,WF,qF,YF,QF,JF,eP,tP,iP,sP,aP,oP,lP,cP,pP,mP,xP,rL,wP,EP,TP,_P,JL,IP,RP,NP,FP,OP,nL,BP,UP,eD,yP,$P,HP,WP,iL,qP,YP,JP,tO,iO,aO,lO,cO,hO,pO,mO,yO,bO,wO,EO,KL,bP,TO,MO,_O,CO,IO,kO,RO,NO,DO,PO,BO,UO,$O,VO,HO,GO,vP,lL,jO,qO,YO,JO,t4,uL,n4,r4,{kernelName:gd,backendName:"webgl",kernelFunc:function(i){let{inputs:t,backend:n,attrs:s}=i,{x:a,segmentIds:l}=t,{numSegments:u}=s,h=a.shape.length,f=[],d=0,m=Ws([d],h),g=a;m!=null&&(g=bo({inputs:{x:a},backend:n,attrs:{perm:m}}),f.push(g),d=Zs(1,h)[0]);let x=ny(g.shape,d,u),R=me([g.shape[d]]),N=Xn({inputs:{x:g},backend:n,attrs:{shape:[-1,R]}});f.push(N);let F=gh(a.dtype),H=(se,ge,Ce,Be,Ve)=>{let ze=se.shape[0],Xe=se.shape[1],tt=ng(Xe,Ve),ot=new i4({windowSize:tt,inSize:Xe,batchSize:ze,numSegments:Ve},ge),ut=n.compileAndRun(ot,[se,Ce],Be);if(f.push(ut),ut.shape[1]===Ve)return ut;let ft=WT({backend:n,attrs:{start:0,stop:Ve,step:1,dtype:"float32"}}),kt=KT({inputs:{x:ft},backend:n,attrs:{reps:[Xe/tt]}});return f.push(ft),f.push(kt),H(ut,ge,kt,Be,Ve)},W=Xn({inputs:{x:H(N,"unsortedSegmentSum",l,F,u)},backend:n,attrs:{shape:x}}),G=W;if(m!=null){f.push(W);let se=Bd(m);G=bo({inputs:{x:G},backend:n,attrs:{perm:se}})}return f.forEach(se=>n.disposeIntermediateTensorInfo(se)),G}},kP];for(let i of s4)hm(i);let a4={"tfjs-core":v1,"tfjs-backend-cpu":"3.13.0","tfjs-backend-webgl":"3.13.0","tfjs-data":F2,"tfjs-layers":Er,"tfjs-converter":g2,tfjs:"3.13.0"}},8485:(V,re,ae)=>{"use strict";ae.d(re,{Z:()=>P});var E=ae(3645),z=ae.n(E)()(function(L){return L[1]});z.push([V.id,".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,0);z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid #fff;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:#000;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media(min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media(max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right, white 10px, transparent 10px) 0 0,linear-gradient(to right, white 10px, transparent 10px) 0 100%,linear-gradient(to left, white 10px, transparent 10px) 100% 0,linear-gradient(to left, white 10px, transparent 10px) 100% 100%,linear-gradient(to bottom, white 10px, transparent 10px) 0 0,linear-gradient(to bottom, white 10px, transparent 10px) 100% 0,linear-gradient(to top, white 10px, transparent 10px) 0 100%,linear-gradient(to top, white 10px, transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:#fff;animation:move 2s linear infinite}@keyframes move{0%,100%{top:0%}50%{top:calc(100% - 10px)}}",""]);let P=z},3645:V=>{"use strict";V.exports=function(re){var ae=[];return ae.toString=function(){return this.map(function(E){var z=re(E);return E[2]?"@media ".concat(E[2]," {").concat(z,"}"):z}).join("")},ae.i=function(E,z,P){typeof E=="string"&&(E=[[null,E,""]]);var L={};if(P)for(var k=0;k<this.length;k++){var C=this[k][0];C!=null&&(L[C]=!0)}for(var M=0;M<E.length;M++){var I=[].concat(E[M]);P&&L[I[0]]||(z&&(I[2]?I[2]="".concat(z," and ").concat(I[2]):I[2]=z),ae.push(I))}},ae}},7676:(V,re,ae)=>{"use strict";ae.d(re,{Z:()=>E});let E='<div class="mindar-ui-overlay mindar-ui-compatibility"> <div class="content"> <h1>Failed to launch :(</h1> <p> Looks like your device/browser is not compatible. </p> <br/> <br/> <p> Please try the following recommended browsers: </p> <p> For Android device - Chrome </p> <p> For iOS device - Safari </p> </div> </div> '},9894:(V,re,ae)=>{"use strict";ae.d(re,{Z:()=>E});let E='<div class="mindar-ui-overlay mindar-ui-loading"> <div class="loader"/> </div> '},2810:(V,re,ae)=>{"use strict";ae.d(re,{Z:()=>E});let E='<div class="mindar-ui-overlay mindar-ui-scanning"> <div class="scanning"> <div class="inner"> <div class="scanline"/> </div> </div> </div> '},3720:V=>{V.exports=ae;var re=null;try{re=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ae(pe,we,he){this.low=0|pe,this.high=0|we,this.unsigned=!!he}function E(pe){return(pe&&pe.__isLong__)===!0}ae.prototype.__isLong__,Object.defineProperty(ae.prototype,"__isLong__",{value:!0}),ae.isLong=E;var z={},P={};function L(pe,we){var he,Ie,Ae;return we?(Ae=0<=(pe>>>=0)&&pe<256)&&(Ie=P[pe])?Ie:(he=C(pe,(0|pe)<0?-1:0,!0),Ae&&(P[pe]=he),he):(Ae=-128<=(pe|=0)&&pe<128)&&(Ie=z[pe])?Ie:(he=C(pe,pe<0?-1:0,!1),Ae&&(z[pe]=he),he)}function k(pe,we){if(isNaN(pe))return we?$:B;if(we){if(pe<0)return $;if(pe>=A)return xe}else{if(pe<=-_)return Se;if(pe+1>=_)return ue}return pe<0?k(-pe,we).neg():C(pe%T|0,pe/T|0,we)}function C(pe,we,he){return new ae(pe,we,he)}ae.fromInt=L,ae.fromNumber=k,ae.fromBits=C;var M=Math.pow;function I(pe,we,he){if(pe.length===0)throw Error("empty string");if(pe==="NaN"||pe==="Infinity"||pe==="+Infinity"||pe==="-Infinity")return B;if(typeof we=="number"?(he=we,we=!1):we=!!we,(he=he||10)<2||36<he)throw RangeError("radix");var Ie;if((Ie=pe.indexOf("-"))>0)throw Error("interior hyphen");if(Ie===0)return I(pe.substring(1),we,he).neg();for(var Ae=k(M(he,8)),Ue=B,Qe=0;Qe<pe.length;Qe+=8){var ht=Math.min(8,pe.length-Qe),lt=parseInt(pe.substring(Qe,Qe+ht),he);if(ht<8){var Et=k(M(he,ht));Ue=Ue.mul(Et).add(k(lt))}else Ue=(Ue=Ue.mul(Ae)).add(k(lt))}return Ue.unsigned=we,Ue}function b(pe,we){return typeof pe=="number"?k(pe,we):typeof pe=="string"?I(pe,we):C(pe.low,pe.high,typeof we=="boolean"?we:pe.unsigned)}ae.fromString=I,ae.fromValue=b;var T=4294967296,A=T*T,_=A/2,D=L(1<<24),B=L(0);ae.ZERO=B;var $=L(0,!0);ae.UZERO=$;var j=L(1);ae.ONE=j;var q=L(1,!0);ae.UONE=q;var Q=L(-1);ae.NEG_ONE=Q;var ue=C(-1,2147483647,!1);ae.MAX_VALUE=ue;var xe=C(-1,-1,!0);ae.MAX_UNSIGNED_VALUE=xe;var Se=C(0,-2147483648,!1);ae.MIN_VALUE=Se;var be=ae.prototype;be.toInt=function(){return this.unsigned?this.low>>>0:this.low},be.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},be.toString=function(pe){if((pe=pe||10)<2||36<pe)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Se)){var we=k(pe),he=this.div(we),Ie=he.mul(we).sub(this);return he.toString(pe)+Ie.toInt().toString(pe)}return"-"+this.neg().toString(pe)}for(var Ae=k(M(pe,6),this.unsigned),Ue=this,Qe="";;){var ht=Ue.div(Ae),lt=(Ue.sub(ht.mul(Ae)).toInt()>>>0).toString(pe);if((Ue=ht).isZero())return lt+Qe;for(;lt.length<6;)lt="0"+lt;Qe=""+lt+Qe}},be.getHighBits=function(){return this.high},be.getHighBitsUnsigned=function(){return this.high>>>0},be.getLowBits=function(){return this.low},be.getLowBitsUnsigned=function(){return this.low>>>0},be.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Se)?64:this.neg().getNumBitsAbs();for(var pe=this.high!=0?this.high:this.low,we=31;we>0&&(pe&1<<we)==0;we--);return this.high!=0?we+33:we+1},be.isZero=function(){return this.high===0&&this.low===0},be.eqz=be.isZero,be.isNegative=function(){return!this.unsigned&&this.high<0},be.isPositive=function(){return this.unsigned||this.high>=0},be.isOdd=function(){return(1&this.low)==1},be.isEven=function(){return(1&this.low)==0},be.equals=function(pe){return E(pe)||(pe=b(pe)),(this.unsigned===pe.unsigned||this.high>>>31!=1||pe.high>>>31!=1)&&this.high===pe.high&&this.low===pe.low},be.eq=be.equals,be.notEquals=function(pe){return!this.eq(pe)},be.neq=be.notEquals,be.ne=be.notEquals,be.lessThan=function(pe){return this.comp(pe)<0},be.lt=be.lessThan,be.lessThanOrEqual=function(pe){return this.comp(pe)<=0},be.lte=be.lessThanOrEqual,be.le=be.lessThanOrEqual,be.greaterThan=function(pe){return this.comp(pe)>0},be.gt=be.greaterThan,be.greaterThanOrEqual=function(pe){return this.comp(pe)>=0},be.gte=be.greaterThanOrEqual,be.ge=be.greaterThanOrEqual,be.compare=function(pe){if(E(pe)||(pe=b(pe)),this.eq(pe))return 0;var we=this.isNegative(),he=pe.isNegative();return we&&!he?-1:!we&&he?1:this.unsigned?pe.high>>>0>this.high>>>0||pe.high===this.high&&pe.low>>>0>this.low>>>0?-1:1:this.sub(pe).isNegative()?-1:1},be.comp=be.compare,be.negate=function(){return!this.unsigned&&this.eq(Se)?Se:this.not().add(j)},be.neg=be.negate,be.add=function(pe){E(pe)||(pe=b(pe));var we=this.high>>>16,he=65535&this.high,Ie=this.low>>>16,Ae=65535&this.low,Ue=pe.high>>>16,Qe=65535&pe.high,ht=pe.low>>>16,lt=0,Et=0,Mt=0,ln=0;return Mt+=(ln+=Ae+(65535&pe.low))>>>16,Et+=(Mt+=Ie+ht)>>>16,lt+=(Et+=he+Qe)>>>16,lt+=we+Ue,C((Mt&=65535)<<16|(ln&=65535),(lt&=65535)<<16|(Et&=65535),this.unsigned)},be.subtract=function(pe){return E(pe)||(pe=b(pe)),this.add(pe.neg())},be.sub=be.subtract,be.multiply=function(pe){if(this.isZero())return B;if(E(pe)||(pe=b(pe)),re)return C(re.mul(this.low,this.high,pe.low,pe.high),re.get_high(),this.unsigned);if(pe.isZero())return B;if(this.eq(Se))return pe.isOdd()?Se:B;if(pe.eq(Se))return this.isOdd()?Se:B;if(this.isNegative())return pe.isNegative()?this.neg().mul(pe.neg()):this.neg().mul(pe).neg();if(pe.isNegative())return this.mul(pe.neg()).neg();if(this.lt(D)&&pe.lt(D))return k(this.toNumber()*pe.toNumber(),this.unsigned);var we=this.high>>>16,he=65535&this.high,Ie=this.low>>>16,Ae=65535&this.low,Ue=pe.high>>>16,Qe=65535&pe.high,ht=pe.low>>>16,lt=65535&pe.low,Et=0,Mt=0,ln=0,Tn=0;return ln+=(Tn+=Ae*lt)>>>16,Mt+=(ln+=Ie*lt)>>>16,ln&=65535,Mt+=(ln+=Ae*ht)>>>16,Et+=(Mt+=he*lt)>>>16,Mt&=65535,Et+=(Mt+=Ie*ht)>>>16,Mt&=65535,Et+=(Mt+=Ae*Qe)>>>16,Et+=we*lt+he*ht+Ie*Qe+Ae*Ue,C((ln&=65535)<<16|(Tn&=65535),(Et&=65535)<<16|(Mt&=65535),this.unsigned)},be.mul=be.multiply,be.divide=function(pe){if(E(pe)||(pe=b(pe)),pe.isZero())throw Error("division by zero");var we,he,Ie;if(re)return this.unsigned||this.high!==-2147483648||pe.low!==-1||pe.high!==-1?C((this.unsigned?re.div_u:re.div_s)(this.low,this.high,pe.low,pe.high),re.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?$:B;if(this.unsigned){if(pe.unsigned||(pe=pe.toUnsigned()),pe.gt(this))return $;if(pe.gt(this.shru(1)))return q;Ie=$}else{if(this.eq(Se))return pe.eq(j)||pe.eq(Q)?Se:pe.eq(Se)?j:(we=this.shr(1).div(pe).shl(1)).eq(B)?pe.isNegative()?j:Q:(he=this.sub(pe.mul(we)),Ie=we.add(he.div(pe)));if(pe.eq(Se))return this.unsigned?$:B;if(this.isNegative())return pe.isNegative()?this.neg().div(pe.neg()):this.neg().div(pe).neg();if(pe.isNegative())return this.div(pe.neg()).neg();Ie=B}for(he=this;he.gte(pe);){we=Math.max(1,Math.floor(he.toNumber()/pe.toNumber()));for(var Ae=Math.ceil(Math.log(we)/Math.LN2),Ue=Ae<=48?1:M(2,Ae-48),Qe=k(we),ht=Qe.mul(pe);ht.isNegative()||ht.gt(he);)ht=(Qe=k(we-=Ue,this.unsigned)).mul(pe);Qe.isZero()&&(Qe=j),Ie=Ie.add(Qe),he=he.sub(ht)}return Ie},be.div=be.divide,be.modulo=function(pe){return E(pe)||(pe=b(pe)),re?C((this.unsigned?re.rem_u:re.rem_s)(this.low,this.high,pe.low,pe.high),re.get_high(),this.unsigned):this.sub(this.div(pe).mul(pe))},be.mod=be.modulo,be.rem=be.modulo,be.not=function(){return C(~this.low,~this.high,this.unsigned)},be.and=function(pe){return E(pe)||(pe=b(pe)),C(this.low&pe.low,this.high&pe.high,this.unsigned)},be.or=function(pe){return E(pe)||(pe=b(pe)),C(this.low|pe.low,this.high|pe.high,this.unsigned)},be.xor=function(pe){return E(pe)||(pe=b(pe)),C(this.low^pe.low,this.high^pe.high,this.unsigned)},be.shiftLeft=function(pe){return E(pe)&&(pe=pe.toInt()),(pe&=63)==0?this:pe<32?C(this.low<<pe,this.high<<pe|this.low>>>32-pe,this.unsigned):C(0,this.low<<pe-32,this.unsigned)},be.shl=be.shiftLeft,be.shiftRight=function(pe){return E(pe)&&(pe=pe.toInt()),(pe&=63)==0?this:pe<32?C(this.low>>>pe|this.high<<32-pe,this.high>>pe,this.unsigned):C(this.high>>pe-32,this.high>=0?0:-1,this.unsigned)},be.shr=be.shiftRight,be.shiftRightUnsigned=function(pe){if(E(pe)&&(pe=pe.toInt()),(pe&=63)==0)return this;var we=this.high;return pe<32?C(this.low>>>pe|we<<32-pe,we>>>pe,this.unsigned):C(pe===32?we:we>>>pe-32,0,this.unsigned)},be.shru=be.shiftRightUnsigned,be.shr_u=be.shiftRightUnsigned,be.toSigned=function(){return this.unsigned?C(this.low,this.high,!1):this},be.toUnsigned=function(){return this.unsigned?this:C(this.low,this.high,!0)},be.toBytes=function(pe){return pe?this.toBytesLE():this.toBytesBE()},be.toBytesLE=function(){var pe=this.high,we=this.low;return[255&we,we>>>8&255,we>>>16&255,we>>>24,255&pe,pe>>>8&255,pe>>>16&255,pe>>>24]},be.toBytesBE=function(){var pe=this.high,we=this.low;return[pe>>>24,pe>>>16&255,pe>>>8&255,255&pe,we>>>24,we>>>16&255,we>>>8&255,255&we]},ae.fromBytes=function(pe,we,he){return he?ae.fromBytesLE(pe,we):ae.fromBytesBE(pe,we)},ae.fromBytesLE=function(pe,we){return new ae(pe[0]|pe[1]<<8|pe[2]<<16|pe[3]<<24,pe[4]|pe[5]<<8|pe[6]<<16|pe[7]<<24,we)},ae.fromBytesBE=function(pe,we){return new ae(pe[4]<<24|pe[5]<<16|pe[6]<<8|pe[7],pe[0]<<24|pe[1]<<16|pe[2]<<8|pe[3],we)}},6377:(V,re,ae)=>{var E=ae(4832),z=ae(8652),P=ae(801),L=ae(2030),k=ae(3618),C=ae(9049),M=ae(1971);M.alea=E,M.xor128=z,M.xorwow=P,M.xorshift7=L,M.xor4096=k,M.tychei=C,V.exports=M},4832:function(V,re,ae){var E;(function(z,P,L){function k(I){var b,T=this,A=(b=4022871197,function(_){_=_.toString();for(var D=0;D<_.length;D++){var B=.02519603282416938*(b+=_.charCodeAt(D));B-=b=B>>>0,b=(B*=b)>>>0,b+=4294967296*(B-=b)}return 23283064365386963e-26*(b>>>0)});T.next=function(){var _=2091639*T.s0+23283064365386963e-26*T.c;return T.s0=T.s1,T.s1=T.s2,T.s2=_-(T.c=0|_)},T.c=1,T.s0=A(" "),T.s1=A(" "),T.s2=A(" "),T.s0-=A(I),T.s0<0&&(T.s0+=1),T.s1-=A(I),T.s1<0&&(T.s1+=1),T.s2-=A(I),T.s2<0&&(T.s2+=1),A=null}function C(I,b){return b.c=I.c,b.s0=I.s0,b.s1=I.s1,b.s2=I.s2,b}function M(I,b){var T=new k(I),A=b&&b.state,_=T.next;return _.int32=function(){return 4294967296*T.next()|0},_.double=function(){return _()+11102230246251565e-32*(2097152*_()|0)},_.quick=_,A&&(typeof A=="object"&&C(A,T),_.state=function(){return C(T,{})}),_}P&&P.exports?P.exports=M:ae.amdD&&ae.amdO?(E=function(){return M}.call(re,ae,re,P))===void 0||(P.exports=E):this.alea=M})(0,V=ae.nmd(V),ae.amdD)},9049:function(V,re,ae){var E;(function(z,P,L){function k(I){var b=this,T="";b.next=function(){var _=b.b,D=b.c,B=b.d,$=b.a;return _=_<<25^_>>>7^D,D=D-B|0,B=B<<24^B>>>8^$,$=$-_|0,b.b=_=_<<20^_>>>12^D,b.c=D=D-B|0,b.d=B<<16^D>>>16^$,b.a=$-_|0},b.a=0,b.b=0,b.c=-1640531527,b.d=1367130551,I===Math.floor(I)?(b.a=I/4294967296|0,b.b=0|I):T+=I;for(var A=0;A<T.length+20;A++)b.b^=0|T.charCodeAt(A),b.next()}function C(I,b){return b.a=I.a,b.b=I.b,b.c=I.c,b.d=I.d,b}function M(I,b){var T=new k(I),A=b&&b.state,_=function(){return(T.next()>>>0)/4294967296};return _.double=function(){do var D=((T.next()>>>11)+(T.next()>>>0)/4294967296)/2097152;while(D===0);return D},_.int32=T.next,_.quick=_,A&&(typeof A=="object"&&C(A,T),_.state=function(){return C(T,{})}),_}P&&P.exports?P.exports=M:ae.amdD&&ae.amdO?(E=function(){return M}.call(re,ae,re,P))===void 0||(P.exports=E):this.tychei=M})(0,V=ae.nmd(V),ae.amdD)},8652:function(V,re,ae){var E;(function(z,P,L){function k(I){var b=this,T="";b.x=0,b.y=0,b.z=0,b.w=0,b.next=function(){var _=b.x^b.x<<11;return b.x=b.y,b.y=b.z,b.z=b.w,b.w^=b.w>>>19^_^_>>>8},I===(0|I)?b.x=I:T+=I;for(var A=0;A<T.length+64;A++)b.x^=0|T.charCodeAt(A),b.next()}function C(I,b){return b.x=I.x,b.y=I.y,b.z=I.z,b.w=I.w,b}function M(I,b){var T=new k(I),A=b&&b.state,_=function(){return(T.next()>>>0)/4294967296};return _.double=function(){do var D=((T.next()>>>11)+(T.next()>>>0)/4294967296)/2097152;while(D===0);return D},_.int32=T.next,_.quick=_,A&&(typeof A=="object"&&C(A,T),_.state=function(){return C(T,{})}),_}P&&P.exports?P.exports=M:ae.amdD&&ae.amdO?(E=function(){return M}.call(re,ae,re,P))===void 0||(P.exports=E):this.xor128=M})(0,V=ae.nmd(V),ae.amdD)},3618:function(V,re,ae){var E;(function(z,P,L){function k(I){var b=this;b.next=function(){var T,A,_=b.w,D=b.X,B=b.i;return b.w=_=_+1640531527|0,A=D[B+34&127],T=D[B=B+1&127],A^=A<<13,T^=T<<17,A^=A>>>15,T^=T>>>12,A=D[B]=A^T,b.i=B,A+(_^_>>>16)|0},function(T,A){var _,D,B,$,j,q=[],Q=128;for(A===(0|A)?(D=A,A=null):(A+="\0",D=0,Q=Math.max(Q,A.length)),B=0,$=-32;$<Q;++$)A&&(D^=A.charCodeAt(($+32)%A.length)),$===0&&(j=D),D^=D<<10,D^=D>>>15,D^=D<<4,D^=D>>>13,$>=0&&(j=j+1640531527|0,B=(_=q[127&$]^=D+j)==0?B+1:0);for(B>=128&&(q[127&(A&&A.length||0)]=-1),B=127,$=512;$>0;--$)D=q[B+34&127],_=q[B=B+1&127],D^=D<<13,_^=_<<17,D^=D>>>15,_^=_>>>12,q[B]=D^_;T.w=j,T.X=q,T.i=B}(b,I)}function C(I,b){return b.i=I.i,b.w=I.w,b.X=I.X.slice(),b}function M(I,b){I==null&&(I=+new Date);var T=new k(I),A=b&&b.state,_=function(){return(T.next()>>>0)/4294967296};return _.double=function(){do var D=((T.next()>>>11)+(T.next()>>>0)/4294967296)/2097152;while(D===0);return D},_.int32=T.next,_.quick=_,A&&(A.X&&C(A,T),_.state=function(){return C(T,{})}),_}P&&P.exports?P.exports=M:ae.amdD&&ae.amdO?(E=function(){return M}.call(re,ae,re,P))===void 0||(P.exports=E):this.xor4096=M})(0,V=ae.nmd(V),ae.amdD)},2030:function(V,re,ae){var E;(function(z,P,L){function k(I){var b=this;b.next=function(){var T,A,_=b.x,D=b.i;return T=_[D],A=(T^=T>>>7)^T<<24,A^=(T=_[D+1&7])^T>>>10,A^=(T=_[D+3&7])^T>>>3,A^=(T=_[D+4&7])^T<<7,T=_[D+7&7],A^=(T^=T<<13)^T<<9,_[D]=A,b.i=D+1&7,A},function(T,A){var _,D=[];if(A===(0|A))D[0]=A;else for(A=""+A,_=0;_<A.length;++_)D[7&_]=D[7&_]<<15^A.charCodeAt(_)+D[_+1&7]<<13;for(;D.length<8;)D.push(0);for(_=0;_<8&&D[_]===0;++_);for(_==8?D[7]=-1:D[_],T.x=D,T.i=0,_=256;_>0;--_)T.next()}(b,I)}function C(I,b){return b.x=I.x.slice(),b.i=I.i,b}function M(I,b){I==null&&(I=+new Date);var T=new k(I),A=b&&b.state,_=function(){return(T.next()>>>0)/4294967296};return _.double=function(){do var D=((T.next()>>>11)+(T.next()>>>0)/4294967296)/2097152;while(D===0);return D},_.int32=T.next,_.quick=_,A&&(A.x&&C(A,T),_.state=function(){return C(T,{})}),_}P&&P.exports?P.exports=M:ae.amdD&&ae.amdO?(E=function(){return M}.call(re,ae,re,P))===void 0||(P.exports=E):this.xorshift7=M})(0,V=ae.nmd(V),ae.amdD)},801:function(V,re,ae){var E;(function(z,P,L){function k(I){var b=this,T="";b.next=function(){var _=b.x^b.x>>>2;return b.x=b.y,b.y=b.z,b.z=b.w,b.w=b.v,(b.d=b.d+362437|0)+(b.v=b.v^b.v<<4^_^_<<1)|0},b.x=0,b.y=0,b.z=0,b.w=0,b.v=0,I===(0|I)?b.x=I:T+=I;for(var A=0;A<T.length+64;A++)b.x^=0|T.charCodeAt(A),A==T.length&&(b.d=b.x<<10^b.x>>>4),b.next()}function C(I,b){return b.x=I.x,b.y=I.y,b.z=I.z,b.w=I.w,b.v=I.v,b.d=I.d,b}function M(I,b){var T=new k(I),A=b&&b.state,_=function(){return(T.next()>>>0)/4294967296};return _.double=function(){do var D=((T.next()>>>11)+(T.next()>>>0)/4294967296)/2097152;while(D===0);return D},_.int32=T.next,_.quick=_,A&&(typeof A=="object"&&C(A,T),_.state=function(){return C(T,{})}),_}P&&P.exports?P.exports=M:ae.amdD&&ae.amdO?(E=function(){return M}.call(re,ae,re,P))===void 0||(P.exports=E):this.xorwow=M})(0,V=ae.nmd(V),ae.amdD)},1971:(V,re,ae)=>{var E;(function(z,P){var L,k=this,C=256,M=P.pow(C,6),I=P.pow(2,52),b=2*I,T=255;function A(q,Q,ue){var xe=[],Se=$(B((Q=Q==1?{entropy:!0}:Q||{}).entropy?[q,j(z)]:q??function(){try{var we;return L&&(we=L.randomBytes)?we=we(C):(we=new Uint8Array(C),(k.crypto||k.msCrypto).getRandomValues(we)),j(we)}catch{var he=k.navigator,Ie=he&&he.plugins;return[+new Date,k,Ie,k.screen,j(z)]}}(),3),xe),be=new _(xe),pe=function(){for(var we=be.g(6),he=M,Ie=0;we<I;)we=(we+Ie)*C,he*=C,Ie=be.g(1);for(;we>=b;)we/=2,he/=2,Ie>>>=1;return(we+Ie)/he};return pe.int32=function(){return 0|be.g(4)},pe.quick=function(){return be.g(4)/4294967296},pe.double=pe,$(j(be.S),z),(Q.pass||ue||function(we,he,Ie,Ae){return Ae&&(Ae.S&&D(Ae,be),we.state=function(){return D(be,{})}),Ie?(P.random=we,he):we})(pe,Se,"global"in Q?Q.global:this==P,Q.state)}function _(q){var Q,ue=q.length,xe=this,Se=0,be=xe.i=xe.j=0,pe=xe.S=[];for(ue||(q=[ue++]);Se<C;)pe[Se]=Se++;for(Se=0;Se<C;Se++)pe[Se]=pe[be=T&be+q[Se%ue]+(Q=pe[Se])],pe[be]=Q;(xe.g=function(we){for(var he,Ie=0,Ae=xe.i,Ue=xe.j,Qe=xe.S;we--;)he=Qe[Ae=T&Ae+1],Ie=Ie*C+Qe[T&(Qe[Ae]=Qe[Ue=T&Ue+he])+(Qe[Ue]=he)];return xe.i=Ae,xe.j=Ue,Ie})(C)}function D(q,Q){return Q.i=q.i,Q.j=q.j,Q.S=q.S.slice(),Q}function B(q,Q){var ue,xe=[],Se=typeof q;if(Q&&Se=="object")for(ue in q)try{xe.push(B(q[ue],Q-1))}catch{}return xe.length?xe:Se=="string"?q:q+"\0"}function $(q,Q){for(var ue,xe=q+"",Se=0;Se<xe.length;)Q[T&Se]=T&(ue^=19*Q[T&Se])+xe.charCodeAt(Se++);return j(Q)}function j(q){return String.fromCharCode.apply(0,q)}if(P.seedrandom=A,$(P.random(),z),V.exports){V.exports=A;try{L=ae(3906)}catch{}}else(E=function(){return A}.call(re,ae,re,V))===void 0||(V.exports=E)})([],Math)},4412:(V,re,ae)=>{"use strict";ae.r(re),ae.d(re,{default:()=>L});var E=ae(3379),z=ae.n(E),P=ae(8485);z()(P.Z,{insert:"head",singleton:!1});let L=P.Z.locals||{}},3379:(V,re,ae)=>{"use strict";var E,z=function(){var B={};return function($){if(B[$]===void 0){var j=document.querySelector($);if(window.HTMLIFrameElement&&j instanceof window.HTMLIFrameElement)try{j=j.contentDocument.head}catch{j=null}B[$]=j}return B[$]}}(),P=[];function L(B){for(var $=-1,j=0;j<P.length;j++)if(P[j].identifier===B){$=j;break}return $}function k(B,$){for(var j={},q=[],Q=0;Q<B.length;Q++){var ue=B[Q],xe=$.base?ue[0]+$.base:ue[0],Se=j[xe]||0,be="".concat(xe," ").concat(Se);j[xe]=Se+1;var pe=L(be),we={css:ue[1],media:ue[2],sourceMap:ue[3]};pe!==-1?(P[pe].references++,P[pe].updater(we)):P.push({identifier:be,updater:D(we,$),references:1}),q.push(be)}return q}function C(B){var $=document.createElement("style"),j=B.attributes||{};if(j.nonce===void 0){var q=ae.nc;q&&(j.nonce=q)}if(Object.keys(j).forEach(function(ue){$.setAttribute(ue,j[ue])}),typeof B.insert=="function")B.insert($);else{var Q=z(B.insert||"head");if(!Q)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");Q.appendChild($)}return $}var M,I=(M=[],function(B,$){return M[B]=$,M.filter(Boolean).join(`
`)});function b(B,$,j,q){var Q=j?"":q.media?"@media ".concat(q.media," {").concat(q.css,"}"):q.css;if(B.styleSheet)B.styleSheet.cssText=I($,Q);else{var ue=document.createTextNode(Q),xe=B.childNodes;xe[$]&&B.removeChild(xe[$]),xe.length?B.insertBefore(ue,xe[$]):B.appendChild(ue)}}function T(B,$,j){var q=j.css,Q=j.media,ue=j.sourceMap;if(Q?B.setAttribute("media",Q):B.removeAttribute("media"),ue&&typeof btoa<"u"&&(q+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(ue))))," */")),B.styleSheet)B.styleSheet.cssText=q;else{for(;B.firstChild;)B.removeChild(B.firstChild);B.appendChild(document.createTextNode(q))}}var A=null,_=0;function D(B,$){var j,q,Q;if($.singleton){var ue=_++;j=A||(A=C($)),q=b.bind(null,j,ue,!1),Q=b.bind(null,j,ue,!0)}else j=C($),q=T.bind(null,j,$),Q=function(){(function(xe){if(xe.parentNode===null)return!1;xe.parentNode.removeChild(xe)})(j)};return q(B),function(xe){if(xe){if(xe.css===B.css&&xe.media===B.media&&xe.sourceMap===B.sourceMap)return;q(B=xe)}else Q()}}V.exports=function(B,$){($=$||{}).singleton||typeof $.singleton=="boolean"||($.singleton=(E===void 0&&(E=Boolean(window&&document&&document.all&&!window.atob)),E));var j=k(B=B||[],$);return function(q){if(q=q||[],Object.prototype.toString.call(q)==="[object Array]"){for(var Q=0;Q<j.length;Q++){var ue=L(j[Q]);P[ue].references--}for(var xe=k(q,$),Se=0;Se<j.length;Se++){var be=L(j[Se]);P[be].references===0&&(P[be].updater(),P.splice(be,1))}j=xe}}}},383:(V,re,ae)=>{V.exports=function(){return ae(9855)('(()=>{var t={508:(t,e,r)=>{const{resize:a}=r(140);t.exports={buildImageList:t=>{const e=[];let r=100/Math.min(t.width,t.height);for(;;)if(e.push(r),r*=Math.pow(2,1/3),r>=.95){r=1;break}e.push(r),e.reverse();const i=[];for(let r=0;r<e.length;r++)t.width,e[r],t.height,e[r],i.push(Object.assign(a({image:t,ratio:e[r]}),{scale:e[r]}));return i},buildTrackingImageList:t=>{const e=Math.min(t.width,t.height),r=[],i=[];r.push(256/e),r.push(128/e);for(let e=0;e<r.length;e++)i.push(Object.assign(a({image:t,ratio:r[e]}),{scale:r[e]}));return i}}},589:(t,e,r)=>{const{Cumsum:a}=r(535),i=({image:t,cx:e,cy:r,sdThresh:a,imageDataCumsum:i,imageDataSqrCumsum:s})=>{if(e-6<0||e+6>=t.width)return null;if(r-6<0||r+6>=t.height)return null;let h=i.query(e-6,r-6,e+6,r+6);h/=169;let o=s.query(e-6,r-6,e+6,r+6);return o-=2*h*i.query(e-6,r-6,e+6,r+6),o+=169*h*h,o/169<a*a?null:(o=Math.sqrt(o),o)},s=t=>{const{image:e,cx:r,cy:a,vlen:i,tx:s,ty:h,imageDataCumsum:o,imageDataSqrCumsum:l}=t,{data:u,width:n,height:m}=e;if(r-6<0||r+6>=n)return null;if(a-6<0||a+6>=m)return null;let c=o.query(r-6,a-6,r+6,a+6),f=l.query(r-6,a-6,r+6,a+6),g=0,d=(a-6)*n+(r-6),p=(h-6)*n+(s-6),w=n-13;for(let t=0;t<13;t++){for(let t=0;t<13;t++)g+=u[d]*u[p],d+=1,p+=1;d+=w,p+=w}let M=o.query(s-6,h-6,s+6,h+6);M/=169,g-=M*c;let y=f-c*c/169;return 0==y?null:(y=Math.sqrt(y),1*g/(i*y))};t.exports={extract:t=>{const{data:e,width:r,height:h,scale:o}=t,l=[r*h];for(let t=0;t<l.length;t++)l[t]=!1;const u=new Float32Array(e.length);for(let t=0;t<r;t++)u[t]=-1,u[r*(h-1)+t]=-1;for(let t=0;t<h;t++)u[t*r]=-1,u[t*r+r-1]=-1;for(let t=1;t<r-1;t++)for(let a=1;a<h-1;a++){let i=t+r*a,s=0,h=0;for(let t=-1;t<=1;t++)s+=e[i+r*t+1]-e[i+r*t-1],h+=e[i+r+t]-e[i-r+t];s/=768,h/=768,u[i]=Math.sqrt((s*s+h*h)/2)}const n=new Uint32Array(1e3);for(let t=0;t<1e3;t++)n[t]=0;const m=[-1,1,-r,r];let c=0;for(let t=1;t<r-1;t++)for(let e=1;e<h-1;e++){let a=t+r*e,i=!0;for(let t=0;t<m.length;t++)if(u[a]<=u[a+m[t]]){i=!1;break}if(i){let t=Math.floor(1e3*u[a]);t>999&&(t=999),t<0&&(t=0),n[t]+=1,c+=1,l[a]=!0}}const f=.02*r*h;let g=999,d=0;for(;g>=0&&(d+=n[g],!(d>f));)g--;for(let t=0;t<l.length;t++)l[t]&&1e3*u[t]<g&&(l[t]=!1);const p=[];for(let t=0;t<e.length;t++)p[t]=e[t]*e[t];const w=new a(e,r,h),M=new a(p,r,h),y=new Float32Array(e.length);for(let e=0;e<r;e++)for(let a=0;a<h;a++){const h=a*r+e;if(!l[h]){y[h]=1;continue}const o=i({image:t,cx:e,cy:a,sdThresh:5,imageDataCumsum:w,imageDataSqrCumsum:M});if(null===o){y[h]=1;continue}let u=-1;for(let r=-10;r<=10;r++){for(let i=-10;i<=10;i++){if(i*i+r*r<=4)continue;const h=s({image:t,cx:e+i,cy:a+r,vlen:o,tx:e,ty:a,imageDataCumsum:w,imageDataSqrCumsum:M});if(null!==h&&h>u&&(u=h,u>.95))break}if(u>.95)break}y[h]=u}return(t=>{let{image:e,featureMap:r,templateSize:a,searchSize:h,occSize:o,maxSimThresh:l,minSimThresh:u,sdThresh:n,imageDataCumsum:m,imageDataSqrCumsum:c}=t;const{data:f,width:g,height:d,scale:p}=e;o=Math.floor(Math.min(e.width,e.height)/10);const w=3*(2*a+1),M=Math.floor(g/w),y=Math.floor(d/w);let x=Math.floor(g/o)*Math.floor(d/o)+M*y;const q=[],C=new Float32Array(f.length);for(let t=0;t<C.length;t++)C[t]=r[t];let S=0;for(;S<x;){let t=l,r=-1,f=-1;for(let e=0;e<d;e++)for(let a=0;a<g;a++)C[e*g+a]<t&&(t=C[e*g+a],r=a,f=e);if(-1===r)break;const p=i({image:e,cx:r,cy:f,sdThresh:0,imageDataCumsum:m,imageDataSqrCumsum:c});if(null===p){C[f*g+r]=1;continue}if(p/(2*a+1)<n){C[f*g+r]=1;continue}let w=1,M=-1;for(let a=-h;a<=h;a++){for(let i=-h;i<=h;i++){if(i*i+a*a>h*h)continue;if(0===i&&0===a)continue;const o=s({image:e,vlen:p,cx:r+i,cy:f+a,tx:r,ty:f,imageDataCumsum:m,imageDataSqrCumsum:c});if(null!==o){if(o<w&&(w=o,w<u&&w<t))break;if(o>M&&(M=o,M>.99))break}}if(w<u&&w<t||M>.99)break}if(w<u&&w<t||M>.99)C[f*g+r]=1;else{q.push({x:r,y:f}),S+=1;for(let t=-o;t<=o;t++)for(let e=-o;e<=o;e++)f+t<0||f+t>=d||r+e<0||r+e>=g||(C[(f+t)*g+(r+e)]=1)}}return q})({image:t,featureMap:y,templateSize:6,searchSize:2,occSize:16,maxSimThresh:.9,minSimThresh:.2,sdThresh:8,imageDataCumsum:w,imageDataSqrCumsum:M})}}},535:t=>{t.exports={Cumsum:class{constructor(t,e,r){this.cumsum=[];for(let t=0;t<r;t++){this.cumsum.push([]);for(let r=0;r<e;r++)this.cumsum[t].push(0)}this.cumsum[0][0]=t[0];for(let r=1;r<e;r++)this.cumsum[0][r]=this.cumsum[0][r-1]+t[r];for(let a=1;a<r;a++)this.cumsum[a][0]=this.cumsum[a-1][0]+t[a*e];for(let a=1;a<r;a++)for(let r=1;r<e;r++)this.cumsum[a][r]=t[a*e+r]+this.cumsum[a-1][r]+this.cumsum[a][r-1]-this.cumsum[a-1][r-1]}query(t,e,r,a){let i=this.cumsum[a][r];return e>0&&(i-=this.cumsum[e-1][r]),t>0&&(i-=this.cumsum[a][t-1]),t>0&&e>0&&(i+=this.cumsum[e-1][t-1]),i}}}},140:t=>{t.exports={downsampleBilinear:({image:t})=>{const{data:e,width:r,height:a}=t,i=Math.floor(r/2),s=Math.floor(a/2),h=new Float32Array(i*s),o=[0,1,r,r+1];for(let t=0;t<s;t++)for(let a=0;a<i;a++){let s=2*t*r+2*a,l=0;for(let t=0;t<o.length;t++)l+=e[s+o[t]];l*=.25,h[t*i+a]=l}return{data:h,width:i,height:s}},upsampleBilinear:({image:t,padOneWidth:e,padOneHeight:r})=>{const{width:a,height:i,data:s}=t,h=2*t.width+(e?1:0),o=2*t.height+(r?1:0),l=new Float32Array(h*o);for(let t=0;t<h;t++){const e=.5*t-.25;let r=Math.floor(e),u=Math.ceil(e);r<0&&(r=0),u>=a&&(u=a-1);for(let n=0;n<o;n++){const o=.5*n-.25;let m=Math.floor(o),c=Math.ceil(o);m<0&&(m=0),c>=i&&(c=i-1);const f=(u-e)*(c-o)*s[m*a+r]+(u-e)*(o-m)*s[c*a+r]+(e-r)*(c-o)*s[m*a+u]+(e-r)*(o-m)*s[c*a+u];l[n*h+t]=f}}return{data:l,width:h,height:o}},resize:({image:t,ratio:e})=>{const r=Math.round(t.width*e),a=Math.round(t.height*e),i=new Uint8Array(r*a);for(let s=0;s<r;s++){let h=Math.round(1*s/e),o=Math.round(1*(s+1)/e)-1;o>=t.width&&(o=t.width-1);for(let l=0;l<a;l++){let a=Math.round(1*l/e),u=Math.round(1*(l+1)/e)-1;u>=t.height&&(u=t.height-1);let n=0,m=0;for(let e=h;e<=o;e++)for(let r=a;r<=u;r++)n+=1*t.data[r*t.width+e],m+=1;i[l*r+s]=Math.floor(n/m)}}return{data:i,width:r,height:a}}}}},e={};function r(a){if(e[a])return e[a].exports;var i=e[a]={exports:{}};return t[a](i,i.exports,r),i.exports}(()=>{const{extract:t}=r(589),{buildTrackingImageList:e}=r(508);onmessage=t=>{const{data:r}=t;if("compile"===r.type){const{targetImages:t}=r,i=50/t.length;let s=0;const h=[];for(let r=0;r<t.length;r++){const o=t[r],l=e(o),u=i/l.length,n=a(l,(t=>{s+=u,postMessage({type:"progress",percent:s})}));h.push(n)}postMessage({type:"compileDone",list:h})}};const a=(e,r)=>{const a=[];for(let i=0;i<e.length;i++){const s=e[i],h=t(s),o={data:s.data,scale:s.scale,width:s.width,height:s.height,points:h};a.push(o),r(i)}return a}})()})();',ae.p+"compiler.worker.prod.js")}},1077:(V,re,ae)=>{V.exports=function(){return ae(9855)('(()=>{var t={331:(t,e,r)=>{"use strict";r.r(e),r.d(e,{AbstractMatrix:()=>v,CHO:()=>tt,CholeskyDecomposition:()=>tt,EVD:()=>K,EigenvalueDecomposition:()=>K,LU:()=>H,LuDecomposition:()=>H,Matrix:()=>k,MatrixColumnSelectionView:()=>T,MatrixColumnView:()=>I,MatrixFlipColumnView:()=>A,MatrixFlipRowView:()=>q,MatrixRowSelectionView:()=>P,MatrixRowView:()=>C,MatrixSelectionView:()=>V,MatrixSubView:()=>N,MatrixTransposeView:()=>j,NIPALS:()=>et,Nipals:()=>et,QR:()=>$,QrDecomposition:()=>$,SVD:()=>L,SingularValueDecomposition:()=>L,WrapperMatrix1D:()=>z,WrapperMatrix2D:()=>F,correlation:()=>J,covariance:()=>B,default:()=>k,determinant:()=>X,inverse:()=>O,linearDependencies:()=>Q,pseudoInverse:()=>W,solve:()=>U,wrap:()=>D});const s=Object.prototype.toString;function o(t){return s.call(t).endsWith("Array]")}const n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!o(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var r=e.fromIndex,s=void 0===r?0:r,n=e.toIndex,i=void 0===n?t.length:n;if(s<0||s>=t.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=s||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var h=t[s],l=s+1;l<i;l++)t[l]>h&&(h=t[l]);return h},i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!o(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var r=e.fromIndex,s=void 0===r?0:r,n=e.toIndex,i=void 0===n?t.length:n;if(s<0||s>=t.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=s||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var h=t[s],l=s+1;l<i;l++)t[l]<h&&(h=t[l]);return h},h=function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!o(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!o(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var s=i(t),h=n(t);if(s===h)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var l=r.min,u=void 0===l?r.autoMinMax?s:0:l,a=r.max,c=void 0===a?r.autoMinMax?h:1:a;if(u>=c)throw new RangeError("min option must be smaller than max option");for(var f=(c-u)/(h-s),m=0;m<t.length;m++)e[m]=(t[m]-s)*f+u;return e},l=" ".repeat(2),u=" ".repeat(4);function a(t,e={}){const{maxRows:r=15,maxColumns:s=10,maxNumSize:o=8}=e;return`${t.constructor.name} {\\n${l}[\\n${u}${function(t,e,r,s){const{rows:o,columns:n}=t,i=Math.min(o,e),h=Math.min(n,r),l=[];for(let e=0;e<i;e++){let r=[];for(let o=0;o<h;o++)r.push(c(t.get(e,o),s));l.push(`${r.join(" ")}`)}return h!==n&&(l[l.length-1]+=` ... ${n-r} more columns`),i!==o&&l.push(`... ${o-e} more rows`),l.join(`\\n${u}`)}(t,r,s,o)}\\n${l}]\\n${l}rows: ${t.rows}\\n${l}columns: ${t.columns}\\n}`}function c(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const s=t.toPrecision(e-2);if(s.length<=e)return s;const o=t.toExponential(e-2),n=o.indexOf("e"),i=o.slice(n);return o.slice(0,e-i.length)+i}function f(t,e,r){let s=r?t.rows:t.rows-1;if(e<0||e>s)throw new RangeError("Row index out of range")}function m(t,e,r){let s=r?t.columns:t.columns-1;if(e<0||e>s)throw new RangeError("Column index out of range")}function g(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function w(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function p(t,e,r){return{row:d(t,e),column:y(t,r)}}function d(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some((e=>e<0||e>=t.rows)))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function y(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some((e=>e<0||e>=t.columns)))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function M(t,e,r,s,o){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(x("startRow",e),x("endRow",r),x("startColumn",s),x("endColumn",o),e>r||s>o||e<0||e>=t.rows||r<0||r>=t.rows||s<0||s>=t.columns||o<0||o>=t.columns)throw new RangeError("Submatrix indices are out of range")}function b(t,e=0){let r=[];for(let s=0;s<t;s++)r.push(e);return r}function x(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function E(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class v{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let s=new k(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++)s.set(o,t,r[o*e+t]);return s}static rowVector(t){let e=new k(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new k(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new k(t,e)}static ones(t,e){return new k(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:s=Math.random}=r;let o=new k(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)o.set(r,t,s());return o}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:s=0,max:o=1e3,random:n=Math.random}=r;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(s>=o)throw new RangeError("min must be smaller than max");let i=o-s,h=new k(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=s+Math.round(n()*i);h.set(r,t,e)}return h}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let s=Math.min(t,e),o=this.zeros(t,e);for(let t=0;t<s;t++)o.set(t,t,r);return o}static diag(t,e,r){let s=t.length;void 0===e&&(e=s),void 0===r&&(r=e);let o=Math.min(s,e,r),n=this.zeros(e,r);for(let e=0;e<o;e++)n.set(e,e,t[e]);return n}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,o=new k(r,s);for(let n=0;n<r;n++)for(let r=0;r<s;r++)o.set(n,r,Math.min(t.get(n,r),e.get(n,r)));return o}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,o=new this(r,s);for(let n=0;n<r;n++)for(let r=0;r<s;r++)o.set(n,r,Math.max(t.get(n,r),e.get(n,r)));return o}static checkMatrix(t){return v.isMatrix(t)?t:new k(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,s=!0,o=!1;for(;t<this.rows&&s;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(s=!1,o=!0);t++}return s}isReducedEchelonForm(){let t=0,e=0,r=-1,s=!0,o=!1;for(;t<this.rows&&s;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(s=!1,o=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let s=e;for(let o=e;o<t.rows;o++)t.get(o,r)>t.get(s,r)&&(s=o);if(0===t.get(s,r))r++;else{t.swapRows(e,s);let o=t.get(e,r);for(let s=r;s<t.columns;s++)t.set(e,s,t.get(e,s)/o);for(let s=e+1;s<t.rows;s++){let o=t.get(s,r)/t.get(e,r);t.set(s,r,0);for(let n=r+1;n<t.columns;n++)t.set(s,n,t.get(s,n)-t.get(e,n)*o)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,s=r-1;for(;s>=0;)if(0===t.maxRow(s))s--;else{let o=0,n=!1;for(;o<r&&!1===n;)1===t.get(s,o)?n=!0:o++;for(let r=0;r<s;r++){let n=t.get(r,o);for(let i=o;i<e;i++){let e=t.get(r,i)-n*t.get(s,i);t.set(r,i,e)}}s--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let s=new k(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)s.setSubMatrix(this,this.rows*t,this.columns*e);return s}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){f(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return k.rowVector(this.getRow(t))}setRow(t,e){f(this,t),e=g(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){f(this,t),f(this,e);for(let r=0;r<this.columns;r++){let s=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,s)}return this}getColumn(t){m(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return k.columnVector(this.getColumn(t))}setColumn(t,e){m(this,t),e=w(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){m(this,t),m(this,e);for(let r=0;r<this.rows;r++){let s=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,s)}return this}addRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=g(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=w(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){f(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){m(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){E(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}min(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){E(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}maxRow(t){if(f(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){f(this,t),E(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s),r[1]=s);return r}minRow(t){if(f(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){f(this,t),E(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s),r[1]=s);return r}maxColumn(t){if(m(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){m(this,t),E(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>e&&(e=this.get(s,t),r[0]=s);return r}minColumn(t){if(m(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){m(this,t),E(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<e&&(e=this.get(s,t),r[0]=s);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){v.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let s=0;s<e.length;s++)r+=e[s]*t[s];return r}mmul(t){t=k.checkMatrix(t);let e=this.rows,r=this.columns,s=t.columns,o=new k(e,s),n=new Float64Array(r);for(let i=0;i<s;i++){for(let e=0;e<r;e++)n[e]=t.get(e,i);for(let t=0;t<e;t++){let e=0;for(let s=0;s<r;s++)e+=this.get(t,s)*n[s];o.set(t,i,e)}}return o}strassen2x2(t){t=k.checkMatrix(t);let e=new k(2,2);const r=this.get(0,0),s=t.get(0,0),o=this.get(0,1),n=t.get(0,1),i=this.get(1,0),h=t.get(1,0),l=this.get(1,1),u=t.get(1,1),a=(r+l)*(s+u),c=(i+l)*s,f=r*(n-u),m=l*(h-s),g=(r+o)*u,w=a+m-g+(o-l)*(h+u),p=f+g,d=c+m,y=a-c+f+(i-r)*(s+n);return e.set(0,0,w),e.set(0,1,p),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=k.checkMatrix(t);let e=new k(3,3);const r=this.get(0,0),s=this.get(0,1),o=this.get(0,2),n=this.get(1,0),i=this.get(1,1),h=this.get(1,2),l=this.get(2,0),u=this.get(2,1),a=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),g=t.get(1,0),w=t.get(1,1),p=t.get(1,2),d=t.get(2,0),y=t.get(2,1),M=t.get(2,2),b=(r-n)*(-f+w),x=(-r+n+i)*(c-f+w),E=(n+i)*(-c+f),v=r*c,S=(-r+l+u)*(c-m+p),R=(-r+l)*(m-p),I=(l+u)*(-c+m),T=(-o+u+a)*(w+d-y),A=(o-a)*(w-y),q=o*d,C=(u+a)*(-d+y),P=(-o+i+h)*(p+d-M),V=(o-h)*(p-M),N=(i+h)*(-d+M),j=v+q+s*g,z=(r+s+o-n-i-u-a)*w+x+E+v+T+q+C,F=v+S+I+(r+s+o-i-h-l-u)*p+q+P+N,D=b+i*(-c+f+g-w-p-d+M)+x+v+q+P+V,H=b+x+E+v+h*y,_=q+P+V+N+n*m,$=v+S+R+u*(-c+m+g-w-p-d+y)+T+A+q,L=T+A+q+C+l*f,O=v+S+R+I+a*M;return e.set(0,0,j),e.set(0,1,z),e.set(0,2,F),e.set(1,0,D),e.set(1,1,H),e.set(1,2,_),e.set(2,0,$),e.set(2,1,L),e.set(2,2,O),e}mmulStrassen(t){t=k.checkMatrix(t);let e=this.clone(),r=e.rows,s=e.columns,o=t.rows,n=t.columns;function i(t,e,r){let s=t.rows,o=t.columns;if(s===e&&o===r)return t;{let s=v.zeros(e,r);return s=s.setSubMatrix(t,0,0),s}}s!==o&&console.warn(`Multiplying ${r} x ${s} and ${o} x ${n} matrix: dimensions do not match.`);let h=Math.max(r,o),l=Math.max(s,n);return e=i(e,h,l),function t(e,r,s,o){if(s<=512||o<=512)return e.mmul(r);s%2==1&&o%2==1?(e=i(e,s+1,o+1),r=i(r,s+1,o+1)):s%2==1?(e=i(e,s+1,o),r=i(r,s+1,o)):o%2==1&&(e=i(e,s,o+1),r=i(r,s,o+1));let n=parseInt(e.rows/2,10),h=parseInt(e.columns/2,10),l=e.subMatrix(0,n-1,0,h-1),u=r.subMatrix(0,n-1,0,h-1),a=e.subMatrix(0,n-1,h,e.columns-1),c=r.subMatrix(0,n-1,h,r.columns-1),f=e.subMatrix(n,e.rows-1,0,h-1),m=r.subMatrix(n,r.rows-1,0,h-1),g=e.subMatrix(n,e.rows-1,h,e.columns-1),w=r.subMatrix(n,r.rows-1,h,r.columns-1),p=t(v.add(l,g),v.add(u,w),n,h),d=t(v.add(f,g),u,n,h),y=t(l,v.sub(c,w),n,h),M=t(g,v.sub(m,u),n,h),b=t(v.add(l,a),w,n,h),x=t(v.sub(f,l),v.add(u,c),n,h),E=t(v.sub(a,g),v.add(m,w),n,h),S=v.add(p,M);S.sub(b),S.add(E);let k=v.add(y,b),R=v.add(d,M),I=v.sub(p,d);I.add(y),I.add(x);let T=v.zeros(2*S.rows,2*S.columns);return T=T.setSubMatrix(S,0,0),T=T.setSubMatrix(k,S.rows,0),T=T.setSubMatrix(R,0,S.columns),T=T.setSubMatrix(I,S.rows,S.columns),T.subMatrix(0,s-1,0,o-1)}(e,t=i(t,h,l),h,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let s=new k(this.rows,this.columns);for(let t=0;t<this.rows;t++){const o=this.getRow(t);o.length>0&&h(o,{min:e,max:r,output:o}),s.setRow(t,o)}return s}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let s=new k(this.rows,this.columns);for(let t=0;t<this.columns;t++){const o=this.getColumn(t);o.length&&h(o,{min:e,max:r,output:o}),s.setColumn(t,o)}return s}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),s=this.get(e,this.columns-1-r);this.set(e,r,s),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),s=this.get(this.rows-1-r,e);this.set(r,e,s),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=k.checkMatrix(t);let e=this.rows,r=this.columns,s=t.rows,o=t.columns,n=new k(e*s,r*o);for(let i=0;i<e;i++)for(let e=0;e<r;e++)for(let r=0;r<s;r++)for(let h=0;h<o;h++)n.set(s*i+r,o*e+h,this.get(i,e)*t.get(r,h));return n}transpose(){let t=new k(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=S){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=S){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,s){M(this,t,e,r,s);let o=new k(e-t+1,s-r+1);for(let n=t;n<=e;n++)for(let e=r;e<=s;e++)o.set(n-t,e-r,this.get(n,e));return o}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let s=new k(t.length,r-e+1);for(let o=0;o<t.length;o++)for(let n=e;n<=r;n++){if(t[o]<0||t[o]>=this.rows)throw new RangeError(`Row index out of range: ${t[o]}`);s.set(o,n-e,this.get(t[o],n))}return s}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let s=new k(r-e+1,t.length);for(let o=0;o<t.length;o++)for(let n=e;n<=r;n++){if(t[o]<0||t[o]>=this.columns)throw new RangeError(`Column index out of range: ${t[o]}`);s.set(n-e,o,this.get(n,t[o]))}return s}setSubMatrix(t,e,r){if((t=k.checkMatrix(t)).isEmpty())return this;M(this,e,e+t.rows-1,r,r+t.columns-1);for(let s=0;s<t.rows;s++)for(let o=0;o<t.columns;o++)this.set(e+s,r+o,t.get(s,o));return this}selection(t,e){let r=p(this,t,e),s=new k(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let o=0;o<r.column.length;o++){let n=r.column[o];s.set(t,o,this.get(e,n))}}return s}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new k(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=b(t.rows);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]+=t.get(r,s);return e}(this);case"column":return function(t){let e=b(t.columns);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]+=t.get(r,s);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e+=t.get(r,s);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=b(t.rows,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]*=t.get(r,s);return e}(this);case"column":return function(t){let e=b(t.columns,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]*=t.get(r,s);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e*=t.get(r,s);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:s=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(s))throw new TypeError("mean must be an array");return function(t,e,r){const s=t.rows,o=t.columns,n=[];for(let i=0;i<s;i++){let s=0,h=0,l=0;for(let e=0;e<o;e++)l=t.get(i,e)-r[i],s+=l,h+=l*l;e?n.push((h-s*s/o)/(o-1)):n.push((h-s*s/o)/o)}return n}(this,r,s);case"column":if(!Array.isArray(s))throw new TypeError("mean must be an array");return function(t,e,r){const s=t.rows,o=t.columns,n=[];for(let i=0;i<o;i++){let o=0,h=0,l=0;for(let e=0;e<s;e++)l=t.get(e,i)-r[i],o+=l,h+=l*l;e?n.push((h-o*o/s)/(s-1)):n.push((h-o*o/s)/s)}return n}(this,r,s);case void 0:if("number"!=typeof s)throw new TypeError("mean must be a number");return function(t,e,r){const s=t.rows,o=t.columns,n=s*o;let i=0,h=0,l=0;for(let e=0;e<s;e++)for(let s=0;s<o;s++)l=t.get(e,s)-r,i+=l,h+=l*l;return e?(h-i*i/n)/(n-1):(h-i*i/n)/n}(this,r,s);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e[s])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let s=0;for(let e=0;e<t.columns;e++)s+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(s))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let s=0;for(let e=0;e<t.rows;e++)s+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(s))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e[s])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let s=0;s<t.columns;s++)for(let o=0;o<t.rows;o++)r+=Math.pow(t.get(o,s),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return a(this,t)}}function S(t,e){return t-e}v.prototype.klass="Matrix","undefined"!=typeof Symbol&&(v.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return a(this)}),v.random=v.rand,v.randomInt=v.randInt,v.diagonal=v.diag,v.prototype.diagonal=v.prototype.diag,v.identity=v.eye,v.prototype.negate=v.prototype.neg,v.prototype.tensorProduct=v.prototype.kroneckerProduct;class k extends v{constructor(t,e){if(super(),k.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if("number"!=typeof(e=(t=r.length)?r[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<t;s++){if(r[s].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[s]))}}}this.rows=t,this.columns=e}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return f(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),f(this,t,!0),e=Float64Array.from(g(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){m(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let s=0;s<t;s++)r[s]=this.data[e][s];for(let s=t+1;s<this.columns;s++)r[s-1]=this.data[e][s];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),m(this,t,!0),e=w(this,e);for(let r=0;r<this.rows;r++){const s=new Float64Array(this.columns+1);let o=0;for(;o<t;o++)s[o]=this.data[r][o];for(s[o++]=e[r];o<this.columns+1;o++)s[o]=this.data[r][o-1];this.data[r]=s}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}(v,k);class R extends v{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class I extends R{constructor(t,e){m(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class T extends R{constructor(t,e){e=y(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}}class A extends R{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}}class q extends R{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}}class C extends R{constructor(t,e){f(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}}class P extends R{constructor(t,e){super(t,(e=d(t,e)).length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}}class V extends R{constructor(t,e,r){let s=p(t,e,r);super(t,s.row.length,s.column.length),this.rowIndices=s.row,this.columnIndices=s.column}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class N extends R{constructor(t,e,r,s,o){M(t,e,r,s,o),super(t,r-e+1,o-s+1),this.startRow=e,this.startColumn=s}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}}class j extends R{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class z extends v{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!=0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let s=this._calculateIndex(t,e);return this.data[s]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class F extends v{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}function D(t,e){if(Array.isArray(t))return t[0]&&Array.isArray(t[0])?new F(t):new z(t,e);throw new Error("the argument is not an array")}class H{constructor(t){let e,r,s,o,n,i,h,l,u,a=(t=F.checkMatrix(t)).clone(),c=a.rows,f=a.columns,m=new Float64Array(c),g=1;for(e=0;e<c;e++)m[e]=e;for(l=new Float64Array(c),r=0;r<f;r++){for(e=0;e<c;e++)l[e]=a.get(e,r);for(e=0;e<c;e++){for(u=Math.min(e,r),n=0,s=0;s<u;s++)n+=a.get(e,s)*l[s];l[e]-=n,a.set(e,r,l[e])}for(o=r,e=r+1;e<c;e++)Math.abs(l[e])>Math.abs(l[o])&&(o=e);if(o!==r){for(s=0;s<f;s++)i=a.get(o,s),a.set(o,s,a.get(r,s)),a.set(r,s,i);h=m[o],m[o]=m[r],m[r]=h,g=-g}if(r<c&&0!==a.get(r,r))for(e=r+1;e<c;e++)a.set(e,r,a.get(e,r)/a.get(r,r))}this.LU=a,this.pivotVector=m,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=k.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,s,o,n=t.columns,i=t.subMatrixRow(this.pivotVector,0,n-1),h=e.columns;for(o=0;o<h;o++)for(r=o+1;r<h;r++)for(s=0;s<n;s++)i.set(r,s,i.get(r,s)-i.get(o,s)*e.get(r,o));for(o=h-1;o>=0;o--){for(s=0;s<n;s++)i.set(o,s,i.get(o,s)/e.get(o,o));for(r=0;r<o;r++)for(s=0;s<n;s++)i.set(r,s,i.get(r,s)-i.get(o,s)*e.get(r,o))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let s=0;s<r;s++)e*=t.get(s,s);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,s=new k(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o>e?s.set(o,e,t.get(o,e)):o===e?s.set(o,e,1):s.set(o,e,0);return s}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,s=new k(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o<=e?s.set(o,e,t.get(o,e)):s.set(o,e,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function _(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class ${constructor(t){let e,r,s,o,n=(t=F.checkMatrix(t)).clone(),i=t.rows,h=t.columns,l=new Float64Array(h);for(s=0;s<h;s++){let t=0;for(e=s;e<i;e++)t=_(t,n.get(e,s));if(0!==t){for(n.get(s,s)<0&&(t=-t),e=s;e<i;e++)n.set(e,s,n.get(e,s)/t);for(n.set(s,s,n.get(s,s)+1),r=s+1;r<h;r++){for(o=0,e=s;e<i;e++)o+=n.get(e,s)*n.get(e,r);for(o=-o/n.get(s,s),e=s;e<i;e++)n.set(e,r,n.get(e,r)+o*n.get(e,s))}}l[s]=-t}this.QR=n,this.Rdiag=l}solve(t){t=k.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s,o,n,i,h=t.columns,l=t.clone(),u=e.columns;for(n=0;n<u;n++)for(o=0;o<h;o++){for(i=0,s=n;s<r;s++)i+=e.get(s,n)*l.get(s,o);for(i=-i/e.get(n,n),s=n;s<r;s++)l.set(s,o,l.get(s,o)+i*e.get(s,n))}for(n=u-1;n>=0;n--){for(o=0;o<h;o++)l.set(n,o,l.get(n,o)/this.Rdiag[n]);for(s=0;s<n;s++)for(o=0;o<h;o++)l.set(s,o,l.get(s,o)-l.get(n,o)*e.get(s,n))}return l.subMatrix(0,u-1,0,h-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,s=r.columns,o=new k(s,s);for(t=0;t<s;t++)for(e=0;e<s;e++)t<e?o.set(t,e,r.get(t,e)):t===e?o.set(t,e,this.Rdiag[t]):o.set(t,e,0);return o}get orthogonalMatrix(){let t,e,r,s,o=this.QR,n=o.rows,i=o.columns,h=new k(n,i);for(r=i-1;r>=0;r--){for(t=0;t<n;t++)h.set(t,r,0);for(h.set(r,r,1),e=r;e<i;e++)if(0!==o.get(r,r)){for(s=0,t=r;t<n;t++)s+=o.get(t,r)*h.get(t,e);for(s=-s/o.get(r,r),t=r;t<n;t++)h.set(t,e,h.get(t,e)+s*o.get(t,r))}}return h}}class L{constructor(t,e={}){if((t=F.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,s=t.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:n=!0,autoTranspose:i=!1}=e;let h,l=Boolean(o),u=Boolean(n),a=!1;if(r<s)if(i){h=t.transpose(),r=h.rows,s=h.columns,a=!0;let e=l;l=u,u=e}else h=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else h=t.clone();let c=Math.min(r,s),f=Math.min(r+1,s),m=new Float64Array(f),g=new k(r,c),w=new k(s,s),p=new Float64Array(s),d=new Float64Array(r),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let M=Math.min(r-1,s),b=Math.max(0,Math.min(s-2,r)),x=Math.max(M,b);for(let t=0;t<x;t++){if(t<M){m[t]=0;for(let e=t;e<r;e++)m[t]=_(m[t],h.get(e,t));if(0!==m[t]){h.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)h.set(e,t,h.get(e,t)/m[t]);h.set(t,t,h.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<s;e++){if(t<M&&0!==m[t]){let s=0;for(let o=t;o<r;o++)s+=h.get(o,t)*h.get(o,e);s=-s/h.get(t,t);for(let o=t;o<r;o++)h.set(o,e,h.get(o,e)+s*h.get(o,t))}p[e]=h.get(t,e)}if(l&&t<M)for(let e=t;e<r;e++)g.set(e,t,h.get(e,t));if(t<b){p[t]=0;for(let e=t+1;e<s;e++)p[t]=_(p[t],p[e]);if(0!==p[t]){p[t+1]<0&&(p[t]=0-p[t]);for(let e=t+1;e<s;e++)p[e]/=p[t];p[t+1]+=1}if(p[t]=-p[t],t+1<r&&0!==p[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<s;r++)d[e]+=p[r]*h.get(e,r);for(let e=t+1;e<s;e++){let s=-p[e]/p[t+1];for(let o=t+1;o<r;o++)h.set(o,e,h.get(o,e)+s*d[o])}}if(u)for(let e=t+1;e<s;e++)w.set(e,t,p[e])}}let E=Math.min(s,r+1);if(M<s&&(m[M]=h.get(M,M)),r<E&&(m[E-1]=0),b+1<E&&(p[b]=h.get(b,E-1)),p[E-1]=0,l){for(let t=M;t<c;t++){for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=M-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<c;e++){let s=0;for(let o=t;o<r;o++)s+=g.get(o,t)*g.get(o,e);s=-s/g.get(t,t);for(let o=t;o<r;o++)g.set(o,e,g.get(o,e)+s*g.get(o,t))}for(let e=t;e<r;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}}if(u)for(let t=s-1;t>=0;t--){if(t<b&&0!==p[t])for(let e=t+1;e<s;e++){let r=0;for(let o=t+1;o<s;o++)r+=w.get(o,t)*w.get(o,e);r=-r/w.get(t+1,t);for(let o=t+1;o<s;o++)w.set(o,e,w.get(o,e)+r*w.get(o,t))}for(let e=0;e<s;e++)w.set(e,t,0);w.set(t,t,1)}let v=E-1,S=0,R=Number.EPSILON;for(;E>0;){let t,e;for(t=E-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+R*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(p[t])<=e||Number.isNaN(p[t])){p[t]=0;break}}if(t===E-2)e=4;else{let r;for(r=E-1;r>=t&&r!==t;r--){let e=(r!==E?Math.abs(p[r]):0)+(r!==t+1?Math.abs(p[r-1]):0);if(Math.abs(m[r])<=R*e){m[r]=0;break}}r===t?e=3:r===E-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=p[E-2];p[E-2]=0;for(let r=E-2;r>=t;r--){let o=_(m[r],e),n=m[r]/o,i=e/o;if(m[r]=o,r!==t&&(e=-i*p[r-1],p[r-1]=n*p[r-1]),u)for(let t=0;t<s;t++)o=n*w.get(t,r)+i*w.get(t,E-1),w.set(t,E-1,-i*w.get(t,r)+n*w.get(t,E-1)),w.set(t,r,o)}break}case 2:{let e=p[t-1];p[t-1]=0;for(let s=t;s<E;s++){let o=_(m[s],e),n=m[s]/o,i=e/o;if(m[s]=o,e=-i*p[s],p[s]=n*p[s],l)for(let e=0;e<r;e++)o=n*g.get(e,s)+i*g.get(e,t-1),g.set(e,t-1,-i*g.get(e,s)+n*g.get(e,t-1)),g.set(e,s,o)}break}case 3:{const e=Math.max(Math.abs(m[E-1]),Math.abs(m[E-2]),Math.abs(p[E-2]),Math.abs(m[t]),Math.abs(p[t])),o=m[E-1]/e,n=m[E-2]/e,i=p[E-2]/e,h=m[t]/e,a=p[t]/e,c=((n+o)*(n-o)+i*i)/2,f=o*i*(o*i);let d=0;0===c&&0===f||(d=c<0?0-Math.sqrt(c*c+f):Math.sqrt(c*c+f),d=f/(c+d));let y=(h+o)*(h-o)+d,M=h*a;for(let e=t;e<E-1;e++){let o=_(y,M);0===o&&(o=Number.MIN_VALUE);let n=y/o,i=M/o;if(e!==t&&(p[e-1]=o),y=n*m[e]+i*p[e],p[e]=n*p[e]-i*m[e],M=i*m[e+1],m[e+1]=n*m[e+1],u)for(let t=0;t<s;t++)o=n*w.get(t,e)+i*w.get(t,e+1),w.set(t,e+1,-i*w.get(t,e)+n*w.get(t,e+1)),w.set(t,e,o);if(o=_(y,M),0===o&&(o=Number.MIN_VALUE),n=y/o,i=M/o,m[e]=o,y=n*p[e]+i*m[e+1],m[e+1]=-i*p[e]+n*m[e+1],M=i*p[e+1],p[e+1]=n*p[e+1],l&&e<r-1)for(let t=0;t<r;t++)o=n*g.get(t,e)+i*g.get(t,e+1),g.set(t,e+1,-i*g.get(t,e)+n*g.get(t,e+1)),g.set(t,e,o)}p[E-2]=y,S+=1;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,u))for(let e=0;e<=v;e++)w.set(e,t,-w.get(e,t));for(;t<v&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,u&&t<s-1)for(let r=0;r<s;r++)e=w.get(r,t+1),w.set(r,t+1,w.get(r,t)),w.set(r,t,e);if(l&&t<r-1)for(let s=0;s<r;s++)e=g.get(s,t+1),g.set(s,t+1,g.get(s,t)),g.set(s,t,e);t++}S=0,E--}}if(a){let t=w;w=g,g=t}this.m=r,this.n=s,this.s=m,this.U=g,this.V=w}solve(t){let e=t,r=this.threshold,s=this.s.length,o=k.zeros(s,s);for(let t=0;t<s;t++)Math.abs(this.s[t])<=r?o.set(t,t,0):o.set(t,t,1/this.s[t]);let n=this.U,i=this.rightSingularVectors,h=i.mmul(o),l=i.rows,u=n.rows,a=k.zeros(l,u);for(let t=0;t<l;t++)for(let e=0;e<u;e++){let r=0;for(let o=0;o<s;o++)r+=h.get(t,o)*n.get(e,o);a.set(t,e,r)}return a.mmul(e)}solveForDiagonal(t){return this.solve(k.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,s=t.columns,o=new k(r,this.s.length);for(let n=0;n<r;n++)for(let r=0;r<s;r++)Math.abs(this.s[r])>e&&o.set(n,r,t.get(n,r)/this.s[r]);let n=this.U,i=n.rows,h=n.columns,l=new k(r,i);for(let t=0;t<r;t++)for(let e=0;e<i;e++){let r=0;for(let s=0;s<h;s++)r+=o.get(t,s)*n.get(e,s);l.set(t,e,r)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let s=0,o=r.length;s<o;s++)r[s]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return k.diag(this.s)}}function O(t,e=!1){return t=F.checkMatrix(t),e?new L(t).inverse():U(t,k.eye(t.rows))}function U(t,e,r=!1){return t=F.checkMatrix(t),e=F.checkMatrix(e),r?new L(t).solve(e):t.isSquare()?new H(t).solve(e):new $(t).solve(e)}function X(t){if((t=k.checkMatrix(t)).isSquare()){if(0===t.columns)return 1;let e,r,s,o;if(2===t.columns)return e=t.get(0,0),r=t.get(0,1),s=t.get(1,0),o=t.get(1,1),e*o-r*s;if(3===t.columns){let o,n,i;return o=new V(t,[1,2],[1,2]),n=new V(t,[1,2],[0,2]),i=new V(t,[1,2],[0,1]),e=t.get(0,0),r=t.get(0,1),s=t.get(0,2),e*X(o)-r*X(n)+s*X(i)}return new H(t).determinant}throw Error("determinant can only be calculated for a square matrix")}function Y(t,e){let r=[];for(let s=0;s<t;s++)s!==e&&r.push(s);return r}function G(t,e,r,s=1e-9,o=1e-9){if(t>o)return new Array(e.rows+1).fill(0);{let t=e.addRow(r,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<s&&t.set(e,0,0);return t.to1DArray()}}function Q(t,e={}){const{thresholdValue:r=1e-9,thresholdError:s=1e-9}=e;let o=(t=k.checkMatrix(t)).rows,n=new k(o,o);for(let e=0;e<o;e++){let i=k.columnVector(t.getRow(e)),h=t.subMatrixRow(Y(o,e)).transpose(),l=new L(h).solve(i),u=k.sub(i,h.mmul(l)).abs().max();n.setRow(e,G(u,l,e,r,s))}return n}function W(t,e=Number.EPSILON){if((t=k.checkMatrix(t)).isEmpty())return t.transpose();let r=new L(t,{autoTranspose:!0}),s=r.leftSingularVectors,o=r.rightSingularVectors,n=r.diagonal;for(let t=0;t<n.length;t++)Math.abs(n[t])>e?n[t]=1/n[t]:n[t]=0;return o.mmul(k.diag(n).mmul(s.transpose()))}function B(t,e=t,r={}){t=new k(t);let s=!1;if("object"!=typeof e||k.isMatrix(e)||Array.isArray(e)?e=new k(e):(r=e,e=t,s=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=r;o&&(t=t.center("column"),s||(e=e.center("column")));const n=t.transpose().mmul(e);for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)*(1/(t.rows-1)));return n}function J(t,e=t,r={}){t=new k(t);let s=!1;if("object"!=typeof e||k.isMatrix(e)||Array.isArray(e)?e=new k(e):(r=e,e=t,s=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:n=!0}=r;o&&(t.center("column"),s||e.center("column")),n&&(t.scale("column"),s||e.scale("column"));const i=t.standardDeviation("column",{unbiased:!0}),h=s?i:e.standardDeviation("column",{unbiased:!0}),l=t.transpose().mmul(e);for(let e=0;e<l.rows;e++)for(let r=0;r<l.columns;r++)l.set(e,r,l.get(e,r)*(1/(i[e]*h[r]))*(1/(t.rows-1)));return l}class K{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(!(t=F.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let s,o,n=t.columns,i=new k(n,n),h=new Float64Array(n),l=new Float64Array(n),u=t,a=!1;if(a=!!r||t.isSymmetric(),a){for(s=0;s<n;s++)for(o=0;o<n;o++)i.set(s,o,u.get(s,o));!function(t,e,r,s){let o,n,i,h,l,u,a,c;for(l=0;l<t;l++)r[l]=s.get(t-1,l);for(h=t-1;h>0;h--){for(c=0,i=0,u=0;u<h;u++)c+=Math.abs(r[u]);if(0===c)for(e[h]=r[h-1],l=0;l<h;l++)r[l]=s.get(h-1,l),s.set(h,l,0),s.set(l,h,0);else{for(u=0;u<h;u++)r[u]/=c,i+=r[u]*r[u];for(o=r[h-1],n=Math.sqrt(i),o>0&&(n=-n),e[h]=c*n,i-=o*n,r[h-1]=o-n,l=0;l<h;l++)e[l]=0;for(l=0;l<h;l++){for(o=r[l],s.set(l,h,o),n=e[l]+s.get(l,l)*o,u=l+1;u<=h-1;u++)n+=s.get(u,l)*r[u],e[u]+=s.get(u,l)*o;e[l]=n}for(o=0,l=0;l<h;l++)e[l]/=i,o+=e[l]*r[l];for(a=o/(i+i),l=0;l<h;l++)e[l]-=a*r[l];for(l=0;l<h;l++){for(o=r[l],n=e[l],u=l;u<=h-1;u++)s.set(u,l,s.get(u,l)-(o*e[u]+n*r[u]));r[l]=s.get(h-1,l),s.set(h,l,0)}}r[h]=i}for(h=0;h<t-1;h++){if(s.set(t-1,h,s.get(h,h)),s.set(h,h,1),i=r[h+1],0!==i){for(u=0;u<=h;u++)r[u]=s.get(u,h+1)/i;for(l=0;l<=h;l++){for(n=0,u=0;u<=h;u++)n+=s.get(u,h+1)*s.get(u,l);for(u=0;u<=h;u++)s.set(u,l,s.get(u,l)-n*r[u])}}for(u=0;u<=h;u++)s.set(u,h+1,0)}for(l=0;l<t;l++)r[l]=s.get(t-1,l),s.set(t-1,l,0);s.set(t-1,t-1,1),e[0]=0}(n,l,h,i),function(t,e,r,s){let o,n,i,h,l,u,a,c,f,m,g,w,p,d,y,M,b;for(i=1;i<t;i++)e[i-1]=e[i];e[t-1]=0;let x=0,E=0,v=Number.EPSILON;for(u=0;u<t;u++){for(E=Math.max(E,Math.abs(r[u])+Math.abs(e[u])),a=u;a<t&&!(Math.abs(e[a])<=v*E);)a++;if(a>u){b=0;do{for(b+=1,o=r[u],c=(r[u+1]-o)/(2*e[u]),f=_(c,1),c<0&&(f=-f),r[u]=e[u]/(c+f),r[u+1]=e[u]*(c+f),m=r[u+1],n=o-r[u],i=u+2;i<t;i++)r[i]-=n;for(x+=n,c=r[a],g=1,w=g,p=g,d=e[u+1],y=0,M=0,i=a-1;i>=u;i--)for(p=w,w=g,M=y,o=g*e[i],n=g*c,f=_(c,e[i]),e[i+1]=y*f,y=e[i]/f,g=c/f,c=g*r[i]-y*o,r[i+1]=n+y*(g*o+y*r[i]),l=0;l<t;l++)n=s.get(l,i+1),s.set(l,i+1,y*s.get(l,i)+g*n),s.set(l,i,g*s.get(l,i)-y*n);c=-y*M*p*d*e[u]/m,e[u]=y*c,r[u]=g*c}while(Math.abs(e[u])>v*E)}r[u]=r[u]+x,e[u]=0}for(i=0;i<t-1;i++){for(l=i,c=r[i],h=i+1;h<t;h++)r[h]<c&&(l=h,c=r[h]);if(l!==i)for(r[l]=r[i],r[i]=c,h=0;h<t;h++)c=s.get(h,i),s.set(h,i,s.get(h,l)),s.set(h,l,c)}}(n,l,h,i)}else{let t=new k(n,n),e=new Float64Array(n);for(o=0;o<n;o++)for(s=0;s<n;s++)t.set(s,o,u.get(s,o));!function(t,e,r,s){let o,n,i,h,l,u,a,c=t-1;for(u=1;u<=c-1;u++){for(a=0,h=u;h<=c;h++)a+=Math.abs(e.get(h,u-1));if(0!==a){for(i=0,h=c;h>=u;h--)r[h]=e.get(h,u-1)/a,i+=r[h]*r[h];for(n=Math.sqrt(i),r[u]>0&&(n=-n),i-=r[u]*n,r[u]=r[u]-n,l=u;l<t;l++){for(o=0,h=c;h>=u;h--)o+=r[h]*e.get(h,l);for(o/=i,h=u;h<=c;h++)e.set(h,l,e.get(h,l)-o*r[h])}for(h=0;h<=c;h++){for(o=0,l=c;l>=u;l--)o+=r[l]*e.get(h,l);for(o/=i,l=u;l<=c;l++)e.set(h,l,e.get(h,l)-o*r[l])}r[u]=a*r[u],e.set(u,u-1,a*n)}}for(h=0;h<t;h++)for(l=0;l<t;l++)s.set(h,l,h===l?1:0);for(u=c-1;u>=1;u--)if(0!==e.get(u,u-1)){for(h=u+1;h<=c;h++)r[h]=e.get(h,u-1);for(l=u;l<=c;l++){for(n=0,h=u;h<=c;h++)n+=r[h]*s.get(h,l);for(n=n/r[u]/e.get(u,u-1),h=u;h<=c;h++)s.set(h,l,s.get(h,l)+n*r[h])}}}(n,t,e,i),function(t,e,r,s,o){let n,i,h,l,u,a,c,f,m,g,w,p,d,y,M,b=t-1,x=t-1,E=Number.EPSILON,v=0,S=0,k=0,R=0,I=0,T=0,A=0,q=0;for(n=0;n<t;n++)for((n<0||n>x)&&(r[n]=o.get(n,n),e[n]=0),i=Math.max(n-1,0);i<t;i++)S+=Math.abs(o.get(n,i));for(;b>=0;){for(l=b;l>0&&(T=Math.abs(o.get(l-1,l-1))+Math.abs(o.get(l,l)),0===T&&(T=S),!(Math.abs(o.get(l,l-1))<E*T));)l--;if(l===b)o.set(b,b,o.get(b,b)+v),r[b]=o.get(b,b),e[b]=0,b--,q=0;else if(l===b-1){if(c=o.get(b,b-1)*o.get(b-1,b),k=(o.get(b-1,b-1)-o.get(b,b))/2,R=k*k+c,A=Math.sqrt(Math.abs(R)),o.set(b,b,o.get(b,b)+v),o.set(b-1,b-1,o.get(b-1,b-1)+v),f=o.get(b,b),R>=0){for(A=k>=0?k+A:k-A,r[b-1]=f+A,r[b]=r[b-1],0!==A&&(r[b]=f-c/A),e[b-1]=0,e[b]=0,f=o.get(b,b-1),T=Math.abs(f)+Math.abs(A),k=f/T,R=A/T,I=Math.sqrt(k*k+R*R),k/=I,R/=I,i=b-1;i<t;i++)A=o.get(b-1,i),o.set(b-1,i,R*A+k*o.get(b,i)),o.set(b,i,R*o.get(b,i)-k*A);for(n=0;n<=b;n++)A=o.get(n,b-1),o.set(n,b-1,R*A+k*o.get(n,b)),o.set(n,b,R*o.get(n,b)-k*A);for(n=0;n<=x;n++)A=s.get(n,b-1),s.set(n,b-1,R*A+k*s.get(n,b)),s.set(n,b,R*s.get(n,b)-k*A)}else r[b-1]=f+k,r[b]=f+k,e[b-1]=A,e[b]=-A;b-=2,q=0}else{if(f=o.get(b,b),m=0,c=0,l<b&&(m=o.get(b-1,b-1),c=o.get(b,b-1)*o.get(b-1,b)),10===q){for(v+=f,n=0;n<=b;n++)o.set(n,n,o.get(n,n)-f);T=Math.abs(o.get(b,b-1))+Math.abs(o.get(b-1,b-2)),f=m=.75*T,c=-.4375*T*T}if(30===q&&(T=(m-f)/2,T=T*T+c,T>0)){for(T=Math.sqrt(T),m<f&&(T=-T),T=f-c/((m-f)/2+T),n=0;n<=b;n++)o.set(n,n,o.get(n,n)-T);v+=T,f=m=c=.964}for(q+=1,u=b-2;u>=l&&(A=o.get(u,u),I=f-A,T=m-A,k=(I*T-c)/o.get(u+1,u)+o.get(u,u+1),R=o.get(u+1,u+1)-A-I-T,I=o.get(u+2,u+1),T=Math.abs(k)+Math.abs(R)+Math.abs(I),k/=T,R/=T,I/=T,u!==l)&&!(Math.abs(o.get(u,u-1))*(Math.abs(R)+Math.abs(I))<E*(Math.abs(k)*(Math.abs(o.get(u-1,u-1))+Math.abs(A)+Math.abs(o.get(u+1,u+1)))));)u--;for(n=u+2;n<=b;n++)o.set(n,n-2,0),n>u+2&&o.set(n,n-3,0);for(h=u;h<=b-1&&(y=h!==b-1,h!==u&&(k=o.get(h,h-1),R=o.get(h+1,h-1),I=y?o.get(h+2,h-1):0,f=Math.abs(k)+Math.abs(R)+Math.abs(I),0!==f&&(k/=f,R/=f,I/=f)),0!==f);h++)if(T=Math.sqrt(k*k+R*R+I*I),k<0&&(T=-T),0!==T){for(h!==u?o.set(h,h-1,-T*f):l!==u&&o.set(h,h-1,-o.get(h,h-1)),k+=T,f=k/T,m=R/T,A=I/T,R/=k,I/=k,i=h;i<t;i++)k=o.get(h,i)+R*o.get(h+1,i),y&&(k+=I*o.get(h+2,i),o.set(h+2,i,o.get(h+2,i)-k*A)),o.set(h,i,o.get(h,i)-k*f),o.set(h+1,i,o.get(h+1,i)-k*m);for(n=0;n<=Math.min(b,h+3);n++)k=f*o.get(n,h)+m*o.get(n,h+1),y&&(k+=A*o.get(n,h+2),o.set(n,h+2,o.get(n,h+2)-k*I)),o.set(n,h,o.get(n,h)-k),o.set(n,h+1,o.get(n,h+1)-k*R);for(n=0;n<=x;n++)k=f*s.get(n,h)+m*s.get(n,h+1),y&&(k+=A*s.get(n,h+2),s.set(n,h+2,s.get(n,h+2)-k*I)),s.set(n,h,s.get(n,h)-k),s.set(n,h+1,s.get(n,h+1)-k*R)}}}if(0!==S){for(b=t-1;b>=0;b--)if(k=r[b],R=e[b],0===R)for(l=b,o.set(b,b,1),n=b-1;n>=0;n--){for(c=o.get(n,n)-k,I=0,i=l;i<=b;i++)I+=o.get(n,i)*o.get(i,b);if(e[n]<0)A=c,T=I;else if(l=n,0===e[n]?o.set(n,b,0!==c?-I/c:-I/(E*S)):(f=o.get(n,n+1),m=o.get(n+1,n),R=(r[n]-k)*(r[n]-k)+e[n]*e[n],a=(f*T-A*I)/R,o.set(n,b,a),o.set(n+1,b,Math.abs(f)>Math.abs(A)?(-I-c*a)/f:(-T-m*a)/A)),a=Math.abs(o.get(n,b)),E*a*a>1)for(i=n;i<=b;i++)o.set(i,b,o.get(i,b)/a)}else if(R<0)for(l=b-1,Math.abs(o.get(b,b-1))>Math.abs(o.get(b-1,b))?(o.set(b-1,b-1,R/o.get(b,b-1)),o.set(b-1,b,-(o.get(b,b)-k)/o.get(b,b-1))):(M=Z(0,-o.get(b-1,b),o.get(b-1,b-1)-k,R),o.set(b-1,b-1,M[0]),o.set(b-1,b,M[1])),o.set(b,b-1,0),o.set(b,b,1),n=b-2;n>=0;n--){for(g=0,w=0,i=l;i<=b;i++)g+=o.get(n,i)*o.get(i,b-1),w+=o.get(n,i)*o.get(i,b);if(c=o.get(n,n)-k,e[n]<0)A=c,I=g,T=w;else if(l=n,0===e[n]?(M=Z(-g,-w,c,R),o.set(n,b-1,M[0]),o.set(n,b,M[1])):(f=o.get(n,n+1),m=o.get(n+1,n),p=(r[n]-k)*(r[n]-k)+e[n]*e[n]-R*R,d=2*(r[n]-k)*R,0===p&&0===d&&(p=E*S*(Math.abs(c)+Math.abs(R)+Math.abs(f)+Math.abs(m)+Math.abs(A))),M=Z(f*I-A*g+R*w,f*T-A*w-R*g,p,d),o.set(n,b-1,M[0]),o.set(n,b,M[1]),Math.abs(f)>Math.abs(A)+Math.abs(R)?(o.set(n+1,b-1,(-g-c*o.get(n,b-1)+R*o.get(n,b))/f),o.set(n+1,b,(-w-c*o.get(n,b)-R*o.get(n,b-1))/f)):(M=Z(-I-m*o.get(n,b-1),-T-m*o.get(n,b),A,R),o.set(n+1,b-1,M[0]),o.set(n+1,b,M[1]))),a=Math.max(Math.abs(o.get(n,b-1)),Math.abs(o.get(n,b))),E*a*a>1)for(i=n;i<=b;i++)o.set(i,b-1,o.get(i,b-1)/a),o.set(i,b,o.get(i,b)/a)}for(n=0;n<t;n++)if(n<0||n>x)for(i=n;i<t;i++)s.set(n,i,o.get(n,i));for(i=t-1;i>=0;i--)for(n=0;n<=x;n++){for(A=0,h=0;h<=Math.min(i,x);h++)A+=s.get(n,h)*o.get(h,i);s.set(n,i,A)}}}(n,l,h,i,t)}this.n=n,this.e=l,this.d=h,this.V=i}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,r=this.n,s=this.e,o=this.d,n=new k(r,r);for(t=0;t<r;t++){for(e=0;e<r;e++)n.set(t,e,0);n.set(t,t,o[t]),s[t]>0?n.set(t,t+1,s[t]):s[t]<0&&n.set(t,t-1,s[t])}return n}}function Z(t,e,r,s){let o,n;return Math.abs(r)>Math.abs(s)?(o=s/r,n=r+o*s,[(t+o*e)/n,(e-o*t)/n]):(o=r/s,n=s+o*r,[(o*t+e)/n,(o*e-t)/n])}class tt{constructor(t){if(!(t=F.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,r,s,o=t,n=o.rows,i=new k(n,n),h=!0;for(r=0;r<n;r++){let t=0;for(s=0;s<r;s++){let n=0;for(e=0;e<s;e++)n+=i.get(s,e)*i.get(r,e);n=(o.get(r,s)-n)/i.get(s,s),i.set(r,s,n),t+=n*n}for(t=o.get(r,r)-t,h&=t>0,i.set(r,r,Math.sqrt(Math.max(t,0))),s=r+1;s<n;s++)i.set(r,s,0)}this.L=i,this.positiveDefinite=Boolean(h)}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=F.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let s,o,n,i=t.columns,h=t.clone();for(n=0;n<r;n++)for(o=0;o<i;o++){for(s=0;s<n;s++)h.set(n,o,h.get(n,o)-h.get(s,o)*e.get(n,s));h.set(n,o,h.get(n,o)/e.get(n,n))}for(n=r-1;n>=0;n--)for(o=0;o<i;o++){for(s=n+1;s<r;s++)h.set(n,o,h.get(n,o)-h.get(s,o)*e.get(s,n));h.set(n,o,h.get(n,o)/e.get(n,n))}return h}get lowerTriangularMatrix(){return this.L}}class et{constructor(t,e={}){t=F.checkMatrix(t);let{Y:r}=e;const{scaleScores:s=!1,maxIterations:o=1e3,terminationCriteria:n=1e-10}=e;let i;if(r){if(r=Array.isArray(r)&&"number"==typeof r[0]?k.columnVector(r):F.checkMatrix(r),!r.isColumnVector()||r.rows!==t.rows)throw new Error("Y must be a column vector of length X.rows");i=r}else i=t.getColumnVector(0);let h,l,u,a,c=1;for(let e=0;e<o&&c>n;e++)u=t.transpose().mmul(i).div(i.transpose().mmul(i).get(0,0)),u=u.div(u.norm()),h=t.mmul(u).div(u.transpose().mmul(u).get(0,0)),e>0&&(c=h.clone().sub(a).pow(2).sum()),a=h.clone(),r?(l=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),l=l.div(l.norm()),i=r.mmul(l).div(l.transpose().mmul(l).get(0,0))):i=h;if(r){let e=t.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));e=e.div(e.norm());let s=t.clone().sub(h.clone().mmul(e.transpose())),o=i.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),n=r.clone().sub(h.clone().mulS(o.get(0,0)).mmul(l.transpose()));this.t=h,this.p=e.transpose(),this.w=u.transpose(),this.q=l,this.u=i,this.s=h.transpose().mmul(h),this.xResidual=s,this.yResidual=n,this.betas=o}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),this.t=s?h.clone().div(this.s.get(0,0)):h,this.xResidual=t.sub(h.mmul(u.transpose()))}}},842:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});class s{constructor(t=[],e=o){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,s=e[t];for(;t>0;){const o=t-1>>1,n=e[o];if(r(s,n)>=0)break;e[t]=n,t=o}e[t]=s}_down(t){const{data:e,compare:r}=this,s=this.length>>1,o=e[t];for(;t<s;){let s=1+(t<<1),n=e[s];const i=s+1;if(i<this.length&&r(e[i],n)<0&&(s=i,n=e[i]),r(n,o)>=0)break;e[t]=n,t=s}e[t]=o}}function o(t,e){return t<e?-1:t>e?1:0}},902:(t,e,r)=>{const{Matrix:s,inverse:o}=r(331),{solveHomography:n}=r(450);t.exports={estimate:({screenCoords:t,worldCoords:e,projectionTransform:r})=>{const i=n(e.map((t=>[t.x,t.y])),t.map((t=>[t.x,t.y]))),h=new s([[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]]),l=new s(r),u=o(l).mmul(h).to1DArray(),a=Math.sqrt(u[0]*u[0]+u[3]*u[3]+u[6]*u[6]),c=Math.sqrt(u[1]*u[1]+u[4]*u[4]+u[7]*u[7]),f=(a+c)/2,m=[];m[0]=u[0]/a,m[3]=u[3]/a,m[6]=u[6]/a,m[1]=u[1]/c,m[4]=u[4]/c,m[7]=u[7]/c,m[2]=m[3]*m[7]-m[6]*m[4],m[5]=m[6]*m[1]-m[0]*m[7],m[8]=m[0]*m[4]-m[1]*m[3];const g=Math.sqrt(m[2]*m[2]+m[5]*m[5]+m[8]*m[8]);m[2]/=g,m[5]/=g,m[8]/=g;const w=[];return w[0]=u[2]/f,w[1]=u[5]/f,w[2]=u[8]/f,[[m[0],m[1],m[2],w[0]],[m[3],m[4],m[5],w[1]],[m[6],m[7],m[8],w[2]]]}}},421:(t,e,r)=>{const{estimate:s}=r(902),{refineEstimate:o}=r(269);t.exports={Estimator:class{constructor(t){this.projectionTransform=t}estimate({screenCoords:t,worldCoords:e}){return s({screenCoords:t,worldCoords:e,projectionTransform:this.projectionTransform})}refineEstimate({initialModelViewTransform:t,worldCoords:e,screenCoords:r}){return o({initialModelViewTransform:t,worldCoords:e,screenCoords:r,projectionTransform:this.projectionTransform})}}}},269:(t,e,r)=>{const{Matrix:s,inverse:o}=r(331),{normalizePoints:n,applyModelViewProjectionTransform:i,buildModelViewProjectionTransform:h,computeScreenCoordiate:l}=r(420);let u=[[],[],[]],a=[[],[]],c=[[],[],[]];const f=({initialModelViewTransform:t,projectionTransform:e,worldCoords:r,screenCoords:s,inlierProb:o})=>{const n=o<1;let i=t,u=0,a=0,c=new Array(r.length),f=new Array(r.length),p=new Array(r.length),d=new Array(r.length);for(let t=0;t<=10;t++){const y=h(e,i);for(let t=0;t<r.length;t++){const e=l(y,r[t].x,r[t].y,r[t].z),o=s[t].x-e.x,n=s[t].y-e.y;p[t]=o,d[t]=n,c[t]=o*o+n*n}let M;if(a=0,n){const t=Math.max(3,Math.floor(r.length*o)-1);for(let t=0;t<r.length;t++)f[t]=c[t];f.sort(((t,e)=>t-e)),M=Math.max(4*f[t],16);for(let t=0;t<r.length;t++)f[t]>M?a+=M/6:a+=M/6*(1-(1-f[t]/M)*(1-f[t]/M)*(1-f[t]/M))}else for(let t=0;t<r.length;t++)a+=c[t];if(a/=r.length,a<.1)break;if(t>0&&a/u>.99)break;if(10===t)break;u=a;const b=[],x=[];for(let t=0;t<r.length;t++){if(n&&c[t]>M)continue;const s=w({modelViewProjectionTransform:y,modelViewTransform:i,projectionTransform:e,worldCoord:r[t]});if(n){const e=(1-c[t]/M)*(1-c[t]/M);for(let t=0;t<2;t++)for(let r=0;r<6;r++)s[t][r]*=e;b.push([p[t]*e]),b.push([d[t]*e])}else b.push([p[t]]),b.push([d[t]]);for(let t=0;t<s.length;t++)x.push(s[t])}const E=g({dU:b,J_U_S:x});if(null===E)break;i=m({modelViewTransform:i,dS:E})}return{modelViewTransform:i,err:a}},m=({modelViewTransform:t,dS:e})=>{let r,s,o,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];n<1e-6?(r=1,s=0,o=0,n=0):(n=Math.sqrt(n),r=e[0]/n,s=e[1]/n,o=e[2]/n);const i=Math.cos(n),h=Math.sin(n),l=1-i;u[0][0]=r*r*l+i,u[0][1]=r*s*l-o*h,u[0][2]=r*o*l+s*h,u[0][3]=e[3],u[1][0]=s*r*l+o*h,u[1][1]=s*s*l+i,u[1][2]=s*o*l-r*h,u[1][3]=e[4],u[2][0]=o*r*l-s*h,u[2][1]=o*s*l+r*h,u[2][2]=o*o*l+i,u[2][3]=e[5];const a=[[],[],[]];for(let e=0;e<3;e++){for(let r=0;r<4;r++)a[e][r]=t[e][0]*u[0][r]+t[e][1]*u[1][r]+t[e][2]*u[2][r];a[e][3]+=t[e][3]}return a},g=({dU:t,J_U_S:e})=>{const r=new s(e),n=new s(t),i=r.transpose(),h=i.mmul(r),l=i.mmul(n);let u;try{u=o(h)}catch(t){return null}return u.mmul(l).to1DArray()},w=({modelViewProjectionTransform:t,modelViewTransform:e,projectionTransform:r,worldCoord:s})=>{const o=e,{x:n,y:h,z:l}=s,u=i(t,n,h,l),f=u.z*u.z;a[0][0]=r[0][0]*u.z/f,a[0][1]=r[0][1]*u.z/f,a[0][2]=(r[0][2]*u.z-r[2][2]*u.x)/f,a[1][0]=r[1][0]*u.z/f,a[1][1]=r[1][1]*u.z/f,a[1][2]=(r[1][2]*u.z-r[2][2]*u.y)/f,c[0][0]=o[0][2]*h,c[0][1]=-o[0][2]*n,c[0][2]=o[0][1]*n-o[0][0]*h,c[0][3]=o[0][0],c[0][4]=o[0][1],c[0][5]=o[0][2],c[1][0]=o[1][2]*h,c[1][1]=-o[1][2]*n,c[1][2]=o[1][1]*n-o[1][0]*h,c[1][3]=o[1][0],c[1][4]=o[1][1],c[1][5]=o[1][2],c[2][0]=o[2][2]*h,c[2][1]=-o[2][2]*n,c[2][2]=o[2][1]*n-o[2][0]*h,c[2][3]=o[2][0],c[2][4]=o[2][1],c[2][5]=o[2][2];const m=[[],[]];for(let t=0;t<2;t++)for(let e=0;e<6;e++){m[t][e]=0;for(let r=0;r<3;r++)m[t][e]+=a[t][r]*c[r][e]}return m};t.exports={refineEstimate:({initialModelViewTransform:t,projectionTransform:e,worldCoords:r,screenCoords:s})=>{let o=0,n=0;for(let t=0;t<r.length;t++)o+=r[t].x,n+=r[t].y;o/=r.length,n/=r.length;const i=[];for(let t=0;t<r.length;t++)i.push({x:r[t].x-o,y:r[t].y-n,z:r[t].z});const h=[[],[],[]];for(let e=0;e<3;e++)for(let r=0;r<3;r++)h[e][r]=t[e][r];h[0][3]=t[0][0]*o+t[0][1]*n+t[0][3],h[1][3]=t[1][0]*o+t[1][1]*n+t[1][3],h[2][3]=t[2][0]*o+t[2][1]*n+t[2][3];const l=[1,.8,.6,.4,0];let u=h,a=null;for(let t=0;t<l.length;t++){const r=f({initialModelViewTransform:u,projectionTransform:e,worldCoords:i,screenCoords:s,inlierProb:l[t]});if(u=r.modelViewTransform,r.err<5){a=u;break}}return null===a?null:(a[0][3]=a[0][3]-a[0][0]*o-a[0][1]*n,a[1][3]=a[1][3]-a[1][0]*o-a[1][1]*n,a[2][3]=a[2][3]-a[2][0]*o-a[2][1]*n,a)}}},420:t=>{const e=(t,e,r,s)=>({x:t[0][0]*e+t[0][1]*r+t[0][3],y:t[1][0]*e+t[1][1]*r+t[1][3],z:t[2][0]*e+t[2][1]*r+t[2][3]});t.exports={buildModelViewProjectionTransform:(t,e)=>[[t[0][0]*e[0][0]+t[0][2]*e[2][0],t[0][0]*e[0][1]+t[0][2]*e[2][1],t[0][0]*e[0][2]+t[0][2]*e[2][2],t[0][0]*e[0][3]+t[0][2]*e[2][3]],[t[1][1]*e[1][0]+t[1][2]*e[2][0],t[1][1]*e[1][1]+t[1][2]*e[2][1],t[1][1]*e[1][2]+t[1][2]*e[2][2],t[1][1]*e[1][3]+t[1][2]*e[2][3]],[e[2][0],e[2][1],e[2][2],e[2][3]]],applyModelViewProjectionTransform:e,computeScreenCoordiate:(t,r,s,o)=>{const{x:n,y:i,z:h}=e(t,r,s);return{x:n/h,y:i/h}}}},233:t=>{t.exports={compute:t=>{const{v1:e,v2:r}=t;let s=0;for(let t=0;t<e.length;t++){let i=(e[t]^r[t])>>>0;s+=(n=void 0,((n=((n=((n=((n=(o=i)-(o>>1&1431655765))>>2&858993459)+(858993459&n))>>4)+n&252645135)>>8)+n&16711935)>>16)+n&65535)}var o,n;return s}}},934:t=>{const e=({querypoint:t,keypoint:e,keycenterX:r,keycenterY:s,scaleOneOverLogK:o})=>{let n=t.angle-e.angle;n<=-Math.PI?n+=2*Math.PI:n>Math.PI&&(n-=2*Math.PI);const i=t.scale/e.scale,h=i*Math.cos(n),l=i*Math.sin(n),u=[h,-l,l,h],a=[u[0]*e.x+u[1]*e.y,u[2]*e.x+u[3]*e.y],c=t.x-a[0],f=t.y-a[1];return{x:u[0]*r+u[1]*s+c,y:u[2]*r+u[3]*s+f,angle:n,scale:Math.log(i)*o}};t.exports={computeHoughMatches:t=>{const{keywidth:r,keyheight:s,querywidth:o,queryheight:n,matches:i}=t,h=1.2*o,l=-h,u=1.2*n,a=-u,c=12,f=1/Math.log(10),m=Math.max(r,s),g=Math.floor(r/2),w=Math.floor(s/2),p=[];for(let t=0;t<i.length;t++){const e=i[t].querypoint.scale,r=i[t].keypoint.scale;0==r&&console.log("ERROR divide zero");const s=e/r;p.push(s*m)}p.sort(((t,e)=>t-e));const d=.25*p[Math.floor(p.length/2)-(p.length%2==0?1:0)-1],y=Math.max(5,Math.ceil((h-l)/d)),M=Math.max(5,Math.ceil((u-a)/d)),b=y*M,x=b*c,E=[],v=[],S={};for(let t=0;t<i.length;t++){const r=i[t].querypoint,s=i[t].keypoint,{x:o,y:n,scale:m,angle:p}=e({querypoint:r,keypoint:s,keycenterX:g,keycenterY:w,scaleOneOverLogK:f});if(o<l||o>=h||n<a||n>=u||p<=-Math.PI||p>Math.PI||m<-1||m>=1){E[t]=!1;continue}let d=y*(o-l)/(h-l),k=M*(n-a)/(u-a),R=c*(p+Math.PI)/(2*Math.PI),I=10*(m- -1)/2;v[t]={binX:d,binY:k,binAngle:R,binScale:I};let T=Math.floor(d-.5),A=Math.floor(k-.5),q=Math.floor(I-.5),C=(Math.floor(R-.5)+c)%c;if(T<0||T+1>=y||A<0||A+1>=M||q<0||q+1>=10)E[t]=!1;else{for(let t=0;t<2;t++){let e=T+t;for(let t=0;t<2;t++){let r=A+t;for(let t=0;t<2;t++){let s=(C+t)%c;for(let t=0;t<2;t++){const o=e+r*y+s*b+(q+t)*x;void 0===S[o]&&(S[o]=0),S[o]+=1}}}}E[t]=!0}}let k=0,R=-1;if(Object.keys(S).forEach((t=>{S[t]>k&&(k=S[t],R=t)})),k<3)return[];const I=Math.floor(R%x%b%y),T=Math.floor((R-I)%x%b/y),A=Math.floor((R-I-T*y)%x/b),q=Math.floor((R-I-T*y-A*b)/x),C=[];for(let t=0;t<i.length;t++){if(!E[t])continue;const e=v[t];if(Math.abs(e.binX-(I+.5))>=1)continue;if(Math.abs(e.binY-(T+.5))>=1)continue;if(Math.abs(e.binScale-(q+.5))>=1)continue;const r=Math.abs(e.binAngle-(A+.5));Math.min(r,c-r)>=1||C.push(i[t])}return C}}},582:(t,e,r)=>{const{match:s}=r(492);t.exports={Matcher:class{constructor(t,e,r=!1){this.queryWidth=t,this.queryHeight=e,this.debugMode=r}matchDetection(t,e){let r={frames:[]},o=null;for(let n=0;n<t.length;n++){const{H:i,matches:h,debugExtra:l}=s({keyframe:t[n],querypoints:e,querywidth:this.queryWidth,queryheight:this.queryHeight,debugMode:this.debugMode});r.frames.push(l),i&&(null===o||o.matches.length<h.length)&&(o={keyframeIndex:n,H:i,matches:h})}if(null===o)return{keyframeIndex:-1,debugExtra:r};const n=[],i=[],h=t[o.keyframeIndex];for(let t=0;t<o.matches.length;t++){const e=o.matches[t].querypoint,r=o.matches[t].keypoint;n.push({x:e.x,y:e.y}),i.push({x:(r.x+.5)/h.scale,y:(r.y+.5)/h.scale,z:0})}return{screenCoords:n,worldCoords:i,keyframeIndex:o.keyframeIndex,debugExtra:r}}}}},492:(t,e,r)=>{const s=r(842).Z,{compute:o}=r(233),{computeHoughMatches:n}=r(934),{computeHomography:i}=r(838),{multiplyPointHomographyInhomogenous:h,matrixInverse33:l}=r(289),u=({node:t,keypoints:e,querypoint:r,queue:s,keypointIndexes:n,numPop:i})=>{if(t.leaf){for(let e=0;e<t.pointIndexes.length;e++)n.push(t.pointIndexes[e]);return}const h=[];for(let s=0;s<t.children.length;s++){const n=t.children[s].centerPointIndex,i=o({v1:e[n].descriptors,v2:r.descriptors});h.push(i)}let l=Number.MAX_SAFE_INTEGER;for(let e=0;e<t.children.length;e++)l=Math.min(l,h[e]);for(let e=0;e<t.children.length;e++)h[e]!==l&&s.push({node:t.children[e],d:h[e]});for(let o=0;o<t.children.length;o++)h[o]===l&&u({node:t.children[o],keypoints:e,querypoint:r,queue:s,keypointIndexes:n,numPop:i});if(i<8&&s.length>0){const{node:t,d:o}=s.pop();u({node:t,keypoints:e,querypoint:r,queue:s,keypointIndexes:n,numPop:i+=1})}},a=t=>{const{H:e,matches:r,threshold:s}=t,o=s*s,n=[];for(let t=0;t<r.length;t++){const s=r[t].querypoint,i=r[t].keypoint,l=h([i.x,i.y],e);(l[0]-s.x)*(l[0]-s.x)+(l[1]-s.y)*(l[1]-s.y)<=o&&n.push(r[t])}return n};t.exports={match:({keyframe:t,querypoints:e,querywidth:r,queryheight:c,debugMode:f})=>{let m={};const g=[];for(let r=0;r<e.length;r++){const n=e[r],i=n.maxima?t.maximaPoints:t.minimaPoints;if(0===i.length)continue;const h=n.maxima?t.maximaPointsCluster.rootNode:t.minimaPointsCluster.rootNode,l=[],a=new s([],((t,e)=>t.d-e.d));u({node:h,keypoints:i,querypoint:n,queue:a,keypointIndexes:l,numPop:0});let c=-1,f=Number.MAX_SAFE_INTEGER,m=Number.MAX_SAFE_INTEGER;for(let t=0;t<l.length;t++){const e=i[l[t]],r=o({v1:e.descriptors,v2:n.descriptors});r<f?(m=f,f=r,c=l[t]):r<m&&(m=r)}-1!==c&&(m===Number.MAX_SAFE_INTEGER||1*f/m<.7)&&g.push({querypoint:n,keypoint:i[c]})}if(f&&(m.matches=g),g.length<6)return{debugExtra:m};const w=n({keywidth:t.width,keyheight:t.height,querywidth:r,queryheight:c,matches:g});f&&(m.houghMatches=w);const p=i({srcPoints:w.map((t=>[t.keypoint.x,t.keypoint.y])),dstPoints:w.map((t=>[t.querypoint.x,t.querypoint.y])),keyframe:t});if(null===p)return{debugExtra:m};const d=a({H:p,matches:w,threshold:3});if(f&&(m.inlierMatches=d),d.length<6)return{debugExtra:m};const y=l(p,1e-5),M=[];for(let r=0;r<e.length;r++){const s=e[r],n=h([s.x,s.y],y);let i=-1,l=Number.MAX_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER;const a=s.maxima?t.maximaPoints:t.minimaPoints;for(let t=0;t<a.length;t++){const e=a[t];if((e.x-n[0])*(e.x-n[0])+(e.y-n[1])*(e.y-n[1])>100)continue;const r=o({v1:e.descriptors,v2:s.descriptors});r<l?(u=l,l=r,i=t):r<u&&(u=r)}-1!==i&&(u===Number.MAX_SAFE_INTEGER||1*l/u<.7)&&M.push({querypoint:s,keypoint:a[i]})}f&&(m.matches2=M);const b=n({keywidth:t.width,keyheight:t.height,querywidth:r,queryheight:c,matches:M});f&&(m.houghMatches2=b);const x=i({srcPoints:b.map((t=>[t.keypoint.x,t.keypoint.y])),dstPoints:b.map((t=>[t.querypoint.x,t.querypoint.y])),keyframe:t});if(null===x)return{debugExtra:m};const E=a({H:x,matches:b,threshold:3});return f&&(m.inlierMatches2=E),{H:x,matches:E,debugExtra:m}}}},838:(t,e,r)=>{const{Matrix:s,inverse:o}=r(331),{createRandomizer:n}=r(48),{quadrilateralConvex:i,matrixInverse33:h,smallestTriangleArea:l,multiplyPointHomographyInhomogenous:u,checkThreePointsConsistent:a,checkFourPointsConsistent:c,determinant:f}=r(289),{solveHomography:m}=r(450),g=({H:t,testPoints:e,keyframe:r})=>{const s=h(t,1e-5);if(null===s)return!1;const o=[];for(let t=0;t<e.length;t++)o.push(u(e[t],s));return!(l(o[0],o[1],o[2],o[3])<r.width*r.height*1e-4||!i(o[0],o[1],o[2],o[3]))},w=({inH:t})=>{const e=1/t[8],r=[];for(let s=0;s<8;s++)r[s]=t[s]*e;return r[8]=1,r},p=({H:t,srcPoint:e,dstPoint:r,oneOverScale2:s})=>{const o=u(e,t),n=[o[0]-r[0],o[1]-r[1]];return Math.log(1+(n[0]*n[0]+n[1]*n[1])*s)},d=({H:t,testPoints:e})=>{const r=[];for(let s=0;s<e.length;s++)r[s]=u(e[s],t);for(let t=0;t<e.length;t++){const s=t,o=(t+1)%e.length,n=(t+2)%e.length;if(!a(e[s],e[o],e[n],r[s],r[o],r[n]))return!1}return!0};t.exports={computeHomography:t=>{const{srcPoints:e,dstPoints:r,keyframe:s,quickMode:o}=t,i=[[0,0],[s.width,0],[s.width,s.height],[0,s.height]];if(e.length<4)return null;const h=Math.min(10,e.length),l=n(),u=[];for(let t=0;t<e.length;t++)u[t]=t;l.arrayShuffle({arr:u,sampleSize:u.length});const a=o?10:20,f=2*a;let y=0;const M=[];for(;y<f&&M.length<a;){if(y+=1,l.arrayShuffle({arr:u,sampleSize:4}),!c(e[u[0]],e[u[1]],e[u[2]],e[u[3]],r[u[0]],r[u[1]],r[u[2]],r[u[3]]))continue;const t=m([e[u[0]],e[u[1]],e[u[2]],e[u[3]]],[r[u[0]],r[u[1]],r[u[2]],r[u[3]]]);null!==t&&d({H:t,testPoints:i})&&M.push(t)}if(0===M.length)return null;const b=[];for(let t=0;t<M.length;t++)b.push({H:M[t],cost:0});let x=h;for(let t=0;t<e.length&&b.length>2;t+=x){x=Math.min(h,e.length-t);let s=t+x;for(let o=0;o<b.length;o++)for(let n=t;n<s;n++){const t=p({H:b[o].H,srcPoint:e[n],dstPoint:r[n],oneOverScale2:1e4});b[o].cost+=t}b.sort(((t,e)=>t.cost-e.cost)),b.splice(-Math.floor((b.length+1)/2))}let E=null;for(let t=0;t<b.length;t++){const e=w({inH:b[t].H});if(g({H:e,testPoints:i,keyframe:s})){E=e;break}}return E}}},289:t=>{const e=(t,e,r)=>(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0]),r=t=>{const e=t[4]*t[8]-t[5]*t[7],r=t[3]*t[8]-t[5]*t[6],s=t[3]*t[7]-t[4]*t[6];return t[0]*e-t[1]*r+t[2]*s},s=(t,e)=>[t[0]-e[0],t[1]-e[1]],o=(t,e)=>{const r=t[0]*e[1]-t[1]*e[0];return.5*Math.abs(r)};t.exports={matrixInverse33:(t,e)=>{const s=r(t);if(Math.abs(s)<=e)return null;const o=1/s;return[(t[4]*t[8]-t[5]*t[7])*o,(t[2]*t[7]-t[1]*t[8])*o,(t[1]*t[5]-t[2]*t[4])*o,(t[5]*t[6]-t[3]*t[8])*o,(t[0]*t[8]-t[2]*t[6])*o,(t[2]*t[3]-t[0]*t[5])*o,(t[3]*t[7]-t[4]*t[6])*o,(t[1]*t[6]-t[0]*t[7])*o,(t[0]*t[4]-t[1]*t[3])*o]},matrixMul33:(t,e)=>{const r=[];return r[0]=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],r[1]=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],r[2]=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],r[3]=t[3]*e[0]+t[4]*e[3]+t[5]*e[6],r[4]=t[3]*e[1]+t[4]*e[4]+t[5]*e[7],r[5]=t[3]*e[2]+t[4]*e[5]+t[5]*e[8],r[6]=t[6]*e[0]+t[7]*e[3]+t[8]*e[6],r[7]=t[6]*e[1]+t[7]*e[4]+t[8]*e[7],r[8]=t[6]*e[2]+t[7]*e[5]+t[8]*e[8],r},quadrilateralConvex:(t,r,s,o)=>{const n=e(t,r,s)<=0;return e(r,s,o)<=0===n&&e(s,o,t)<=0===n&&e(o,t,r)<=0===n},smallestTriangleArea:(t,e,r,n)=>{const i=s(e,t),h=s(r,t),l=s(n,t),u=s(e,r),a=s(n,r),c=o(i,h),f=o(h,l),m=o(i,l),g=o(u,a);return Math.min(Math.min(Math.min(c,f),m),g)},multiplyPointHomographyInhomogenous:(t,e)=>{const r=e[6]*t[0]+e[7]*t[1]+e[8],s=[];return s[0]=(e[0]*t[0]+e[1]*t[1]+e[2])/r,s[1]=(e[3]*t[0]+e[4]*t[1]+e[5])/r,s},checkThreePointsConsistent:(t,r,s,o,n,i)=>e(t,r,s)>0==e(o,n,i)>0,checkFourPointsConsistent:(t,r,s,o,n,i,h,l)=>e(t,r,s)>0==e(n,i,h)>0&&e(r,s,o)>0==e(i,h,l)>0&&e(s,o,t)>0==e(h,l,n)>0&&e(o,t,r)>0==e(l,n,i)>0,determinant:r}},450:(t,e,r)=>{const{Matrix:s,inverse:o}=r(331),n=t=>{let e=0,r=0;for(let s=0;s<t.length;s++)e+=t[s][0],r+=t[s][1];let s=e/t.length,o=r/t.length,n=0;for(let e=0;e<t.length;e++){const r=t[e][0]-s,i=t[e][1]-o;n+=Math.sqrt(r*r+i*i)}let i=Math.sqrt(2)*t.length/n;const h=[];for(let e=0;e<t.length;e++)h.push([(t[e][0]-s)*i,(t[e][1]-o)*i]);return{normPoints:h,param:{meanX:s,meanY:o,s:i}}};t.exports={solveHomography:(t,e)=>{const{normPoints:r,param:i}=n(t),{normPoints:h,param:l}=n(e),u=h.length,a=[],c=[];for(let t=0;t<u;t++){const e=[r[t][0],r[t][1],1,0,0,0,-r[t][0]*h[t][0],-r[t][1]*h[t][0]],s=[0,0,0,r[t][0],r[t][1],1,-r[t][0]*h[t][1],-r[t][1]*h[t][1]];a.push(e),a.push(s),c.push([h[t][0]]),c.push([h[t][1]])}try{const t=new s(a),e=new s(c),r=t.transpose(),n=r.mmul(t),h=r.mmul(e);return((t,e,r)=>{const s=r.s*r.meanX,o=r.s*r.meanY,n=[t[0]+s*t[6],t[1]+s*t[7],(t[0]+s*t[6])*-e.meanX+(t[1]+s*t[7])*-e.meanY+(t[2]+s)/e.s,t[3]+o*t[6],t[4]+o*t[7],(t[3]+o*t[6])*-e.meanX+(t[4]+o*t[7])*-e.meanY+(t[5]+o)/e.s,r.s*t[6],r.s*t[7],r.s*t[6]*-e.meanX+r.s*t[7]*-e.meanY+r.s/e.s];for(let t=0;t<9;t++)n[t]=n[t]/n[8];return n})(o(n).mmul(h).to1DArray(),i,l)}catch(t){return null}}}},48:t=>{t.exports={createRandomizer:()=>({seed:1234,arrayShuffle(t){const{arr:e,sampleSize:r}=t;for(let t=0;t<r;t++){this.seed=(214013*this.seed+2531011)%(1<<31);let r=this.seed>>16&32767;r%=e.length;let s=e[t];e[t]=e[r],e[r]=s}},nextInt(t){this.seed=(214013*this.seed+2531011)%(1<<31);let e=this.seed>>16&32767;return e%=t,e}})}}},e={};function r(s){if(e[s])return e[s].exports;var o=e[s]={exports:{}};return t[s](o,o.exports,r),o.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const{Matcher:t}=r(582),{Estimator:e}=r(421);let s=null,o=null,n=!1,i=null,h=null;onmessage=r=>{const{data:l}=r;if("setup"===l.type)s=l.projectionTransform,o=l.matchingDataList,n=l.debugMode,i=new t(l.inputWidth,l.inputHeight,n),h=new e(l.projectionTransform);else if("match"===l.type){const t=l.targetIndexes;let e=-1,r=null,s=null;for(let n=0;n<t.length;n++){const u=t[n],{keyframeIndex:a,screenCoords:c,worldCoords:f,debugExtra:m}=i.matchDetection(o[u],l.featurePoints);if(s=m,-1!==a){const t=h.estimate({screenCoords:c,worldCoords:f});t&&(e=u,r=t);break}}postMessage({type:"matchDone",targetIndex:e,modelViewTransform:r,debugExtra:s})}else if("trackUpdate"===l.type){const{modelViewTransform:t,worldCoords:e,screenCoords:r}=l,s=h.refineEstimate({initialModelViewTransform:t,worldCoords:e,screenCoords:r});postMessage({type:"trackUpdateDone",modelViewTransform:s})}}})()})();',ae.p+"controller.worker.prod.js")}},9855:V=>{"use strict";var re=window.URL||window.webkitURL;V.exports=function(ae,E){try{try{var z;try{(z=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(ae),z=z.getBlob()}catch{z=new Blob([ae])}return new Worker(re.createObjectURL(z))}catch{return new Worker("data:application/javascript,"+encodeURIComponent(ae))}}catch{if(!E)throw Error("Inline worker is not supported");return new Worker(E)}}},5217:(V,re,ae)=>{let E=ae(383),{Detector:z}=ae(6416),{buildImageList:P,buildTrackingImageList:L}=ae(7508),{build:k}=ae(723),C=ae(1113),M=ae(4563),I=async(b,T)=>{let A=[];for(let _=0;_<b.length;_++){let D=b[_],B=new z(D.width,D.height);await M.nextFrame(),M.tidy(()=>{let $=M.tensor(D.data,[D.data.length],"float32").reshape([D.height,D.width]),{featurePoints:j}=B.detect($),q=j.filter(Se=>Se.maxima),Q=j.filter(Se=>!Se.maxima),ue=k({points:q}),xe=k({points:Q});A.push({maximaPoints:q,minimaPoints:Q,maximaPointsCluster:ue,minimaPointsCluster:xe,width:D.width,height:D.height,scale:D.scale}),T(_)})}return A};V.exports={Compiler:class{constructor(){this.data=null}compileImageTargets(b,T){return new Promise(async(A,_)=>{let D=[];for(let q=0;q<b.length;q++){let Q=b[q],ue=document.createElement("canvas");ue.width=Q.width,ue.height=Q.height;let xe=ue.getContext("2d");xe.drawImage(Q,0,0,Q.width,Q.height);let Se=xe.getImageData(0,0,Q.width,Q.height),be=new Uint8Array(Q.width*Q.height);for(let we=0;we<be.length;we++){let he=4*we;be[we]=Math.floor((Se.data[he]+Se.data[he+1]+Se.data[he+2])/3)}let pe={data:be,height:Q.height,width:Q.width};D.push(pe)}let B=50/D.length,$=0;this.data=[];for(let q=0;q<D.length;q++){let Q=D[q],ue=P(Q),xe=B/ue.length,Se=await I(ue,()=>{$+=xe,T($)});this.data.push({targetImage:Q,imageList:ue,matchingData:Se})}for(let q=0;q<D.length;q++){let Q=L(D[q]);this.data[q].trackingImageList=Q}let j=await new Promise((q,Q)=>{let ue=new E;ue.onmessage=xe=>{xe.data.type==="progress"?T(50+xe.data.percent):xe.data.type==="compileDone"&&q(xe.data.list)},ue.postMessage({type:"compile",targetImages:D})});for(let q=0;q<D.length;q++)this.data[q].trackingData=j[q];A(this.data)})}exportData(){let b=[];for(let T=0;T<this.data.length;T++)b.push({targetImage:{width:this.data[T].targetImage.width,height:this.data[T].targetImage.height},trackingData:this.data[T].trackingData,matchingData:this.data[T].matchingData});return C.encode({v:2,dataList:b})}importData(b){let T=C.decode(new Uint8Array(b));if(!T.v||T.v!==2)return console.error("Your compiled .mind might be outdated. Please recompile"),[];let{dataList:A}=T;this.data=[];for(let _=0;_<A.length;_++)this.data.push({targetImage:A[_].targetImage,trackingData:A[_].trackingData,matchingData:A[_].matchingData});return this.data}}}},7957:(V,re,ae)=>{let E=ae(4563),z=ae(1077),{Tracker:P}=ae(6417),{CropDetector:L}=ae(7051),{Compiler:k}=ae(5217),{InputLoader:C}=ae(7325),{OneEuroFilter:M}=ae(344);V.exports={Controller:class{constructor({inputWidth:I,inputHeight:b,onUpdate:T=null,debugMode:A=!1,maxTrack:_=1,warmupTolerance:D=null,missTolerance:B=null,filterMinCF:$=null,filterBeta:j=null}){this.inputWidth=I,this.inputHeight=b,this.maxTrack=_,this.filterMinCF=$===null?.001:$,this.filterBeta=j===null?1e3:j,this.warmupTolerance=D===null?5:D,this.missTolerance=B===null?5:B,this.cropDetector=new L(this.inputWidth,this.inputHeight,A),this.inputLoader=new C(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=T,this.debugMode=A,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];let q=45*Math.PI/180,Q=this.inputHeight/2/Math.tan(q/2);this.projectionTransform=[[Q,0,this.inputWidth/2],[0,Q,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:10,far:1e5}),this.worker=new z,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=ue=>{ue.data.type==="matchDone"&&this.workerMatchDone!==null&&this.workerMatchDone(ue.data),ue.data.type==="trackUpdateDone"&&this.workerTrackDone!==null&&this.workerTrackDone(ue.data)}}showTFStats(){console.log(E.memory().numTensors),console.table(E.memory())}addImageTargets(I){return new Promise(async(b,T)=>{let A=await fetch(I),_=await A.arrayBuffer();b(this.addImageTargetsFromBuffer(_))})}addImageTargetsFromBuffer(I){let b=new k().importData(I),T=[],A=[],_=[];for(let D=0;D<b.length;D++)A.push(b[D].matchingData),T.push(b[D].trackingData),_.push([b[D].targetImage.width,b[D].targetImage.height]);return this.tracker=new P(_,T,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:A}),this.markerDimensions=_,{dimensions:_,matchingDataList:A,trackingDataList:T}}dummyRun(I){let b=this.inputLoader.loadInput(I);this.cropDetector.detect(b),this.tracker.dummyRun(b),b.dispose()}getProjectionMatrix(){return this.projectionMatrix}getWorldMatrix(I,b){return this._glModelViewMatrix(I,b)}async _detectAndMatch(I,b){let{featurePoints:T}=this.cropDetector.detectMoving(I),{targetIndex:A,modelViewTransform:_}=await this._workerMatch(T,b);return{targetIndex:A,modelViewTransform:_}}async _trackAndUpdate(I,b,T){let{worldCoords:A,screenCoords:_}=this.tracker.track(I,b,T);return A.length<4?null:await this._workerTrackUpdate(b,{worldCoords:A,screenCoords:_})}processVideo(I){if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(let b=0;b<this.markerDimensions.length;b++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new M({minCutOff:this.filterMinCF,beta:this.filterBeta})});(async()=>{for(;this.processingVideo;){let b=this.inputLoader.loadInput(I);if(this.trackingStates.reduce((T,A)=>T+(A.isTracking?1:0),0)<this.maxTrack){let T=[];for(let D=0;D<this.trackingStates.length;D++)this.trackingStates[D].isTracking!==!0&&(this.interestedTargetIndex!==-1&&this.interestedTargetIndex!==D||T.push(D));let{targetIndex:A,modelViewTransform:_}=await this._detectAndMatch(b,T);A!==-1&&(this.trackingStates[A].isTracking=!0,this.trackingStates[A].currentModelViewTransform=_)}for(let T=0;T<this.trackingStates.length;T++){let A=this.trackingStates[T];if(A.isTracking){let _=await this._trackAndUpdate(b,A.currentModelViewTransform,T);_===null?A.isTracking=!1:A.currentModelViewTransform=_}if(A.showing||A.isTracking&&(A.trackMiss=0,A.trackCount+=1,A.trackCount>this.warmupTolerance&&(A.showing=!0,A.trackingMatrix=null,A.filter.reset())),A.showing&&(A.isTracking?A.trackMiss=0:(A.trackCount=0,A.trackMiss+=1,A.trackMiss>this.missTolerance&&(A.showing=!1,A.trackingMatrix=null,this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:T,worldMatrix:null})))),A.showing){let _=this._glModelViewMatrix(A.currentModelViewTransform,T);A.trackingMatrix=A.filter.filter(Date.now(),_);let D=[];for(let B=0;B<A.trackingMatrix.length;B++)D[B]=A.trackingMatrix[B];this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:T,worldMatrix:D})}}b.dispose(),this.onUpdate&&this.onUpdate({type:"processDone"}),await E.nextFrame()}})()}}stopProcessVideo(){this.processingVideo=!1}async detect(I){let b=this.inputLoader.loadInput(I),{featurePoints:T,debugExtra:A}=await this.cropDetector.detect(b);return b.dispose(),{featurePoints:T,debugExtra:A}}async match(I,b){let{modelViewTransform:T,debugExtra:A}=await this._workerMatch(I,[b]);return{modelViewTransform:T,debugExtra:A}}async track(I,b,T){let A=this.inputLoader.loadInput(I),_=this.tracker.track(A,b,T);return A.dispose(),_}async trackUpdate(I,b){return b.worldCoords.length<4?null:await this._workerTrackUpdate(I,b)}_workerMatch(I,b){return new Promise(async(T,A)=>{this.workerMatchDone=_=>{T({targetIndex:_.targetIndex,modelViewTransform:_.modelViewTransform,debugExtra:_.debugExtra})},this.worker.postMessage({type:"match",featurePoints:I,targetIndexes:b})})}_workerTrackUpdate(I,b){return new Promise(async(T,A)=>{this.workerTrackDone=B=>{T(B.modelViewTransform)};let{worldCoords:_,screenCoords:D}=b;this.worker.postMessage({type:"trackUpdate",modelViewTransform:I,worldCoords:_,screenCoords:D})})}_glModelViewMatrix(I,b){let T=this.markerDimensions[b][1];return[I[0][0],-I[1][0],-I[2][0],0,-I[0][1],I[1][1],I[2][1],0,-I[0][2],I[1][2],I[2][2],0,I[0][1]*T+I[0][3],-(I[1][1]*T+I[1][3]),-(I[2][1]*T+I[2][3]),1]}_glProjectionMatrix({projectionTransform:I,width:b,height:T,near:A,far:_}){let D=[[2*I[0][0]/b,0,-(2*I[0][2]/b-1),0],[0,2*I[1][1]/T,-(2*I[1][2]/T-1),0],[0,0,-(_+A)/(_-A),-2*_*A/(_-A)],[0,0,-1,0]],B=[];for(let $=0;$<4;$++)for(let j=0;j<4;j++)B.push(D[j][$]);return B}}}},7051:(V,re,ae)=>{ae(4563);let{Detector:E}=ae(6416),{buildModelViewProjectionTransform:z,computeScreenCoordiate:P}=ae(7420);V.exports={CropDetector:class{constructor(L,k,C=!1){this.debugMode=C,this.width=L,this.height=k;let M=Math.min(L,k)/2,I=Math.pow(2,Math.round(Math.log(M)/Math.log(2)));this.cropSize=I,this.detector=new E(I,I,C),this.kernelCaches={},this.lastRandomIndex=4}detect(L){let k=Math.floor(this.height/2-this.cropSize/2),C=Math.floor(this.width/2-this.cropSize/2),M=this._detect(L,C,k);return this.debugMode&&(M.debugExtra.crop={startX:C,startY:k,cropSize:this.cropSize}),M}detectMoving(L){let k=this.lastRandomIndex%3,C=Math.floor(this.lastRandomIndex/3),M=Math.floor(this.height/2-this.cropSize+C*this.cropSize/2),I=Math.floor(this.width/2-this.cropSize+k*this.cropSize/2);return I<0&&(I=0),M<0&&(M=0),I>=this.width-this.cropSize&&(I=this.width-this.cropSize-1),M>=this.height-this.cropSize&&(M=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(L,I,M)}_detect(L,k,C){let M=L.slice([C,k],[this.cropSize,this.cropSize]),{featurePoints:I,debugExtra:b}=this.detector.detect(M);return I.forEach(T=>{T.x+=k,T.y+=C}),this.debugMode&&(b.projectedImage=M.arraySync()),M.dispose(),{featurePoints:I,debugExtra:b}}}}},6416:(V,re,ae)=>{let E=ae(4563),{FREAKPOINTS:z}=ae(2793),P=(z.length-1)*z.length/2;V.exports={Detector:class{constructor(L,k,C=!1){this.debugMode=C,this.width=L,this.height=k;let M=0;for(;L>=8&&k>=8&&(L/=2,k/=2,M++,M!==5););this.numOctaves=M,this.tensorCaches={},this.kernelCaches={}}detectImageData(L){let k=new Uint8ClampedArray(4*L.length);for(let M=0;M<L.length;M++)k[4*M]=L[M],k[4*M+1]=L[M],k[4*M+2]=L[M],k[4*M+3]=255;let C=new ImageData(k,this.width,this.height);return this.detect(C)}detect(L){let k=null,C=[];for(let xe=0;xe<this.numOctaves;xe++){let Se,be;Se=xe===0?this._applyFilter(L):this._downsampleBilinear(C[xe-1][C[xe-1].length-1]),be=this._applyFilter(Se),C.push([Se,be])}let M=[];for(let xe=0;xe<this.numOctaves;xe++){let Se=this._differenceImageBinomial(C[xe][0],C[xe][1]);M.push(Se)}let I=[];for(let xe=1;xe<this.numOctaves-1;xe++){let Se=this._buildExtremas(M[xe-1],M[xe],M[xe+1]);I.push(Se)}let b=this._applyPrune(I),T=this._computeLocalization(b,M),A=this._computeOrientationHistograms(T,C),_=this._smoothHistograms(A),D=this._computeExtremaAngles(_),B=this._computeExtremaFreak(C,T,D),$=this._computeFreakDescriptors(B),j=T.arraySync(),q=D.arraySync(),Q=$.arraySync();this.debugMode&&(k={pyramidImages:C.map(xe=>xe.map(Se=>Se.arraySync())),dogPyramidImages:M.map(xe=>xe?xe.arraySync():null),extremasResults:I.map(xe=>xe.arraySync()),extremaAngles:D.arraySync(),prunedExtremas:b,localizedExtremas:T.arraySync()}),C.forEach(xe=>xe.forEach(Se=>Se.dispose())),M.forEach(xe=>xe&&xe.dispose()),I.forEach(xe=>xe.dispose()),T.dispose(),A.dispose(),_.dispose(),D.dispose(),B.dispose(),$.dispose();let ue=[];for(let xe=0;xe<j.length;xe++){if(j[xe][0]==0)continue;let Se=[];for(let Ae=0;Ae<Q[xe].length;Ae+=4){let Ue=16777216*Q[xe][Ae]+65536*Q[xe][Ae+1]+256*Q[xe][Ae+2]+Q[xe][Ae+3];Se.push(Ue)}let be=j[xe][1],pe=j[xe][2],we=j[xe][3]*Math.pow(2,be)+Math.pow(2,be-1)-.5,he=pe*Math.pow(2,be)+Math.pow(2,be-1)-.5,Ie=Math.pow(2,be);ue.push({maxima:j[xe][0]>0,x:we,y:he,scale:Ie,angle:q[xe],descriptors:Se})}return{featurePoints:ue,debugExtra:k}}_computeFreakDescriptors(L){if(!this.tensorCaches.computeFreakDescriptors){let M=[],I=[];for(let A=0;A<L.shape[1];A++)for(let _=A+1;_<L.shape[1];_++)M.push(A),I.push(_);let b=E.tensor(M,[M.length]).cast("int32"),T=E.tensor(I,[I.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:E.keep(E.stack([b,T],1))}}let{positionT:k}=this.tensorCaches.computeFreakDescriptors,C=Math.ceil(P/8);if(!this.kernelCaches.computeFreakDescriptors){let M={variableNames:["freak","p"],outputShape:[L.shape[0],C],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();
	    int featureIndex = coords[0];
	    int descIndex = coords[1] * 8;

	    int sum = 0;
	    for (int i = 0; i < 8; i++) {
	      if (descIndex + i >= ${P}) {
		continue;
	      }

	      int p1 = int(getP(descIndex + i, 0));
	      int p2 = int(getP(descIndex + i, 1));

	      float v1 = getFreak(featureIndex, p1);
	      float v2 = getFreak(featureIndex, p2);

	      if (v1 < v2 + 0.01) {
	        sum += int(pow(2.0, float(7 - i)));
	      }
	    }
	    setOutput(float(sum));
	  }
	`};this.kernelCaches.computeFreakDescriptors=[M]}return E.tidy(()=>{let[M]=this.kernelCaches.computeFreakDescriptors;return this._runWebGLProgram(M,[L,k],"int32")})}_computeExtremaFreak(L,k,C){this.tensorCaches._computeExtremaFreak||E.tidy(()=>{let b=E.tensor(z);this.tensorCaches._computeExtremaFreak={freakPointsT:E.keep(b)}});let{freakPointsT:M}=this.tensorCaches._computeExtremaFreak,I=[];for(let b=1;b<L.length;b++)I.push(L[b][1]);if(!this.kernelCaches._computeExtremaFreak){let b=[];for(let _=1;_<L.length;_++)b.push("image"+_);let T="float getPixel(int octave, int y, int x) {";for(let _=1;_<L.length;_++)T+=`
	  if (octave == ${_}) {
	    return getImage${_}(y, x);
	  }
	`;T+="}";let A={variableNames:[...b,"extrema","angles","freakPoints"],outputShape:[k.shape[0],z.length],userCode:`
	  ${T}
	  void main() {
	    ivec2 coords = getOutputCoords();
	    int featureIndex = coords[0];
	    int freakIndex = coords[1];

	    float freakSigma = getFreakPoints(freakIndex, 0);
	    float freakX = getFreakPoints(freakIndex, 1);
	    float freakY = getFreakPoints(freakIndex, 2);

	    int octave = int(getExtrema(featureIndex, 1));
	    float inputY = getExtrema(featureIndex, 2);
	    float inputX = getExtrema(featureIndex, 3);
	    float inputAngle = getAngles(featureIndex);
            float cos = 7. * cos(inputAngle);
            float sin = 7. * sin(inputAngle);

	    float yp = inputY + freakX * sin + freakY * cos;
	    float xp = inputX + freakX * cos + freakY * -sin;

	    int x0 = int(floor(xp));
	    int x1 = x0 + 1;
	    int y0 = int(floor(yp));
	    int y1 = y0 + 1;

	    float f1 = getPixel(octave, y0, x0);
	    float f2 = getPixel(octave, y0, x1);
	    float f3 = getPixel(octave, y1, x0);
	    float f4 = getPixel(octave, y1, x1);

	    float x1f = float(x1);
	    float y1f = float(y1);
	    float x0f = float(x0);
	    float y0f = float(y0);

	    // ratio for interpolation between four neighbouring points
	    float value = (x1f - xp) * (y1f - yp) * f1
			+ (xp - x0f) * (y1f - yp) * f2
			+ (x1f - xp) * (yp - y0f) * f3
			+ (xp - x0f) * (yp - y0f) * f4;

	    setOutput(value);
	  }
	`};this.kernelCaches._computeExtremaFreak=[A]}return E.tidy(()=>{let[b]=this.kernelCaches._computeExtremaFreak;return this._compileAndRun(b,[...I,k,C,M])})}_computeExtremaAngles(L){if(!this.kernelCaches.computeExtremaAngles){let k={variableNames:["histogram"],outputShape:[L.shape[0]],userCode:`
	  void main() {
	    int featureIndex = getOutputCoords();

	    int maxIndex = 0;
	    for (int i = 1; i < 36; i++) {
	      if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {
		maxIndex = i;
	      }
	    }

	    int prev = imod(maxIndex - 1 + 36, 36);
	    int next = imod(maxIndex + 1, 36);

	    /**
	     * Fit a quatratic to 3 points. The system of equations is:
	     *
	     * y0 = A*x0^2 + B*x0 + C
	     * y1 = A*x1^2 + B*x1 + C
	     * y2 = A*x2^2 + B*x2 + C
	     *
	     * This system of equations is solved for A,B,C.
	     */
	    float p10 = float(maxIndex - 1);
	    float p11 = getHistogram(featureIndex, prev); 
	    float p20 = float(maxIndex);
	    float p21 = getHistogram(featureIndex, maxIndex); 
	    float p30 = float(maxIndex + 1);
	    float p31 = getHistogram(featureIndex, next); 

	    float d1 = (p30-p20)*(p30-p10);
	    float d2 = (p10-p20)*(p30-p10);
	    float d3 = p10-p20;

	    // If any of the denominators are zero then, just use maxIndex.
            float fbin = float(maxIndex);
	    if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {
	      float a = p10*p10;
	      float b = p20*p20;

	      // Solve for the coefficients A,B,C
	      float A = ((p31-p21)/d1)-((p11-p21)/d2);
	      float B = ((p11-p21)+(A*(b-a)))/d3;
	      float C = p11-(A*a)-(B*p10);
	      fbin = -B / (2. * A);
	    }

	    float an = 2.0 *${Math.PI} * (fbin + 0.5) / 36. - ${Math.PI};
	    setOutput(an);
	  }
	`};this.kernelCaches.computeExtremaAngles=k}return E.tidy(()=>{let k=this.kernelCaches.computeExtremaAngles;return this._compileAndRun(k,[L])})}_computeOrientationHistograms(L,k){let C=[];for(let I=1;I<k.length;I++)C.push(k[I][1]);this.tensorCaches.orientationHistograms||E.tidy(()=>{let I=Math.ceil(4.5),b=[];for(let T=-I;T<=I;T++)for(let A=-I;A<=I;A++){let _=A*A+T*T;if(_<=20.25){let D=-.05555555555555555*_,B=.0013888888*(720+D*(720+D*(360+D*(120+D*(30+D*(6+D))))));b.push([T,A,B])}}this.tensorCaches.orientationHistograms={radialPropertiesT:E.keep(E.tensor(b,[b.length,3]))}});let{radialPropertiesT:M}=this.tensorCaches.orientationHistograms;if(!this.kernelCaches.computeOrientationHistograms){let I=[];for(let _=1;_<k.length;_++)I.push("image"+_);let b="float getPixel(int octave, int y, int x) {";for(let _=1;_<k.length;_++)b+=`
	  if (octave == ${_}) {
	    return getImage${_}(y, x);
	  }
	`;b+="}";let T={variableNames:[...I,"extrema","radial"],outputShape:[L.shape[0],M.shape[0],2],userCode:`
	  ${b}

	  void main() {
	    ivec3 coords = getOutputCoords();
	    int featureIndex = coords[0];
	    int radialIndex = coords[1];
	    int propertyIndex = coords[2];

	    int radialY = int(getRadial(radialIndex, 0));
	    int radialX = int(getRadial(radialIndex, 1));
	    float radialW = getRadial(radialIndex, 2);

	    int octave = int(getExtrema(featureIndex, 1));
	    int y = int(getExtrema(featureIndex, 2));
	    int x = int(getExtrema(featureIndex, 3));

	    int xp = x + radialX;
	    int yp = y + radialY;

	    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);
	    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);

	    if (propertyIndex == 0) {
	      // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0
	      
	      float angle = atan(dy, dx) + ${Math.PI};
	      float fbin = angle * 36. * 0.159154943091895;
	      setOutput(fbin);
	      return;
	    }

	    if (propertyIndex == 1) {
	      float mag = sqrt(dx * dx + dy * dy);
	      float magnitude = radialW * mag;
	      setOutput(magnitude);
	      return;
	    }
	  }

	`},A={variableNames:["fbinMag"],outputShape:[L.shape[0],36],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();
	    int featureIndex = coords[0];
	    int binIndex = coords[1];

	    float sum = 0.;
	    for (int i = 0; i < ${M.shape[0]}; i++) {
	      float fbin = getFbinMag(featureIndex, i, 0);
	      int bin = int(floor(fbin - 0.5));
	      int b1 = imod(bin + 36, 36);
	      int b2 = imod(bin + 1 + 36, 36);

	      if (b1 == binIndex || b2 == binIndex) {
		float magnitude = getFbinMag(featureIndex, i, 1);
		float w2 = fbin - float(bin) - 0.5;
		float w1 = w2 * -1. + 1.;

		if (b1 == binIndex) {
		  sum += w1 * magnitude;
		}
		if (b2 == binIndex) {
		  sum += w2 * magnitude;
		}
	      }
	    }
	    setOutput(sum);
	  }
	`};this.kernelCaches.computeOrientationHistograms=[T,A]}return E.tidy(()=>{let[I,b]=this.kernelCaches.computeOrientationHistograms,T=this._compileAndRun(I,[...C,L,M]);return this._compileAndRun(b,[T])})}_smoothHistograms(L){if(!this.kernelCaches.smoothHistograms){let k={variableNames:["histogram"],outputShape:[L.shape[0],36],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int featureIndex = coords[0];
	    int binIndex = coords[1];

	    int prevBin = imod(binIndex - 1 + 36, 36);
	    int nextBin = imod(binIndex + 1, 36);

            float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);

	    setOutput(result);
	  }
	`};this.kernelCaches.smoothHistograms=k}return E.tidy(()=>{let k=this.kernelCaches.smoothHistograms;for(let C=0;C<5;C++)L=this._compileAndRun(k,[L]);return L})}_computeLocalization(L,k){if(!this.kernelCaches.computeLocalization){let C=[],M="float getPixel(int octave, int y, int x) {";for(let b=1;b<k.length;b++)C.push("image"+b),M+=`
	  if (octave == ${b}) {
	    return getImage${b}(y, x);
	  }
 	`;M+="}";let I={variableNames:[...C,"extrema"],outputShape:[L.length,3,3],userCode:`
	  ${M}

	  void main() {
	    ivec3 coords = getOutputCoords();
	    int featureIndex = coords[0];
	    float score = getExtrema(featureIndex, 0);
	    if (score == 0.0) {
	      return;
	    }

	    int dy = coords[1]-1;
	    int dx = coords[2]-1;
	    int octave = int(getExtrema(featureIndex, 1));
	    int y = int(getExtrema(featureIndex, 2));
	    int x = int(getExtrema(featureIndex, 3));
	    setOutput(getPixel(octave, y+dy, x+dx));
	  }
	`};this.kernelCaches.computeLocalization=[I]}return E.tidy(()=>{let C=this.kernelCaches.computeLocalization[0],M=E.tensor(L,[L.length,L[0].length],"int32"),I=this._compileAndRun(C,[...k.slice(1),M]).arraySync(),b=[];for(let A=0;A<I.length;A++){b.push([]);for(let _=0;_<I[A].length;_++)b[A].push([])}let T=[];for(let A=0;A<L.length;A++)T[A]=[L[A][0],L[A][1],L[A][2],L[A][3]];for(let A=0;A<T.length;A++){if(T[A][0]===0)continue;let _=I[A],D=.5*(_[1][2]-_[1][0]),B=.5*(_[2][1]-_[0][1]),$=_[1][2]+_[1][0]-2*_[1][1],j=_[2][1]+_[0][1]-2*_[1][1],q=.25*(_[0][0]+_[2][2]-_[0][2]-_[2][0]),Q=$*j-q*q,ue=(j*-D+-q*-B)/Q,xe=(-q*-D+$*-B)/Q,Se=T[A][2]+xe,be=T[A][3]+ue;Math.abs(Q)<1e-4||(T[A][2]=Se,T[A][3]=be)}return E.tensor(T,[T.length,T[0].length],"float32")})}_applyPrune(L){if(!this.kernelCaches.applyPrune){let I=[];for(let b=0;b<L.length;b++){let T=L[b].shape[0],A=L[b].shape[1],_={variableNames:["extrema"],outputShape:[Math.floor(T/2),Math.floor(A/2)],userCode:`
	    void main() {
	      ivec2 coords = getOutputCoords();
	      int y = coords[0] * 2;
	      int x = coords[1] * 2;

	      float location = 0.0;
	      float values = getExtrema(y, x);

	      if (getExtrema(y+1, x) != 0.0) {
	        location = 1.0;
		values = getExtrema(y+1, x);
	      }
	      else if (getExtrema(y, x+1) != 0.0) {
	        location = 2.0;
		values = getExtrema(y, x+1);
	      }
	      else if (getExtrema(y+1, x+1) != 0.0) {
	        location = 3.0;
		values = getExtrema(y+1, x+1);
	      }

	      if (values < 0.0) {
	        setOutput(location * -1000.0 + values);
	      } else {
	        setOutput(location * 1000.0 + values);
	      }
	    }
	  `};I.push(_)}this.kernelCaches.applyPrune={reductionKernels:I}}let k=[],C=[];for(let I=0;I<100;I++){C.push([]),k.push([]);for(let b=0;b<5;b++)C[I].push([0,0,0,0]),k[I].push(0)}E.tidy(()=>{let{reductionKernels:I}=this.kernelCaches.applyPrune;for(let b=0;b<L.length;b++){let T=I[b],A=this._compileAndRun(T,[L[b]]),_=b+1,D=A.arraySync(),B=A.shape[0],$=A.shape[1],j=2*$/10,q=2*B/10;for(let Q=0;Q<B;Q++)for(let ue=0;ue<$;ue++){let xe=D[Q][ue];if(xe==0)continue;let Se=xe%1e3,be=Math.floor(Math.abs(xe)/1e3),pe=2*ue+(be===2||be===3?1:0),we=2*Q+(be===1||be===3?1:0),he=Math.floor(pe/j),Ie=10*Math.floor(we/q)+he,Ae=Math.abs(Se),Ue=5;for(;Ue>=1&&Ae>k[Ie][Ue-1];)Ue-=1;if(Ue<5){for(let Qe=4;Qe>=Ue+1;Qe--)k[Ie][Qe]=k[Ie][Qe-1],C[Ie][Qe][0]=C[Ie][Qe-1][0],C[Ie][Qe][1]=C[Ie][Qe-1][1],C[Ie][Qe][2]=C[Ie][Qe-1][2],C[Ie][Qe][3]=C[Ie][Qe-1][3];k[Ie][Ue]=Ae,C[Ie][Ue][0]=Se,C[Ie][Ue][1]=_,C[Ie][Ue][2]=we,C[Ie][Ue][3]=pe}}}});let M=[];for(let I=0;I<100;I++)for(let b=0;b<5;b++)M.push(C[I][b]);return M}_buildExtremas(L,k,C){let M=k.shape[0],I=k.shape[1],b="w"+I;if(this.kernelCaches.buildExtremas||(this.kernelCaches.buildExtremas={}),!this.kernelCaches.buildExtremas[b]){let T={variableNames:["image0","image1","image2"],outputShape:[M,I],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int y = coords[0];
	    int x = coords[1];

	    float value = getImage1(y, x);

	    // Step 1: find local maxima/minima
	    if (value * value < 9.) {
	      setOutput(0.);
	      return;
	    }
	    if (y < 7 || y > ${M-1-7}) {
	      setOutput(0.);
	      return;
	    }
	    if (x < 7 || x > ${I-1-7}) {
	      setOutput(0.);
	      return;
	    }

	    bool isMax = true;
	    bool isMin = true;
	    for (int dy = -1; dy <= 1; dy++) {
	      for (int dx = -1; dx <= 1; dx++) {
	        float value0 = getImage0(y+dy, x+dx);
	        float value1 = getImage1(y+dy, x+dx);
	        float value2 = getImage2(y+dy, x+dx);

		if (value < value0 || value < value1 || value < value2) {
		  isMax = false;
		}
		if (value > value0 || value > value1 || value > value2) {
		  isMin = false;
		}
	      }
	    }

	    if (!isMax && !isMin) {
	      setOutput(0.);
	      return;
	    }

	    // compute edge score and reject based on threshold
	    float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);
	    float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);
	    float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));

	    float det = (dxx * dyy) - (dxy * dxy);

	    if (abs(det) < 0.0001) { // determinant undefined. no solution
	      setOutput(0.);
	      return;
	    }

	    float edgeScore = (dxx + dyy) * (dxx + dyy) / det;

	    if (abs(edgeScore) >= 6.25 ) {
	      setOutput(0.);
	      return;
	    }
	    setOutput(getImage1(y,x));
	  }
	`};this.kernelCaches.buildExtremas[b]=T}return E.tidy(()=>{let T=this.kernelCaches.buildExtremas[b];return L=this._downsampleBilinear(L),C=this._upsampleBilinear(C,k),this._compileAndRun(T,[L,k,C])})}_differenceImageBinomial(L,k){return E.tidy(()=>L.sub(k))}_applyFilter(L){let k=L.shape[0],C=L.shape[1],M="w"+C;if(this.kernelCaches.applyFilter||(this.kernelCaches.applyFilter={}),!this.kernelCaches.applyFilter[M]){let I={variableNames:["p"],outputShape:[k,C],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float sum = getP(coords[0], coords[1]-2);
	    sum += getP(coords[0], coords[1]-1) * 4.;
	    sum += getP(coords[0], coords[1]) * 6.;
	    sum += getP(coords[0], coords[1]+1) * 4.;
	    sum += getP(coords[0], coords[1]+2);
	    setOutput(sum);
	  }
	`},b={variableNames:["p"],outputShape:[k,C],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float sum = getP(coords[0]-2, coords[1]);
	    sum += getP(coords[0]-1, coords[1]) * 4.;
	    sum += getP(coords[0], coords[1]) * 6.;
	    sum += getP(coords[0]+1, coords[1]) * 4.;
	    sum += getP(coords[0]+2, coords[1]);
	    sum /= 256.;
	    setOutput(sum);
	  }
	`};this.kernelCaches.applyFilter[M]=[I,b]}return E.tidy(()=>{let[I,b]=this.kernelCaches.applyFilter[M],T=this._compileAndRun(I,[L]);return this._compileAndRun(b,[T])})}_upsampleBilinear(L,k){L.shape[0];let C="w"+L.shape[1];if(this.kernelCaches.upsampleBilinear||(this.kernelCaches.upsampleBilinear={}),!this.kernelCaches.upsampleBilinear[C]){let M={variableNames:["p"],outputShape:[k.shape[0],k.shape[1]],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();
	    int j = coords[0];
	    int i = coords[1];

	    float sj = 0.5 * float(j) - 0.25; 
	    float si = 0.5 * float(i) - 0.25;

	    float sj0 = floor(sj);
	    float sj1 = ceil(sj);
	    float si0 = floor(si);
	    float si1 = ceil(si);

	    int sj0I = int(sj0);
	    int sj1I = int(sj1);
	    int si0I = int(si0);
	    int si1I = int(si1);

	    float sum = 0.0;
	    sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);
	    sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);
	    sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);
	    sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);
	    setOutput(sum);
	  }
	`};this.kernelCaches.upsampleBilinear[C]=M}return E.tidy(()=>{let M=this.kernelCaches.upsampleBilinear[C];return this._compileAndRun(M,[L])})}_downsampleBilinear(L){let k=L.shape[0],C=L.shape[1],M="w"+C;if(this.kernelCaches.downsampleBilinear||(this.kernelCaches.downsampleBilinear={}),!this.kernelCaches.downsampleBilinear[M]){let I={variableNames:["p"],outputShape:[Math.floor(k/2),Math.floor(C/2)],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();
	    int y = coords[0] * 2;
	    int x = coords[1] * 2;

	    float sum = getP(y, x) * 0.25;
	    sum += getP(y+1,x) * 0.25; 
	    sum += getP(y, x+1) * 0.25; 
	    sum += getP(y+1,x+1) * 0.25;
	    setOutput(sum);
	  }
	`};this.kernelCaches.downsampleBilinear[M]=I}return E.tidy(()=>{let I=this.kernelCaches.downsampleBilinear[M];return this._compileAndRun(I,[L])})}_compileAndRun(L,k){let C=E.backend().compileAndRun(L,k);return E.engine().makeTensorFromDataId(C.dataId,C.shape,C.dtype)}_runWebGLProgram(L,k,C){let M=E.backend().runWebGLProgram(L,k,C);return E.engine().makeTensorFromDataId(M.dataId,M.shape,M.dtype)}}}},2793:V=>{let re=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],ae=[];for(let E=0;E<re.length;E++){let z=re[E].sigma;for(let P=0;P<re[E].points.length;P++){let L=re[E].points[P];ae.push([z,L[0],L[1]])}}V.exports={FREAKPOINTS:ae}},7420:V=>{let re=(ae,E,z,P)=>({x:ae[0][0]*E+ae[0][1]*z+ae[0][3],y:ae[1][0]*E+ae[1][1]*z+ae[1][3],z:ae[2][0]*E+ae[2][1]*z+ae[2][3]});V.exports={buildModelViewProjectionTransform:(ae,E)=>[[ae[0][0]*E[0][0]+ae[0][2]*E[2][0],ae[0][0]*E[0][1]+ae[0][2]*E[2][1],ae[0][0]*E[0][2]+ae[0][2]*E[2][2],ae[0][0]*E[0][3]+ae[0][2]*E[2][3]],[ae[1][1]*E[1][0]+ae[1][2]*E[2][0],ae[1][1]*E[1][1]+ae[1][2]*E[2][1],ae[1][1]*E[1][2]+ae[1][2]*E[2][2],ae[1][1]*E[1][3]+ae[1][2]*E[2][3]],[E[2][0],E[2][1],E[2][2],E[2][3]]],applyModelViewProjectionTransform:re,computeScreenCoordiate:(ae,E,z,P)=>{let{x:L,y:k,z:C}=re(ae,E,z);return{x:L/C,y:k/C}}}},7508:(V,re,ae)=>{let{resize:E}=ae(9140);V.exports={buildImageList:z=>{let P=[],L=100/Math.min(z.width,z.height);for(;;)if(P.push(L),L*=Math.pow(2,.3333333333333333),L>=.95){L=1;break}P.push(L),P.reverse();let k=[];for(let C=0;C<P.length;C++)z.width,P[C],z.height,P[C],k.push(Object.assign(E({image:z,ratio:P[C]}),{scale:P[C]}));return k},buildTrackingImageList:z=>{let P=Math.min(z.width,z.height),L=[],k=[];L.push(256/P),L.push(128/P);for(let C=0;C<L.length;C++)k.push(Object.assign(E({image:z,ratio:L[C]}),{scale:L[C]}));return k}}},5260:(V,re,ae)=>{let{Controller:E}=ae(7957),{Compiler:z}=ae(5217),{UI:P}=ae(2749),L={Controller:E,Compiler:z,UI:P};window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE=L,V.exports=L},7325:(V,re,ae)=>{let E=ae(4563);V.exports={InputLoader:class{constructor(z,P){this.width=z,this.height=P,this.texShape=[P,z];let L=document.createElement("canvas").getContext("2d");L.canvas.width=z,L.canvas.height=P,this.context=L,this.program=this.buildProgram(z,P);let k=E.backend();this.tempPixelHandle=k.makeTensorInfo(this.texShape,"float32"),k.texData.get(this.tempPixelHandle.dataId).usage=2}_loadInput(z){return E.tidy(()=>{let P=E.browser.fromPixels(z);return P=P.mean(2),P})}loadInput(z){this.context.drawImage(z,0,0,this.width,this.height);let P=E.backend();return P.gpgpu.uploadPixelDataToTexture(P.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}buildProgram(z,P){let L=E.env().getNumber("WEBGL_VERSION")===2?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:`
	void main() {
	  ivec2 coords = getOutputCoords();
	  int texR = coords[0];
	  int texC = coords[1];
	  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${z}.0, ${P}.0);

	  vec4 values = ${L}(A, uv);
	  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);
	}
      `}}_compileAndRun(z,P){let L=E.backend().compileAndRun(z,P);return E.engine().makeTensorFromDataId(L.dataId,L.shape,L.dtype)}_runWebGLProgram(z,P,L){let k=E.backend().runWebGLProgram(z,P,L);return E.engine().makeTensorFromDataId(k.dataId,k.shape,k.dtype)}}}},2233:V=>{V.exports={compute:re=>{let{v1:ae,v2:E}=re,z=0;for(let k=0;k<ae.length;k++){let C=(ae[k]^E[k])>>>0;z+=(L=void 0,((L=((L=((L=((L=(P=C)-(P>>1&1431655765))>>2&858993459)+(858993459&L))>>4)+L&252645135)>>8)+L&16711935)>>16)+L&65535)}var P,L;return z}}},723:(V,re,ae)=>{let{compute:E}=ae(2233),{createRandomizer:z}=ae(6048),P=L=>{let{points:k,pointIndexes:C,centerPointIndex:M,randomizer:I}=L,b=!1;(C.length<=8||C.length<=16)&&(b=!0);let T={};if(!b){let _=(D=>{let{points:B,pointIndexes:$,randomizer:j}=D,q=[];for(let Se=0;Se<$.length;Se++)q.push(Se);let Q=Number.MAX_SAFE_INTEGER,ue=-1,xe=[];for(let Se=0;Se<128;Se++){j.arrayShuffle({arr:q,sampleSize:8});let be=0,pe=[];for(let we=0;we<$.length;we++){let he=Number.MAX_SAFE_INTEGER;for(let Ie=0;Ie<8;Ie++){let Ae=$[q[Ie]],Ue=E({v1:B[$[we]].descriptors,v2:B[Ae].descriptors});Ue<he&&(pe[we]=q[Ie],he=Ue)}be+=he}xe.push(pe),be<Q&&(Q=be,ue=Se)}return xe[ue]})({points:k,pointIndexes:C,randomizer:I});for(let D=0;D<_.length;D++)T[C[_[D]]]===void 0&&(T[C[_[D]]]=[]),T[C[_[D]]].push(C[D])}Object.keys(T).length===1&&(b=!0);let A={centerPointIndex:M};if(b){A.leaf=!0,A.pointIndexes=[];for(let _=0;_<C.length;_++)A.pointIndexes.push(C[_]);return A}return A.leaf=!1,A.children=[],Object.keys(T).forEach(_=>{A.children.push(P({points:k,pointIndexes:T[_],centerPointIndex:_,randomizer:I}))}),A};V.exports={build:({points:L})=>{let k=[];for(let M=0;M<L.length;M++)k.push(M);let C=z();return{rootNode:P({points:L,pointIndexes:k,centerPointIndex:null,randomizer:C})}}}},6417:(V,re,ae)=>{let E=ae(4563),{buildModelViewProjectionTransform:z,computeScreenCoordiate:P}=ae(7420);V.exports={Tracker:class{constructor(L,k,C,M,I,b=!1){this.markerDimensions=L,this.trackingDataList=k,this.projectionTransform=C,this.debugMode=b,this.trackingKeyframeList=[];for(let A=0;A<k.length;A++)this.trackingKeyframeList.push(k[A][1]);let T=0;for(let A=0;A<this.trackingKeyframeList.length;A++)T=Math.max(T,this.trackingKeyframeList[A].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(let A=0;A<this.trackingKeyframeList.length;A++){let{featurePoints:_,imagePixels:D,imageProperties:B}=this._prebuild(this.trackingKeyframeList[A],T);this.featurePointsListT[A]=_,this.imagePixelsListT[A]=D,this.imagePropertiesListT[A]=B}this.kernelCaches={}}dummyRun(L){let k=[[1,1,1,1],[1,1,1,1],[1,1,1,1]];for(let C=0;C<this.featurePointsListT.length;C++)this.track(L,k,C)}track(L,k,C){let M={},I=z(this.projectionTransform,k),b=this._buildAdjustedModelViewTransform(I),T=(this.markerDimensions[C][0],this.markerDimensions[C][1],this.trackingKeyframeList[C].width,this.trackingKeyframeList[C].height,this.featurePointsListT[C]),A=this.imagePixelsListT[C],_=this.imagePropertiesListT[C],D=this._computeProjection(b,L,C),{matchingPointsT:B,simT:$}=this._computeMatching(T,A,_,D),j=B.arraySync(),q=$.arraySync(),Q=this.trackingKeyframeList[C],ue=[],xe=[],Se=[];for(let be=0;be<j.length;be++)if(q[be]>.8&&be<Q.points.length){Se.push(be);let pe=P(I,j[be][0],j[be][1]);xe.push(pe),ue.push({x:Q.points[be].x/Q.scale,y:Q.points[be].y/Q.scale,z:0})}return this.debugMode&&(M={projectedImage:D.arraySync(),matchingPoints:B.arraySync(),goodTrack:Se,trackedPoints:xe}),b.dispose(),D.dispose(),B.dispose(),$.dispose(),{worldCoords:ue,screenCoords:xe,debugExtra:M}}_computeMatching(L,k,C,M){let I=M.shape[0],b=M.shape[1],T=L.shape[0];if(!this.kernelCaches.computeMatching){let A={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[T,441],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int featureIndex = coords[0];
	    int searchOffsetIndex = coords[1];

	    int markerWidth = int(getMarkerProperties(0));
	    int markerHeight = int(getMarkerProperties(1));
	    float markerScale = getMarkerProperties(2);

	    int searchOffsetX = imod(searchOffsetIndex, 21) * 1;
	    int searchOffsetY = searchOffsetIndex / 21 * 1;

	    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);
	    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);

	    int sx = sCenterX + searchOffsetX - 10;
	    int sy = sCenterY + searchOffsetY - 10;

	    if (sx < 6 || sx >= (${b} - 6) || sy < 6 || sy >= (${I} - 6)) {
	      setOutput(-2.);
	    } 
	    else {
	      float sumPoint = 0.;
	      float sumPointSquare = 0.;
	      float sumTemplate = 0.;
	      float sumTemplateSquare = 0.;
	      float sumPointTemplate = 0.;

	      for (int templateOffsetY = 0; templateOffsetY < 13; templateOffsetY++) {
		for (int templateOffsetX = 0; templateOffsetX < 13; templateOffsetX++) {
		  int fx2 = sCenterX + templateOffsetX - 6;
		  int fy2 = sCenterY + templateOffsetY - 6;

		  int sx2 = sx + templateOffsetX - 6;
		  int sy2 = sy + templateOffsetY - 6;

		  int markerPixelIndex = fy2 * markerWidth + fx2;
		  float markerPixel = getMarkerPixels(markerPixelIndex);
		  float targetPixel = getTargetPixels(sy2, sx2);

		  sumTemplate += markerPixel;
		  sumTemplateSquare += markerPixel * markerPixel;
		  sumPoint += targetPixel;
		  sumPointSquare += targetPixel * targetPixel;
		  sumPointTemplate += targetPixel * markerPixel;
		}
	      }

	      // Normalized cross-correlation
	      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)
	      float count = float(13 * 13);
	      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);
	      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);

	      if (pointVariance < 0.0000001) {
		setOutput(-3.);
	      } else if (templateVariance < 0.0000001) {
		//setOutput(sumTemplate);
		setOutput(-4.);
	      } else {
		sumPointTemplate -= sumPoint / count * sumTemplate;
		float sim = sumPointTemplate / pointVariance / templateVariance;  
		setOutput(sim);
	      }
	    }
	  }
	`},_={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[T,2],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float markerScale = getMarkerProperties(2);

	    int featureIndex = coords[0];

	    int maxIndex = int(getMaxIndex(featureIndex));
	    int searchLocationIndex = maxIndex / 441;
	    int searchOffsetIndex = imod(maxIndex, 441);

	    if (coords[1] == 0) {
	      int searchOffsetX = imod(searchOffsetIndex, 21) * 1;
	      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - 10) / markerScale);
	    }
	    else if (coords[1] == 1) {
	      int searchOffsetY = searchOffsetIndex / 21 * 1;
	      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - 10) / markerScale);
	    }
	  }
	`},D={variableNames:["sims","maxIndex"],outputShape:[T],userCode:`
	  void main() {
	    int featureIndex = getOutputCoords();
	    int maxIndex = int(getMaxIndex(featureIndex));
	    setOutput(getSims(featureIndex, maxIndex));
	  }
	`};this.kernelCaches.computeMatching=[A,_,D]}return E.tidy(()=>{let A=this.kernelCaches.computeMatching,_=this._compileAndRun(A[0],[L,k,C,M]),D=_.argMax(1);return{matchingPointsT:this._compileAndRun(A[1],[L,C,D]),simT:this._compileAndRun(A[2],[_,D])}})}_computeProjection(L,k,C){let M=this.trackingKeyframeList[C].width,I=this.trackingKeyframeList[C].height,b=this.trackingKeyframeList[C].scale,T=M+"-"+I+"-"+b;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[T]){let A={variableNames:["M","pixel"],outputShape:[I,M],userCode:`
	  void main() {
	      ivec2 coords = getOutputCoords();

	      float m00 = getM(0, 0) * 1000.;
	      float m01 = getM(0, 1) * 1000.;
	      float m03 = getM(0, 3) * 1000.;
	      float m10 = getM(1, 0) * 1000.;
	      float m11 = getM(1, 1) * 1000.;
	      float m13 = getM(1, 3) * 1000.;
	      float m20 = getM(2, 0) * 1000.;
	      float m21 = getM(2, 1) * 1000.;
	      float m23 = getM(2, 3) * 1000.;

	      float y = float(coords[0]) / float(${b});
	      float x = float(coords[1]) / float(${b});
	      float uz = (x * m20) + (y * m21) + m23;
	      float oneOverUz = 1. / uz;

	      float ux = (x * m00) + (y * m01) + m03;
	      float uy = (x * m10) + (y * m11) + m13;

	      ux = floor(ux * oneOverUz + 0.5);
	      uy = floor(uy * oneOverUz + 0.5);
	      setOutput(getPixel(int(uy), int(ux)));
	    }
	`};this.kernelCaches.computeProjection[T]=A}return E.tidy(()=>{let A=this.kernelCaches.computeProjection[T];return this._compileAndRun(A,[L,k])})}_buildAdjustedModelViewTransform(L){return E.tidy(()=>{let k=[];for(let C=0;C<L.length;C++){k.push([]);for(let M=0;M<L[C].length;M++)k[C].push(L[C][M]/1e3)}return E.tensor(k,[3,4])})}_prebuild(L,k){return E.tidy(()=>{let C=L.scale,M=[];for(let T=0;T<k;T++)T<L.points.length?M.push([L.points[T].x/C,L.points[T].y/C]):M.push([-1,-1]);let I=E.tensor(L.data,[L.width*L.height]),b=E.tensor([L.width,L.height,L.scale],[3]);return{featurePoints:E.tensor(M,[M.length,2],"float32"),imagePixels:I,imageProperties:b}})}_compileAndRun(L,k){let C=E.backend().compileAndRun(L,k);return E.engine().makeTensorFromDataId(C.dataId,C.shape,C.dtype)}}}},9140:V=>{V.exports={downsampleBilinear:({image:re})=>{let{data:ae,width:E,height:z}=re,P=Math.floor(E/2),L=Math.floor(z/2),k=new Float32Array(P*L),C=[0,1,E,E+1];for(let M=0;M<L;M++)for(let I=0;I<P;I++){let b=2*M*E+2*I,T=0;for(let A=0;A<C.length;A++)T+=ae[b+C[A]];T*=.25,k[M*P+I]=T}return{data:k,width:P,height:L}},upsampleBilinear:({image:re,padOneWidth:ae,padOneHeight:E})=>{let{width:z,height:P,data:L}=re,k=2*re.width+(ae?1:0),C=2*re.height+(E?1:0),M=new Float32Array(k*C);for(let I=0;I<k;I++){let b=.5*I-.25,T=Math.floor(b),A=Math.ceil(b);T<0&&(T=0),A>=z&&(A=z-1);for(let _=0;_<C;_++){let D=.5*_-.25,B=Math.floor(D),$=Math.ceil(D);B<0&&(B=0),$>=P&&($=P-1);let j=(A-b)*($-D)*L[B*z+T]+(A-b)*(D-B)*L[$*z+T]+(b-T)*($-D)*L[B*z+A]+(b-T)*(D-B)*L[$*z+A];M[_*k+I]=j}}return{data:M,width:k,height:C}},resize:({image:re,ratio:ae})=>{let E=Math.round(re.width*ae),z=Math.round(re.height*ae),P=new Uint8Array(E*z);for(let L=0;L<E;L++){let k=Math.round(1*L/ae),C=Math.round(1*(L+1)/ae)-1;C>=re.width&&(C=re.width-1);for(let M=0;M<z;M++){let I=Math.round(1*M/ae),b=Math.round(1*(M+1)/ae)-1;b>=re.height&&(b=re.height-1);let T=0,A=0;for(let _=k;_<=C;_++)for(let D=I;D<=b;D++)T+=1*re.data[D*re.width+_],A+=1;P[M*E+L]=Math.floor(T/A)}}return{data:P,width:E,height:z}}}},6048:V=>{V.exports={createRandomizer:()=>({seed:1234,arrayShuffle(re){let{arr:ae,sampleSize:E}=re;for(let z=0;z<E;z++){this.seed=(214013*this.seed+2531011)%-2147483648;let P=this.seed>>16&32767;P%=ae.length;let L=ae[z];ae[z]=ae[P],ae[P]=L}},nextInt(re){this.seed=(214013*this.seed+2531011)%-2147483648;let ae=this.seed>>16&32767;return ae%=re,ae}})}},344:V=>{let re=(E,z)=>{let P=2*Math.PI*z*E;return P/(P+1)},ae=(E,z,P)=>E*z+(1-E)*P;V.exports={OneEuroFilter:class{constructor({minCutOff:E,beta:z}){this.minCutOff=E,this.beta=z,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}reset(){this.initialized=!1}filter(E,z){if(!this.initialized)return this.initialized=!0,this.xPrev=z,this.dxPrev=z.map(()=>0),this.tPrev=E,z;let{xPrev:P,tPrev:L,dxPrev:k}=this,C=E-L,M=re(C,this.dCutOff),I=[],b=[],T=[];for(let A=0;A<z.length;A++){I[A]=(z[A]-P[A])/C,b[A]=ae(M,I[A],k[A]);let _=this.minCutOff+this.beta*Math.abs(b[A]),D=re(C,_);T[A]=ae(D,z[A],P[A])}return this.xPrev=T,this.dxPrev=b,this.tPrev=E,T}}}},2749:(V,re,ae)=>{ae(4412);let E=ae(9894).Z,z=ae(7676).Z,P=ae(2810).Z;V.exports={UI:class{constructor({uiLoading:L,uiScanning:k,uiError:C}){L==="yes"?this.loadingModal=this._loadHTML(E):L!=="no"&&(this.loadingModal=document.querySelector(L)),C==="yes"?this.compatibilityModal=this._loadHTML(z):C!=="no"&&(this.compatibilityModal=document.querySelector(C)),k==="yes"?this.scanningMask=this._loadHTML(P):k!=="no"&&(this.scanningMask=document.querySelector(k)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}showLoading(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}hideLoading(){this.loadingModal&&this.loadingModal.classList.add("hidden")}showCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}hideCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}showScanning(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}hideScanning(){this.scanningMask&&this.scanningMask.classList.add("hidden")}_loadHTML(L){let k=document.createElement("template");k.innerHTML=L.trim();let C=k.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(C),C}}}},3906:()=>{},2993:()=>{},8352:()=>{},4589:()=>{},1758:()=>{}},cs={};function pr(V){if(cs[V])return cs[V].exports;var re=cs[V]={id:V,loaded:!1,exports:{}};return ji[V].call(re.exports,re,re.exports,pr),re.loaded=!0,re.exports}pr.amdD=function(){throw new Error("define cannot be used indirect")},pr.amdO={},pr.n=V=>{var re=V&&V.__esModule?()=>V.default:()=>V;return pr.d(re,{a:re}),re},pr.d=(V,re)=>{for(var ae in re)pr.o(re,ae)&&!pr.o(V,ae)&&Object.defineProperty(V,ae,{enumerable:!0,get:re[ae]})},pr.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),pr.o=(V,re)=>Object.prototype.hasOwnProperty.call(V,re),pr.r=V=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})},pr.nmd=V=>(V.paths=[],V.children||(V.children=[]),V),pr.p="",pr(5260)})()});var eM=fE((JT,gE)=>{(function(ji){if(typeof JT=="object"&&typeof gE<"u")gE.exports=ji();else if(typeof define=="function"&&define.amd)define([],ji);else{var cs;typeof window<"u"?cs=window:typeof global<"u"?cs=global:typeof self<"u"?cs=self:cs=this,cs.AFRAME=ji()}})(function(){var ji,cs,pr;return function(){function V(re,ae,E){function z(k,C){if(!ae[k]){if(!re[k]){var M=typeof sv=="function"&&sv;if(!C&&M)return M(k,!0);if(P)return P(k,!0);var I=new Error("Cannot find module '"+k+"'");throw I.code="MODULE_NOT_FOUND",I}var b=ae[k]={exports:{}};re[k][0].call(b.exports,function(T){var A=re[k][1][T];return z(A||T)},b,b.exports,V,re,ae,E)}return ae[k].exports}for(var P=typeof sv=="function"&&sv,L=0;L<E.length;L++)z(E[L]);return z}return V}()({1:[function(V,re,ae){var E=Object.prototype.toString;re.exports=z;function z(P){return P.BYTES_PER_ELEMENT&&E.call(P.buffer)==="[object ArrayBuffer]"||Array.isArray(P)}},{}],2:[function(V,re,ae){re.exports=function(z,P){return typeof z=="number"?z:typeof P=="number"?P:0}},{}],3:[function(V,re,ae){"use strict";ae.byteLength=I,ae.toByteArray=T,ae.fromByteArray=D;for(var E=[],z=[],P=typeof Uint8Array<"u"?Uint8Array:Array,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=0,C=L.length;k<C;++k)E[k]=L[k],z[L.charCodeAt(k)]=k;z["-".charCodeAt(0)]=62,z["_".charCodeAt(0)]=63;function M(B){var $=B.length;if($%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var j=B.indexOf("=");j===-1&&(j=$);var q=j===$?0:4-j%4;return[j,q]}function I(B){var $=M(B),j=$[0],q=$[1];return(j+q)*3/4-q}function b(B,$,j){return($+j)*3/4-j}function T(B){for(var $,j=M(B),q=j[0],Q=j[1],ue=new P(b(B,q,Q)),xe=0,Se=Q>0?q-4:q,be=0;be<Se;be+=4)$=z[B.charCodeAt(be)]<<18|z[B.charCodeAt(be+1)]<<12|z[B.charCodeAt(be+2)]<<6|z[B.charCodeAt(be+3)],ue[xe++]=$>>16&255,ue[xe++]=$>>8&255,ue[xe++]=$&255;return Q===2&&($=z[B.charCodeAt(be)]<<2|z[B.charCodeAt(be+1)]>>4,ue[xe++]=$&255),Q===1&&($=z[B.charCodeAt(be)]<<10|z[B.charCodeAt(be+1)]<<4|z[B.charCodeAt(be+2)]>>2,ue[xe++]=$>>8&255,ue[xe++]=$&255),ue}function A(B){return E[B>>18&63]+E[B>>12&63]+E[B>>6&63]+E[B&63]}function _(B,$,j){for(var q,Q=[],ue=$;ue<j;ue+=3)q=(B[ue]<<16&16711680)+(B[ue+1]<<8&65280)+(B[ue+2]&255),Q.push(A(q));return Q.join("")}function D(B){for(var $,j=B.length,q=j%3,Q=[],ue=16383,xe=0,Se=j-q;xe<Se;xe+=ue)Q.push(_(B,xe,xe+ue>Se?Se:xe+ue));return q===1?($=B[j-1],Q.push(E[$>>2]+E[$<<4&63]+"==")):q===2&&($=(B[j-2]<<8)+B[j-1],Q.push(E[$>>10]+E[$>>4&63]+E[$<<2&63]+"=")),Q.join("")}},{}],4:[function(V,re,ae){"use strict";re.exports={createLink:function(E,z){var P=document.head||document.getElementsByTagName("head")[0],L=document.createElement("link");L.href=E,L.rel="stylesheet";for(var k in z)if(!!z.hasOwnProperty(k)){var C=z[k];L.setAttribute("data-"+k,C)}P.appendChild(L)},createStyle:function(E,z){var P=document.head||document.getElementsByTagName("head")[0],L=document.createElement("style");L.type="text/css";for(var k in z)if(!!z.hasOwnProperty(k)){var C=z[k];L.setAttribute("data-"+k,C)}L.sheet?(L.innerHTML=E,L.sheet.cssText=E,P.appendChild(L)):L.styleSheet?(P.appendChild(L),L.styleSheet.cssText=E):(L.appendChild(document.createTextNode(E)),P.appendChild(L))}}},{}],5:[function(V,re,ae){var E=V("buffer").Buffer;re.exports=function(z,P){if(!!E.isBuffer(z)&&!!E.isBuffer(P)){if(typeof z.equals=="function")return z.equals(P);if(z.length!==P.length)return!1;for(var L=0;L<z.length;L++)if(z[L]!==P[L])return!1;return!0}}},{buffer:6}],6:[function(V,re,ae){(function(E,b){"use strict";var P=V("base64-js"),L=V("ieee754"),k=V("isarray");ae.Buffer=b,ae.SlowBuffer=ue,ae.INSPECT_MAX_BYTES=50,b.TYPED_ARRAY_SUPPORT=E.TYPED_ARRAY_SUPPORT!==void 0?E.TYPED_ARRAY_SUPPORT:C(),ae.kMaxLength=M();function C(){try{var ie=new Uint8Array(1);return ie.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},ie.foo()===42&&typeof ie.subarray=="function"&&ie.subarray(1,1).byteLength===0}catch{return!1}}function M(){return b.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function I(ie,X){if(M()<X)throw new RangeError("Invalid typed array length");return b.TYPED_ARRAY_SUPPORT?(ie=new Uint8Array(X),ie.__proto__=b.prototype):(ie===null&&(ie=new b(X)),ie.length=X),ie}function b(ie,X,te){if(!b.TYPED_ARRAY_SUPPORT&&!(this instanceof b))return new b(ie,X,te);if(typeof ie=="number"){if(typeof X=="string")throw new Error("If encoding is specified then the first argument must be a string");return D(this,ie)}return T(this,ie,X,te)}b.poolSize=8192,b._augment=function(ie){return ie.__proto__=b.prototype,ie};function T(ie,X,te,me){if(typeof X=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&X instanceof ArrayBuffer?j(ie,X,te,me):typeof X=="string"?B(ie,X,te):q(ie,X)}b.from=function(ie,X,te){return T(null,ie,X,te)},b.TYPED_ARRAY_SUPPORT&&(b.prototype.__proto__=Uint8Array.prototype,b.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&b[Symbol.species]===b&&Object.defineProperty(b,Symbol.species,{value:null,configurable:!0}));function A(ie){if(typeof ie!="number")throw new TypeError('"size" argument must be a number');if(ie<0)throw new RangeError('"size" argument must not be negative')}function _(ie,X,te,me){return A(X),X<=0?I(ie,X):te!==void 0?typeof me=="string"?I(ie,X).fill(te,me):I(ie,X).fill(te):I(ie,X)}b.alloc=function(ie,X,te){return _(null,ie,X,te)};function D(ie,X){if(A(X),ie=I(ie,X<0?0:Q(X)|0),!b.TYPED_ARRAY_SUPPORT)for(var te=0;te<X;++te)ie[te]=0;return ie}b.allocUnsafe=function(ie){return D(null,ie)},b.allocUnsafeSlow=function(ie){return D(null,ie)};function B(ie,X,te){if((typeof te!="string"||te==="")&&(te="utf8"),!b.isEncoding(te))throw new TypeError('"encoding" must be a valid string encoding');var me=xe(X,te)|0;ie=I(ie,me);var Le=ie.write(X,te);return Le!==me&&(ie=ie.slice(0,Le)),ie}function $(ie,X){var te=X.length<0?0:Q(X.length)|0;ie=I(ie,te);for(var me=0;me<te;me+=1)ie[me]=X[me]&255;return ie}function j(ie,X,te,me){if(X.byteLength,te<0||X.byteLength<te)throw new RangeError("'offset' is out of bounds");if(X.byteLength<te+(me||0))throw new RangeError("'length' is out of bounds");return te===void 0&&me===void 0?X=new Uint8Array(X):me===void 0?X=new Uint8Array(X,te):X=new Uint8Array(X,te,me),b.TYPED_ARRAY_SUPPORT?(ie=X,ie.__proto__=b.prototype):ie=$(ie,X),ie}function q(ie,X){if(b.isBuffer(X)){var te=Q(X.length)|0;return ie=I(ie,te),ie.length===0||X.copy(ie,0,0,te),ie}if(X){if(typeof ArrayBuffer<"u"&&X.buffer instanceof ArrayBuffer||"length"in X)return typeof X.length!="number"||ee(X.length)?I(ie,0):$(ie,X);if(X.type==="Buffer"&&k(X.data))return $(ie,X.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function Q(ie){if(ie>=M())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+M().toString(16)+" bytes");return ie|0}function ue(ie){return+ie!=ie&&(ie=0),b.alloc(+ie)}b.isBuffer=function(X){return!!(X!=null&&X._isBuffer)},b.compare=function(X,te){if(!b.isBuffer(X)||!b.isBuffer(te))throw new TypeError("Arguments must be Buffers");if(X===te)return 0;for(var me=X.length,Le=te.length,Ye=0,rt=Math.min(me,Le);Ye<rt;++Ye)if(X[Ye]!==te[Ye]){me=X[Ye],Le=te[Ye];break}return me<Le?-1:Le<me?1:0},b.isEncoding=function(X){switch(String(X).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.concat=function(X,te){if(!k(X))throw new TypeError('"list" argument must be an Array of Buffers');if(X.length===0)return b.alloc(0);var me;if(te===void 0)for(te=0,me=0;me<X.length;++me)te+=X[me].length;var Le=b.allocUnsafe(te),Ye=0;for(me=0;me<X.length;++me){var rt=X[me];if(!b.isBuffer(rt))throw new TypeError('"list" argument must be an Array of Buffers');rt.copy(Le,Ye),Ye+=rt.length}return Le};function xe(ie,X){if(b.isBuffer(ie))return ie.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(ie)||ie instanceof ArrayBuffer))return ie.byteLength;typeof ie!="string"&&(ie=""+ie);var te=ie.length;if(te===0)return 0;for(var me=!1;;)switch(X){case"ascii":case"latin1":case"binary":return te;case"utf8":case"utf-8":case void 0:return ye(ie).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return te*2;case"hex":return te>>>1;case"base64":return Ee(ie).length;default:if(me)return ye(ie).length;X=(""+X).toLowerCase(),me=!0}}b.byteLength=xe;function Se(ie,X,te){var me=!1;if((X===void 0||X<0)&&(X=0),X>this.length||((te===void 0||te>this.length)&&(te=this.length),te<=0)||(te>>>=0,X>>>=0,te<=X))return"";for(ie||(ie="utf8");;)switch(ie){case"hex":return Qn(this,X,te);case"utf8":case"utf-8":return Et(this,X,te);case"ascii":return Tn(this,X,te);case"latin1":case"binary":return xn(this,X,te);case"base64":return lt(this,X,te);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Cn(this,X,te);default:if(me)throw new TypeError("Unknown encoding: "+ie);ie=(ie+"").toLowerCase(),me=!0}}b.prototype._isBuffer=!0;function be(ie,X,te){var me=ie[X];ie[X]=ie[te],ie[te]=me}b.prototype.swap16=function(){var X=this.length;if(X%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var te=0;te<X;te+=2)be(this,te,te+1);return this},b.prototype.swap32=function(){var X=this.length;if(X%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var te=0;te<X;te+=4)be(this,te,te+3),be(this,te+1,te+2);return this},b.prototype.swap64=function(){var X=this.length;if(X%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var te=0;te<X;te+=8)be(this,te,te+7),be(this,te+1,te+6),be(this,te+2,te+5),be(this,te+3,te+4);return this},b.prototype.toString=function(){var X=this.length|0;return X===0?"":arguments.length===0?Et(this,0,X):Se.apply(this,arguments)},b.prototype.equals=function(X){if(!b.isBuffer(X))throw new TypeError("Argument must be a Buffer");return this===X?!0:b.compare(this,X)===0},b.prototype.inspect=function(){var X="",te=ae.INSPECT_MAX_BYTES;return this.length>0&&(X=this.toString("hex",0,te).match(/.{2}/g).join(" "),this.length>te&&(X+=" ... ")),"<Buffer "+X+">"},b.prototype.compare=function(X,te,me,Le,Ye){if(!b.isBuffer(X))throw new TypeError("Argument must be a Buffer");if(te===void 0&&(te=0),me===void 0&&(me=X?X.length:0),Le===void 0&&(Le=0),Ye===void 0&&(Ye=this.length),te<0||me>X.length||Le<0||Ye>this.length)throw new RangeError("out of range index");if(Le>=Ye&&te>=me)return 0;if(Le>=Ye)return-1;if(te>=me)return 1;if(te>>>=0,me>>>=0,Le>>>=0,Ye>>>=0,this===X)return 0;for(var rt=Ye-Le,Wt=me-te,mn=Math.min(rt,Wt),gn=this.slice(Le,Ye),_n=X.slice(te,me),In=0;In<mn;++In)if(gn[In]!==_n[In]){rt=gn[In],Wt=_n[In];break}return rt<Wt?-1:Wt<rt?1:0};function pe(ie,X,te,me,Le){if(ie.length===0)return-1;if(typeof te=="string"?(me=te,te=0):te>2147483647?te=2147483647:te<-2147483648&&(te=-2147483648),te=+te,isNaN(te)&&(te=Le?0:ie.length-1),te<0&&(te=ie.length+te),te>=ie.length){if(Le)return-1;te=ie.length-1}else if(te<0)if(Le)te=0;else return-1;if(typeof X=="string"&&(X=b.from(X,me)),b.isBuffer(X))return X.length===0?-1:we(ie,X,te,me,Le);if(typeof X=="number")return X=X&255,b.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?Le?Uint8Array.prototype.indexOf.call(ie,X,te):Uint8Array.prototype.lastIndexOf.call(ie,X,te):we(ie,[X],te,me,Le);throw new TypeError("val must be string, number or Buffer")}function we(ie,X,te,me,Le){var Ye=1,rt=ie.length,Wt=X.length;if(me!==void 0&&(me=String(me).toLowerCase(),me==="ucs2"||me==="ucs-2"||me==="utf16le"||me==="utf-16le")){if(ie.length<2||X.length<2)return-1;Ye=2,rt/=2,Wt/=2,te/=2}function mn(Zn,Ii){return Ye===1?Zn[Ii]:Zn.readUInt16BE(Ii*Ye)}var gn;if(Le){var _n=-1;for(gn=te;gn<rt;gn++)if(mn(ie,gn)===mn(X,_n===-1?0:gn-_n)){if(_n===-1&&(_n=gn),gn-_n+1===Wt)return _n*Ye}else _n!==-1&&(gn-=gn-_n),_n=-1}else for(te+Wt>rt&&(te=rt-Wt),gn=te;gn>=0;gn--){for(var In=!0,Yr=0;Yr<Wt;Yr++)if(mn(ie,gn+Yr)!==mn(X,Yr)){In=!1;break}if(In)return gn}return-1}b.prototype.includes=function(X,te,me){return this.indexOf(X,te,me)!==-1},b.prototype.indexOf=function(X,te,me){return pe(this,X,te,me,!0)},b.prototype.lastIndexOf=function(X,te,me){return pe(this,X,te,me,!1)};function he(ie,X,te,me){te=Number(te)||0;var Le=ie.length-te;me?(me=Number(me),me>Le&&(me=Le)):me=Le;var Ye=X.length;if(Ye%2!==0)throw new TypeError("Invalid hex string");me>Ye/2&&(me=Ye/2);for(var rt=0;rt<me;++rt){var Wt=parseInt(X.substr(rt*2,2),16);if(isNaN(Wt))return rt;ie[te+rt]=Wt}return rt}function Ie(ie,X,te,me){return ke(ye(X,ie.length-te),ie,te,me)}function Ae(ie,X,te,me){return ke(J(X),ie,te,me)}function Ue(ie,X,te,me){return Ae(ie,X,te,me)}function Qe(ie,X,te,me){return ke(Ee(X),ie,te,me)}function ht(ie,X,te,me){return ke(Me(X,ie.length-te),ie,te,me)}b.prototype.write=function(X,te,me,Le){if(te===void 0)Le="utf8",me=this.length,te=0;else if(me===void 0&&typeof te=="string")Le=te,me=this.length,te=0;else if(isFinite(te))te=te|0,isFinite(me)?(me=me|0,Le===void 0&&(Le="utf8")):(Le=me,me=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var Ye=this.length-te;if((me===void 0||me>Ye)&&(me=Ye),X.length>0&&(me<0||te<0)||te>this.length)throw new RangeError("Attempt to write outside buffer bounds");Le||(Le="utf8");for(var rt=!1;;)switch(Le){case"hex":return he(this,X,te,me);case"utf8":case"utf-8":return Ie(this,X,te,me);case"ascii":return Ae(this,X,te,me);case"latin1":case"binary":return Ue(this,X,te,me);case"base64":return Qe(this,X,te,me);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ht(this,X,te,me);default:if(rt)throw new TypeError("Unknown encoding: "+Le);Le=(""+Le).toLowerCase(),rt=!0}},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function lt(ie,X,te){return X===0&&te===ie.length?P.fromByteArray(ie):P.fromByteArray(ie.slice(X,te))}function Et(ie,X,te){te=Math.min(ie.length,te);for(var me=[],Le=X;Le<te;){var Ye=ie[Le],rt=null,Wt=Ye>239?4:Ye>223?3:Ye>191?2:1;if(Le+Wt<=te){var mn,gn,_n,In;switch(Wt){case 1:Ye<128&&(rt=Ye);break;case 2:mn=ie[Le+1],(mn&192)===128&&(In=(Ye&31)<<6|mn&63,In>127&&(rt=In));break;case 3:mn=ie[Le+1],gn=ie[Le+2],(mn&192)===128&&(gn&192)===128&&(In=(Ye&15)<<12|(mn&63)<<6|gn&63,In>2047&&(In<55296||In>57343)&&(rt=In));break;case 4:mn=ie[Le+1],gn=ie[Le+2],_n=ie[Le+3],(mn&192)===128&&(gn&192)===128&&(_n&192)===128&&(In=(Ye&15)<<18|(mn&63)<<12|(gn&63)<<6|_n&63,In>65535&&In<1114112&&(rt=In))}}rt===null?(rt=65533,Wt=1):rt>65535&&(rt-=65536,me.push(rt>>>10&1023|55296),rt=56320|rt&1023),me.push(rt),Le+=Wt}return ln(me)}var Mt=4096;function ln(ie){var X=ie.length;if(X<=Mt)return String.fromCharCode.apply(String,ie);for(var te="",me=0;me<X;)te+=String.fromCharCode.apply(String,ie.slice(me,me+=Mt));return te}function Tn(ie,X,te){var me="";te=Math.min(ie.length,te);for(var Le=X;Le<te;++Le)me+=String.fromCharCode(ie[Le]&127);return me}function xn(ie,X,te){var me="";te=Math.min(ie.length,te);for(var Le=X;Le<te;++Le)me+=String.fromCharCode(ie[Le]);return me}function Qn(ie,X,te){var me=ie.length;(!X||X<0)&&(X=0),(!te||te<0||te>me)&&(te=me);for(var Le="",Ye=X;Ye<te;++Ye)Le+=tn(ie[Ye]);return Le}function Cn(ie,X,te){for(var me=ie.slice(X,te),Le="",Ye=0;Ye<me.length;Ye+=2)Le+=String.fromCharCode(me[Ye]+me[Ye+1]*256);return Le}b.prototype.slice=function(X,te){var me=this.length;X=~~X,te=te===void 0?me:~~te,X<0?(X+=me,X<0&&(X=0)):X>me&&(X=me),te<0?(te+=me,te<0&&(te=0)):te>me&&(te=me),te<X&&(te=X);var Le;if(b.TYPED_ARRAY_SUPPORT)Le=this.subarray(X,te),Le.__proto__=b.prototype;else{var Ye=te-X;Le=new b(Ye,void 0);for(var rt=0;rt<Ye;++rt)Le[rt]=this[rt+X]}return Le};function Mn(ie,X,te){if(ie%1!==0||ie<0)throw new RangeError("offset is not uint");if(ie+X>te)throw new RangeError("Trying to access beyond buffer length")}b.prototype.readUIntLE=function(X,te,me){X=X|0,te=te|0,me||Mn(X,te,this.length);for(var Le=this[X],Ye=1,rt=0;++rt<te&&(Ye*=256);)Le+=this[X+rt]*Ye;return Le},b.prototype.readUIntBE=function(X,te,me){X=X|0,te=te|0,me||Mn(X,te,this.length);for(var Le=this[X+--te],Ye=1;te>0&&(Ye*=256);)Le+=this[X+--te]*Ye;return Le},b.prototype.readUInt8=function(X,te){return te||Mn(X,1,this.length),this[X]},b.prototype.readUInt16LE=function(X,te){return te||Mn(X,2,this.length),this[X]|this[X+1]<<8},b.prototype.readUInt16BE=function(X,te){return te||Mn(X,2,this.length),this[X]<<8|this[X+1]},b.prototype.readUInt32LE=function(X,te){return te||Mn(X,4,this.length),(this[X]|this[X+1]<<8|this[X+2]<<16)+this[X+3]*16777216},b.prototype.readUInt32BE=function(X,te){return te||Mn(X,4,this.length),this[X]*16777216+(this[X+1]<<16|this[X+2]<<8|this[X+3])},b.prototype.readIntLE=function(X,te,me){X=X|0,te=te|0,me||Mn(X,te,this.length);for(var Le=this[X],Ye=1,rt=0;++rt<te&&(Ye*=256);)Le+=this[X+rt]*Ye;return Ye*=128,Le>=Ye&&(Le-=Math.pow(2,8*te)),Le},b.prototype.readIntBE=function(X,te,me){X=X|0,te=te|0,me||Mn(X,te,this.length);for(var Le=te,Ye=1,rt=this[X+--Le];Le>0&&(Ye*=256);)rt+=this[X+--Le]*Ye;return Ye*=128,rt>=Ye&&(rt-=Math.pow(2,8*te)),rt},b.prototype.readInt8=function(X,te){return te||Mn(X,1,this.length),this[X]&128?(255-this[X]+1)*-1:this[X]},b.prototype.readInt16LE=function(X,te){te||Mn(X,2,this.length);var me=this[X]|this[X+1]<<8;return me&32768?me|4294901760:me},b.prototype.readInt16BE=function(X,te){te||Mn(X,2,this.length);var me=this[X+1]|this[X]<<8;return me&32768?me|4294901760:me},b.prototype.readInt32LE=function(X,te){return te||Mn(X,4,this.length),this[X]|this[X+1]<<8|this[X+2]<<16|this[X+3]<<24},b.prototype.readInt32BE=function(X,te){return te||Mn(X,4,this.length),this[X]<<24|this[X+1]<<16|this[X+2]<<8|this[X+3]},b.prototype.readFloatLE=function(X,te){return te||Mn(X,4,this.length),L.read(this,X,!0,23,4)},b.prototype.readFloatBE=function(X,te){return te||Mn(X,4,this.length),L.read(this,X,!1,23,4)},b.prototype.readDoubleLE=function(X,te){return te||Mn(X,8,this.length),L.read(this,X,!0,52,8)},b.prototype.readDoubleBE=function(X,te){return te||Mn(X,8,this.length),L.read(this,X,!1,52,8)};function Ar(ie,X,te,me,Le,Ye){if(!b.isBuffer(ie))throw new TypeError('"buffer" argument must be a Buffer instance');if(X>Le||X<Ye)throw new RangeError('"value" argument is out of bounds');if(te+me>ie.length)throw new RangeError("Index out of range")}b.prototype.writeUIntLE=function(X,te,me,Le){if(X=+X,te=te|0,me=me|0,!Le){var Ye=Math.pow(2,8*me)-1;Ar(this,X,te,me,Ye,0)}var rt=1,Wt=0;for(this[te]=X&255;++Wt<me&&(rt*=256);)this[te+Wt]=X/rt&255;return te+me},b.prototype.writeUIntBE=function(X,te,me,Le){if(X=+X,te=te|0,me=me|0,!Le){var Ye=Math.pow(2,8*me)-1;Ar(this,X,te,me,Ye,0)}var rt=me-1,Wt=1;for(this[te+rt]=X&255;--rt>=0&&(Wt*=256);)this[te+rt]=X/Wt&255;return te+me},b.prototype.writeUInt8=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,1,255,0),b.TYPED_ARRAY_SUPPORT||(X=Math.floor(X)),this[te]=X&255,te+1};function _i(ie,X,te,me){X<0&&(X=65535+X+1);for(var Le=0,Ye=Math.min(ie.length-te,2);Le<Ye;++Le)ie[te+Le]=(X&255<<8*(me?Le:1-Le))>>>(me?Le:1-Le)*8}b.prototype.writeUInt16LE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,2,65535,0),b.TYPED_ARRAY_SUPPORT?(this[te]=X&255,this[te+1]=X>>>8):_i(this,X,te,!0),te+2},b.prototype.writeUInt16BE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,2,65535,0),b.TYPED_ARRAY_SUPPORT?(this[te]=X>>>8,this[te+1]=X&255):_i(this,X,te,!1),te+2};function si(ie,X,te,me){X<0&&(X=4294967295+X+1);for(var Le=0,Ye=Math.min(ie.length-te,4);Le<Ye;++Le)ie[te+Le]=X>>>(me?Le:3-Le)*8&255}b.prototype.writeUInt32LE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,4,4294967295,0),b.TYPED_ARRAY_SUPPORT?(this[te+3]=X>>>24,this[te+2]=X>>>16,this[te+1]=X>>>8,this[te]=X&255):si(this,X,te,!0),te+4},b.prototype.writeUInt32BE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,4,4294967295,0),b.TYPED_ARRAY_SUPPORT?(this[te]=X>>>24,this[te+1]=X>>>16,this[te+2]=X>>>8,this[te+3]=X&255):si(this,X,te,!1),te+4},b.prototype.writeIntLE=function(X,te,me,Le){if(X=+X,te=te|0,!Le){var Ye=Math.pow(2,8*me-1);Ar(this,X,te,me,Ye-1,-Ye)}var rt=0,Wt=1,mn=0;for(this[te]=X&255;++rt<me&&(Wt*=256);)X<0&&mn===0&&this[te+rt-1]!==0&&(mn=1),this[te+rt]=(X/Wt>>0)-mn&255;return te+me},b.prototype.writeIntBE=function(X,te,me,Le){if(X=+X,te=te|0,!Le){var Ye=Math.pow(2,8*me-1);Ar(this,X,te,me,Ye-1,-Ye)}var rt=me-1,Wt=1,mn=0;for(this[te+rt]=X&255;--rt>=0&&(Wt*=256);)X<0&&mn===0&&this[te+rt+1]!==0&&(mn=1),this[te+rt]=(X/Wt>>0)-mn&255;return te+me},b.prototype.writeInt8=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,1,127,-128),b.TYPED_ARRAY_SUPPORT||(X=Math.floor(X)),X<0&&(X=255+X+1),this[te]=X&255,te+1},b.prototype.writeInt16LE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,2,32767,-32768),b.TYPED_ARRAY_SUPPORT?(this[te]=X&255,this[te+1]=X>>>8):_i(this,X,te,!0),te+2},b.prototype.writeInt16BE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,2,32767,-32768),b.TYPED_ARRAY_SUPPORT?(this[te]=X>>>8,this[te+1]=X&255):_i(this,X,te,!1),te+2},b.prototype.writeInt32LE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,4,2147483647,-2147483648),b.TYPED_ARRAY_SUPPORT?(this[te]=X&255,this[te+1]=X>>>8,this[te+2]=X>>>16,this[te+3]=X>>>24):si(this,X,te,!0),te+4},b.prototype.writeInt32BE=function(X,te,me){return X=+X,te=te|0,me||Ar(this,X,te,4,2147483647,-2147483648),X<0&&(X=4294967295+X+1),b.TYPED_ARRAY_SUPPORT?(this[te]=X>>>24,this[te+1]=X>>>16,this[te+2]=X>>>8,this[te+3]=X&255):si(this,X,te,!1),te+4};function mi(ie,X,te,me,Le,Ye){if(te+me>ie.length)throw new RangeError("Index out of range");if(te<0)throw new RangeError("Index out of range")}function Qi(ie,X,te,me,Le){return Le||mi(ie,X,te,4,34028234663852886e22,-34028234663852886e22),L.write(ie,X,te,me,23,4),te+4}b.prototype.writeFloatLE=function(X,te,me){return Qi(this,X,te,!0,me)},b.prototype.writeFloatBE=function(X,te,me){return Qi(this,X,te,!1,me)};function Di(ie,X,te,me,Le){return Le||mi(ie,X,te,8,17976931348623157e292,-17976931348623157e292),L.write(ie,X,te,me,52,8),te+8}b.prototype.writeDoubleLE=function(X,te,me){return Di(this,X,te,!0,me)},b.prototype.writeDoubleBE=function(X,te,me){return Di(this,X,te,!1,me)},b.prototype.copy=function(X,te,me,Le){if(me||(me=0),!Le&&Le!==0&&(Le=this.length),te>=X.length&&(te=X.length),te||(te=0),Le>0&&Le<me&&(Le=me),Le===me||X.length===0||this.length===0)return 0;if(te<0)throw new RangeError("targetStart out of bounds");if(me<0||me>=this.length)throw new RangeError("sourceStart out of bounds");if(Le<0)throw new RangeError("sourceEnd out of bounds");Le>this.length&&(Le=this.length),X.length-te<Le-me&&(Le=X.length-te+me);var Ye=Le-me,rt;if(this===X&&me<te&&te<Le)for(rt=Ye-1;rt>=0;--rt)X[rt+te]=this[rt+me];else if(Ye<1e3||!b.TYPED_ARRAY_SUPPORT)for(rt=0;rt<Ye;++rt)X[rt+te]=this[rt+me];else Uint8Array.prototype.set.call(X,this.subarray(me,me+Ye),te);return Ye},b.prototype.fill=function(X,te,me,Le){if(typeof X=="string"){if(typeof te=="string"?(Le=te,te=0,me=this.length):typeof me=="string"&&(Le=me,me=this.length),X.length===1){var Ye=X.charCodeAt(0);Ye<256&&(X=Ye)}if(Le!==void 0&&typeof Le!="string")throw new TypeError("encoding must be a string");if(typeof Le=="string"&&!b.isEncoding(Le))throw new TypeError("Unknown encoding: "+Le)}else typeof X=="number"&&(X=X&255);if(te<0||this.length<te||this.length<me)throw new RangeError("Out of range index");if(me<=te)return this;te=te>>>0,me=me===void 0?this.length:me>>>0,X||(X=0);var rt;if(typeof X=="number")for(rt=te;rt<me;++rt)this[rt]=X;else{var Wt=b.isBuffer(X)?X:ye(new b(X,Le).toString()),mn=Wt.length;for(rt=0;rt<me-te;++rt)this[rt+te]=Wt[rt%mn]}return this};var Kr=/[^+\/0-9A-Za-z-_]/g;function Ci(ie){if(ie=ss(ie).replace(Kr,""),ie.length<2)return"";for(;ie.length%4!==0;)ie=ie+"=";return ie}function ss(ie){return ie.trim?ie.trim():ie.replace(/^\s+|\s+$/g,"")}function tn(ie){return ie<16?"0"+ie.toString(16):ie.toString(16)}function ye(ie,X){X=X||1/0;for(var te,me=ie.length,Le=null,Ye=[],rt=0;rt<me;++rt){if(te=ie.charCodeAt(rt),te>55295&&te<57344){if(!Le){if(te>56319){(X-=3)>-1&&Ye.push(239,191,189);continue}else if(rt+1===me){(X-=3)>-1&&Ye.push(239,191,189);continue}Le=te;continue}if(te<56320){(X-=3)>-1&&Ye.push(239,191,189),Le=te;continue}te=(Le-55296<<10|te-56320)+65536}else Le&&(X-=3)>-1&&Ye.push(239,191,189);if(Le=null,te<128){if((X-=1)<0)break;Ye.push(te)}else if(te<2048){if((X-=2)<0)break;Ye.push(te>>6|192,te&63|128)}else if(te<65536){if((X-=3)<0)break;Ye.push(te>>12|224,te>>6&63|128,te&63|128)}else if(te<1114112){if((X-=4)<0)break;Ye.push(te>>18|240,te>>12&63|128,te>>6&63|128,te&63|128)}else throw new Error("Invalid code point")}return Ye}function J(ie){for(var X=[],te=0;te<ie.length;++te)X.push(ie.charCodeAt(te)&255);return X}function Me(ie,X){for(var te,me,Le,Ye=[],rt=0;rt<ie.length&&!((X-=2)<0);++rt)te=ie.charCodeAt(rt),me=te>>8,Le=te%256,Ye.push(Le),Ye.push(me);return Ye}function Ee(ie){return P.toByteArray(Ci(ie))}function ke(ie,X,te,me){for(var Le=0;Le<me&&!(Le+te>=X.length||Le>=ie.length);++Le)X[Le+te]=ie[Le];return Le}function ee(ie){return ie!==ie}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer)},{"base64-js":3,buffer:6,ieee754:29,isarray:35}],7:[function(V,re,ae){(function(){if(!(typeof window>"u"))try{var E=new window.CustomEvent("test",{cancelable:!0});if(E.preventDefault(),E.defaultPrevented!==!0)throw new Error("Could not prevent default")}catch{var z=function(L,k){var C,M;return k=k||{},k.bubbles=!!k.bubbles,k.cancelable=!!k.cancelable,C=document.createEvent("CustomEvent"),C.initCustomEvent(L,k.bubbles,k.cancelable,k.detail),M=C.preventDefault,C.preventDefault=function(){M.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch{this.defaultPrevented=!0}},C};z.prototype=window.Event.prototype,window.CustomEvent=z}})()},{}],8:[function(V,re,ae){ae=re.exports=V("./debug"),ae.log=P,ae.formatArgs=z,ae.save=L,ae.load=k,ae.useColors=E,ae.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:C(),ae.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function E(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}ae.formatters.j=function(M){return JSON.stringify(M)};function z(){var M=arguments,I=this.useColors;if(M[0]=(I?"%c":"")+this.namespace+(I?" %c":" ")+M[0]+(I?"%c ":" "),!I)return M;var b="color: "+this.color;M=[M[0],b,"color: inherit"].concat(Array.prototype.slice.call(M,1));var T=0,A=0;return M[0].replace(/%[a-z%]/g,function(_){_!=="%%"&&(T++,_==="%c"&&(A=T))}),M.splice(A,0,b),M}function P(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function L(M){try{M==null?ae.storage.removeItem("debug"):ae.storage.debug=M}catch{}}function k(){var M;try{M=ae.storage.debug}catch{}return M}ae.enable(k());function C(){try{return window.localStorage}catch{}}},{"./debug":9}],9:[function(V,re,ae){ae=re.exports=P,ae.coerce=M,ae.disable=k,ae.enable=L,ae.enabled=C,ae.names=[],ae.skips=[],ae.formatters={};var E=0;function z(){return ae.colors[E++%ae.colors.length]}function P(I){function b(){}b.enabled=!1;function T(){var _=T;_.useColors==null&&(_.useColors=ae.useColors()),_.color==null&&_.useColors&&(_.color=z());var D=Array.prototype.slice.call(arguments);D[0]=ae.coerce(D[0]),typeof D[0]!="string"&&(D=["%o"].concat(D));var B=0;D[0]=D[0].replace(/%([a-z%])/g,function(j,q){if(j==="%%")return j;B++;var Q=ae.formatters[q];if(typeof Q=="function"){var ue=D[B];j=Q.call(_,ue),D.splice(B,1),B--}return j}),typeof ae.formatArgs=="function"&&(D=ae.formatArgs.apply(_,D));var $=T.log||ae.log||console.log.bind(console);$.apply(_,D)}T.enabled=!0;var A=ae.enabled(I)?T:b;return A.namespace=I,A}function L(I){ae.save(I);for(var b=(I||"").split(/[\s,]+/),T=b.length,A=0;A<T;A++)!b[A]||(I=b[A].replace(/\*/g,".*?"),I[0]==="-"?ae.skips.push(new RegExp("^"+I.substr(1)+"$")):ae.names.push(new RegExp("^"+I+"$")))}function k(){ae.enable("")}function C(I){var b,T;for(b=0,T=ae.skips.length;b<T;b++)if(ae.skips[b].test(I))return!1;for(b=0,T=ae.names.length;b<T;b++)if(ae.names[b].test(I))return!0;return!1}function M(I){return I instanceof Error?I.stack||I.message:I}},{}],10:[function(V,re,ae){"use strict";var E=V("is-obj"),z=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;function L(M){if(M==null)throw new TypeError("Sources cannot be null or undefined");return Object(M)}function k(M,I,b){var T=I[b];if(T!=null){if(z.call(M,b)&&(M[b]===void 0||M[b]===null))throw new TypeError("Cannot convert undefined or null to object ("+b+")");!z.call(M,b)||!E(T)?M[b]=T:M[b]=C(Object(M[b]),I[b])}}function C(M,I){if(M===I)return M;I=Object(I);for(var b in I)z.call(I,b)&&k(M,I,b);if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(I),A=0;A<T.length;A++)P.call(I,T[A])&&k(M,I,T[A]);return M}re.exports=function(I){I=L(I);for(var b=1;b<arguments.length;b++)C(I,arguments[b]);return I}},{"is-obj":34}],11:[function(V,re,ae){"use strict";var E=V("object-keys"),z=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",P=Object.prototype.toString,L=Array.prototype.concat,k=Object.defineProperty,C=function(A){return typeof A=="function"&&P.call(A)==="[object Function]"},M=function(){var A={};try{k(A,"x",{enumerable:!1,value:A});for(var _ in A)return!1;return A.x===A}catch{return!1}},I=k&&M(),b=function(A,_,D,B){_ in A&&(!C(B)||!B())||(I?k(A,_,{configurable:!0,enumerable:!1,value:D,writable:!0}):A[_]=D)},T=function(A,_){var D=arguments.length>2?arguments[2]:{},B=E(_);z&&(B=L.call(B,Object.getOwnPropertySymbols(_)));for(var $=0;$<B.length;$+=1)b(A,B[$],_[B[$]],D[B[$]])};T.supportsDescriptors=!!I,re.exports=T},{"object-keys":41}],12:[function(V,re,ae){(function(E,z,P,L){"use strict";function k(St,Kt){for(var vn=0,cr=St.length;vn<cr;vn++)q(St[vn],Kt)}function C(St){for(var Kt=0,vn=St.length,cr;Kt<vn;Kt++)cr=St[Kt],Pr(cr,Mt[I(cr)])}function M(St){return function(Kt){J(Kt)&&(q(Kt,St),k(Kt.querySelectorAll(ln),St))}}function I(St){var Kt=ke.call(St,"is"),vn=St.nodeName.toUpperCase(),cr=xn.call(Et,Kt?Qe+Kt.toUpperCase():Ue+vn);return Kt&&-1<cr&&!b(vn,Kt)?-1:cr}function b(St,Kt){return-1<ln.indexOf(St+'[is="'+Kt+'"]')}function T(St){var Kt=St.currentTarget,vn=St.attrChange,cr=St.attrName,ir=St.target;gn&&(!ir||ir===Kt)&&Kt.attributeChangedCallback&&cr!=="style"&&St.prevValue!==St.newValue&&Kt.attributeChangedCallback(cr,vn===St[be]?null:St.prevValue,vn===St[we]?null:St.newValue)}function A(St){var Kt=M(St);return function(vn){Le.push(Kt,vn.target)}}function _(St){mn&&(mn=!1,St.currentTarget.removeEventListener(Ie,_)),k((St.target||z).querySelectorAll(ln),St.detail===xe?xe:ue),ye&&$()}function D(St,Kt){var vn=this;ee.call(vn,St,Kt),_n.call(vn,{target:vn})}function B(St,Kt){Ci(St,Kt),Zn?Zn.observe(St,te):(Wt&&(St.setAttribute=D,St[Q]=Yr(St),St.addEventListener(Ae,_n)),St.addEventListener(he,T)),St.createdCallback&&gn&&(St.created=!0,St.createdCallback(),St.created=!1)}function $(){for(var St,Kt=0,vn=Me.length;Kt<vn;Kt++)St=Me[Kt],Tn.contains(St)||(vn--,Me.splice(Kt--,1),q(St,xe))}function j(St){throw new Error("A "+St+" type is already registered")}function q(St,Kt){var vn,cr=I(St);-1<cr&&(Ii(St,Mt[cr]),cr=0,Kt===ue&&!St[ue]?(St[xe]=!1,St[ue]=!0,cr=1,ye&&xn.call(Me,St)<0&&Me.push(St)):Kt===xe&&!St[xe]&&(St[ue]=!1,St[xe]=!0,cr=1),cr&&(vn=St[Kt+"Callback"])&&vn.call(St))}if(!(L in z)){var Q="__"+L+(Math.random()*1e5>>0),ue="attached",xe="detached",Se="extends",be="ADDITION",pe="MODIFICATION",we="REMOVAL",he="DOMAttrModified",Ie="DOMContentLoaded",Ae="DOMSubtreeModified",Ue="<",Qe="=",ht=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,lt=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"],Et=[],Mt=[],ln="",Tn=z.documentElement,xn=Et.indexOf||function(St){for(var Kt=this.length;Kt--&&this[Kt]!==St;);return Kt},Qn=P.prototype,Cn=Qn.hasOwnProperty,Mn=Qn.isPrototypeOf,Ar=P.defineProperty,_i=P.getOwnPropertyDescriptor,si=P.getOwnPropertyNames,mi=P.getPrototypeOf,Qi=P.setPrototypeOf,Di=!!P.__proto__,Kr=P.create||function St(Kt){return Kt?(St.prototype=Kt,new St):this},Ci=Qi||(Di?function(St,Kt){return St.__proto__=Kt,St}:si&&_i?function(){function St(Kt,vn){for(var cr,ir=si(vn),xr=0,Ir=ir.length;xr<Ir;xr++)cr=ir[xr],Cn.call(Kt,cr)||Ar(Kt,cr,_i(vn,cr))}return function(Kt,vn){do St(Kt,vn);while((vn=mi(vn))&&!Mn.call(vn,Kt));return Kt}}():function(St,Kt){for(var vn in Kt)St[vn]=Kt[vn];return St}),ss=E.MutationObserver||E.WebKitMutationObserver,tn=(E.HTMLElement||E.Element||E.Node).prototype,ye=!Mn.call(tn,Tn),J=ye?function(St){return St.nodeType===1}:function(St){return Mn.call(tn,St)},Me=ye&&[],Ee=tn.cloneNode,ke=tn.getAttribute,ee=tn.setAttribute,ie=tn.removeAttribute,X=z.createElement,te=ss&&{attributes:!0,characterData:!0,attributeOldValue:!0},me=ss||function(St){Wt=!1,Tn.removeEventListener(he,me)},Le,Ye=E.requestAnimationFrame||E.webkitRequestAnimationFrame||E.mozRequestAnimationFrame||E.msRequestAnimationFrame||function(St){setTimeout(St,10)},rt=!1,Wt=!0,mn=!0,gn=!0,_n,In,Yr,Zn,Ii,Pr;Qi||Di?(Ii=function(St,Kt){Mn.call(Kt,St)||B(St,Kt)},Pr=B):(Ii=function(St,Kt){St[Q]||(St[Q]=P(!0),B(St,Kt))},Pr=Ii),ye?(Wt=!1,function(){var St=_i(tn,"addEventListener"),Kt=St.value,vn=function(xr){var Ir=new CustomEvent(he,{bubbles:!0});Ir.attrName=xr,Ir.prevValue=ke.call(this,xr),Ir.newValue=null,Ir[we]=Ir.attrChange=2,ie.call(this,xr),this.dispatchEvent(Ir)},cr=function(xr,Ir){var Sr=this.hasAttribute(xr),gi=Sr&&ke.call(this,xr);e=new CustomEvent(he,{bubbles:!0}),ee.call(this,xr,Ir),e.attrName=xr,e.prevValue=Sr?gi:null,e.newValue=Ir,Sr?e[pe]=e.attrChange=1:e[be]=e.attrChange=0,this.dispatchEvent(e)},ir=function(xr){var Ir=xr.currentTarget,Sr=Ir[Q],gi=xr.propertyName,yi;Sr.hasOwnProperty(gi)&&(Sr=Sr[gi],yi=new CustomEvent(he,{bubbles:!0}),yi.attrName=Sr.name,yi.prevValue=Sr.value||null,yi.newValue=Sr.value=Ir[gi]||null,yi.prevValue==null?yi[be]=yi.attrChange=0:yi[pe]=yi.attrChange=1,Ir.dispatchEvent(yi))};St.value=function(xr,Ir,Sr){xr===he&&this.attributeChangedCallback&&this.setAttribute!==cr&&(this[Q]={className:{name:"class",value:this.className}},this.setAttribute=cr,this.removeAttribute=vn,Kt.call(this,"propertychange",ir)),Kt.call(this,xr,Ir,Sr)},Ar(tn,"addEventListener",St)}()):ss||(Tn.addEventListener(he,me),Tn.setAttribute(Q,1),Tn.removeAttribute(Q),Wt&&(_n=function(St){var Kt=this,vn,cr,ir;if(Kt===St.target){vn=Kt[Q],Kt[Q]=cr=Yr(Kt);for(ir in cr){if(!(ir in vn))return In(0,Kt,ir,vn[ir],cr[ir],be);if(cr[ir]!==vn[ir])return In(1,Kt,ir,vn[ir],cr[ir],pe)}for(ir in vn)if(!(ir in cr))return In(2,Kt,ir,vn[ir],cr[ir],we)}},In=function(St,Kt,vn,cr,ir,xr){var Ir={attrChange:St,currentTarget:Kt,attrName:vn,prevValue:cr,newValue:ir};Ir[xr]=St,T(Ir)},Yr=function(St){for(var Kt,vn,cr={},ir=St.attributes,xr=0,Ir=ir.length;xr<Ir;xr++)Kt=ir[xr],vn=Kt.name,vn!=="setAttribute"&&(cr[vn]=Kt.value);return cr})),z[L]=function(St,Kt){if(Ir=St.toUpperCase(),rt||(rt=!0,ss?(Zn=function(gi,yi){function hs(ti,Vi){for(var Rn=0,wo=ti.length;Rn<wo;Vi(ti[Rn++]));}return new ss(function(ti){for(var Vi,Rn,wo,Xi=0,Fi=ti.length;Xi<Fi;Xi++)Vi=ti[Xi],Vi.type==="childList"?(hs(Vi.addedNodes,gi),hs(Vi.removedNodes,yi)):(Rn=Vi.target,gn&&Rn.attributeChangedCallback&&Vi.attributeName!=="style"&&(wo=ke.call(Rn,Vi.attributeName),wo!==Vi.oldValue&&Rn.attributeChangedCallback(Vi.attributeName,Vi.oldValue,wo)))})}(M(ue),M(xe)),Zn.observe(z,{childList:!0,subtree:!0})):(Le=[],Ye(function gi(){for(;Le.length;)Le.shift().call(null,Le.shift());Ye(gi)}),z.addEventListener("DOMNodeInserted",A(ue)),z.addEventListener("DOMNodeRemoved",A(xe))),z.addEventListener(Ie,_),z.addEventListener("readystatechange",_),z.createElement=function(gi,yi){var hs=X.apply(z,arguments),ti=""+gi,Vi=xn.call(Et,(yi?Qe:Ue)+(yi||ti).toUpperCase()),Rn=-1<Vi;return yi&&(hs.setAttribute("is",yi=yi.toLowerCase()),Rn&&(Rn=b(ti.toUpperCase(),yi))),gn=!z.createElement.innerHTMLHelper,Rn&&Pr(hs,Mt[Vi]),hs},tn.cloneNode=function(gi){var yi=Ee.call(this,!!gi),hs=I(yi);return-1<hs&&Pr(yi,Mt[hs]),gi&&C(yi.querySelectorAll(ln)),yi}),-2<xn.call(Et,Qe+Ir)+xn.call(Et,Ue+Ir)&&j(St),!ht.test(Ir)||-1<xn.call(lt,Ir))throw new Error("The type "+St+" is invalid");var vn=function(){return ir?z.createElement(xr,Ir):z.createElement(xr)},cr=Kt||Qn,ir=Cn.call(cr,Se),xr=ir?Kt[Se].toUpperCase():Ir,Ir,Sr;return ir&&-1<xn.call(Et,Ue+xr)&&j(xr),Sr=Et.push((ir?Qe:Ue)+Ir)-1,ln=ln.concat(ln.length?",":"",ir?xr+'[is="'+St.toLowerCase()+'"]':xr),vn.prototype=Mt[Sr]=Cn.call(cr,"prototype")?cr.prototype:Kr(tn),k(z.querySelectorAll(ln),ue),vn}}})(window,document,Object,"registerElement")},{}],13:[function(V,re,ae){re.exports=function(E){switch(E){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],14:[function(V,re,ae){"use strict";var E,z=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol",L=Object.getPrototypeOf||function(B){return B.__proto__},k,C=k?L(k):E,M,I=M?M.constructor:E,b,T=b?L(b):E,A=b?b():E,_=typeof Uint8Array>"u"?E:L(Uint8Array),D={"$ %Array%":Array,"$ %ArrayBuffer%":typeof ArrayBuffer>"u"?E:ArrayBuffer,"$ %ArrayBufferPrototype%":typeof ArrayBuffer>"u"?E:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":P?L([][Symbol.iterator]()):E,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":E,"$ %AsyncFunction%":I,"$ %AsyncFunctionPrototype%":I?I.prototype:E,"$ %AsyncGenerator%":b?L(A):E,"$ %AsyncGeneratorFunction%":T,"$ %AsyncGeneratorPrototype%":T?T.prototype:E,"$ %AsyncIteratorPrototype%":A&&P&&Symbol.asyncIterator?A[Symbol.asyncIterator]():E,"$ %Atomics%":typeof Atomics>"u"?E:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":typeof DataView>"u"?E:DataView,"$ %DataViewPrototype%":typeof DataView>"u"?E:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":typeof Float32Array>"u"?E:Float32Array,"$ %Float32ArrayPrototype%":typeof Float32Array>"u"?E:Float32Array.prototype,"$ %Float64Array%":typeof Float64Array>"u"?E:Float64Array,"$ %Float64ArrayPrototype%":typeof Float64Array>"u"?E:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":k?L(k()):E,"$ %GeneratorFunction%":C,"$ %GeneratorPrototype%":C?C.prototype:E,"$ %Int8Array%":typeof Int8Array>"u"?E:Int8Array,"$ %Int8ArrayPrototype%":typeof Int8Array>"u"?E:Int8Array.prototype,"$ %Int16Array%":typeof Int16Array>"u"?E:Int16Array,"$ %Int16ArrayPrototype%":typeof Int16Array>"u"?E:Int8Array.prototype,"$ %Int32Array%":typeof Int32Array>"u"?E:Int32Array,"$ %Int32ArrayPrototype%":typeof Int32Array>"u"?E:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":P?L(L([][Symbol.iterator]())):E,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":typeof Map>"u"?E:Map,"$ %MapIteratorPrototype%":typeof Map>"u"||!P?E:L(new Map()[Symbol.iterator]()),"$ %MapPrototype%":typeof Map>"u"?E:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":typeof Promise>"u"?E:Promise,"$ %PromisePrototype%":typeof Promise>"u"?E:Promise.prototype,"$ %PromiseProto_then%":typeof Promise>"u"?E:Promise.prototype.then,"$ %Promise_all%":typeof Promise>"u"?E:Promise.all,"$ %Promise_reject%":typeof Promise>"u"?E:Promise.reject,"$ %Promise_resolve%":typeof Promise>"u"?E:Promise.resolve,"$ %Proxy%":typeof Proxy>"u"?E:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":typeof Reflect>"u"?E:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":typeof Set>"u"?E:Set,"$ %SetIteratorPrototype%":typeof Set>"u"||!P?E:L(new Set()[Symbol.iterator]()),"$ %SetPrototype%":typeof Set>"u"?E:Set.prototype,"$ %SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?E:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":typeof SharedArrayBuffer>"u"?E:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":P?L(""[Symbol.iterator]()):E,"$ %StringPrototype%":String.prototype,"$ %Symbol%":P?Symbol:E,"$ %SymbolPrototype%":P?Symbol.prototype:E,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":z,"$ %TypedArray%":_,"$ %TypedArrayPrototype%":_?_.prototype:E,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":typeof Uint8Array>"u"?E:Uint8Array,"$ %Uint8ArrayPrototype%":typeof Uint8Array>"u"?E:Uint8Array.prototype,"$ %Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?E:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":typeof Uint8ClampedArray>"u"?E:Uint8ClampedArray.prototype,"$ %Uint16Array%":typeof Uint16Array>"u"?E:Uint16Array,"$ %Uint16ArrayPrototype%":typeof Uint16Array>"u"?E:Uint16Array.prototype,"$ %Uint32Array%":typeof Uint32Array>"u"?E:Uint32Array,"$ %Uint32ArrayPrototype%":typeof Uint32Array>"u"?E:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":typeof WeakMap>"u"?E:WeakMap,"$ %WeakMapPrototype%":typeof WeakMap>"u"?E:WeakMap.prototype,"$ %WeakSet%":typeof WeakSet>"u"?E:WeakSet,"$ %WeakSetPrototype%":typeof WeakSet>"u"?E:WeakSet.prototype};re.exports=function($,j){if(arguments.length>1&&typeof j!="boolean")throw new TypeError('"allowMissing" argument must be a boolean');var q="$ "+$;if(!(q in D))throw new SyntaxError("intrinsic "+$+" does not exist!");if(typeof D[q]>"u"&&!j)throw new TypeError("intrinsic "+$+" exists, but is not available. Please file an issue!");return D[q]}},{}],15:[function(V,re,ae){"use strict";var E=V("./GetIntrinsic"),z=E("%Object%"),P=E("%TypeError%"),L=E("%String%"),k=V("./helpers/assertRecord"),C=V("./helpers/isNaN"),M=V("./helpers/isFinite"),I=V("./helpers/sign"),b=V("./helpers/mod"),T=V("is-callable"),A=V("es-to-primitive/es5"),_=V("has"),D={ToPrimitive:A,ToBoolean:function($){return!!$},ToNumber:function($){return+$},ToInteger:function($){var j=this.ToNumber($);return C(j)?0:j===0||!M(j)?j:I(j)*Math.floor(Math.abs(j))},ToInt32:function($){return this.ToNumber($)>>0},ToUint32:function($){return this.ToNumber($)>>>0},ToUint16:function($){var j=this.ToNumber($);if(C(j)||j===0||!M(j))return 0;var q=I(j)*Math.floor(Math.abs(j));return b(q,65536)},ToString:function($){return L($)},ToObject:function($){return this.CheckObjectCoercible($),z($)},CheckObjectCoercible:function($,j){if($==null)throw new P(j||"Cannot call method on "+$);return $},IsCallable:T,SameValue:function($,j){return $===j?$===0?1/$===1/j:!0:C($)&&C(j)},Type:function($){if($===null)return"Null";if(typeof $>"u")return"Undefined";if(typeof $=="function"||typeof $=="object")return"Object";if(typeof $=="number")return"Number";if(typeof $=="boolean")return"Boolean";if(typeof $=="string")return"String"},IsPropertyDescriptor:function($){if(this.Type($)!=="Object")return!1;var j={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var q in $)if(_($,q)&&!j[q])return!1;var Q=_($,"[[Value]]"),ue=_($,"[[Get]]")||_($,"[[Set]]");if(Q&&ue)throw new P("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function($){return!(typeof $>"u"||(k(this,"Property Descriptor","Desc",$),!_($,"[[Get]]")&&!_($,"[[Set]]")))},IsDataDescriptor:function($){return!(typeof $>"u"||(k(this,"Property Descriptor","Desc",$),!_($,"[[Value]]")&&!_($,"[[Writable]]")))},IsGenericDescriptor:function($){return typeof $>"u"?!1:(k(this,"Property Descriptor","Desc",$),!this.IsAccessorDescriptor($)&&!this.IsDataDescriptor($))},FromPropertyDescriptor:function($){if(typeof $>"u")return $;if(k(this,"Property Descriptor","Desc",$),this.IsDataDescriptor($))return{value:$["[[Value]]"],writable:!!$["[[Writable]]"],enumerable:!!$["[[Enumerable]]"],configurable:!!$["[[Configurable]]"]};if(this.IsAccessorDescriptor($))return{get:$["[[Get]]"],set:$["[[Set]]"],enumerable:!!$["[[Enumerable]]"],configurable:!!$["[[Configurable]]"]};throw new P("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function($){if(this.Type($)!=="Object")throw new P("ToPropertyDescriptor requires an object");var j={};if(_($,"enumerable")&&(j["[[Enumerable]]"]=this.ToBoolean($.enumerable)),_($,"configurable")&&(j["[[Configurable]]"]=this.ToBoolean($.configurable)),_($,"value")&&(j["[[Value]]"]=$.value),_($,"writable")&&(j["[[Writable]]"]=this.ToBoolean($.writable)),_($,"get")){var q=$.get;if(typeof q<"u"&&!this.IsCallable(q))throw new TypeError("getter must be a function");j["[[Get]]"]=q}if(_($,"set")){var Q=$.set;if(typeof Q<"u"&&!this.IsCallable(Q))throw new P("setter must be a function");j["[[Set]]"]=Q}if((_(j,"[[Get]]")||_(j,"[[Set]]"))&&(_(j,"[[Value]]")||_(j,"[[Writable]]")))throw new P("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return j}};re.exports=D},{"./GetIntrinsic":14,"./helpers/assertRecord":16,"./helpers/isFinite":17,"./helpers/isNaN":18,"./helpers/mod":19,"./helpers/sign":20,"es-to-primitive/es5":21,has:28,"is-callable":32}],16:[function(V,re,ae){"use strict";var E=V("../GetIntrinsic"),z=E("%TypeError%"),P=E("%SyntaxError%"),L=V("has"),k={"Property Descriptor":function(M,I){if(M.Type(I)!=="Object")return!1;var b={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var T in I)if(L(I,T)&&!b[T])return!1;var A=L(I,"[[Value]]"),_=L(I,"[[Get]]")||L(I,"[[Set]]");if(A&&_)throw new z("Property Descriptors may not be both accessor and data descriptors");return!0}};re.exports=function(M,I,b,T){var A=k[I];if(typeof A!="function")throw new P("unknown record type: "+I);if(!A(M,T))throw new z(b+" must be a "+I);console.log(A(M,T),T)}},{"../GetIntrinsic":14,has:28}],17:[function(V,re,ae){var E=Number.isNaN||function(z){return z!==z};re.exports=Number.isFinite||function(z){return typeof z=="number"&&!E(z)&&z!==1/0&&z!==-1/0}},{}],18:[function(V,re,ae){re.exports=Number.isNaN||function(z){return z!==z}},{}],19:[function(V,re,ae){re.exports=function(z,P){var L=z%P;return Math.floor(L>=0?L:L+P)}},{}],20:[function(V,re,ae){re.exports=function(z){return z>=0?1:-1}},{}],21:[function(V,re,ae){"use strict";var E=Object.prototype.toString,z=V("./helpers/isPrimitive"),P=V("is-callable"),L={"[[DefaultValue]]":function(k){var C;if(arguments.length>1?C=arguments[1]:C=E.call(k)==="[object Date]"?String:Number,C===String||C===Number){var M=C===String?["toString","valueOf"]:["valueOf","toString"],I,b;for(b=0;b<M.length;++b)if(P(k[M[b]])&&(I=k[M[b]](),z(I)))return I;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")}};re.exports=function(C){return z(C)?C:arguments.length>1?L["[[DefaultValue]]"](C,arguments[1]):L["[[DefaultValue]]"](C)}},{"./helpers/isPrimitive":22,"is-callable":32}],22:[function(V,re,ae){re.exports=function(z){return z===null||typeof z!="function"&&typeof z!="object"}},{}],23:[function(V,re,ae){var E=V("dtype");re.exports=z;function z(P,L,k){if(!P)throw new TypeError("must specify data as first parameter");if(k=+(k||0)|0,Array.isArray(P)&&P[0]&&typeof P[0][0]=="number"){var C=P[0].length,M=P.length*C,I,b,T,A;(!L||typeof L=="string")&&(L=new(E(L||"float32"))(M+k));var _=L.length-k;if(M!==_)throw new Error("source length "+M+" ("+C+"x"+P.length+") does not match destination length "+_);for(I=0,T=k;I<P.length;I++)for(b=0;b<C;b++)L[T++]=P[I][b]===null?NaN:P[I][b]}else if(!L||typeof L=="string"){var D=E(L||"float32");if(Array.isArray(P)||L==="array")for(L=new D(P.length+k),I=0,T=k,A=L.length;T<A;T++,I++)L[T]=P[I]===null?NaN:P[I];else k===0?L=new D(P):(L=new D(P.length+k),L.set(P,k))}else L.set(P,k);return L}},{dtype:13}],24:[function(V,re,ae){"use strict";var E=V("is-callable"),z=Object.prototype.toString,P=Object.prototype.hasOwnProperty,L=function(b,T,A){for(var _=0,D=b.length;_<D;_++)P.call(b,_)&&(A==null?T(b[_],_,b):T.call(A,b[_],_,b))},k=function(b,T,A){for(var _=0,D=b.length;_<D;_++)A==null?T(b.charAt(_),_,b):T.call(A,b.charAt(_),_,b)},C=function(b,T,A){for(var _ in b)P.call(b,_)&&(A==null?T(b[_],_,b):T.call(A,b[_],_,b))},M=function(b,T,A){if(!E(T))throw new TypeError("iterator must be a function");var _;arguments.length>=3&&(_=A),z.call(b)==="[object Array]"?L(b,T,_):typeof b=="string"?k(b,T,_):C(b,T,_)};re.exports=M},{"is-callable":32}],25:[function(V,re,ae){"use strict";var E="Function.prototype.bind called on incompatible ",z=Array.prototype.slice,P=Object.prototype.toString,L="[object Function]";re.exports=function(C){var M=this;if(typeof M!="function"||P.call(M)!==L)throw new TypeError(E+M);for(var I=z.call(arguments,1),b,T=function(){if(this instanceof b){var $=M.apply(this,I.concat(z.call(arguments)));return Object($)===$?$:this}else return M.apply(C,I.concat(z.call(arguments)))},A=Math.max(0,M.length-I.length),_=[],D=0;D<A;D++)_.push("$"+D);if(b=Function("binder","return function ("+_.join(",")+"){ return binder.apply(this,arguments); }")(T),M.prototype){var B=function(){};B.prototype=M.prototype,b.prototype=new B,B.prototype=null}return b}},{}],26:[function(V,re,ae){"use strict";var E=V("./implementation");re.exports=Function.prototype.bind||E},{"./implementation":25}],27:[function(V,re,ae){(function(E){var z;typeof window<"u"?z=window:typeof E<"u"?z=E:typeof self<"u"?z=self:z={},re.exports=z}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],28:[function(V,re,ae){"use strict";var E=V("function-bind");re.exports=E.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":26}],29:[function(V,re,ae){ae.read=function(E,z,P,L,k){var C,M,I=k*8-L-1,b=(1<<I)-1,T=b>>1,A=-7,_=P?k-1:0,D=P?-1:1,B=E[z+_];for(_+=D,C=B&(1<<-A)-1,B>>=-A,A+=I;A>0;C=C*256+E[z+_],_+=D,A-=8);for(M=C&(1<<-A)-1,C>>=-A,A+=L;A>0;M=M*256+E[z+_],_+=D,A-=8);if(C===0)C=1-T;else{if(C===b)return M?NaN:(B?-1:1)*(1/0);M=M+Math.pow(2,L),C=C-T}return(B?-1:1)*M*Math.pow(2,C-L)},ae.write=function(E,z,P,L,k,C){var M,I,b,T=C*8-k-1,A=(1<<T)-1,_=A>>1,D=k===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=L?0:C-1,$=L?1:-1,j=z<0||z===0&&1/z<0?1:0;for(z=Math.abs(z),isNaN(z)||z===1/0?(I=isNaN(z)?1:0,M=A):(M=Math.floor(Math.log(z)/Math.LN2),z*(b=Math.pow(2,-M))<1&&(M--,b*=2),M+_>=1?z+=D/b:z+=D*Math.pow(2,1-_),z*b>=2&&(M++,b/=2),M+_>=A?(I=0,M=A):M+_>=1?(I=(z*b-1)*Math.pow(2,k),M=M+_):(I=z*Math.pow(2,_-1)*Math.pow(2,k),M=0));k>=8;E[P+B]=I&255,B+=$,I/=256,k-=8);for(M=M<<k|I,T+=k;T>0;E[P+B]=M&255,B+=$,M/=256,T-=8);E[P+B-$]|=j*128}},{}],30:[function(V,re,ae){typeof Object.create=="function"?re.exports=function(z,P){P&&(z.super_=P,z.prototype=Object.create(P.prototype,{constructor:{value:z,enumerable:!1,writable:!0,configurable:!0}}))}:re.exports=function(z,P){if(P){z.super_=P;var L=function(){};L.prototype=P.prototype,z.prototype=new L,z.prototype.constructor=z}}},{}],31:[function(V,re,ae){re.exports=function(P){return P!=null&&(E(P)||z(P)||!!P._isBuffer)};function E(P){return!!P.constructor&&typeof P.constructor.isBuffer=="function"&&P.constructor.isBuffer(P)}function z(P){return typeof P.readFloatLE=="function"&&typeof P.slice=="function"&&E(P.slice(0,0))}},{}],32:[function(V,re,ae){"use strict";var E=Function.prototype.toString,z=/^\s*class\b/,P=function(T){try{var A=E.call(T);return z.test(A)}catch{return!1}},L=function(T){try{return P(T)?!1:(E.call(T),!0)}catch{return!1}},k=Object.prototype.toString,C="[object Function]",M="[object GeneratorFunction]",I=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol";re.exports=function(T){if(!T||typeof T!="function"&&typeof T!="object")return!1;if(typeof T=="function"&&!T.prototype)return!0;if(I)return L(T);if(P(T))return!1;var A=k.call(T);return A===C||A===M}},{}],33:[function(V,re,ae){re.exports=z;var E=Object.prototype.toString;function z(P){var L=E.call(P);return L==="[object Function]"||typeof P=="function"&&L!=="[object RegExp]"||typeof window<"u"&&(P===window.setTimeout||P===window.alert||P===window.confirm||P===window.prompt)}},{}],34:[function(V,re,ae){"use strict";re.exports=function(E){var z=typeof E;return E!==null&&(z==="object"||z==="function")}},{}],35:[function(V,re,ae){var E={}.toString;re.exports=Array.isArray||function(z){return E.call(z)=="[object Array]"}},{}],36:[function(V,re,ae){var E=V("word-wrapper"),z=V("xtend"),P=V("as-number"),L=["x","e","a","o","n","s","r","c","u","m","v","w","z"],k=["m","w"],C=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],M="	".charCodeAt(0),I=" ".charCodeAt(0),b=0,T=1,A=2;re.exports=function(pe){return new _(pe)};function _(be){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(be)}_.prototype.update=function(be){if(be=z({measure:this._measure},be),this._opt=be,this._opt.tabSize=P(this._opt.tabSize,4),!be.font)throw new Error("must provide a valid bitmap font");var pe=this.glyphs,we=be.text||"",he=be.font;this._setupSpaceGlyphs(he);var Ie=E.lines(we,be),Ae=be.width||0;pe.length=0;var Ue=Ie.reduce(function(Cn,Mn){return Math.max(Cn,Mn.width,Ae)},0),Qe=0,ht=0,lt=P(be.lineHeight,he.common.lineHeight),Et=he.common.base,Mt=lt-Et,ln=be.letterSpacing||0,Tn=lt*Ie.length-Mt,xn=xe(this._opt.align);ht-=Tn,this._width=Ue,this._height=Tn,this._descender=lt-Et,this._baseline=Et,this._xHeight=j(he),this._capHeight=Q(he),this._lineHeight=lt,this._ascender=lt-Mt-this._xHeight;var Qn=this;Ie.forEach(function(Cn,Mn){for(var Ar=Cn.start,_i=Cn.end,si=Cn.width,mi,Qi=Ar;Qi<_i;Qi++){var Di=we.charCodeAt(Qi),Kr=Qn.getGlyph(he,Di);if(Kr){mi&&(Qe+=ue(he,mi.id,Kr.id));var Ci=Qe;xn===T?Ci+=(Ue-si)/2:xn===A&&(Ci+=Ue-si),pe.push({position:[Ci,ht],data:Kr,index:Qi,line:Mn}),Qe+=Kr.xadvance+ln,mi=Kr}}ht+=lt,Qe=0}),this._linesTotal=Ie.length},_.prototype._setupSpaceGlyphs=function(be){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,!(!be.chars||be.chars.length===0)){var pe=$(be,I)||q(be)||be.chars[0],we=this._opt.tabSize*pe.xadvance;this._fallbackSpaceGlyph=pe,this._fallbackTabGlyph=z(pe,{x:0,y:0,xadvance:we,id:M,xoffset:0,yoffset:0,width:0,height:0})}},_.prototype.getGlyph=function(be,pe){var we=$(be,pe);return we||(pe===M?this._fallbackTabGlyph:pe===I?this._fallbackSpaceGlyph:null)},_.prototype.computeMetrics=function(be,pe,we,he){var Ie=this._opt.letterSpacing||0,Ae=this._opt.font,Ue=0,Qe=0,ht=0,lt,Et;if(!Ae.chars||Ae.chars.length===0)return{start:pe,end:pe,width:0};we=Math.min(be.length,we);for(var Mt=pe;Mt<we;Mt++){var ln=be.charCodeAt(Mt),lt=this.getGlyph(Ae,ln);if(lt){var Tn=lt.xoffset,xn=Et?ue(Ae,Et.id,lt.id):0;Ue+=xn;var Qn=Ue+lt.xadvance+Ie,Cn=Ue+lt.width;if(Cn>=he||Qn>=he)break;Ue=Qn,Qe=Cn,Et=lt}ht++}return Et&&(Qe+=Et.xoffset),{start:pe,end:pe+ht,width:Qe}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(D);function D(be){Object.defineProperty(_.prototype,be,{get:B(be),configurable:!0})}function B(be){return new Function(["return function "+be+"() {","  return this._"+be,"}"].join(`
`))()}function $(be,pe){if(!be.chars||be.chars.length===0)return null;var we=Se(be.chars,pe);return we>=0?be.chars[we]:null}function j(be){for(var pe=0;pe<L.length;pe++){var we=L[pe].charCodeAt(0),he=Se(be.chars,we);if(he>=0)return be.chars[he].height}return 0}function q(be){for(var pe=0;pe<k.length;pe++){var we=k[pe].charCodeAt(0),he=Se(be.chars,we);if(he>=0)return be.chars[he]}return 0}function Q(be){for(var pe=0;pe<C.length;pe++){var we=C[pe].charCodeAt(0),he=Se(be.chars,we);if(he>=0)return be.chars[he].height}return 0}function ue(be,pe,we){if(!be.kernings||be.kernings.length===0)return 0;for(var he=be.kernings,Ie=0;Ie<he.length;Ie++){var Ae=he[Ie];if(Ae.first===pe&&Ae.second===we)return Ae.amount}return 0}function xe(be){return be==="center"?T:be==="right"?A:b}function Se(be,pe,we){we=we||0;for(var he=we;he<be.length;he++)if(be[he].id===pe)return he;return-1}},{"as-number":2,"word-wrapper":70,xtend:73}],37:[function(V,re,ae){(function(E){var z=V("xhr"),P=function(){},L=V("parse-bmfont-ascii"),k=V("parse-bmfont-xml"),C=V("parse-bmfont-binary"),M=V("./lib/is-binary"),I=V("xtend"),b=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();re.exports=function(_,D){D=typeof D=="function"?D:P,typeof _=="string"?_={uri:_}:_||(_={});var B=_.binary;B&&(_=A(_)),z(_,function($,j,q){if($)return D($);if(!/^2/.test(j.statusCode))return D(new Error("http status code: "+j.statusCode));if(!q)return D(new Error("no body result"));var Q=!1;if(T(q)){var ue=new Uint8Array(q);q=new E(ue,"binary")}M(q)&&(Q=!0,typeof q=="string"&&(q=new E(q,"binary"))),Q||(E.isBuffer(q)&&(q=q.toString(_.encoding)),q=q.trim());var xe;try{var Se=j.headers["content-type"];Q?xe=C(q):/json/.test(Se)||q.charAt(0)==="{"?xe=JSON.parse(q):/xml/.test(Se)||q.charAt(0)==="<"?xe=k(q):xe=L(q)}catch(be){D(new Error("error parsing font "+be.message)),D=P}D(null,xe)})};function T(_){var D=Object.prototype.toString;return D.call(_)==="[object ArrayBuffer]"}function A(_){if(b)return I(_,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var D=new self.XMLHttpRequest;return D.overrideMimeType("text/plain; charset=x-user-defined"),I({xhr:D},_)}}).call(this,V("buffer").Buffer)},{"./lib/is-binary":38,buffer:6,"parse-bmfont-ascii":43,"parse-bmfont-binary":44,"parse-bmfont-xml":45,xhr:71,xtend:73}],38:[function(V,re,ae){(function(E){var z=V("buffer-equal"),P=new E([66,77,70,3]);re.exports=function(L){return typeof L=="string"?L.substring(0,3)==="BMF":L.length>4&&z(L.slice(0,4),P)}}).call(this,V("buffer").Buffer)},{buffer:6,"buffer-equal":5}],39:[function(V,re,ae){"use strict";var E=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;function L(C){if(C==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(C)}function k(){try{if(!Object.assign)return!1;var C=new String("abc");if(C[5]="de",Object.getOwnPropertyNames(C)[0]==="5")return!1;for(var M={},I=0;I<10;I++)M["_"+String.fromCharCode(I)]=I;var b=Object.getOwnPropertyNames(M).map(function(A){return M[A]});if(b.join("")!=="0123456789")return!1;var T={};return"abcdefghijklmnopqrst".split("").forEach(function(A){T[A]=A}),Object.keys(Object.assign({},T)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}re.exports=k()?Object.assign:function(C,M){for(var I,b=L(C),T,A=1;A<arguments.length;A++){I=Object(arguments[A]);for(var _ in I)z.call(I,_)&&(b[_]=I[_]);if(E){T=E(I);for(var D=0;D<T.length;D++)P.call(I,T[D])&&(b[T[D]]=I[T[D]])}}return b}},{}],40:[function(V,re,ae){"use strict";var E;if(!Object.keys){var z=Object.prototype.hasOwnProperty,P=Object.prototype.toString,L=V("./isArguments"),k=Object.prototype.propertyIsEnumerable,C=!k.call({toString:null},"toString"),M=k.call(function(){},"prototype"),I=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],b=function(D){var B=D.constructor;return B&&B.prototype===D},T={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},A=function(){if(typeof window>"u")return!1;for(var D in window)try{if(!T["$"+D]&&z.call(window,D)&&window[D]!==null&&typeof window[D]=="object")try{b(window[D])}catch{return!0}}catch{return!0}return!1}(),_=function(D){if(typeof window>"u"||!A)return b(D);try{return b(D)}catch{return!1}};E=function(B){var $=B!==null&&typeof B=="object",j=P.call(B)==="[object Function]",q=L(B),Q=$&&P.call(B)==="[object String]",ue=[];if(!$&&!j&&!q)throw new TypeError("Object.keys called on a non-object");var xe=M&&j;if(Q&&B.length>0&&!z.call(B,0))for(var Se=0;Se<B.length;++Se)ue.push(String(Se));if(q&&B.length>0)for(var be=0;be<B.length;++be)ue.push(String(be));else for(var pe in B)!(xe&&pe==="prototype")&&z.call(B,pe)&&ue.push(String(pe));if(C)for(var we=_(B),he=0;he<I.length;++he)!(we&&I[he]==="constructor")&&z.call(B,I[he])&&ue.push(I[he]);return ue}}re.exports=E},{"./isArguments":42}],41:[function(V,re,ae){"use strict";var E=Array.prototype.slice,z=V("./isArguments"),P=Object.keys,L=P?function(M){return P(M)}:V("./implementation"),k=Object.keys;L.shim=function(){if(Object.keys){var M=function(){var I=Object.keys(arguments);return I&&I.length===arguments.length}(1,2);M||(Object.keys=function(b){return z(b)?k(E.call(b)):k(b)})}else Object.keys=L;return Object.keys||L},re.exports=L},{"./implementation":40,"./isArguments":42}],42:[function(V,re,ae){"use strict";var E=Object.prototype.toString;re.exports=function(P){var L=E.call(P),k=L==="[object Arguments]";return k||(k=L!=="[object Array]"&&P!==null&&typeof P=="object"&&typeof P.length=="number"&&P.length>=0&&E.call(P.callee)==="[object Function]"),k}},{}],43:[function(V,re,ae){re.exports=function(k){if(!k)throw new Error("no data provided");k=k.toString().trim();var C={pages:[],chars:[],kernings:[]},M=k.split(/\r\n?|\n/g);if(M.length===0)throw new Error("no data in BMFont file");for(var I=0;I<M.length;I++){var b=E(M[I],I);if(!!b)if(b.key==="page"){if(typeof b.data.id!="number")throw new Error("malformed file at line "+I+" -- needs page id=N");if(typeof b.data.file!="string")throw new Error("malformed file at line "+I+' -- needs page file="path"');C.pages[b.data.id]=b.data.file}else b.key==="chars"||b.key==="kernings"||(b.key==="char"?C.chars.push(b.data):b.key==="kerning"?C.kernings.push(b.data):C[b.key]=b.data)}return C};function E(L,k){if(L=L.replace(/\t+/g," ").trim(),!L)return null;var C=L.indexOf(" ");if(C===-1)throw new Error("no named row at line "+k);var M=L.substring(0,C);L=L.substring(C+1),L=L.replace(/letter=[\'\"]\S+[\'\"]/gi,""),L=L.split("="),L=L.map(function(_){return _.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var I=[],b=0;b<L.length;b++){var T=L[b];b===0?I.push({key:T[0],data:""}):b===L.length-1?I[I.length-1].data=z(T[0]):(I[I.length-1].data=z(T[0]),I.push({key:T[1],data:""}))}var A={key:M,data:{}};return I.forEach(function(_){A.data[_.key]=_.data}),A}function z(L){return!L||L.length===0?"":L.indexOf('"')===0||L.indexOf("'")===0?L.substring(1,L.length-1):L.indexOf(",")!==-1?P(L):parseInt(L,10)}function P(L){return L.split(",").map(function(k){return parseInt(k,10)})}},{}],44:[function(V,re,ae){var E=[66,77,70];re.exports=function(A){if(A.length<6)throw new Error("invalid buffer length for BMFont");var _=E.every(function(q,Q){return A.readUInt8(Q)===q});if(!_)throw new Error("BMFont missing BMF byte header");var D=3,B=A.readUInt8(D++);if(B>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var $={kernings:[],chars:[]},j=0;j<5;j++)D+=z($,A,D);return $};function z(T,A,_){if(_>A.length-1)return 0;var D=A.readUInt8(_++),B=A.readInt32LE(_);switch(_+=4,D){case 1:T.info=P(A,_);break;case 2:T.common=L(A,_);break;case 3:T.pages=k(A,_,B);break;case 4:T.chars=C(A,_,B);break;case 5:T.kernings=M(A,_,B);break}return 5+B}function P(T,A){var _={};_.size=T.readInt16LE(A);var D=T.readUInt8(A+2);return _.smooth=D>>7&1,_.unicode=D>>6&1,_.italic=D>>5&1,_.bold=D>>4&1,D>>3&1&&(_.fixedHeight=1),_.charset=T.readUInt8(A+3)||"",_.stretchH=T.readUInt16LE(A+4),_.aa=T.readUInt8(A+6),_.padding=[T.readInt8(A+7),T.readInt8(A+8),T.readInt8(A+9),T.readInt8(A+10)],_.spacing=[T.readInt8(A+11),T.readInt8(A+12)],_.outline=T.readUInt8(A+13),_.face=b(T,A+14),_}function L(T,A){var _={};_.lineHeight=T.readUInt16LE(A),_.base=T.readUInt16LE(A+2),_.scaleW=T.readUInt16LE(A+4),_.scaleH=T.readUInt16LE(A+6),_.pages=T.readUInt16LE(A+8);var D=T.readUInt8(A+10);return _.packed=0,_.alphaChnl=T.readUInt8(A+11),_.redChnl=T.readUInt8(A+12),_.greenChnl=T.readUInt8(A+13),_.blueChnl=T.readUInt8(A+14),_}function k(T,A,_){for(var D=[],B=I(T,A),$=B.length+1,j=_/$,q=0;q<j;q++)D[q]=T.slice(A,A+B.length).toString("utf8"),A+=$;return D}function C(T,A,_){for(var D=[],B=_/20,$=0;$<B;$++){var j={},q=$*20;j.id=T.readUInt32LE(A+0+q),j.x=T.readUInt16LE(A+4+q),j.y=T.readUInt16LE(A+6+q),j.width=T.readUInt16LE(A+8+q),j.height=T.readUInt16LE(A+10+q),j.xoffset=T.readInt16LE(A+12+q),j.yoffset=T.readInt16LE(A+14+q),j.xadvance=T.readInt16LE(A+16+q),j.page=T.readUInt8(A+18+q),j.chnl=T.readUInt8(A+19+q),D[$]=j}return D}function M(T,A,_){for(var D=[],B=_/10,$=0;$<B;$++){var j={},q=$*10;j.first=T.readUInt32LE(A+0+q),j.second=T.readUInt32LE(A+4+q),j.amount=T.readInt16LE(A+8+q),D[$]=j}return D}function I(T,A){for(var _=A;_<T.length&&T[_]!==0;_++);return T.slice(A,_)}function b(T,A){return I(T,A).toString("utf8")}},{}],45:[function(V,re,ae){var E=V("./parse-attribs"),z=V("xml-parse-from-string"),P={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};re.exports=function(I){I=I.toString();var b=z(I),T={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(q){var Q=b.getElementsByTagName(q)[0];Q&&(T[q]=E(L(Q)))});var A=b.getElementsByTagName("pages")[0];if(!A)throw new Error("malformed file -- no <pages> element");for(var _=A.getElementsByTagName("page"),D=0;D<_.length;D++){var B=_[D],$=parseInt(B.getAttribute("id"),10),j=B.getAttribute("file");if(isNaN($))throw new Error('malformed file -- page "id" attribute is NaN');if(!j)throw new Error('malformed file -- needs page "file" attribute');T.pages[parseInt($,10)]=j}return["chars","kernings"].forEach(function(q){var Q=b.getElementsByTagName(q)[0];if(!!Q)for(var ue=q.substring(0,q.length-1),xe=Q.getElementsByTagName(ue),Se=0;Se<xe.length;Se++){var be=xe[Se];T[q].push(E(L(be)))}}),T};function L(M){var I=k(M);return I.reduce(function(b,T){var A=C(T.nodeName);return b[A]=T.nodeValue,b},{})}function k(M){for(var I=[],b=0;b<M.attributes.length;b++)I.push(M.attributes[b]);return I}function C(M){return P[M.toLowerCase()]||M}},{"./parse-attribs":46,"xml-parse-from-string":72}],46:[function(V,re,ae){var E="chasrset";re.exports=function(L){E in L&&(L.charset=L[E],delete L[E]);for(var k in L)k==="face"||k==="charset"||(k==="padding"||k==="spacing"?L[k]=z(L[k]):L[k]=parseInt(L[k],10));return L};function z(P){return P.split(",").map(function(L){return parseInt(L,10)})}},{}],47:[function(V,re,ae){var E=V("string.prototype.trim"),z=V("for-each"),P=function(L){return Object.prototype.toString.call(L)==="[object Array]"};re.exports=function(L){if(!L)return{};var k={};return z(E(L).split(`
`),function(C){var M=C.indexOf(":"),I=E(C.slice(0,M)).toLowerCase(),b=E(C.slice(M+1));typeof k[I]>"u"?k[I]=b:P(k[I])?k[I].push(b):k[I]=[k[I],b]}),k}},{"for-each":24,"string.prototype.trim":53}],48:[function(V,re,ae){(function(E){var z=E.performance||{},P=function(){for(var L=["now","webkitNow","msNow","mozNow","oNow"];L.length;){var k=L.shift();if(k in z)return z[k].bind(z)}var C=Date.now||function(){return new Date().getTime()},M=(z.timing||{}).navigationStart||C();return function(){return C()-M}}();P.performanceNow=z.now,P.noConflict=function(){z.now=P.performanceNow},P.conflict=function(){z.now=P},P.conflict(),re.exports=P}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],49:[function(V,re,ae){var E=re.exports={},z,P;function L(){throw new Error("setTimeout has not been defined")}function k(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?z=setTimeout:z=L}catch{z=L}try{typeof clearTimeout=="function"?P=clearTimeout:P=k}catch{P=k}})();function C(j){if(z===setTimeout)return setTimeout(j,0);if((z===L||!z)&&setTimeout)return z=setTimeout,setTimeout(j,0);try{return z(j,0)}catch{try{return z.call(null,j,0)}catch{return z.call(this,j,0)}}}function M(j){if(P===clearTimeout)return clearTimeout(j);if((P===k||!P)&&clearTimeout)return P=clearTimeout,clearTimeout(j);try{return P(j)}catch{try{return P.call(null,j)}catch{return P.call(this,j)}}}var I=[],b=!1,T,A=-1;function _(){!b||!T||(b=!1,T.length?I=T.concat(I):A=-1,I.length&&D())}function D(){if(!b){var j=C(_);b=!0;for(var q=I.length;q;){for(T=I,I=[];++A<q;)T&&T[A].run();A=-1,q=I.length}T=null,b=!1,M(j)}}E.nextTick=function(j){var q=new Array(arguments.length-1);if(arguments.length>1)for(var Q=1;Q<arguments.length;Q++)q[Q-1]=arguments[Q];I.push(new B(j,q)),I.length===1&&!b&&C(D)};function B(j,q){this.fun=j,this.array=q}B.prototype.run=function(){this.fun.apply(null,this.array)},E.title="browser",E.browser=!0,E.env={},E.argv=[],E.version="",E.versions={};function $(){}E.on=$,E.addListener=$,E.once=$,E.off=$,E.removeListener=$,E.removeAllListeners=$,E.emit=$,E.prependListener=$,E.prependOnceListener=$,E.listeners=function(j){return[]},E.binding=function(j){throw new Error("process.binding is not supported")},E.cwd=function(){return"/"},E.chdir=function(j){throw new Error("process.chdir is not supported")},E.umask=function(){return 0}},{}],50:[function(V,re,ae){(function(E){(function(z){var P=setTimeout,L=typeof E=="function"&&E||function(B){P(B,1)};function k(B,$){return function(){B.apply($,arguments)}}var C=Array.isArray||function(B){return Object.prototype.toString.call(B)==="[object Array]"};function M(B){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof B!="function")throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],D(B,k(b,this),k(T,this))}function I(B){var $=this;if(this._state===null){this._deferreds.push(B);return}L(function(){var j=$._state?B.onFulfilled:B.onRejected;if(j===null){($._state?B.resolve:B.reject)($._value);return}var q;try{q=j($._value)}catch(Q){B.reject(Q);return}B.resolve(q)})}function b(B){try{if(B===this)throw new TypeError("A promise cannot be resolved with itself.");if(B&&(typeof B=="object"||typeof B=="function")){var $=B.then;if(typeof $=="function"){D(k($,B),k(b,this),k(T,this));return}}this._state=!0,this._value=B,A.call(this)}catch(j){T.call(this,j)}}function T(B){this._state=!1,this._value=B,A.call(this)}function A(){for(var B=0,$=this._deferreds.length;B<$;B++)I.call(this,this._deferreds[B]);this._deferreds=null}function _(B,$,j,q){this.onFulfilled=typeof B=="function"?B:null,this.onRejected=typeof $=="function"?$:null,this.resolve=j,this.reject=q}function D(B,$,j){var q=!1;try{B(function(Q){q||(q=!0,$(Q))},function(Q){q||(q=!0,j(Q))})}catch(Q){if(q)return;q=!0,j(Q)}}M.prototype.catch=function(B){return this.then(null,B)},M.prototype.then=function(B,$){var j=this;return new M(function(q,Q){I.call(j,new _(B,$,q,Q))})},M.all=function(){var B=Array.prototype.slice.call(arguments.length===1&&C(arguments[0])?arguments[0]:arguments);return new M(function($,j){if(B.length===0)return $([]);var q=B.length;function Q(xe,Se){try{if(Se&&(typeof Se=="object"||typeof Se=="function")){var be=Se.then;if(typeof be=="function"){be.call(Se,function(pe){Q(xe,pe)},j);return}}B[xe]=Se,--q===0&&$(B)}catch(pe){j(pe)}}for(var ue=0;ue<B.length;ue++)Q(ue,B[ue])})},M.resolve=function(B){return B&&typeof B=="object"&&B.constructor===M?B:new M(function($){$(B)})},M.reject=function(B){return new M(function($,j){j(B)})},M.race=function(B){return new M(function($,j){for(var q=0,Q=B.length;q<Q;q++)B[q].then($,j)})},M._setImmediateFn=function($){L=$},typeof re<"u"&&re.exports?re.exports=M:z.Promise||(z.Promise=M)})(this)}).call(this,V("timers").setImmediate)},{timers:68}],51:[function(V,re,ae){var E=V("dtype"),z=V("an-array"),P=V("is-buffer"),L=[0,2,3],k=[2,1,3];re.exports=function(M,I){(!M||!(z(M)||P(M)))&&(I=M||{},M=null),typeof I=="number"?I={count:I}:I=I||{};for(var b=typeof I.type=="string"?I.type:"uint16",T=typeof I.count=="number"?I.count:1,A=I.start||0,_=I.clockwise!==!1?L:k,D=_[0],B=_[1],$=_[2],j=T*6,q=M||new(E(b))(j),Q=0,ue=0;Q<j;Q+=6,ue+=4){var xe=Q+A;q[xe+0]=ue+0,q[xe+1]=ue+1,q[xe+2]=ue+2,q[xe+3]=ue+D,q[xe+4]=ue+B,q[xe+5]=ue+$}return q}},{"an-array":1,dtype:13,"is-buffer":31}],52:[function(V,re,ae){"use strict";var E=V("function-bind"),z=V("es-abstract/es5"),P=E.call(Function.call,String.prototype.replace),L=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,k=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;re.exports=function(){var M=z.ToString(z.CheckObjectCoercible(this));return P(P(M,L,""),k,"")}},{"es-abstract/es5":15,"function-bind":26}],53:[function(V,re,ae){"use strict";var E=V("function-bind"),z=V("define-properties"),P=V("./implementation"),L=V("./polyfill"),k=V("./shim"),C=E.call(Function.call,L());z(C,{getPolyfill:L,implementation:P,shim:k}),re.exports=C},{"./implementation":52,"./polyfill":54,"./shim":55,"define-properties":11,"function-bind":26}],54:[function(V,re,ae){"use strict";var E=V("./implementation"),z="\u200B";re.exports=function(){return String.prototype.trim&&z.trim()===z?String.prototype.trim:E}},{"./implementation":52}],55:[function(V,re,ae){"use strict";var E=V("define-properties"),z=V("./polyfill");re.exports=function(){var L=z();return E(String.prototype,{trim:L},{trim:function(){return String.prototype.trim!==L}}),L}},{"./polyfill":54,"define-properties":11}],56:[function(V,re,ae){"use strict";var E={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},z={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},P=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],L={CSS:{},springs:{}};function k($e,et,xt){return Math.min(Math.max($e,et),xt)}function C($e,et){return $e.indexOf(et)>-1}function M($e,et){return $e.apply(null,et)}var I=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,b=/^rgb/,T=/^hsl/,A={arr:function($e){return Array.isArray($e)},obj:function($e){return C(Object.prototype.toString.call($e),"Object")},pth:function($e){return A.obj($e)&&$e.hasOwnProperty("totalLength")},svg:function($e){return $e instanceof SVGElement},inp:function($e){return $e instanceof HTMLInputElement},dom:function($e){return $e.nodeType||A.svg($e)},str:function($e){return typeof $e=="string"},fnc:function($e){return typeof $e=="function"},und:function($e){return typeof $e>"u"},hex:function($e){return I.test($e)},rgb:function($e){return b.test($e)},hsl:function($e){return T.test($e)},col:function($e){return A.hex($e)||A.rgb($e)||A.hsl($e)},key:function($e){return!E.hasOwnProperty($e)&&!z.hasOwnProperty($e)&&$e!=="targets"&&$e!=="keyframes"}},_=/\(([^)]+)\)/;function D($e){var et=_.exec($e);return et?et[1].split(",").map(function(xt){return parseFloat(xt)}):[]}function B($e,et){var xt=D($e),Vt=k(A.und(xt[0])?1:xt[0],.1,100),Ge=k(A.und(xt[1])?100:xt[1],.1,100),nn=k(A.und(xt[2])?10:xt[2],.1,100),wn=k(A.und(xt[3])?0:xt[3],.1,100),qn=Math.sqrt(Ge/Vt),Sn=nn/(2*Math.sqrt(Ge*Vt)),Xt=Sn<1?qn*Math.sqrt(1-Sn*Sn):0,nr=1,yr=Sn<1?(Sn*qn+-wn)/Xt:-wn+qn;function Tr(ai){var Vr=et?et*ai/1e3:ai;return Sn<1?Vr=Math.exp(-Vr*Sn*qn)*(nr*Math.cos(Xt*Vr)+yr*Math.sin(Xt*Vr)):Vr=(nr+yr*Vr)*Math.exp(-Vr*qn),ai===0||ai===1?ai:1-Vr}function qi(){var ai=L.springs[$e];if(ai)return ai;for(var Vr=1/6,ui=0,Zi=0;;)if(ui+=Vr,Tr(ui)===1){if(Zi++,Zi>=16)break}else Zi=0;var ks=ui*Vr*1e3;return L.springs[$e]=ks,ks}return et?Tr:qi}function $($e,et){$e===void 0&&($e=1),et===void 0&&(et=.5);var xt=k($e,1,10),Vt=k(et,.1,2);return function(Ge){return Ge===0||Ge===1?Ge:-xt*Math.pow(2,10*(Ge-1))*Math.sin((Ge-1-Vt/(Math.PI*2)*Math.asin(1/xt))*(Math.PI*2)/Vt)}}function j($e){return $e===void 0&&($e=10),function(et){return Math.round(et*$e)*(1/$e)}}var q=function(){var $e=11,et=1/($e-1);function xt(nr,yr){return 1-3*yr+3*nr}function Vt(nr,yr){return 3*yr-6*nr}function Ge(nr){return 3*nr}function nn(nr,yr,Tr){return((xt(yr,Tr)*nr+Vt(yr,Tr))*nr+Ge(yr))*nr}function wn(nr,yr,Tr){return 3*xt(yr,Tr)*nr*nr+2*Vt(yr,Tr)*nr+Ge(yr)}function qn(nr,yr,Tr,qi,ai){var Vr,ui,Zi=0;do ui=yr+(Tr-yr)/2,Vr=nn(ui,qi,ai)-nr,Vr>0?Tr=ui:yr=ui;while(Math.abs(Vr)>1e-7&&++Zi<10);return ui}function Sn(nr,yr,Tr,qi){for(var ai=0;ai<4;++ai){var Vr=wn(yr,Tr,qi);if(Vr===0)return yr;var ui=nn(yr,Tr,qi)-nr;yr-=ui/Vr}return yr}function Xt(nr,yr,Tr,qi){if(!(0<=nr&&nr<=1&&0<=Tr&&Tr<=1))return;var ai=new Float32Array($e);if(nr!==yr||Tr!==qi)for(var Vr=0;Vr<$e;++Vr)ai[Vr]=nn(Vr*et,nr,Tr);function ui(Zi){for(var ks=0,Mr=1,jr=$e-1;Mr!==jr&&ai[Mr]<=Zi;++Mr)ks+=et;--Mr;var Xr=(Zi-ai[Mr])/(ai[Mr+1]-ai[Mr]),qs=ks+Xr*et,Bi=wn(qs,nr,Tr);return Bi>=.001?Sn(Zi,qs,nr,Tr):Bi===0?qs:qn(Zi,ks,ks+et,nr,Tr)}return function(Zi){return nr===yr&&Tr===qi||Zi===0||Zi===1?Zi:nn(ui(Zi),yr,qi)}}return Xt}(),Q=function(){var $e=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],et={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],$],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(wn,qn){return function(Sn){return 1-$(wn,qn)(1-Sn)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(wn,qn){return function(Sn){return Sn<.5?$(wn,qn)(Sn*2)/2:1-$(wn,qn)(Sn*-2+2)/2}}]},xt={linear:[.25,.25,.75,.75]};for(var Vt in et)for(var Ge=0,nn=et[Vt].length;Ge<nn;Ge++)xt["ease"+Vt+$e[Ge]]=et[Vt][Ge];return xt}();function ue($e,et){if(A.fnc($e))return $e;var xt=$e.split("(")[0],Vt=Q[xt],Ge=D($e);switch(xt){case"spring":return B($e,et);case"cubicBezier":return M(q,Ge);case"steps":return M(j,Ge);default:return A.fnc(Vt)?M(Vt,Ge):M(q,Vt)}}function xe($e){try{var et=document.querySelectorAll($e);return et}catch{return}}var Se=[];function be($e,et){for(var xt=Se,Vt=$e.length,Ge=arguments.length>=2?arguments[1]:void 0,nn=0;nn<Vt;nn++)if(nn in $e){var wn=$e[nn];et.call(Ge,wn,nn,$e)&&xt.push(wn)}return Se=$e,Se.length=0,xt}function pe($e,et){et||(et=[]);for(var xt=0,Vt=$e.length;xt<Vt;xt++){var Ge=$e[xt];Array.isArray(Ge)?pe(Ge,et):et.push(Ge)}return et}function we($e){return A.arr($e)?$e:(A.str($e)&&($e=xe($e)||$e),$e instanceof NodeList||$e instanceof HTMLCollection?[].slice.call($e):[$e])}function he($e,et){return $e.some(function(xt){return xt===et})}function Ie($e){var et={};for(var xt in $e)et[xt]=$e[xt];return et}function Ae($e,et){var xt=Ie($e);for(var Vt in $e)xt[Vt]=et.hasOwnProperty(Vt)?et[Vt]:$e[Vt];return xt}function Ue($e,et){var xt=Ie($e);for(var Vt in et)xt[Vt]=A.und($e[Vt])?et[Vt]:$e[Vt];return xt}var Qe=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;function ht($e){var et=Qe.exec($e);return et?"rgba("+et[1]+",1)":$e}var lt=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Et=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;function Mt($e){var et=$e.replace(lt,function(wn,qn,Sn,Xt){return qn+qn+Sn+Sn+Xt+Xt}),xt=Et.exec(et),Vt=parseInt(xt[1],16),Ge=parseInt(xt[2],16),nn=parseInt(xt[3],16);return"rgba("+Vt+","+Ge+","+nn+",1)"}var ln=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,Tn=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function xn($e){var et=ln.exec($e)||Tn.exec($e),xt=parseInt(et[1],10)/360,Vt=parseInt(et[2],10)/100,Ge=parseInt(et[3],10)/100,nn=et[4]||1;function wn(Tr,qi,ai){return ai<0&&(ai+=1),ai>1&&(ai-=1),ai<1/6?Tr+(qi-Tr)*6*ai:ai<1/2?qi:ai<2/3?Tr+(qi-Tr)*(2/3-ai)*6:Tr}var qn,Sn,Xt;if(Vt==0)qn=Sn=Xt=Ge;else{var nr=Ge<.5?Ge*(1+Vt):Ge+Vt-Ge*Vt,yr=2*Ge-nr;qn=wn(yr,nr,xt+1/3),Sn=wn(yr,nr,xt),Xt=wn(yr,nr,xt-1/3)}return"rgba("+qn*255+","+Sn*255+","+Xt*255+","+nn+")"}function Qn($e){if(A.rgb($e))return ht($e);if(A.hex($e))return Mt($e);if(A.hsl($e))return xn($e)}var Cn=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function Mn($e){var et=Cn.exec($e);if(et)return et[2]}function Ar($e){if(C($e,"translate")||$e==="perspective")return"px";if(C($e,"rotate")||C($e,"skew"))return"deg"}function _i($e,et){return A.fnc($e)?$e(et.target,et.id,et.total):$e}function si($e,et){return $e.getAttribute(et)}function mi($e,et,xt){var Vt=Mn(et);if(he([xt,"deg","rad","turn"],Vt))return et;var Ge=L.CSS[et+xt];if(!A.und(Ge))return Ge;var nn=100,wn=document.createElement($e.tagName),qn=$e.parentNode&&$e.parentNode!==document?$e.parentNode:document.body;qn.appendChild(wn),wn.style.position="absolute",wn.style.width=nn+xt;var Sn=nn/wn.offsetWidth;qn.removeChild(wn);var Xt=Sn*parseFloat(et);return L.CSS[et+xt]=Xt,Xt}function Qi($e,et,xt){if(et in $e.style){var Vt=et.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Ge=$e.style[et]||getComputedStyle($e).getPropertyValue(Vt)||"0";return xt?mi($e,Ge,xt):Ge}}function Di($e,et){if(A.dom($e)&&!A.inp($e)&&(si($e,et)||A.svg($e)&&$e[et]))return"attribute";if(A.dom($e)&&he(P,et))return"transform";if(A.dom($e)&&et!=="transform"&&Qi($e,et))return"css";if($e[et]!=null)return"object"}var Kr=/(\w+)\(([^)]*)\)/g;function Ci($e){if(!!A.dom($e)){for(var et=$e.style.transform||"",xt=new Map,Vt;Vt=Kr.exec(et);)xt.set(Vt[1],Vt[2]);return xt}}function ss($e,et,xt,Vt){var Ge=C(et,"scale")?1:0+Ar(et),nn=Ci($e).get(et)||Ge;return xt&&(xt.transforms.list.set(et,nn),xt.transforms.last=et),Vt?mi($e,nn,Vt):nn}function tn($e,et,xt,Vt){switch(Di($e,et)){case"transform":return ss($e,et,Vt,xt);case"css":return Qi($e,et,xt);case"attribute":return si($e,et);default:return $e[et]||0}}var ye=/^(\*=|\+=|-=)/;function J($e,et){var xt=ye.exec($e);if(!xt)return $e;var Vt=Mn($e)||0,Ge=parseFloat(et),nn=parseFloat($e.replace(xt[0],""));switch(xt[0][0]){case"+":return Ge+nn+Vt;case"-":return Ge-nn+Vt;case"*":return Ge*nn+Vt}}var Me=/\s/g;function Ee($e,et){if(A.col($e))return Qn($e);var xt=Mn($e),Vt=xt?$e.substr(0,$e.length-xt.length):$e;return et&&!Me.test($e)?Vt+et:Vt}function ke($e,et){return Math.sqrt(Math.pow(et.x-$e.x,2)+Math.pow(et.y-$e.y,2))}function ee($e){return Math.PI*2*si($e,"r")}function ie($e){return si($e,"width")*2+si($e,"height")*2}function X($e){return ke({x:si($e,"x1"),y:si($e,"y1")},{x:si($e,"x2"),y:si($e,"y2")})}function te($e){for(var et=$e.points,xt=0,Vt,Ge=0;Ge<et.numberOfItems;Ge++){var nn=et.getItem(Ge);Ge>0&&(xt+=ke(Vt,nn)),Vt=nn}return xt}function me($e){var et=$e.points;return te($e)+ke(et.getItem(et.numberOfItems-1),et.getItem(0))}function Le($e){if($e.getTotalLength)return $e.getTotalLength();switch($e.tagName.toLowerCase()){case"circle":return ee($e);case"rect":return ie($e);case"line":return X($e);case"polyline":return te($e);case"polygon":return me($e)}}function Ye($e){var et=Le($e);return $e.setAttribute("stroke-dasharray",et),et}function rt($e){for(var et=$e.parentNode;A.svg(et)&&(et=et.parentNode,!!A.svg(et.parentNode)););return et}function Wt($e,et){var xt=et||{},Vt=xt.el||rt($e),Ge=Vt.getBoundingClientRect(),nn=si(Vt,"viewBox"),wn=Ge.width,qn=Ge.height,Sn=xt.viewBox||(nn?nn.split(" "):[0,0,wn,qn]);return{el:Vt,viewBox:Sn,x:Sn[0]/1,y:Sn[1]/1,w:wn/Sn[2],h:qn/Sn[3]}}function mn($e,et){var xt=A.str($e)?xe($e)[0]:$e,Vt=et||100;return function(Ge){return{property:Ge,el:xt,svg:Wt(xt),totalLength:Le(xt)*(Vt/100)}}}function gn($e,et){function xt(qn){qn===void 0&&(qn=0);var Sn=et+qn>=1?et+qn:0;return $e.el.getPointAtLength(Sn)}var Vt=Wt($e.el,$e.svg),Ge=xt(),nn=xt(-1),wn=xt(1);switch($e.property){case"x":return(Ge.x-Vt.x)*Vt.w;case"y":return(Ge.y-Vt.y)*Vt.h;case"angle":return Math.atan2(wn.y-nn.y,wn.x-nn.x)*180/Math.PI}}var _n=/-?\d*\.?\d+/g;function In($e,et){var xt=Ee(A.pth($e)?$e.totalLength:$e,et)+"";return{original:xt,numbers:xt.match(_n)?xt.match(_n).map(Number):[0],strings:A.str($e)||et?xt.split(_n):[]}}function Yr($e){var et=$e?pe(A.arr($e)?$e.map(we):we($e)):[];return be(et,function(xt,Vt,Ge){return Ge.indexOf(xt)===Vt})}function Zn($e){var et=Yr($e);return et.map(function(xt,Vt){return{target:xt,id:Vt,total:et.length,transforms:{list:Ci(xt)}}})}var Ii=/^spring/;function Pr($e,et){var xt=Ie(et);if(Ii.test(xt.easing)&&(xt.duration=B(xt.easing)),A.arr($e)){var Vt=$e.length,Ge=Vt===2&&!A.obj($e[0]);Ge?$e={value:$e}:A.fnc(et.duration)||(xt.duration=et.duration/Vt)}var nn=A.arr($e)?$e:[$e];return nn.map(function(wn,qn){var Sn=A.obj(wn)&&!A.pth(wn)?wn:{value:wn};return A.und(Sn.delay)&&(Sn.delay=qn?0:et.delay),A.und(Sn.endDelay)&&(Sn.endDelay=qn===nn.length-1?et.endDelay:0),Sn}).map(function(wn){return Ue(wn,xt)})}function St($e){for(var et=be(pe($e.map(function(nn){return Object.keys(nn)})),function(nn){return A.key(nn)}).reduce(function(nn,wn){return nn.indexOf(wn)<0&&nn.push(wn),nn},[]),xt={},Vt=function(nn){var wn=et[nn];xt[wn]=$e.map(function(qn){var Sn={};for(var Xt in qn)A.key(Xt)?Xt==wn&&(Sn.value=qn[Xt]):Sn[Xt]=qn[Xt];return Sn})},Ge=0;Ge<et.length;Ge++)Vt(Ge);return xt}function Kt($e,et){var xt=[],Vt=et.keyframes;Vt&&(et=Ue(St(Vt),et));for(var Ge in et)A.key(Ge)&&xt.push({name:Ge,tweens:Pr(et[Ge],$e)});return xt}function vn($e,et){var xt={};for(var Vt in $e){var Ge=_i($e[Vt],et);A.arr(Ge)&&(Ge=Ge.map(function(nn){return _i(nn,et)}),Ge.length===1&&(Ge=Ge[0])),xt[Vt]=Ge}return xt.duration=parseFloat(xt.duration),xt.delay=parseFloat(xt.delay),xt}function cr($e,et){var xt;return $e.tweens.map(function(Vt){var Ge=vn(Vt,et),nn=Ge.value,wn=A.arr(nn)?nn[1]:nn,qn=Mn(wn),Sn=tn(et.target,$e.name,qn,et),Xt=xt?xt.to.original:Sn,nr=A.arr(nn)?nn[0]:Xt,yr=Mn(nr)||Mn(Sn),Tr=qn||yr;return A.und(wn)&&(wn=Xt),Ge.from=In(nr,Tr),Ge.to=In(J(wn,nr),Tr),Ge.start=xt?xt.end:0,Ge.end=Ge.start+Ge.delay+Ge.duration+Ge.endDelay,Ge.easing=ue(Ge.easing,Ge.duration),Ge.isPath=A.pth(nn),Ge.isColor=A.col(Ge.from.original),Ge.isColor&&(Ge.round=1),xt=Ge,Ge})}var ir={css:function($e,et,xt){return $e.style[et]=xt},attribute:function($e,et,xt){return $e.setAttribute(et,xt)},object:function($e,et,xt){return $e[et]=xt},transform:function($e,et,xt,Vt,Ge){if(Vt.list.set(et,xt),et===Vt.last||Ge){var nn="";Vt.list.forEach(function(wn,qn){nn+=qn+"("+wn+") "}),$e.style.transform=nn}}};function xr($e,et){for(var xt=Zn($e),Vt=0,Ge=xt.length;Vt<Ge;Vt++){var nn=xt[Vt];for(var wn in et){var qn=_i(et[wn],nn),Sn=nn.target,Xt=Mn(qn),nr=tn(Sn,wn,Xt,nn),yr=Xt||Mn(nr),Tr=J(Ee(qn,yr),nr),qi=Di(Sn,wn);ir[qi](Sn,wn,Tr,nn.transforms,!0)}}}function Ir($e,et){var xt=Di($e.target,et.name);if(xt){var Vt=cr(et,$e),Ge=Vt[Vt.length-1];return{type:xt,property:et.name,animatable:$e,tweens:Vt,duration:Ge.end,delay:Vt[0].delay,endDelay:Ge.endDelay}}}function Sr($e,et){return be(pe($e.map(function(xt){return et.map(function(Vt){return Ir(xt,Vt)})})),function(xt){return!A.und(xt)})}function gi($e,et){var xt=$e.length,Vt=function(nn){return nn.timelineOffset?nn.timelineOffset:0},Ge={};return Ge.duration=xt?Math.max.apply(Math,$e.map(function(nn){return Vt(nn)+nn.duration})):et.duration,Ge.delay=xt?Math.min.apply(Math,$e.map(function(nn){return Vt(nn)+nn.delay})):et.delay,Ge.endDelay=xt?Ge.duration-Math.max.apply(Math,$e.map(function(nn){return Vt(nn)+nn.duration-nn.endDelay})):et.endDelay,Ge}var yi=0;function hs($e){var et=Ae(E,$e),xt=Ae(z,$e),Vt=Kt(xt,$e),Ge=Zn($e.targets),nn=Sr(Ge,Vt),wn=gi(nn,xt),qn=yi;return yi++,Ue(et,{id:qn,children:[],animatables:Ge,animations:nn,duration:wn.duration,delay:wn.delay,endDelay:wn.endDelay})}var ti=[],Vi=[],Rn,wo=function(){function $e(){Rn=requestAnimationFrame(et)}function et(xt){var Vt=ti.length;if(Vt){for(var Ge=0;Ge<Vt;){var nn=ti[Ge];if(!nn.paused)nn.tick(xt);else{var wn=ti.indexOf(nn);wn>-1&&(ti.splice(wn,1),Vt=ti.length)}Ge++}$e()}else Rn=cancelAnimationFrame(Rn)}return $e}();function Xi(){if(document.hidden){for(var $e=0,et=ti.length;$e<et;$e++)activeInstance[$e].pause();Vi=ti.slice(0),ti=[]}else for(var xt=0,Vt=Vi.length;xt<Vt;xt++)Vi[xt].play()}document.addEventListener("visibilitychange",Xi);function Fi($e){$e===void 0&&($e={});var et=0,xt=0,Vt=0,Ge,nn=0,wn=null;function qn(){return window.Promise&&new Promise(function(Mr){return wn=Mr})}var Sn=qn(),Xt=hs($e);function nr(){Xt.reversed=!Xt.reversed;for(var Mr=0,jr=Ge.length;Mr<jr;Mr++)Ge[Mr].reversed=Xt.reversed}function yr(Mr){return Xt.reversed?Xt.duration-Mr:Mr}function Tr(){et=0,xt=yr(Xt.currentTime)*(1/Fi.speed)}function qi(Mr,jr){jr&&jr.seek(Mr-jr.timelineOffset)}function ai(Mr){if(Xt.reversePlayback)for(var Xr=nn;Xr--;)qi(Mr,Ge[Xr]);else for(var jr=0;jr<nn;jr++)qi(Mr,Ge[jr])}function Vr(Mr){for(var jr=0,Xr=Xt.animations,qs=Xr.length;jr<qs;){var Bi=Xr[jr],Ki=Bi.animatable,le=Bi.tweens,de=le.length-1,_e=le[de];de&&(_e=be(le,function(Ji){return Mr<Ji.end})[0]||_e);for(var Ne=k(Mr-_e.start-_e.delay,0,_e.duration)/_e.duration,He=isNaN(Ne)?1:_e.easing(Ne),ct=_e.to.strings,gt=_e.round,Yt=[],Qt=_e.to.numbers.length,At=void 0,Pt=0;Pt<Qt;Pt++){var hn=void 0,zn=_e.to.numbers[Pt],Kn=_e.from.numbers[Pt]||0;_e.isPath?hn=gn(_e.value,He*zn):hn=Kn+He*(zn-Kn),gt&&(_e.isColor&&Pt>2||(hn=Math.round(hn*gt)/gt)),Yt.push(hn)}var hr=ct.length;if(!hr)At=Yt[0];else{At=ct[0];for(var Rr=0;Rr<hr;Rr++){var Nr=ct[Rr],kr=ct[Rr+1],ki=Yt[Rr];isNaN(ki)||(kr?At+=ki+kr:At+=ki+" ")}}ir[Bi.type](Ki.target,Bi.property,At,Ki.transforms),Bi.currentValue=At,jr++}}function ui(Mr){Xt[Mr]&&!Xt.passThrough&&Xt[Mr](Xt)}function Zi(){Xt.remaining&&Xt.remaining!==!0&&Xt.remaining--}function ks(Mr){var jr=Xt.duration,Xr=Xt.delay,qs=jr-Xt.endDelay,Bi=yr(Mr);Xt.progress=k(Bi/jr*100,0,100),Xt.reversePlayback=Bi<Xt.currentTime,Ge&&ai(Bi),!Xt.began&&Xt.currentTime>0&&(Xt.began=!0,ui("begin"),ui("loopBegin")),Bi<=Xr&&Xt.currentTime!==0&&Vr(0),(Bi>=qs&&Xt.currentTime!==jr||!jr)&&Vr(jr),Bi>Xr&&Bi<qs?(Xt.changeBegan||(Xt.changeBegan=!0,Xt.changeCompleted=!1,ui("changeBegin")),ui("change"),Vr(Bi)):Xt.changeBegan&&(Xt.changeCompleted=!0,Xt.changeBegan=!1,ui("changeComplete")),Xt.currentTime=k(Bi,0,jr),Xt.began&&ui("update"),Mr>=jr&&(xt=0,Zi(),Xt.remaining?(et=Vt,ui("loopComplete"),ui("loopBegin"),Xt.direction==="alternate"&&nr()):(Xt.paused=!0,Xt.completed||(Xt.completed=!0,ui("loopComplete"),ui("complete"),"Promise"in window&&(wn(),Sn=qn()))))}return Xt.reset=function(){var Mr=Xt.direction;Xt.passThrough=!1,Xt.currentTime=0,Xt.progress=0,Xt.paused=!0,Xt.began=!1,Xt.changeBegan=!1,Xt.completed=!1,Xt.changeCompleted=!1,Xt.reversePlayback=!1,Xt.reversed=Mr==="reverse",Xt.remaining=Xt.loop,Ge=Xt.children,nn=Ge.length;for(var jr=nn;jr--;)Xt.children[jr].reset();(Xt.reversed&&Xt.loop!==!0||Mr==="alternate"&&Xt.loop===1)&&Xt.remaining++,Vr(0)},Xt.set=function(Mr,jr){return xr(Mr,jr),Xt},Xt.tick=function(Mr){Vt=Mr,et||(et=Vt),ks((Vt+(xt-et))*Fi.speed)},Xt.seek=function(Mr){ks(yr(Mr))},Xt.pause=function(){Xt.paused=!0,Tr()},Xt.play=function(){!Xt.paused||(Xt.paused=!1,ti.push(Xt),Tr(),Rn||wo())},Xt.reverse=function(){nr(),Tr()},Xt.restart=function(){Xt.reset(),Xt.play()},Xt.finished=Sn,Xt.reset(),Xt.autoplay&&Xt.play(),Xt}function li($e,et){for(var xt=et.length;xt--;)he($e,et[xt].animatable.target)&&et.splice(xt,1)}function aa($e){for(var et=Yr($e),xt=ti.length;xt--;){var Vt=ti[xt],Ge=Vt.animations,nn=Vt.children;li(et,Ge);for(var wn=nn.length;wn--;){var qn=nn[wn],Sn=qn.animations;li(et,Sn),!Sn.length&&!qn.children.length&&nn.splice(wn,1)}!Ge.length&&!nn.length&&Vt.pause()}}function nc($e,et){et===void 0&&(et={});var xt=et.direction||"normal",Vt=et.easing?ue(et.easing):null,Ge=et.grid,nn=et.axis,wn=et.from||0,qn=wn==="first",Sn=wn==="center",Xt=wn==="last",nr=A.arr($e),yr=parseFloat(nr?$e[0]:$e),Tr=nr?parseFloat($e[1]):0,qi=Mn(nr?$e[1]:$e)||0,ai=et.start||0+(nr?yr:0),Vr=[],ui=0;return function(Zi,ks,Mr){if(qn&&(wn=0),Sn&&(wn=(Mr-1)/2),Xt&&(wn=Mr-1),!Vr.length){for(var jr=0;jr<Mr;jr++){if(!Ge)Vr.push(Math.abs(wn-jr));else{var Xr=Sn?(Ge[0]-1)/2:wn%Ge[0],qs=Sn?(Ge[1]-1)/2:Math.floor(wn/Ge[0]),Bi=jr%Ge[0],Ki=Math.floor(jr/Ge[0]),le=Xr-Bi,de=qs-Ki,_e=Math.sqrt(le*le+de*de);nn==="x"&&(_e=-le),nn==="y"&&(_e=-de),Vr.push(_e)}ui=Math.max.apply(Math,Vr)}Vt&&(Vr=Vr.map(function(He){return Vt(He/ui)*ui})),xt==="reverse"&&(Vr=Vr.map(function(He){return nn?He<0?He*-1:-He:Math.abs(ui-He)}))}var Ne=nr?(Tr-yr)/ui:yr;return ai+Ne*(Math.round(Vr[ks]*100)/100)+qi}}function zs($e){$e===void 0&&($e={});var et=Fi($e);return et.duration=0,et.add=function(xt,Vt){var Ge=ti.indexOf(et),nn=et.children;Ge>-1&&ti.splice(Ge,1);function wn(Tr){Tr.passThrough=!0}for(var qn=0;qn<nn.length;qn++)wn(nn[qn]);var Sn=Ue(xt,Ae(z,$e));Sn.targets=Sn.targets||$e.targets;var Xt=et.duration;Sn.autoplay=!1,Sn.direction=et.direction,Sn.timelineOffset=A.und(Vt)?Xt:J(Vt,Xt),wn(et),et.seek(Sn.timelineOffset);var nr=Fi(Sn);wn(nr),nn.push(nr);var yr=gi(nn,$e);return et.delay=yr.delay,et.endDelay=yr.endDelay,et.duration=yr.duration,et.seek(0),et.reset(),et.autoplay&&et.play(),et},et}Fi.version="3.0.0",Fi.speed=1,Fi.running=ti,Fi.remove=aa,Fi.get=tn,Fi.set=xr,Fi.convertPx=mi,Fi.path=mn,Fi.setDashoffset=Ye,Fi.stagger=nc,Fi.timeline=zs,Fi.easing=ue,Fi.penner=Q,Fi.random=function($e,et){return Math.floor(Math.random()*(et-$e+1))+$e},re.exports=Fi},{}],57:[function(V,re,ae){(function(E,z){typeof ae=="object"&&typeof re<"u"?z(ae):typeof ji=="function"&&ji.amd?ji(["exports"],z):(E=typeof globalThis<"u"?globalThis:E||self,z(E.THREE={}))})(this,function(E){"use strict";let z="137",P={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},L={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},k=0,C=1,M=2,I=3,b=0,T=1,A=2,_=3,D=0,B=1,$=2,j=1,q=2,Q=0,ue=1,xe=2,Se=3,be=4,pe=5,we=100,he=101,Ie=102,Ae=103,Ue=104,Qe=200,ht=201,lt=202,Et=203,Mt=204,ln=205,Tn=206,xn=207,Qn=208,Cn=209,Mn=210,Ar=0,_i=1,si=2,mi=3,Qi=4,Di=5,Kr=6,Ci=7,ss=0,tn=1,ye=2,J=0,Me=1,Ee=2,ke=3,ee=4,ie=5,X=300,te=301,me=302,Le=303,Ye=304,rt=306,Wt=307,mn=1e3,gn=1001,_n=1002,In=1003,Yr=1004,Zn=1004,Ii=1005,Pr=1005,St=1006,Kt=1007,vn=1007,cr=1008,ir=1008,xr=1009,Ir=1010,Sr=1011,gi=1012,yi=1013,hs=1014,ti=1015,Vi=1016,Rn=1017,wo=1018,Xi=1020,Fi=1021,li=1023,aa=1024,nc=1025,zs=1026,$e=1027,et=1028,xt=1029,Vt=1030,Ge=1031,nn=1033,wn=33776,qn=33777,Sn=33778,Xt=33779,nr=35840,yr=35841,Tr=35842,qi=35843,ai=36196,Vr=37492,ui=37496,Zi=37808,ks=37809,Mr=37810,jr=37811,Xr=37812,qs=37813,Bi=37814,Ki=37815,le=37816,de=37817,_e=37818,Ne=37819,He=37820,ct=37821,gt=36492,Yt=2200,Qt=2201,At=2202,Pt=2300,hn=2301,zn=2302,Kn=2400,hr=2401,Rr=2402,Nr=2500,kr=2501,ki=0,Ji=1,vs=2,Ei=3e3,Qr=3001,oa=3200,la=3201,bs=0,ua=1,Ao=0,Eo=7680,dl=7681,Pl=7682,Ol=7683,Oo=34055,Bl=34056,Bo=5386,Ul=512,Uo=513,pl=514,zo=515,xs=516,rd=517,Jf=518,gp=519,vu=35044,fl=35048,id=35040,yp=35045,vp=35049,em=35041,bp=35046,sd=35050,ad=35042,tm="100",od="300 es",bu=1035;class to{addEventListener(r,o){this._listeners===void 0&&(this._listeners={});let c=this._listeners;c[r]===void 0&&(c[r]=[]),c[r].indexOf(o)===-1&&c[r].push(o)}hasEventListener(r,o){if(this._listeners===void 0)return!1;let c=this._listeners;return c[r]!==void 0&&c[r].indexOf(o)!==-1}removeEventListener(r,o){if(this._listeners===void 0)return;let p=this._listeners[r];if(p!==void 0){let v=p.indexOf(o);v!==-1&&p.splice(v,1)}}dispatchEvent(r){if(this._listeners===void 0)return;let c=this._listeners[r.type];if(c!==void 0){r.target=this;let p=c.slice(0);for(let v=0,w=p.length;v<w;v++)p[v].call(this,r);r.target=null}}}let $s=[];for(let y=0;y<256;y++)$s[y]=(y<16?"0":"")+y.toString(16);let rc=1234567,ml=Math.PI/180,xu=180/Math.PI;function Da(){let y=Math.random()*4294967295|0,r=Math.random()*4294967295|0,o=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return($s[y&255]+$s[y>>8&255]+$s[y>>16&255]+$s[y>>24&255]+"-"+$s[r&255]+$s[r>>8&255]+"-"+$s[r>>16&15|64]+$s[r>>24&255]+"-"+$s[o&63|128]+$s[o>>8&255]+"-"+$s[o>>16&255]+$s[o>>24&255]+$s[c&255]+$s[c>>8&255]+$s[c>>16&255]+$s[c>>24&255]).toUpperCase()}function Vs(y,r,o){return Math.max(r,Math.min(o,y))}function ic(y,r){return(y%r+r)%r}function xp(y,r,o,c,p){return c+(y-r)*(p-c)/(o-r)}function wp(y,r,o){return y!==r?(o-y)/(r-y):0}function wu(y,r,o){return(1-o)*y+o*r}function av(y,r,o,c){return wu(y,r,1-Math.exp(-o*c))}function Ap(y,r=1){return r-Math.abs(ic(y,r*2)-r)}function nm(y,r,o){return y<=r?0:y>=o?1:(y=(y-r)/(o-r),y*y*(3-2*y))}function Ep(y,r,o){return y<=r?0:y>=o?1:(y=(y-r)/(o-r),y*y*y*(y*(y*6-15)+10))}function ld(y,r){return y+Math.floor(Math.random()*(r-y+1))}function Sp(y,r){return y+Math.random()*(r-y)}function rm(y){return y*(.5-Math.random())}function Tp(y){return y!==void 0&&(rc=y%2147483647),rc=rc*16807%2147483647,(rc-1)/2147483646}function im(y){return y*ml}function sm(y){return y*xu}function nh(y){return(y&y-1)===0&&y!==0}function ud(y){return Math.pow(2,Math.ceil(Math.log(y)/Math.LN2))}function rh(y){return Math.pow(2,Math.floor(Math.log(y)/Math.LN2))}function Mp(y,r,o,c,p){let v=Math.cos,w=Math.sin,S=v(o/2),O=w(o/2),U=v((r+c)/2),K=w((r+c)/2),Y=v((r-c)/2),Z=w((r-c)/2),ne=v((c-r)/2),ce=w((c-r)/2);switch(p){case"XYX":y.set(S*K,O*Y,O*Z,S*U);break;case"YZY":y.set(O*Z,S*K,O*Y,S*U);break;case"ZXZ":y.set(O*Y,O*Z,S*K,S*U);break;case"XZX":y.set(S*K,O*ce,O*ne,S*U);break;case"YXY":y.set(O*ne,S*K,O*ce,S*U);break;case"ZYZ":y.set(O*ce,O*ne,S*K,S*U);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+p)}}var ih=Object.freeze({__proto__:null,DEG2RAD:ml,RAD2DEG:xu,generateUUID:Da,clamp:Vs,euclideanModulo:ic,mapLinear:xp,inverseLerp:wp,lerp:wu,damp:av,pingpong:Ap,smoothstep:nm,smootherstep:Ep,randInt:ld,randFloat:Sp,randFloatSpread:rm,seededRandom:Tp,degToRad:im,radToDeg:sm,isPowerOfTwo:nh,ceilPowerOfTwo:ud,floorPowerOfTwo:rh,setQuaternionFromProperEuler:Mp});class un{constructor(r=0,o=0){this.x=r,this.y=o}get width(){return this.x}set width(r){this.x=r}get height(){return this.y}set height(r){this.y=r}set(r,o){return this.x=r,this.y=o,this}setScalar(r){return this.x=r,this.y=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setComponent(r,o){switch(r){case 0:this.x=o;break;case 1:this.y=o;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y)}copy(r){return this.x=r.x,this.y=r.y,this}add(r,o){return o!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(r,o)):(this.x+=r.x,this.y+=r.y,this)}addScalar(r){return this.x+=r,this.y+=r,this}addVectors(r,o){return this.x=r.x+o.x,this.y=r.y+o.y,this}addScaledVector(r,o){return this.x+=r.x*o,this.y+=r.y*o,this}sub(r,o){return o!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(r,o)):(this.x-=r.x,this.y-=r.y,this)}subScalar(r){return this.x-=r,this.y-=r,this}subVectors(r,o){return this.x=r.x-o.x,this.y=r.y-o.y,this}multiply(r){return this.x*=r.x,this.y*=r.y,this}multiplyScalar(r){return this.x*=r,this.y*=r,this}divide(r){return this.x/=r.x,this.y/=r.y,this}divideScalar(r){return this.multiplyScalar(1/r)}applyMatrix3(r){let o=this.x,c=this.y,p=r.elements;return this.x=p[0]*o+p[3]*c+p[6],this.y=p[1]*o+p[4]*c+p[7],this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this}clamp(r,o){return this.x=Math.max(r.x,Math.min(o.x,this.x)),this.y=Math.max(r.y,Math.min(o.y,this.y)),this}clampScalar(r,o){return this.x=Math.max(r,Math.min(o,this.x)),this.y=Math.max(r,Math.min(o,this.y)),this}clampLength(r,o){let c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(r,Math.min(o,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(r){return this.x*r.x+this.y*r.y}cross(r){return this.x*r.y-this.y*r.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){let o=this.x-r.x,c=this.y-r.y;return o*o+c*c}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,o){return this.x+=(r.x-this.x)*o,this.y+=(r.y-this.y)*o,this}lerpVectors(r,o,c){return this.x=r.x+(o.x-r.x)*c,this.y=r.y+(o.y-r.y)*c,this}equals(r){return r.x===this.x&&r.y===this.y}fromArray(r,o=0){return this.x=r[o],this.y=r[o+1],this}toArray(r=[],o=0){return r[o]=this.x,r[o+1]=this.y,r}fromBufferAttribute(r,o,c){return c!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=r.getX(o),this.y=r.getY(o),this}rotateAround(r,o){let c=Math.cos(o),p=Math.sin(o),v=this.x-r.x,w=this.y-r.y;return this.x=v*c-w*p+r.x,this.y=v*p+w*c+r.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}un.prototype.isVector2=!0;class Ts{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(r,o,c,p,v,w,S,O,U){let K=this.elements;return K[0]=r,K[1]=p,K[2]=S,K[3]=o,K[4]=v,K[5]=O,K[6]=c,K[7]=w,K[8]=U,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){let o=this.elements,c=r.elements;return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=c[7],o[8]=c[8],this}extractBasis(r,o,c){return r.setFromMatrix3Column(this,0),o.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(r){let o=r.elements;return this.set(o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]),this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,o){let c=r.elements,p=o.elements,v=this.elements,w=c[0],S=c[3],O=c[6],U=c[1],K=c[4],Y=c[7],Z=c[2],ne=c[5],ce=c[8],ve=p[0],Fe=p[3],fe=p[6],oe=p[1],Pe=p[4],Re=p[7],We=p[2],Je=p[5],dt=p[8];return v[0]=w*ve+S*oe+O*We,v[3]=w*Fe+S*Pe+O*Je,v[6]=w*fe+S*Re+O*dt,v[1]=U*ve+K*oe+Y*We,v[4]=U*Fe+K*Pe+Y*Je,v[7]=U*fe+K*Re+Y*dt,v[2]=Z*ve+ne*oe+ce*We,v[5]=Z*Fe+ne*Pe+ce*Je,v[8]=Z*fe+ne*Re+ce*dt,this}multiplyScalar(r){let o=this.elements;return o[0]*=r,o[3]*=r,o[6]*=r,o[1]*=r,o[4]*=r,o[7]*=r,o[2]*=r,o[5]*=r,o[8]*=r,this}determinant(){let r=this.elements,o=r[0],c=r[1],p=r[2],v=r[3],w=r[4],S=r[5],O=r[6],U=r[7],K=r[8];return o*w*K-o*S*U-c*v*K+c*S*O+p*v*U-p*w*O}invert(){let r=this.elements,o=r[0],c=r[1],p=r[2],v=r[3],w=r[4],S=r[5],O=r[6],U=r[7],K=r[8],Y=K*w-S*U,Z=S*O-K*v,ne=U*v-w*O,ce=o*Y+c*Z+p*ne;if(ce===0)return this.set(0,0,0,0,0,0,0,0,0);let ve=1/ce;return r[0]=Y*ve,r[1]=(p*U-K*c)*ve,r[2]=(S*c-p*w)*ve,r[3]=Z*ve,r[4]=(K*o-p*O)*ve,r[5]=(p*v-S*o)*ve,r[6]=ne*ve,r[7]=(c*O-U*o)*ve,r[8]=(w*o-c*v)*ve,this}transpose(){let r,o=this.elements;return r=o[1],o[1]=o[3],o[3]=r,r=o[2],o[2]=o[6],o[6]=r,r=o[5],o[5]=o[7],o[7]=r,this}getNormalMatrix(r){return this.setFromMatrix4(r).invert().transpose()}transposeIntoArray(r){let o=this.elements;return r[0]=o[0],r[1]=o[3],r[2]=o[6],r[3]=o[1],r[4]=o[4],r[5]=o[7],r[6]=o[2],r[7]=o[5],r[8]=o[8],this}setUvTransform(r,o,c,p,v,w,S){let O=Math.cos(v),U=Math.sin(v);return this.set(c*O,c*U,-c*(O*w+U*S)+w+r,-p*U,p*O,-p*(-U*w+O*S)+S+o,0,0,1),this}scale(r,o){let c=this.elements;return c[0]*=r,c[3]*=r,c[6]*=r,c[1]*=o,c[4]*=o,c[7]*=o,this}rotate(r){let o=Math.cos(r),c=Math.sin(r),p=this.elements,v=p[0],w=p[3],S=p[6],O=p[1],U=p[4],K=p[7];return p[0]=o*v+c*O,p[3]=o*w+c*U,p[6]=o*S+c*K,p[1]=-c*v+o*O,p[4]=-c*w+o*U,p[7]=-c*S+o*K,this}translate(r,o){let c=this.elements;return c[0]+=r*c[2],c[3]+=r*c[5],c[6]+=r*c[8],c[1]+=o*c[2],c[4]+=o*c[5],c[7]+=o*c[8],this}equals(r){let o=this.elements,c=r.elements;for(let p=0;p<9;p++)if(o[p]!==c[p])return!1;return!0}fromArray(r,o=0){for(let c=0;c<9;c++)this.elements[c]=r[c+o];return this}toArray(r=[],o=0){let c=this.elements;return r[o]=c[0],r[o+1]=c[1],r[o+2]=c[2],r[o+3]=c[3],r[o+4]=c[4],r[o+5]=c[5],r[o+6]=c[6],r[o+7]=c[7],r[o+8]=c[8],r}clone(){return new this.constructor().fromArray(this.elements)}}Ts.prototype.isMatrix3=!0;function cd(y){for(let r=y.length-1;r>=0;--r)if(y[r]>65535)return!0;return!1}let _p={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Au(y,r){return new _p[y](r)}function sc(y){return document.createElementNS("http://www.w3.org/1999/xhtml",y)}let Cp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ga={h:0,s:0,l:0},ac={h:0,s:0,l:0};function sh(y,r,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?y+(r-y)*6*o:o<1/2?r:o<2/3?y+(r-y)*6*(2/3-o):y}function zl(y){return y<.04045?y*.0773993808:Math.pow(y*.9478672986+.0521327014,2.4)}function Hg(y){return y<.0031308?y*12.92:1.055*Math.pow(y,.41666)-.055}class Fn{constructor(r,o,c){return o===void 0&&c===void 0?this.set(r):this.setRGB(r,o,c)}set(r){return r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r),this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,this}setRGB(r,o,c){return this.r=r,this.g=o,this.b=c,this}setHSL(r,o,c){if(r=ic(r,1),o=Vs(o,0,1),c=Vs(c,0,1),o===0)this.r=this.g=this.b=c;else{let p=c<=.5?c*(1+o):c+o-c*o,v=2*c-p;this.r=sh(v,p,r+1/3),this.g=sh(v,p,r),this.b=sh(v,p,r-1/3)}return this}setStyle(r){function o(p){p!==void 0&&parseFloat(p)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let c;if(c=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(r)){let p,v=c[1],w=c[2];switch(v){case"rgb":case"rgba":if(p=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w))return this.r=Math.min(255,parseInt(p[1],10))/255,this.g=Math.min(255,parseInt(p[2],10))/255,this.b=Math.min(255,parseInt(p[3],10))/255,o(p[4]),this;if(p=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w))return this.r=Math.min(100,parseInt(p[1],10))/100,this.g=Math.min(100,parseInt(p[2],10))/100,this.b=Math.min(100,parseInt(p[3],10))/100,o(p[4]),this;break;case"hsl":case"hsla":if(p=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w)){let S=parseFloat(p[1])/360,O=parseInt(p[2],10)/100,U=parseInt(p[3],10)/100;return o(p[4]),this.setHSL(S,O,U)}break}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(r)){let p=c[1],v=p.length;if(v===3)return this.r=parseInt(p.charAt(0)+p.charAt(0),16)/255,this.g=parseInt(p.charAt(1)+p.charAt(1),16)/255,this.b=parseInt(p.charAt(2)+p.charAt(2),16)/255,this;if(v===6)return this.r=parseInt(p.charAt(0)+p.charAt(1),16)/255,this.g=parseInt(p.charAt(2)+p.charAt(3),16)/255,this.b=parseInt(p.charAt(4)+p.charAt(5),16)/255,this}return r&&r.length>0?this.setColorName(r):this}setColorName(r){let o=Cp[r.toLowerCase()];return o!==void 0?this.setHex(o):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=zl(r.r),this.g=zl(r.g),this.b=zl(r.b),this}copyLinearToSRGB(r){return this.r=Hg(r.r),this.g=Hg(r.g),this.b=Hg(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(r){let o=this.r,c=this.g,p=this.b,v=Math.max(o,c,p),w=Math.min(o,c,p),S,O,U=(w+v)/2;if(w===v)S=0,O=0;else{let K=v-w;switch(O=U<=.5?K/(v+w):K/(2-v-w),v){case o:S=(c-p)/K+(c<p?6:0);break;case c:S=(p-o)/K+2;break;case p:S=(o-c)/K+4;break}S/=6}return r.h=S,r.s=O,r.l=U,r}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(r,o,c){return this.getHSL(Ga),Ga.h+=r,Ga.s+=o,Ga.l+=c,this.setHSL(Ga.h,Ga.s,Ga.l),this}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,o){return this.r=r.r+o.r,this.g=r.g+o.g,this.b=r.b+o.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,o){return this.r+=(r.r-this.r)*o,this.g+=(r.g-this.g)*o,this.b+=(r.b-this.b)*o,this}lerpColors(r,o,c){return this.r=r.r+(o.r-r.r)*c,this.g=r.g+(o.g-r.g)*c,this.b=r.b+(o.b-r.b)*c,this}lerpHSL(r,o){this.getHSL(Ga),r.getHSL(ac);let c=wu(Ga.h,ac.h,o),p=wu(Ga.s,ac.s,o),v=wu(Ga.l,ac.l,o);return this.setHSL(c,p,v),this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,o=0){return this.r=r[o],this.g=r[o+1],this.b=r[o+2],this}toArray(r=[],o=0){return r[o]=this.r,r[o+1]=this.g,r[o+2]=this.b,r}fromBufferAttribute(r,o){return this.r=r.getX(o),this.g=r.getY(o),this.b=r.getZ(o),r.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Fn.NAMES=Cp,Fn.prototype.isColor=!0,Fn.prototype.r=1,Fn.prototype.g=1,Fn.prototype.b=1;let $l;class gl{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let o;if(r instanceof HTMLCanvasElement)o=r;else{$l===void 0&&($l=sc("canvas")),$l.width=r.width,$l.height=r.height;let c=$l.getContext("2d");r instanceof ImageData?c.putImageData(r,0,0):c.drawImage(r,0,0,r.width,r.height),o=$l}return o.width>2048||o.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),o.toDataURL("image/jpeg",.6)):o.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){let o=sc("canvas");o.width=r.width,o.height=r.height;let c=o.getContext("2d");c.drawImage(r,0,0,r.width,r.height);let p=c.getImageData(0,0,r.width,r.height),v=p.data;for(let w=0;w<v.length;w++)v[w]=zl(v[w]/255)*255;return c.putImageData(p,0,0),o}else if(r.data){let o=r.data.slice(0);for(let c=0;c<o.length;c++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[c]=Math.floor(zl(o[c]/255)*255):o[c]=zl(o[c]);return{data:o,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}}let am=0;class Rs extends to{constructor(r=Rs.DEFAULT_IMAGE,o=Rs.DEFAULT_MAPPING,c=gn,p=gn,v=St,w=cr,S=li,O=xr,U=1,K=Ei){super(),Object.defineProperty(this,"id",{value:am++}),this.uuid=Da(),this.name="",this.image=r,this.mipmaps=[],this.mapping=o,this.wrapS=c,this.wrapT=p,this.magFilter=v,this.minFilter=w,this.anisotropy=U,this.format=S,this.internalFormat=null,this.type=O,this.offset=new un(0,0),this.repeat=new un(1,1),this.center=new un(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ts,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=K,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(r){return this.name=r.name,this.image=r.image,this.mipmaps=r.mipmaps.slice(0),this.mapping=r.mapping,this.wrapS=r.wrapS,this.wrapT=r.wrapT,this.magFilter=r.magFilter,this.minFilter=r.minFilter,this.anisotropy=r.anisotropy,this.format=r.format,this.internalFormat=r.internalFormat,this.type=r.type,this.offset.copy(r.offset),this.repeat.copy(r.repeat),this.center.copy(r.center),this.rotation=r.rotation,this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrix.copy(r.matrix),this.generateMipmaps=r.generateMipmaps,this.premultiplyAlpha=r.premultiplyAlpha,this.flipY=r.flipY,this.unpackAlignment=r.unpackAlignment,this.encoding=r.encoding,this.userData=JSON.parse(JSON.stringify(r.userData)),this}toJSON(r){let o=r===void 0||typeof r=="string";if(!o&&r.textures[this.uuid]!==void 0)return r.textures[this.uuid];let c={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let p=this.image;if(p.uuid===void 0&&(p.uuid=Da()),!o&&r.images[p.uuid]===void 0){let v;if(Array.isArray(p)){v=[];for(let w=0,S=p.length;w<S;w++)p[w].isDataTexture?v.push(oc(p[w].image)):v.push(oc(p[w]))}else v=oc(p);r.images[p.uuid]={uuid:p.uuid,url:v}}c.image=p.uuid}return JSON.stringify(this.userData)!=="{}"&&(c.userData=this.userData),o||(r.textures[this.uuid]=c),c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(r){if(this.mapping!==X)return r;if(r.applyMatrix3(this.matrix),r.x<0||r.x>1)switch(this.wrapS){case mn:r.x=r.x-Math.floor(r.x);break;case gn:r.x=r.x<0?0:1;break;case _n:Math.abs(Math.floor(r.x)%2)===1?r.x=Math.ceil(r.x)-r.x:r.x=r.x-Math.floor(r.x);break}if(r.y<0||r.y>1)switch(this.wrapT){case mn:r.y=r.y-Math.floor(r.y);break;case gn:r.y=r.y<0?0:1;break;case _n:Math.abs(Math.floor(r.y)%2)===1?r.y=Math.ceil(r.y)-r.y:r.y=r.y-Math.floor(r.y);break}return this.flipY&&(r.y=1-r.y),r}set needsUpdate(r){r===!0&&this.version++}}Rs.DEFAULT_IMAGE=void 0,Rs.DEFAULT_MAPPING=X,Rs.prototype.isTexture=!0;function oc(y){return typeof HTMLImageElement<"u"&&y instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&y instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&y instanceof ImageBitmap?gl.getDataURL(y):y.data?{data:Array.prototype.slice.call(y.data),width:y.width,height:y.height,type:y.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Si{constructor(r=0,o=0,c=0,p=1){this.x=r,this.y=o,this.z=c,this.w=p}get width(){return this.z}set width(r){this.z=r}get height(){return this.w}set height(r){this.w=r}set(r,o,c,p){return this.x=r,this.y=o,this.z=c,this.w=p,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this.w=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setW(r){return this.w=r,this}setComponent(r,o){switch(r){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;case 3:this.w=o;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w!==void 0?r.w:1,this}add(r,o){return o!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(r,o)):(this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this)}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this.w+=r,this}addVectors(r,o){return this.x=r.x+o.x,this.y=r.y+o.y,this.z=r.z+o.z,this.w=r.w+o.w,this}addScaledVector(r,o){return this.x+=r.x*o,this.y+=r.y*o,this.z+=r.z*o,this.w+=r.w*o,this}sub(r,o){return o!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(r,o)):(this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this)}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this.w-=r,this}subVectors(r,o){return this.x=r.x-o.x,this.y=r.y-o.y,this.z=r.z-o.z,this.w=r.w-o.w,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this}applyMatrix4(r){let o=this.x,c=this.y,p=this.z,v=this.w,w=r.elements;return this.x=w[0]*o+w[4]*c+w[8]*p+w[12]*v,this.y=w[1]*o+w[5]*c+w[9]*p+w[13]*v,this.z=w[2]*o+w[6]*c+w[10]*p+w[14]*v,this.w=w[3]*o+w[7]*c+w[11]*p+w[15]*v,this}divideScalar(r){return this.multiplyScalar(1/r)}setAxisAngleFromQuaternion(r){this.w=2*Math.acos(r.w);let o=Math.sqrt(1-r.w*r.w);return o<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=r.x/o,this.y=r.y/o,this.z=r.z/o),this}setAxisAngleFromRotationMatrix(r){let o,c,p,v,O=r.elements,U=O[0],K=O[4],Y=O[8],Z=O[1],ne=O[5],ce=O[9],ve=O[2],Fe=O[6],fe=O[10];if(Math.abs(K-Z)<.01&&Math.abs(Y-ve)<.01&&Math.abs(ce-Fe)<.01){if(Math.abs(K+Z)<.1&&Math.abs(Y+ve)<.1&&Math.abs(ce+Fe)<.1&&Math.abs(U+ne+fe-3)<.1)return this.set(1,0,0,0),this;o=Math.PI;let Pe=(U+1)/2,Re=(ne+1)/2,We=(fe+1)/2,Je=(K+Z)/4,dt=(Y+ve)/4,wt=(ce+Fe)/4;return Pe>Re&&Pe>We?Pe<.01?(c=0,p=.707106781,v=.707106781):(c=Math.sqrt(Pe),p=Je/c,v=dt/c):Re>We?Re<.01?(c=.707106781,p=0,v=.707106781):(p=Math.sqrt(Re),c=Je/p,v=wt/p):We<.01?(c=.707106781,p=.707106781,v=0):(v=Math.sqrt(We),c=dt/v,p=wt/v),this.set(c,p,v,o),this}let oe=Math.sqrt((Fe-ce)*(Fe-ce)+(Y-ve)*(Y-ve)+(Z-K)*(Z-K));return Math.abs(oe)<.001&&(oe=1),this.x=(Fe-ce)/oe,this.y=(Y-ve)/oe,this.z=(Z-K)/oe,this.w=Math.acos((U+ne+fe-1)/2),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this.w=Math.min(this.w,r.w),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this}clamp(r,o){return this.x=Math.max(r.x,Math.min(o.x,this.x)),this.y=Math.max(r.y,Math.min(o.y,this.y)),this.z=Math.max(r.z,Math.min(o.z,this.z)),this.w=Math.max(r.w,Math.min(o.w,this.w)),this}clampScalar(r,o){return this.x=Math.max(r,Math.min(o,this.x)),this.y=Math.max(r,Math.min(o,this.y)),this.z=Math.max(r,Math.min(o,this.z)),this.w=Math.max(r,Math.min(o,this.w)),this}clampLength(r,o){let c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(r,Math.min(o,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,o){return this.x+=(r.x-this.x)*o,this.y+=(r.y-this.y)*o,this.z+=(r.z-this.z)*o,this.w+=(r.w-this.w)*o,this}lerpVectors(r,o,c){return this.x=r.x+(o.x-r.x)*c,this.y=r.y+(o.y-r.y)*c,this.z=r.z+(o.z-r.z)*c,this.w=r.w+(o.w-r.w)*c,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z&&r.w===this.w}fromArray(r,o=0){return this.x=r[o],this.y=r[o+1],this.z=r[o+2],this.w=r[o+3],this}toArray(r=[],o=0){return r[o]=this.x,r[o+1]=this.y,r[o+2]=this.z,r[o+3]=this.w,r}fromBufferAttribute(r,o,c){return c!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=r.getX(o),this.y=r.getY(o),this.z=r.getZ(o),this.w=r.getW(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Si.prototype.isVector4=!0;class Ta extends to{constructor(r,o,c={}){super(),this.width=r,this.height=o,this.depth=1,this.scissor=new Si(0,0,r,o),this.scissorTest=!1,this.viewport=new Si(0,0,r,o),this.texture=new Rs(void 0,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:r,height:o,depth:1},this.texture.generateMipmaps=c.generateMipmaps!==void 0?c.generateMipmaps:!1,this.texture.internalFormat=c.internalFormat!==void 0?c.internalFormat:null,this.texture.minFilter=c.minFilter!==void 0?c.minFilter:St,this.depthBuffer=c.depthBuffer!==void 0?c.depthBuffer:!0,this.stencilBuffer=c.stencilBuffer!==void 0?c.stencilBuffer:!1,this.depthTexture=c.depthTexture!==void 0?c.depthTexture:null}setTexture(r){r.image={width:this.width,height:this.height,depth:this.depth},this.texture=r}setSize(r,o,c=1){(this.width!==r||this.height!==o||this.depth!==c)&&(this.width=r,this.height=o,this.depth=c,this.texture.image.width=r,this.texture.image.height=o,this.texture.image.depth=c,this.dispose()),this.viewport.set(0,0,r,o),this.scissor.set(0,0,r,o)}clone(){return new this.constructor().copy(this)}copy(r){return this.width=r.width,this.height=r.height,this.depth=r.depth,this.viewport.copy(r.viewport),this.texture=r.texture.clone(),this.texture.image=Object.assign({},r.texture.image),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ta.prototype.isWebGLRenderTarget=!0;class hd extends Ta{constructor(r,o,c){super(r,o);let p=this.texture;this.texture=[];for(let v=0;v<c;v++)this.texture[v]=p.clone()}setSize(r,o,c=1){if(this.width!==r||this.height!==o||this.depth!==c){this.width=r,this.height=o,this.depth=c;for(let p=0,v=this.texture.length;p<v;p++)this.texture[p].image.width=r,this.texture[p].image.height=o,this.texture[p].image.depth=c;this.dispose()}return this.viewport.set(0,0,r,o),this.scissor.set(0,0,r,o),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.texture.length=0;for(let o=0,c=r.texture.length;o<c;o++)this.texture[o]=r.texture[o].clone();return this}}hd.prototype.isWebGLMultipleRenderTargets=!0;class ah extends Ta{constructor(r,o,c={}){super(r,o,c),this.samples=4,this.ignoreDepthForMultisampleCopy=c.ignoreDepth!==void 0?c.ignoreDepth:!0,this.useRenderToTexture=c.useRenderToTexture!==void 0?c.useRenderToTexture:!1,this.useRenderbuffer=this.useRenderToTexture===!1}copy(r){return super.copy.call(this,r),this.samples=r.samples,this.useRenderToTexture=r.useRenderToTexture,this.useRenderbuffer=r.useRenderbuffer,this}}ah.prototype.isWebGLMultisampleRenderTarget=!0;class Hs{constructor(r=0,o=0,c=0,p=1){this._x=r,this._y=o,this._z=c,this._w=p}static slerp(r,o,c,p){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),c.slerpQuaternions(r,o,p)}static slerpFlat(r,o,c,p,v,w,S){let O=c[p+0],U=c[p+1],K=c[p+2],Y=c[p+3],Z=v[w+0],ne=v[w+1],ce=v[w+2],ve=v[w+3];if(S===0){r[o+0]=O,r[o+1]=U,r[o+2]=K,r[o+3]=Y;return}if(S===1){r[o+0]=Z,r[o+1]=ne,r[o+2]=ce,r[o+3]=ve;return}if(Y!==ve||O!==Z||U!==ne||K!==ce){let Fe=1-S,fe=O*Z+U*ne+K*ce+Y*ve,oe=fe>=0?1:-1,Pe=1-fe*fe;if(Pe>Number.EPSILON){let We=Math.sqrt(Pe),Je=Math.atan2(We,fe*oe);Fe=Math.sin(Fe*Je)/We,S=Math.sin(S*Je)/We}let Re=S*oe;if(O=O*Fe+Z*Re,U=U*Fe+ne*Re,K=K*Fe+ce*Re,Y=Y*Fe+ve*Re,Fe===1-S){let We=1/Math.sqrt(O*O+U*U+K*K+Y*Y);O*=We,U*=We,K*=We,Y*=We}}r[o]=O,r[o+1]=U,r[o+2]=K,r[o+3]=Y}static multiplyQuaternionsFlat(r,o,c,p,v,w){let S=c[p],O=c[p+1],U=c[p+2],K=c[p+3],Y=v[w],Z=v[w+1],ne=v[w+2],ce=v[w+3];return r[o]=S*ce+K*Y+O*ne-U*Z,r[o+1]=O*ce+K*Z+U*Y-S*ne,r[o+2]=U*ce+K*ne+S*Z-O*Y,r[o+3]=K*ce-S*Y-O*Z-U*ne,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,o,c,p){return this._x=r,this._y=o,this._z=c,this._w=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,o){if(!(r&&r.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let c=r._x,p=r._y,v=r._z,w=r._order,S=Math.cos,O=Math.sin,U=S(c/2),K=S(p/2),Y=S(v/2),Z=O(c/2),ne=O(p/2),ce=O(v/2);switch(w){case"XYZ":this._x=Z*K*Y+U*ne*ce,this._y=U*ne*Y-Z*K*ce,this._z=U*K*ce+Z*ne*Y,this._w=U*K*Y-Z*ne*ce;break;case"YXZ":this._x=Z*K*Y+U*ne*ce,this._y=U*ne*Y-Z*K*ce,this._z=U*K*ce-Z*ne*Y,this._w=U*K*Y+Z*ne*ce;break;case"ZXY":this._x=Z*K*Y-U*ne*ce,this._y=U*ne*Y+Z*K*ce,this._z=U*K*ce+Z*ne*Y,this._w=U*K*Y-Z*ne*ce;break;case"ZYX":this._x=Z*K*Y-U*ne*ce,this._y=U*ne*Y+Z*K*ce,this._z=U*K*ce-Z*ne*Y,this._w=U*K*Y+Z*ne*ce;break;case"YZX":this._x=Z*K*Y+U*ne*ce,this._y=U*ne*Y+Z*K*ce,this._z=U*K*ce-Z*ne*Y,this._w=U*K*Y-Z*ne*ce;break;case"XZY":this._x=Z*K*Y-U*ne*ce,this._y=U*ne*Y-Z*K*ce,this._z=U*K*ce+Z*ne*Y,this._w=U*K*Y+Z*ne*ce;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+w)}return o!==!1&&this._onChangeCallback(),this}setFromAxisAngle(r,o){let c=o/2,p=Math.sin(c);return this._x=r.x*p,this._y=r.y*p,this._z=r.z*p,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(r){let o=r.elements,c=o[0],p=o[4],v=o[8],w=o[1],S=o[5],O=o[9],U=o[2],K=o[6],Y=o[10],Z=c+S+Y;if(Z>0){let ne=.5/Math.sqrt(Z+1);this._w=.25/ne,this._x=(K-O)*ne,this._y=(v-U)*ne,this._z=(w-p)*ne}else if(c>S&&c>Y){let ne=2*Math.sqrt(1+c-S-Y);this._w=(K-O)/ne,this._x=.25*ne,this._y=(p+w)/ne,this._z=(v+U)/ne}else if(S>Y){let ne=2*Math.sqrt(1+S-c-Y);this._w=(v-U)/ne,this._x=(p+w)/ne,this._y=.25*ne,this._z=(O+K)/ne}else{let ne=2*Math.sqrt(1+Y-c-S);this._w=(w-p)/ne,this._x=(v+U)/ne,this._y=(O+K)/ne,this._z=.25*ne}return this._onChangeCallback(),this}setFromUnitVectors(r,o){let c=r.dot(o)+1;return c<Number.EPSILON?(c=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=c):(this._x=0,this._y=-r.z,this._z=r.y,this._w=c)):(this._x=r.y*o.z-r.z*o.y,this._y=r.z*o.x-r.x*o.z,this._z=r.x*o.y-r.y*o.x,this._w=c),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(Vs(this.dot(r),-1,1)))}rotateTowards(r,o){let c=this.angleTo(r);if(c===0)return this;let p=Math.min(1,o/c);return this.slerp(r,p),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r,o){return o!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(r,o)):this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,o){let c=r._x,p=r._y,v=r._z,w=r._w,S=o._x,O=o._y,U=o._z,K=o._w;return this._x=c*K+w*S+p*U-v*O,this._y=p*K+w*O+v*S-c*U,this._z=v*K+w*U+c*O-p*S,this._w=w*K-c*S-p*O-v*U,this._onChangeCallback(),this}slerp(r,o){if(o===0)return this;if(o===1)return this.copy(r);let c=this._x,p=this._y,v=this._z,w=this._w,S=w*r._w+c*r._x+p*r._y+v*r._z;if(S<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,S=-S):this.copy(r),S>=1)return this._w=w,this._x=c,this._y=p,this._z=v,this;let O=1-S*S;if(O<=Number.EPSILON){let ne=1-o;return this._w=ne*w+o*this._w,this._x=ne*c+o*this._x,this._y=ne*p+o*this._y,this._z=ne*v+o*this._z,this.normalize(),this._onChangeCallback(),this}let U=Math.sqrt(O),K=Math.atan2(U,S),Y=Math.sin((1-o)*K)/U,Z=Math.sin(o*K)/U;return this._w=w*Y+this._w*Z,this._x=c*Y+this._x*Z,this._y=p*Y+this._y*Z,this._z=v*Y+this._z*Z,this._onChangeCallback(),this}slerpQuaternions(r,o,c){return this.copy(r).slerp(o,c)}random(){let r=Math.random(),o=Math.sqrt(1-r),c=Math.sqrt(r),p=2*Math.PI*Math.random(),v=2*Math.PI*Math.random();return this.set(o*Math.cos(p),c*Math.sin(v),c*Math.cos(v),o*Math.sin(p))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,o=0){return this._x=r[o],this._y=r[o+1],this._z=r[o+2],this._w=r[o+3],this._onChangeCallback(),this}toArray(r=[],o=0){return r[o]=this._x,r[o+1]=this._y,r[o+2]=this._z,r[o+3]=this._w,r}fromBufferAttribute(r,o){return this._x=r.getX(o),this._y=r.getY(o),this._z=r.getZ(o),this._w=r.getW(o),this}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}}Hs.prototype.isQuaternion=!0;class je{constructor(r=0,o=0,c=0){this.x=r,this.y=o,this.z=c}set(r,o,c){return c===void 0&&(c=this.z),this.x=r,this.y=o,this.z=c,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setComponent(r,o){switch(r){case 0:this.x=o;break;case 1:this.y=o;break;case 2:this.z=o;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r,o){return o!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(r,o)):(this.x+=r.x,this.y+=r.y,this.z+=r.z,this)}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this}addVectors(r,o){return this.x=r.x+o.x,this.y=r.y+o.y,this.z=r.z+o.z,this}addScaledVector(r,o){return this.x+=r.x*o,this.y+=r.y*o,this.z+=r.z*o,this}sub(r,o){return o!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(r,o)):(this.x-=r.x,this.y-=r.y,this.z-=r.z,this)}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this}subVectors(r,o){return this.x=r.x-o.x,this.y=r.y-o.y,this.z=r.z-o.z,this}multiply(r,o){return o!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(r,o)):(this.x*=r.x,this.y*=r.y,this.z*=r.z,this)}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}multiplyVectors(r,o){return this.x=r.x*o.x,this.y=r.y*o.y,this.z=r.z*o.z,this}applyEuler(r){return r&&r.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(dd.setFromEuler(r))}applyAxisAngle(r,o){return this.applyQuaternion(dd.setFromAxisAngle(r,o))}applyMatrix3(r){let o=this.x,c=this.y,p=this.z,v=r.elements;return this.x=v[0]*o+v[3]*c+v[6]*p,this.y=v[1]*o+v[4]*c+v[7]*p,this.z=v[2]*o+v[5]*c+v[8]*p,this}applyNormalMatrix(r){return this.applyMatrix3(r).normalize()}applyMatrix4(r){let o=this.x,c=this.y,p=this.z,v=r.elements,w=1/(v[3]*o+v[7]*c+v[11]*p+v[15]);return this.x=(v[0]*o+v[4]*c+v[8]*p+v[12])*w,this.y=(v[1]*o+v[5]*c+v[9]*p+v[13])*w,this.z=(v[2]*o+v[6]*c+v[10]*p+v[14])*w,this}applyQuaternion(r){let o=this.x,c=this.y,p=this.z,v=r.x,w=r.y,S=r.z,O=r.w,U=O*o+w*p-S*c,K=O*c+S*o-v*p,Y=O*p+v*c-w*o,Z=-v*o-w*c-S*p;return this.x=U*O+Z*-v+K*-S-Y*-w,this.y=K*O+Z*-w+Y*-v-U*-S,this.z=Y*O+Z*-S+U*-w-K*-v,this}project(r){return this.applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix)}unproject(r){return this.applyMatrix4(r.projectionMatrixInverse).applyMatrix4(r.matrixWorld)}transformDirection(r){let o=this.x,c=this.y,p=this.z,v=r.elements;return this.x=v[0]*o+v[4]*c+v[8]*p,this.y=v[1]*o+v[5]*c+v[9]*p,this.z=v[2]*o+v[6]*c+v[10]*p,this.normalize()}divide(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this}divideScalar(r){return this.multiplyScalar(1/r)}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}clamp(r,o){return this.x=Math.max(r.x,Math.min(o.x,this.x)),this.y=Math.max(r.y,Math.min(o.y,this.y)),this.z=Math.max(r.z,Math.min(o.z,this.z)),this}clampScalar(r,o){return this.x=Math.max(r,Math.min(o,this.x)),this.y=Math.max(r,Math.min(o,this.y)),this.z=Math.max(r,Math.min(o,this.z)),this}clampLength(r,o){let c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(r,Math.min(o,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,o){return this.x+=(r.x-this.x)*o,this.y+=(r.y-this.y)*o,this.z+=(r.z-this.z)*o,this}lerpVectors(r,o,c){return this.x=r.x+(o.x-r.x)*c,this.y=r.y+(o.y-r.y)*c,this.z=r.z+(o.z-r.z)*c,this}cross(r,o){return o!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(r,o)):this.crossVectors(this,r)}crossVectors(r,o){let c=r.x,p=r.y,v=r.z,w=o.x,S=o.y,O=o.z;return this.x=p*O-v*S,this.y=v*w-c*O,this.z=c*S-p*w,this}projectOnVector(r){let o=r.lengthSq();if(o===0)return this.set(0,0,0);let c=r.dot(this)/o;return this.copy(r).multiplyScalar(c)}projectOnPlane(r){return lc.copy(this).projectOnVector(r),this.sub(lc)}reflect(r){return this.sub(lc.copy(r).multiplyScalar(2*this.dot(r)))}angleTo(r){let o=Math.sqrt(this.lengthSq()*r.lengthSq());if(o===0)return Math.PI/2;let c=this.dot(r)/o;return Math.acos(Vs(c,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){let o=this.x-r.x,c=this.y-r.y,p=this.z-r.z;return o*o+c*c+p*p}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)+Math.abs(this.z-r.z)}setFromSpherical(r){return this.setFromSphericalCoords(r.radius,r.phi,r.theta)}setFromSphericalCoords(r,o,c){let p=Math.sin(o)*r;return this.x=p*Math.sin(c),this.y=Math.cos(o)*r,this.z=p*Math.cos(c),this}setFromCylindrical(r){return this.setFromCylindricalCoords(r.radius,r.theta,r.y)}setFromCylindricalCoords(r,o,c){return this.x=r*Math.sin(o),this.y=c,this.z=r*Math.cos(o),this}setFromMatrixPosition(r){let o=r.elements;return this.x=o[12],this.y=o[13],this.z=o[14],this}setFromMatrixScale(r){let o=this.setFromMatrixColumn(r,0).length(),c=this.setFromMatrixColumn(r,1).length(),p=this.setFromMatrixColumn(r,2).length();return this.x=o,this.y=c,this.z=p,this}setFromMatrixColumn(r,o){return this.fromArray(r.elements,o*4)}setFromMatrix3Column(r,o){return this.fromArray(r.elements,o*3)}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z}fromArray(r,o=0){return this.x=r[o],this.y=r[o+1],this.z=r[o+2],this}toArray(r=[],o=0){return r[o]=this.x,r[o+1]=this.y,r[o+2]=this.z,r}fromBufferAttribute(r,o,c){return c!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=r.getX(o),this.y=r.getY(o),this.z=r.getZ(o),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let r=(Math.random()-.5)*2,o=Math.random()*Math.PI*2,c=Math.sqrt(1-r**2);return this.x=c*Math.cos(o),this.y=c*Math.sin(o),this.z=r,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}je.prototype.isVector3=!0;let lc=new je,dd=new Hs;class va{constructor(r=new je(1/0,1/0,1/0),o=new je(-1/0,-1/0,-1/0)){this.min=r,this.max=o}set(r,o){return this.min.copy(r),this.max.copy(o),this}setFromArray(r){let o=1/0,c=1/0,p=1/0,v=-1/0,w=-1/0,S=-1/0;for(let O=0,U=r.length;O<U;O+=3){let K=r[O],Y=r[O+1],Z=r[O+2];K<o&&(o=K),Y<c&&(c=Y),Z<p&&(p=Z),K>v&&(v=K),Y>w&&(w=Y),Z>S&&(S=Z)}return this.min.set(o,c,p),this.max.set(v,w,S),this}setFromBufferAttribute(r){let o=1/0,c=1/0,p=1/0,v=-1/0,w=-1/0,S=-1/0;for(let O=0,U=r.count;O<U;O++){let K=r.getX(O),Y=r.getY(O),Z=r.getZ(O);K<o&&(o=K),Y<c&&(c=Y),Z<p&&(p=Z),K>v&&(v=K),Y>w&&(w=Y),Z>S&&(S=Z)}return this.min.set(o,c,p),this.max.set(v,w,S),this}setFromPoints(r){this.makeEmpty();for(let o=0,c=r.length;o<c;o++)this.expandByPoint(r[o]);return this}setFromCenterAndSize(r,o){let c=Vl.copy(o).multiplyScalar(.5);return this.min.copy(r).sub(c),this.max.copy(r).add(c),this}setFromObject(r,o=!1){return this.makeEmpty(),this.expandByObject(r,o)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,o=!1){r.updateWorldMatrix(!1,!1);let c=r.geometry;if(c!==void 0)if(o&&c.attributes!=null&&c.attributes.position!==void 0){let v=c.attributes.position;for(let w=0,S=v.count;w<S;w++)Vl.fromBufferAttribute(v,w).applyMatrix4(r.matrixWorld),this.expandByPoint(Vl)}else c.boundingBox===null&&c.computeBoundingBox(),oh.copy(c.boundingBox),oh.applyMatrix4(r.matrixWorld),this.union(oh);let p=r.children;for(let v=0,w=p.length;v<w;v++)this.expandByObject(p[v],o);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,o){return o.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,Vl),Vl.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let o,c;return r.normal.x>0?(o=r.normal.x*this.min.x,c=r.normal.x*this.max.x):(o=r.normal.x*this.max.x,c=r.normal.x*this.min.x),r.normal.y>0?(o+=r.normal.y*this.min.y,c+=r.normal.y*this.max.y):(o+=r.normal.y*this.max.y,c+=r.normal.y*this.min.y),r.normal.z>0?(o+=r.normal.z*this.min.z,c+=r.normal.z*this.max.z):(o+=r.normal.z*this.max.z,c+=r.normal.z*this.min.z),o<=-r.constant&&c>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(Gl),Eu.subVectors(this.max,Gl),yl.subVectors(r.a,Gl),Hl.subVectors(r.b,Gl),vl.subVectors(r.c,Gl),So.subVectors(Hl,yl),To.subVectors(vl,Hl),$o.subVectors(yl,vl);let o=[0,-So.z,So.y,0,-To.z,To.y,0,-$o.z,$o.y,So.z,0,-So.x,To.z,0,-To.x,$o.z,0,-$o.x,-So.y,So.x,0,-To.y,To.x,0,-$o.y,$o.x,0];return!lh(o,yl,Hl,vl,Eu)||(o=[1,0,0,0,1,0,0,0,1],!lh(o,yl,Hl,vl,Eu))?!1:(uc.crossVectors(So,To),o=[uc.x,uc.y,uc.z],lh(o,yl,Hl,vl,Eu))}clampPoint(r,o){return o.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return Vl.copy(r).clamp(this.min,this.max).sub(r).length()}getBoundingSphere(r){return this.getCenter(r.center),r.radius=this.getSize(Vl).length()*.5,r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(no[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),no[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),no[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),no[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),no[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),no[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),no[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),no[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(no),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}va.prototype.isBox3=!0;let no=[new je,new je,new je,new je,new je,new je,new je,new je],Vl=new je,oh=new va,yl=new je,Hl=new je,vl=new je,So=new je,To=new je,$o=new je,Gl=new je,Eu=new je,uc=new je,bl=new je;function lh(y,r,o,c,p){for(let v=0,w=y.length-3;v<=w;v+=3){bl.fromArray(y,v);let S=p.x*Math.abs(bl.x)+p.y*Math.abs(bl.y)+p.z*Math.abs(bl.z),O=r.dot(bl),U=o.dot(bl),K=c.dot(bl);if(Math.max(-Math.max(O,U,K),Math.min(O,U,K))>S)return!1}return!0}let Ip=new va,kp=new je,uh=new je,pd=new je;class xl{constructor(r=new je,o=-1){this.center=r,this.radius=o}set(r,o){return this.center.copy(r),this.radius=o,this}setFromPoints(r,o){let c=this.center;o!==void 0?c.copy(o):Ip.setFromPoints(r).getCenter(c);let p=0;for(let v=0,w=r.length;v<w;v++)p=Math.max(p,c.distanceToSquared(r[v]));return this.radius=Math.sqrt(p),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){let o=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=o*o}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,o){let c=this.center.distanceToSquared(r);return o.copy(r),c>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){pd.subVectors(r,this.center);let o=pd.lengthSq();if(o>this.radius*this.radius){let c=Math.sqrt(o),p=(c-this.radius)*.5;this.center.add(pd.multiplyScalar(p/c)),this.radius+=p}return this}union(r){return this.center.equals(r.center)===!0?uh.set(0,0,1).multiplyScalar(r.radius):uh.subVectors(r.center,this.center).normalize().multiplyScalar(r.radius),this.expandByPoint(kp.copy(r.center).add(uh)),this.expandByPoint(kp.copy(r.center).sub(uh)),this}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}}let Vo=new je,cc=new je,ch=new je,wl=new je,fd=new je,hh=new je,md=new je;class Mo{constructor(r=new je,o=new je(0,0,-1)){this.origin=r,this.direction=o}set(r,o){return this.origin.copy(r),this.direction.copy(o),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,o){return o.copy(this.direction).multiplyScalar(r).add(this.origin)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,Vo)),this}closestPointToPoint(r,o){o.subVectors(r,this.origin);let c=o.dot(this.direction);return c<0?o.copy(this.origin):o.copy(this.direction).multiplyScalar(c).add(this.origin)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){let o=Vo.subVectors(r,this.origin).dot(this.direction);return o<0?this.origin.distanceToSquared(r):(Vo.copy(this.direction).multiplyScalar(o).add(this.origin),Vo.distanceToSquared(r))}distanceSqToSegment(r,o,c,p){cc.copy(r).add(o).multiplyScalar(.5),ch.copy(o).sub(r).normalize(),wl.copy(this.origin).sub(cc);let v=r.distanceTo(o)*.5,w=-this.direction.dot(ch),S=wl.dot(this.direction),O=-wl.dot(ch),U=wl.lengthSq(),K=Math.abs(1-w*w),Y,Z,ne,ce;if(K>0)if(Y=w*O-S,Z=w*S-O,ce=v*K,Y>=0)if(Z>=-ce)if(Z<=ce){let ve=1/K;Y*=ve,Z*=ve,ne=Y*(Y+w*Z+2*S)+Z*(w*Y+Z+2*O)+U}else Z=v,Y=Math.max(0,-(w*Z+S)),ne=-Y*Y+Z*(Z+2*O)+U;else Z=-v,Y=Math.max(0,-(w*Z+S)),ne=-Y*Y+Z*(Z+2*O)+U;else Z<=-ce?(Y=Math.max(0,-(-w*v+S)),Z=Y>0?-v:Math.min(Math.max(-v,-O),v),ne=-Y*Y+Z*(Z+2*O)+U):Z<=ce?(Y=0,Z=Math.min(Math.max(-v,-O),v),ne=Z*(Z+2*O)+U):(Y=Math.max(0,-(w*v+S)),Z=Y>0?v:Math.min(Math.max(-v,-O),v),ne=-Y*Y+Z*(Z+2*O)+U);else Z=w>0?-v:v,Y=Math.max(0,-(w*Z+S)),ne=-Y*Y+Z*(Z+2*O)+U;return c&&c.copy(this.direction).multiplyScalar(Y).add(this.origin),p&&p.copy(ch).multiplyScalar(Z).add(cc),ne}intersectSphere(r,o){Vo.subVectors(r.center,this.origin);let c=Vo.dot(this.direction),p=Vo.dot(Vo)-c*c,v=r.radius*r.radius;if(p>v)return null;let w=Math.sqrt(v-p),S=c-w,O=c+w;return S<0&&O<0?null:S<0?this.at(O,o):this.at(S,o)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){let o=r.normal.dot(this.direction);if(o===0)return r.distanceToPoint(this.origin)===0?0:null;let c=-(this.origin.dot(r.normal)+r.constant)/o;return c>=0?c:null}intersectPlane(r,o){let c=this.distanceToPlane(r);return c===null?null:this.at(c,o)}intersectsPlane(r){let o=r.distanceToPoint(this.origin);return o===0||r.normal.dot(this.direction)*o<0}intersectBox(r,o){let c,p,v,w,S,O,U=1/this.direction.x,K=1/this.direction.y,Y=1/this.direction.z,Z=this.origin;return U>=0?(c=(r.min.x-Z.x)*U,p=(r.max.x-Z.x)*U):(c=(r.max.x-Z.x)*U,p=(r.min.x-Z.x)*U),K>=0?(v=(r.min.y-Z.y)*K,w=(r.max.y-Z.y)*K):(v=(r.max.y-Z.y)*K,w=(r.min.y-Z.y)*K),c>w||v>p||((v>c||c!==c)&&(c=v),(w<p||p!==p)&&(p=w),Y>=0?(S=(r.min.z-Z.z)*Y,O=(r.max.z-Z.z)*Y):(S=(r.max.z-Z.z)*Y,O=(r.min.z-Z.z)*Y),c>O||S>p)||((S>c||c!==c)&&(c=S),(O<p||p!==p)&&(p=O),p<0)?null:this.at(c>=0?c:p,o)}intersectsBox(r){return this.intersectBox(r,Vo)!==null}intersectTriangle(r,o,c,p,v){fd.subVectors(o,r),hh.subVectors(c,r),md.crossVectors(fd,hh);let w=this.direction.dot(md),S;if(w>0){if(p)return null;S=1}else if(w<0)S=-1,w=-w;else return null;wl.subVectors(this.origin,r);let O=S*this.direction.dot(hh.crossVectors(wl,hh));if(O<0)return null;let U=S*this.direction.dot(fd.cross(wl));if(U<0||O+U>w)return null;let K=-S*wl.dot(md);return K<0?null:this.at(K/w,v)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Wn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(r,o,c,p,v,w,S,O,U,K,Y,Z,ne,ce,ve,Fe){let fe=this.elements;return fe[0]=r,fe[4]=o,fe[8]=c,fe[12]=p,fe[1]=v,fe[5]=w,fe[9]=S,fe[13]=O,fe[2]=U,fe[6]=K,fe[10]=Y,fe[14]=Z,fe[3]=ne,fe[7]=ce,fe[11]=ve,fe[15]=Fe,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Wn().fromArray(this.elements)}copy(r){let o=this.elements,c=r.elements;return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=c[7],o[8]=c[8],o[9]=c[9],o[10]=c[10],o[11]=c[11],o[12]=c[12],o[13]=c[13],o[14]=c[14],o[15]=c[15],this}copyPosition(r){let o=this.elements,c=r.elements;return o[12]=c[12],o[13]=c[13],o[14]=c[14],this}setFromMatrix3(r){let o=r.elements;return this.set(o[0],o[3],o[6],0,o[1],o[4],o[7],0,o[2],o[5],o[8],0,0,0,0,1),this}extractBasis(r,o,c){return r.setFromMatrixColumn(this,0),o.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(r,o,c){return this.set(r.x,o.x,c.x,0,r.y,o.y,c.y,0,r.z,o.z,c.z,0,0,0,0,1),this}extractRotation(r){let o=this.elements,c=r.elements,p=1/Al.setFromMatrixColumn(r,0).length(),v=1/Al.setFromMatrixColumn(r,1).length(),w=1/Al.setFromMatrixColumn(r,2).length();return o[0]=c[0]*p,o[1]=c[1]*p,o[2]=c[2]*p,o[3]=0,o[4]=c[4]*v,o[5]=c[5]*v,o[6]=c[6]*v,o[7]=0,o[8]=c[8]*w,o[9]=c[9]*w,o[10]=c[10]*w,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromEuler(r){r&&r.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let o=this.elements,c=r.x,p=r.y,v=r.z,w=Math.cos(c),S=Math.sin(c),O=Math.cos(p),U=Math.sin(p),K=Math.cos(v),Y=Math.sin(v);if(r.order==="XYZ"){let Z=w*K,ne=w*Y,ce=S*K,ve=S*Y;o[0]=O*K,o[4]=-O*Y,o[8]=U,o[1]=ne+ce*U,o[5]=Z-ve*U,o[9]=-S*O,o[2]=ve-Z*U,o[6]=ce+ne*U,o[10]=w*O}else if(r.order==="YXZ"){let Z=O*K,ne=O*Y,ce=U*K,ve=U*Y;o[0]=Z+ve*S,o[4]=ce*S-ne,o[8]=w*U,o[1]=w*Y,o[5]=w*K,o[9]=-S,o[2]=ne*S-ce,o[6]=ve+Z*S,o[10]=w*O}else if(r.order==="ZXY"){let Z=O*K,ne=O*Y,ce=U*K,ve=U*Y;o[0]=Z-ve*S,o[4]=-w*Y,o[8]=ce+ne*S,o[1]=ne+ce*S,o[5]=w*K,o[9]=ve-Z*S,o[2]=-w*U,o[6]=S,o[10]=w*O}else if(r.order==="ZYX"){let Z=w*K,ne=w*Y,ce=S*K,ve=S*Y;o[0]=O*K,o[4]=ce*U-ne,o[8]=Z*U+ve,o[1]=O*Y,o[5]=ve*U+Z,o[9]=ne*U-ce,o[2]=-U,o[6]=S*O,o[10]=w*O}else if(r.order==="YZX"){let Z=w*O,ne=w*U,ce=S*O,ve=S*U;o[0]=O*K,o[4]=ve-Z*Y,o[8]=ce*Y+ne,o[1]=Y,o[5]=w*K,o[9]=-S*K,o[2]=-U*K,o[6]=ne*Y+ce,o[10]=Z-ve*Y}else if(r.order==="XZY"){let Z=w*O,ne=w*U,ce=S*O,ve=S*U;o[0]=O*K,o[4]=-Y,o[8]=U*K,o[1]=Z*Y+ve,o[5]=w*K,o[9]=ne*Y-ce,o[2]=ce*Y-ne,o[6]=S*K,o[10]=ve*Y+Z}return o[3]=0,o[7]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}makeRotationFromQuaternion(r){return this.compose(om,r,lm)}lookAt(r,o,c){let p=this.elements;return Ma.subVectors(r,o),Ma.lengthSq()===0&&(Ma.z=1),Ma.normalize(),Ho.crossVectors(c,Ma),Ho.lengthSq()===0&&(Math.abs(c.z)===1?Ma.x+=1e-4:Ma.z+=1e-4,Ma.normalize(),Ho.crossVectors(c,Ma)),Ho.normalize(),dh.crossVectors(Ma,Ho),p[0]=Ho.x,p[4]=dh.x,p[8]=Ma.x,p[1]=Ho.y,p[5]=dh.y,p[9]=Ma.y,p[2]=Ho.z,p[6]=dh.z,p[10]=Ma.z,this}multiply(r,o){return o!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(r,o)):this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,o){let c=r.elements,p=o.elements,v=this.elements,w=c[0],S=c[4],O=c[8],U=c[12],K=c[1],Y=c[5],Z=c[9],ne=c[13],ce=c[2],ve=c[6],Fe=c[10],fe=c[14],oe=c[3],Pe=c[7],Re=c[11],We=c[15],Je=p[0],dt=p[4],wt=p[8],Dt=p[12],Ft=p[1],De=p[5],nt=p[9],_t=p[13],Rt=p[2],Tt=p[6],Ct=p[10],Zt=p[14],pn=p[3],er=p[7],ur=p[11],$n=p[15];return v[0]=w*Je+S*Ft+O*Rt+U*pn,v[4]=w*dt+S*De+O*Tt+U*er,v[8]=w*wt+S*nt+O*Ct+U*ur,v[12]=w*Dt+S*_t+O*Zt+U*$n,v[1]=K*Je+Y*Ft+Z*Rt+ne*pn,v[5]=K*dt+Y*De+Z*Tt+ne*er,v[9]=K*wt+Y*nt+Z*Ct+ne*ur,v[13]=K*Dt+Y*_t+Z*Zt+ne*$n,v[2]=ce*Je+ve*Ft+Fe*Rt+fe*pn,v[6]=ce*dt+ve*De+Fe*Tt+fe*er,v[10]=ce*wt+ve*nt+Fe*Ct+fe*ur,v[14]=ce*Dt+ve*_t+Fe*Zt+fe*$n,v[3]=oe*Je+Pe*Ft+Re*Rt+We*pn,v[7]=oe*dt+Pe*De+Re*Tt+We*er,v[11]=oe*wt+Pe*nt+Re*Ct+We*ur,v[15]=oe*Dt+Pe*_t+Re*Zt+We*$n,this}multiplyScalar(r){let o=this.elements;return o[0]*=r,o[4]*=r,o[8]*=r,o[12]*=r,o[1]*=r,o[5]*=r,o[9]*=r,o[13]*=r,o[2]*=r,o[6]*=r,o[10]*=r,o[14]*=r,o[3]*=r,o[7]*=r,o[11]*=r,o[15]*=r,this}determinant(){let r=this.elements,o=r[0],c=r[4],p=r[8],v=r[12],w=r[1],S=r[5],O=r[9],U=r[13],K=r[2],Y=r[6],Z=r[10],ne=r[14],ce=r[3],ve=r[7],Fe=r[11],fe=r[15];return ce*(+v*O*Y-p*U*Y-v*S*Z+c*U*Z+p*S*ne-c*O*ne)+ve*(+o*O*ne-o*U*Z+v*w*Z-p*w*ne+p*U*K-v*O*K)+Fe*(+o*U*Y-o*S*ne-v*w*Y+c*w*ne+v*S*K-c*U*K)+fe*(-p*S*K-o*O*Y+o*S*Z+p*w*Y-c*w*Z+c*O*K)}transpose(){let r=this.elements,o;return o=r[1],r[1]=r[4],r[4]=o,o=r[2],r[2]=r[8],r[8]=o,o=r[6],r[6]=r[9],r[9]=o,o=r[3],r[3]=r[12],r[12]=o,o=r[7],r[7]=r[13],r[13]=o,o=r[11],r[11]=r[14],r[14]=o,this}setPosition(r,o,c){let p=this.elements;return r.isVector3?(p[12]=r.x,p[13]=r.y,p[14]=r.z):(p[12]=r,p[13]=o,p[14]=c),this}invert(){let r=this.elements,o=r[0],c=r[1],p=r[2],v=r[3],w=r[4],S=r[5],O=r[6],U=r[7],K=r[8],Y=r[9],Z=r[10],ne=r[11],ce=r[12],ve=r[13],Fe=r[14],fe=r[15],oe=Y*Fe*U-ve*Z*U+ve*O*ne-S*Fe*ne-Y*O*fe+S*Z*fe,Pe=ce*Z*U-K*Fe*U-ce*O*ne+w*Fe*ne+K*O*fe-w*Z*fe,Re=K*ve*U-ce*Y*U+ce*S*ne-w*ve*ne-K*S*fe+w*Y*fe,We=ce*Y*O-K*ve*O-ce*S*Z+w*ve*Z+K*S*Fe-w*Y*Fe,Je=o*oe+c*Pe+p*Re+v*We;if(Je===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let dt=1/Je;return r[0]=oe*dt,r[1]=(ve*Z*v-Y*Fe*v-ve*p*ne+c*Fe*ne+Y*p*fe-c*Z*fe)*dt,r[2]=(S*Fe*v-ve*O*v+ve*p*U-c*Fe*U-S*p*fe+c*O*fe)*dt,r[3]=(Y*O*v-S*Z*v-Y*p*U+c*Z*U+S*p*ne-c*O*ne)*dt,r[4]=Pe*dt,r[5]=(K*Fe*v-ce*Z*v+ce*p*ne-o*Fe*ne-K*p*fe+o*Z*fe)*dt,r[6]=(ce*O*v-w*Fe*v-ce*p*U+o*Fe*U+w*p*fe-o*O*fe)*dt,r[7]=(w*Z*v-K*O*v+K*p*U-o*Z*U-w*p*ne+o*O*ne)*dt,r[8]=Re*dt,r[9]=(ce*Y*v-K*ve*v-ce*c*ne+o*ve*ne+K*c*fe-o*Y*fe)*dt,r[10]=(w*ve*v-ce*S*v+ce*c*U-o*ve*U-w*c*fe+o*S*fe)*dt,r[11]=(K*S*v-w*Y*v-K*c*U+o*Y*U+w*c*ne-o*S*ne)*dt,r[12]=We*dt,r[13]=(K*ve*p-ce*Y*p+ce*c*Z-o*ve*Z-K*c*Fe+o*Y*Fe)*dt,r[14]=(ce*S*p-w*ve*p-ce*c*O+o*ve*O+w*c*Fe-o*S*Fe)*dt,r[15]=(w*Y*p-K*S*p+K*c*O-o*Y*O-w*c*Z+o*S*Z)*dt,this}scale(r){let o=this.elements,c=r.x,p=r.y,v=r.z;return o[0]*=c,o[4]*=p,o[8]*=v,o[1]*=c,o[5]*=p,o[9]*=v,o[2]*=c,o[6]*=p,o[10]*=v,o[3]*=c,o[7]*=p,o[11]*=v,this}getMaxScaleOnAxis(){let r=this.elements,o=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],c=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],p=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(o,c,p))}makeTranslation(r,o,c){return this.set(1,0,0,r,0,1,0,o,0,0,1,c,0,0,0,1),this}makeRotationX(r){let o=Math.cos(r),c=Math.sin(r);return this.set(1,0,0,0,0,o,-c,0,0,c,o,0,0,0,0,1),this}makeRotationY(r){let o=Math.cos(r),c=Math.sin(r);return this.set(o,0,c,0,0,1,0,0,-c,0,o,0,0,0,0,1),this}makeRotationZ(r){let o=Math.cos(r),c=Math.sin(r);return this.set(o,-c,0,0,c,o,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(r,o){let c=Math.cos(o),p=Math.sin(o),v=1-c,w=r.x,S=r.y,O=r.z,U=v*w,K=v*S;return this.set(U*w+c,U*S-p*O,U*O+p*S,0,U*S+p*O,K*S+c,K*O-p*w,0,U*O-p*S,K*O+p*w,v*O*O+c,0,0,0,0,1),this}makeScale(r,o,c){return this.set(r,0,0,0,0,o,0,0,0,0,c,0,0,0,0,1),this}makeShear(r,o,c,p,v,w){return this.set(1,c,v,0,r,1,w,0,o,p,1,0,0,0,0,1),this}compose(r,o,c){let p=this.elements,v=o._x,w=o._y,S=o._z,O=o._w,U=v+v,K=w+w,Y=S+S,Z=v*U,ne=v*K,ce=v*Y,ve=w*K,Fe=w*Y,fe=S*Y,oe=O*U,Pe=O*K,Re=O*Y,We=c.x,Je=c.y,dt=c.z;return p[0]=(1-(ve+fe))*We,p[1]=(ne+Re)*We,p[2]=(ce-Pe)*We,p[3]=0,p[4]=(ne-Re)*Je,p[5]=(1-(Z+fe))*Je,p[6]=(Fe+oe)*Je,p[7]=0,p[8]=(ce+Pe)*dt,p[9]=(Fe-oe)*dt,p[10]=(1-(Z+ve))*dt,p[11]=0,p[12]=r.x,p[13]=r.y,p[14]=r.z,p[15]=1,this}decompose(r,o,c){let p=this.elements,v=Al.set(p[0],p[1],p[2]).length(),w=Al.set(p[4],p[5],p[6]).length(),S=Al.set(p[8],p[9],p[10]).length();this.determinant()<0&&(v=-v),r.x=p[12],r.y=p[13],r.z=p[14],Fa.copy(this);let U=1/v,K=1/w,Y=1/S;return Fa.elements[0]*=U,Fa.elements[1]*=U,Fa.elements[2]*=U,Fa.elements[4]*=K,Fa.elements[5]*=K,Fa.elements[6]*=K,Fa.elements[8]*=Y,Fa.elements[9]*=Y,Fa.elements[10]*=Y,o.setFromRotationMatrix(Fa),c.x=v,c.y=w,c.z=S,this}makePerspective(r,o,c,p,v,w){w===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let S=this.elements,O=2*v/(o-r),U=2*v/(c-p),K=(o+r)/(o-r),Y=(c+p)/(c-p),Z=-(w+v)/(w-v),ne=-2*w*v/(w-v);return S[0]=O,S[4]=0,S[8]=K,S[12]=0,S[1]=0,S[5]=U,S[9]=Y,S[13]=0,S[2]=0,S[6]=0,S[10]=Z,S[14]=ne,S[3]=0,S[7]=0,S[11]=-1,S[15]=0,this}makeOrthographic(r,o,c,p,v,w){let S=this.elements,O=1/(o-r),U=1/(c-p),K=1/(w-v),Y=(o+r)*O,Z=(c+p)*U,ne=(w+v)*K;return S[0]=2*O,S[4]=0,S[8]=0,S[12]=-Y,S[1]=0,S[5]=2*U,S[9]=0,S[13]=-Z,S[2]=0,S[6]=0,S[10]=-2*K,S[14]=-ne,S[3]=0,S[7]=0,S[11]=0,S[15]=1,this}equals(r){let o=this.elements,c=r.elements;for(let p=0;p<16;p++)if(o[p]!==c[p])return!1;return!0}fromArray(r,o=0){for(let c=0;c<16;c++)this.elements[c]=r[c+o];return this}toArray(r=[],o=0){let c=this.elements;return r[o]=c[0],r[o+1]=c[1],r[o+2]=c[2],r[o+3]=c[3],r[o+4]=c[4],r[o+5]=c[5],r[o+6]=c[6],r[o+7]=c[7],r[o+8]=c[8],r[o+9]=c[9],r[o+10]=c[10],r[o+11]=c[11],r[o+12]=c[12],r[o+13]=c[13],r[o+14]=c[14],r[o+15]=c[15],r}}Wn.prototype.isMatrix4=!0;let Al=new je,Fa=new Wn,om=new je(0,0,0),lm=new je(1,1,1),Ho=new je,dh=new je,Ma=new je,gd=new Wn,yd=new Hs;class Go{constructor(r=0,o=0,c=0,p=Go.DefaultOrder){this._x=r,this._y=o,this._z=c,this._order=p}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get order(){return this._order}set order(r){this._order=r,this._onChangeCallback()}set(r,o,c,p=this._order){return this._x=r,this._y=o,this._z=c,this._order=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(r){return this._x=r._x,this._y=r._y,this._z=r._z,this._order=r._order,this._onChangeCallback(),this}setFromRotationMatrix(r,o=this._order,c=!0){let p=r.elements,v=p[0],w=p[4],S=p[8],O=p[1],U=p[5],K=p[9],Y=p[2],Z=p[6],ne=p[10];switch(o){case"XYZ":this._y=Math.asin(Vs(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(-K,ne),this._z=Math.atan2(-w,v)):(this._x=Math.atan2(Z,U),this._z=0);break;case"YXZ":this._x=Math.asin(-Vs(K,-1,1)),Math.abs(K)<.9999999?(this._y=Math.atan2(S,ne),this._z=Math.atan2(O,U)):(this._y=Math.atan2(-Y,v),this._z=0);break;case"ZXY":this._x=Math.asin(Vs(Z,-1,1)),Math.abs(Z)<.9999999?(this._y=Math.atan2(-Y,ne),this._z=Math.atan2(-w,U)):(this._y=0,this._z=Math.atan2(O,v));break;case"ZYX":this._y=Math.asin(-Vs(Y,-1,1)),Math.abs(Y)<.9999999?(this._x=Math.atan2(Z,ne),this._z=Math.atan2(O,v)):(this._x=0,this._z=Math.atan2(-w,U));break;case"YZX":this._z=Math.asin(Vs(O,-1,1)),Math.abs(O)<.9999999?(this._x=Math.atan2(-K,U),this._y=Math.atan2(-Y,v)):(this._x=0,this._y=Math.atan2(S,ne));break;case"XZY":this._z=Math.asin(-Vs(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(Z,U),this._y=Math.atan2(S,v)):(this._x=Math.atan2(-K,ne),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+o)}return this._order=o,c===!0&&this._onChangeCallback(),this}setFromQuaternion(r,o,c){return gd.makeRotationFromQuaternion(r),this.setFromRotationMatrix(gd,o,c)}setFromVector3(r,o=this._order){return this.set(r.x,r.y,r.z,o)}reorder(r){return yd.setFromEuler(this),this.setFromQuaternion(yd,r)}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._order===this._order}fromArray(r){return this._x=r[0],this._y=r[1],this._z=r[2],r[3]!==void 0&&(this._order=r[3]),this._onChangeCallback(),this}toArray(r=[],o=0){return r[o]=this._x,r[o+1]=this._y,r[o+2]=this._z,r[o+3]=this._order,r}toVector3(r){return r?r.set(this._x,this._y,this._z):new je(this._x,this._y,this._z)}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}}Go.prototype.isEuler=!0,Go.DefaultOrder="XYZ",Go.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ph{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}}let um=0,vd=new je,Wl=new Hs,_o=new Wn,Pa=new je,Rp=new je,bd=new je,Np=new Hs,Lp=new je(1,0,0),cm=new je(0,1,0),Dp=new je(0,0,1),hm={type:"added"},Gg={type:"removed"};class bi extends to{constructor(){super(),Object.defineProperty(this,"id",{value:um++}),this.uuid=Da(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bi.DefaultUp.clone();let r=new je,o=new Go,c=new Hs,p=new je(1,1,1);function v(){c.setFromEuler(o,!1)}function w(){o.setFromQuaternion(c,void 0,!1)}o._onChange(v),c._onChange(w),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:o},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:p},modelViewMatrix:{value:new Wn},normalMatrix:{value:new Ts}}),this.matrix=new Wn,this.matrixWorld=new Wn,this.matrixAutoUpdate=bi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ph,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(r){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(r),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(r){return this.quaternion.premultiply(r),this}setRotationFromAxisAngle(r,o){this.quaternion.setFromAxisAngle(r,o)}setRotationFromEuler(r){this.quaternion.setFromEuler(r,!0)}setRotationFromMatrix(r){this.quaternion.setFromRotationMatrix(r)}setRotationFromQuaternion(r){this.quaternion.copy(r)}rotateOnAxis(r,o){return Wl.setFromAxisAngle(r,o),this.quaternion.multiply(Wl),this}rotateOnWorldAxis(r,o){return Wl.setFromAxisAngle(r,o),this.quaternion.premultiply(Wl),this}rotateX(r){return this.rotateOnAxis(Lp,r)}rotateY(r){return this.rotateOnAxis(cm,r)}rotateZ(r){return this.rotateOnAxis(Dp,r)}translateOnAxis(r,o){return vd.copy(r).applyQuaternion(this.quaternion),this.position.add(vd.multiplyScalar(o)),this}translateX(r){return this.translateOnAxis(Lp,r)}translateY(r){return this.translateOnAxis(cm,r)}translateZ(r){return this.translateOnAxis(Dp,r)}localToWorld(r){return r.applyMatrix4(this.matrixWorld)}worldToLocal(r){return r.applyMatrix4(_o.copy(this.matrixWorld).invert())}lookAt(r,o,c){r.isVector3?Pa.copy(r):Pa.set(r,o,c);let p=this.parent;this.updateWorldMatrix(!0,!1),Rp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_o.lookAt(Rp,Pa,this.up):_o.lookAt(Pa,Rp,this.up),this.quaternion.setFromRotationMatrix(_o),p&&(_o.extractRotation(p.matrixWorld),Wl.setFromRotationMatrix(_o),this.quaternion.premultiply(Wl.invert()))}add(r){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.add(arguments[o]);return this}return r===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",r),this):(r&&r.isObject3D?(r.parent!==null&&r.parent.remove(r),r.parent=this,this.children.push(r),r.dispatchEvent(hm)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",r),this)}remove(r){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.remove(arguments[c]);return this}let o=this.children.indexOf(r);return o!==-1&&(r.parent=null,this.children.splice(o,1),r.dispatchEvent(Gg)),this}removeFromParent(){let r=this.parent;return r!==null&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++){let o=this.children[r];o.parent=null,o.dispatchEvent(Gg)}return this.children.length=0,this}attach(r){return this.updateWorldMatrix(!0,!1),_o.copy(this.matrixWorld).invert(),r.parent!==null&&(r.parent.updateWorldMatrix(!0,!1),_o.multiply(r.parent.matrixWorld)),r.applyMatrix4(_o),this.add(r),r.updateWorldMatrix(!1,!0),this}getObjectById(r){return this.getObjectByProperty("id",r)}getObjectByName(r){return this.getObjectByProperty("name",r)}getObjectByProperty(r,o){if(this[r]===o)return this;for(let c=0,p=this.children.length;c<p;c++){let w=this.children[c].getObjectByProperty(r,o);if(w!==void 0)return w}}getWorldPosition(r){return this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rp,r,bd),r}getWorldScale(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rp,Np,r),r}getWorldDirection(r){this.updateWorldMatrix(!0,!1);let o=this.matrixWorld.elements;return r.set(o[8],o[9],o[10]).normalize()}raycast(){}traverse(r){r(this);let o=this.children;for(let c=0,p=o.length;c<p;c++)o[c].traverse(r)}traverseVisible(r){if(this.visible===!1)return;r(this);let o=this.children;for(let c=0,p=o.length;c<p;c++)o[c].traverseVisible(r)}traverseAncestors(r){let o=this.parent;o!==null&&(r(o),o.traverseAncestors(r))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,r=!0);let o=this.children;for(let c=0,p=o.length;c<p;c++)o[c].updateMatrixWorld(r)}updateWorldMatrix(r,o){let c=this.parent;if(r===!0&&c!==null&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),o===!0){let p=this.children;for(let v=0,w=p.length;v<w;v++)p[v].updateWorldMatrix(!1,!0)}}toJSON(r){let o=r===void 0||typeof r=="string",c={};o&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},c.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let p={};p.uuid=this.uuid,p.type=this.type,this.name!==""&&(p.name=this.name),this.castShadow===!0&&(p.castShadow=!0),this.receiveShadow===!0&&(p.receiveShadow=!0),this.visible===!1&&(p.visible=!1),this.frustumCulled===!1&&(p.frustumCulled=!1),this.renderOrder!==0&&(p.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(p.userData=this.userData),p.layers=this.layers.mask,p.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(p.matrixAutoUpdate=!1),this.isInstancedMesh&&(p.type="InstancedMesh",p.count=this.count,p.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(p.instanceColor=this.instanceColor.toJSON()));function v(S,O){return S[O.uuid]===void 0&&(S[O.uuid]=O.toJSON(r)),O.uuid}if(this.isScene)this.background&&(this.background.isColor?p.background=this.background.toJSON():this.background.isTexture&&(p.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&(p.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){p.geometry=v(r.geometries,this.geometry);let S=this.geometry.parameters;if(S!==void 0&&S.shapes!==void 0){let O=S.shapes;if(Array.isArray(O))for(let U=0,K=O.length;U<K;U++){let Y=O[U];v(r.shapes,Y)}else v(r.shapes,O)}}if(this.isSkinnedMesh&&(p.bindMode=this.bindMode,p.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(v(r.skeletons,this.skeleton),p.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let S=[];for(let O=0,U=this.material.length;O<U;O++)S.push(v(r.materials,this.material[O]));p.material=S}else p.material=v(r.materials,this.material);if(this.children.length>0){p.children=[];for(let S=0;S<this.children.length;S++)p.children.push(this.children[S].toJSON(r).object)}if(this.animations.length>0){p.animations=[];for(let S=0;S<this.animations.length;S++){let O=this.animations[S];p.animations.push(v(r.animations,O))}}if(o){let S=w(r.geometries),O=w(r.materials),U=w(r.textures),K=w(r.images),Y=w(r.shapes),Z=w(r.skeletons),ne=w(r.animations);S.length>0&&(c.geometries=S),O.length>0&&(c.materials=O),U.length>0&&(c.textures=U),K.length>0&&(c.images=K),Y.length>0&&(c.shapes=Y),Z.length>0&&(c.skeletons=Z),ne.length>0&&(c.animations=ne)}return c.object=p,c;function w(S){let O=[];for(let U in S){let K=S[U];delete K.metadata,O.push(K)}return O}}clone(r){return new this.constructor().copy(this,r)}copy(r,o=!0){if(this.name=r.name,this.up.copy(r.up),this.position.copy(r.position),this.rotation.order=r.rotation.order,this.quaternion.copy(r.quaternion),this.scale.copy(r.scale),this.matrix.copy(r.matrix),this.matrixWorld.copy(r.matrixWorld),this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrixWorldNeedsUpdate=r.matrixWorldNeedsUpdate,this.layers.mask=r.layers.mask,this.visible=r.visible,this.castShadow=r.castShadow,this.receiveShadow=r.receiveShadow,this.frustumCulled=r.frustumCulled,this.renderOrder=r.renderOrder,this.userData=JSON.parse(JSON.stringify(r.userData)),o===!0)for(let c=0;c<r.children.length;c++){let p=r.children[c];this.add(p.clone())}return this}}bi.DefaultUp=new je(0,1,0),bi.DefaultMatrixAutoUpdate=!0,bi.prototype.isObject3D=!0;let El=new je,Su=new je,Fp=new je,jl=new je,Wo=new je,Xl=new je,Wg=new je,Tu=new je,ba=new je,Pp=new je;class Gs{constructor(r=new je,o=new je,c=new je){this.a=r,this.b=o,this.c=c}static getNormal(r,o,c,p){p.subVectors(c,o),El.subVectors(r,o),p.cross(El);let v=p.lengthSq();return v>0?p.multiplyScalar(1/Math.sqrt(v)):p.set(0,0,0)}static getBarycoord(r,o,c,p,v){El.subVectors(p,o),Su.subVectors(c,o),Fp.subVectors(r,o);let w=El.dot(El),S=El.dot(Su),O=El.dot(Fp),U=Su.dot(Su),K=Su.dot(Fp),Y=w*U-S*S;if(Y===0)return v.set(-2,-1,-1);let Z=1/Y,ne=(U*O-S*K)*Z,ce=(w*K-S*O)*Z;return v.set(1-ne-ce,ce,ne)}static containsPoint(r,o,c,p){return this.getBarycoord(r,o,c,p,jl),jl.x>=0&&jl.y>=0&&jl.x+jl.y<=1}static getUV(r,o,c,p,v,w,S,O){return this.getBarycoord(r,o,c,p,jl),O.set(0,0),O.addScaledVector(v,jl.x),O.addScaledVector(w,jl.y),O.addScaledVector(S,jl.z),O}static isFrontFacing(r,o,c,p){return El.subVectors(c,o),Su.subVectors(r,o),El.cross(Su).dot(p)<0}set(r,o,c){return this.a.copy(r),this.b.copy(o),this.c.copy(c),this}setFromPointsAndIndices(r,o,c,p){return this.a.copy(r[o]),this.b.copy(r[c]),this.c.copy(r[p]),this}setFromAttributeAndIndices(r,o,c,p){return this.a.fromBufferAttribute(r,o),this.b.fromBufferAttribute(r,c),this.c.fromBufferAttribute(r,p),this}clone(){return new this.constructor().copy(this)}copy(r){return this.a.copy(r.a),this.b.copy(r.b),this.c.copy(r.c),this}getArea(){return El.subVectors(this.c,this.b),Su.subVectors(this.a,this.b),El.cross(Su).length()*.5}getMidpoint(r){return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(r){return Gs.getNormal(this.a,this.b,this.c,r)}getPlane(r){return r.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(r,o){return Gs.getBarycoord(r,this.a,this.b,this.c,o)}getUV(r,o,c,p,v){return Gs.getUV(r,this.a,this.b,this.c,o,c,p,v)}containsPoint(r){return Gs.containsPoint(r,this.a,this.b,this.c)}isFrontFacing(r){return Gs.isFrontFacing(this.a,this.b,this.c,r)}intersectsBox(r){return r.intersectsTriangle(this)}closestPointToPoint(r,o){let c=this.a,p=this.b,v=this.c,w,S;Wo.subVectors(p,c),Xl.subVectors(v,c),Tu.subVectors(r,c);let O=Wo.dot(Tu),U=Xl.dot(Tu);if(O<=0&&U<=0)return o.copy(c);ba.subVectors(r,p);let K=Wo.dot(ba),Y=Xl.dot(ba);if(K>=0&&Y<=K)return o.copy(p);let Z=O*Y-K*U;if(Z<=0&&O>=0&&K<=0)return w=O/(O-K),o.copy(c).addScaledVector(Wo,w);Pp.subVectors(r,v);let ne=Wo.dot(Pp),ce=Xl.dot(Pp);if(ce>=0&&ne<=ce)return o.copy(v);let ve=ne*U-O*ce;if(ve<=0&&U>=0&&ce<=0)return S=U/(U-ce),o.copy(c).addScaledVector(Xl,S);let Fe=K*ce-ne*Y;if(Fe<=0&&Y-K>=0&&ne-ce>=0)return Wg.subVectors(v,p),S=(Y-K)/(Y-K+(ne-ce)),o.copy(p).addScaledVector(Wg,S);let fe=1/(Fe+ve+Z);return w=ve*fe,S=Z*fe,o.copy(c).addScaledVector(Wo,w).addScaledVector(Xl,S)}equals(r){return r.a.equals(this.a)&&r.b.equals(this.b)&&r.c.equals(this.c)}}let as=0;class ca extends to{constructor(){super(),Object.defineProperty(this,"id",{value:as++}),this.uuid=Da(),this.name="",this.type="Material",this.fog=!0,this.blending=ue,this.side=D,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Mt,this.blendDst=ln,this.blendEquation=we,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=mi,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=gp,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Eo,this.stencilZFail=Eo,this.stencilZPass=Eo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.alphaWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(let o in r){let c=r[o];if(c===void 0){console.warn("THREE.Material: '"+o+"' parameter is undefined.");continue}if(o==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=c===j;continue}let p=this[o];if(p===void 0){console.warn("THREE."+this.type+": '"+o+"' is not a property of this material.");continue}p&&p.isColor?p.set(c):p&&p.isVector3&&c&&c.isVector3?p.copy(c):this[o]=c}}toJSON(r){let o=r===void 0||typeof r=="string";o&&(r={textures:{},images:{}});let c={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};c.uuid=this.uuid,c.type=this.type,this.name!==""&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),this.roughness!==void 0&&(c.roughness=this.roughness),this.metalness!==void 0&&(c.metalness=this.metalness),this.sheen!==void 0&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(c.shininess=this.shininess),this.clearcoat!==void 0&&(c.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(r).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(r).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(r).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(r).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(r).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(c.combine=this.combine)),this.envMapIntensity!==void 0&&(c.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(c.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&(c.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(c.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(c.size=this.size),this.shadowSide!==null&&(c.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(c.sizeAttenuation=this.sizeAttenuation),this.blending!==ue&&(c.blending=this.blending),this.side!==D&&(c.side=this.side),this.vertexColors&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),this.transparent===!0&&(c.transparent=this.transparent),c.depthFunc=this.depthFunc,c.depthTest=this.depthTest,c.depthWrite=this.depthWrite,c.colorWrite=this.colorWrite,c.alphaWrite=this.alphaWrite,c.stencilWrite=this.stencilWrite,c.stencilWriteMask=this.stencilWriteMask,c.stencilFunc=this.stencilFunc,c.stencilRef=this.stencilRef,c.stencilFuncMask=this.stencilFuncMask,c.stencilFail=this.stencilFail,c.stencilZFail=this.stencilZFail,c.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(c.rotation=this.rotation),this.polygonOffset===!0&&(c.polygonOffset=!0),this.polygonOffsetFactor!==0&&(c.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(c.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(c.linewidth=this.linewidth),this.dashSize!==void 0&&(c.dashSize=this.dashSize),this.gapSize!==void 0&&(c.gapSize=this.gapSize),this.scale!==void 0&&(c.scale=this.scale),this.dithering===!0&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(c.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(c.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(c.wireframe=this.wireframe),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(c.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(c.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(c.flatShading=this.flatShading),this.visible===!1&&(c.visible=!1),this.toneMapped===!1&&(c.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(c.userData=this.userData);function p(v){let w=[];for(let S in v){let O=v[S];delete O.metadata,w.push(O)}return w}if(o){let v=p(r.textures),w=p(r.images);v.length>0&&(c.textures=v),w.length>0&&(c.images=w)}return c}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.fog=r.fog,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;let o=r.clippingPlanes,c=null;if(o!==null){let p=o.length;c=new Array(p);for(let v=0;v!==p;++v)c[v]=o[v].clone()}return this.clippingPlanes=c,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.alphaWrite=r.alphaWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}}ca.prototype.isMaterial=!0;class os extends ca{constructor(r){super(),this.type="MeshBasicMaterial",this.color=new Fn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ss,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this}}os.prototype.isMeshBasicMaterial=!0;let Ui=new je,fh=new un;class Ri{constructor(r,o,c){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=r,this.itemSize=o,this.count=r!==void 0?r.length/o:0,this.normalized=c===!0,this.usage=vu,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this}copyAt(r,o,c){r*=this.itemSize,c*=o.itemSize;for(let p=0,v=this.itemSize;p<v;p++)this.array[r+p]=o.array[c+p];return this}copyArray(r){return this.array.set(r),this}copyColorsArray(r){let o=this.array,c=0;for(let p=0,v=r.length;p<v;p++){let w=r[p];w===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",p),w=new Fn),o[c++]=w.r,o[c++]=w.g,o[c++]=w.b}return this}copyVector2sArray(r){let o=this.array,c=0;for(let p=0,v=r.length;p<v;p++){let w=r[p];w===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",p),w=new un),o[c++]=w.x,o[c++]=w.y}return this}copyVector3sArray(r){let o=this.array,c=0;for(let p=0,v=r.length;p<v;p++){let w=r[p];w===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",p),w=new je),o[c++]=w.x,o[c++]=w.y,o[c++]=w.z}return this}copyVector4sArray(r){let o=this.array,c=0;for(let p=0,v=r.length;p<v;p++){let w=r[p];w===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",p),w=new Si),o[c++]=w.x,o[c++]=w.y,o[c++]=w.z,o[c++]=w.w}return this}applyMatrix3(r){if(this.itemSize===2)for(let o=0,c=this.count;o<c;o++)fh.fromBufferAttribute(this,o),fh.applyMatrix3(r),this.setXY(o,fh.x,fh.y);else if(this.itemSize===3)for(let o=0,c=this.count;o<c;o++)Ui.fromBufferAttribute(this,o),Ui.applyMatrix3(r),this.setXYZ(o,Ui.x,Ui.y,Ui.z);return this}applyMatrix4(r){for(let o=0,c=this.count;o<c;o++)Ui.x=this.getX(o),Ui.y=this.getY(o),Ui.z=this.getZ(o),Ui.applyMatrix4(r),this.setXYZ(o,Ui.x,Ui.y,Ui.z);return this}applyNormalMatrix(r){for(let o=0,c=this.count;o<c;o++)Ui.x=this.getX(o),Ui.y=this.getY(o),Ui.z=this.getZ(o),Ui.applyNormalMatrix(r),this.setXYZ(o,Ui.x,Ui.y,Ui.z);return this}transformDirection(r){for(let o=0,c=this.count;o<c;o++)Ui.x=this.getX(o),Ui.y=this.getY(o),Ui.z=this.getZ(o),Ui.transformDirection(r),this.setXYZ(o,Ui.x,Ui.y,Ui.z);return this}set(r,o=0){return this.array.set(r,o),this}getX(r){return this.array[r*this.itemSize]}setX(r,o){return this.array[r*this.itemSize]=o,this}getY(r){return this.array[r*this.itemSize+1]}setY(r,o){return this.array[r*this.itemSize+1]=o,this}getZ(r){return this.array[r*this.itemSize+2]}setZ(r,o){return this.array[r*this.itemSize+2]=o,this}getW(r){return this.array[r*this.itemSize+3]}setW(r,o){return this.array[r*this.itemSize+3]=o,this}setXY(r,o,c){return r*=this.itemSize,this.array[r+0]=o,this.array[r+1]=c,this}setXYZ(r,o,c,p){return r*=this.itemSize,this.array[r+0]=o,this.array[r+1]=c,this.array[r+2]=p,this}setXYZW(r,o,c,p,v){return r*=this.itemSize,this.array[r+0]=o,this.array[r+1]=c,this.array[r+2]=p,this.array[r+3]=v,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==vu&&(r.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(r.updateRange=this.updateRange),r}}Ri.prototype.isBufferAttribute=!0;class ql extends Ri{constructor(r,o,c){super(new Int8Array(r),o,c)}}class Mu extends Ri{constructor(r,o,c){super(new Uint8Array(r),o,c)}}class ha extends Ri{constructor(r,o,c){super(new Uint8ClampedArray(r),o,c)}}class jg extends Ri{constructor(r,o,c){super(new Int16Array(r),o,c)}}class Co extends Ri{constructor(r,o,c){super(new Uint16Array(r),o,c)}}class hc extends Ri{constructor(r,o,c){super(new Int32Array(r),o,c)}}class dm extends Ri{constructor(r,o,c){super(new Uint32Array(r),o,c)}}class ov extends Ri{constructor(r,o,c){super(new Uint16Array(r),o,c)}}ov.prototype.isFloat16BufferAttribute=!0;class lr extends Ri{constructor(r,o,c){super(new Float32Array(r),o,c)}}class lv extends Ri{constructor(r,o,c){super(new Float64Array(r),o,c)}}let Op=0,Io=new Wn,xd=new bi,Kl=new je,Hi=new va,Wa=new va,Ns=new je;class Or extends to{constructor(){super(),Object.defineProperty(this,"id",{value:Op++}),this.uuid=Da(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(r){return Array.isArray(r)?this.index=new(cd(r)?dm:Co)(r,1):this.index=r,this}getAttribute(r){return this.attributes[r]}setAttribute(r,o){return this.attributes[r]=o,this}deleteAttribute(r){return delete this.attributes[r],this}hasAttribute(r){return this.attributes[r]!==void 0}addGroup(r,o,c=0){this.groups.push({start:r,count:o,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(r,o){this.drawRange.start=r,this.drawRange.count=o}applyMatrix4(r){let o=this.attributes.position;o!==void 0&&(o.applyMatrix4(r),o.needsUpdate=!0);let c=this.attributes.normal;if(c!==void 0){let v=new Ts().getNormalMatrix(r);c.applyNormalMatrix(v),c.needsUpdate=!0}let p=this.attributes.tangent;return p!==void 0&&(p.transformDirection(r),p.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(r){return Io.makeRotationFromQuaternion(r),this.applyMatrix4(Io),this}rotateX(r){return Io.makeRotationX(r),this.applyMatrix4(Io),this}rotateY(r){return Io.makeRotationY(r),this.applyMatrix4(Io),this}rotateZ(r){return Io.makeRotationZ(r),this.applyMatrix4(Io),this}translate(r,o,c){return Io.makeTranslation(r,o,c),this.applyMatrix4(Io),this}scale(r,o,c){return Io.makeScale(r,o,c),this.applyMatrix4(Io),this}lookAt(r){return xd.lookAt(r),xd.updateMatrix(),this.applyMatrix4(xd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Kl).negate(),this.translate(Kl.x,Kl.y,Kl.z),this}setFromPoints(r){let o=[];for(let c=0,p=r.length;c<p;c++){let v=r[c];o.push(v.x,v.y,v.z||0)}return this.setAttribute("position",new lr(o,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new va);let r=this.attributes.position,o=this.morphAttributes.position;if(r&&r.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new je(-1/0,-1/0,-1/0),new je(1/0,1/0,1/0));return}if(r!==void 0){if(this.boundingBox.setFromBufferAttribute(r),o)for(let c=0,p=o.length;c<p;c++){let v=o[c];Hi.setFromBufferAttribute(v),this.morphTargetsRelative?(Ns.addVectors(this.boundingBox.min,Hi.min),this.boundingBox.expandByPoint(Ns),Ns.addVectors(this.boundingBox.max,Hi.max),this.boundingBox.expandByPoint(Ns)):(this.boundingBox.expandByPoint(Hi.min),this.boundingBox.expandByPoint(Hi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new xl);let r=this.attributes.position,o=this.morphAttributes.position;if(r&&r.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new je,1/0);return}if(r){let c=this.boundingSphere.center;if(Hi.setFromBufferAttribute(r),o)for(let v=0,w=o.length;v<w;v++){let S=o[v];Wa.setFromBufferAttribute(S),this.morphTargetsRelative?(Ns.addVectors(Hi.min,Wa.min),Hi.expandByPoint(Ns),Ns.addVectors(Hi.max,Wa.max),Hi.expandByPoint(Ns)):(Hi.expandByPoint(Wa.min),Hi.expandByPoint(Wa.max))}Hi.getCenter(c);let p=0;for(let v=0,w=r.count;v<w;v++)Ns.fromBufferAttribute(r,v),p=Math.max(p,c.distanceToSquared(Ns));if(o)for(let v=0,w=o.length;v<w;v++){let S=o[v],O=this.morphTargetsRelative;for(let U=0,K=S.count;U<K;U++)Ns.fromBufferAttribute(S,U),O&&(Kl.fromBufferAttribute(r,U),Ns.add(Kl)),p=Math.max(p,c.distanceToSquared(Ns))}this.boundingSphere.radius=Math.sqrt(p),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let r=this.index,o=this.attributes;if(r===null||o.position===void 0||o.normal===void 0||o.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let c=r.array,p=o.position.array,v=o.normal.array,w=o.uv.array,S=p.length/3;o.tangent===void 0&&this.setAttribute("tangent",new Ri(new Float32Array(4*S),4));let O=o.tangent.array,U=[],K=[];for(let Ft=0;Ft<S;Ft++)U[Ft]=new je,K[Ft]=new je;let Y=new je,Z=new je,ne=new je,ce=new un,ve=new un,Fe=new un,fe=new je,oe=new je;function Pe(Ft,De,nt){Y.fromArray(p,Ft*3),Z.fromArray(p,De*3),ne.fromArray(p,nt*3),ce.fromArray(w,Ft*2),ve.fromArray(w,De*2),Fe.fromArray(w,nt*2),Z.sub(Y),ne.sub(Y),ve.sub(ce),Fe.sub(ce);let _t=1/(ve.x*Fe.y-Fe.x*ve.y);!isFinite(_t)||(fe.copy(Z).multiplyScalar(Fe.y).addScaledVector(ne,-ve.y).multiplyScalar(_t),oe.copy(ne).multiplyScalar(ve.x).addScaledVector(Z,-Fe.x).multiplyScalar(_t),U[Ft].add(fe),U[De].add(fe),U[nt].add(fe),K[Ft].add(oe),K[De].add(oe),K[nt].add(oe))}let Re=this.groups;Re.length===0&&(Re=[{start:0,count:c.length}]);for(let Ft=0,De=Re.length;Ft<De;++Ft){let nt=Re[Ft],_t=nt.start,Rt=nt.count;for(let Tt=_t,Ct=_t+Rt;Tt<Ct;Tt+=3)Pe(c[Tt+0],c[Tt+1],c[Tt+2])}let We=new je,Je=new je,dt=new je,wt=new je;function Dt(Ft){dt.fromArray(v,Ft*3),wt.copy(dt);let De=U[Ft];We.copy(De),We.sub(dt.multiplyScalar(dt.dot(De))).normalize(),Je.crossVectors(wt,De);let _t=Je.dot(K[Ft])<0?-1:1;O[Ft*4]=We.x,O[Ft*4+1]=We.y,O[Ft*4+2]=We.z,O[Ft*4+3]=_t}for(let Ft=0,De=Re.length;Ft<De;++Ft){let nt=Re[Ft],_t=nt.start,Rt=nt.count;for(let Tt=_t,Ct=_t+Rt;Tt<Ct;Tt+=3)Dt(c[Tt+0]),Dt(c[Tt+1]),Dt(c[Tt+2])}}computeVertexNormals(){let r=this.index,o=this.getAttribute("position");if(o!==void 0){let c=this.getAttribute("normal");if(c===void 0)c=new Ri(new Float32Array(o.count*3),3),this.setAttribute("normal",c);else for(let Z=0,ne=c.count;Z<ne;Z++)c.setXYZ(Z,0,0,0);let p=new je,v=new je,w=new je,S=new je,O=new je,U=new je,K=new je,Y=new je;if(r)for(let Z=0,ne=r.count;Z<ne;Z+=3){let ce=r.getX(Z+0),ve=r.getX(Z+1),Fe=r.getX(Z+2);p.fromBufferAttribute(o,ce),v.fromBufferAttribute(o,ve),w.fromBufferAttribute(o,Fe),K.subVectors(w,v),Y.subVectors(p,v),K.cross(Y),S.fromBufferAttribute(c,ce),O.fromBufferAttribute(c,ve),U.fromBufferAttribute(c,Fe),S.add(K),O.add(K),U.add(K),c.setXYZ(ce,S.x,S.y,S.z),c.setXYZ(ve,O.x,O.y,O.z),c.setXYZ(Fe,U.x,U.y,U.z)}else for(let Z=0,ne=o.count;Z<ne;Z+=3)p.fromBufferAttribute(o,Z+0),v.fromBufferAttribute(o,Z+1),w.fromBufferAttribute(o,Z+2),K.subVectors(w,v),Y.subVectors(p,v),K.cross(Y),c.setXYZ(Z+0,K.x,K.y,K.z),c.setXYZ(Z+1,K.x,K.y,K.z),c.setXYZ(Z+2,K.x,K.y,K.z);this.normalizeNormals(),c.needsUpdate=!0}}merge(r,o){if(!(r&&r.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",r);return}o===void 0&&(o=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let c=this.attributes;for(let p in c){if(r.attributes[p]===void 0)continue;let w=c[p].array,S=r.attributes[p],O=S.array,U=S.itemSize*o,K=Math.min(O.length,w.length-U);for(let Y=0,Z=U;Y<K;Y++,Z++)w[Z]=O[Y]}return this}normalizeNormals(){let r=this.attributes.normal;for(let o=0,c=r.count;o<c;o++)Ns.fromBufferAttribute(r,o),Ns.normalize(),r.setXYZ(o,Ns.x,Ns.y,Ns.z)}toNonIndexed(){function r(S,O){let U=S.array,K=S.itemSize,Y=S.normalized,Z=new U.constructor(O.length*K),ne=0,ce=0;for(let ve=0,Fe=O.length;ve<Fe;ve++){S.isInterleavedBufferAttribute?ne=O[ve]*S.data.stride+S.offset:ne=O[ve]*K;for(let fe=0;fe<K;fe++)Z[ce++]=U[ne++]}return new Ri(Z,K,Y)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let o=new Or,c=this.index.array,p=this.attributes;for(let S in p){let O=p[S],U=r(O,c);o.setAttribute(S,U)}let v=this.morphAttributes;for(let S in v){let O=[],U=v[S];for(let K=0,Y=U.length;K<Y;K++){let Z=U[K],ne=r(Z,c);O.push(ne)}o.morphAttributes[S]=O}o.morphTargetsRelative=this.morphTargetsRelative;let w=this.groups;for(let S=0,O=w.length;S<O;S++){let U=w[S];o.addGroup(U.start,U.count,U.materialIndex)}return o}toJSON(){let r={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),Object.keys(this.userData).length>0&&(r.userData=this.userData),this.parameters!==void 0){let O=this.parameters;for(let U in O)O[U]!==void 0&&(r[U]=O[U]);return r}r.data={attributes:{}};let o=this.index;o!==null&&(r.data.index={type:o.array.constructor.name,array:Array.prototype.slice.call(o.array)});let c=this.attributes;for(let O in c){let U=c[O];r.data.attributes[O]=U.toJSON(r.data)}let p={},v=!1;for(let O in this.morphAttributes){let U=this.morphAttributes[O],K=[];for(let Y=0,Z=U.length;Y<Z;Y++){let ne=U[Y];K.push(ne.toJSON(r.data))}K.length>0&&(p[O]=K,v=!0)}v&&(r.data.morphAttributes=p,r.data.morphTargetsRelative=this.morphTargetsRelative);let w=this.groups;w.length>0&&(r.data.groups=JSON.parse(JSON.stringify(w)));let S=this.boundingSphere;return S!==null&&(r.data.boundingSphere={center:S.center.toArray(),radius:S.radius}),r}clone(){return new this.constructor().copy(this)}copy(r){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let o={};this.name=r.name;let c=r.index;c!==null&&this.setIndex(c.clone(o));let p=r.attributes;for(let U in p){let K=p[U];this.setAttribute(U,K.clone(o))}let v=r.morphAttributes;for(let U in v){let K=[],Y=v[U];for(let Z=0,ne=Y.length;Z<ne;Z++)K.push(Y[Z].clone(o));this.morphAttributes[U]=K}this.morphTargetsRelative=r.morphTargetsRelative;let w=r.groups;for(let U=0,K=w.length;U<K;U++){let Y=w[U];this.addGroup(Y.start,Y.count,Y.materialIndex)}let S=r.boundingBox;S!==null&&(this.boundingBox=S.clone());let O=r.boundingSphere;return O!==null&&(this.boundingSphere=O.clone()),this.drawRange.start=r.drawRange.start,this.drawRange.count=r.drawRange.count,this.userData=r.userData,r.parameters!==void 0&&(this.parameters=Object.assign({},r.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Or.prototype.isBufferGeometry=!0;let Ni=new Wn,Bt=new Mo,mh=new xl,Yl=new je,Ql=new je,Zl=new je,Bp=new je,Up=new je,Xg=new je,_a=new je,gh=new je,ls=new je,zp=new un,yh=new un,jo=new un,pm=new je,wd=new je;class Ks extends bi{constructor(r=new Or,o=new os){super(),this.type="Mesh",this.geometry=r,this.material=o,this.updateMorphTargets()}copy(r){return super.copy(r),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=r.material,this.geometry=r.geometry,this}updateMorphTargets(){let r=this.geometry;if(r.isBufferGeometry){let o=r.morphAttributes,c=Object.keys(o);if(c.length>0){let p=o[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let v=0,w=p.length;v<w;v++){let S=p[v].name||String(v);this.morphTargetInfluences.push(0),this.morphTargetDictionary[S]=v}}}}else{let o=r.morphTargets;o!==void 0&&o.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(r,o){let c=this.geometry,p=this.material,v=this.matrixWorld;if(p===void 0||(c.boundingSphere===null&&c.computeBoundingSphere(),mh.copy(c.boundingSphere),mh.applyMatrix4(v),r.ray.intersectsSphere(mh)===!1)||(Ni.copy(v).invert(),Bt.copy(r.ray).applyMatrix4(Ni),c.boundingBox!==null&&Bt.intersectsBox(c.boundingBox)===!1))return;let w;if(c.isBufferGeometry){let S=c.index,O=c.attributes.position,U=c.morphAttributes.position,K=c.morphTargetsRelative,Y=c.attributes.uv,Z=c.attributes.uv2,ne=c.groups,ce=c.drawRange;if(S!==null)if(Array.isArray(p))for(let ve=0,Fe=ne.length;ve<Fe;ve++){let fe=ne[ve],oe=p[fe.materialIndex],Pe=Math.max(fe.start,ce.start),Re=Math.min(S.count,Math.min(fe.start+fe.count,ce.start+ce.count));for(let We=Pe,Je=Re;We<Je;We+=3){let dt=S.getX(We),wt=S.getX(We+1),Dt=S.getX(We+2);w=$p(this,oe,r,Bt,O,U,K,Y,Z,dt,wt,Dt),w&&(w.faceIndex=Math.floor(We/3),w.face.materialIndex=fe.materialIndex,o.push(w))}}else{let ve=Math.max(0,ce.start),Fe=Math.min(S.count,ce.start+ce.count);for(let fe=ve,oe=Fe;fe<oe;fe+=3){let Pe=S.getX(fe),Re=S.getX(fe+1),We=S.getX(fe+2);w=$p(this,p,r,Bt,O,U,K,Y,Z,Pe,Re,We),w&&(w.faceIndex=Math.floor(fe/3),o.push(w))}}else if(O!==void 0)if(Array.isArray(p))for(let ve=0,Fe=ne.length;ve<Fe;ve++){let fe=ne[ve],oe=p[fe.materialIndex],Pe=Math.max(fe.start,ce.start),Re=Math.min(O.count,Math.min(fe.start+fe.count,ce.start+ce.count));for(let We=Pe,Je=Re;We<Je;We+=3){let dt=We,wt=We+1,Dt=We+2;w=$p(this,oe,r,Bt,O,U,K,Y,Z,dt,wt,Dt),w&&(w.faceIndex=Math.floor(We/3),w.face.materialIndex=fe.materialIndex,o.push(w))}}else{let ve=Math.max(0,ce.start),Fe=Math.min(O.count,ce.start+ce.count);for(let fe=ve,oe=Fe;fe<oe;fe+=3){let Pe=fe,Re=fe+1,We=fe+2;w=$p(this,p,r,Bt,O,U,K,Y,Z,Pe,Re,We),w&&(w.faceIndex=Math.floor(fe/3),o.push(w))}}}else c.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}Ks.prototype.isMesh=!0;function Ad(y,r,o,c,p,v,w,S){let O;if(r.side===B?O=c.intersectTriangle(w,v,p,!0,S):O=c.intersectTriangle(p,v,w,r.side!==$,S),O===null)return null;wd.copy(S),wd.applyMatrix4(y.matrixWorld);let U=o.ray.origin.distanceTo(wd);return U<o.near||U>o.far?null:{distance:U,point:wd.clone(),object:y}}function $p(y,r,o,c,p,v,w,S,O,U,K,Y){Yl.fromBufferAttribute(p,U),Ql.fromBufferAttribute(p,K),Zl.fromBufferAttribute(p,Y);let Z=y.morphTargetInfluences;if(v&&Z){_a.set(0,0,0),gh.set(0,0,0),ls.set(0,0,0);for(let ce=0,ve=v.length;ce<ve;ce++){let Fe=Z[ce],fe=v[ce];Fe!==0&&(Bp.fromBufferAttribute(fe,U),Up.fromBufferAttribute(fe,K),Xg.fromBufferAttribute(fe,Y),w?(_a.addScaledVector(Bp,Fe),gh.addScaledVector(Up,Fe),ls.addScaledVector(Xg,Fe)):(_a.addScaledVector(Bp.sub(Yl),Fe),gh.addScaledVector(Up.sub(Ql),Fe),ls.addScaledVector(Xg.sub(Zl),Fe)))}Yl.add(_a),Ql.add(gh),Zl.add(ls)}y.isSkinnedMesh&&(y.boneTransform(U,Yl),y.boneTransform(K,Ql),y.boneTransform(Y,Zl));let ne=Ad(y,r,o,c,Yl,Ql,Zl,pm);if(ne){S&&(zp.fromBufferAttribute(S,U),yh.fromBufferAttribute(S,K),jo.fromBufferAttribute(S,Y),ne.uv=Gs.getUV(pm,Yl,Ql,Zl,zp,yh,jo,new un)),O&&(zp.fromBufferAttribute(O,U),yh.fromBufferAttribute(O,K),jo.fromBufferAttribute(O,Y),ne.uv2=Gs.getUV(pm,Yl,Ql,Zl,zp,yh,jo,new un));let ce={a:U,b:K,c:Y,normal:new je,materialIndex:0};Gs.getNormal(Yl,Ql,Zl,ce.normal),ne.face=ce}return ne}class st extends Or{constructor(r=1,o=1,c=1,p=1,v=1,w=1){super(),this.type="BoxGeometry",this.parameters={width:r,height:o,depth:c,widthSegments:p,heightSegments:v,depthSegments:w};let S=this;p=Math.floor(p),v=Math.floor(v),w=Math.floor(w);let O=[],U=[],K=[],Y=[],Z=0,ne=0;ce("z","y","x",-1,-1,c,o,r,w,v,0),ce("z","y","x",1,-1,c,o,-r,w,v,1),ce("x","z","y",1,1,r,c,o,p,w,2),ce("x","z","y",1,-1,r,c,-o,p,w,3),ce("x","y","z",1,-1,r,o,c,p,v,4),ce("x","y","z",-1,-1,r,o,-c,p,v,5),this.setIndex(O),this.setAttribute("position",new lr(U,3)),this.setAttribute("normal",new lr(K,3)),this.setAttribute("uv",new lr(Y,2));function ce(ve,Fe,fe,oe,Pe,Re,We,Je,dt,wt,Dt){let Ft=Re/dt,De=We/wt,nt=Re/2,_t=We/2,Rt=Je/2,Tt=dt+1,Ct=wt+1,Zt=0,pn=0,er=new je;for(let ur=0;ur<Ct;ur++){let $n=ur*De-_t;for(let Jt=0;Jt<Tt;Jt++){let kn=Jt*Ft-nt;er[ve]=kn*oe,er[Fe]=$n*Pe,er[fe]=Rt,U.push(er.x,er.y,er.z),er[ve]=0,er[Fe]=0,er[fe]=Je>0?1:-1,K.push(er.x,er.y,er.z),Y.push(Jt/dt),Y.push(1-ur/wt),Zt+=1}}for(let ur=0;ur<wt;ur++)for(let $n=0;$n<dt;$n++){let Jt=Z+$n+Tt*ur,kn=Z+$n+Tt*(ur+1),wr=Z+($n+1)+Tt*(ur+1),yt=Z+($n+1)+Tt*ur;O.push(Jt,kn,yt),O.push(kn,wr,yt),pn+=6}S.addGroup(ne,pn,Dt),ne+=pn,Z+=Zt}}static fromJSON(r){return new st(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments)}}function Ed(y){let r={};for(let o in y){r[o]={};for(let c in y[o]){let p=y[o][c];p&&(p.isColor||p.isMatrix3||p.isMatrix4||p.isVector2||p.isVector3||p.isVector4||p.isTexture||p.isQuaternion)?r[o][c]=p.clone():Array.isArray(p)?r[o][c]=p.slice():r[o][c]=p}}return r}function xa(y){let r={};for(let o=0;o<y.length;o++){let c=Ed(y[o]);for(let p in c)r[p]=c[p]}return r}let uv={clone:Ed,merge:xa};var qg=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Kg=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class da extends ca{constructor(r){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=qg,this.fragmentShader=Kg,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&(r.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(r))}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=Ed(r.uniforms),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){let o=super.toJSON(r);o.glslVersion=this.glslVersion,o.uniforms={};for(let p in this.uniforms){let w=this.uniforms[p].value;w&&w.isTexture?o.uniforms[p]={type:"t",value:w.toJSON(r).uuid}:w&&w.isColor?o.uniforms[p]={type:"c",value:w.getHex()}:w&&w.isVector2?o.uniforms[p]={type:"v2",value:w.toArray()}:w&&w.isVector3?o.uniforms[p]={type:"v3",value:w.toArray()}:w&&w.isVector4?o.uniforms[p]={type:"v4",value:w.toArray()}:w&&w.isMatrix3?o.uniforms[p]={type:"m3",value:w.toArray()}:w&&w.isMatrix4?o.uniforms[p]={type:"m4",value:w.toArray()}:o.uniforms[p]={value:w}}Object.keys(this.defines).length>0&&(o.defines=this.defines),o.vertexShader=this.vertexShader,o.fragmentShader=this.fragmentShader;let c={};for(let p in this.extensions)this.extensions[p]===!0&&(c[p]=!0);return Object.keys(c).length>0&&(o.extensions=c),o}}da.prototype.isShaderMaterial=!0;class ro extends bi{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Wn,this.projectionMatrix=new Wn,this.projectionMatrixInverse=new Wn}copy(r,o){return super.copy(r,o),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this}getWorldDirection(r){this.updateWorldMatrix(!0,!1);let o=this.matrixWorld.elements;return r.set(-o[8],-o[9],-o[10]).normalize()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,o){super.updateWorldMatrix(r,o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}ro.prototype.isCamera=!0;class Ys extends ro{constructor(r=50,o=1,c=.1,p=2e3){super(),this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=c,this.far=p,this.focus=10,this.aspect=o,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,o){return super.copy(r,o),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){let o=.5*this.getFilmHeight()/r;this.fov=xu*2*Math.atan(o),this.updateProjectionMatrix()}getFocalLength(){let r=Math.tan(ml*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return xu*2*Math.atan(Math.tan(ml*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(r,o,c,p,v,w){this.aspect=r/o,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=o,this.view.offsetX=c,this.view.offsetY=p,this.view.width=v,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let r=this.near,o=r*Math.tan(ml*.5*this.fov)/this.zoom,c=2*o,p=this.aspect*c,v=-.5*p,w=this.view;if(this.view!==null&&this.view.enabled){let O=w.fullWidth,U=w.fullHeight;v+=w.offsetX*p/O,o-=w.offsetY*c/U,p*=w.width/O,c*=w.height/U}let S=this.filmOffset;S!==0&&(v+=r*S/this.getFilmWidth()),this.projectionMatrix.makePerspective(v,v+p,o,o-c,r,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){let o=super.toJSON(r);return o.object.fov=this.fov,o.object.zoom=this.zoom,o.object.near=this.near,o.object.far=this.far,o.object.focus=this.focus,o.object.aspect=this.aspect,this.view!==null&&(o.object.view=Object.assign({},this.view)),o.object.filmGauge=this.filmGauge,o.object.filmOffset=this.filmOffset,o}}Ys.prototype.isPerspectiveCamera=!0;let vh=90,Oe=1;class dc extends bi{constructor(r,o,c){if(super(),this.type="CubeCamera",c.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=c;let p=new Ys(vh,Oe,r,o);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new je(1,0,0)),this.add(p);let v=new Ys(vh,Oe,r,o);v.layers=this.layers,v.up.set(0,-1,0),v.lookAt(new je(-1,0,0)),this.add(v);let w=new Ys(vh,Oe,r,o);w.layers=this.layers,w.up.set(0,0,1),w.lookAt(new je(0,1,0)),this.add(w);let S=new Ys(vh,Oe,r,o);S.layers=this.layers,S.up.set(0,0,-1),S.lookAt(new je(0,-1,0)),this.add(S);let O=new Ys(vh,Oe,r,o);O.layers=this.layers,O.up.set(0,-1,0),O.lookAt(new je(0,0,1)),this.add(O);let U=new Ys(vh,Oe,r,o);U.layers=this.layers,U.up.set(0,-1,0),U.lookAt(new je(0,0,-1)),this.add(U)}update(r,o){this.parent===null&&this.updateMatrixWorld();let c=this.renderTarget,[p,v,w,S,O,U]=this.children,K=r.xr.enabled,Y=r.getRenderTarget();r.xr.enabled=!1;let Z=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,r.setRenderTarget(c,0),r.render(o,p),r.setRenderTarget(c,1),r.render(o,v),r.setRenderTarget(c,2),r.render(o,w),r.setRenderTarget(c,3),r.render(o,S),r.setRenderTarget(c,4),r.render(o,O),c.texture.generateMipmaps=Z,r.setRenderTarget(c,5),r.render(o,U),r.setRenderTarget(Y),r.xr.enabled=K,c.texture.needsPMREMUpdate=!0}}class bh extends Rs{constructor(r,o,c,p,v,w,S,O,U,K){r=r!==void 0?r:[],o=o!==void 0?o:te,super(r,o,c,p,v,w,S,O,U,K),this.flipY=!1}get images(){return this.image}set images(r){this.image=r}}bh.prototype.isCubeTexture=!0;class at extends Ta{constructor(r,o,c){Number.isInteger(o)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),o=c),super(r,r,o),o=o||{},this.texture=new bh(void 0,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=o.generateMipmaps!==void 0?o.generateMipmaps:!1,this.texture.minFilter=o.minFilter!==void 0?o.minFilter:St}fromEquirectangularTexture(r,o){this.texture.type=o.type,this.texture.format=li,this.texture.encoding=o.encoding,this.texture.generateMipmaps=o.generateMipmaps,this.texture.minFilter=o.minFilter,this.texture.magFilter=o.magFilter;let c={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},p=new st(5,5,5),v=new da({name:"CubemapFromEquirect",uniforms:Ed(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:B,blending:Q});v.uniforms.tEquirect.value=o;let w=new Ks(p,v),S=o.minFilter;return o.minFilter===cr&&(o.minFilter=St),new dc(1,10,this).update(r,w),o.minFilter=S,w.geometry.dispose(),w.material.dispose(),this}clear(r,o,c,p){let v=r.getRenderTarget();for(let w=0;w<6;w++)r.setRenderTarget(this,w),r.clear(o,c,p);r.setRenderTarget(v)}}at.prototype.isWebGLCubeRenderTarget=!0;let Jl=new je,pc=new je,Xo=new Ts;class qo{constructor(r=new je(1,0,0),o=0){this.normal=r,this.constant=o}set(r,o){return this.normal.copy(r),this.constant=o,this}setComponents(r,o,c,p){return this.normal.set(r,o,c),this.constant=p,this}setFromNormalAndCoplanarPoint(r,o){return this.normal.copy(r),this.constant=-o.dot(this.normal),this}setFromCoplanarPoints(r,o,c){let p=Jl.subVectors(c,o).cross(pc.subVectors(r,o)).normalize();return this.setFromNormalAndCoplanarPoint(p,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){let r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,o){return o.copy(this.normal).multiplyScalar(-this.distanceToPoint(r)).add(r)}intersectLine(r,o){let c=r.delta(Jl),p=this.normal.dot(c);if(p===0)return this.distanceToPoint(r.start)===0?o.copy(r.start):null;let v=-(r.start.dot(this.normal)+this.constant)/p;return v<0||v>1?null:o.copy(c).multiplyScalar(v).add(r.start)}intersectsLine(r){let o=this.distanceToPoint(r.start),c=this.distanceToPoint(r.end);return o<0&&c>0||c<0&&o>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,o){let c=o||Xo.getNormalMatrix(r),p=this.coplanarPoint(Jl).applyMatrix4(r),v=this.normal.applyMatrix3(c).normalize();return this.constant=-p.dot(v),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}}qo.prototype.isPlane=!0;let fc=new xl,xh=new je;class Vp{constructor(r=new qo,o=new qo,c=new qo,p=new qo,v=new qo,w=new qo){this.planes=[r,o,c,p,v,w]}set(r,o,c,p,v,w){let S=this.planes;return S[0].copy(r),S[1].copy(o),S[2].copy(c),S[3].copy(p),S[4].copy(v),S[5].copy(w),this}copy(r){let o=this.planes;for(let c=0;c<6;c++)o[c].copy(r.planes[c]);return this}setFromProjectionMatrix(r){let o=this.planes,c=r.elements,p=c[0],v=c[1],w=c[2],S=c[3],O=c[4],U=c[5],K=c[6],Y=c[7],Z=c[8],ne=c[9],ce=c[10],ve=c[11],Fe=c[12],fe=c[13],oe=c[14],Pe=c[15];return o[0].setComponents(S-p,Y-O,ve-Z,Pe-Fe).normalize(),o[1].setComponents(S+p,Y+O,ve+Z,Pe+Fe).normalize(),o[2].setComponents(S+v,Y+U,ve+ne,Pe+fe).normalize(),o[3].setComponents(S-v,Y-U,ve-ne,Pe-fe).normalize(),o[4].setComponents(S-w,Y-K,ve-ce,Pe-oe).normalize(),o[5].setComponents(S+w,Y+K,ve+ce,Pe+oe).normalize(),this}intersectsObject(r){let o=r.geometry;return o.boundingSphere===null&&o.computeBoundingSphere(),fc.copy(o.boundingSphere).applyMatrix4(r.matrixWorld),this.intersectsSphere(fc)}intersectsSprite(r){return fc.center.set(0,0,0),fc.radius=.7071067811865476,fc.applyMatrix4(r.matrixWorld),this.intersectsSphere(fc)}intersectsSphere(r){let o=this.planes,c=r.center,p=-r.radius;for(let v=0;v<6;v++)if(o[v].distanceToPoint(c)<p)return!1;return!0}intersectsBox(r){let o=this.planes;for(let c=0;c<6;c++){let p=o[c];if(xh.x=p.normal.x>0?r.max.x:r.min.x,xh.y=p.normal.y>0?r.max.y:r.min.y,xh.z=p.normal.z>0?r.max.z:r.min.z,p.distanceToPoint(xh)<0)return!1}return!0}containsPoint(r){let o=this.planes;for(let c=0;c<6;c++)if(o[c].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Hp(){let y=null,r=!1,o=null,c=null;function p(v,w){o(v,w),c=y.requestAnimationFrame(p)}return{start:function(){r!==!0&&o!==null&&(c=y.requestAnimationFrame(p),r=!0)},stop:function(){y.cancelAnimationFrame(c),r=!1},setAnimationLoop:function(v){o=v},setContext:function(v){y=v}}}function cv(y,r){let o=r.isWebGL2,c=new WeakMap;function p(U,K){let Y=U.array,Z=U.usage,ne=y.createBuffer();y.bindBuffer(K,ne),y.bufferData(K,Y,Z),U.onUploadCallback();let ce=y.FLOAT;return Y instanceof Float32Array?ce=y.FLOAT:Y instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):Y instanceof Uint16Array?U.isFloat16BufferAttribute?o?ce=y.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):ce=y.UNSIGNED_SHORT:Y instanceof Int16Array?ce=y.SHORT:Y instanceof Uint32Array?ce=y.UNSIGNED_INT:Y instanceof Int32Array?ce=y.INT:Y instanceof Int8Array?ce=y.BYTE:(Y instanceof Uint8Array||Y instanceof Uint8ClampedArray)&&(ce=y.UNSIGNED_BYTE),{buffer:ne,type:ce,bytesPerElement:Y.BYTES_PER_ELEMENT,version:U.version}}function v(U,K,Y){let Z=K.array,ne=K.updateRange;y.bindBuffer(Y,U),ne.count===-1?y.bufferSubData(Y,0,Z):(o?y.bufferSubData(Y,ne.offset*Z.BYTES_PER_ELEMENT,Z,ne.offset,ne.count):y.bufferSubData(Y,ne.offset*Z.BYTES_PER_ELEMENT,Z.subarray(ne.offset,ne.offset+ne.count)),ne.count=-1)}function w(U){return U.isInterleavedBufferAttribute&&(U=U.data),c.get(U)}function S(U){U.isInterleavedBufferAttribute&&(U=U.data);let K=c.get(U);K&&(y.deleteBuffer(K.buffer),c.delete(U))}function O(U,K){if(U.isGLBufferAttribute){let Z=c.get(U);(!Z||Z.version<U.version)&&c.set(U,{buffer:U.buffer,type:U.type,bytesPerElement:U.elementSize,version:U.version});return}U.isInterleavedBufferAttribute&&(U=U.data);let Y=c.get(U);Y===void 0?c.set(U,p(U,K)):Y.version<U.version&&(v(Y.buffer,U,K),Y.version=U.version)}return{get:w,remove:S,update:O}}class eu extends Or{constructor(r=1,o=1,c=1,p=1){super(),this.type="PlaneGeometry",this.parameters={width:r,height:o,widthSegments:c,heightSegments:p};let v=r/2,w=o/2,S=Math.floor(c),O=Math.floor(p),U=S+1,K=O+1,Y=r/S,Z=o/O,ne=[],ce=[],ve=[],Fe=[];for(let fe=0;fe<K;fe++){let oe=fe*Z-w;for(let Pe=0;Pe<U;Pe++){let Re=Pe*Y-v;ce.push(Re,-oe,0),ve.push(0,0,1),Fe.push(Pe/S),Fe.push(1-fe/O)}}for(let fe=0;fe<O;fe++)for(let oe=0;oe<S;oe++){let Pe=oe+U*fe,Re=oe+U*(fe+1),We=oe+1+U*(fe+1),Je=oe+1+U*fe;ne.push(Pe,Re,Je),ne.push(Re,We,Je)}this.setIndex(ne),this.setAttribute("position",new lr(ce,3)),this.setAttribute("normal",new lr(ve,3)),this.setAttribute("uv",new lr(Fe,2))}static fromJSON(r){return new eu(r.width,r.height,r.widthSegments,r.heightSegments)}}var hv=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,dv=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Yg=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Gp=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Wx=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Ms=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,jx="vec3 transformed = vec3( position );",Xx=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Qg=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Zg=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Jg=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,wh=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,mc=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,pv=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,e0=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Ah=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,fv=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,qx=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,_u=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Sd=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		return texture2D( envMap, uv ).rgb;
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,mv=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Kx=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Yx=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Qx=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Zx=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,gv="gl_FragColor = linearToOutputTexel( gl_FragColor );",yv=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Jx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Eh=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,vv=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,e1=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Td=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,io=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fm=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,bv=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,t1=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,n1=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,r1=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,i1=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,s1=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,t0=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,ci=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,En=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Cu=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,xv=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,wv=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Sh=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,a1=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,o1=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Av=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Ev=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Sv=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Tv=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,n0=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,r0=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Mv=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,i0=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,mm=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,s0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,l1=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,u1=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,c1=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,oi=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Md=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,xi=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,h1=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Th=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Qs=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Zr=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,_v=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Mh=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Cv=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,d1=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,p1=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Iv=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,gm=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,a0=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,o0=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,_d=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,l0=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,f1=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,u0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,kv=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Rv=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Nv=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,m1=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Lv=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,Dv=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Fv=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Pv=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Ov=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,c0=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,h0=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ym=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,d0=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Bv=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,_h=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,ko=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,dn=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Uv=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,g1=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,p0=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;let yn={alphamap_fragment:hv,alphamap_pars_fragment:dv,alphatest_fragment:Yg,alphatest_pars_fragment:Gp,aomap_fragment:Wx,aomap_pars_fragment:Ms,begin_vertex:jx,beginnormal_vertex:Xx,bsdfs:Qg,bumpmap_pars_fragment:Zg,clipping_planes_fragment:Jg,clipping_planes_pars_fragment:wh,clipping_planes_pars_vertex:mc,clipping_planes_vertex:pv,color_fragment:e0,color_pars_fragment:Ah,color_pars_vertex:fv,color_vertex:qx,common:_u,cube_uv_reflection_fragment:Sd,defaultnormal_vertex:mv,displacementmap_pars_vertex:Kx,displacementmap_vertex:Yx,emissivemap_fragment:Qx,emissivemap_pars_fragment:Zx,encodings_fragment:gv,encodings_pars_fragment:yv,envmap_fragment:Jx,envmap_common_pars_fragment:Eh,envmap_pars_fragment:vv,envmap_pars_vertex:e1,envmap_physical_pars_fragment:ci,envmap_vertex:Td,fog_vertex:io,fog_pars_vertex:fm,fog_fragment:bv,fog_pars_fragment:t1,gradientmap_pars_fragment:n1,lightmap_fragment:r1,lightmap_pars_fragment:i1,lights_lambert_vertex:s1,lights_pars_begin:t0,lights_toon_fragment:En,lights_toon_pars_fragment:Cu,lights_phong_fragment:xv,lights_phong_pars_fragment:wv,lights_physical_fragment:Sh,lights_physical_pars_fragment:a1,lights_fragment_begin:o1,lights_fragment_maps:Av,lights_fragment_end:Ev,logdepthbuf_fragment:Sv,logdepthbuf_pars_fragment:Tv,logdepthbuf_pars_vertex:n0,logdepthbuf_vertex:r0,map_fragment:Mv,map_pars_fragment:i0,map_particle_fragment:mm,map_particle_pars_fragment:s0,metalnessmap_fragment:l1,metalnessmap_pars_fragment:u1,morphnormal_vertex:c1,morphtarget_pars_vertex:oi,morphtarget_vertex:Md,normal_fragment_begin:xi,normal_fragment_maps:h1,normal_pars_fragment:Th,normal_pars_vertex:Qs,normal_vertex:Zr,normalmap_pars_fragment:_v,clearcoat_normal_fragment_begin:Mh,clearcoat_normal_fragment_maps:Cv,clearcoat_pars_fragment:d1,output_fragment:p1,packing:Iv,premultiplied_alpha_fragment:gm,project_vertex:a0,dithering_fragment:o0,dithering_pars_fragment:_d,roughnessmap_fragment:l0,roughnessmap_pars_fragment:f1,shadowmap_pars_fragment:u0,shadowmap_pars_vertex:kv,shadowmap_vertex:Rv,shadowmask_pars_fragment:Nv,skinbase_vertex:m1,skinning_pars_vertex:Lv,skinning_vertex:Dv,skinnormal_vertex:Fv,specularmap_fragment:Pv,specularmap_pars_fragment:Ov,tonemapping_fragment:c0,tonemapping_pars_fragment:h0,transmission_fragment:ym,transmission_pars_fragment:d0,uv_pars_fragment:Bv,uv_pars_vertex:_h,uv_vertex:ko,uv2_pars_fragment:dn,uv2_pars_vertex:Uv,uv2_vertex:g1,worldpos_vertex:p0,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},qe={common:{diffuse:{value:new Fn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ts},uv2Transform:{value:new Ts},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new un(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Fn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Fn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ts}},sprite:{diffuse:{value:new Fn(16777215)},opacity:{value:1},center:{value:new un(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ts}}},rs={basic:{uniforms:xa([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.fog]),vertexShader:yn.meshbasic_vert,fragmentShader:yn.meshbasic_frag},lambert:{uniforms:xa([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.fog,qe.lights,{emissive:{value:new Fn(0)}}]),vertexShader:yn.meshlambert_vert,fragmentShader:yn.meshlambert_frag},phong:{uniforms:xa([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new Fn(0)},specular:{value:new Fn(1118481)},shininess:{value:30}}]),vertexShader:yn.meshphong_vert,fragmentShader:yn.meshphong_frag},standard:{uniforms:xa([qe.common,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.roughnessmap,qe.metalnessmap,qe.fog,qe.lights,{emissive:{value:new Fn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},toon:{uniforms:xa([qe.common,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.gradientmap,qe.fog,qe.lights,{emissive:{value:new Fn(0)}}]),vertexShader:yn.meshtoon_vert,fragmentShader:yn.meshtoon_frag},matcap:{uniforms:xa([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,{matcap:{value:null}}]),vertexShader:yn.meshmatcap_vert,fragmentShader:yn.meshmatcap_frag},points:{uniforms:xa([qe.points,qe.fog]),vertexShader:yn.points_vert,fragmentShader:yn.points_frag},dashed:{uniforms:xa([qe.common,qe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yn.linedashed_vert,fragmentShader:yn.linedashed_frag},depth:{uniforms:xa([qe.common,qe.displacementmap]),vertexShader:yn.depth_vert,fragmentShader:yn.depth_frag},normal:{uniforms:xa([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,{opacity:{value:1}}]),vertexShader:yn.meshnormal_vert,fragmentShader:yn.meshnormal_frag},sprite:{uniforms:xa([qe.sprite,qe.fog]),vertexShader:yn.sprite_vert,fragmentShader:yn.sprite_frag},background:{uniforms:{uvTransform:{value:new Ts},t2D:{value:null}},vertexShader:yn.background_vert,fragmentShader:yn.background_frag},cube:{uniforms:xa([qe.envmap,{opacity:{value:1}}]),vertexShader:yn.cube_vert,fragmentShader:yn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yn.equirect_vert,fragmentShader:yn.equirect_frag},distanceRGBA:{uniforms:xa([qe.common,qe.displacementmap,{referencePosition:{value:new je},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yn.distanceRGBA_vert,fragmentShader:yn.distanceRGBA_frag},shadow:{uniforms:xa([qe.lights,qe.fog,{color:{value:new Fn(0)},opacity:{value:1}}]),vertexShader:yn.shadow_vert,fragmentShader:yn.shadow_frag}};rs.physical={uniforms:xa([rs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new un(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Fn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new un},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Fn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Fn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag};function es(y,r,o,c,p,v){let w=new Fn(0),S=p===!0?0:1,O,U,K=null,Y=0,Z=null;function ne(ve,Fe){let fe=!1,oe=Fe.isScene===!0?Fe.background:null;oe&&oe.isTexture&&(oe=r.get(oe));let Pe=y.xr,Re=Pe.getSession&&Pe.getSession();Re&&Re.environmentBlendMode==="additive"&&(oe=null),oe===null?ce(w,S):oe&&oe.isColor&&(ce(oe,1),fe=!0),(y.autoClear||fe)&&y.clear(y.autoClearColor,y.autoClearDepth,y.autoClearStencil),oe&&(oe.isCubeTexture||oe.mapping===rt)?(U===void 0&&(U=new Ks(new st(1,1,1),new da({name:"BackgroundCubeMaterial",uniforms:Ed(rs.cube.uniforms),vertexShader:rs.cube.vertexShader,fragmentShader:rs.cube.fragmentShader,side:B,depthTest:!1,depthWrite:!1,fog:!1})),U.geometry.deleteAttribute("normal"),U.geometry.deleteAttribute("uv"),U.onBeforeRender=function(We,Je,dt){this.matrixWorld.copyPosition(dt.matrixWorld)},Object.defineProperty(U.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(U)),U.material.uniforms.envMap.value=oe,U.material.uniforms.flipEnvMap.value=oe.isCubeTexture&&oe.isRenderTargetTexture===!1?-1:1,(K!==oe||Y!==oe.version||Z!==y.toneMapping)&&(U.material.needsUpdate=!0,K=oe,Y=oe.version,Z=y.toneMapping),ve.unshift(U,U.geometry,U.material,0,0,null)):oe&&oe.isTexture&&(O===void 0&&(O=new Ks(new eu(2,2),new da({name:"BackgroundMaterial",uniforms:Ed(rs.background.uniforms),vertexShader:rs.background.vertexShader,fragmentShader:rs.background.fragmentShader,side:D,depthTest:!1,depthWrite:!1,fog:!1})),O.geometry.deleteAttribute("normal"),Object.defineProperty(O.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(O)),O.material.uniforms.t2D.value=oe,oe.matrixAutoUpdate===!0&&oe.updateMatrix(),O.material.uniforms.uvTransform.value.copy(oe.matrix),(K!==oe||Y!==oe.version||Z!==y.toneMapping)&&(O.material.needsUpdate=!0,K=oe,Y=oe.version,Z=y.toneMapping),ve.unshift(O,O.geometry,O.material,0,0,null))}function ce(ve,Fe){o.buffers.color.setClear(ve.r,ve.g,ve.b,Fe,v)}return{getClearColor:function(){return w},setClearColor:function(ve,Fe=1){w.set(ve),S=Fe,ce(w,S)},getClearAlpha:function(){return S},setClearAlpha:function(ve){S=ve,ce(w,S)},render:ne}}function wi(y,r,o,c){let p=y.getParameter(y.MAX_VERTEX_ATTRIBS),v=c.isWebGL2?null:r.get("OES_vertex_array_object"),w=c.isWebGL2||v!==null,S={},O=ve(null),U=O;function K(_t,Rt,Tt,Ct,Zt){let pn=!1;if(w){let er=ce(Ct,Tt,Rt);U!==er&&(U=er,Z(U.object)),pn=Fe(Ct,Zt),pn&&fe(Ct,Zt)}else{let er=Rt.wireframe===!0;(U.geometry!==Ct.id||U.program!==Tt.id||U.wireframe!==er)&&(U.geometry=Ct.id,U.program=Tt.id,U.wireframe=er,pn=!0)}_t.isInstancedMesh===!0&&(pn=!0),Zt!==null&&o.update(Zt,y.ELEMENT_ARRAY_BUFFER),pn&&(dt(_t,Rt,Tt,Ct),Zt!==null&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,o.get(Zt).buffer))}function Y(){return c.isWebGL2?y.createVertexArray():v.createVertexArrayOES()}function Z(_t){return c.isWebGL2?y.bindVertexArray(_t):v.bindVertexArrayOES(_t)}function ne(_t){return c.isWebGL2?y.deleteVertexArray(_t):v.deleteVertexArrayOES(_t)}function ce(_t,Rt,Tt){let Ct=Tt.wireframe===!0,Zt=S[_t.id];Zt===void 0&&(Zt={},S[_t.id]=Zt);let pn=Zt[Rt.id];pn===void 0&&(pn={},Zt[Rt.id]=pn);let er=pn[Ct];return er===void 0&&(er=ve(Y()),pn[Ct]=er),er}function ve(_t){let Rt=[],Tt=[],Ct=[];for(let Zt=0;Zt<p;Zt++)Rt[Zt]=0,Tt[Zt]=0,Ct[Zt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Rt,enabledAttributes:Tt,attributeDivisors:Ct,object:_t,attributes:{},index:null}}function Fe(_t,Rt){let Tt=U.attributes,Ct=_t.attributes,Zt=0;for(let pn in Ct){let er=Tt[pn],ur=Ct[pn];if(er===void 0||er.attribute!==ur||er.data!==ur.data)return!0;Zt++}return U.attributesNum!==Zt||U.index!==Rt}function fe(_t,Rt){let Tt={},Ct=_t.attributes,Zt=0;for(let pn in Ct){let er=Ct[pn],ur={};ur.attribute=er,er.data&&(ur.data=er.data),Tt[pn]=ur,Zt++}U.attributes=Tt,U.attributesNum=Zt,U.index=Rt}function oe(){let _t=U.newAttributes;for(let Rt=0,Tt=_t.length;Rt<Tt;Rt++)_t[Rt]=0}function Pe(_t){Re(_t,0)}function Re(_t,Rt){let Tt=U.newAttributes,Ct=U.enabledAttributes,Zt=U.attributeDivisors;Tt[_t]=1,Ct[_t]===0&&(y.enableVertexAttribArray(_t),Ct[_t]=1),Zt[_t]!==Rt&&((c.isWebGL2?y:r.get("ANGLE_instanced_arrays"))[c.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](_t,Rt),Zt[_t]=Rt)}function We(){let _t=U.newAttributes,Rt=U.enabledAttributes;for(let Tt=0,Ct=Rt.length;Tt<Ct;Tt++)Rt[Tt]!==_t[Tt]&&(y.disableVertexAttribArray(Tt),Rt[Tt]=0)}function Je(_t,Rt,Tt,Ct,Zt,pn){c.isWebGL2===!0&&(Tt===y.INT||Tt===y.UNSIGNED_INT)?y.vertexAttribIPointer(_t,Rt,Tt,Zt,pn):y.vertexAttribPointer(_t,Rt,Tt,Ct,Zt,pn)}function dt(_t,Rt,Tt,Ct){if(c.isWebGL2===!1&&(_t.isInstancedMesh||Ct.isInstancedBufferGeometry)&&r.get("ANGLE_instanced_arrays")===null)return;oe();let Zt=Ct.attributes,pn=Tt.getAttributes(),er=Rt.defaultAttributeValues;for(let ur in pn){let $n=pn[ur];if($n.location>=0){let Jt=Zt[ur];if(Jt===void 0&&(ur==="instanceMatrix"&&_t.instanceMatrix&&(Jt=_t.instanceMatrix),ur==="instanceColor"&&_t.instanceColor&&(Jt=_t.instanceColor)),Jt!==void 0){let kn=Jt.normalized,wr=Jt.itemSize,yt=o.get(Jt);if(yt===void 0)continue;let Lr=yt.buffer,jn=yt.type,Dr=yt.bytesPerElement;if(Jt.isInterleavedBufferAttribute){let Hn=Jt.data,ei=Hn.stride,Br=Jt.offset;if(Hn&&Hn.isInstancedInterleavedBuffer){for(let rn=0;rn<$n.locationSize;rn++)Re($n.location+rn,Hn.meshPerAttribute);_t.isInstancedMesh!==!0&&Ct._maxInstanceCount===void 0&&(Ct._maxInstanceCount=Hn.meshPerAttribute*Hn.count)}else for(let rn=0;rn<$n.locationSize;rn++)Pe($n.location+rn);y.bindBuffer(y.ARRAY_BUFFER,Lr);for(let rn=0;rn<$n.locationSize;rn++)Je($n.location+rn,wr/$n.locationSize,jn,kn,ei*Dr,(Br+wr/$n.locationSize*rn)*Dr)}else{if(Jt.isInstancedBufferAttribute){for(let Hn=0;Hn<$n.locationSize;Hn++)Re($n.location+Hn,Jt.meshPerAttribute);_t.isInstancedMesh!==!0&&Ct._maxInstanceCount===void 0&&(Ct._maxInstanceCount=Jt.meshPerAttribute*Jt.count)}else for(let Hn=0;Hn<$n.locationSize;Hn++)Pe($n.location+Hn);y.bindBuffer(y.ARRAY_BUFFER,Lr);for(let Hn=0;Hn<$n.locationSize;Hn++)Je($n.location+Hn,wr/$n.locationSize,jn,kn,wr*Dr,wr/$n.locationSize*Hn*Dr)}}else if(er!==void 0){let kn=er[ur];if(kn!==void 0)switch(kn.length){case 2:y.vertexAttrib2fv($n.location,kn);break;case 3:y.vertexAttrib3fv($n.location,kn);break;case 4:y.vertexAttrib4fv($n.location,kn);break;default:y.vertexAttrib1fv($n.location,kn)}}}}We()}function wt(){De();for(let _t in S){let Rt=S[_t];for(let Tt in Rt){let Ct=Rt[Tt];for(let Zt in Ct)ne(Ct[Zt].object),delete Ct[Zt];delete Rt[Tt]}delete S[_t]}}function Dt(_t){if(S[_t.id]===void 0)return;let Rt=S[_t.id];for(let Tt in Rt){let Ct=Rt[Tt];for(let Zt in Ct)ne(Ct[Zt].object),delete Ct[Zt];delete Rt[Tt]}delete S[_t.id]}function Ft(_t){for(let Rt in S){let Tt=S[Rt];if(Tt[_t.id]===void 0)continue;let Ct=Tt[_t.id];for(let Zt in Ct)ne(Ct[Zt].object),delete Ct[Zt];delete Tt[_t.id]}}function De(){nt(),U!==O&&(U=O,Z(U.object))}function nt(){O.geometry=null,O.program=null,O.wireframe=!1}return{setup:K,reset:De,resetDefaultState:nt,dispose:wt,releaseStatesOfGeometry:Dt,releaseStatesOfProgram:Ft,initAttributes:oe,enableAttribute:Pe,disableUnusedAttributes:We}}function w1(y,r,o,c){let p=c.isWebGL2,v;function w(U){v=U}function S(U,K){y.drawArrays(v,U,K),o.update(K,v,1)}function O(U,K,Y){if(Y===0)return;let Z,ne;if(p)Z=y,ne="drawArraysInstanced";else if(Z=r.get("ANGLE_instanced_arrays"),ne="drawArraysInstancedANGLE",Z===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}Z[ne](v,U,K,Y),o.update(K,v,Y)}this.setMode=w,this.render=S,this.renderInstances=O}function A1(y,r,o){let c;function p(){if(c!==void 0)return c;if(r.has("EXT_texture_filter_anisotropic")===!0){let dt=r.get("EXT_texture_filter_anisotropic");c=y.getParameter(dt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else c=0;return c}function v(dt){if(dt==="highp"){if(y.getShaderPrecisionFormat(y.VERTEX_SHADER,y.HIGH_FLOAT).precision>0&&y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.HIGH_FLOAT).precision>0)return"highp";dt="mediump"}return dt==="mediump"&&y.getShaderPrecisionFormat(y.VERTEX_SHADER,y.MEDIUM_FLOAT).precision>0&&y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let w=typeof WebGL2RenderingContext<"u"&&y instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&y instanceof WebGL2ComputeRenderingContext,S=o.precision!==void 0?o.precision:"highp",O=v(S);O!==S&&(console.warn("THREE.WebGLRenderer:",S,"not supported, using",O,"instead."),S=O);let U=w||r.has("WEBGL_draw_buffers"),K=o.logarithmicDepthBuffer===!0,Y=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS),Z=y.getParameter(y.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ne=y.getParameter(y.MAX_TEXTURE_SIZE),ce=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),ve=y.getParameter(y.MAX_VERTEX_ATTRIBS),Fe=y.getParameter(y.MAX_VERTEX_UNIFORM_VECTORS),fe=y.getParameter(y.MAX_VARYING_VECTORS),oe=y.getParameter(y.MAX_FRAGMENT_UNIFORM_VECTORS),Pe=Z>0,Re=w||r.has("OES_texture_float"),We=Pe&&Re,Je=w?y.getParameter(y.MAX_SAMPLES):0;return{isWebGL2:w,drawBuffers:U,getMaxAnisotropy:p,getMaxPrecision:v,precision:S,logarithmicDepthBuffer:K,maxTextures:Y,maxVertexTextures:Z,maxTextureSize:ne,maxCubemapSize:ce,maxAttributes:ve,maxVertexUniforms:Fe,maxVaryings:fe,maxFragmentUniforms:oe,vertexTextures:Pe,floatFragmentTextures:Re,floatVertexTextures:We,maxSamples:Je}}function E1(y){let r=this,o=null,c=0,p=!1,v=!1,w=new qo,S=new Ts,O={value:null,needsUpdate:!1};this.uniform=O,this.numPlanes=0,this.numIntersection=0,this.init=function(Y,Z,ne){let ce=Y.length!==0||Z||c!==0||p;return p=Z,o=K(Y,ne,0),c=Y.length,ce},this.beginShadows=function(){v=!0,K(null)},this.endShadows=function(){v=!1,U()},this.setState=function(Y,Z,ne){let ce=Y.clippingPlanes,ve=Y.clipIntersection,Fe=Y.clipShadows,fe=y.get(Y);if(!p||ce===null||ce.length===0||v&&!Fe)v?K(null):U();else{let oe=v?0:c,Pe=oe*4,Re=fe.clippingState||null;O.value=Re,Re=K(ce,Z,Pe,ne);for(let We=0;We!==Pe;++We)Re[We]=o[We];fe.clippingState=Re,this.numIntersection=ve?this.numPlanes:0,this.numPlanes+=oe}};function U(){O.value!==o&&(O.value=o,O.needsUpdate=c>0),r.numPlanes=c,r.numIntersection=0}function K(Y,Z,ne,ce){let ve=Y!==null?Y.length:0,Fe=null;if(ve!==0){if(Fe=O.value,ce!==!0||Fe===null){let fe=ne+ve*4,oe=Z.matrixWorldInverse;S.getNormalMatrix(oe),(Fe===null||Fe.length<fe)&&(Fe=new Float32Array(fe));for(let Pe=0,Re=ne;Pe!==ve;++Pe,Re+=4)w.copy(Y[Pe]).applyMatrix4(oe,S),w.normal.toArray(Fe,Re),Fe[Re+3]=w.constant}O.value=Fe,O.needsUpdate=!0}return r.numPlanes=ve,r.numIntersection=0,Fe}}function S1(y){let r=new WeakMap;function o(w,S){return S===Le?w.mapping=te:S===Ye&&(w.mapping=me),w}function c(w){if(w&&w.isTexture&&w.isRenderTargetTexture===!1){let S=w.mapping;if(S===Le||S===Ye)if(r.has(w)){let O=r.get(w).texture;return o(O,w.mapping)}else{let O=w.image;if(O&&O.height>0){let U=new at(O.height/2);return U.fromEquirectangularTexture(y,w),r.set(w,U),w.addEventListener("dispose",p),o(U.texture,w.mapping)}else return null}}return w}function p(w){let S=w.target;S.removeEventListener("dispose",p);let O=r.get(S);O!==void 0&&(r.delete(S),O.dispose())}function v(){r=new WeakMap}return{get:c,dispose:v}}class Cd extends ro{constructor(r=-1,o=1,c=1,p=-1,v=.1,w=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=o,this.top=c,this.bottom=p,this.near=v,this.far=w,this.updateProjectionMatrix()}copy(r,o){return super.copy(r,o),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,o,c,p,v,w){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=o,this.view.offsetX=c,this.view.offsetY=p,this.view.width=v,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let r=(this.right-this.left)/(2*this.zoom),o=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,p=(this.top+this.bottom)/2,v=c-r,w=c+r,S=p+o,O=p-o;if(this.view!==null&&this.view.enabled){let U=(this.right-this.left)/this.view.fullWidth/this.zoom,K=(this.top-this.bottom)/this.view.fullHeight/this.zoom;v+=U*this.view.offsetX,w=v+U*this.view.width,S-=K*this.view.offsetY,O=S-K*this.view.height}this.projectionMatrix.makeOrthographic(v,w,S,O,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){let o=super.toJSON(r);return o.object.zoom=this.zoom,o.object.left=this.left,o.object.right=this.right,o.object.top=this.top,o.object.bottom=this.bottom,o.object.near=this.near,o.object.far=this.far,this.view!==null&&(o.object.view=Object.assign({},this.view)),o}}Cd.prototype.isOrthographicCamera=!0;class ja extends da{constructor(r){super(r),this.type="RawShaderMaterial"}}ja.prototype.isRawShaderMaterial=!0;let Iu=4,Jn=8,Aa=Math.pow(2,Jn),Wp=[.125,.215,.35,.446,.526,.582],Ch=Jn-Iu+1+Wp.length,ku=20,Sl=new Cd,{_lodPlanes:Un,_sizeLods:jp,_sigmas:_s}=g0(),Tl=new Fn,Id=null,Ml=(1+Math.sqrt(5))/2,Ru=1/Ml,Xp=[new je(1,1,1),new je(-1,1,1),new je(1,1,-1),new je(-1,1,-1),new je(0,Ml,Ru),new je(0,Ml,-Ru),new je(Ru,0,Ml),new je(-Ru,0,Ml),new je(Ml,Ru,0),new je(-Ml,Ru,0)];class tu{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._blurMaterial=bm(ku),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(r,o=0,c=.1,p=100){Id=this._renderer.getRenderTarget();let v=this._allocateTargets();return this._sceneToCubeUV(r,c,p,v),o>0&&this._blur(v,0,0,o),this._applyPMREM(v),this._cleanup(v),v}fromEquirectangular(r,o=null){return this._fromTexture(r,o)}fromCubemap(r,o=null){return this._fromTexture(r,o)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=yc(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=kd(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let r=0;r<Un.length;r++)Un[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(Id),r.scissorTest=!1,qp(r,0,0,r.width,r.height)}_fromTexture(r,o){Id=this._renderer.getRenderTarget();let c=o||this._allocateTargets(r);return this._textureToCubeUV(r,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTargets(r){let o={magFilter:St,minFilter:St,generateMipmaps:!1,type:Vi,format:li,encoding:Ei,depthBuffer:!1},c=vm(o);return c.depthBuffer=!r,this._pingPongRenderTarget===null&&(this._pingPongRenderTarget=vm(o)),c}_compileMaterial(r){let o=new Ks(Un[0],r);this._renderer.compile(o,Sl)}_sceneToCubeUV(r,o,c,p){let S=new Ys(90,1,o,c),O=[1,-1,1,1,1,1],U=[1,1,1,-1,-1,-1],K=this._renderer,Y=K.autoClear,Z=K.toneMapping;K.getClearColor(Tl),K.toneMapping=J,K.autoClear=!1;let ne=new os({name:"PMREM.Background",side:B,depthWrite:!1,depthTest:!1}),ce=new Ks(new st,ne),ve=!1,Fe=r.background;Fe?Fe.isColor&&(ne.color.copy(Fe),r.background=null,ve=!0):(ne.color.copy(Tl),ve=!0);for(let fe=0;fe<6;fe++){let oe=fe%3;oe===0?(S.up.set(0,O[fe],0),S.lookAt(U[fe],0,0)):oe===1?(S.up.set(0,0,O[fe]),S.lookAt(0,U[fe],0)):(S.up.set(0,O[fe],0),S.lookAt(0,0,U[fe])),qp(p,oe*Aa,fe>2?Aa:0,Aa,Aa),K.setRenderTarget(p),ve&&K.render(ce,S),K.render(r,S)}ce.geometry.dispose(),ce.material.dispose(),K.toneMapping=Z,K.autoClear=Y,r.background=Fe}_textureToCubeUV(r,o){let c=this._renderer,p=r.mapping===te||r.mapping===me;p?(this._cubemapShader===null&&(this._cubemapShader=yc()),this._cubemapShader.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectShader===null&&(this._equirectShader=kd());let v=p?this._cubemapShader:this._equirectShader,w=new Ks(Un[0],v),S=v.uniforms;S.envMap.value=r,p||S.texelSize.value.set(1/r.image.width,1/r.image.height),qp(o,0,0,3*Aa,2*Aa),c.setRenderTarget(o),c.render(w,Sl)}_applyPMREM(r){let o=this._renderer,c=o.autoClear;o.autoClear=!1;for(let p=1;p<Ch;p++){let v=Math.sqrt(_s[p]*_s[p]-_s[p-1]*_s[p-1]),w=Xp[(p-1)%Xp.length];this._blur(r,p-1,p,v,w)}o.autoClear=c}_blur(r,o,c,p,v){let w=this._pingPongRenderTarget;this._halfBlur(r,w,o,c,p,"latitudinal",v),this._halfBlur(w,r,c,c,p,"longitudinal",v)}_halfBlur(r,o,c,p,v,w,S){let O=this._renderer,U=this._blurMaterial;w!=="latitudinal"&&w!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let K=3,Y=new Ks(Un[p],U),Z=U.uniforms,ne=jp[c]-1,ce=isFinite(v)?Math.PI/(2*ne):2*Math.PI/(2*ku-1),ve=v/ce,Fe=isFinite(v)?1+Math.floor(K*ve):ku;Fe>ku&&console.warn(`sigmaRadians, ${v}, is too large and will clip, as it requested ${Fe} samples when the maximum is set to ${ku}`);let fe=[],oe=0;for(let Je=0;Je<ku;++Je){let dt=Je/ve,wt=Math.exp(-dt*dt/2);fe.push(wt),Je===0?oe+=wt:Je<Fe&&(oe+=2*wt)}for(let Je=0;Je<fe.length;Je++)fe[Je]=fe[Je]/oe;Z.envMap.value=r.texture,Z.samples.value=Fe,Z.weights.value=fe,Z.latitudinal.value=w==="latitudinal",S&&(Z.poleAxis.value=S),Z.dTheta.value=ce,Z.mipInt.value=Jn-c;let Pe=jp[p],Re=3*Math.max(0,Aa-2*Pe),We=(p===0?0:2*Aa)+2*Pe*(p>Jn-Iu?p-Jn+Iu:0);qp(o,Re,We,3*Pe,2*Pe),O.setRenderTarget(o),O.render(Y,Sl)}}function g0(){let y=[],r=[],o=[],c=Jn;for(let p=0;p<Ch;p++){let v=Math.pow(2,c);r.push(v);let w=1/v;p>Jn-Iu?w=Wp[p-Jn+Iu-1]:p===0&&(w=0),o.push(w);let S=1/(v-1),O=-S/2,U=1+S/2,K=[O,O,U,O,U,U,O,O,U,U,O,U],Y=6,Z=6,ne=3,ce=2,ve=1,Fe=new Float32Array(ne*Z*Y),fe=new Float32Array(ce*Z*Y),oe=new Float32Array(ve*Z*Y);for(let Re=0;Re<Y;Re++){let We=Re%3*2/3-1,Je=Re>2?0:-1,dt=[We,Je,0,We+2/3,Je,0,We+2/3,Je+1,0,We,Je,0,We+2/3,Je+1,0,We,Je+1,0];Fe.set(dt,ne*Z*Re),fe.set(K,ce*Z*Re);let wt=[Re,Re,Re,Re,Re,Re];oe.set(wt,ve*Z*Re)}let Pe=new Or;Pe.setAttribute("position",new Ri(Fe,ne)),Pe.setAttribute("uv",new Ri(fe,ce)),Pe.setAttribute("faceIndex",new Ri(oe,ve)),y.push(Pe),c>Iu&&c--}return{_lodPlanes:y,_sizeLods:r,_sigmas:o}}function vm(y){let r=new Ta(3*Aa,3*Aa,y);return r.texture.mapping=rt,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function qp(y,r,o,c,p){y.viewport.set(r,o,c,p),y.scissor.set(r,o,c,p)}function bm(y){let r=new Float32Array(y),o=new je(0,1,0);return new ja({name:"SphericalGaussianBlur",defines:{n:y},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:Kp(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Q,depthTest:!1,depthWrite:!1})}function kd(){let y=new un(1,1);return new ja({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:y}},vertexShader:Kp(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = texture2D ( envMap, uv ).rgb;
				uv.x += texelSize.x;
				vec3 tr = texture2D ( envMap, uv ).rgb;
				uv.y += texelSize.y;
				vec3 br = texture2D ( envMap, uv ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = texture2D ( envMap, uv ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

			}
		`,blending:Q,depthTest:!1,depthWrite:!1})}function yc(){return new ja({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Kp(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Q,depthTest:!1,depthWrite:!1})}function Kp(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function y0(y){let r=new WeakMap,o=null;function c(S){if(S&&S.isTexture){let O=S.mapping,U=O===Le||O===Ye,K=O===te||O===me;if(U||K)if(S.isRenderTargetTexture&&S.needsPMREMUpdate===!0){S.needsPMREMUpdate=!1;let Y=r.get(S);return o===null&&(o=new tu(y)),Y=U?o.fromEquirectangular(S,Y):o.fromCubemap(S,Y),r.set(S,Y),Y.texture}else{if(r.has(S))return r.get(S).texture;{let Y=S.image;if(U&&Y&&Y.height>0||K&&Y&&p(Y)){o===null&&(o=new tu(y));let Z=U?o.fromEquirectangular(S):o.fromCubemap(S);return r.set(S,Z),S.addEventListener("dispose",v),Z.texture}else return null}}}return S}function p(S){let O=0,U=6;for(let K=0;K<U;K++)S[K]!==void 0&&O++;return O===U}function v(S){let O=S.target;O.removeEventListener("dispose",v);let U=r.get(O);U!==void 0&&(r.delete(O),U.dispose())}function w(){r=new WeakMap,o!==null&&(o.dispose(),o=null)}return{get:c,dispose:w}}function v0(y){let r={};function o(c){if(r[c]!==void 0)return r[c];let p;switch(c){case"WEBGL_depth_texture":p=y.getExtension("WEBGL_depth_texture")||y.getExtension("MOZ_WEBGL_depth_texture")||y.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":p=y.getExtension("EXT_texture_filter_anisotropic")||y.getExtension("MOZ_EXT_texture_filter_anisotropic")||y.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":p=y.getExtension("WEBGL_compressed_texture_s3tc")||y.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||y.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":p=y.getExtension("WEBGL_compressed_texture_pvrtc")||y.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:p=y.getExtension(c)}return r[c]=p,p}return{has:function(c){return o(c)!==null},init:function(c){c.isWebGL2?o("EXT_color_buffer_float"):(o("WEBGL_depth_texture"),o("OES_texture_float"),o("OES_texture_half_float"),o("OES_texture_half_float_linear"),o("OES_standard_derivatives"),o("OES_element_index_uint"),o("OES_vertex_array_object"),o("ANGLE_instanced_arrays")),o("OES_texture_float_linear"),o("EXT_color_buffer_half_float"),o("WEBGL_multisampled_render_to_texture")},get:function(c){let p=o(c);return p===null&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported."),p}}}function b0(y,r,o,c){let p={},v=new WeakMap;function w(Y){let Z=Y.target;Z.index!==null&&r.remove(Z.index);for(let ce in Z.attributes)r.remove(Z.attributes[ce]);Z.removeEventListener("dispose",w),delete p[Z.id];let ne=v.get(Z);ne&&(r.remove(ne),v.delete(Z)),c.releaseStatesOfGeometry(Z),Z.isInstancedBufferGeometry===!0&&delete Z._maxInstanceCount,o.memory.geometries--}function S(Y,Z){return p[Z.id]===!0||(Z.addEventListener("dispose",w),p[Z.id]=!0,o.memory.geometries++),Z}function O(Y){let Z=Y.attributes;for(let ce in Z)r.update(Z[ce],y.ARRAY_BUFFER);let ne=Y.morphAttributes;for(let ce in ne){let ve=ne[ce];for(let Fe=0,fe=ve.length;Fe<fe;Fe++)r.update(ve[Fe],y.ARRAY_BUFFER)}}function U(Y){let Z=[],ne=Y.index,ce=Y.attributes.position,ve=0;if(ne!==null){let oe=ne.array;ve=ne.version;for(let Pe=0,Re=oe.length;Pe<Re;Pe+=3){let We=oe[Pe+0],Je=oe[Pe+1],dt=oe[Pe+2];Z.push(We,Je,Je,dt,dt,We)}}else{let oe=ce.array;ve=ce.version;for(let Pe=0,Re=oe.length/3-1;Pe<Re;Pe+=3){let We=Pe+0,Je=Pe+1,dt=Pe+2;Z.push(We,Je,Je,dt,dt,We)}}let Fe=new(cd(Z)?dm:Co)(Z,1);Fe.version=ve;let fe=v.get(Y);fe&&r.remove(fe),v.set(Y,Fe)}function K(Y){let Z=v.get(Y);if(Z){let ne=Y.index;ne!==null&&Z.version<ne.version&&U(Y)}else U(Y);return v.get(Y)}return{get:S,update:O,getWireframeAttribute:K}}function x0(y,r,o,c){let p=c.isWebGL2,v;function w(Z){v=Z}let S,O;function U(Z){S=Z.type,O=Z.bytesPerElement}function K(Z,ne){y.drawElements(v,ne,S,Z*O),o.update(ne,v,1)}function Y(Z,ne,ce){if(ce===0)return;let ve,Fe;if(p)ve=y,Fe="drawElementsInstanced";else if(ve=r.get("ANGLE_instanced_arrays"),Fe="drawElementsInstancedANGLE",ve===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}ve[Fe](v,ne,S,Z*O,ce),o.update(ne,v,ce)}this.setMode=w,this.setIndex=U,this.render=K,this.renderInstances=Y}function w0(y){let r={geometries:0,textures:0},o={frame:0,calls:0,triangles:0,points:0,lines:0};function c(v,w,S){switch(o.calls++,w){case y.TRIANGLES:o.triangles+=S*(v/3);break;case y.LINES:o.lines+=S*(v/2);break;case y.LINE_STRIP:o.lines+=S*(v-1);break;case y.LINE_LOOP:o.lines+=S*v;break;case y.POINTS:o.points+=S*v;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",w);break}}function p(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0}return{memory:r,render:o,programs:null,autoReset:!0,reset:p,update:c}}class vc extends Rs{constructor(r=null,o=1,c=1,p=1){super(null),this.image={data:r,width:o,height:c,depth:p},this.magFilter=In,this.minFilter=In,this.wrapR=gn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}vc.prototype.isDataTexture2DArray=!0;function Ko(y,r){return y[0]-r[0]}function Nu(y,r){return Math.abs(r[1])-Math.abs(y[1])}function ta(y,r){let o=1,c=r.isInterleavedBufferAttribute?r.data.array:r.array;c instanceof Int8Array?o=127:c instanceof Int16Array?o=32767:c instanceof Int32Array?o=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",c),y.divideScalar(o)}function bc(y,r,o){let c={},p=new Float32Array(8),v=new WeakMap,w=new je,S=[];for(let U=0;U<8;U++)S[U]=[U,0];function O(U,K,Y,Z){let ne=U.morphTargetInfluences;if(r.isWebGL2===!0){let ce=K.morphAttributes.position.length,ve=v.get(K);if(ve===void 0||ve.count!==ce){let nt=function(){Ft.dispose(),v.delete(K),K.removeEventListener("dispose",nt)};ve!==void 0&&ve.texture.dispose();let oe=K.morphAttributes.normal!==void 0,Pe=K.morphAttributes.position,Re=K.morphAttributes.normal||[],We=K.attributes.position.count,Je=oe===!0?2:1,dt=We*Je,wt=1;dt>r.maxTextureSize&&(wt=Math.ceil(dt/r.maxTextureSize),dt=r.maxTextureSize);let Dt=new Float32Array(dt*wt*4*ce),Ft=new vc(Dt,dt,wt,ce);Ft.format=li,Ft.type=ti,Ft.needsUpdate=!0;let De=Je*4;for(let _t=0;_t<ce;_t++){let Rt=Pe[_t],Tt=Re[_t],Ct=dt*wt*4*_t;for(let Zt=0;Zt<Rt.count;Zt++){w.fromBufferAttribute(Rt,Zt),Rt.normalized===!0&&ta(w,Rt);let pn=Zt*De;Dt[Ct+pn+0]=w.x,Dt[Ct+pn+1]=w.y,Dt[Ct+pn+2]=w.z,Dt[Ct+pn+3]=0,oe===!0&&(w.fromBufferAttribute(Tt,Zt),Tt.normalized===!0&&ta(w,Tt),Dt[Ct+pn+4]=w.x,Dt[Ct+pn+5]=w.y,Dt[Ct+pn+6]=w.z,Dt[Ct+pn+7]=0)}}ve={count:ce,texture:Ft,size:new un(dt,wt)},v.set(K,ve),K.addEventListener("dispose",nt)}let Fe=0;for(let oe=0;oe<ne.length;oe++)Fe+=ne[oe];let fe=K.morphTargetsRelative?1:1-Fe;Z.getUniforms().setValue(y,"morphTargetBaseInfluence",fe),Z.getUniforms().setValue(y,"morphTargetInfluences",ne),Z.getUniforms().setValue(y,"morphTargetsTexture",ve.texture,o),Z.getUniforms().setValue(y,"morphTargetsTextureSize",ve.size)}else{let ce=ne===void 0?0:ne.length,ve=c[K.id];if(ve===void 0||ve.length!==ce){ve=[];for(let Re=0;Re<ce;Re++)ve[Re]=[Re,0];c[K.id]=ve}for(let Re=0;Re<ce;Re++){let We=ve[Re];We[0]=Re,We[1]=ne[Re]}ve.sort(Nu);for(let Re=0;Re<8;Re++)Re<ce&&ve[Re][1]?(S[Re][0]=ve[Re][0],S[Re][1]=ve[Re][1]):(S[Re][0]=Number.MAX_SAFE_INTEGER,S[Re][1]=0);S.sort(Ko);let Fe=K.morphAttributes.position,fe=K.morphAttributes.normal,oe=0;for(let Re=0;Re<8;Re++){let We=S[Re],Je=We[0],dt=We[1];Je!==Number.MAX_SAFE_INTEGER&&dt?(Fe&&K.getAttribute("morphTarget"+Re)!==Fe[Je]&&K.setAttribute("morphTarget"+Re,Fe[Je]),fe&&K.getAttribute("morphNormal"+Re)!==fe[Je]&&K.setAttribute("morphNormal"+Re,fe[Je]),p[Re]=dt,oe+=dt):(Fe&&K.hasAttribute("morphTarget"+Re)===!0&&K.deleteAttribute("morphTarget"+Re),fe&&K.hasAttribute("morphNormal"+Re)===!0&&K.deleteAttribute("morphNormal"+Re),p[Re]=0)}let Pe=K.morphTargetsRelative?1:1-oe;Z.getUniforms().setValue(y,"morphTargetBaseInfluence",Pe),Z.getUniforms().setValue(y,"morphTargetInfluences",p)}}return{update:O}}function A0(y,r,o,c){let p=new WeakMap;function v(O){let U=c.render.frame,K=O.geometry,Y=r.get(O,K);return p.get(Y)!==U&&(r.update(Y),p.set(Y,U)),O.isInstancedMesh&&(O.hasEventListener("dispose",S)===!1&&O.addEventListener("dispose",S),o.update(O.instanceMatrix,y.ARRAY_BUFFER),O.instanceColor!==null&&o.update(O.instanceColor,y.ARRAY_BUFFER)),Y}function w(){p=new WeakMap}function S(O){let U=O.target;U.removeEventListener("dispose",S),o.remove(U.instanceMatrix),U.instanceColor!==null&&o.remove(U.instanceColor)}return{update:v,dispose:w}}class Rd extends Rs{constructor(r=null,o=1,c=1,p=1){super(null),this.image={data:r,width:o,height:c,depth:p},this.magFilter=In,this.minFilter=In,this.wrapR=gn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Rd.prototype.isDataTexture3D=!0;let xm=new Rs,Ih=new vc,xc=new Rd,Lu=new bh,pa=[],nu=[],Ca=new Float32Array(16),pt=new Float32Array(9),Nd=new Float32Array(4);function wc(y,r,o){let c=y[0];if(c<=0||c>0)return y;let p=r*o,v=pa[p];if(v===void 0&&(v=new Float32Array(p),pa[p]=v),r!==0){c.toArray(v,0);for(let w=1,S=0;w!==r;++w)S+=o,y[w].toArray(v,S)}return v}function Ti(y,r){if(y.length!==r.length)return!1;for(let o=0,c=y.length;o<c;o++)if(y[o]!==r[o])return!1;return!0}function ds(y,r){for(let o=0,c=r.length;o<c;o++)y[o]=r[o]}function hi(y,r){let o=nu[r];o===void 0&&(o=new Int32Array(r),nu[r]=o);for(let c=0;c!==r;++c)o[c]=y.allocateTextureUnit();return o}function kh(y,r){let o=this.cache;o[0]!==r&&(y.uniform1f(this.addr,r),o[0]=r)}function T1(y,r){let o=this.cache;if(r.x!==void 0)(o[0]!==r.x||o[1]!==r.y)&&(y.uniform2f(this.addr,r.x,r.y),o[0]=r.x,o[1]=r.y);else{if(Ti(o,r))return;y.uniform2fv(this.addr,r),ds(o,r)}}function Yp(y,r){let o=this.cache;if(r.x!==void 0)(o[0]!==r.x||o[1]!==r.y||o[2]!==r.z)&&(y.uniform3f(this.addr,r.x,r.y,r.z),o[0]=r.x,o[1]=r.y,o[2]=r.z);else if(r.r!==void 0)(o[0]!==r.r||o[1]!==r.g||o[2]!==r.b)&&(y.uniform3f(this.addr,r.r,r.g,r.b),o[0]=r.r,o[1]=r.g,o[2]=r.b);else{if(Ti(o,r))return;y.uniform3fv(this.addr,r),ds(o,r)}}function Ld(y,r){let o=this.cache;if(r.x!==void 0)(o[0]!==r.x||o[1]!==r.y||o[2]!==r.z||o[3]!==r.w)&&(y.uniform4f(this.addr,r.x,r.y,r.z,r.w),o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=r.w);else{if(Ti(o,r))return;y.uniform4fv(this.addr,r),ds(o,r)}}function Hv(y,r){let o=this.cache,c=r.elements;if(c===void 0){if(Ti(o,r))return;y.uniformMatrix2fv(this.addr,!1,r),ds(o,r)}else{if(Ti(o,c))return;Nd.set(c),y.uniformMatrix2fv(this.addr,!1,Nd),ds(o,c)}}function Gv(y,r){let o=this.cache,c=r.elements;if(c===void 0){if(Ti(o,r))return;y.uniformMatrix3fv(this.addr,!1,r),ds(o,r)}else{if(Ti(o,c))return;pt.set(c),y.uniformMatrix3fv(this.addr,!1,pt),ds(o,c)}}function Wv(y,r){let o=this.cache,c=r.elements;if(c===void 0){if(Ti(o,r))return;y.uniformMatrix4fv(this.addr,!1,r),ds(o,r)}else{if(Ti(o,c))return;Ca.set(c),y.uniformMatrix4fv(this.addr,!1,Ca),ds(o,c)}}function E0(y,r){let o=this.cache;o[0]!==r&&(y.uniform1i(this.addr,r),o[0]=r)}function jv(y,r){let o=this.cache;Ti(o,r)||(y.uniform2iv(this.addr,r),ds(o,r))}function Dd(y,r){let o=this.cache;Ti(o,r)||(y.uniform3iv(this.addr,r),ds(o,r))}function S0(y,r){let o=this.cache;Ti(o,r)||(y.uniform4iv(this.addr,r),ds(o,r))}function Xa(y,r){let o=this.cache;o[0]!==r&&(y.uniform1ui(this.addr,r),o[0]=r)}function Xv(y,r){let o=this.cache;Ti(o,r)||(y.uniform2uiv(this.addr,r),ds(o,r))}function qv(y,r){let o=this.cache;Ti(o,r)||(y.uniform3uiv(this.addr,r),ds(o,r))}function Kv(y,r){let o=this.cache;Ti(o,r)||(y.uniform4uiv(this.addr,r),ds(o,r))}function Yv(y,r,o){let c=this.cache,p=o.allocateTextureUnit();c[0]!==p&&(y.uniform1i(this.addr,p),c[0]=p),o.safeSetTexture2D(r||xm,p)}function Du(y,r,o){let c=this.cache,p=o.allocateTextureUnit();c[0]!==p&&(y.uniform1i(this.addr,p),c[0]=p),o.setTexture3D(r||xc,p)}function wm(y,r,o){let c=this.cache,p=o.allocateTextureUnit();c[0]!==p&&(y.uniform1i(this.addr,p),c[0]=p),o.safeSetTextureCube(r||Lu,p)}function T0(y,r,o){let c=this.cache,p=o.allocateTextureUnit();c[0]!==p&&(y.uniform1i(this.addr,p),c[0]=p),o.setTexture2DArray(r||Ih,p)}function Am(y){switch(y){case 5126:return kh;case 35664:return T1;case 35665:return Yp;case 35666:return Ld;case 35674:return Hv;case 35675:return Gv;case 35676:return Wv;case 5124:case 35670:return E0;case 35667:case 35671:return jv;case 35668:case 35672:return Dd;case 35669:case 35673:return S0;case 5125:return Xa;case 36294:return Xv;case 36295:return qv;case 36296:return Kv;case 35678:case 36198:case 36298:case 36306:case 35682:return Yv;case 35679:case 36299:case 36307:return Du;case 35680:case 36300:case 36308:case 36293:return wm;case 36289:case 36303:case 36311:case 36292:return T0}}function M0(y,r){y.uniform1fv(this.addr,r)}function Qv(y,r){let o=wc(r,this.size,2);y.uniform2fv(this.addr,o)}function Zv(y,r){let o=wc(r,this.size,3);y.uniform3fv(this.addr,o)}function Qp(y,r){let o=wc(r,this.size,4);y.uniform4fv(this.addr,o)}function Em(y,r){let o=wc(r,this.size,4);y.uniformMatrix2fv(this.addr,!1,o)}function Sm(y,r){let o=wc(r,this.size,9);y.uniformMatrix3fv(this.addr,!1,o)}function Jv(y,r){let o=wc(r,this.size,16);y.uniformMatrix4fv(this.addr,!1,o)}function _0(y,r){y.uniform1iv(this.addr,r)}function Fd(y,r){y.uniform2iv(this.addr,r)}function M1(y,r){y.uniform3iv(this.addr,r)}function C0(y,r){y.uniform4iv(this.addr,r)}function so(y,r){y.uniform1uiv(this.addr,r)}function Ia(y,r){y.uniform2uiv(this.addr,r)}function I0(y,r){y.uniform3uiv(this.addr,r)}function eb(y,r){y.uniform4uiv(this.addr,r)}function tb(y,r,o){let c=r.length,p=hi(o,c);y.uniform1iv(this.addr,p);for(let v=0;v!==c;++v)o.safeSetTexture2D(r[v]||xm,p[v])}function Pd(y,r,o){let c=r.length,p=hi(o,c);y.uniform1iv(this.addr,p);for(let v=0;v!==c;++v)o.setTexture3D(r[v]||xc,p[v])}function k0(y,r,o){let c=r.length,p=hi(o,c);y.uniform1iv(this.addr,p);for(let v=0;v!==c;++v)o.safeSetTextureCube(r[v]||Lu,p[v])}function ao(y,r,o){let c=r.length,p=hi(o,c);y.uniform1iv(this.addr,p);for(let v=0;v!==c;++v)o.setTexture2DArray(r[v]||Ih,p[v])}function qa(y){switch(y){case 5126:return M0;case 35664:return Qv;case 35665:return Zv;case 35666:return Qp;case 35674:return Em;case 35675:return Sm;case 35676:return Jv;case 5124:case 35670:return _0;case 35667:case 35671:return Fd;case 35668:case 35672:return M1;case 35669:case 35673:return C0;case 5125:return so;case 36294:return Ia;case 36295:return I0;case 36296:return eb;case 35678:case 36198:case 36298:case 36306:case 35682:return tb;case 35679:case 36299:case 36307:return Pd;case 35680:case 36300:case 36308:case 36293:return k0;case 36289:case 36303:case 36311:case 36292:return ao}}function R0(y,r,o){this.id=y,this.addr=o,this.cache=[],this.setValue=Am(r.type)}function oo(y,r,o){this.id=y,this.addr=o,this.cache=[],this.size=r.size,this.setValue=qa(r.type)}oo.prototype.updateCache=function(y){let r=this.cache;y instanceof Float32Array&&r.length!==y.length&&(this.cache=new Float32Array(y.length)),ds(r,y)};function Tm(y){this.id=y,this.seq=[],this.map={}}Tm.prototype.setValue=function(y,r,o){let c=this.seq;for(let p=0,v=c.length;p!==v;++p){let w=c[p];w.setValue(y,r[w.id],o)}};let Ac=/(\w+)(\])?(\[|\.)?/g;function Ec(y,r){y.seq.push(r),y.map[r.id]=r}function Ka(y,r,o){let c=y.name,p=c.length;for(Ac.lastIndex=0;;){let v=Ac.exec(c),w=Ac.lastIndex,S=v[1],O=v[2]==="]",U=v[3];if(O&&(S=S|0),U===void 0||U==="["&&w+2===p){Ec(o,U===void 0?new R0(S,y,r):new oo(S,y,r));break}else{let Y=o.map[S];Y===void 0&&(Y=new Tm(S),Ec(o,Y)),o=Y}}}function Ya(y,r){this.seq=[],this.map={};let o=y.getProgramParameter(r,y.ACTIVE_UNIFORMS);for(let c=0;c<o;++c){let p=y.getActiveUniform(r,c),v=y.getUniformLocation(r,p.name);Ka(p,v,this)}}Ya.prototype.setValue=function(y,r,o,c){let p=this.map[r];p!==void 0&&p.setValue(y,o,c)},Ya.prototype.setOptional=function(y,r,o){let c=r[o];c!==void 0&&this.setValue(y,o,c)},Ya.upload=function(y,r,o,c){for(let p=0,v=r.length;p!==v;++p){let w=r[p],S=o[w.id];S.needsUpdate!==!1&&w.setValue(y,S.value,c)}},Ya.seqWithValue=function(y,r){let o=[];for(let c=0,p=y.length;c!==p;++c){let v=y[c];v.id in r&&o.push(v)}return o};function Zp(y,r,o){let c=y.createShader(r);return y.shaderSource(c,o),y.compileShader(c),c}let nb=0;function rb(y){let r=y.split(`
`);for(let o=0;o<r.length;o++)r[o]=o+1+": "+r[o];return r.join(`
`)}function N0(y){switch(y){case Ei:return["Linear","( value )"];case Qr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",y),["Linear","( value )"]}}function Od(y,r,o){let c=y.getShaderParameter(r,y.COMPILE_STATUS),p=y.getShaderInfoLog(r).trim();return c&&p===""?"":o.toUpperCase()+`

`+p+`

`+rb(y.getShaderSource(r))}function Mm(y,r){let o=N0(r);return"vec4 "+y+"( vec4 value ) { return LinearTo"+o[0]+o[1]+"; }"}function Sc(y,r){let o;switch(r){case Me:o="Linear";break;case Ee:o="Reinhard";break;case ke:o="OptimizedCineon";break;case ee:o="ACESFilmic";break;case ie:o="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),o="Linear"}return"vec3 "+y+"( vec3 color ) { return "+o+"ToneMapping( color ); }"}function ib(y){return[y.extensionDerivatives||y.envMapCubeUV||y.bumpMap||y.tangentSpaceNormalMap||y.clearcoatNormalMap||y.flatShading||y.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(y.extensionFragDepth||y.logarithmicDepthBuffer)&&y.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",y.extensionDrawBuffers&&y.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(y.extensionShaderTextureLOD||y.envMap||y.transmission)&&y.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fu).join(`
`)}function L0(y){let r=[];for(let o in y){let c=y[o];c!==!1&&r.push("#define "+o+" "+c)}return r.join(`
`)}function lo(y,r){let o={},c=y.getProgramParameter(r,y.ACTIVE_ATTRIBUTES);for(let p=0;p<c;p++){let v=y.getActiveAttrib(r,p),w=v.name,S=1;v.type===y.FLOAT_MAT2&&(S=2),v.type===y.FLOAT_MAT3&&(S=3),v.type===y.FLOAT_MAT4&&(S=4),o[w]={type:v.type,location:y.getAttribLocation(r,w),locationSize:S}}return o}function Fu(y){return y!==""}function ps(y,r){return y.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function Tc(y,r){return y.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}let sb=/^[ \t]*#include +<([\w\d./]+)>/gm;function uo(y){return y.replace(sb,Yn)}function Yn(y,r){let o=yn[r];if(o===void 0)throw new Error("Can not resolve #include <"+r+">");return uo(o)}let _m=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,D0=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function F0(y){return y.replace(D0,Ls).replace(_m,fa)}function fa(y,r,o,c){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ls(y,r,o,c)}function Ls(y,r,o,c){let p="";for(let v=parseInt(r);v<parseInt(o);v++)p+=c.replace(/\[\s*i\s*\]/g,"[ "+v+" ]").replace(/UNROLLED_LOOP_INDEX/g,v);return p}function ma(y){let r="precision "+y.precision+` float;
precision `+y.precision+" int;";return y.precision==="highp"?r+=`
#define HIGH_PRECISION`:y.precision==="mediump"?r+=`
#define MEDIUM_PRECISION`:y.precision==="lowp"&&(r+=`
#define LOW_PRECISION`),r}function Ws(y){let r="SHADOWMAP_TYPE_BASIC";return y.shadowMapType===T?r="SHADOWMAP_TYPE_PCF":y.shadowMapType===A?r="SHADOWMAP_TYPE_PCF_SOFT":y.shadowMapType===_&&(r="SHADOWMAP_TYPE_VSM"),r}function Bd(y){let r="ENVMAP_TYPE_CUBE";if(y.envMap)switch(y.envMapMode){case te:case me:r="ENVMAP_TYPE_CUBE";break;case rt:case Wt:r="ENVMAP_TYPE_CUBE_UV";break}return r}function Zs(y){let r="ENVMAP_MODE_REFLECTION";if(y.envMap)switch(y.envMapMode){case me:case Wt:r="ENVMAP_MODE_REFRACTION";break}return r}function P0(y){let r="ENVMAP_BLENDING_NONE";if(y.envMap)switch(y.combine){case ss:r="ENVMAP_BLENDING_MULTIPLY";break;case tn:r="ENVMAP_BLENDING_MIX";break;case ye:r="ENVMAP_BLENDING_ADD";break}return r}function Yo(y,r,o,c){let p=y.getContext(),v=o.defines,w=o.vertexShader,S=o.fragmentShader,O=Ws(o),U=Bd(o),K=Zs(o),Y=P0(o),Z=o.isWebGL2?"":ib(o),ne=L0(v),ce=p.createProgram(),ve,Fe,fe=o.glslVersion?"#version "+o.glslVersion+`
`:"";o.isRawShaderMaterial?(ve=[ne].filter(Fu).join(`
`),ve.length>0&&(ve+=`
`),Fe=[Z,ne].filter(Fu).join(`
`),Fe.length>0&&(Fe+=`
`)):(ve=[ma(o),"#define SHADER_NAME "+o.shaderName,ne,o.instancing?"#define USE_INSTANCING":"",o.instancingColor?"#define USE_INSTANCING_COLOR":"",o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+K:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",o.specularColorMap?"#define USE_SPECULARCOLORMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.transmission?"#define USE_TRANSMISSION":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.thicknessMap?"#define USE_THICKNESSMAP":"",o.sheenColorMap?"#define USE_SHEENCOLORMAP":"",o.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexAlphas?"#define USE_COLOR_ALPHA":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&o.flatShading===!1?"#define USE_MORPHNORMALS":"",o.morphTargets&&o.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",o.morphTargets&&o.isWebGL2?"#define MORPHTARGETS_COUNT "+o.morphTargetsCount:"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+O:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&o.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Fu).join(`
`),Fe=[Z,ma(o),"#define SHADER_NAME "+o.shaderName,ne,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+U:"",o.envMap?"#define "+K:"",o.envMap?"#define "+Y:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoat?"#define USE_CLEARCOAT":"",o.clearcoatMap?"#define USE_CLEARCOATMAP":"",o.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",o.specularColorMap?"#define USE_SPECULARCOLORMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.alphaTest?"#define USE_ALPHATEST":"",o.sheen?"#define USE_SHEEN":"",o.sheenColorMap?"#define USE_SHEENCOLORMAP":"",o.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",o.transmission?"#define USE_TRANSMISSION":"",o.transmissionMap?"#define USE_TRANSMISSIONMAP":"",o.thicknessMap?"#define USE_THICKNESSMAP":"",o.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors||o.instancingColor?"#define USE_COLOR":"",o.vertexAlphas?"#define USE_COLOR_ALPHA":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+O:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&o.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(o.extensionShaderTextureLOD||o.envMap)&&o.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",o.toneMapping!==J?"#define TONE_MAPPING":"",o.toneMapping!==J?yn.tonemapping_pars_fragment:"",o.toneMapping!==J?Sc("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.alphaWrite?"":"#define OPAQUE",yn.encodings_pars_fragment,Mm("linearToOutputTexel",o.outputEncoding),o.depthPacking?"#define DEPTH_PACKING "+o.depthPacking:"",`
`].filter(Fu).join(`
`)),w=uo(w),w=ps(w,o),w=Tc(w,o),S=uo(S),S=ps(S,o),S=Tc(S,o),w=F0(w),S=F0(S),o.isWebGL2&&o.isRawShaderMaterial!==!0&&(fe=`#version 300 es
`,ve=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ve,Fe=["#define varying in",o.glslVersion===od?"":"layout(location = 0) out highp vec4 pc_fragColor;",o.glslVersion===od?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Fe);let oe=fe+ve+w,Pe=fe+Fe+S,Re=Zp(p,p.VERTEX_SHADER,oe),We=Zp(p,p.FRAGMENT_SHADER,Pe);if(p.attachShader(ce,Re),p.attachShader(ce,We),o.index0AttributeName!==void 0?p.bindAttribLocation(ce,0,o.index0AttributeName):o.morphTargets===!0&&p.bindAttribLocation(ce,0,"position"),p.linkProgram(ce),y.debug.checkShaderErrors){let wt=p.getProgramInfoLog(ce).trim(),Dt=p.getShaderInfoLog(Re).trim(),Ft=p.getShaderInfoLog(We).trim(),De=!0,nt=!0;if(p.getProgramParameter(ce,p.LINK_STATUS)===!1){De=!1;let _t=Od(p,Re,"vertex"),Rt=Od(p,We,"fragment");console.error("THREE.WebGLProgram: Shader Error "+p.getError()+" - VALIDATE_STATUS "+p.getProgramParameter(ce,p.VALIDATE_STATUS)+`

Program Info Log: `+wt+`
`+_t+`
`+Rt)}else wt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",wt):(Dt===""||Ft==="")&&(nt=!1);nt&&(this.diagnostics={runnable:De,programLog:wt,vertexShader:{log:Dt,prefix:ve},fragmentShader:{log:Ft,prefix:Fe}})}p.deleteShader(Re),p.deleteShader(We);let Je;this.getUniforms=function(){return Je===void 0&&(Je=new Ya(p,ce)),Je};let dt;return this.getAttributes=function(){return dt===void 0&&(dt=lo(p,ce)),dt},this.destroy=function(){c.releaseStatesOfProgram(this),p.deleteProgram(ce),this.program=void 0},this.name=o.shaderName,this.id=nb++,this.cacheKey=r,this.usedTimes=1,this.program=ce,this.vertexShader=Re,this.fragmentShader=We,this}let Jp=0;class Cm{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(r){let o=r.vertexShader,c=r.fragmentShader,p=this._getShaderStage(o),v=this._getShaderStage(c),w=this._getShaderCacheForMaterial(r);return w.has(p)===!1&&(w.add(p),p.usedTimes++),w.has(v)===!1&&(w.add(v),v.usedTimes++),this}remove(r){let o=this.materialCache.get(r);for(let c of o)c.usedTimes--,c.usedTimes===0&&this.shaderCache.delete(c);return this.materialCache.delete(r),this}getVertexShaderID(r){return this._getShaderStage(r.vertexShader).id}getFragmentShaderID(r){return this._getShaderStage(r.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(r){let o=this.materialCache;return o.has(r)===!1&&o.set(r,new Set),o.get(r)}_getShaderStage(r){let o=this.shaderCache;if(o.has(r)===!1){let c=new ab;o.set(r,c)}return o.get(r)}}class ab{constructor(){this.id=Jp++,this.usedTimes=0}}function ef(y,r,o,c,p,v,w){let S=new ph,O=new Cm,U=[],K=p.isWebGL2,Y=p.logarithmicDepthBuffer,Z=p.floatVertexTextures,ne=p.maxVertexUniforms,ce=p.vertexTextures,ve=p.precision,Fe={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function fe(De){let _t=De.skeleton.bones;if(Z)return 1024;{let Tt=Math.floor((ne-20)/4),Ct=Math.min(Tt,_t.length);return Ct<_t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+_t.length+" bones. This GPU supports "+Ct+"."),0):Ct}}function oe(De,nt,_t,Rt,Tt){let Ct=Rt.fog,Zt=De.isMeshStandardMaterial?Rt.environment:null,pn=(De.isMeshStandardMaterial?o:r).get(De.envMap||Zt),er=Fe[De.type],ur=Tt.isSkinnedMesh?fe(Tt):0;De.precision!==null&&(ve=p.getMaxPrecision(De.precision),ve!==De.precision&&console.warn("THREE.WebGLProgram.getParameters:",De.precision,"not supported, using",ve,"instead."));let $n,Jt,kn,wr;if(er){let Hn=rs[er];$n=Hn.vertexShader,Jt=Hn.fragmentShader}else $n=De.vertexShader,Jt=De.fragmentShader,O.update(De),kn=O.getVertexShaderID(De),wr=O.getFragmentShaderID(De);let yt=y.getRenderTarget(),Lr=De.alphaTest>0,jn=De.clearcoat>0;return{isWebGL2:K,shaderID:er,shaderName:De.type,vertexShader:$n,fragmentShader:Jt,defines:De.defines,customVertexShaderID:kn,customFragmentShaderID:wr,isRawShaderMaterial:De.isRawShaderMaterial===!0,glslVersion:De.glslVersion,precision:ve,instancing:Tt.isInstancedMesh===!0,instancingColor:Tt.isInstancedMesh===!0&&Tt.instanceColor!==null,supportsVertexTextures:ce,outputEncoding:yt===null?y.outputEncoding:yt.isXRRenderTarget===!0?yt.texture.encoding:Ei,map:!!De.map,matcap:!!De.matcap,envMap:!!pn,envMapMode:pn&&pn.mapping,envMapCubeUV:!!pn&&(pn.mapping===rt||pn.mapping===Wt),lightMap:!!De.lightMap,aoMap:!!De.aoMap,emissiveMap:!!De.emissiveMap,bumpMap:!!De.bumpMap,normalMap:!!De.normalMap,objectSpaceNormalMap:De.normalMapType===ua,tangentSpaceNormalMap:De.normalMapType===bs,decodeVideoTexture:!!De.map&&De.map.isVideoTexture===!0&&De.map.encoding===Qr,clearcoat:jn,clearcoatMap:jn&&!!De.clearcoatMap,clearcoatRoughnessMap:jn&&!!De.clearcoatRoughnessMap,clearcoatNormalMap:jn&&!!De.clearcoatNormalMap,displacementMap:!!De.displacementMap,roughnessMap:!!De.roughnessMap,metalnessMap:!!De.metalnessMap,specularMap:!!De.specularMap,specularIntensityMap:!!De.specularIntensityMap,specularColorMap:!!De.specularColorMap,alphaMap:!!De.alphaMap,alphaTest:Lr,alphaWrite:De.alphaWrite||De.transparent,gradientMap:!!De.gradientMap,sheen:De.sheen>0,sheenColorMap:!!De.sheenColorMap,sheenRoughnessMap:!!De.sheenRoughnessMap,transmission:De.transmission>0,transmissionMap:!!De.transmissionMap,thicknessMap:!!De.thicknessMap,combine:De.combine,vertexTangents:!!De.normalMap&&!!Tt.geometry&&!!Tt.geometry.attributes.tangent,vertexColors:De.vertexColors,vertexAlphas:De.vertexColors===!0&&!!Tt.geometry&&!!Tt.geometry.attributes.color&&Tt.geometry.attributes.color.itemSize===4,vertexUvs:!!De.map||!!De.bumpMap||!!De.normalMap||!!De.specularMap||!!De.alphaMap||!!De.emissiveMap||!!De.roughnessMap||!!De.metalnessMap||!!De.clearcoatMap||!!De.clearcoatRoughnessMap||!!De.clearcoatNormalMap||!!De.displacementMap||!!De.transmissionMap||!!De.thicknessMap||!!De.specularIntensityMap||!!De.specularColorMap||!!De.sheenColorMap||!!De.sheenRoughnessMap,uvsVertexOnly:!(!!De.map||!!De.bumpMap||!!De.normalMap||!!De.specularMap||!!De.alphaMap||!!De.emissiveMap||!!De.roughnessMap||!!De.metalnessMap||!!De.clearcoatNormalMap||De.transmission>0||!!De.transmissionMap||!!De.thicknessMap||!!De.specularIntensityMap||!!De.specularColorMap||De.sheen>0||!!De.sheenColorMap||!!De.sheenRoughnessMap)&&!!De.displacementMap,fog:!!Ct,useFog:De.fog,fogExp2:Ct&&Ct.isFogExp2,flatShading:!!De.flatShading,sizeAttenuation:De.sizeAttenuation,logarithmicDepthBuffer:Y,skinning:Tt.isSkinnedMesh===!0&&ur>0,maxBones:ur,useVertexTexture:Z,morphTargets:!!Tt.geometry&&!!Tt.geometry.morphAttributes.position,morphNormals:!!Tt.geometry&&!!Tt.geometry.morphAttributes.normal,morphTargetsCount:!!Tt.geometry&&!!Tt.geometry.morphAttributes.position?Tt.geometry.morphAttributes.position.length:0,numDirLights:nt.directional.length,numPointLights:nt.point.length,numSpotLights:nt.spot.length,numRectAreaLights:nt.rectArea.length,numHemiLights:nt.hemi.length,numDirLightShadows:nt.directionalShadowMap.length,numPointLightShadows:nt.pointShadowMap.length,numSpotLightShadows:nt.spotShadowMap.length,numClippingPlanes:w.numPlanes,numClipIntersection:w.numIntersection,dithering:De.dithering,shadowMapEnabled:y.shadowMap.enabled&&_t.length>0,shadowMapType:y.shadowMap.type,toneMapping:De.toneMapped?y.toneMapping:J,physicallyCorrectLights:y.physicallyCorrectLights,premultipliedAlpha:De.premultipliedAlpha,doubleSided:De.side===$,flipSided:De.side===B,depthPacking:De.depthPacking!==void 0?De.depthPacking:!1,index0AttributeName:De.index0AttributeName,extensionDerivatives:De.extensions&&De.extensions.derivatives,extensionFragDepth:De.extensions&&De.extensions.fragDepth,extensionDrawBuffers:De.extensions&&De.extensions.drawBuffers,extensionShaderTextureLOD:De.extensions&&De.extensions.shaderTextureLOD,rendererExtensionFragDepth:K||c.has("EXT_frag_depth"),rendererExtensionDrawBuffers:K||c.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:K||c.has("EXT_shader_texture_lod"),customProgramCacheKey:De.customProgramCacheKey()}}function Pe(De){let nt=[];if(De.shaderID?nt.push(De.shaderID):(nt.push(De.customVertexShaderID),nt.push(De.customFragmentShaderID)),De.defines!==void 0)for(let _t in De.defines)nt.push(_t),nt.push(De.defines[_t]);return De.isRawShaderMaterial===!1&&(Re(nt,De),We(nt,De),nt.push(y.outputEncoding)),nt.push(De.customProgramCacheKey),nt.join()}function Re(De,nt){De.push(nt.precision),De.push(nt.outputEncoding),De.push(nt.envMapMode),De.push(nt.combine),De.push(nt.vertexUvs),De.push(nt.fogExp2),De.push(nt.sizeAttenuation),De.push(nt.maxBones),De.push(nt.morphTargetsCount),De.push(nt.numDirLights),De.push(nt.numPointLights),De.push(nt.numSpotLights),De.push(nt.numHemiLights),De.push(nt.numRectAreaLights),De.push(nt.numDirLightShadows),De.push(nt.numPointLightShadows),De.push(nt.numSpotLightShadows),De.push(nt.shadowMapType),De.push(nt.toneMapping),De.push(nt.numClippingPlanes),De.push(nt.numClipIntersection),De.push(nt.alphaWrite)}function We(De,nt){S.disableAll(),nt.isWebGL2&&S.enable(0),nt.supportsVertexTextures&&S.enable(1),nt.instancing&&S.enable(2),nt.instancingColor&&S.enable(3),nt.map&&S.enable(4),nt.matcap&&S.enable(5),nt.envMap&&S.enable(6),nt.envMapCubeUV&&S.enable(7),nt.lightMap&&S.enable(8),nt.aoMap&&S.enable(9),nt.emissiveMap&&S.enable(10),nt.bumpMap&&S.enable(11),nt.normalMap&&S.enable(12),nt.objectSpaceNormalMap&&S.enable(13),nt.tangentSpaceNormalMap&&S.enable(14),nt.clearcoat&&S.enable(15),nt.clearcoatMap&&S.enable(16),nt.clearcoatRoughnessMap&&S.enable(17),nt.clearcoatNormalMap&&S.enable(18),nt.displacementMap&&S.enable(19),nt.specularMap&&S.enable(20),nt.roughnessMap&&S.enable(21),nt.metalnessMap&&S.enable(22),nt.gradientMap&&S.enable(23),nt.alphaMap&&S.enable(24),nt.alphaTest&&S.enable(25),nt.vertexColors&&S.enable(26),nt.vertexAlphas&&S.enable(27),nt.vertexUvs&&S.enable(28),nt.vertexTangents&&S.enable(29),nt.uvsVertexOnly&&S.enable(30),nt.fog&&S.enable(31),De.push(S.mask),S.disableAll(),nt.useFog&&S.enable(0),nt.flatShading&&S.enable(1),nt.logarithmicDepthBuffer&&S.enable(2),nt.skinning&&S.enable(3),nt.useVertexTexture&&S.enable(4),nt.morphTargets&&S.enable(5),nt.morphNormals&&S.enable(6),nt.premultipliedAlpha&&S.enable(7),nt.shadowMapEnabled&&S.enable(8),nt.physicallyCorrectLights&&S.enable(9),nt.doubleSided&&S.enable(10),nt.flipSided&&S.enable(11),nt.depthPacking&&S.enable(12),nt.dithering&&S.enable(13),nt.specularIntensityMap&&S.enable(14),nt.specularColorMap&&S.enable(15),nt.transmission&&S.enable(16),nt.transmissionMap&&S.enable(17),nt.thicknessMap&&S.enable(18),nt.sheen&&S.enable(19),nt.sheenColorMap&&S.enable(20),nt.sheenRoughnessMap&&S.enable(21),nt.decodeVideoTexture&&S.enable(22),De.push(S.mask)}function Je(De){let nt=Fe[De.type],_t;if(nt){let Rt=rs[nt];_t=uv.clone(Rt.uniforms)}else _t=De.uniforms;return _t}function dt(De,nt){let _t;for(let Rt=0,Tt=U.length;Rt<Tt;Rt++){let Ct=U[Rt];if(Ct.cacheKey===nt){_t=Ct,++_t.usedTimes;break}}return _t===void 0&&(_t=new Yo(y,nt,De,v),U.push(_t)),_t}function wt(De){if(--De.usedTimes===0){let nt=U.indexOf(De);U[nt]=U[U.length-1],U.pop(),De.destroy()}}function Dt(De){O.remove(De)}function Ft(){O.dispose()}return{getParameters:oe,getProgramCacheKey:Pe,getUniforms:Je,acquireProgram:dt,releaseProgram:wt,releaseShaderCache:Dt,programs:U,dispose:Ft}}function O0(){let y=new WeakMap;function r(v){let w=y.get(v);return w===void 0&&(w={},y.set(v,w)),w}function o(v){y.delete(v)}function c(v,w,S){y.get(v)[w]=S}function p(){y=new WeakMap}return{get:r,remove:o,update:c,dispose:p}}function ob(y,r){return y.groupOrder!==r.groupOrder?y.groupOrder-r.groupOrder:y.renderOrder!==r.renderOrder?y.renderOrder-r.renderOrder:y.material.id!==r.material.id?y.material.id-r.material.id:y.z!==r.z?y.z-r.z:y.id-r.id}function ws(y,r){return y.groupOrder!==r.groupOrder?y.groupOrder-r.groupOrder:y.renderOrder!==r.renderOrder?y.renderOrder-r.renderOrder:y.z!==r.z?r.z-y.z:y.id-r.id}function js(){let y=[],r=0,o=[],c=[],p=[];function v(){r=0,o.length=0,c.length=0,p.length=0}function w(Y,Z,ne,ce,ve,Fe){let fe=y[r];return fe===void 0?(fe={id:Y.id,object:Y,geometry:Z,material:ne,groupOrder:ce,renderOrder:Y.renderOrder,z:ve,group:Fe},y[r]=fe):(fe.id=Y.id,fe.object=Y,fe.geometry=Z,fe.material=ne,fe.groupOrder=ce,fe.renderOrder=Y.renderOrder,fe.z=ve,fe.group=Fe),r++,fe}function S(Y,Z,ne,ce,ve,Fe){let fe=w(Y,Z,ne,ce,ve,Fe);ne.transmission>0?c.push(fe):ne.transparent===!0?p.push(fe):o.push(fe)}function O(Y,Z,ne,ce,ve,Fe){let fe=w(Y,Z,ne,ce,ve,Fe);ne.transmission>0?c.unshift(fe):ne.transparent===!0?p.unshift(fe):o.unshift(fe)}function U(Y,Z){o.length>1&&o.sort(Y||ob),c.length>1&&c.sort(Z||ws),p.length>1&&p.sort(Z||ws)}function K(){for(let Y=r,Z=y.length;Y<Z;Y++){let ne=y[Y];if(ne.id===null)break;ne.id=null,ne.object=null,ne.geometry=null,ne.material=null,ne.group=null}}return{opaque:o,transmissive:c,transparent:p,init:v,push:S,unshift:O,finish:K,sort:U}}function co(){let y=new WeakMap;function r(c,p){let v;return y.has(c)===!1?(v=new js,y.set(c,[v])):p>=y.get(c).length?(v=new js,y.get(c).push(v)):v=y.get(c)[p],v}function o(){y=new WeakMap}return{get:r,dispose:o}}function _1(){let y={};return{get:function(r){if(y[r.id]!==void 0)return y[r.id];let o;switch(r.type){case"DirectionalLight":o={direction:new je,color:new Fn};break;case"SpotLight":o={position:new je,direction:new je,color:new Fn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":o={position:new je,color:new Fn,distance:0,decay:0};break;case"HemisphereLight":o={direction:new je,skyColor:new Fn,groundColor:new Fn};break;case"RectAreaLight":o={color:new Fn,position:new je,halfWidth:new je,halfHeight:new je};break}return y[r.id]=o,o}}}function tf(){let y={};return{get:function(r){if(y[r.id]!==void 0)return y[r.id];let o;switch(r.type){case"DirectionalLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new un};break;case"SpotLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new un};break;case"PointLight":o={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new un,shadowCameraNear:1,shadowCameraFar:1e3};break}return y[r.id]=o,o}}}let Ud=0;function B0(y,r){return(r.castShadow?1:0)-(y.castShadow?1:0)}function U0(y,r){let o=new _1,c=tf(),p={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let K=0;K<9;K++)p.probe.push(new je);let v=new je,w=new Wn,S=new Wn;function O(K,Y){let Z=0,ne=0,ce=0;for(let Dt=0;Dt<9;Dt++)p.probe[Dt].set(0,0,0);let ve=0,Fe=0,fe=0,oe=0,Pe=0,Re=0,We=0,Je=0;K.sort(B0);let dt=Y!==!0?Math.PI:1;for(let Dt=0,Ft=K.length;Dt<Ft;Dt++){let De=K[Dt],nt=De.color,_t=De.intensity,Rt=De.distance,Tt=De.shadow&&De.shadow.map?De.shadow.map.texture:null;if(De.isAmbientLight)Z+=nt.r*_t*dt,ne+=nt.g*_t*dt,ce+=nt.b*_t*dt;else if(De.isLightProbe)for(let Ct=0;Ct<9;Ct++)p.probe[Ct].addScaledVector(De.sh.coefficients[Ct],_t);else if(De.isDirectionalLight){let Ct=o.get(De);if(Ct.color.copy(De.color).multiplyScalar(De.intensity*dt),De.castShadow){let Zt=De.shadow,pn=c.get(De);pn.shadowBias=Zt.bias,pn.shadowNormalBias=Zt.normalBias,pn.shadowRadius=Zt.radius,pn.shadowMapSize=Zt.mapSize,p.directionalShadow[ve]=pn,p.directionalShadowMap[ve]=Tt,p.directionalShadowMatrix[ve]=De.shadow.matrix,Re++}p.directional[ve]=Ct,ve++}else if(De.isSpotLight){let Ct=o.get(De);if(Ct.position.setFromMatrixPosition(De.matrixWorld),Ct.color.copy(nt).multiplyScalar(_t*dt),Ct.distance=Rt,Ct.coneCos=Math.cos(De.angle),Ct.penumbraCos=Math.cos(De.angle*(1-De.penumbra)),Ct.decay=De.decay,De.castShadow){let Zt=De.shadow,pn=c.get(De);pn.shadowBias=Zt.bias,pn.shadowNormalBias=Zt.normalBias,pn.shadowRadius=Zt.radius,pn.shadowMapSize=Zt.mapSize,p.spotShadow[fe]=pn,p.spotShadowMap[fe]=Tt,p.spotShadowMatrix[fe]=De.shadow.matrix,Je++}p.spot[fe]=Ct,fe++}else if(De.isRectAreaLight){let Ct=o.get(De);Ct.color.copy(nt).multiplyScalar(_t),Ct.halfWidth.set(De.width*.5,0,0),Ct.halfHeight.set(0,De.height*.5,0),p.rectArea[oe]=Ct,oe++}else if(De.isPointLight){let Ct=o.get(De);if(Ct.color.copy(De.color).multiplyScalar(De.intensity*dt),Ct.distance=De.distance,Ct.decay=De.decay,De.castShadow){let Zt=De.shadow,pn=c.get(De);pn.shadowBias=Zt.bias,pn.shadowNormalBias=Zt.normalBias,pn.shadowRadius=Zt.radius,pn.shadowMapSize=Zt.mapSize,pn.shadowCameraNear=Zt.camera.near,pn.shadowCameraFar=Zt.camera.far,p.pointShadow[Fe]=pn,p.pointShadowMap[Fe]=Tt,p.pointShadowMatrix[Fe]=De.shadow.matrix,We++}p.point[Fe]=Ct,Fe++}else if(De.isHemisphereLight){let Ct=o.get(De);Ct.skyColor.copy(De.color).multiplyScalar(_t*dt),Ct.groundColor.copy(De.groundColor).multiplyScalar(_t*dt),p.hemi[Pe]=Ct,Pe++}}oe>0&&(r.isWebGL2||y.has("OES_texture_float_linear")===!0?(p.rectAreaLTC1=qe.LTC_FLOAT_1,p.rectAreaLTC2=qe.LTC_FLOAT_2):y.has("OES_texture_half_float_linear")===!0?(p.rectAreaLTC1=qe.LTC_HALF_1,p.rectAreaLTC2=qe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),p.ambient[0]=Z,p.ambient[1]=ne,p.ambient[2]=ce;let wt=p.hash;(wt.directionalLength!==ve||wt.pointLength!==Fe||wt.spotLength!==fe||wt.rectAreaLength!==oe||wt.hemiLength!==Pe||wt.numDirectionalShadows!==Re||wt.numPointShadows!==We||wt.numSpotShadows!==Je)&&(p.directional.length=ve,p.spot.length=fe,p.rectArea.length=oe,p.point.length=Fe,p.hemi.length=Pe,p.directionalShadow.length=Re,p.directionalShadowMap.length=Re,p.pointShadow.length=We,p.pointShadowMap.length=We,p.spotShadow.length=Je,p.spotShadowMap.length=Je,p.directionalShadowMatrix.length=Re,p.pointShadowMatrix.length=We,p.spotShadowMatrix.length=Je,wt.directionalLength=ve,wt.pointLength=Fe,wt.spotLength=fe,wt.rectAreaLength=oe,wt.hemiLength=Pe,wt.numDirectionalShadows=Re,wt.numPointShadows=We,wt.numSpotShadows=Je,p.version=Ud++)}function U(K,Y){let Z=0,ne=0,ce=0,ve=0,Fe=0,fe=Y.matrixWorldInverse;for(let oe=0,Pe=K.length;oe<Pe;oe++){let Re=K[oe];if(Re.isDirectionalLight){let We=p.directional[Z];We.direction.setFromMatrixPosition(Re.matrixWorld),v.setFromMatrixPosition(Re.target.matrixWorld),We.direction.sub(v),We.direction.transformDirection(fe),Z++}else if(Re.isSpotLight){let We=p.spot[ce];We.position.setFromMatrixPosition(Re.matrixWorld),We.position.applyMatrix4(fe),We.direction.setFromMatrixPosition(Re.matrixWorld),v.setFromMatrixPosition(Re.target.matrixWorld),We.direction.sub(v),We.direction.transformDirection(fe),ce++}else if(Re.isRectAreaLight){let We=p.rectArea[ve];We.position.setFromMatrixPosition(Re.matrixWorld),We.position.applyMatrix4(fe),S.identity(),w.copy(Re.matrixWorld),w.premultiply(fe),S.extractRotation(w),We.halfWidth.set(Re.width*.5,0,0),We.halfHeight.set(0,Re.height*.5,0),We.halfWidth.applyMatrix4(S),We.halfHeight.applyMatrix4(S),ve++}else if(Re.isPointLight){let We=p.point[ne];We.position.setFromMatrixPosition(Re.matrixWorld),We.position.applyMatrix4(fe),ne++}else if(Re.isHemisphereLight){let We=p.hemi[Fe];We.direction.setFromMatrixPosition(Re.matrixWorld),We.direction.transformDirection(fe),We.direction.normalize(),Fe++}}}return{setup:O,setupView:U,state:p}}function nf(y,r){let o=new U0(y,r),c=[],p=[];function v(){c.length=0,p.length=0}function w(Y){c.push(Y)}function S(Y){p.push(Y)}function O(Y){o.setup(c,Y)}function U(Y){o.setupView(c,Y)}return{init:v,state:{lightsArray:c,shadowsArray:p,lights:o},setupLights:O,setupLightsView:U,pushLight:w,pushShadow:S}}function C1(y,r){let o=new WeakMap;function c(v,w=0){let S;return o.has(v)===!1?(S=new nf(y,r),o.set(v,[S])):w>=o.get(v).length?(S=new nf(y,r),o.get(v).push(S)):S=o.get(v)[w],S}function p(){o=new WeakMap}return{get:c,dispose:p}}class rf extends ca{constructor(r){super(),this.type="MeshDepthMaterial",this.depthPacking=oa,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(r)}copy(r){return super.copy(r),this.depthPacking=r.depthPacking,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this}}rf.prototype.isMeshDepthMaterial=!0;class ru extends ca{constructor(r){super(),this.type="MeshDistanceMaterial",this.referencePosition=new je,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(r)}copy(r){return super.copy(r),this.referencePosition.copy(r.referencePosition),this.nearDistance=r.nearDistance,this.farDistance=r.farDistance,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this}}ru.prototype.isMeshDistanceMaterial=!0;let ho=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,I1=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function iu(y,r,o){let c=new Vp,p=new un,v=new un,w=new Si,S=new rf({depthPacking:la}),O=new ru,U={},K=o.maxTextureSize,Y={0:B,1:D,2:$},Z=new da({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new un},radius:{value:4}},vertexShader:ho,fragmentShader:I1}),ne=Z.clone();ne.defines.HORIZONTAL_PASS=1;let ce=new Or;ce.setAttribute("position",new Ri(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let ve=new Ks(ce,Z),Fe=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=T,this.render=function(Re,We,Je){if(Fe.enabled===!1||Fe.autoUpdate===!1&&Fe.needsUpdate===!1||Re.length===0)return;let dt=y.getRenderTarget(),wt=y.getActiveCubeFace(),Dt=y.getActiveMipmapLevel(),Ft=y.state;Ft.setBlending(Q),Ft.buffers.color.setClear(1,1,1,1),Ft.buffers.depth.setTest(!0),Ft.setScissorTest(!1);for(let De=0,nt=Re.length;De<nt;De++){let _t=Re[De],Rt=_t.shadow;if(Rt===void 0){console.warn("THREE.WebGLShadowMap:",_t,"has no shadow.");continue}if(Rt.autoUpdate===!1&&Rt.needsUpdate===!1)continue;p.copy(Rt.mapSize);let Tt=Rt.getFrameExtents();if(p.multiply(Tt),v.copy(Rt.mapSize),(p.x>K||p.y>K)&&(p.x>K&&(v.x=Math.floor(K/Tt.x),p.x=v.x*Tt.x,Rt.mapSize.x=v.x),p.y>K&&(v.y=Math.floor(K/Tt.y),p.y=v.y*Tt.y,Rt.mapSize.y=v.y)),Rt.map===null&&!Rt.isPointLightShadow&&this.type===_){let Zt={minFilter:St,magFilter:St,format:li};Rt.map=new Ta(p.x,p.y,Zt),Rt.map.texture.name=_t.name+".shadowMap",Rt.mapPass=new Ta(p.x,p.y,Zt),Rt.camera.updateProjectionMatrix()}if(Rt.map===null){let Zt={minFilter:In,magFilter:In,format:li};Rt.map=new Ta(p.x,p.y,Zt),Rt.map.texture.name=_t.name+".shadowMap",Rt.camera.updateProjectionMatrix()}y.setRenderTarget(Rt.map),y.clear();let Ct=Rt.getViewportCount();for(let Zt=0;Zt<Ct;Zt++){let pn=Rt.getViewport(Zt);w.set(v.x*pn.x,v.y*pn.y,v.x*pn.z,v.y*pn.w),Ft.viewport(w),Rt.updateMatrices(_t,Zt),c=Rt.getFrustum(),Pe(We,Je,Rt.camera,_t,this.type)}!Rt.isPointLightShadow&&this.type===_&&fe(Rt,Je),Rt.needsUpdate=!1}Fe.needsUpdate=!1,y.setRenderTarget(dt,wt,Dt)};function fe(Re,We){let Je=r.update(ve);Z.defines.VSM_SAMPLES!==Re.blurSamples&&(Z.defines.VSM_SAMPLES=Re.blurSamples,ne.defines.VSM_SAMPLES=Re.blurSamples,Z.needsUpdate=!0,ne.needsUpdate=!0),Z.uniforms.shadow_pass.value=Re.map.texture,Z.uniforms.resolution.value=Re.mapSize,Z.uniforms.radius.value=Re.radius,y.setRenderTarget(Re.mapPass),y.clear(),y.renderBufferDirect(We,null,Je,Z,ve,null),ne.uniforms.shadow_pass.value=Re.mapPass.texture,ne.uniforms.resolution.value=Re.mapSize,ne.uniforms.radius.value=Re.radius,y.setRenderTarget(Re.map),y.clear(),y.renderBufferDirect(We,null,Je,ne,ve,null)}function oe(Re,We,Je,dt,wt,Dt,Ft){let De=null,nt=dt.isPointLight===!0?Re.customDistanceMaterial:Re.customDepthMaterial;if(nt!==void 0?De=nt:De=dt.isPointLight===!0?O:S,y.localClippingEnabled&&Je.clipShadows===!0&&Je.clippingPlanes.length!==0||Je.displacementMap&&Je.displacementScale!==0||Je.alphaMap&&Je.alphaTest>0){let _t=De.uuid,Rt=Je.uuid,Tt=U[_t];Tt===void 0&&(Tt={},U[_t]=Tt);let Ct=Tt[Rt];Ct===void 0&&(Ct=De.clone(),Tt[Rt]=Ct),De=Ct}return De.visible=Je.visible,De.wireframe=Je.wireframe,Ft===_?De.side=Je.shadowSide!==null?Je.shadowSide:Je.side:De.side=Je.shadowSide!==null?Je.shadowSide:Y[Je.side],De.alphaMap=Je.alphaMap,De.alphaTest=Je.alphaTest,De.clipShadows=Je.clipShadows,De.clippingPlanes=Je.clippingPlanes,De.clipIntersection=Je.clipIntersection,De.displacementMap=Je.displacementMap,De.displacementScale=Je.displacementScale,De.displacementBias=Je.displacementBias,De.wireframeLinewidth=Je.wireframeLinewidth,De.linewidth=Je.linewidth,dt.isPointLight===!0&&De.isMeshDistanceMaterial===!0&&(De.referencePosition.setFromMatrixPosition(dt.matrixWorld),De.nearDistance=wt,De.farDistance=Dt),De}function Pe(Re,We,Je,dt,wt){if(Re.visible===!1)return;if(Re.layers.test(We.layers)&&(Re.isMesh||Re.isLine||Re.isPoints)&&(Re.castShadow||Re.receiveShadow&&wt===_)&&(!Re.frustumCulled||c.intersectsObject(Re))){Re.modelViewMatrix.multiplyMatrices(Je.matrixWorldInverse,Re.matrixWorld);let De=r.update(Re),nt=Re.material;if(Array.isArray(nt)){let _t=De.groups;for(let Rt=0,Tt=_t.length;Rt<Tt;Rt++){let Ct=_t[Rt],Zt=nt[Ct.materialIndex];if(Zt&&Zt.visible){let pn=oe(Re,De,Zt,dt,Je.near,Je.far,wt);y.renderBufferDirect(Je,null,De,pn,Re,Ct)}}}else if(nt.visible){let _t=oe(Re,De,nt,dt,Je.near,Je.far,wt);y.renderBufferDirect(Je,null,De,_t,Re,null)}}let Ft=Re.children;for(let De=0,nt=Ft.length;De<nt;De++)Pe(Ft[De],We,Je,dt,wt)}}function k1(y,r,o){let c=o.isWebGL2;function p(){let vt=!1,fr=new Si,tr=null,br=new Si(0,0,0,0);return{setMask:function(cn){tr!==cn&&!vt&&(y.colorMask(cn,cn,cn,cn),tr=cn)},setLocked:function(cn){vt=cn},setClear:function(cn,Fr,Li,Is,mo){mo===!0&&(cn*=Is,Fr*=Is,Li*=Is),fr.set(cn,Fr,Li,Is),br.equals(fr)===!1&&(y.clearColor(cn,Fr,Li,Is),br.copy(fr))},reset:function(){vt=!1,tr=null,br.set(-1,0,0,0)}}}function v(){let vt=!1,fr=null,tr=null,br=null;return{setTest:function(cn){cn?yt(y.DEPTH_TEST):Lr(y.DEPTH_TEST)},setMask:function(cn){fr!==cn&&!vt&&(y.depthMask(cn),fr=cn)},setFunc:function(cn){if(tr!==cn){if(cn)switch(cn){case Ar:y.depthFunc(y.NEVER);break;case _i:y.depthFunc(y.ALWAYS);break;case si:y.depthFunc(y.LESS);break;case mi:y.depthFunc(y.LEQUAL);break;case Qi:y.depthFunc(y.EQUAL);break;case Di:y.depthFunc(y.GEQUAL);break;case Kr:y.depthFunc(y.GREATER);break;case Ci:y.depthFunc(y.NOTEQUAL);break;default:y.depthFunc(y.LEQUAL)}else y.depthFunc(y.LEQUAL);tr=cn}},setLocked:function(cn){vt=cn},setClear:function(cn){br!==cn&&(y.clearDepth(cn),br=cn)},reset:function(){vt=!1,fr=null,tr=null,br=null}}}function w(){let vt=!1,fr=null,tr=null,br=null,cn=null,Fr=null,Li=null,Is=null,mo=null;return{setTest:function(Ps){vt||(Ps?yt(y.STENCIL_TEST):Lr(y.STENCIL_TEST))},setMask:function(Ps){fr!==Ps&&!vt&&(y.stencilMask(Ps),fr=Ps)},setFunc:function(Ps,sl,Fo){(tr!==Ps||br!==sl||cn!==Fo)&&(y.stencilFunc(Ps,sl,Fo),tr=Ps,br=sl,cn=Fo)},setOp:function(Ps,sl,Fo){(Fr!==Ps||Li!==sl||Is!==Fo)&&(y.stencilOp(Ps,sl,Fo),Fr=Ps,Li=sl,Is=Fo)},setLocked:function(Ps){vt=Ps},setClear:function(Ps){mo!==Ps&&(y.clearStencil(Ps),mo=Ps)},reset:function(){vt=!1,fr=null,tr=null,br=null,cn=null,Fr=null,Li=null,Is=null,mo=null}}}let S=new p,O=new v,U=new w,K={},Y={},Z=new WeakMap,ne=[],ce=null,ve=!1,Fe=null,fe=null,oe=null,Pe=null,Re=null,We=null,Je=null,dt=!1,wt=null,Dt=null,Ft=null,De=null,nt=null,_t=y.getParameter(y.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Rt=!1,Tt=0,Ct=y.getParameter(y.VERSION);Ct.indexOf("WebGL")!==-1?(Tt=parseFloat(/^WebGL (\d)/.exec(Ct)[1]),Rt=Tt>=1):Ct.indexOf("OpenGL ES")!==-1&&(Tt=parseFloat(/^OpenGL ES (\d)/.exec(Ct)[1]),Rt=Tt>=2);let Zt=null,pn={},er=y.getParameter(y.SCISSOR_BOX),ur=y.getParameter(y.VIEWPORT),$n=new Si().fromArray(er),Jt=new Si().fromArray(ur);function kn(vt,fr,tr){let br=new Uint8Array(4),cn=y.createTexture();y.bindTexture(vt,cn),y.texParameteri(vt,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(vt,y.TEXTURE_MAG_FILTER,y.NEAREST);for(let Fr=0;Fr<tr;Fr++)y.texImage2D(fr+Fr,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,br);return cn}let wr={};wr[y.TEXTURE_2D]=kn(y.TEXTURE_2D,y.TEXTURE_2D,1),wr[y.TEXTURE_CUBE_MAP]=kn(y.TEXTURE_CUBE_MAP,y.TEXTURE_CUBE_MAP_POSITIVE_X,6),S.setClear(0,0,0,1),O.setClear(1),U.setClear(0),yt(y.DEPTH_TEST),O.setFunc(mi),Dn(!1),rr(C),yt(y.CULL_FACE),rn(Q);function yt(vt){K[vt]!==!0&&(y.enable(vt),K[vt]=!0)}function Lr(vt){K[vt]!==!1&&(y.disable(vt),K[vt]=!1)}function jn(vt,fr){return Y[vt]!==fr?(y.bindFramebuffer(vt,fr),Y[vt]=fr,c&&(vt===y.DRAW_FRAMEBUFFER&&(Y[y.FRAMEBUFFER]=fr),vt===y.FRAMEBUFFER&&(Y[y.DRAW_FRAMEBUFFER]=fr)),!0):!1}function Dr(vt,fr){let tr=ne,br=!1;if(vt)if(tr=Z.get(fr),tr===void 0&&(tr=[],Z.set(fr,tr)),vt.isWebGLMultipleRenderTargets){let cn=vt.texture;if(tr.length!==cn.length||tr[0]!==y.COLOR_ATTACHMENT0){for(let Fr=0,Li=cn.length;Fr<Li;Fr++)tr[Fr]=y.COLOR_ATTACHMENT0+Fr;tr.length=cn.length,br=!0}}else tr[0]!==y.COLOR_ATTACHMENT0&&(tr[0]=y.COLOR_ATTACHMENT0,br=!0);else tr[0]!==y.BACK&&(tr[0]=y.BACK,br=!0);br&&(o.isWebGL2?y.drawBuffers(tr):r.get("WEBGL_draw_buffers").drawBuffersWEBGL(tr))}function Hn(vt){return ce!==vt?(y.useProgram(vt),ce=vt,!0):!1}let ei={[we]:y.FUNC_ADD,[he]:y.FUNC_SUBTRACT,[Ie]:y.FUNC_REVERSE_SUBTRACT};if(c)ei[Ae]=y.MIN,ei[Ue]=y.MAX;else{let vt=r.get("EXT_blend_minmax");vt!==null&&(ei[Ae]=vt.MIN_EXT,ei[Ue]=vt.MAX_EXT)}let Br={[Qe]:y.ZERO,[ht]:y.ONE,[lt]:y.SRC_COLOR,[Mt]:y.SRC_ALPHA,[Mn]:y.SRC_ALPHA_SATURATE,[Qn]:y.DST_COLOR,[Tn]:y.DST_ALPHA,[Et]:y.ONE_MINUS_SRC_COLOR,[ln]:y.ONE_MINUS_SRC_ALPHA,[Cn]:y.ONE_MINUS_DST_COLOR,[xn]:y.ONE_MINUS_DST_ALPHA};function rn(vt,fr,tr,br,cn,Fr,Li,Is){if(vt===Q){ve===!0&&(Lr(y.BLEND),ve=!1);return}if(ve===!1&&(yt(y.BLEND),ve=!0),vt!==pe){if(vt!==Fe||Is!==dt){if((fe!==we||Re!==we)&&(y.blendEquation(y.FUNC_ADD),fe=we,Re=we),Is)switch(vt){case ue:y.blendFuncSeparate(y.ONE,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA);break;case xe:y.blendFunc(y.ONE,y.ONE);break;case Se:y.blendFuncSeparate(y.ZERO,y.ONE_MINUS_SRC_COLOR,y.ZERO,y.ONE);break;case be:y.blendFuncSeparate(y.ZERO,y.SRC_COLOR,y.ZERO,y.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",vt);break}else switch(vt){case ue:y.blendFuncSeparate(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA);break;case xe:y.blendFunc(y.SRC_ALPHA,y.ONE);break;case Se:y.blendFuncSeparate(y.ZERO,y.ONE_MINUS_SRC_COLOR,y.ZERO,y.ONE);break;case be:y.blendFunc(y.ZERO,y.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",vt);break}oe=null,Pe=null,We=null,Je=null,Fe=vt,dt=Is}return}cn=cn||fr,Fr=Fr||tr,Li=Li||br,(fr!==fe||cn!==Re)&&(y.blendEquationSeparate(ei[fr],ei[cn]),fe=fr,Re=cn),(tr!==oe||br!==Pe||Fr!==We||Li!==Je)&&(y.blendFuncSeparate(Br[tr],Br[br],Br[Fr],Br[Li]),oe=tr,Pe=br,We=Fr,Je=Li),Fe=vt,dt=null}function Nn(vt,fr){vt.side===$?Lr(y.CULL_FACE):yt(y.CULL_FACE);let tr=vt.side===B;fr&&(tr=!tr),Dn(tr),vt.blending===ue&&vt.transparent===!1?rn(Q):rn(vt.blending,vt.blendEquation,vt.blendSrc,vt.blendDst,vt.blendEquationAlpha,vt.blendSrcAlpha,vt.blendDstAlpha,vt.premultipliedAlpha),O.setFunc(vt.depthFunc),O.setTest(vt.depthTest),O.setMask(vt.depthWrite),S.setMask(vt.colorWrite);let br=vt.stencilWrite;U.setTest(br),br&&(U.setMask(vt.stencilWriteMask),U.setFunc(vt.stencilFunc,vt.stencilRef,vt.stencilFuncMask),U.setOp(vt.stencilFail,vt.stencilZFail,vt.stencilZPass)),Ur(vt.polygonOffset,vt.polygonOffsetFactor,vt.polygonOffsetUnits),vt.alphaToCoverage===!0?yt(y.SAMPLE_ALPHA_TO_COVERAGE):Lr(y.SAMPLE_ALPHA_TO_COVERAGE)}function Dn(vt){wt!==vt&&(vt?y.frontFace(y.CW):y.frontFace(y.CCW),wt=vt)}function rr(vt){vt!==k?(yt(y.CULL_FACE),vt!==Dt&&(vt===C?y.cullFace(y.BACK):vt===M?y.cullFace(y.FRONT):y.cullFace(y.FRONT_AND_BACK))):Lr(y.CULL_FACE),Dt=vt}function Gn(vt){vt!==Ft&&(Rt&&y.lineWidth(vt),Ft=vt)}function Ur(vt,fr,tr){vt?(yt(y.POLYGON_OFFSET_FILL),(De!==fr||nt!==tr)&&(y.polygonOffset(fr,tr),De=fr,nt=tr)):Lr(y.POLYGON_OFFSET_FILL)}function zr(vt){vt?yt(y.SCISSOR_TEST):Lr(y.SCISSOR_TEST)}function fi(vt){vt===void 0&&(vt=y.TEXTURE0+_t-1),Zt!==vt&&(y.activeTexture(vt),Zt=vt)}function us(vt,fr){Zt===null&&fi();let tr=pn[Zt];tr===void 0&&(tr={type:void 0,texture:void 0},pn[Zt]=tr),(tr.type!==vt||tr.texture!==fr)&&(y.bindTexture(vt,fr||wr[vt]),tr.type=vt,tr.texture=fr)}function Yi(){let vt=pn[Zt];vt!==void 0&&vt.type!==void 0&&(y.bindTexture(vt.type,null),vt.type=void 0,vt.texture=void 0)}function it(){try{y.compressedTexImage2D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Ke(){try{y.texSubImage2D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function an(){try{y.texSubImage3D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Ln(){try{y.compressedTexSubImage2D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function dr(){try{y.texStorage2D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function en(){try{y.texStorage3D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Er(){try{y.texImage2D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function sr(){try{y.texImage3D.apply(y,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Vn(vt){$n.equals(vt)===!1&&(y.scissor(vt.x,vt.y,vt.z,vt.w),$n.copy(vt))}function On(vt){Jt.equals(vt)===!1&&(y.viewport(vt.x,vt.y,vt.z,vt.w),Jt.copy(vt))}function Hr(){y.disable(y.BLEND),y.disable(y.CULL_FACE),y.disable(y.DEPTH_TEST),y.disable(y.POLYGON_OFFSET_FILL),y.disable(y.SCISSOR_TEST),y.disable(y.STENCIL_TEST),y.disable(y.SAMPLE_ALPHA_TO_COVERAGE),y.blendEquation(y.FUNC_ADD),y.blendFunc(y.ONE,y.ZERO),y.blendFuncSeparate(y.ONE,y.ZERO,y.ONE,y.ZERO),y.colorMask(!0,!0,!0,!0),y.clearColor(0,0,0,0),y.depthMask(!0),y.depthFunc(y.LESS),y.clearDepth(1),y.stencilMask(4294967295),y.stencilFunc(y.ALWAYS,0,4294967295),y.stencilOp(y.KEEP,y.KEEP,y.KEEP),y.clearStencil(0),y.cullFace(y.BACK),y.frontFace(y.CCW),y.polygonOffset(0,0),y.activeTexture(y.TEXTURE0),y.bindFramebuffer(y.FRAMEBUFFER,null),c===!0&&(y.bindFramebuffer(y.DRAW_FRAMEBUFFER,null),y.bindFramebuffer(y.READ_FRAMEBUFFER,null)),y.useProgram(null),y.lineWidth(1),y.scissor(0,0,y.canvas.width,y.canvas.height),y.viewport(0,0,y.canvas.width,y.canvas.height),K={},Zt=null,pn={},Y={},Z=new WeakMap,ne=[],ce=null,ve=!1,Fe=null,fe=null,oe=null,Pe=null,Re=null,We=null,Je=null,dt=!1,wt=null,Dt=null,Ft=null,De=null,nt=null,$n.set(0,0,y.canvas.width,y.canvas.height),Jt.set(0,0,y.canvas.width,y.canvas.height),S.reset(),O.reset(),U.reset()}return{buffers:{color:S,depth:O,stencil:U},enable:yt,disable:Lr,bindFramebuffer:jn,drawBuffers:Dr,useProgram:Hn,setBlending:rn,setMaterial:Nn,setFlipSided:Dn,setCullFace:rr,setLineWidth:Gn,setPolygonOffset:Ur,setScissorTest:zr,activeTexture:fi,bindTexture:us,unbindTexture:Yi,compressedTexImage2D:it,texImage2D:Er,texImage3D:sr,texStorage2D:dr,texStorage3D:en,texSubImage2D:Ke,texSubImage3D:an,compressedTexSubImage2D:Ln,scissor:Vn,viewport:On,reset:Hr}}function R1(y,r,o,c,p,v,w){let S=p.isWebGL2,O=p.maxTextures,U=p.maxCubemapSize,K=p.maxTextureSize,Y=p.maxSamples,ne=r.has("WEBGL_multisampled_render_to_texture")?r.get("WEBGL_multisampled_render_to_texture"):void 0,ce=new WeakMap,ve,Fe=!1;try{Fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function fe(it,Ke){return Fe?new OffscreenCanvas(it,Ke):sc("canvas")}function oe(it,Ke,an,Ln){let dr=1;if((it.width>Ln||it.height>Ln)&&(dr=Ln/Math.max(it.width,it.height)),dr<1||Ke===!0)if(typeof HTMLImageElement<"u"&&it instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&it instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&it instanceof ImageBitmap){let en=Ke?rh:Math.floor,Er=en(dr*it.width),sr=en(dr*it.height);ve===void 0&&(ve=fe(Er,sr));let Vn=an?fe(Er,sr):ve;return Vn.width=Er,Vn.height=sr,Vn.getContext("2d").drawImage(it,0,0,Er,sr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+it.width+"x"+it.height+") to ("+Er+"x"+sr+")."),Vn}else return"data"in it&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+it.width+"x"+it.height+")."),it;return it}function Pe(it){return nh(it.width)&&nh(it.height)}function Re(it){return S?!1:it.wrapS!==gn||it.wrapT!==gn||it.minFilter!==In&&it.minFilter!==St}function We(it,Ke){return it.generateMipmaps&&Ke&&it.minFilter!==In&&it.minFilter!==St}function Je(it){y.generateMipmap(it)}function dt(it,Ke,an,Ln,dr=!1){if(S===!1)return Ke;if(it!==null){if(y[it]!==void 0)return y[it];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+it+"'")}let en=Ke;return Ke===y.RED&&(an===y.FLOAT&&(en=y.R32F),an===y.HALF_FLOAT&&(en=y.R16F),an===y.UNSIGNED_BYTE&&(en=y.R8)),Ke===y.RG&&(an===y.FLOAT&&(en=y.RG32F),an===y.HALF_FLOAT&&(en=y.RG16F),an===y.UNSIGNED_BYTE&&(en=y.RG8)),Ke===y.RGBA&&(an===y.FLOAT&&(en=y.RGBA32F),an===y.HALF_FLOAT&&(en=y.RGBA16F),an===y.UNSIGNED_BYTE&&(en=Ln===Qr&&dr===!1?y.SRGB8_ALPHA8:y.RGBA8),an===y.UNSIGNED_SHORT_4_4_4_4&&(en=y.RGBA4),an===y.UNSIGNED_SHORT_5_5_5_1&&(en=y.RGB5_A1)),(en===y.R16F||en===y.R32F||en===y.RG16F||en===y.RG32F||en===y.RGBA16F||en===y.RGBA32F)&&r.get("EXT_color_buffer_float"),en}function wt(it,Ke,an){return We(it,an)===!0||it.isFramebufferTexture&&it.minFilter!==In&&it.minFilter!==St?Math.log2(Math.max(Ke.width,Ke.height))+1:it.mipmaps!==void 0&&it.mipmaps.length>0?it.mipmaps.length:it.isCompressedTexture&&Array.isArray(it.image)?Ke.mipmaps.length:1}function Dt(it){return it===In||it===Yr||it===Ii?y.NEAREST:y.LINEAR}function Ft(it){let Ke=it.target;Ke.removeEventListener("dispose",Ft),nt(Ke),Ke.isVideoTexture&&ce.delete(Ke),w.memory.textures--}function De(it){let Ke=it.target;Ke.removeEventListener("dispose",De),_t(Ke)}function nt(it){let Ke=c.get(it);Ke.__webglInit!==void 0&&(y.deleteTexture(Ke.__webglTexture),c.remove(it))}function _t(it){let Ke=it.texture,an=c.get(it),Ln=c.get(Ke);if(!!it){if(Ln.__webglTexture!==void 0&&(y.deleteTexture(Ln.__webglTexture),w.memory.textures--),it.depthTexture&&it.depthTexture.dispose(),it.isWebGLCubeRenderTarget)for(let dr=0;dr<6;dr++)y.deleteFramebuffer(an.__webglFramebuffer[dr]),an.__webglDepthbuffer&&y.deleteRenderbuffer(an.__webglDepthbuffer[dr]);else y.deleteFramebuffer(an.__webglFramebuffer),an.__webglDepthbuffer&&y.deleteRenderbuffer(an.__webglDepthbuffer),an.__webglMultisampledFramebuffer&&y.deleteFramebuffer(an.__webglMultisampledFramebuffer),an.__webglColorRenderbuffer&&y.deleteRenderbuffer(an.__webglColorRenderbuffer),an.__webglDepthRenderbuffer&&y.deleteRenderbuffer(an.__webglDepthRenderbuffer);if(it.isWebGLMultipleRenderTargets)for(let dr=0,en=Ke.length;dr<en;dr++){let Er=c.get(Ke[dr]);Er.__webglTexture&&(y.deleteTexture(Er.__webglTexture),w.memory.textures--),c.remove(Ke[dr])}c.remove(Ke),c.remove(it)}}let Rt=0;function Tt(){Rt=0}function Ct(){let it=Rt;return it>=O&&console.warn("THREE.WebGLTextures: Trying to use "+it+" texture units while this GPU supports only "+O),Rt+=1,it}function Zt(it,Ke){let an=c.get(it);if(it.isVideoTexture&&Gn(it),it.version>0&&an.__version!==it.version){let Ln=it.image;if(Ln===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Ln.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{yt(an,it,Ke);return}}o.activeTexture(y.TEXTURE0+Ke),o.bindTexture(y.TEXTURE_2D,an.__webglTexture)}function pn(it,Ke){let an=c.get(it);if(it.version>0&&an.__version!==it.version){yt(an,it,Ke);return}o.activeTexture(y.TEXTURE0+Ke),o.bindTexture(y.TEXTURE_2D_ARRAY,an.__webglTexture)}function er(it,Ke){let an=c.get(it);if(it.version>0&&an.__version!==it.version){yt(an,it,Ke);return}o.activeTexture(y.TEXTURE0+Ke),o.bindTexture(y.TEXTURE_3D,an.__webglTexture)}function ur(it,Ke){let an=c.get(it);if(it.version>0&&an.__version!==it.version){Lr(an,it,Ke);return}o.activeTexture(y.TEXTURE0+Ke),o.bindTexture(y.TEXTURE_CUBE_MAP,an.__webglTexture)}let $n={[mn]:y.REPEAT,[gn]:y.CLAMP_TO_EDGE,[_n]:y.MIRRORED_REPEAT},Jt={[In]:y.NEAREST,[Yr]:y.NEAREST_MIPMAP_NEAREST,[Ii]:y.NEAREST_MIPMAP_LINEAR,[St]:y.LINEAR,[Kt]:y.LINEAR_MIPMAP_NEAREST,[cr]:y.LINEAR_MIPMAP_LINEAR};function kn(it,Ke,an){if(an?(y.texParameteri(it,y.TEXTURE_WRAP_S,$n[Ke.wrapS]),y.texParameteri(it,y.TEXTURE_WRAP_T,$n[Ke.wrapT]),(it===y.TEXTURE_3D||it===y.TEXTURE_2D_ARRAY)&&y.texParameteri(it,y.TEXTURE_WRAP_R,$n[Ke.wrapR]),y.texParameteri(it,y.TEXTURE_MAG_FILTER,Jt[Ke.magFilter]),y.texParameteri(it,y.TEXTURE_MIN_FILTER,Jt[Ke.minFilter])):(y.texParameteri(it,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(it,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),(it===y.TEXTURE_3D||it===y.TEXTURE_2D_ARRAY)&&y.texParameteri(it,y.TEXTURE_WRAP_R,y.CLAMP_TO_EDGE),(Ke.wrapS!==gn||Ke.wrapT!==gn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),y.texParameteri(it,y.TEXTURE_MAG_FILTER,Dt(Ke.magFilter)),y.texParameteri(it,y.TEXTURE_MIN_FILTER,Dt(Ke.minFilter)),Ke.minFilter!==In&&Ke.minFilter!==St&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),r.has("EXT_texture_filter_anisotropic")===!0){let Ln=r.get("EXT_texture_filter_anisotropic");if(Ke.type===ti&&r.has("OES_texture_float_linear")===!1||S===!1&&Ke.type===Vi&&r.has("OES_texture_half_float_linear")===!1)return;(Ke.anisotropy>1||c.get(Ke).__currentAnisotropy)&&(y.texParameterf(it,Ln.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ke.anisotropy,p.getMaxAnisotropy())),c.get(Ke).__currentAnisotropy=Ke.anisotropy)}}function wr(it,Ke){it.__webglInit===void 0&&(it.__webglInit=!0,Ke.addEventListener("dispose",Ft),it.__webglTexture=y.createTexture(),w.memory.textures++)}function yt(it,Ke,an){let Ln=y.TEXTURE_2D;Ke.isDataTexture2DArray&&(Ln=y.TEXTURE_2D_ARRAY),Ke.isDataTexture3D&&(Ln=y.TEXTURE_3D),wr(it,Ke),o.activeTexture(y.TEXTURE0+an),o.bindTexture(Ln,it.__webglTexture),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,Ke.flipY),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ke.premultiplyAlpha),y.pixelStorei(y.UNPACK_ALIGNMENT,Ke.unpackAlignment),y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.NONE);let dr=Re(Ke)&&Pe(Ke.image)===!1,en=oe(Ke.image,dr,!1,K);en=Ur(Ke,en);let Er=Pe(en)||S,sr=v.convert(Ke.format,Ke.encoding),Vn=v.convert(Ke.type),On=dt(Ke.internalFormat,sr,Vn,Ke.encoding,Ke.isVideoTexture);kn(Ln,Ke,Er);let Hr,vt=Ke.mipmaps,fr=S&&Ke.isVideoTexture!==!0,tr=it.__version===void 0,br=wt(Ke,en,Er);if(Ke.isDepthTexture)On=y.DEPTH_COMPONENT,S?Ke.type===ti?On=y.DEPTH_COMPONENT32F:Ke.type===hs?On=y.DEPTH_COMPONENT24:Ke.type===Xi?On=y.DEPTH24_STENCIL8:On=y.DEPTH_COMPONENT16:Ke.type===ti&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ke.format===zs&&On===y.DEPTH_COMPONENT&&Ke.type!==gi&&Ke.type!==hs&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ke.type=gi,Vn=v.convert(Ke.type)),Ke.format===$e&&On===y.DEPTH_COMPONENT&&(On=y.DEPTH_STENCIL,Ke.type!==Xi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ke.type=Xi,Vn=v.convert(Ke.type))),fr&&tr?o.texStorage2D(y.TEXTURE_2D,1,On,en.width,en.height):o.texImage2D(y.TEXTURE_2D,0,On,en.width,en.height,0,sr,Vn,null);else if(Ke.isDataTexture)if(vt.length>0&&Er){fr&&tr&&o.texStorage2D(y.TEXTURE_2D,br,On,vt[0].width,vt[0].height);for(let cn=0,Fr=vt.length;cn<Fr;cn++)Hr=vt[cn],fr?o.texSubImage2D(y.TEXTURE_2D,0,0,0,Hr.width,Hr.height,sr,Vn,Hr.data):o.texImage2D(y.TEXTURE_2D,cn,On,Hr.width,Hr.height,0,sr,Vn,Hr.data);Ke.generateMipmaps=!1}else fr?(tr&&o.texStorage2D(y.TEXTURE_2D,br,On,en.width,en.height),o.texSubImage2D(y.TEXTURE_2D,0,0,0,en.width,en.height,sr,Vn,en.data)):o.texImage2D(y.TEXTURE_2D,0,On,en.width,en.height,0,sr,Vn,en.data);else if(Ke.isCompressedTexture){fr&&tr&&o.texStorage2D(y.TEXTURE_2D,br,On,vt[0].width,vt[0].height);for(let cn=0,Fr=vt.length;cn<Fr;cn++)Hr=vt[cn],Ke.format!==li?sr!==null?fr?o.compressedTexSubImage2D(y.TEXTURE_2D,cn,0,0,Hr.width,Hr.height,sr,Hr.data):o.compressedTexImage2D(y.TEXTURE_2D,cn,On,Hr.width,Hr.height,0,Hr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):fr?o.texSubImage2D(y.TEXTURE_2D,cn,0,0,Hr.width,Hr.height,sr,Vn,Hr.data):o.texImage2D(y.TEXTURE_2D,cn,On,Hr.width,Hr.height,0,sr,Vn,Hr.data)}else if(Ke.isDataTexture2DArray)fr?(tr&&o.texStorage3D(y.TEXTURE_2D_ARRAY,br,On,en.width,en.height,en.depth),o.texSubImage3D(y.TEXTURE_2D_ARRAY,0,0,0,0,en.width,en.height,en.depth,sr,Vn,en.data)):o.texImage3D(y.TEXTURE_2D_ARRAY,0,On,en.width,en.height,en.depth,0,sr,Vn,en.data);else if(Ke.isDataTexture3D)fr?(tr&&o.texStorage3D(y.TEXTURE_3D,br,On,en.width,en.height,en.depth),o.texSubImage3D(y.TEXTURE_3D,0,0,0,0,en.width,en.height,en.depth,sr,Vn,en.data)):o.texImage3D(y.TEXTURE_3D,0,On,en.width,en.height,en.depth,0,sr,Vn,en.data);else if(Ke.isFramebufferTexture)fr&&tr?o.texStorage2D(y.TEXTURE_2D,br,On,en.width,en.height):o.texImage2D(y.TEXTURE_2D,0,On,en.width,en.height,0,sr,Vn,null);else if(vt.length>0&&Er){fr&&tr&&o.texStorage2D(y.TEXTURE_2D,br,On,vt[0].width,vt[0].height);for(let cn=0,Fr=vt.length;cn<Fr;cn++)Hr=vt[cn],fr?o.texSubImage2D(y.TEXTURE_2D,cn,0,0,sr,Vn,Hr):o.texImage2D(y.TEXTURE_2D,cn,On,sr,Vn,Hr);Ke.generateMipmaps=!1}else fr?(tr&&o.texStorage2D(y.TEXTURE_2D,br,On,en.width,en.height),o.texSubImage2D(y.TEXTURE_2D,0,0,0,sr,Vn,en)):o.texImage2D(y.TEXTURE_2D,0,On,sr,Vn,en);We(Ke,Er)&&Je(Ln),it.__version=Ke.version,Ke.onUpdate&&Ke.onUpdate(Ke)}function Lr(it,Ke,an){if(Ke.image.length!==6)return;wr(it,Ke),o.activeTexture(y.TEXTURE0+an),o.bindTexture(y.TEXTURE_CUBE_MAP,it.__webglTexture),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,Ke.flipY),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ke.premultiplyAlpha),y.pixelStorei(y.UNPACK_ALIGNMENT,Ke.unpackAlignment),y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.NONE);let Ln=Ke&&(Ke.isCompressedTexture||Ke.image[0].isCompressedTexture),dr=Ke.image[0]&&Ke.image[0].isDataTexture,en=[];for(let cn=0;cn<6;cn++)!Ln&&!dr?en[cn]=oe(Ke.image[cn],!1,!0,U):en[cn]=dr?Ke.image[cn].image:Ke.image[cn],en[cn]=Ur(Ke,en[cn]);let Er=en[0],sr=Pe(Er)||S,Vn=v.convert(Ke.format,Ke.encoding),On=v.convert(Ke.type),Hr=dt(Ke.internalFormat,Vn,On,Ke.encoding),vt=S&&Ke.isVideoTexture!==!0,fr=it.__version===void 0,tr=wt(Ke,Er,sr);kn(y.TEXTURE_CUBE_MAP,Ke,sr);let br;if(Ln){vt&&fr&&o.texStorage2D(y.TEXTURE_CUBE_MAP,tr,Hr,Er.width,Er.height);for(let cn=0;cn<6;cn++){br=en[cn].mipmaps;for(let Fr=0;Fr<br.length;Fr++){let Li=br[Fr];Ke.format!==li?Vn!==null?vt?o.compressedTexSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr,0,0,Li.width,Li.height,Vn,Li.data):o.compressedTexImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr,Hr,Li.width,Li.height,0,Li.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):vt?o.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr,0,0,Li.width,Li.height,Vn,On,Li.data):o.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr,Hr,Li.width,Li.height,0,Vn,On,Li.data)}}}else{br=Ke.mipmaps,vt&&fr&&(br.length>0&&tr++,o.texStorage2D(y.TEXTURE_CUBE_MAP,tr,Hr,en[0].width,en[0].height));for(let cn=0;cn<6;cn++)if(dr){vt?o.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,0,0,0,en[cn].width,en[cn].height,Vn,On,en[cn].data):o.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,0,Hr,en[cn].width,en[cn].height,0,Vn,On,en[cn].data);for(let Fr=0;Fr<br.length;Fr++){let Is=br[Fr].image[cn].image;vt?o.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr+1,0,0,Is.width,Is.height,Vn,On,Is.data):o.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr+1,Hr,Is.width,Is.height,0,Vn,On,Is.data)}}else{vt?o.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,0,0,0,Vn,On,en[cn]):o.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,0,Hr,Vn,On,en[cn]);for(let Fr=0;Fr<br.length;Fr++){let Li=br[Fr];vt?o.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr+1,0,0,Vn,On,Li.image[cn]):o.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+cn,Fr+1,Hr,Vn,On,Li.image[cn])}}}We(Ke,sr)&&Je(y.TEXTURE_CUBE_MAP),it.__version=Ke.version,Ke.onUpdate&&Ke.onUpdate(Ke)}function jn(it,Ke,an,Ln,dr){let en=v.convert(an.format,an.encoding),Er=v.convert(an.type),sr=dt(an.internalFormat,en,Er,an.encoding);c.get(Ke).__hasExternalTextures||(dr===y.TEXTURE_3D||dr===y.TEXTURE_2D_ARRAY?o.texImage3D(dr,0,sr,Ke.width,Ke.height,Ke.depth,0,en,Er,null):o.texImage2D(dr,0,sr,Ke.width,Ke.height,0,en,Er,null)),o.bindFramebuffer(y.FRAMEBUFFER,it),Ke.useRenderToTexture?ne.framebufferTexture2DMultisampleEXT(y.FRAMEBUFFER,Ln,dr,c.get(an).__webglTexture,0,rr(Ke)):y.framebufferTexture2D(y.FRAMEBUFFER,Ln,dr,c.get(an).__webglTexture,0),o.bindFramebuffer(y.FRAMEBUFFER,null)}function Dr(it,Ke,an){if(y.bindRenderbuffer(y.RENDERBUFFER,it),Ke.depthBuffer&&!Ke.stencilBuffer){let Ln=y.DEPTH_COMPONENT16;if(an||Ke.useRenderToTexture){let dr=Ke.depthTexture;dr&&dr.isDepthTexture&&(dr.type===ti?Ln=y.DEPTH_COMPONENT32F:dr.type===hs&&(Ln=y.DEPTH_COMPONENT24));let en=rr(Ke);Ke.useRenderToTexture?ne.renderbufferStorageMultisampleEXT(y.RENDERBUFFER,en,Ln,Ke.width,Ke.height):y.renderbufferStorageMultisample(y.RENDERBUFFER,en,Ln,Ke.width,Ke.height)}else y.renderbufferStorage(y.RENDERBUFFER,Ln,Ke.width,Ke.height);y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,it)}else if(Ke.depthBuffer&&Ke.stencilBuffer){let Ln=rr(Ke);an&&Ke.useRenderbuffer?y.renderbufferStorageMultisample(y.RENDERBUFFER,Ln,y.DEPTH24_STENCIL8,Ke.width,Ke.height):Ke.useRenderToTexture?ne.renderbufferStorageMultisampleEXT(y.RENDERBUFFER,Ln,y.DEPTH24_STENCIL8,Ke.width,Ke.height):y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_STENCIL,Ke.width,Ke.height),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,it)}else{let Ln=Ke.isWebGLMultipleRenderTargets===!0?Ke.texture[0]:Ke.texture,dr=v.convert(Ln.format,Ln.encoding),en=v.convert(Ln.type),Er=dt(Ln.internalFormat,dr,en,Ln.encoding),sr=rr(Ke);an&&Ke.useRenderbuffer?y.renderbufferStorageMultisample(y.RENDERBUFFER,sr,Er,Ke.width,Ke.height):Ke.useRenderToTexture?ne.renderbufferStorageMultisampleEXT(y.RENDERBUFFER,sr,Er,Ke.width,Ke.height):y.renderbufferStorage(y.RENDERBUFFER,Er,Ke.width,Ke.height)}y.bindRenderbuffer(y.RENDERBUFFER,null)}function Hn(it,Ke){if(Ke&&Ke.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(o.bindFramebuffer(y.FRAMEBUFFER,it),!(Ke.depthTexture&&Ke.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!c.get(Ke.depthTexture).__webglTexture||Ke.depthTexture.image.width!==Ke.width||Ke.depthTexture.image.height!==Ke.height)&&(Ke.depthTexture.image.width=Ke.width,Ke.depthTexture.image.height=Ke.height,Ke.depthTexture.needsUpdate=!0),Zt(Ke.depthTexture,0);let Ln=c.get(Ke.depthTexture).__webglTexture,dr=rr(Ke);if(Ke.depthTexture.format===zs)Ke.useRenderToTexture?ne.framebufferTexture2DMultisampleEXT(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.TEXTURE_2D,Ln,0,dr):y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.TEXTURE_2D,Ln,0);else if(Ke.depthTexture.format===$e)Ke.useRenderToTexture?ne.framebufferTexture2DMultisampleEXT(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.TEXTURE_2D,Ln,0,dr):y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.TEXTURE_2D,Ln,0);else throw new Error("Unknown depthTexture format")}function ei(it){let Ke=c.get(it),an=it.isWebGLCubeRenderTarget===!0;if(it.depthTexture&&!Ke.__autoAllocateDepthBuffer){if(an)throw new Error("target.depthTexture not supported in Cube render targets");Hn(Ke.__webglFramebuffer,it)}else if(an){Ke.__webglDepthbuffer=[];for(let Ln=0;Ln<6;Ln++)o.bindFramebuffer(y.FRAMEBUFFER,Ke.__webglFramebuffer[Ln]),Ke.__webglDepthbuffer[Ln]=y.createRenderbuffer(),Dr(Ke.__webglDepthbuffer[Ln],it,!1)}else o.bindFramebuffer(y.FRAMEBUFFER,Ke.__webglFramebuffer),Ke.__webglDepthbuffer=y.createRenderbuffer(),Dr(Ke.__webglDepthbuffer,it,!1);o.bindFramebuffer(y.FRAMEBUFFER,null)}function Br(it,Ke,an){let Ln=c.get(it);Ke!==void 0&&jn(Ln.__webglFramebuffer,it,it.texture,y.COLOR_ATTACHMENT0,y.TEXTURE_2D),an!==void 0&&ei(it)}function rn(it){let Ke=it.texture,an=c.get(it),Ln=c.get(Ke);it.addEventListener("dispose",De),it.isWebGLMultipleRenderTargets!==!0&&(Ln.__webglTexture===void 0&&(Ln.__webglTexture=y.createTexture()),Ln.__version=Ke.version,w.memory.textures++);let dr=it.isWebGLCubeRenderTarget===!0,en=it.isWebGLMultipleRenderTargets===!0,Er=Ke.isDataTexture3D||Ke.isDataTexture2DArray,sr=Pe(it)||S;if(dr){an.__webglFramebuffer=[];for(let Vn=0;Vn<6;Vn++)an.__webglFramebuffer[Vn]=y.createFramebuffer()}else if(an.__webglFramebuffer=y.createFramebuffer(),en)if(p.drawBuffers){let Vn=it.texture;for(let On=0,Hr=Vn.length;On<Hr;On++){let vt=c.get(Vn[On]);vt.__webglTexture===void 0&&(vt.__webglTexture=y.createTexture(),w.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(it.useRenderbuffer)if(S){an.__webglMultisampledFramebuffer=y.createFramebuffer(),an.__webglColorRenderbuffer=y.createRenderbuffer(),y.bindRenderbuffer(y.RENDERBUFFER,an.__webglColorRenderbuffer);let Vn=v.convert(Ke.format,Ke.encoding),On=v.convert(Ke.type),Hr=dt(Ke.internalFormat,Vn,On,Ke.encoding),vt=rr(it);y.renderbufferStorageMultisample(y.RENDERBUFFER,vt,Hr,it.width,it.height),o.bindFramebuffer(y.FRAMEBUFFER,an.__webglMultisampledFramebuffer),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.RENDERBUFFER,an.__webglColorRenderbuffer),y.bindRenderbuffer(y.RENDERBUFFER,null),it.depthBuffer&&(an.__webglDepthRenderbuffer=y.createRenderbuffer(),Dr(an.__webglDepthRenderbuffer,it,!0)),o.bindFramebuffer(y.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(dr){o.bindTexture(y.TEXTURE_CUBE_MAP,Ln.__webglTexture),kn(y.TEXTURE_CUBE_MAP,Ke,sr);for(let Vn=0;Vn<6;Vn++)jn(an.__webglFramebuffer[Vn],it,Ke,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+Vn);We(Ke,sr)&&Je(y.TEXTURE_CUBE_MAP),o.unbindTexture()}else if(en){let Vn=it.texture;for(let On=0,Hr=Vn.length;On<Hr;On++){let vt=Vn[On],fr=c.get(vt);o.bindTexture(y.TEXTURE_2D,fr.__webglTexture),kn(y.TEXTURE_2D,vt,sr),jn(an.__webglFramebuffer,it,vt,y.COLOR_ATTACHMENT0+On,y.TEXTURE_2D),We(vt,sr)&&Je(y.TEXTURE_2D)}o.unbindTexture()}else{let Vn=y.TEXTURE_2D;Er&&(S?Vn=Ke.isDataTexture3D?y.TEXTURE_3D:y.TEXTURE_2D_ARRAY:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),o.bindTexture(Vn,Ln.__webglTexture),kn(Vn,Ke,sr),jn(an.__webglFramebuffer,it,Ke,y.COLOR_ATTACHMENT0,Vn),We(Ke,sr)&&Je(Vn),o.unbindTexture()}it.depthBuffer&&ei(it)}function Nn(it){let Ke=Pe(it)||S,an=it.isWebGLMultipleRenderTargets===!0?it.texture:[it.texture];for(let Ln=0,dr=an.length;Ln<dr;Ln++){let en=an[Ln];if(We(en,Ke)){let Er=it.isWebGLCubeRenderTarget?y.TEXTURE_CUBE_MAP:y.TEXTURE_2D,sr=c.get(en).__webglTexture;o.bindTexture(Er,sr),Je(Er),o.unbindTexture()}}}function Dn(it){if(it.useRenderbuffer)if(S){let Ke=it.width,an=it.height,Ln=y.COLOR_BUFFER_BIT,dr=[y.COLOR_ATTACHMENT0],en=it.stencilBuffer?y.DEPTH_STENCIL_ATTACHMENT:y.DEPTH_ATTACHMENT;it.depthBuffer&&dr.push(en),it.ignoreDepthForMultisampleCopy||(it.depthBuffer&&(Ln|=y.DEPTH_BUFFER_BIT),it.stencilBuffer&&(Ln|=y.STENCIL_BUFFER_BIT));let Er=c.get(it);o.bindFramebuffer(y.READ_FRAMEBUFFER,Er.__webglMultisampledFramebuffer),o.bindFramebuffer(y.DRAW_FRAMEBUFFER,Er.__webglFramebuffer),it.ignoreDepthForMultisampleCopy&&(y.invalidateFramebuffer(y.READ_FRAMEBUFFER,[en]),y.invalidateFramebuffer(y.DRAW_FRAMEBUFFER,[en])),y.blitFramebuffer(0,0,Ke,an,0,0,Ke,an,Ln,y.NEAREST),y.invalidateFramebuffer(y.READ_FRAMEBUFFER,dr),o.bindFramebuffer(y.READ_FRAMEBUFFER,null),o.bindFramebuffer(y.DRAW_FRAMEBUFFER,Er.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function rr(it){return S&&(it.useRenderbuffer||it.useRenderToTexture)?Math.min(Y,it.samples):0}function Gn(it){let Ke=w.render.frame;ce.get(it)!==Ke&&(ce.set(it,Ke),it.update())}function Ur(it,Ke){let an=it.encoding,Ln=it.format,dr=it.type;return it.isCompressedTexture===!0||it.isVideoTexture===!0||it.format===bu||an!==Ei&&(an===Qr?S===!1?r.has("EXT_sRGB")===!0&&Ln===li?(it.format=bu,it.minFilter=St,it.generateMipmaps=!1):Ke=gl.sRGBToLinear(Ke):(Ln!==li||dr!==xr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",an)),Ke}let zr=!1,fi=!1;function us(it,Ke){it&&it.isWebGLRenderTarget&&(zr===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),zr=!0),it=it.texture),Zt(it,Ke)}function Yi(it,Ke){it&&it.isWebGLCubeRenderTarget&&(fi===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),fi=!0),it=it.texture),ur(it,Ke)}this.allocateTextureUnit=Ct,this.resetTextureUnits=Tt,this.setTexture2D=Zt,this.setTexture2DArray=pn,this.setTexture3D=er,this.setTextureCube=ur,this.rebindTextures=Br,this.setupRenderTarget=rn,this.updateRenderTargetMipmap=Nn,this.updateMultisampleRenderTarget=Dn,this.setupDepthRenderbuffer=ei,this.setupFrameBufferTexture=jn,this.safeSetTexture2D=us,this.safeSetTextureCube=Yi}function lb(y,r,o){let c=o.isWebGL2;function p(v,w=null){let S;if(v===xr)return y.UNSIGNED_BYTE;if(v===Rn)return y.UNSIGNED_SHORT_4_4_4_4;if(v===wo)return y.UNSIGNED_SHORT_5_5_5_1;if(v===Ir)return y.BYTE;if(v===Sr)return y.SHORT;if(v===gi)return y.UNSIGNED_SHORT;if(v===yi)return y.INT;if(v===hs)return y.UNSIGNED_INT;if(v===ti)return y.FLOAT;if(v===Vi)return c?y.HALF_FLOAT:(S=r.get("OES_texture_half_float"),S!==null?S.HALF_FLOAT_OES:null);if(v===Fi)return y.ALPHA;if(v===li)return y.RGBA;if(v===aa)return y.LUMINANCE;if(v===nc)return y.LUMINANCE_ALPHA;if(v===zs)return y.DEPTH_COMPONENT;if(v===$e)return y.DEPTH_STENCIL;if(v===et)return y.RED;if(v===bu)return S=r.get("EXT_sRGB"),S!==null?S.SRGB_ALPHA_EXT:null;if(v===xt)return y.RED_INTEGER;if(v===Vt)return y.RG;if(v===Ge)return y.RG_INTEGER;if(v===nn)return y.RGBA_INTEGER;if(v===wn||v===qn||v===Sn||v===Xt)if(w===Qr)if(S=r.get("WEBGL_compressed_texture_s3tc_srgb"),S!==null){if(v===wn)return S.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(v===qn)return S.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(v===Sn)return S.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(v===Xt)return S.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(S=r.get("WEBGL_compressed_texture_s3tc"),S!==null){if(v===wn)return S.COMPRESSED_RGB_S3TC_DXT1_EXT;if(v===qn)return S.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(v===Sn)return S.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(v===Xt)return S.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(v===nr||v===yr||v===Tr||v===qi)if(S=r.get("WEBGL_compressed_texture_pvrtc"),S!==null){if(v===nr)return S.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(v===yr)return S.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(v===Tr)return S.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(v===qi)return S.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(v===ai)return S=r.get("WEBGL_compressed_texture_etc1"),S!==null?S.COMPRESSED_RGB_ETC1_WEBGL:null;if(v===Vr||v===ui)if(S=r.get("WEBGL_compressed_texture_etc"),S!==null){if(v===Vr)return w===Qr?S.COMPRESSED_SRGB8_ETC2:S.COMPRESSED_RGB8_ETC2;if(v===ui)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:S.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(v===Zi||v===ks||v===Mr||v===jr||v===Xr||v===qs||v===Bi||v===Ki||v===le||v===de||v===_e||v===Ne||v===He||v===ct)if(S=r.get("WEBGL_compressed_texture_astc"),S!==null){if(v===Zi)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:S.COMPRESSED_RGBA_ASTC_4x4_KHR;if(v===ks)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:S.COMPRESSED_RGBA_ASTC_5x4_KHR;if(v===Mr)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:S.COMPRESSED_RGBA_ASTC_5x5_KHR;if(v===jr)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:S.COMPRESSED_RGBA_ASTC_6x5_KHR;if(v===Xr)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:S.COMPRESSED_RGBA_ASTC_6x6_KHR;if(v===qs)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:S.COMPRESSED_RGBA_ASTC_8x5_KHR;if(v===Bi)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:S.COMPRESSED_RGBA_ASTC_8x6_KHR;if(v===Ki)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:S.COMPRESSED_RGBA_ASTC_8x8_KHR;if(v===le)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:S.COMPRESSED_RGBA_ASTC_10x5_KHR;if(v===de)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:S.COMPRESSED_RGBA_ASTC_10x6_KHR;if(v===_e)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:S.COMPRESSED_RGBA_ASTC_10x8_KHR;if(v===Ne)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:S.COMPRESSED_RGBA_ASTC_10x10_KHR;if(v===He)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:S.COMPRESSED_RGBA_ASTC_12x10_KHR;if(v===ct)return w===Qr?S.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:S.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(v===gt)if(S=r.get("EXT_texture_compression_bptc"),S!==null){if(v===gt)return w===Qr?S.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:S.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(v===Xi)return c?y.UNSIGNED_INT_24_8:(S=r.get("WEBGL_depth_texture"),S!==null?S.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:p}}class Mc extends bi{constructor(){super(),this.type="Group"}}Mc.prototype.isGroup=!0;class _c extends Ys{constructor(r=[]){super(),this.cameras=r}}_c.prototype.isArrayCamera=!0;var z0=new je,zd=new je;function Im(y,r,o){z0.setFromMatrixPosition(r.matrixWorld),zd.setFromMatrixPosition(o.matrixWorld);var c=z0.distanceTo(zd),p=r.projectionMatrix.elements,v=o.projectionMatrix.elements,w=p[14]/(p[10]-1),S=p[14]/(p[10]+1),O=(p[9]+1)/p[5],U=(p[9]-1)/p[5],K=(p[8]-1)/p[0],Y=(v[8]+1)/v[0],Z=w*K,ne=w*Y,ce=c/(-K+Y),ve=ce*-K;r.matrixWorld.decompose(y.position,y.quaternion,y.scale),y.translateX(ve),y.translateZ(ce),y.matrixWorld.compose(y.position,y.quaternion,y.scale),y.matrixWorldInverse.getInverse(y.matrixWorld);var Fe=w+ce,fe=S+ce,oe=Z-ve,Pe=ne+(c-ve),Re=O*S/fe*Fe,We=U*S/fe*Fe;y.projectionMatrix.makePerspective(oe,Pe,Re,We,Fe,fe)}function ub(y){var r,o,c=this,p=null,v=null,w=null,S=[],O=new Wn,U=new Wn,K=1,Y="local-floor";typeof window<"u"&&"VRFrameData"in window&&(v=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",Re,!1));var Z=new Wn,ne=new Hs,ce=new je,ve=new Ys;ve.viewport=new Si,ve.layers.enable(1);var Fe=new Ys;Fe.viewport=new Si,Fe.layers.enable(2);var fe=new _c([ve,Fe]);fe.layers.enable(1),fe.layers.enable(2);var oe=new un,Pe;function Re(){var De=c.isPresenting=p!==null&&p.isPresenting===!0;if(De){var nt=p.getEyeParameters("left");r=2*nt.renderWidth*K,o=nt.renderHeight*K,Pe=y.getPixelRatio(),y.getSize(oe),y.setDrawingBufferSize(r,o,1),ve.viewport.set(0,0,r/2,o),Fe.viewport.set(r/2,0,r/2,o),Ft.start(),c.dispatchEvent({type:"sessionstart"})}else c.enabled&&y.setDrawingBufferSize(oe.width,oe.height,Pe),Ft.stop(),c.dispatchEvent({type:"sessionend"})}var We=[],Je=[];function dt(De){for(var nt=navigator.getGamepads&&navigator.getGamepads(),_t=0,Rt=nt.length;_t<Rt;_t++){var Tt=nt[_t];if(Tt&&(Tt.id==="Daydream Controller"||Tt.id==="Gear VR Controller"||Tt.id==="Oculus Go Controller"||Tt.id==="OpenVR Gamepad"||Tt.id.startsWith("Oculus Touch")||Tt.id.startsWith("HTC Vive Focus")||Tt.id.startsWith("Spatial Controller"))){var Ct=Tt.hand;if(De===0&&(Ct===""||Ct==="right")||De===1&&Ct==="left")return Tt}}}function wt(){for(var De=0;De<S.length;De++){var nt=S[De],_t=dt(De);if(_t!==void 0&&_t.pose!==void 0){if(_t.pose===null)return;var Rt=_t.pose;Rt.hasPosition===!1&&nt.position.set(.2,-.6,-.05),Rt.position!==null&&nt.position.fromArray(Rt.position),Rt.orientation!==null&&nt.quaternion.fromArray(Rt.orientation),nt.matrix.compose(nt.position,nt.quaternion,nt.scale),nt.matrix.premultiply(O),nt.matrix.decompose(nt.position,nt.quaternion,nt.scale),nt.matrixWorldNeedsUpdate=!0,nt.visible=!0;var Tt=_t.id==="Daydream Controller"?0:1;We[De]===void 0&&(We[De]=!1),We[De]!==_t.buttons[Tt].pressed&&(We[De]=_t.buttons[Tt].pressed,We[De]===!0?nt.dispatchEvent({type:"selectstart"}):(nt.dispatchEvent({type:"selectend"}),nt.dispatchEvent({type:"select"}))),Tt=2,Je[De]===void 0&&(Je[De]=!1),_t.buttons[Tt]!==void 0&&Je[De]!==_t.buttons[Tt].pressed&&(Je[De]=_t.buttons[Tt].pressed,Je[De]===!0?nt.dispatchEvent({type:"squeezestart"}):(nt.dispatchEvent({type:"squeezeend"}),nt.dispatchEvent({type:"squeeze"})))}else nt.visible=!1}}function Dt(De,nt){nt!==null&&nt.length===4&&De.set(nt[0]*r,nt[1]*o,nt[2]*r,nt[3]*o)}this.enabled=!1,this.getController=function(De){var nt=S[De];return nt===void 0&&(nt=new Mc,nt.matrixAutoUpdate=!1,nt.visible=!1,S[De]=nt),nt},this.getDevice=function(){return p},this.setDevice=function(De){De!==void 0&&(p=De),Ft.setContext(De)},this.setFramebufferScaleFactor=function(De){K=De},this.setReferenceSpaceType=function(De){Y=De},this.setPoseTarget=function(De){De!==void 0&&(w=De)},this.getCamera=function(De){var nt=Y==="local-floor"?1.6:0;if(p.depthNear=De.near,p.depthFar=De.far,p.getFrameData(v),Y==="local-floor"){var _t=p.stageParameters;_t?O.fromArray(_t.sittingToStandingTransform):O.makeTranslation(0,nt,0)}var Rt=v.pose,Tt=w!==null?w:De;Tt.matrix.copy(O),Tt.matrix.decompose(Tt.position,Tt.quaternion,Tt.scale),Rt.orientation!==null&&(ne.fromArray(Rt.orientation),Tt.quaternion.multiply(ne)),Rt.position!==null&&(ne.setFromRotationMatrix(O),ce.fromArray(Rt.position),ce.applyQuaternion(ne),Tt.position.add(ce)),Tt.updateMatrixWorld();for(var Ct=Tt.children,Zt=0,pn=Ct.length;Zt<pn;Zt++)Ct[Zt].updateMatrixWorld(!0);ve.near=De.near,Fe.near=De.near,ve.far=De.far,Fe.far=De.far,ve.matrixWorldInverse.fromArray(v.leftViewMatrix),Fe.matrixWorldInverse.fromArray(v.rightViewMatrix),U.getInverse(O),Y==="local-floor"&&(ve.matrixWorldInverse.multiply(U),Fe.matrixWorldInverse.multiply(U));var er=Tt.parent;er!==null&&(Z.getInverse(er.matrixWorld),ve.matrixWorldInverse.multiply(Z),Fe.matrixWorldInverse.multiply(Z)),ve.matrixWorld.getInverse(ve.matrixWorldInverse),Fe.matrixWorld.getInverse(Fe.matrixWorldInverse),ve.projectionMatrix.fromArray(v.leftProjectionMatrix),Fe.projectionMatrix.fromArray(v.rightProjectionMatrix),Im(fe,ve,Fe);var ur=p.getLayers();if(ur.length){var $n=ur[0];Dt(ve.viewport,$n.leftBounds),Dt(Fe.viewport,$n.rightBounds)}return wt(),fe},this.getStandingMatrix=function(){return O},this.isPresenting=!1;var Ft=new Hp;this.setAnimationLoop=function(De){Ft.setAnimationLoop(De),this.isPresenting&&Ft.start()},this.submitFrame=function(){this.isPresenting&&p.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",Re)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")},this.addEventListener=function(){}}Object.assign(ub.prototype,to.prototype);let $d={type:"move"};class sf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Mc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Mc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new je,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new je),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Mc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new je,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new je),this._grip}dispatchEvent(r){return this._targetRay!==null&&this._targetRay.dispatchEvent(r),this._grip!==null&&this._grip.dispatchEvent(r),this._hand!==null&&this._hand.dispatchEvent(r),this}disconnect(r){return this.dispatchEvent({type:"disconnected",data:r}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(r,o,c){let p=null,v=null,w=null,S=this._targetRay,O=this._grip,U=this._hand;if(r&&o.session.visibilityState!=="visible-blurred")if(S!==null&&(p=o.getPose(r.targetRaySpace,c),p!==null&&(S.matrix.fromArray(p.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),p.linearVelocity?(S.hasLinearVelocity=!0,S.linearVelocity.copy(p.linearVelocity)):S.hasLinearVelocity=!1,p.angularVelocity?(S.hasAngularVelocity=!0,S.angularVelocity.copy(p.angularVelocity)):S.hasAngularVelocity=!1,this.dispatchEvent($d))),U&&r.hand){w=!0;for(let ve of r.hand.values()){let Fe=o.getJointPose(ve,c);if(U.joints[ve.jointName]===void 0){let oe=new Mc;oe.matrixAutoUpdate=!1,oe.visible=!1,U.joints[ve.jointName]=oe,U.add(oe)}let fe=U.joints[ve.jointName];Fe!==null&&(fe.matrix.fromArray(Fe.transform.matrix),fe.matrix.decompose(fe.position,fe.rotation,fe.scale),fe.jointRadius=Fe.radius),fe.visible=Fe!==null}let K=U.joints["index-finger-tip"],Y=U.joints["thumb-tip"],Z=K.position.distanceTo(Y.position),ne=.02,ce=.005;U.inputState.pinching&&Z>ne+ce?(U.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:r.handedness,target:this})):!U.inputState.pinching&&Z<=ne-ce&&(U.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:r.handedness,target:this}))}else O!==null&&r.gripSpace&&(v=o.getPose(r.gripSpace,c),v!==null&&(O.matrix.fromArray(v.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),v.linearVelocity?(O.hasLinearVelocity=!0,O.linearVelocity.copy(v.linearVelocity)):O.hasLinearVelocity=!1,v.angularVelocity?(O.hasAngularVelocity=!0,O.angularVelocity.copy(v.angularVelocity)):O.hasAngularVelocity=!1));return S!==null&&(S.visible=p!==null),O!==null&&(O.visible=v!==null),U!==null&&(U.visible=w!==null),this}}class km extends Rs{constructor(r,o,c,p,v,w,S,O,U,K){if(K=K!==void 0?K:zs,K!==zs&&K!==$e)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");c===void 0&&K===zs&&(c=gi),c===void 0&&K===$e&&(c=Xi),super(null,p,v,w,S,O,K,c,U),this.image={width:r,height:o},this.magFilter=S!==void 0?S:In,this.minFilter=O!==void 0?O:In,this.flipY=!1,this.generateMipmaps=!1}}km.prototype.isDepthTexture=!0;class N1 extends to{constructor(r,o){super();let c=this,p=null,v=1;var w=null;let S=null,O="local-floor",U=r.extensions.has("WEBGL_multisampled_render_to_texture"),K=null;var Y=[];let Z=null,ne=null,ce=null,ve=!1,Fe=null,fe=o.getContextAttributes(),oe=null,Pe=null,Re=[],We=new Map,Je=new Ys;Je.layers.enable(1),Je.viewport=new Si;let dt=new Ys;dt.layers.enable(2),dt.viewport=new Si;let wt=[Je,dt],Dt=new _c;Dt.layers.enable(1),Dt.layers.enable(2);let Ft=null,De=null;this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.getCameraPose=function(){return K},this.getController=function(Jt){let kn=Re[Jt];return kn===void 0&&(kn=new sf,Re[Jt]=kn),kn.getTargetRaySpace()},this.getControllerGrip=function(Jt){let kn=Re[Jt];return kn===void 0&&(kn=new sf,Re[Jt]=kn),kn.getGripSpace()},this.getHand=function(Jt){let kn=Re[Jt];return kn===void 0&&(kn=new sf,Re[Jt]=kn),kn.getHandSpace()};function nt(Jt){let kn=We.get(Jt.inputSource);kn&&kn.dispatchEvent({type:Jt.type,data:Jt.inputSource})}function _t(){We.forEach(function(Jt,kn){Jt.disconnect(kn)}),We.clear(),Ft=null,De=null,r.setRenderTarget(oe),ce=null,ne=null,Z=null,p=null,Pe=null,$n.stop(),c.isPresenting=!1,c.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Jt){v=Jt,c.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Jt){O=Jt,c.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return S},this.getBaseLayer=function(){return ne!==null?ne:ce},this.getBinding=function(){return Z},this.getFrame=function(){return Fe},this.getSession=function(){return p},this.setSession=async function(Jt){if(p=Jt,p!==null){if(oe=r.getRenderTarget(),p.addEventListener("select",nt),p.addEventListener("selectstart",nt),p.addEventListener("selectend",nt),p.addEventListener("squeeze",nt),p.addEventListener("squeezestart",nt),p.addEventListener("squeezeend",nt),p.addEventListener("end",_t),p.addEventListener("inputsourceschange",Rt),fe.xrCompatible!==!0&&await o.makeXRCompatible(),p.renderState.layers===void 0||r.capabilities.isWebGL2===!1){let kn={antialias:p.renderState.layers===void 0?fe.antialias:!0,alpha:fe.alpha,depth:fe.depth,stencil:fe.stencil,framebufferScaleFactor:v};ce=new XRWebGLLayer(p,o,kn),p.updateRenderState({baseLayer:ce}),Pe=new Ta(ce.framebufferWidth,ce.framebufferHeight,{format:li,type:xr,encoding:r.outputEncoding})}else{ve=fe.antialias;let kn=null,wr=null,yt=null;fe.depth&&(yt=fe.stencil?o.DEPTH24_STENCIL8:o.DEPTH_COMPONENT24,kn=fe.stencil?$e:zs,wr=fe.stencil?Xi:gi);let Lr={colorFormat:r.outputEncoding===Qr?o.SRGB8_ALPHA8:o.RGBA8,depthFormat:yt,scaleFactor:v};Z=new XRWebGLBinding(p,o),ne=Z.createProjectionLayer(Lr),p.updateRenderState({layers:[ne]}),ve?Pe=new ah(ne.textureWidth,ne.textureHeight,{format:li,type:xr,depthTexture:new km(ne.textureWidth,ne.textureHeight,wr,void 0,void 0,void 0,void 0,void 0,void 0,kn),stencilBuffer:fe.stencil,ignoreDepth:ne.ignoreDepthValues,useRenderToTexture:U,encoding:r.outputEncoding}):Pe=new Ta(ne.textureWidth,ne.textureHeight,{format:li,type:xr,depthTexture:new km(ne.textureWidth,ne.textureHeight,wr,void 0,void 0,void 0,void 0,void 0,void 0,kn),stencilBuffer:fe.stencil,ignoreDepth:ne.ignoreDepthValues,encoding:r.outputEncoding})}Pe.isXRRenderTarget=!0,this.setFoveation(1),S=await p.requestReferenceSpace(O),$n.setContext(p),$n.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}},this.addLayer=function(Jt){!window.XRWebGLBinding||!this.layersEnabled||!p||(Y.push(Jt),this.updateLayers())},this.removeLayer=function(Jt){!window.XRWebGLBinding||!this.layersEnabled||!p||(Y.splice(Y.indexOf(Jt),1),this.updateLayers())},this.updateLayers=function(){var Jt=Y.map(function(kn){return kn});Jt.unshift(p.renderState.layers[0]),p.updateRenderState({layers:Jt})};function Rt(Jt){let kn=p.inputSources;for(let wr=0;wr<Re.length;wr++)We.set(kn[wr],Re[wr]);for(let wr=0;wr<Jt.removed.length;wr++){let yt=Jt.removed[wr],Lr=We.get(yt);Lr&&(Lr.dispatchEvent({type:"disconnected",data:yt}),We.delete(yt))}for(let wr=0;wr<Jt.added.length;wr++){let yt=Jt.added[wr],Lr=We.get(yt);Lr&&Lr.dispatchEvent({type:"connected",data:yt})}}let Tt=new je,Ct=new je;function Zt(Jt,kn,wr){Tt.setFromMatrixPosition(kn.matrixWorld),Ct.setFromMatrixPosition(wr.matrixWorld);let yt=Tt.distanceTo(Ct),Lr=kn.projectionMatrix.elements,jn=wr.projectionMatrix.elements,Dr=Lr[14]/(Lr[10]-1),Hn=Lr[14]/(Lr[10]+1),ei=(Lr[9]+1)/Lr[5],Br=(Lr[9]-1)/Lr[5],rn=(Lr[8]-1)/Lr[0],Nn=(jn[8]+1)/jn[0],Dn=Dr*rn,rr=Dr*Nn,Gn=yt/(-rn+Nn),Ur=Gn*-rn;kn.matrixWorld.decompose(Jt.position,Jt.quaternion,Jt.scale),Jt.translateX(Ur),Jt.translateZ(Gn),Jt.matrixWorld.compose(Jt.position,Jt.quaternion,Jt.scale),Jt.matrixWorldInverse.copy(Jt.matrixWorld).invert();let zr=Dr+Gn,fi=Hn+Gn,us=Dn-Ur,Yi=rr+(yt-Ur),it=ei*Hn/fi*zr,Ke=Br*Hn/fi*zr;Jt.projectionMatrix.makePerspective(us,Yi,it,Ke,zr,fi)}function pn(Jt,kn){kn===null?Jt.matrixWorld.copy(Jt.matrix):Jt.matrixWorld.multiplyMatrices(kn.matrixWorld,Jt.matrix),Jt.matrixWorldInverse.copy(Jt.matrixWorld).invert()}this.setPoseTarget=function(Jt){Jt!==void 0&&(w=Jt)},this.updateCamera=function(Jt){if(p===null)return;Dt.near=dt.near=Je.near=Jt.near,Dt.far=dt.far=Je.far=Jt.far,(Ft!==Dt.near||De!==Dt.far)&&(p.updateRenderState({depthNear:Dt.near,depthFar:Dt.far}),Ft=Dt.near,De=Dt.far);let kn=Dt.cameras;var wr=w||Jt;let yt=wr.parent;pn(Dt,yt);for(let jn=0;jn<kn.length;jn++)pn(kn[jn],yt);Dt.matrixWorld.decompose(Dt.position,Dt.quaternion,Dt.scale),wr.matrixWorld.copy(Dt.matrixWorld),wr.matrix.copy(Dt.matrix),wr.matrix.decompose(wr.position,wr.quaternion,wr.scale);let Lr=wr.children;for(let jn=0,Dr=Lr.length;jn<Dr;jn++)Lr[jn].updateMatrixWorld(!0);kn.length===2?Zt(Dt,Je,dt):Dt.projectionMatrix.copy(Je.projectionMatrix)},this.getCamera=function(){return Dt},this.getFoveation=function(){if(ne!==null)return ne.fixedFoveation;if(ce!==null)return ce.fixedFoveation},this.setFoveation=function(Jt){ne!==null&&(ne.fixedFoveation=Jt),ce!==null&&ce.fixedFoveation!==void 0&&(ce.fixedFoveation=Jt)};let er=null;function ur(Jt,kn){if(K=kn.getViewerPose(S),Fe=kn,K!==null){let yt=K.views;ce!==null&&(r.setRenderTargetFramebuffer(Pe,ce.framebuffer),r.setRenderTarget(Pe));let Lr=!1;yt.length!==Dt.cameras.length&&(Dt.cameras.length=0,Lr=!0);for(let jn=0;jn<yt.length;jn++){let Dr=yt[jn],Hn=null;if(ce!==null)Hn=ce.getViewport(Dr);else{let Br=Z.getViewSubImage(ne,Dr);Hn=Br.viewport,jn===0&&(r.setRenderTargetTextures(Pe,Br.colorTexture,ne.ignoreDepthValues?void 0:Br.depthStencilTexture),r.setRenderTarget(Pe))}let ei=wt[jn];ei.matrix.fromArray(Dr.transform.matrix),ei.projectionMatrix.fromArray(Dr.projectionMatrix),ei.viewport.set(Hn.x,Hn.y,Hn.width,Hn.height),jn===0&&Dt.matrix.copy(ei.matrix),Lr===!0&&Dt.cameras.push(ei)}}let wr=p.inputSources;for(let yt=0;yt<Re.length;yt++){let Lr=Re[yt],jn=wr[yt];Lr.update(jn,kn,S)}er&&er(Jt,kn),Fe=null}let $n=new Hp;$n.setAnimationLoop(ur),this.setAnimationLoop=function(Jt){er=Jt},this.dispose=function(){}}}function L1(y){function r(fe,oe){fe.fogColor.value.copy(oe.color),oe.isFog?(fe.fogNear.value=oe.near,fe.fogFar.value=oe.far):oe.isFogExp2&&(fe.fogDensity.value=oe.density)}function o(fe,oe,Pe,Re,We){oe.isMeshBasicMaterial?c(fe,oe):oe.isMeshLambertMaterial?(c(fe,oe),O(fe,oe)):oe.isMeshToonMaterial?(c(fe,oe),K(fe,oe)):oe.isMeshPhongMaterial?(c(fe,oe),U(fe,oe)):oe.isMeshStandardMaterial?(c(fe,oe),oe.isMeshPhysicalMaterial?Z(fe,oe,We):Y(fe,oe)):oe.isMeshMatcapMaterial?(c(fe,oe),ne(fe,oe)):oe.isMeshDepthMaterial?(c(fe,oe),ce(fe,oe)):oe.isMeshDistanceMaterial?(c(fe,oe),ve(fe,oe)):oe.isMeshNormalMaterial?(c(fe,oe),Fe(fe,oe)):oe.isLineBasicMaterial?(p(fe,oe),oe.isLineDashedMaterial&&v(fe,oe)):oe.isPointsMaterial?w(fe,oe,Pe,Re):oe.isSpriteMaterial?S(fe,oe):oe.isShadowMaterial?(fe.color.value.copy(oe.color),fe.opacity.value=oe.opacity):oe.isShaderMaterial&&(oe.uniformsNeedUpdate=!1)}function c(fe,oe){fe.opacity.value=oe.opacity,oe.color&&fe.diffuse.value.copy(oe.color),oe.emissive&&fe.emissive.value.copy(oe.emissive).multiplyScalar(oe.emissiveIntensity),oe.map&&(fe.map.value=oe.map),oe.alphaMap&&(fe.alphaMap.value=oe.alphaMap),oe.specularMap&&(fe.specularMap.value=oe.specularMap),oe.alphaTest>0&&(fe.alphaTest.value=oe.alphaTest);let Pe=y.get(oe).envMap;Pe&&(fe.envMap.value=Pe,fe.flipEnvMap.value=Pe.isCubeTexture&&Pe.isRenderTargetTexture===!1?-1:1,fe.reflectivity.value=oe.reflectivity,fe.ior.value=oe.ior,fe.refractionRatio.value=oe.refractionRatio),oe.lightMap&&(fe.lightMap.value=oe.lightMap,fe.lightMapIntensity.value=oe.lightMapIntensity),oe.aoMap&&(fe.aoMap.value=oe.aoMap,fe.aoMapIntensity.value=oe.aoMapIntensity);let Re;oe.map?Re=oe.map:oe.specularMap?Re=oe.specularMap:oe.displacementMap?Re=oe.displacementMap:oe.normalMap?Re=oe.normalMap:oe.bumpMap?Re=oe.bumpMap:oe.roughnessMap?Re=oe.roughnessMap:oe.metalnessMap?Re=oe.metalnessMap:oe.alphaMap?Re=oe.alphaMap:oe.emissiveMap?Re=oe.emissiveMap:oe.clearcoatMap?Re=oe.clearcoatMap:oe.clearcoatNormalMap?Re=oe.clearcoatNormalMap:oe.clearcoatRoughnessMap?Re=oe.clearcoatRoughnessMap:oe.specularIntensityMap?Re=oe.specularIntensityMap:oe.specularColorMap?Re=oe.specularColorMap:oe.transmissionMap?Re=oe.transmissionMap:oe.thicknessMap?Re=oe.thicknessMap:oe.sheenColorMap?Re=oe.sheenColorMap:oe.sheenRoughnessMap&&(Re=oe.sheenRoughnessMap),Re!==void 0&&(Re.isWebGLRenderTarget&&(Re=Re.texture),Re.matrixAutoUpdate===!0&&Re.updateMatrix(),fe.uvTransform.value.copy(Re.matrix));let We;oe.aoMap?We=oe.aoMap:oe.lightMap&&(We=oe.lightMap),We!==void 0&&(We.isWebGLRenderTarget&&(We=We.texture),We.matrixAutoUpdate===!0&&We.updateMatrix(),fe.uv2Transform.value.copy(We.matrix))}function p(fe,oe){fe.diffuse.value.copy(oe.color),fe.opacity.value=oe.opacity}function v(fe,oe){fe.dashSize.value=oe.dashSize,fe.totalSize.value=oe.dashSize+oe.gapSize,fe.scale.value=oe.scale}function w(fe,oe,Pe,Re){fe.diffuse.value.copy(oe.color),fe.opacity.value=oe.opacity,fe.size.value=oe.size*Pe,fe.scale.value=Re*.5,oe.map&&(fe.map.value=oe.map),oe.alphaMap&&(fe.alphaMap.value=oe.alphaMap),oe.alphaTest>0&&(fe.alphaTest.value=oe.alphaTest);let We;oe.map?We=oe.map:oe.alphaMap&&(We=oe.alphaMap),We!==void 0&&(We.matrixAutoUpdate===!0&&We.updateMatrix(),fe.uvTransform.value.copy(We.matrix))}function S(fe,oe){fe.diffuse.value.copy(oe.color),fe.opacity.value=oe.opacity,fe.rotation.value=oe.rotation,oe.map&&(fe.map.value=oe.map),oe.alphaMap&&(fe.alphaMap.value=oe.alphaMap),oe.alphaTest>0&&(fe.alphaTest.value=oe.alphaTest);let Pe;oe.map?Pe=oe.map:oe.alphaMap&&(Pe=oe.alphaMap),Pe!==void 0&&(Pe.matrixAutoUpdate===!0&&Pe.updateMatrix(),fe.uvTransform.value.copy(Pe.matrix))}function O(fe,oe){oe.emissiveMap&&(fe.emissiveMap.value=oe.emissiveMap)}function U(fe,oe){fe.specular.value.copy(oe.specular),fe.shininess.value=Math.max(oe.shininess,1e-4),oe.emissiveMap&&(fe.emissiveMap.value=oe.emissiveMap),oe.bumpMap&&(fe.bumpMap.value=oe.bumpMap,fe.bumpScale.value=oe.bumpScale,oe.side===B&&(fe.bumpScale.value*=-1)),oe.normalMap&&(fe.normalMap.value=oe.normalMap,fe.normalScale.value.copy(oe.normalScale),oe.side===B&&fe.normalScale.value.negate()),oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias)}function K(fe,oe){oe.gradientMap&&(fe.gradientMap.value=oe.gradientMap),oe.emissiveMap&&(fe.emissiveMap.value=oe.emissiveMap),oe.bumpMap&&(fe.bumpMap.value=oe.bumpMap,fe.bumpScale.value=oe.bumpScale,oe.side===B&&(fe.bumpScale.value*=-1)),oe.normalMap&&(fe.normalMap.value=oe.normalMap,fe.normalScale.value.copy(oe.normalScale),oe.side===B&&fe.normalScale.value.negate()),oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias)}function Y(fe,oe){fe.roughness.value=oe.roughness,fe.metalness.value=oe.metalness,oe.roughnessMap&&(fe.roughnessMap.value=oe.roughnessMap),oe.metalnessMap&&(fe.metalnessMap.value=oe.metalnessMap),oe.emissiveMap&&(fe.emissiveMap.value=oe.emissiveMap),oe.bumpMap&&(fe.bumpMap.value=oe.bumpMap,fe.bumpScale.value=oe.bumpScale,oe.side===B&&(fe.bumpScale.value*=-1)),oe.normalMap&&(fe.normalMap.value=oe.normalMap,fe.normalScale.value.copy(oe.normalScale),oe.side===B&&fe.normalScale.value.negate()),oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias),y.get(oe).envMap&&(fe.envMapIntensity.value=oe.envMapIntensity)}function Z(fe,oe,Pe){Y(fe,oe),fe.ior.value=oe.ior,oe.sheen>0&&(fe.sheenColor.value.copy(oe.sheenColor).multiplyScalar(oe.sheen),fe.sheenRoughness.value=oe.sheenRoughness,oe.sheenColorMap&&(fe.sheenColorMap.value=oe.sheenColorMap),oe.sheenRoughnessMap&&(fe.sheenRoughnessMap.value=oe.sheenRoughnessMap)),oe.clearcoat>0&&(fe.clearcoat.value=oe.clearcoat,fe.clearcoatRoughness.value=oe.clearcoatRoughness,oe.clearcoatMap&&(fe.clearcoatMap.value=oe.clearcoatMap),oe.clearcoatRoughnessMap&&(fe.clearcoatRoughnessMap.value=oe.clearcoatRoughnessMap),oe.clearcoatNormalMap&&(fe.clearcoatNormalScale.value.copy(oe.clearcoatNormalScale),fe.clearcoatNormalMap.value=oe.clearcoatNormalMap,oe.side===B&&fe.clearcoatNormalScale.value.negate())),oe.transmission>0&&(fe.transmission.value=oe.transmission,fe.transmissionSamplerMap.value=Pe.texture,fe.transmissionSamplerSize.value.set(Pe.width,Pe.height),oe.transmissionMap&&(fe.transmissionMap.value=oe.transmissionMap),fe.thickness.value=oe.thickness,oe.thicknessMap&&(fe.thicknessMap.value=oe.thicknessMap),fe.attenuationDistance.value=oe.attenuationDistance,fe.attenuationColor.value.copy(oe.attenuationColor)),fe.specularIntensity.value=oe.specularIntensity,fe.specularColor.value.copy(oe.specularColor),oe.specularIntensityMap&&(fe.specularIntensityMap.value=oe.specularIntensityMap),oe.specularColorMap&&(fe.specularColorMap.value=oe.specularColorMap)}function ne(fe,oe){oe.matcap&&(fe.matcap.value=oe.matcap),oe.bumpMap&&(fe.bumpMap.value=oe.bumpMap,fe.bumpScale.value=oe.bumpScale,oe.side===B&&(fe.bumpScale.value*=-1)),oe.normalMap&&(fe.normalMap.value=oe.normalMap,fe.normalScale.value.copy(oe.normalScale),oe.side===B&&fe.normalScale.value.negate()),oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias)}function ce(fe,oe){oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias)}function ve(fe,oe){oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias),fe.referencePosition.value.copy(oe.referencePosition),fe.nearDistance.value=oe.nearDistance,fe.farDistance.value=oe.farDistance}function Fe(fe,oe){oe.bumpMap&&(fe.bumpMap.value=oe.bumpMap,fe.bumpScale.value=oe.bumpScale,oe.side===B&&(fe.bumpScale.value*=-1)),oe.normalMap&&(fe.normalMap.value=oe.normalMap,fe.normalScale.value.copy(oe.normalScale),oe.side===B&&fe.normalScale.value.negate()),oe.displacementMap&&(fe.displacementMap.value=oe.displacementMap,fe.displacementScale.value=oe.displacementScale,fe.displacementBias.value=oe.displacementBias)}return{refreshFogUniforms:r,refreshMaterialUniforms:o}}function cb(){let y=sc("canvas");return y.style.display="block",y}function Gi(y={}){let r=y.canvas!==void 0?y.canvas:cb(),o=y.context!==void 0?y.context:null,c=y.alpha!==void 0?y.alpha:!1,p=y.depth!==void 0?y.depth:!0,v=y.stencil!==void 0?y.stencil:!0,w=y.antialias!==void 0?y.antialias:!1,S=y.premultipliedAlpha!==void 0?y.premultipliedAlpha:!0,O=y.preserveDrawingBuffer!==void 0?y.preserveDrawingBuffer:!1,U=y.powerPreference!==void 0?y.powerPreference:"default",K=y.failIfMajorPerformanceCaveat!==void 0?y.failIfMajorPerformanceCaveat:!1,Y=null,Z=null,ne=[],ce=[];this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ei,this.physicallyCorrectLights=!1,this.toneMapping=J,this.toneMappingExposure=1;let ve=this,Fe=!1,fe=0,oe=0,Pe=null,Re=-1,We=null,Je=new Si,dt=new Si,wt=null,Dt=r.width,Ft=r.height,De=1,nt=null,_t=null,Rt=new Si(0,0,Dt,Ft),Tt=new Si(0,0,Dt,Ft),Ct=!1,Zt=new Vp,pn=!1,er=!1,ur=null,$n=new Wn,Jt=new je,kn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function wr(){return Pe===null?De:1}let yt=o;function Lr(Ze,Nt){for(let Ht=0;Ht<Ze.length;Ht++){let $t=Ze[Ht],sn=r.getContext($t,Nt);if(sn!==null)return sn}return null}try{let Ze={alpha:!0,depth:p,stencil:v,antialias:w,premultipliedAlpha:S,preserveDrawingBuffer:O,powerPreference:U,failIfMajorPerformanceCaveat:K};if("setAttribute"in r&&r.setAttribute("data-engine",`three.js r${z}`),r.addEventListener("webglcontextlost",Hr,!1),r.addEventListener("webglcontextrestored",vt,!1),yt===null){let Nt=["webgl2","webgl","experimental-webgl"];if(ve.isWebGL1Renderer===!0&&Nt.shift(),yt=Lr(Nt,Ze),yt===null)throw Lr(Nt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}yt.getShaderPrecisionFormat===void 0&&(yt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ze){throw console.error("THREE.WebGLRenderer: "+Ze.message),Ze}let jn,Dr,Hn,ei,Br,rn,Nn,Dn,rr,Gn,Ur,zr,fi,us,Yi,it,Ke,an,Ln,dr,en,Er,sr;function Vn(){jn=new v0(yt),Dr=new A1(yt,jn,y),jn.init(Dr),Er=new lb(yt,jn,Dr),Hn=new k1(yt,jn,Dr),ei=new w0(yt),Br=new O0,rn=new R1(yt,jn,Hn,Br,Dr,Er,ei),Nn=new S1(ve),Dn=new y0(ve),rr=new cv(yt,Dr),sr=new wi(yt,jn,rr,Dr),Gn=new b0(yt,rr,ei,sr),Ur=new A0(yt,Gn,rr,ei),Ln=new bc(yt,Dr,rn),it=new E1(Br),zr=new ef(ve,Nn,Dn,jn,Dr,sr,it),fi=new L1(Br),us=new co,Yi=new C1(jn,Dr),an=new es(ve,Nn,Hn,Ur,c,S),Ke=new iu(ve,Ur,Dr),dr=new w1(yt,jn,ei,Dr),en=new x0(yt,jn,ei,Dr),ei.programs=zr.programs,ve.capabilities=Dr,ve.extensions=jn,ve.properties=Br,ve.renderLists=us,ve.shadowMap=Ke,ve.state=Hn,ve.info=ei}Vn();let On=typeof navigator<"u"&&"xr"in navigator?new N1(ve,yt):new ub(ve);this.xr=On,this.getContext=function(){return yt},this.getContextAttributes=function(){return yt.getContextAttributes()},this.forceContextLoss=function(){let Ze=jn.get("WEBGL_lose_context");Ze&&Ze.loseContext()},this.forceContextRestore=function(){let Ze=jn.get("WEBGL_lose_context");Ze&&Ze.restoreContext()},this.getPixelRatio=function(){return De},this.setPixelRatio=function(Ze){Ze!==void 0&&(De=Ze,this.setSize(Dt,Ft,!1))},this.getSize=function(Ze){return Ze.set(Dt,Ft)},this.setSize=function(Ze,Nt,Ht){if(On.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Dt=Ze,Ft=Nt,r.width=Math.floor(Ze*De),r.height=Math.floor(Nt*De),Ht!==!1&&(r.style.width=Ze+"px",r.style.height=Nt+"px"),this.setViewport(0,0,Ze,Nt)},this.getDrawingBufferSize=function(Ze){return Ze.set(Dt*De,Ft*De).floor()},this.setDrawingBufferSize=function(Ze,Nt,Ht){Dt=Ze,Ft=Nt,De=Ht,r.width=Math.floor(Ze*Ht),r.height=Math.floor(Nt*Ht),this.setViewport(0,0,Ze,Nt)},this.getCurrentViewport=function(Ze){return Ze.copy(Je)},this.getViewport=function(Ze){return Ze.copy(Rt)},this.setViewport=function(Ze,Nt,Ht,$t){Ze.isVector4?Rt.set(Ze.x,Ze.y,Ze.z,Ze.w):Rt.set(Ze,Nt,Ht,$t),Hn.viewport(Je.copy(Rt).multiplyScalar(De).floor())},this.getScissor=function(Ze){return Ze.copy(Tt)},this.setScissor=function(Ze,Nt,Ht,$t){Ze.isVector4?Tt.set(Ze.x,Ze.y,Ze.z,Ze.w):Tt.set(Ze,Nt,Ht,$t),Hn.scissor(dt.copy(Tt).multiplyScalar(De).floor())},this.getScissorTest=function(){return Ct},this.setScissorTest=function(Ze){Hn.setScissorTest(Ct=Ze)},this.setOpaqueSort=function(Ze){nt=Ze},this.setTransparentSort=function(Ze){_t=Ze},this.getClearColor=function(Ze){return Ze.copy(an.getClearColor())},this.setClearColor=function(){an.setClearColor.apply(an,arguments)},this.getClearAlpha=function(){return an.getClearAlpha()},this.setClearAlpha=function(){an.setClearAlpha.apply(an,arguments)},this.clear=function(Ze,Nt,Ht){let $t=0;(Ze===void 0||Ze)&&($t|=yt.COLOR_BUFFER_BIT),(Nt===void 0||Nt)&&($t|=yt.DEPTH_BUFFER_BIT),(Ht===void 0||Ht)&&($t|=yt.STENCIL_BUFFER_BIT),yt.clear($t)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",Hr,!1),r.removeEventListener("webglcontextrestored",vt,!1),us.dispose(),Yi.dispose(),Br.dispose(),Nn.dispose(),Dn.dispose(),Ur.dispose(),sr.dispose(),zr.dispose(),On.dispose(),On.removeEventListener("sessionstart",Li),On.removeEventListener("sessionend",Is),ur&&(ur.dispose(),ur=null),mo.stop()};function Hr(Ze){Ze.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Fe=!0}function vt(){console.log("THREE.WebGLRenderer: Context Restored."),Fe=!1;let Ze=ei.autoReset,Nt=Ke.enabled,Ht=Ke.autoUpdate,$t=Ke.needsUpdate,sn=Ke.type;Vn(),ei.autoReset=Ze,Ke.enabled=Nt,Ke.autoUpdate=Ht,Ke.needsUpdate=$t,Ke.type=sn}function fr(Ze){let Nt=Ze.target;Nt.removeEventListener("dispose",fr),tr(Nt)}function tr(Ze){br(Ze),Br.remove(Ze)}function br(Ze){let Nt=Br.get(Ze).programs;Nt!==void 0&&(Nt.forEach(function(Ht){zr.releaseProgram(Ht)}),Ze.isShaderMaterial&&zr.releaseShaderCache(Ze))}this.renderBufferDirect=function(Ze,Nt,Ht,$t,sn,ri){Nt===null&&(Nt=kn);let ii=sn.isMesh&&sn.matrixWorld.determinant()<0,vi=By(Ze,Nt,Ht,$t,sn);Hn.setMaterial($t,ii);let di=Ht.index,ns=Ht.attributes.position;if(di===null){if(ns===void 0||ns.count===0)return}else if(di.count===0)return;let Gr=1;$t.wireframe===!0&&(di=Gn.getWireframeAttribute(Ht),Gr=2),sr.setup(sn,$t,vi,Ht,di);let zi,Os=dr;di!==null&&(zi=rr.get(di),Os=en,Os.setIndex(zi));let Zc=di!==null?di.count:ns.count,Qh=Ht.drawRange.start*Gr,Wi=Ht.drawRange.count*Gr,kl=ri!==null?ri.start*Gr:0,ra=ri!==null?ri.count*Gr:1/0,Rl=Math.max(Qh,kl),Hf=Math.min(Zc,Qh+Wi,kl+ra)-1,Nl=Math.max(0,Hf-Rl+1);if(Nl!==0){if(sn.isMesh)$t.wireframe===!0?(Hn.setLineWidth($t.wireframeLinewidth*wr()),Os.setMode(yt.LINES)):Os.setMode(yt.TRIANGLES);else if(sn.isLine){let Ll=$t.linewidth;Ll===void 0&&(Ll=1),Hn.setLineWidth(Ll*wr()),sn.isLineSegments?Os.setMode(yt.LINES):sn.isLineLoop?Os.setMode(yt.LINE_LOOP):Os.setMode(yt.LINE_STRIP)}else sn.isPoints?Os.setMode(yt.POINTS):sn.isSprite&&Os.setMode(yt.TRIANGLES);if(sn.isInstancedMesh)Os.renderInstances(Rl,Nl,sn.count);else if(Ht.isInstancedBufferGeometry){let Ll=Math.min(Ht.instanceCount,Ht._maxInstanceCount);Os.renderInstances(Rl,Nl,Ll)}else Os.render(Rl,Nl)}},this.compile=function(Ze,Nt){Z=Yi.get(Ze),Z.init(),ce.push(Z),Ze.traverseVisible(function(Ht){Ht.isLight&&Ht.layers.test(Nt.layers)&&(Z.pushLight(Ht),Ht.castShadow&&Z.pushShadow(Ht))}),Z.setupLights(ve.physicallyCorrectLights),Ze.traverse(function(Ht){let $t=Ht.material;if($t)if(Array.isArray($t))for(let sn=0;sn<$t.length;sn++){let ri=$t[sn];xg(ri,Ze,Ht)}else xg($t,Ze,Ht)}),ce.pop(),Z=null};let cn=null;function Fr(Ze){cn&&cn(Ze)}function Li(){mo.stop()}function Is(){mo.start()}let mo=new Hp;mo.setAnimationLoop(Fr),typeof window<"u"&&mo.setContext(window),this.setAnimationLoop=function(Ze){cn=Ze,On.setAnimationLoop(Ze),Ze===null?mo.stop():mo.start()},On.addEventListener("sessionstart",Li),On.addEventListener("sessionend",Is),this.render=function(Ze,Nt){if(Nt!==void 0&&Nt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Fe===!0)return;Ze.autoUpdate===!0&&Ze.updateMatrixWorld(),Nt.parent===null&&Nt.updateMatrixWorld(),On.enabled===!0&&On.isPresenting===!0&&(On.cameraAutoUpdate===!0&&On.updateCamera(Nt),Nt=On.getCamera()),Ze.isScene===!0&&Ze.onBeforeRender(ve,Ze,Nt,Pe),Z=Yi.get(Ze,ce.length),Z.init(),ce.push(Z),$n.multiplyMatrices(Nt.projectionMatrix,Nt.matrixWorldInverse),Zt.setFromProjectionMatrix($n),er=this.localClippingEnabled,pn=it.init(this.clippingPlanes,er,Nt),Y=us.get(Ze,ne.length),Y.init(),ne.push(Y),Ps(Ze,Nt,0,ve.sortObjects),Y.finish(),ve.sortObjects===!0&&Y.sort(nt,_t),pn===!0&&it.beginShadows();let Ht=Z.state.shadowsArray;if(Ke.render(Ht,Ze,Nt),pn===!0&&it.endShadows(),this.info.autoReset===!0&&this.info.reset(),an.render(Y,Ze),Z.setupLights(ve.physicallyCorrectLights),Nt.isArrayCamera){let $t=Nt.cameras;for(let sn=0,ri=$t.length;sn<ri;sn++){let ii=$t[sn];sl(Y,Ze,ii,ii.viewport)}}else sl(Y,Ze,Nt);Pe!==null&&(rn.updateMultisampleRenderTarget(Pe),rn.updateRenderTargetMipmap(Pe)),Ze.isScene===!0&&Ze.onAfterRender(ve,Ze,Nt),Hn.buffers.depth.setTest(!0),Hn.buffers.depth.setMask(!0),Hn.buffers.color.setMask(!0),Hn.setPolygonOffset(!1),On.enabled&&On.submitFrame&&On.submitFrame(),sr.resetDefaultState(),Re=-1,We=null,ce.pop(),ce.length>0?Z=ce[ce.length-1]:Z=null,ne.pop(),ne.length>0?Y=ne[ne.length-1]:Y=null};function Ps(Ze,Nt,Ht,$t){if(Ze.visible===!1)return;if(Ze.layers.test(Nt.layers)){if(Ze.isGroup)Ht=Ze.renderOrder;else if(Ze.isLOD)Ze.autoUpdate===!0&&Ze.update(Nt);else if(Ze.isLight)Z.pushLight(Ze),Ze.castShadow&&Z.pushShadow(Ze);else if(Ze.isSprite){if(!Ze.frustumCulled||Zt.intersectsSprite(Ze)){$t&&Jt.setFromMatrixPosition(Ze.matrixWorld).applyMatrix4($n);let ii=Ur.update(Ze),vi=Ze.material;vi.visible&&Y.push(Ze,ii,vi,Ht,Jt.z,null)}}else if((Ze.isMesh||Ze.isLine||Ze.isPoints)&&(Ze.isSkinnedMesh&&Ze.skeleton.frame!==ei.render.frame&&(Ze.skeleton.update(),Ze.skeleton.frame=ei.render.frame),!Ze.frustumCulled||Zt.intersectsObject(Ze))){$t&&Jt.setFromMatrixPosition(Ze.matrixWorld).applyMatrix4($n);let ii=Ur.update(Ze),vi=Ze.material;if(Array.isArray(vi)){let di=ii.groups;for(let ns=0,Gr=di.length;ns<Gr;ns++){let zi=di[ns],Os=vi[zi.materialIndex];Os&&Os.visible&&Y.push(Ze,ii,Os,Ht,Jt.z,zi)}}else vi.visible&&Y.push(Ze,ii,vi,Ht,Jt.z,null)}}let ri=Ze.children;for(let ii=0,vi=ri.length;ii<vi;ii++)Ps(ri[ii],Nt,Ht,$t)}function sl(Ze,Nt,Ht,$t){let sn=Ze.opaque,ri=Ze.transmissive,ii=Ze.transparent;Z.setupLightsView(Ht),ri.length>0&&Fo(sn,Nt,Ht),$t&&Hn.viewport(Je.copy($t)),sn.length>0&&op(sn,Nt,Ht),ri.length>0&&op(ri,Nt,Ht),ii.length>0&&op(ii,Nt,Ht)}function Fo(Ze,Nt,Ht){if(ur===null){let ii=w===!0&&Dr.isWebGL2===!0?ah:Ta;ur=new ii(1024,1024,{generateMipmaps:!0,type:Er.convert(Vi)!==null?Vi:xr,minFilter:cr,magFilter:In,wrapS:gn,wrapT:gn,useRenderToTexture:jn.has("WEBGL_multisampled_render_to_texture")})}let $t=ve.getRenderTarget();ve.setRenderTarget(ur),ve.clear();let sn=ve.toneMapping;ve.toneMapping=J,op(Ze,Nt,Ht),ve.toneMapping=sn,rn.updateMultisampleRenderTarget(ur),rn.updateRenderTargetMipmap(ur),ve.setRenderTarget($t)}function op(Ze,Nt,Ht){let $t=Nt.isScene===!0?Nt.overrideMaterial:null;for(let sn=0,ri=Ze.length;sn<ri;sn++){let ii=Ze[sn],vi=ii.object,di=ii.geometry,ns=$t===null?ii.material:$t,Gr=ii.group;vi.layers.test(Ht.layers)&&Oy(vi,Nt,Ht,di,ns,Gr)}}function Oy(Ze,Nt,Ht,$t,sn,ri){Ze.onBeforeRender(ve,Nt,Ht,$t,sn,ri),Ze.modelViewMatrix.multiplyMatrices(Ht.matrixWorldInverse,Ze.matrixWorld),Ze.normalMatrix.getNormalMatrix(Ze.modelViewMatrix),sn.onBeforeRender(ve,Nt,Ht,$t,Ze,ri),sn.transparent===!0&&sn.side===$?(sn.side=B,sn.needsUpdate=!0,ve.renderBufferDirect(Ht,Nt,$t,sn,Ze,ri),sn.side=D,sn.needsUpdate=!0,ve.renderBufferDirect(Ht,Nt,$t,sn,Ze,ri),sn.side=$):ve.renderBufferDirect(Ht,Nt,$t,sn,Ze,ri),Ze.onAfterRender(ve,Nt,Ht,$t,sn,ri)}function xg(Ze,Nt,Ht){Nt.isScene!==!0&&(Nt=kn);let $t=Br.get(Ze),sn=Z.state.lights,ri=Z.state.shadowsArray,ii=sn.state.version,vi=zr.getParameters(Ze,sn.state,ri,Nt,Ht),di=zr.getProgramCacheKey(vi),ns=$t.programs;$t.environment=Ze.isMeshStandardMaterial?Nt.environment:null,$t.fog=Nt.fog,$t.envMap=(Ze.isMeshStandardMaterial?Dn:Nn).get(Ze.envMap||$t.environment),ns===void 0&&(Ze.addEventListener("dispose",fr),ns=new Map,$t.programs=ns);let Gr=ns.get(di);if(Gr!==void 0){if($t.currentProgram===Gr&&$t.lightsStateVersion===ii)return al(Ze,vi),Gr}else vi.uniforms=zr.getUniforms(Ze),Ze.onBuild(Ht,vi,ve),Ze.onBeforeCompile(vi,ve),Gr=zr.acquireProgram(vi,di),ns.set(di,Gr),$t.uniforms=vi.uniforms;let zi=$t.uniforms;(!Ze.isShaderMaterial&&!Ze.isRawShaderMaterial||Ze.clipping===!0)&&(zi.clippingPlanes=it.uniform),al(Ze,vi),$t.needsLights=lx(Ze),$t.lightsStateVersion=ii,$t.needsLights&&(zi.ambientLightColor.value=sn.state.ambient,zi.lightProbe.value=sn.state.probe,zi.directionalLights.value=sn.state.directional,zi.directionalLightShadows.value=sn.state.directionalShadow,zi.spotLights.value=sn.state.spot,zi.spotLightShadows.value=sn.state.spotShadow,zi.rectAreaLights.value=sn.state.rectArea,zi.ltc_1.value=sn.state.rectAreaLTC1,zi.ltc_2.value=sn.state.rectAreaLTC2,zi.pointLights.value=sn.state.point,zi.pointLightShadows.value=sn.state.pointShadow,zi.hemisphereLights.value=sn.state.hemi,zi.directionalShadowMap.value=sn.state.directionalShadowMap,zi.directionalShadowMatrix.value=sn.state.directionalShadowMatrix,zi.spotShadowMap.value=sn.state.spotShadowMap,zi.spotShadowMatrix.value=sn.state.spotShadowMatrix,zi.pointShadowMap.value=sn.state.pointShadowMap,zi.pointShadowMatrix.value=sn.state.pointShadowMatrix);let Os=Gr.getUniforms(),Zc=Ya.seqWithValue(Os.seq,zi);return $t.currentProgram=Gr,$t.uniformsList=Zc,Gr}function al(Ze,Nt){let Ht=Br.get(Ze);Ht.outputEncoding=Nt.outputEncoding,Ht.instancing=Nt.instancing,Ht.skinning=Nt.skinning,Ht.morphTargets=Nt.morphTargets,Ht.morphNormals=Nt.morphNormals,Ht.morphTargetsCount=Nt.morphTargetsCount,Ht.numClippingPlanes=Nt.numClippingPlanes,Ht.numIntersection=Nt.numClipIntersection,Ht.vertexAlphas=Nt.vertexAlphas,Ht.vertexTangents=Nt.vertexTangents,Ht.toneMapping=Nt.toneMapping}function By(Ze,Nt,Ht,$t,sn){Nt.isScene!==!0&&(Nt=kn),rn.resetTextureUnits();let ri=Nt.fog,ii=$t.isMeshStandardMaterial?Nt.environment:null,vi=Pe===null?ve.outputEncoding:Pe.isXRRenderTarget===!0?Pe.texture.encoding:Ei,di=($t.isMeshStandardMaterial?Dn:Nn).get($t.envMap||ii),ns=$t.vertexColors===!0&&!!Ht.attributes.color&&Ht.attributes.color.itemSize===4,Gr=!!$t.normalMap&&!!Ht.attributes.tangent,zi=!!Ht.morphAttributes.position,Os=!!Ht.morphAttributes.normal,Zc=Ht.morphAttributes.position?Ht.morphAttributes.position.length:0,Qh=$t.toneMapped?ve.toneMapping:J,Wi=Br.get($t),kl=Z.state.lights;if(pn===!0&&(er===!0||Ze!==We)){let ol=Ze===We&&$t.id===Re;it.setState($t,Ze,ol)}let ra=!1;$t.version===Wi.__version?(Wi.needsLights&&Wi.lightsStateVersion!==kl.state.version||Wi.outputEncoding!==vi||sn.isInstancedMesh&&Wi.instancing===!1||!sn.isInstancedMesh&&Wi.instancing===!0||sn.isSkinnedMesh&&Wi.skinning===!1||!sn.isSkinnedMesh&&Wi.skinning===!0||Wi.envMap!==di||$t.fog&&Wi.fog!==ri||Wi.numClippingPlanes!==void 0&&(Wi.numClippingPlanes!==it.numPlanes||Wi.numIntersection!==it.numIntersection)||Wi.vertexAlphas!==ns||Wi.vertexTangents!==Gr||Wi.morphTargets!==zi||Wi.morphNormals!==Os||Wi.toneMapping!==Qh||Dr.isWebGL2===!0&&Wi.morphTargetsCount!==Zc)&&(ra=!0):(ra=!0,Wi.__version=$t.version);let Rl=Wi.currentProgram;ra===!0&&(Rl=xg($t,Nt,sn));let Hf=!1,Nl=!1,Ll=!1,Ra=Rl.getUniforms(),lp=Wi.uniforms;if(Hn.useProgram(Rl.program)&&(Hf=!0,Nl=!0,Ll=!0),$t.id!==Re&&(Re=$t.id,Nl=!0),Hf||We!==Ze){if(Ra.setValue(yt,"projectionMatrix",Ze.projectionMatrix),Dr.logarithmicDepthBuffer&&Ra.setValue(yt,"logDepthBufFC",2/(Math.log(Ze.far+1)/Math.LN2)),We!==Ze&&(We=Ze,Nl=!0,Ll=!0),$t.isShaderMaterial||$t.isMeshPhongMaterial||$t.isMeshToonMaterial||$t.isMeshStandardMaterial||$t.envMap){let ol=Ra.map.cameraPosition;ol!==void 0&&ol.setValue(yt,Jt.setFromMatrixPosition(Ze.matrixWorld))}($t.isMeshPhongMaterial||$t.isMeshToonMaterial||$t.isMeshLambertMaterial||$t.isMeshBasicMaterial||$t.isMeshStandardMaterial||$t.isShaderMaterial)&&Ra.setValue(yt,"isOrthographic",Ze.isOrthographicCamera===!0),($t.isMeshPhongMaterial||$t.isMeshToonMaterial||$t.isMeshLambertMaterial||$t.isMeshBasicMaterial||$t.isMeshStandardMaterial||$t.isShaderMaterial||$t.isShadowMaterial||sn.isSkinnedMesh)&&Ra.setValue(yt,"viewMatrix",Ze.matrixWorldInverse)}if(sn.isSkinnedMesh){Ra.setOptional(yt,sn,"bindMatrix"),Ra.setOptional(yt,sn,"bindMatrixInverse");let ol=sn.skeleton;ol&&(Dr.floatVertexTextures?(ol.boneTexture===null&&ol.computeBoneTexture(),Ra.setValue(yt,"boneTexture",ol.boneTexture,rn),Ra.setValue(yt,"boneTextureSize",ol.boneTextureSize)):Ra.setOptional(yt,ol,"boneMatrices"))}return!!Ht&&(Ht.morphAttributes.position!==void 0||Ht.morphAttributes.normal!==void 0)&&Ln.update(sn,Ht,$t,Rl),(Nl||Wi.receiveShadow!==sn.receiveShadow)&&(Wi.receiveShadow=sn.receiveShadow,Ra.setValue(yt,"receiveShadow",sn.receiveShadow)),Nl&&(Ra.setValue(yt,"toneMappingExposure",ve.toneMappingExposure),Wi.needsLights&&ox(lp,Ll),ri&&$t.fog&&fi.refreshFogUniforms(lp,ri),fi.refreshMaterialUniforms(lp,$t,De,Ft,ur),Ya.upload(yt,Wi.uniformsList,lp,rn)),$t.isShaderMaterial&&$t.uniformsNeedUpdate===!0&&(Ya.upload(yt,Wi.uniformsList,lp,rn),$t.uniformsNeedUpdate=!1),$t.isSpriteMaterial&&Ra.setValue(yt,"center",sn.center),Ra.setValue(yt,"modelViewMatrix",sn.modelViewMatrix),Ra.setValue(yt,"normalMatrix",sn.normalMatrix),Ra.setValue(yt,"modelMatrix",sn.matrixWorld),Rl}function ox(Ze,Nt){Ze.ambientLightColor.needsUpdate=Nt,Ze.lightProbe.needsUpdate=Nt,Ze.directionalLights.needsUpdate=Nt,Ze.directionalLightShadows.needsUpdate=Nt,Ze.pointLights.needsUpdate=Nt,Ze.pointLightShadows.needsUpdate=Nt,Ze.spotLights.needsUpdate=Nt,Ze.spotLightShadows.needsUpdate=Nt,Ze.rectAreaLights.needsUpdate=Nt,Ze.hemisphereLights.needsUpdate=Nt}function lx(Ze){return Ze.isMeshLambertMaterial||Ze.isMeshToonMaterial||Ze.isMeshPhongMaterial||Ze.isMeshStandardMaterial||Ze.isShadowMaterial||Ze.isShaderMaterial&&Ze.lights===!0}this.setTexture2D=function(){var Ze=!1;return function(Ht,$t){Ht&&Ht.isWebGLRenderTarget&&(Ze||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Ze=!0),Ht=Ht.texture),rn.setTexture2D(Ht,$t)}}(),this.getActiveCubeFace=function(){return fe},this.getActiveMipmapLevel=function(){return oe},this.getRenderTarget=function(){return Pe},this.setRenderTargetTextures=function(Ze,Nt,Ht){Br.get(Ze.texture).__webglTexture=Nt,Br.get(Ze.depthTexture).__webglTexture=Ht;let $t=Br.get(Ze);$t.__hasExternalTextures=!0,$t.__hasExternalTextures&&($t.__autoAllocateDepthBuffer=Ht===void 0,$t.__autoAllocateDepthBuffer||Ze.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),Ze.useRenderToTexture=!1,Ze.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(Ze,Nt){let Ht=Br.get(Ze);Ht.__webglFramebuffer=Nt,Ht.__useDefaultFramebuffer=Nt===void 0},this.setRenderTarget=function(Ze,Nt=0,Ht=0){Pe=Ze,fe=Nt,oe=Ht;let $t=!0;if(Ze){let di=Br.get(Ze);di.__useDefaultFramebuffer!==void 0?(Hn.bindFramebuffer(yt.FRAMEBUFFER,null),$t=!1):di.__webglFramebuffer===void 0?rn.setupRenderTarget(Ze):di.__hasExternalTextures&&rn.rebindTextures(Ze,Br.get(Ze.texture).__webglTexture,Br.get(Ze.depthTexture).__webglTexture)}let sn=null,ri=!1,ii=!1;if(Ze){let di=Ze.texture;(di.isDataTexture3D||di.isDataTexture2DArray)&&(ii=!0);let ns=Br.get(Ze).__webglFramebuffer;Ze.isWebGLCubeRenderTarget?(sn=ns[Nt],ri=!0):Ze.useRenderbuffer?sn=Br.get(Ze).__webglMultisampledFramebuffer:sn=ns,Je.copy(Ze.viewport),dt.copy(Ze.scissor),wt=Ze.scissorTest}else Je.copy(Rt).multiplyScalar(De).floor(),dt.copy(Tt).multiplyScalar(De).floor(),wt=Ct;if(Hn.bindFramebuffer(yt.FRAMEBUFFER,sn)&&Dr.drawBuffers&&$t&&Hn.drawBuffers(Ze,sn),Hn.viewport(Je),Hn.scissor(dt),Hn.setScissorTest(wt),ri){let di=Br.get(Ze.texture);yt.framebufferTexture2D(yt.FRAMEBUFFER,yt.COLOR_ATTACHMENT0,yt.TEXTURE_CUBE_MAP_POSITIVE_X+Nt,di.__webglTexture,Ht)}else if(ii){let di=Br.get(Ze.texture),ns=Nt||0;yt.framebufferTextureLayer(yt.FRAMEBUFFER,yt.COLOR_ATTACHMENT0,di.__webglTexture,Ht||0,ns)}Re=-1},this.readRenderTargetPixels=function(Ze,Nt,Ht,$t,sn,ri,ii){if(!(Ze&&Ze.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let vi=Br.get(Ze).__webglFramebuffer;if(Ze.isWebGLCubeRenderTarget&&ii!==void 0&&(vi=vi[ii]),vi){Hn.bindFramebuffer(yt.FRAMEBUFFER,vi);try{let di=Ze.texture,ns=di.format,Gr=di.type;if(ns!==li&&Er.convert(ns)!==yt.getParameter(yt.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let zi=Gr===Vi&&(jn.has("EXT_color_buffer_half_float")||Dr.isWebGL2&&jn.has("EXT_color_buffer_float"));if(Gr!==xr&&Er.convert(Gr)!==yt.getParameter(yt.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Gr===ti&&(Dr.isWebGL2||jn.has("OES_texture_float")||jn.has("WEBGL_color_buffer_float")))&&!zi){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}yt.checkFramebufferStatus(yt.FRAMEBUFFER)===yt.FRAMEBUFFER_COMPLETE?Nt>=0&&Nt<=Ze.width-$t&&Ht>=0&&Ht<=Ze.height-sn&&yt.readPixels(Nt,Ht,$t,sn,Er.convert(ns),Er.convert(Gr),ri):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let di=Pe!==null?Br.get(Pe).__webglFramebuffer:null;Hn.bindFramebuffer(yt.FRAMEBUFFER,di)}}},this.copyFramebufferToTexture=function(Ze,Nt,Ht=0){if(Nt.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}let $t=Math.pow(2,-Ht),sn=Math.floor(Nt.image.width*$t),ri=Math.floor(Nt.image.height*$t);rn.setTexture2D(Nt,0),yt.copyTexSubImage2D(yt.TEXTURE_2D,Ht,0,0,Ze.x,Ze.y,sn,ri),Hn.unbindTexture()},this.copyTextureToTexture=function(Ze,Nt,Ht,$t=0){let sn=Nt.image.width,ri=Nt.image.height,ii=Er.convert(Ht.format),vi=Er.convert(Ht.type);rn.setTexture2D(Ht,0),yt.pixelStorei(yt.UNPACK_FLIP_Y_WEBGL,Ht.flipY),yt.pixelStorei(yt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ht.premultiplyAlpha),yt.pixelStorei(yt.UNPACK_ALIGNMENT,Ht.unpackAlignment),Nt.isDataTexture?yt.texSubImage2D(yt.TEXTURE_2D,$t,Ze.x,Ze.y,sn,ri,ii,vi,Nt.image.data):Nt.isCompressedTexture?yt.compressedTexSubImage2D(yt.TEXTURE_2D,$t,Ze.x,Ze.y,Nt.mipmaps[0].width,Nt.mipmaps[0].height,ii,Nt.mipmaps[0].data):yt.texSubImage2D(yt.TEXTURE_2D,$t,Ze.x,Ze.y,ii,vi,Nt.image),$t===0&&Ht.generateMipmaps&&yt.generateMipmap(yt.TEXTURE_2D),Hn.unbindTexture()},this.copyTextureToTexture3D=function(Ze,Nt,Ht,$t,sn=0){if(ve.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let ri=Ze.max.x-Ze.min.x+1,ii=Ze.max.y-Ze.min.y+1,vi=Ze.max.z-Ze.min.z+1,di=Er.convert($t.format),ns=Er.convert($t.type),Gr;if($t.isDataTexture3D)rn.setTexture3D($t,0),Gr=yt.TEXTURE_3D;else if($t.isDataTexture2DArray)rn.setTexture2DArray($t,0),Gr=yt.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}yt.pixelStorei(yt.UNPACK_FLIP_Y_WEBGL,$t.flipY),yt.pixelStorei(yt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$t.premultiplyAlpha),yt.pixelStorei(yt.UNPACK_ALIGNMENT,$t.unpackAlignment);let zi=yt.getParameter(yt.UNPACK_ROW_LENGTH),Os=yt.getParameter(yt.UNPACK_IMAGE_HEIGHT),Zc=yt.getParameter(yt.UNPACK_SKIP_PIXELS),Qh=yt.getParameter(yt.UNPACK_SKIP_ROWS),Wi=yt.getParameter(yt.UNPACK_SKIP_IMAGES),kl=Ht.isCompressedTexture?Ht.mipmaps[0]:Ht.image;yt.pixelStorei(yt.UNPACK_ROW_LENGTH,kl.width),yt.pixelStorei(yt.UNPACK_IMAGE_HEIGHT,kl.height),yt.pixelStorei(yt.UNPACK_SKIP_PIXELS,Ze.min.x),yt.pixelStorei(yt.UNPACK_SKIP_ROWS,Ze.min.y),yt.pixelStorei(yt.UNPACK_SKIP_IMAGES,Ze.min.z),Ht.isDataTexture||Ht.isDataTexture3D?yt.texSubImage3D(Gr,sn,Nt.x,Nt.y,Nt.z,ri,ii,vi,di,ns,kl.data):Ht.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),yt.compressedTexSubImage3D(Gr,sn,Nt.x,Nt.y,Nt.z,ri,ii,vi,di,kl.data)):yt.texSubImage3D(Gr,sn,Nt.x,Nt.y,Nt.z,ri,ii,vi,di,ns,kl),yt.pixelStorei(yt.UNPACK_ROW_LENGTH,zi),yt.pixelStorei(yt.UNPACK_IMAGE_HEIGHT,Os),yt.pixelStorei(yt.UNPACK_SKIP_PIXELS,Zc),yt.pixelStorei(yt.UNPACK_SKIP_ROWS,Qh),yt.pixelStorei(yt.UNPACK_SKIP_IMAGES,Wi),sn===0&&$t.generateMipmaps&&yt.generateMipmap(Gr),Hn.unbindTexture()},this.initTexture=function(Ze){rn.setTexture2D(Ze,0),Hn.unbindTexture()},this.resetState=function(){fe=0,oe=0,Pe=null,Hn.reset(),sr.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Gi.prototype.isWebGLRenderer=!0;class Rh extends Gi{}Rh.prototype.isWebGL1Renderer=!0;class Pu{constructor(r,o=25e-5){this.name="",this.color=new Fn(r),this.density=o}clone(){return new Pu(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Pu.prototype.isFogExp2=!0;class Nh{constructor(r,o=1,c=1e3){this.name="",this.color=new Fn(r),this.near=o,this.far=c}clone(){return new Nh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Nh.prototype.isFog=!0;class po extends bi{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,o){return super.copy(r,o),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.autoUpdate=r.autoUpdate,this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){let o=super.toJSON(r);return this.fog!==null&&(o.object.fog=this.fog.toJSON()),o}}po.prototype.isScene=!0;class su{constructor(r,o){this.array=r,this.stride=o,this.count=r!==void 0?r.length/o:0,this.usage=vu,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Da()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,o,c){r*=this.stride,c*=o.stride;for(let p=0,v=this.stride;p<v;p++)this.array[r+p]=o.array[c+p];return this}set(r,o=0){return this.array.set(r,o),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Da()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let o=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),c=new this.constructor(o,this.stride);return c.setUsage(this.usage),c}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Da()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}su.prototype.isInterleavedBuffer=!0;let Pi=new je;class Cc{constructor(r,o,c,p=!1){this.name="",this.data=r,this.itemSize=o,this.offset=c,this.normalized=p===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(r){this.data.needsUpdate=r}applyMatrix4(r){for(let o=0,c=this.data.count;o<c;o++)Pi.x=this.getX(o),Pi.y=this.getY(o),Pi.z=this.getZ(o),Pi.applyMatrix4(r),this.setXYZ(o,Pi.x,Pi.y,Pi.z);return this}applyNormalMatrix(r){for(let o=0,c=this.count;o<c;o++)Pi.x=this.getX(o),Pi.y=this.getY(o),Pi.z=this.getZ(o),Pi.applyNormalMatrix(r),this.setXYZ(o,Pi.x,Pi.y,Pi.z);return this}transformDirection(r){for(let o=0,c=this.count;o<c;o++)Pi.x=this.getX(o),Pi.y=this.getY(o),Pi.z=this.getZ(o),Pi.transformDirection(r),this.setXYZ(o,Pi.x,Pi.y,Pi.z);return this}setX(r,o){return this.data.array[r*this.data.stride+this.offset]=o,this}setY(r,o){return this.data.array[r*this.data.stride+this.offset+1]=o,this}setZ(r,o){return this.data.array[r*this.data.stride+this.offset+2]=o,this}setW(r,o){return this.data.array[r*this.data.stride+this.offset+3]=o,this}getX(r){return this.data.array[r*this.data.stride+this.offset]}getY(r){return this.data.array[r*this.data.stride+this.offset+1]}getZ(r){return this.data.array[r*this.data.stride+this.offset+2]}getW(r){return this.data.array[r*this.data.stride+this.offset+3]}setXY(r,o,c){return r=r*this.data.stride+this.offset,this.data.array[r+0]=o,this.data.array[r+1]=c,this}setXYZ(r,o,c,p){return r=r*this.data.stride+this.offset,this.data.array[r+0]=o,this.data.array[r+1]=c,this.data.array[r+2]=p,this}setXYZW(r,o,c,p,v){return r=r*this.data.stride+this.offset,this.data.array[r+0]=o,this.data.array[r+1]=c,this.data.array[r+2]=p,this.data.array[r+3]=v,this}clone(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let o=[];for(let c=0;c<this.count;c++){let p=c*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)o.push(this.data.array[p+v])}return new Ri(new this.array.constructor(o),this.itemSize,this.normalized)}else return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.clone(r)),new Cc(r.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let o=[];for(let c=0;c<this.count;c++){let p=c*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)o.push(this.data.array[p+v])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:o,normalized:this.normalized}}else return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.toJSON(r)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Cc.prototype.isInterleavedBufferAttribute=!0;class Rm extends ca{constructor(r){super(),this.type="SpriteMaterial",this.color=new Fn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this}}Rm.prototype.isSpriteMaterial=!0;let Vd,af=new je,Ou=new je,Bu=new je,Uu=new un,Lh=new un,$0=new Wn,Hd=new je,Ic=new je,Dh=new je,of=new un,lf=new un,uf=new un;class kc extends bi{constructor(r){if(super(),this.type="Sprite",Vd===void 0){Vd=new Or;let o=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),c=new su(o,5);Vd.setIndex([0,1,2,0,2,3]),Vd.setAttribute("position",new Cc(c,3,0,!1)),Vd.setAttribute("uv",new Cc(c,2,3,!1))}this.geometry=Vd,this.material=r!==void 0?r:new Rm,this.center=new un(.5,.5)}raycast(r,o){r.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ou.setFromMatrixScale(this.matrixWorld),$0.copy(r.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(r.camera.matrixWorldInverse,this.matrixWorld),Bu.setFromMatrixPosition(this.modelViewMatrix),r.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ou.multiplyScalar(-Bu.z);let c=this.material.rotation,p,v;c!==0&&(v=Math.cos(c),p=Math.sin(c));let w=this.center;Rc(Hd.set(-.5,-.5,0),Bu,w,Ou,p,v),Rc(Ic.set(.5,-.5,0),Bu,w,Ou,p,v),Rc(Dh.set(.5,.5,0),Bu,w,Ou,p,v),of.set(0,0),lf.set(1,0),uf.set(1,1);let S=r.ray.intersectTriangle(Hd,Ic,Dh,!1,af);if(S===null&&(Rc(Ic.set(-.5,.5,0),Bu,w,Ou,p,v),lf.set(0,1),S=r.ray.intersectTriangle(Hd,Dh,Ic,!1,af),S===null))return;let O=r.ray.origin.distanceTo(af);O<r.near||O>r.far||o.push({distance:O,point:af.clone(),uv:Gs.getUV(af,Hd,Ic,Dh,of,lf,uf,new un),face:null,object:this})}copy(r){return super.copy(r),r.center!==void 0&&this.center.copy(r.center),this.material=r.material,this}}kc.prototype.isSprite=!0;function Rc(y,r,o,c,p,v){Uu.subVectors(y,o).addScalar(.5).multiply(c),p!==void 0?(Lh.x=v*Uu.x-p*Uu.y,Lh.y=p*Uu.x+v*Uu.y):Lh.copy(Uu),y.copy(r),y.x+=Lh.x,y.y+=Lh.y,y.applyMatrix4($0)}let Nc=new je,Fh=new je;class cf extends bi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(r){super.copy(r,!1);let o=r.levels;for(let c=0,p=o.length;c<p;c++){let v=o[c];this.addLevel(v.object.clone(),v.distance)}return this.autoUpdate=r.autoUpdate,this}addLevel(r,o=0){o=Math.abs(o);let c=this.levels,p;for(p=0;p<c.length&&!(o<c[p].distance);p++);return c.splice(p,0,{distance:o,object:r}),this.add(r),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){let o=this.levels;if(o.length>0){let c,p;for(c=1,p=o.length;c<p&&!(r<o[c].distance);c++);return o[c-1].object}return null}raycast(r,o){if(this.levels.length>0){Nc.setFromMatrixPosition(this.matrixWorld);let p=r.ray.origin.distanceTo(Nc);this.getObjectForDistance(p).raycast(r,o)}}update(r){let o=this.levels;if(o.length>1){Nc.setFromMatrixPosition(r.matrixWorld),Fh.setFromMatrixPosition(this.matrixWorld);let c=Nc.distanceTo(Fh)/r.zoom;o[0].object.visible=!0;let p,v;for(p=1,v=o.length;p<v&&c>=o[p].distance;p++)o[p-1].object.visible=!1,o[p].object.visible=!0;for(this._currentLevel=p-1;p<v;p++)o[p].object.visible=!1}}toJSON(r){let o=super.toJSON(r);this.autoUpdate===!1&&(o.object.autoUpdate=!1),o.object.levels=[];let c=this.levels;for(let p=0,v=c.length;p<v;p++){let w=c[p];o.object.levels.push({object:w.object.uuid,distance:w.distance})}return o}}let Oa=new je,Gd=new Si,hf=new Si,au=new je,Qa=new Wn;class zu extends Ks{constructor(r,o){super(r,o),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wn,this.bindMatrixInverse=new Wn}copy(r){return super.copy(r),this.bindMode=r.bindMode,this.bindMatrix.copy(r.bindMatrix),this.bindMatrixInverse.copy(r.bindMatrixInverse),this.skeleton=r.skeleton,this}bind(r,o){this.skeleton=r,o===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),o=this.matrixWorld),this.bindMatrix.copy(o),this.bindMatrixInverse.copy(o).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let r=new Si,o=this.geometry.attributes.skinWeight;for(let c=0,p=o.count;c<p;c++){r.x=o.getX(c),r.y=o.getY(c),r.z=o.getZ(c),r.w=o.getW(c);let v=1/r.manhattanLength();v!==1/0?r.multiplyScalar(v):r.set(1,0,0,0),o.setXYZW(c,r.x,r.y,r.z,r.w)}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(r,o){let c=this.skeleton,p=this.geometry;Gd.fromBufferAttribute(p.attributes.skinIndex,r),hf.fromBufferAttribute(p.attributes.skinWeight,r),Oa.copy(o).applyMatrix4(this.bindMatrix),o.set(0,0,0);for(let v=0;v<4;v++){let w=hf.getComponent(v);if(w!==0){let S=Gd.getComponent(v);Qa.multiplyMatrices(c.bones[S].matrixWorld,c.boneInverses[S]),o.addScaledVector(au.copy(Oa).applyMatrix4(Qa),w)}}return o.applyMatrix4(this.bindMatrixInverse)}}zu.prototype.isSkinnedMesh=!0;class Wd extends bi{constructor(){super(),this.type="Bone"}}Wd.prototype.isBone=!0;class $u extends Rs{constructor(r=null,o=1,c=1,p,v,w,S,O,U=In,K=In,Y,Z){super(null,w,S,O,U,K,p,v,Y,Z),this.image={data:r,width:o,height:c},this.magFilter=U,this.minFilter=K,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}$u.prototype.isDataTexture=!0;let ga=new Wn,Ph=new Wn;class Nm{constructor(r=[],o=[]){this.uuid=Da(),this.bones=r.slice(0),this.boneInverses=o,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let r=this.bones,o=this.boneInverses;if(this.boneMatrices=new Float32Array(r.length*16),o.length===0)this.calculateInverses();else if(r.length!==o.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let c=0,p=this.bones.length;c<p;c++)this.boneInverses.push(new Wn)}}calculateInverses(){this.boneInverses.length=0;for(let r=0,o=this.bones.length;r<o;r++){let c=new Wn;this.bones[r]&&c.copy(this.bones[r].matrixWorld).invert(),this.boneInverses.push(c)}}pose(){for(let r=0,o=this.bones.length;r<o;r++){let c=this.bones[r];c&&c.matrixWorld.copy(this.boneInverses[r]).invert()}for(let r=0,o=this.bones.length;r<o;r++){let c=this.bones[r];c&&(c.parent&&c.parent.isBone?(c.matrix.copy(c.parent.matrixWorld).invert(),c.matrix.multiply(c.matrixWorld)):c.matrix.copy(c.matrixWorld),c.matrix.decompose(c.position,c.quaternion,c.scale))}}update(){let r=this.bones,o=this.boneInverses,c=this.boneMatrices,p=this.boneTexture;for(let v=0,w=r.length;v<w;v++){let S=r[v]?r[v].matrixWorld:Ph;ga.multiplyMatrices(S,o[v]),ga.toArray(c,v*16)}p!==null&&(p.needsUpdate=!0)}clone(){return new Nm(this.bones,this.boneInverses)}computeBoneTexture(){let r=Math.sqrt(this.bones.length*4);r=ud(r),r=Math.max(r,4);let o=new Float32Array(r*r*4);o.set(this.boneMatrices);let c=new $u(o,r,r,li,ti);return c.needsUpdate=!0,this.boneMatrices=o,this.boneTexture=c,this.boneTextureSize=r,this}getBoneByName(r){for(let o=0,c=this.bones.length;o<c;o++){let p=this.bones[o];if(p.name===r)return p}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,o){this.uuid=r.uuid;for(let c=0,p=r.bones.length;c<p;c++){let v=r.bones[c],w=o[v];w===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",v),w=new Wd),this.bones.push(w),this.boneInverses.push(new Wn().fromArray(r.boneInverses[c]))}return this.init(),this}toJSON(){let r={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;let o=this.bones,c=this.boneInverses;for(let p=0,v=o.length;p<v;p++){let w=o[p];r.bones.push(w.uuid);let S=c[p];r.boneInverses.push(S.toArray())}return r}}class Oh extends Ri{constructor(r,o,c,p=1){typeof c=="number"&&(p=c,c=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(r,o,c),this.meshPerAttribute=p}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}toJSON(){let r=super.toJSON();return r.meshPerAttribute=this.meshPerAttribute,r.isInstancedBufferAttribute=!0,r}}Oh.prototype.isInstancedBufferAttribute=!0;let hb=new Wn,Lm=new Wn,Bh=[],Lc=new Ks;class df extends Ks{constructor(r,o,c){super(r,o),this.instanceMatrix=new Oh(new Float32Array(c*16),16),this.instanceColor=null,this.count=c,this.frustumCulled=!1}copy(r){return super.copy(r),this.instanceMatrix.copy(r.instanceMatrix),r.instanceColor!==null&&(this.instanceColor=r.instanceColor.clone()),this.count=r.count,this}getColorAt(r,o){o.fromArray(this.instanceColor.array,r*3)}getMatrixAt(r,o){o.fromArray(this.instanceMatrix.array,r*16)}raycast(r,o){let c=this.matrixWorld,p=this.count;if(Lc.geometry=this.geometry,Lc.material=this.material,Lc.material!==void 0)for(let v=0;v<p;v++){this.getMatrixAt(v,hb),Lm.multiplyMatrices(c,hb),Lc.matrixWorld=Lm,Lc.raycast(r,Bh);for(let w=0,S=Bh.length;w<S;w++){let O=Bh[w];O.instanceId=v,O.object=this,o.push(O)}Bh.length=0}}setColorAt(r,o){this.instanceColor===null&&(this.instanceColor=new Oh(new Float32Array(this.instanceMatrix.count*3),3)),o.toArray(this.instanceColor.array,r*3)}setMatrixAt(r,o){o.toArray(this.instanceMatrix.array,r*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}df.prototype.isInstancedMesh=!0;class ts extends ca{constructor(r){super(),this.type="LineBasicMaterial",this.color=new Fn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this}}ts.prototype.isLineBasicMaterial=!0;let V0=new je,pf=new je,Dm=new Wn,H0=new Mo,ff=new xl;class Qo extends bi{constructor(r=new Or,o=new ts){super(),this.type="Line",this.geometry=r,this.material=o,this.updateMorphTargets()}copy(r){return super.copy(r),this.material=r.material,this.geometry=r.geometry,this}computeLineDistances(){let r=this.geometry;if(r.isBufferGeometry)if(r.index===null){let o=r.attributes.position,c=[0];for(let p=1,v=o.count;p<v;p++)V0.fromBufferAttribute(o,p-1),pf.fromBufferAttribute(o,p),c[p]=c[p-1],c[p]+=V0.distanceTo(pf);r.setAttribute("lineDistance",new lr(c,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else r.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(r,o){let c=this.geometry,p=this.matrixWorld,v=r.params.Line.threshold,w=c.drawRange;if(c.boundingSphere===null&&c.computeBoundingSphere(),ff.copy(c.boundingSphere),ff.applyMatrix4(p),ff.radius+=v,r.ray.intersectsSphere(ff)===!1)return;Dm.copy(p).invert(),H0.copy(r.ray).applyMatrix4(Dm);let S=v/((this.scale.x+this.scale.y+this.scale.z)/3),O=S*S,U=new je,K=new je,Y=new je,Z=new je,ne=this.isLineSegments?2:1;if(c.isBufferGeometry){let ce=c.index,Fe=c.attributes.position;if(ce!==null){let fe=Math.max(0,w.start),oe=Math.min(ce.count,w.start+w.count);for(let Pe=fe,Re=oe-1;Pe<Re;Pe+=ne){let We=ce.getX(Pe),Je=ce.getX(Pe+1);if(U.fromBufferAttribute(Fe,We),K.fromBufferAttribute(Fe,Je),H0.distanceSqToSegment(U,K,Z,Y)>O)continue;Z.applyMatrix4(this.matrixWorld);let wt=r.ray.origin.distanceTo(Z);wt<r.near||wt>r.far||o.push({distance:wt,point:Y.clone().applyMatrix4(this.matrixWorld),index:Pe,face:null,faceIndex:null,object:this})}}else{let fe=Math.max(0,w.start),oe=Math.min(Fe.count,w.start+w.count);for(let Pe=fe,Re=oe-1;Pe<Re;Pe+=ne){if(U.fromBufferAttribute(Fe,Pe),K.fromBufferAttribute(Fe,Pe+1),H0.distanceSqToSegment(U,K,Z,Y)>O)continue;Z.applyMatrix4(this.matrixWorld);let Je=r.ray.origin.distanceTo(Z);Je<r.near||Je>r.far||o.push({distance:Je,point:Y.clone().applyMatrix4(this.matrixWorld),index:Pe,face:null,faceIndex:null,object:this})}}}else c.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let r=this.geometry;if(r.isBufferGeometry){let o=r.morphAttributes,c=Object.keys(o);if(c.length>0){let p=o[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let v=0,w=p.length;v<w;v++){let S=p[v].name||String(v);this.morphTargetInfluences.push(0),this.morphTargetDictionary[S]=v}}}}else{let o=r.morphTargets;o!==void 0&&o.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Qo.prototype.isLine=!0;let db=new je,G0=new je;class Ba extends Qo{constructor(r,o){super(r,o),this.type="LineSegments"}computeLineDistances(){let r=this.geometry;if(r.isBufferGeometry)if(r.index===null){let o=r.attributes.position,c=[];for(let p=0,v=o.count;p<v;p+=2)db.fromBufferAttribute(o,p),G0.fromBufferAttribute(o,p+1),c[p]=p===0?0:c[p-1],c[p+1]=c[p]+db.distanceTo(G0);r.setAttribute("lineDistance",new lr(c,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else r.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Ba.prototype.isLineSegments=!0;class Fm extends Qo{constructor(r,o){super(r,o),this.type="LineLoop"}}Fm.prototype.isLineLoop=!0;class Dc extends ca{constructor(r){super(),this.type="PointsMaterial",this.color=new Fn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.size=r.size,this.sizeAttenuation=r.sizeAttenuation,this}}Dc.prototype.isPointsMaterial=!0;let W0=new Wn,mf=new Mo,Pm=new xl,jd=new je;class Fc extends bi{constructor(r=new Or,o=new Dc){super(),this.type="Points",this.geometry=r,this.material=o,this.updateMorphTargets()}copy(r){return super.copy(r),this.material=r.material,this.geometry=r.geometry,this}raycast(r,o){let c=this.geometry,p=this.matrixWorld,v=r.params.Points.threshold,w=c.drawRange;if(c.boundingSphere===null&&c.computeBoundingSphere(),Pm.copy(c.boundingSphere),Pm.applyMatrix4(p),Pm.radius+=v,r.ray.intersectsSphere(Pm)===!1)return;W0.copy(p).invert(),mf.copy(r.ray).applyMatrix4(W0);let S=v/((this.scale.x+this.scale.y+this.scale.z)/3),O=S*S;if(c.isBufferGeometry){let U=c.index,Y=c.attributes.position;if(U!==null){let Z=Math.max(0,w.start),ne=Math.min(U.count,w.start+w.count);for(let ce=Z,ve=ne;ce<ve;ce++){let Fe=U.getX(ce);jd.fromBufferAttribute(Y,Fe),gf(jd,Fe,O,p,r,o,this)}}else{let Z=Math.max(0,w.start),ne=Math.min(Y.count,w.start+w.count);for(let ce=Z,ve=ne;ce<ve;ce++)jd.fromBufferAttribute(Y,ce),gf(jd,ce,O,p,r,o,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let r=this.geometry;if(r.isBufferGeometry){let o=r.morphAttributes,c=Object.keys(o);if(c.length>0){let p=o[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let v=0,w=p.length;v<w;v++){let S=p[v].name||String(v);this.morphTargetInfluences.push(0),this.morphTargetDictionary[S]=v}}}}else{let o=r.morphTargets;o!==void 0&&o.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Fc.prototype.isPoints=!0;function gf(y,r,o,c,p,v,w){let S=mf.distanceSqToPoint(y);if(S<o){let O=new je;mf.closestPointToPoint(y,O),O.applyMatrix4(c);let U=p.ray.origin.distanceTo(O);if(U<p.near||U>p.far)return;v.push({distance:U,distanceToRay:Math.sqrt(S),point:O,index:r,face:null,object:w})}}class yf extends Rs{constructor(r,o,c,p,v,w,S,O,U){super(r,o,c,p,v,w,S,O,U),this.minFilter=w!==void 0?w:St,this.magFilter=v!==void 0?v:St,this.generateMipmaps=!1;let K=this;function Y(){K.needsUpdate=!0,r.requestVideoFrameCallback(Y)}"requestVideoFrameCallback"in r&&r.requestVideoFrameCallback(Y)}clone(){return new this.constructor(this.image).copy(this)}update(){let r=this.image;"requestVideoFrameCallback"in r===!1&&r.readyState>=r.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}yf.prototype.isVideoTexture=!0;class vf extends Rs{constructor(r,o,c){super({width:r,height:o}),this.format=c,this.magFilter=In,this.minFilter=In,this.generateMipmaps=!1,this.needsUpdate=!0}}vf.prototype.isFramebufferTexture=!0;class bf extends Rs{constructor(r,o,c,p,v,w,S,O,U,K,Y,Z){super(null,w,S,O,U,K,p,v,Y,Z),this.image={width:o,height:c},this.mipmaps=r,this.flipY=!1,this.generateMipmaps=!1}}bf.prototype.isCompressedTexture=!0;class j0 extends Rs{constructor(r,o,c,p,v,w,S,O,U){super(r,o,c,p,v,w,S,O,U),this.needsUpdate=!0}}j0.prototype.isCanvasTexture=!0;class Uh extends Or{constructor(r=1,o=8,c=0,p=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:o,thetaStart:c,thetaLength:p},o=Math.max(3,o);let v=[],w=[],S=[],O=[],U=new je,K=new un;w.push(0,0,0),S.push(0,0,1),O.push(.5,.5);for(let Y=0,Z=3;Y<=o;Y++,Z+=3){let ne=c+Y/o*p;U.x=r*Math.cos(ne),U.y=r*Math.sin(ne),w.push(U.x,U.y,U.z),S.push(0,0,1),K.x=(w[Z]/r+1)/2,K.y=(w[Z+1]/r+1)/2,O.push(K.x,K.y)}for(let Y=1;Y<=o;Y++)v.push(Y,Y+1,0);this.setIndex(v),this.setAttribute("position",new lr(w,3)),this.setAttribute("normal",new lr(S,3)),this.setAttribute("uv",new lr(O,2))}static fromJSON(r){return new Uh(r.radius,r.segments,r.thetaStart,r.thetaLength)}}class Vu extends Or{constructor(r=1,o=1,c=1,p=8,v=1,w=!1,S=0,O=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:r,radiusBottom:o,height:c,radialSegments:p,heightSegments:v,openEnded:w,thetaStart:S,thetaLength:O};let U=this;p=Math.floor(p),v=Math.floor(v);let K=[],Y=[],Z=[],ne=[],ce=0,ve=[],Fe=c/2,fe=0;oe(),w===!1&&(r>0&&Pe(!0),o>0&&Pe(!1)),this.setIndex(K),this.setAttribute("position",new lr(Y,3)),this.setAttribute("normal",new lr(Z,3)),this.setAttribute("uv",new lr(ne,2));function oe(){let Re=new je,We=new je,Je=0,dt=(o-r)/c;for(let wt=0;wt<=v;wt++){let Dt=[],Ft=wt/v,De=Ft*(o-r)+r;for(let nt=0;nt<=p;nt++){let _t=nt/p,Rt=_t*O+S,Tt=Math.sin(Rt),Ct=Math.cos(Rt);We.x=De*Tt,We.y=-Ft*c+Fe,We.z=De*Ct,Y.push(We.x,We.y,We.z),Re.set(Tt,dt,Ct).normalize(),Z.push(Re.x,Re.y,Re.z),ne.push(_t,1-Ft),Dt.push(ce++)}ve.push(Dt)}for(let wt=0;wt<p;wt++)for(let Dt=0;Dt<v;Dt++){let Ft=ve[Dt][wt],De=ve[Dt+1][wt],nt=ve[Dt+1][wt+1],_t=ve[Dt][wt+1];K.push(Ft,De,_t),K.push(De,nt,_t),Je+=6}U.addGroup(fe,Je,0),fe+=Je}function Pe(Re){let We=ce,Je=new un,dt=new je,wt=0,Dt=Re===!0?r:o,Ft=Re===!0?1:-1;for(let nt=1;nt<=p;nt++)Y.push(0,Fe*Ft,0),Z.push(0,Ft,0),ne.push(.5,.5),ce++;let De=ce;for(let nt=0;nt<=p;nt++){let Rt=nt/p*O+S,Tt=Math.cos(Rt),Ct=Math.sin(Rt);dt.x=Dt*Ct,dt.y=Fe*Ft,dt.z=Dt*Tt,Y.push(dt.x,dt.y,dt.z),Z.push(0,Ft,0),Je.x=Tt*.5+.5,Je.y=Ct*.5*Ft+.5,ne.push(Je.x,Je.y),ce++}for(let nt=0;nt<p;nt++){let _t=We+nt,Rt=De+nt;Re===!0?K.push(Rt,Rt+1,_t):K.push(Rt+1,Rt,_t),wt+=3}U.addGroup(fe,wt,Re===!0?1:2),fe+=wt}}static fromJSON(r){return new Vu(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Hu extends Vu{constructor(r=1,o=1,c=8,p=1,v=!1,w=0,S=Math.PI*2){super(0,r,o,c,p,v,w,S),this.type="ConeGeometry",this.parameters={radius:r,height:o,radialSegments:c,heightSegments:p,openEnded:v,thetaStart:w,thetaLength:S}}static fromJSON(r){return new Hu(r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class ou extends Or{constructor(r=[],o=[],c=1,p=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:o,radius:c,detail:p};let v=[],w=[];S(p),U(c),K(),this.setAttribute("position",new lr(v,3)),this.setAttribute("normal",new lr(v.slice(),3)),this.setAttribute("uv",new lr(w,2)),p===0?this.computeVertexNormals():this.normalizeNormals();function S(oe){let Pe=new je,Re=new je,We=new je;for(let Je=0;Je<o.length;Je+=3)ne(o[Je+0],Pe),ne(o[Je+1],Re),ne(o[Je+2],We),O(Pe,Re,We,oe)}function O(oe,Pe,Re,We){let Je=We+1,dt=[];for(let wt=0;wt<=Je;wt++){dt[wt]=[];let Dt=oe.clone().lerp(Re,wt/Je),Ft=Pe.clone().lerp(Re,wt/Je),De=Je-wt;for(let nt=0;nt<=De;nt++)nt===0&&wt===Je?dt[wt][nt]=Dt:dt[wt][nt]=Dt.clone().lerp(Ft,nt/De)}for(let wt=0;wt<Je;wt++)for(let Dt=0;Dt<2*(Je-wt)-1;Dt++){let Ft=Math.floor(Dt/2);Dt%2===0?(Z(dt[wt][Ft+1]),Z(dt[wt+1][Ft]),Z(dt[wt][Ft])):(Z(dt[wt][Ft+1]),Z(dt[wt+1][Ft+1]),Z(dt[wt+1][Ft]))}}function U(oe){let Pe=new je;for(let Re=0;Re<v.length;Re+=3)Pe.x=v[Re+0],Pe.y=v[Re+1],Pe.z=v[Re+2],Pe.normalize().multiplyScalar(oe),v[Re+0]=Pe.x,v[Re+1]=Pe.y,v[Re+2]=Pe.z}function K(){let oe=new je;for(let Pe=0;Pe<v.length;Pe+=3){oe.x=v[Pe+0],oe.y=v[Pe+1],oe.z=v[Pe+2];let Re=Fe(oe)/2/Math.PI+.5,We=fe(oe)/Math.PI+.5;w.push(Re,1-We)}ce(),Y()}function Y(){for(let oe=0;oe<w.length;oe+=6){let Pe=w[oe+0],Re=w[oe+2],We=w[oe+4],Je=Math.max(Pe,Re,We),dt=Math.min(Pe,Re,We);Je>.9&&dt<.1&&(Pe<.2&&(w[oe+0]+=1),Re<.2&&(w[oe+2]+=1),We<.2&&(w[oe+4]+=1))}}function Z(oe){v.push(oe.x,oe.y,oe.z)}function ne(oe,Pe){let Re=oe*3;Pe.x=r[Re+0],Pe.y=r[Re+1],Pe.z=r[Re+2]}function ce(){let oe=new je,Pe=new je,Re=new je,We=new je,Je=new un,dt=new un,wt=new un;for(let Dt=0,Ft=0;Dt<v.length;Dt+=9,Ft+=6){oe.set(v[Dt+0],v[Dt+1],v[Dt+2]),Pe.set(v[Dt+3],v[Dt+4],v[Dt+5]),Re.set(v[Dt+6],v[Dt+7],v[Dt+8]),Je.set(w[Ft+0],w[Ft+1]),dt.set(w[Ft+2],w[Ft+3]),wt.set(w[Ft+4],w[Ft+5]),We.copy(oe).add(Pe).add(Re).divideScalar(3);let De=Fe(We);ve(Je,Ft+0,oe,De),ve(dt,Ft+2,Pe,De),ve(wt,Ft+4,Re,De)}}function ve(oe,Pe,Re,We){We<0&&oe.x===1&&(w[Pe]=oe.x-1),Re.x===0&&Re.z===0&&(w[Pe]=We/2/Math.PI+.5)}function Fe(oe){return Math.atan2(oe.z,-oe.x)}function fe(oe){return Math.atan2(-oe.y,Math.sqrt(oe.x*oe.x+oe.z*oe.z))}}static fromJSON(r){return new ou(r.vertices,r.indices,r.radius,r.details)}}class zh extends ou{constructor(r=1,o=0){let c=(1+Math.sqrt(5))/2,p=1/c,v=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-p,-c,0,-p,c,0,p,-c,0,p,c,-p,-c,0,-p,c,0,p,-c,0,p,c,0,-c,0,-p,c,0,-p,-c,0,p,c,0,p],w=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(v,w,r,o),this.type="DodecahedronGeometry",this.parameters={radius:r,detail:o}}static fromJSON(r){return new zh(r.radius,r.detail)}}let xf=new je,Om=new je,X0=new je,Bm=new Gs;class q0 extends Or{constructor(r=null,o=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:r,thresholdAngle:o},r!==null){let p=Math.pow(10,4),v=Math.cos(ml*o),w=r.getIndex(),S=r.getAttribute("position"),O=w?w.count:S.count,U=[0,0,0],K=["a","b","c"],Y=new Array(3),Z={},ne=[];for(let ce=0;ce<O;ce+=3){w?(U[0]=w.getX(ce),U[1]=w.getX(ce+1),U[2]=w.getX(ce+2)):(U[0]=ce,U[1]=ce+1,U[2]=ce+2);let{a:ve,b:Fe,c:fe}=Bm;if(ve.fromBufferAttribute(S,U[0]),Fe.fromBufferAttribute(S,U[1]),fe.fromBufferAttribute(S,U[2]),Bm.getNormal(X0),Y[0]=`${Math.round(ve.x*p)},${Math.round(ve.y*p)},${Math.round(ve.z*p)}`,Y[1]=`${Math.round(Fe.x*p)},${Math.round(Fe.y*p)},${Math.round(Fe.z*p)}`,Y[2]=`${Math.round(fe.x*p)},${Math.round(fe.y*p)},${Math.round(fe.z*p)}`,!(Y[0]===Y[1]||Y[1]===Y[2]||Y[2]===Y[0]))for(let oe=0;oe<3;oe++){let Pe=(oe+1)%3,Re=Y[oe],We=Y[Pe],Je=Bm[K[oe]],dt=Bm[K[Pe]],wt=`${Re}_${We}`,Dt=`${We}_${Re}`;Dt in Z&&Z[Dt]?(X0.dot(Z[Dt].normal)<=v&&(ne.push(Je.x,Je.y,Je.z),ne.push(dt.x,dt.y,dt.z)),Z[Dt]=null):wt in Z||(Z[wt]={index0:U[oe],index1:U[Pe],normal:X0.clone()})}}for(let ce in Z)if(Z[ce]){let{index0:ve,index1:Fe}=Z[ce];xf.fromBufferAttribute(S,ve),Om.fromBufferAttribute(S,Fe),ne.push(xf.x,xf.y,xf.z),ne.push(Om.x,Om.y,Om.z)}this.setAttribute("position",new lr(ne,3))}}}class Ro{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,o){let c=this.getUtoTmapping(r);return this.getPoint(c,o)}getPoints(r=5){let o=[];for(let c=0;c<=r;c++)o.push(this.getPoint(c/r));return o}getSpacedPoints(r=5){let o=[];for(let c=0;c<=r;c++)o.push(this.getPointAt(c/r));return o}getLength(){let r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let o=[],c,p=this.getPoint(0),v=0;o.push(0);for(let w=1;w<=r;w++)c=this.getPoint(w/r),v+=c.distanceTo(p),o.push(v),p=c;return this.cacheArcLengths=o,o}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,o){let c=this.getLengths(),p=0,v=c.length,w;o?w=o:w=r*c[v-1];let S=0,O=v-1,U;for(;S<=O;)if(p=Math.floor(S+(O-S)/2),U=c[p]-w,U<0)S=p+1;else if(U>0)O=p-1;else{O=p;break}if(p=O,c[p]===w)return p/(v-1);let K=c[p],Z=c[p+1]-K,ne=(w-K)/Z;return(p+ne)/(v-1)}getTangent(r,o){let p=r-1e-4,v=r+1e-4;p<0&&(p=0),v>1&&(v=1);let w=this.getPoint(p),S=this.getPoint(v),O=o||(w.isVector2?new un:new je);return O.copy(S).sub(w).normalize(),O}getTangentAt(r,o){let c=this.getUtoTmapping(r);return this.getTangent(c,o)}computeFrenetFrames(r,o){let c=new je,p=[],v=[],w=[],S=new je,O=new Wn;for(let ne=0;ne<=r;ne++){let ce=ne/r;p[ne]=this.getTangentAt(ce,new je)}v[0]=new je,w[0]=new je;let U=Number.MAX_VALUE,K=Math.abs(p[0].x),Y=Math.abs(p[0].y),Z=Math.abs(p[0].z);K<=U&&(U=K,c.set(1,0,0)),Y<=U&&(U=Y,c.set(0,1,0)),Z<=U&&c.set(0,0,1),S.crossVectors(p[0],c).normalize(),v[0].crossVectors(p[0],S),w[0].crossVectors(p[0],v[0]);for(let ne=1;ne<=r;ne++){if(v[ne]=v[ne-1].clone(),w[ne]=w[ne-1].clone(),S.crossVectors(p[ne-1],p[ne]),S.length()>Number.EPSILON){S.normalize();let ce=Math.acos(Vs(p[ne-1].dot(p[ne]),-1,1));v[ne].applyMatrix4(O.makeRotationAxis(S,ce))}w[ne].crossVectors(p[ne],v[ne])}if(o===!0){let ne=Math.acos(Vs(v[0].dot(v[r]),-1,1));ne/=r,p[0].dot(S.crossVectors(v[0],v[r]))>0&&(ne=-ne);for(let ce=1;ce<=r;ce++)v[ce].applyMatrix4(O.makeRotationAxis(p[ce],ne*ce)),w[ce].crossVectors(p[ce],v[ce])}return{tangents:p,normals:v,binormals:w}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){let r={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}}class lu extends Ro{constructor(r=0,o=0,c=1,p=1,v=0,w=Math.PI*2,S=!1,O=0){super(),this.type="EllipseCurve",this.aX=r,this.aY=o,this.xRadius=c,this.yRadius=p,this.aStartAngle=v,this.aEndAngle=w,this.aClockwise=S,this.aRotation=O}getPoint(r,o){let c=o||new un,p=Math.PI*2,v=this.aEndAngle-this.aStartAngle,w=Math.abs(v)<Number.EPSILON;for(;v<0;)v+=p;for(;v>p;)v-=p;v<Number.EPSILON&&(w?v=0:v=p),this.aClockwise===!0&&!w&&(v===p?v=-p:v=v-p);let S=this.aStartAngle+r*v,O=this.aX+this.xRadius*Math.cos(S),U=this.aY+this.yRadius*Math.sin(S);if(this.aRotation!==0){let K=Math.cos(this.aRotation),Y=Math.sin(this.aRotation),Z=O-this.aX,ne=U-this.aY;O=Z*K-ne*Y+this.aX,U=Z*Y+ne*K+this.aY}return c.set(O,U)}copy(r){return super.copy(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}toJSON(){let r=super.toJSON();return r.aX=this.aX,r.aY=this.aY,r.xRadius=this.xRadius,r.yRadius=this.yRadius,r.aStartAngle=this.aStartAngle,r.aEndAngle=this.aEndAngle,r.aClockwise=this.aClockwise,r.aRotation=this.aRotation,r}fromJSON(r){return super.fromJSON(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}}lu.prototype.isEllipseCurve=!0;class K0 extends lu{constructor(r,o,c,p,v,w){super(r,o,c,c,p,v,w),this.type="ArcCurve"}}K0.prototype.isArcCurve=!0;function Y0(){let y=0,r=0,o=0,c=0;function p(v,w,S,O){y=v,r=S,o=-3*v+3*w-2*S-O,c=2*v-2*w+S+O}return{initCatmullRom:function(v,w,S,O,U){p(w,S,U*(S-v),U*(O-w))},initNonuniformCatmullRom:function(v,w,S,O,U,K,Y){let Z=(w-v)/U-(S-v)/(U+K)+(S-w)/K,ne=(S-w)/K-(O-w)/(K+Y)+(O-S)/Y;Z*=K,ne*=K,p(w,S,Z,ne)},calc:function(v){let w=v*v,S=w*v;return y+r*v+o*w+c*S}}}let Um=new je,Xd=new Y0,qd=new Y0,Kd=new Y0;class wf extends Ro{constructor(r=[],o=!1,c="centripetal",p=.5){super(),this.type="CatmullRomCurve3",this.points=r,this.closed=o,this.curveType=c,this.tension=p}getPoint(r,o=new je){let c=o,p=this.points,v=p.length,w=(v-(this.closed?0:1))*r,S=Math.floor(w),O=w-S;this.closed?S+=S>0?0:(Math.floor(Math.abs(S)/v)+1)*v:O===0&&S===v-1&&(S=v-2,O=1);let U,K;this.closed||S>0?U=p[(S-1)%v]:(Um.subVectors(p[0],p[1]).add(p[0]),U=Um);let Y=p[S%v],Z=p[(S+1)%v];if(this.closed||S+2<v?K=p[(S+2)%v]:(Um.subVectors(p[v-1],p[v-2]).add(p[v-1]),K=Um),this.curveType==="centripetal"||this.curveType==="chordal"){let ne=this.curveType==="chordal"?.5:.25,ce=Math.pow(U.distanceToSquared(Y),ne),ve=Math.pow(Y.distanceToSquared(Z),ne),Fe=Math.pow(Z.distanceToSquared(K),ne);ve<1e-4&&(ve=1),ce<1e-4&&(ce=ve),Fe<1e-4&&(Fe=ve),Xd.initNonuniformCatmullRom(U.x,Y.x,Z.x,K.x,ce,ve,Fe),qd.initNonuniformCatmullRom(U.y,Y.y,Z.y,K.y,ce,ve,Fe),Kd.initNonuniformCatmullRom(U.z,Y.z,Z.z,K.z,ce,ve,Fe)}else this.curveType==="catmullrom"&&(Xd.initCatmullRom(U.x,Y.x,Z.x,K.x,this.tension),qd.initCatmullRom(U.y,Y.y,Z.y,K.y,this.tension),Kd.initCatmullRom(U.z,Y.z,Z.z,K.z,this.tension));return c.set(Xd.calc(O),qd.calc(O),Kd.calc(O)),c}copy(r){super.copy(r),this.points=[];for(let o=0,c=r.points.length;o<c;o++){let p=r.points[o];this.points.push(p.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){let r=super.toJSON();r.points=[];for(let o=0,c=this.points.length;o<c;o++){let p=this.points[o];r.points.push(p.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let o=0,c=r.points.length;o<c;o++){let p=r.points[o];this.points.push(new je().fromArray(p))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}wf.prototype.isCatmullRomCurve3=!0;function pb(y,r,o,c,p){let v=(c-r)*.5,w=(p-o)*.5,S=y*y,O=y*S;return(2*o-2*c+v+w)*O+(-3*o+3*c-2*v-w)*S+v*y+o}function D1(y,r){let o=1-y;return o*o*r}function fb(y,r){return 2*(1-y)*y*r}function F1(y,r){return y*y*r}function Af(y,r,o,c){return D1(y,r)+fb(y,o)+F1(y,c)}function mb(y,r){let o=1-y;return o*o*o*r}function gb(y,r){let o=1-y;return 3*o*o*y*r}function P1(y,r){return 3*(1-y)*y*y*r}function O1(y,r){return y*y*y*r}function Ef(y,r,o,c,p){return mb(y,r)+gb(y,o)+P1(y,c)+O1(y,p)}class zm extends Ro{constructor(r=new un,o=new un,c=new un,p=new un){super(),this.type="CubicBezierCurve",this.v0=r,this.v1=o,this.v2=c,this.v3=p}getPoint(r,o=new un){let c=o,p=this.v0,v=this.v1,w=this.v2,S=this.v3;return c.set(Ef(r,p.x,v.x,w.x,S.x),Ef(r,p.y,v.y,w.y,S.y)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){let r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}zm.prototype.isCubicBezierCurve=!0;class $m extends Ro{constructor(r=new je,o=new je,c=new je,p=new je){super(),this.type="CubicBezierCurve3",this.v0=r,this.v1=o,this.v2=c,this.v3=p}getPoint(r,o=new je){let c=o,p=this.v0,v=this.v1,w=this.v2,S=this.v3;return c.set(Ef(r,p.x,v.x,w.x,S.x),Ef(r,p.y,v.y,w.y,S.y),Ef(r,p.z,v.z,w.z,S.z)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){let r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}$m.prototype.isCubicBezierCurve3=!0;class Sf extends Ro{constructor(r=new un,o=new un){super(),this.type="LineCurve",this.v1=r,this.v2=o}getPoint(r,o=new un){let c=o;return r===1?c.copy(this.v2):(c.copy(this.v2).sub(this.v1),c.multiplyScalar(r).add(this.v1)),c}getPointAt(r,o){return this.getPoint(r,o)}getTangent(r,o){let c=o||new un;return c.copy(this.v2).sub(this.v1).normalize(),c}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){let r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}Sf.prototype.isLineCurve=!0;class ka extends Ro{constructor(r=new je,o=new je){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=r,this.v2=o}getPoint(r,o=new je){let c=o;return r===1?c.copy(this.v2):(c.copy(this.v2).sub(this.v1),c.multiplyScalar(r).add(this.v1)),c}getPointAt(r,o){return this.getPoint(r,o)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){let r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class Zo extends Ro{constructor(r=new un,o=new un,c=new un){super(),this.type="QuadraticBezierCurve",this.v0=r,this.v1=o,this.v2=c}getPoint(r,o=new un){let c=o,p=this.v0,v=this.v1,w=this.v2;return c.set(Af(r,p.x,v.x,w.x),Af(r,p.y,v.y,w.y)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){let r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}Zo.prototype.isQuadraticBezierCurve=!0;class Vm extends Ro{constructor(r=new je,o=new je,c=new je){super(),this.type="QuadraticBezierCurve3",this.v0=r,this.v1=o,this.v2=c}getPoint(r,o=new je){let c=o,p=this.v0,v=this.v1,w=this.v2;return c.set(Af(r,p.x,v.x,w.x),Af(r,p.y,v.y,w.y),Af(r,p.z,v.z,w.z)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){let r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}Vm.prototype.isQuadraticBezierCurve3=!0;class Hm extends Ro{constructor(r=[]){super(),this.type="SplineCurve",this.points=r}getPoint(r,o=new un){let c=o,p=this.points,v=(p.length-1)*r,w=Math.floor(v),S=v-w,O=p[w===0?w:w-1],U=p[w],K=p[w>p.length-2?p.length-1:w+1],Y=p[w>p.length-3?p.length-1:w+2];return c.set(pb(S,O.x,U.x,K.x,Y.x),pb(S,O.y,U.y,K.y,Y.y)),c}copy(r){super.copy(r),this.points=[];for(let o=0,c=r.points.length;o<c;o++){let p=r.points[o];this.points.push(p.clone())}return this}toJSON(){let r=super.toJSON();r.points=[];for(let o=0,c=this.points.length;o<c;o++){let p=this.points[o];r.points.push(p.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let o=0,c=r.points.length;o<c;o++){let p=r.points[o];this.points.push(new un().fromArray(p))}return this}}Hm.prototype.isSplineCurve=!0;var Q0=Object.freeze({__proto__:null,ArcCurve:K0,CatmullRomCurve3:wf,CubicBezierCurve:zm,CubicBezierCurve3:$m,EllipseCurve:lu,LineCurve:Sf,LineCurve3:ka,QuadraticBezierCurve:Zo,QuadraticBezierCurve3:Vm,SplineCurve:Hm});class yb extends Ro{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(r){this.curves.push(r)}closePath(){let r=this.curves[0].getPoint(0),o=this.curves[this.curves.length-1].getPoint(1);r.equals(o)||this.curves.push(new Sf(o,r))}getPoint(r,o){let c=r*this.getLength(),p=this.getCurveLengths(),v=0;for(;v<p.length;){if(p[v]>=c){let w=p[v]-c,S=this.curves[v],O=S.getLength(),U=O===0?0:1-w/O;return S.getPointAt(U,o)}v++}return null}getLength(){let r=this.getCurveLengths();return r[r.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let r=[],o=0;for(let c=0,p=this.curves.length;c<p;c++)o+=this.curves[c].getLength(),r.push(o);return this.cacheLengths=r,r}getSpacedPoints(r=40){let o=[];for(let c=0;c<=r;c++)o.push(this.getPoint(c/r));return this.autoClose&&o.push(o[0]),o}getPoints(r=12){let o=[],c;for(let p=0,v=this.curves;p<v.length;p++){let w=v[p],S=w&&w.isEllipseCurve?r*2:w&&(w.isLineCurve||w.isLineCurve3)?1:w&&w.isSplineCurve?r*w.points.length:r,O=w.getPoints(S);for(let U=0;U<O.length;U++){let K=O[U];c&&c.equals(K)||(o.push(K),c=K)}}return this.autoClose&&o.length>1&&!o[o.length-1].equals(o[0])&&o.push(o[0]),o}copy(r){super.copy(r),this.curves=[];for(let o=0,c=r.curves.length;o<c;o++){let p=r.curves[o];this.curves.push(p.clone())}return this.autoClose=r.autoClose,this}toJSON(){let r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let o=0,c=this.curves.length;o<c;o++){let p=this.curves[o];r.curves.push(p.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let o=0,c=r.curves.length;o<c;o++){let p=r.curves[o];this.curves.push(new Q0[p.type]().fromJSON(p))}return this}}class Tf extends yb{constructor(r){super(),this.type="Path",this.currentPoint=new un,r&&this.setFromPoints(r)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let o=1,c=r.length;o<c;o++)this.lineTo(r[o].x,r[o].y);return this}moveTo(r,o){return this.currentPoint.set(r,o),this}lineTo(r,o){let c=new Sf(this.currentPoint.clone(),new un(r,o));return this.curves.push(c),this.currentPoint.set(r,o),this}quadraticCurveTo(r,o,c,p){let v=new Zo(this.currentPoint.clone(),new un(r,o),new un(c,p));return this.curves.push(v),this.currentPoint.set(c,p),this}bezierCurveTo(r,o,c,p,v,w){let S=new zm(this.currentPoint.clone(),new un(r,o),new un(c,p),new un(v,w));return this.curves.push(S),this.currentPoint.set(v,w),this}splineThru(r){let o=[this.currentPoint.clone()].concat(r),c=new Hm(o);return this.curves.push(c),this.currentPoint.copy(r[r.length-1]),this}arc(r,o,c,p,v,w){let S=this.currentPoint.x,O=this.currentPoint.y;return this.absarc(r+S,o+O,c,p,v,w),this}absarc(r,o,c,p,v,w){return this.absellipse(r,o,c,c,p,v,w),this}ellipse(r,o,c,p,v,w,S,O){let U=this.currentPoint.x,K=this.currentPoint.y;return this.absellipse(r+U,o+K,c,p,v,w,S,O),this}absellipse(r,o,c,p,v,w,S,O){let U=new lu(r,o,c,p,v,w,S,O);if(this.curves.length>0){let Y=U.getPoint(0);Y.equals(this.currentPoint)||this.lineTo(Y.x,Y.y)}this.curves.push(U);let K=U.getPoint(1);return this.currentPoint.copy(K),this}copy(r){return super.copy(r),this.currentPoint.copy(r.currentPoint),this}toJSON(){let r=super.toJSON();return r.currentPoint=this.currentPoint.toArray(),r}fromJSON(r){return super.fromJSON(r),this.currentPoint.fromArray(r.currentPoint),this}}class uu extends Tf{constructor(r){super(r),this.uuid=Da(),this.type="Shape",this.holes=[]}getPointsHoles(r){let o=[];for(let c=0,p=this.holes.length;c<p;c++)o[c]=this.holes[c].getPoints(r);return o}extractPoints(r){return{shape:this.getPoints(r),holes:this.getPointsHoles(r)}}copy(r){super.copy(r),this.holes=[];for(let o=0,c=r.holes.length;o<c;o++){let p=r.holes[o];this.holes.push(p.clone())}return this}toJSON(){let r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let o=0,c=this.holes.length;o<c;o++){let p=this.holes[o];r.holes.push(p.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let o=0,c=r.holes.length;o<c;o++){let p=r.holes[o];this.holes.push(new Tf().fromJSON(p))}return this}}let B1={triangulate:function(y,r,o=2){let c=r&&r.length,p=c?r[0]*o:y.length,v=vb(y,0,p,o,!0),w=[];if(!v||v.next===v.prev)return w;let S,O,U,K,Y,Z,ne;if(c&&(v=H1(y,r,v,o)),y.length>80*o){S=U=y[0],O=K=y[1];for(let ce=o;ce<p;ce+=o)Y=y[ce],Z=y[ce+1],Y<S&&(S=Y),Z<O&&(O=Z),Y>U&&(U=Y),Z>K&&(K=Z);ne=Math.max(U-S,K-O),ne=ne!==0?1/ne:0}return Mf(v,w,o,S,O,ne),w}};function vb(y,r,o,c,p){let v,w;if(p===Z0(y,r,o,c)>0)for(v=r;v<o;v+=c)w=jm(v,y[v],y[v+1],w);else for(v=o-c;v>=r;v-=c)w=jm(v,y[v],y[v+1],w);return w&&No(w,w.next)&&(Oc(w),w=w.next),w}function Pc(y,r){if(!y)return y;r||(r=y);let o=y,c;do if(c=!1,!o.steiner&&(No(o,o.next)||As(o.prev,o,o.next)===0)){if(Oc(o),o=r=o.prev,o===o.next)break;c=!0}else o=o.next;while(c||o!==r);return r}function Mf(y,r,o,c,p,v,w){if(!y)return;!w&&v&&j1(y,c,p,v);let S=y,O,U;for(;y.prev!==y.next;){if(O=y.prev,U=y.next,v?z1(y,c,p,v):U1(y)){r.push(O.i/o),r.push(y.i/o),r.push(U.i/o),Oc(y),y=U.next,S=U.next;continue}if(y=U,y===S){w?w===1?(y=$1(Pc(y),r,o),Mf(y,r,o,c,p,v,2)):w===2&&V1(y,r,o,c,p,v):Mf(Pc(y),r,o,c,p,v,1);break}}}function U1(y){let r=y.prev,o=y,c=y.next;if(As(r,o,c)>=0)return!1;let p=y.next.next;for(;p!==y.prev;){if(Qd(r.x,r.y,o.x,o.y,c.x,c.y,p.x,p.y)&&As(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function z1(y,r,o,c){let p=y.prev,v=y,w=y.next;if(As(p,v,w)>=0)return!1;let S=p.x<v.x?p.x<w.x?p.x:w.x:v.x<w.x?v.x:w.x,O=p.y<v.y?p.y<w.y?p.y:w.y:v.y<w.y?v.y:w.y,U=p.x>v.x?p.x>w.x?p.x:w.x:v.x>w.x?v.x:w.x,K=p.y>v.y?p.y>w.y?p.y:w.y:v.y>w.y?v.y:w.y,Y=Yd(S,O,r,o,c),Z=Yd(U,K,r,o,c),ne=y.prevZ,ce=y.nextZ;for(;ne&&ne.z>=Y&&ce&&ce.z<=Z;){if(ne!==y.prev&&ne!==y.next&&Qd(p.x,p.y,v.x,v.y,w.x,w.y,ne.x,ne.y)&&As(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ce!==y.prev&&ce!==y.next&&Qd(p.x,p.y,v.x,v.y,w.x,w.y,ce.x,ce.y)&&As(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;ne&&ne.z>=Y;){if(ne!==y.prev&&ne!==y.next&&Qd(p.x,p.y,v.x,v.y,w.x,w.y,ne.x,ne.y)&&As(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ce&&ce.z<=Z;){if(ce!==y.prev&&ce!==y.next&&Qd(p.x,p.y,v.x,v.y,w.x,w.y,ce.x,ce.y)&&As(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function $1(y,r,o){let c=y;do{let p=c.prev,v=c.next.next;!No(p,v)&&Gm(p,c,c.next,v)&&Gu(p,v)&&Gu(v,p)&&(r.push(p.i/o),r.push(c.i/o),r.push(v.i/o),Oc(c),Oc(c.next),c=y=v),c=c.next}while(c!==y);return Pc(c)}function V1(y,r,o,c,p,v){let w=y;do{let S=w.next.next;for(;S!==w.prev;){if(w.i!==S.i&&xb(w,S)){let O=Wm(w,S);w=Pc(w,w.next),O=Pc(O,O.next),Mf(w,r,o,c,p,v),Mf(O,r,o,c,p,v);return}S=S.next}w=w.next}while(w!==y)}function H1(y,r,o,c){let p=[],v,w,S,O,U;for(v=0,w=r.length;v<w;v++)S=r[v]*c,O=v<w-1?r[v+1]*c:y.length,U=vb(y,S,O,c,!1),U===U.next&&(U.steiner=!0),p.push($h(U));for(p.sort(G1),v=0;v<p.length;v++)W1(p[v],o),o=Pc(o,o.next);return o}function G1(y,r){return y.x-r.x}function W1(y,r){if(r=Jo(y,r),r){let o=Wm(r,y);Pc(r,r.next),Pc(o,o.next)}}function Jo(y,r){let o=r,c=y.x,p=y.y,v=-1/0,w;do{if(p<=o.y&&p>=o.next.y&&o.next.y!==o.y){let Z=o.x+(p-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(Z<=c&&Z>v){if(v=Z,Z===c){if(p===o.y)return o;if(p===o.next.y)return o.next}w=o.x<o.next.x?o:o.next}}o=o.next}while(o!==r);if(!w)return null;if(c===v)return w;let S=w,O=w.x,U=w.y,K=1/0,Y;o=w;do c>=o.x&&o.x>=O&&c!==o.x&&Qd(p<U?c:v,p,O,U,p<U?v:c,p,o.x,o.y)&&(Y=Math.abs(p-o.y)/(c-o.x),Gu(o,y)&&(Y<K||Y===K&&(o.x>w.x||o.x===w.x&&bb(w,o)))&&(w=o,K=Y)),o=o.next;while(o!==S);return w}function bb(y,r){return As(y.prev,y,r.prev)<0&&As(r.next,y,y.next)<0}function j1(y,r,o,c){let p=y;do p.z===null&&(p.z=Yd(p.x,p.y,r,o,c)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==y);p.prevZ.nextZ=null,p.prevZ=null,_f(p)}function _f(y){let r,o,c,p,v,w,S,O,U=1;do{for(o=y,y=null,v=null,w=0;o;){for(w++,c=o,S=0,r=0;r<U&&(S++,c=c.nextZ,!!c);r++);for(O=U;S>0||O>0&&c;)S!==0&&(O===0||!c||o.z<=c.z)?(p=o,o=o.nextZ,S--):(p=c,c=c.nextZ,O--),v?v.nextZ=p:y=p,p.prevZ=v,v=p;o=c}v.nextZ=null,U*=2}while(w>1);return y}function Yd(y,r,o,c,p){return y=32767*(y-o)*p,r=32767*(r-c)*p,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,y|r<<1}function $h(y){let r=y,o=y;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==y);return o}function Qd(y,r,o,c,p,v,w,S){return(p-w)*(r-S)-(y-w)*(v-S)>=0&&(y-w)*(c-S)-(o-w)*(r-S)>=0&&(o-w)*(v-S)-(p-w)*(c-S)>=0}function xb(y,r){return y.next.i!==r.i&&y.prev.i!==r.i&&!Cf(y,r)&&(Gu(y,r)&&Gu(r,y)&&If(y,r)&&(As(y.prev,y,r.prev)||As(y,r.prev,r))||No(y,r)&&As(y.prev,y,y.next)>0&&As(r.prev,r,r.next)>0)}function As(y,r,o){return(r.y-y.y)*(o.x-r.x)-(r.x-y.x)*(o.y-r.y)}function No(y,r){return y.x===r.x&&y.y===r.y}function Gm(y,r,o,c){let p=Zd(As(y,r,o)),v=Zd(As(y,r,c)),w=Zd(As(o,c,y)),S=Zd(As(o,c,r));return!!(p!==v&&w!==S||p===0&&Vh(y,o,r)||v===0&&Vh(y,c,r)||w===0&&Vh(o,y,c)||S===0&&Vh(o,r,c))}function Vh(y,r,o){return r.x<=Math.max(y.x,o.x)&&r.x>=Math.min(y.x,o.x)&&r.y<=Math.max(y.y,o.y)&&r.y>=Math.min(y.y,o.y)}function Zd(y){return y>0?1:y<0?-1:0}function Cf(y,r){let o=y;do{if(o.i!==y.i&&o.next.i!==y.i&&o.i!==r.i&&o.next.i!==r.i&&Gm(o,o.next,y,r))return!0;o=o.next}while(o!==y);return!1}function Gu(y,r){return As(y.prev,y,y.next)<0?As(y,r,y.next)>=0&&As(y,y.prev,r)>=0:As(y,r,y.prev)<0||As(y,y.next,r)<0}function If(y,r){let o=y,c=!1,p=(y.x+r.x)/2,v=(y.y+r.y)/2;do o.y>v!=o.next.y>v&&o.next.y!==o.y&&p<(o.next.x-o.x)*(v-o.y)/(o.next.y-o.y)+o.x&&(c=!c),o=o.next;while(o!==y);return c}function Wm(y,r){let o=new Jd(y.i,y.x,y.y),c=new Jd(r.i,r.x,r.y),p=y.next,v=r.prev;return y.next=r,r.prev=y,o.next=p,p.prev=o,c.next=o,o.prev=c,v.next=c,c.prev=v,c}function jm(y,r,o,c){let p=new Jd(y,r,o);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Oc(y){y.next.prev=y.prev,y.prev.next=y.next,y.prevZ&&(y.prevZ.nextZ=y.nextZ),y.nextZ&&(y.nextZ.prevZ=y.prevZ)}function Jd(y,r,o){this.i=y,this.x=r,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Z0(y,r,o,c){let p=0;for(let v=r,w=o-c;v<o;v+=c)p+=(y[w]-y[v])*(y[v+1]+y[w+1]),w=v;return p}class el{static area(r){let o=r.length,c=0;for(let p=o-1,v=0;v<o;p=v++)c+=r[p].x*r[v].y-r[v].x*r[p].y;return c*.5}static isClockWise(r){return el.area(r)<0}static triangulateShape(r,o){let c=[],p=[],v=[];Xm(r),qm(c,r);let w=r.length;o.forEach(Xm);for(let O=0;O<o.length;O++)p.push(w),w+=o[O].length,qm(c,o[O]);let S=B1.triangulate(c,p);for(let O=0;O<S.length;O+=3)v.push(S.slice(O,O+3));return v}}function Xm(y){let r=y.length;r>2&&y[r-1].equals(y[0])&&y.pop()}function qm(y,r){for(let o=0;o<r.length;o++)y.push(r[o].x),y.push(r[o].y)}class tl extends Or{constructor(r=new uu([new un(.5,.5),new un(-.5,.5),new un(-.5,-.5),new un(.5,-.5)]),o={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:o},r=Array.isArray(r)?r:[r];let c=this,p=[],v=[];for(let S=0,O=r.length;S<O;S++){let U=r[S];w(U)}this.setAttribute("position",new lr(p,3)),this.setAttribute("uv",new lr(v,2)),this.computeVertexNormals();function w(S){let O=[],U=o.curveSegments!==void 0?o.curveSegments:12,K=o.steps!==void 0?o.steps:1,Y=o.depth!==void 0?o.depth:1,Z=o.bevelEnabled!==void 0?o.bevelEnabled:!0,ne=o.bevelThickness!==void 0?o.bevelThickness:.2,ce=o.bevelSize!==void 0?o.bevelSize:ne-.1,ve=o.bevelOffset!==void 0?o.bevelOffset:0,Fe=o.bevelSegments!==void 0?o.bevelSegments:3,fe=o.extrudePath,oe=o.UVGenerator!==void 0?o.UVGenerator:J0;o.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),Y=o.amount);let Pe,Re=!1,We,Je,dt,wt;fe&&(Pe=fe.getSpacedPoints(K),Re=!0,Z=!1,We=fe.computeFrenetFrames(K,!1),Je=new je,dt=new je,wt=new je),Z||(Fe=0,ne=0,ce=0,ve=0);let Dt=S.extractPoints(U),Ft=Dt.shape,De=Dt.holes;if(!el.isClockWise(Ft)){Ft=Ft.reverse();for(let rn=0,Nn=De.length;rn<Nn;rn++){let Dn=De[rn];el.isClockWise(Dn)&&(De[rn]=Dn.reverse())}}let _t=el.triangulateShape(Ft,De),Rt=Ft;for(let rn=0,Nn=De.length;rn<Nn;rn++){let Dn=De[rn];Ft=Ft.concat(Dn)}function Tt(rn,Nn,Dn){return Nn||console.error("THREE.ExtrudeGeometry: vec does not exist"),Nn.clone().multiplyScalar(Dn).add(rn)}let Ct=Ft.length,Zt=_t.length;function pn(rn,Nn,Dn){let rr,Gn,Ur,zr=rn.x-Nn.x,fi=rn.y-Nn.y,us=Dn.x-rn.x,Yi=Dn.y-rn.y,it=zr*zr+fi*fi,Ke=zr*Yi-fi*us;if(Math.abs(Ke)>Number.EPSILON){let an=Math.sqrt(it),Ln=Math.sqrt(us*us+Yi*Yi),dr=Nn.x-fi/an,en=Nn.y+zr/an,Er=Dn.x-Yi/Ln,sr=Dn.y+us/Ln,Vn=((Er-dr)*Yi-(sr-en)*us)/(zr*Yi-fi*us);rr=dr+zr*Vn-rn.x,Gn=en+fi*Vn-rn.y;let On=rr*rr+Gn*Gn;if(On<=2)return new un(rr,Gn);Ur=Math.sqrt(On/2)}else{let an=!1;zr>Number.EPSILON?us>Number.EPSILON&&(an=!0):zr<-Number.EPSILON?us<-Number.EPSILON&&(an=!0):Math.sign(fi)===Math.sign(Yi)&&(an=!0),an?(rr=-fi,Gn=zr,Ur=Math.sqrt(it)):(rr=zr,Gn=fi,Ur=Math.sqrt(it/2))}return new un(rr/Ur,Gn/Ur)}let er=[];for(let rn=0,Nn=Rt.length,Dn=Nn-1,rr=rn+1;rn<Nn;rn++,Dn++,rr++)Dn===Nn&&(Dn=0),rr===Nn&&(rr=0),er[rn]=pn(Rt[rn],Rt[Dn],Rt[rr]);let ur=[],$n,Jt=er.concat();for(let rn=0,Nn=De.length;rn<Nn;rn++){let Dn=De[rn];$n=[];for(let rr=0,Gn=Dn.length,Ur=Gn-1,zr=rr+1;rr<Gn;rr++,Ur++,zr++)Ur===Gn&&(Ur=0),zr===Gn&&(zr=0),$n[rr]=pn(Dn[rr],Dn[Ur],Dn[zr]);ur.push($n),Jt=Jt.concat($n)}for(let rn=0;rn<Fe;rn++){let Nn=rn/Fe,Dn=ne*Math.cos(Nn*Math.PI/2),rr=ce*Math.sin(Nn*Math.PI/2)+ve;for(let Gn=0,Ur=Rt.length;Gn<Ur;Gn++){let zr=Tt(Rt[Gn],er[Gn],rr);jn(zr.x,zr.y,-Dn)}for(let Gn=0,Ur=De.length;Gn<Ur;Gn++){let zr=De[Gn];$n=ur[Gn];for(let fi=0,us=zr.length;fi<us;fi++){let Yi=Tt(zr[fi],$n[fi],rr);jn(Yi.x,Yi.y,-Dn)}}}let kn=ce+ve;for(let rn=0;rn<Ct;rn++){let Nn=Z?Tt(Ft[rn],Jt[rn],kn):Ft[rn];Re?(dt.copy(We.normals[0]).multiplyScalar(Nn.x),Je.copy(We.binormals[0]).multiplyScalar(Nn.y),wt.copy(Pe[0]).add(dt).add(Je),jn(wt.x,wt.y,wt.z)):jn(Nn.x,Nn.y,0)}for(let rn=1;rn<=K;rn++)for(let Nn=0;Nn<Ct;Nn++){let Dn=Z?Tt(Ft[Nn],Jt[Nn],kn):Ft[Nn];Re?(dt.copy(We.normals[rn]).multiplyScalar(Dn.x),Je.copy(We.binormals[rn]).multiplyScalar(Dn.y),wt.copy(Pe[rn]).add(dt).add(Je),jn(wt.x,wt.y,wt.z)):jn(Dn.x,Dn.y,Y/K*rn)}for(let rn=Fe-1;rn>=0;rn--){let Nn=rn/Fe,Dn=ne*Math.cos(Nn*Math.PI/2),rr=ce*Math.sin(Nn*Math.PI/2)+ve;for(let Gn=0,Ur=Rt.length;Gn<Ur;Gn++){let zr=Tt(Rt[Gn],er[Gn],rr);jn(zr.x,zr.y,Y+Dn)}for(let Gn=0,Ur=De.length;Gn<Ur;Gn++){let zr=De[Gn];$n=ur[Gn];for(let fi=0,us=zr.length;fi<us;fi++){let Yi=Tt(zr[fi],$n[fi],rr);Re?jn(Yi.x,Yi.y+Pe[K-1].y,Pe[K-1].x+Dn):jn(Yi.x,Yi.y,Y+Dn)}}}wr(),yt();function wr(){let rn=p.length/3;if(Z){let Nn=0,Dn=Ct*Nn;for(let rr=0;rr<Zt;rr++){let Gn=_t[rr];Dr(Gn[2]+Dn,Gn[1]+Dn,Gn[0]+Dn)}Nn=K+Fe*2,Dn=Ct*Nn;for(let rr=0;rr<Zt;rr++){let Gn=_t[rr];Dr(Gn[0]+Dn,Gn[1]+Dn,Gn[2]+Dn)}}else{for(let Nn=0;Nn<Zt;Nn++){let Dn=_t[Nn];Dr(Dn[2],Dn[1],Dn[0])}for(let Nn=0;Nn<Zt;Nn++){let Dn=_t[Nn];Dr(Dn[0]+Ct*K,Dn[1]+Ct*K,Dn[2]+Ct*K)}}c.addGroup(rn,p.length/3-rn,0)}function yt(){let rn=p.length/3,Nn=0;Lr(Rt,Nn),Nn+=Rt.length;for(let Dn=0,rr=De.length;Dn<rr;Dn++){let Gn=De[Dn];Lr(Gn,Nn),Nn+=Gn.length}c.addGroup(rn,p.length/3-rn,1)}function Lr(rn,Nn){let Dn=rn.length;for(;--Dn>=0;){let rr=Dn,Gn=Dn-1;Gn<0&&(Gn=rn.length-1);for(let Ur=0,zr=K+Fe*2;Ur<zr;Ur++){let fi=Ct*Ur,us=Ct*(Ur+1),Yi=Nn+rr+fi,it=Nn+Gn+fi,Ke=Nn+Gn+us,an=Nn+rr+us;Hn(Yi,it,Ke,an)}}}function jn(rn,Nn,Dn){O.push(rn),O.push(Nn),O.push(Dn)}function Dr(rn,Nn,Dn){ei(rn),ei(Nn),ei(Dn);let rr=p.length/3,Gn=oe.generateTopUV(c,p,rr-3,rr-2,rr-1);Br(Gn[0]),Br(Gn[1]),Br(Gn[2])}function Hn(rn,Nn,Dn,rr){ei(rn),ei(Nn),ei(rr),ei(Nn),ei(Dn),ei(rr);let Gn=p.length/3,Ur=oe.generateSideWallUV(c,p,Gn-6,Gn-3,Gn-2,Gn-1);Br(Ur[0]),Br(Ur[1]),Br(Ur[3]),Br(Ur[1]),Br(Ur[2]),Br(Ur[3])}function ei(rn){p.push(O[rn*3+0]),p.push(O[rn*3+1]),p.push(O[rn*3+2])}function Br(rn){v.push(rn.x),v.push(rn.y)}}}toJSON(){let r=super.toJSON(),o=this.parameters.shapes,c=this.parameters.options;return Wu(o,c,r)}static fromJSON(r,o){let c=[];for(let v=0,w=r.shapes.length;v<w;v++){let S=o[r.shapes[v]];c.push(S)}let p=r.options.extrudePath;return p!==void 0&&(r.options.extrudePath=new Q0[p.type]().fromJSON(p)),new tl(c,r.options)}}let J0={generateTopUV:function(y,r,o,c,p){let v=r[o*3],w=r[o*3+1],S=r[c*3],O=r[c*3+1],U=r[p*3],K=r[p*3+1];return[new un(v,w),new un(S,O),new un(U,K)]},generateSideWallUV:function(y,r,o,c,p,v){let w=r[o*3],S=r[o*3+1],O=r[o*3+2],U=r[c*3],K=r[c*3+1],Y=r[c*3+2],Z=r[p*3],ne=r[p*3+1],ce=r[p*3+2],ve=r[v*3],Fe=r[v*3+1],fe=r[v*3+2];return Math.abs(S-K)<Math.abs(w-U)?[new un(w,1-O),new un(U,1-Y),new un(Z,1-ce),new un(ve,1-fe)]:[new un(S,1-O),new un(K,1-Y),new un(ne,1-ce),new un(Fe,1-fe)]}};function Wu(y,r,o){if(o.shapes=[],Array.isArray(y))for(let c=0,p=y.length;c<p;c++){let v=y[c];o.shapes.push(v.uuid)}else o.shapes.push(y.uuid);return r.extrudePath!==void 0&&(o.options.extrudePath=r.extrudePath.toJSON()),o}class Hh extends ou{constructor(r=1,o=0){let c=(1+Math.sqrt(5))/2,p=[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],v=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(p,v,r,o),this.type="IcosahedronGeometry",this.parameters={radius:r,detail:o}}static fromJSON(r){return new Hh(r.radius,r.detail)}}class Gh extends Or{constructor(r=[new un(0,.5),new un(.5,0),new un(0,-.5)],o=12,c=0,p=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:r,segments:o,phiStart:c,phiLength:p},o=Math.floor(o),p=Vs(p,0,Math.PI*2);let v=[],w=[],S=[],O=[],U=[],K=1/o,Y=new je,Z=new un,ne=new je,ce=new je,ve=new je,Fe=0,fe=0;for(let oe=0;oe<=r.length-1;oe++)switch(oe){case 0:Fe=r[oe+1].x-r[oe].x,fe=r[oe+1].y-r[oe].y,ne.x=fe*1,ne.y=-Fe,ne.z=fe*0,ve.copy(ne),ne.normalize(),O.push(ne.x,ne.y,ne.z);break;case r.length-1:O.push(ve.x,ve.y,ve.z);break;default:Fe=r[oe+1].x-r[oe].x,fe=r[oe+1].y-r[oe].y,ne.x=fe*1,ne.y=-Fe,ne.z=fe*0,ce.copy(ne),ne.x+=ve.x,ne.y+=ve.y,ne.z+=ve.z,ne.normalize(),O.push(ne.x,ne.y,ne.z),ve.copy(ce)}for(let oe=0;oe<=o;oe++){let Pe=c+oe*K*p,Re=Math.sin(Pe),We=Math.cos(Pe);for(let Je=0;Je<=r.length-1;Je++){Y.x=r[Je].x*Re,Y.y=r[Je].y,Y.z=r[Je].x*We,w.push(Y.x,Y.y,Y.z),Z.x=oe/o,Z.y=Je/(r.length-1),S.push(Z.x,Z.y);let dt=O[3*Je+0]*Re,wt=O[3*Je+1],Dt=O[3*Je+0]*We;U.push(dt,wt,Dt)}}for(let oe=0;oe<o;oe++)for(let Pe=0;Pe<r.length-1;Pe++){let Re=Pe+oe*r.length,We=Re,Je=Re+r.length,dt=Re+r.length+1,wt=Re+1;v.push(We,Je,wt),v.push(dt,wt,Je)}this.setIndex(v),this.setAttribute("position",new lr(w,3)),this.setAttribute("uv",new lr(S,2)),this.setAttribute("normal",new lr(U,3))}static fromJSON(r){return new Gh(r.points,r.segments,r.phiStart,r.phiLength)}}class Bc extends ou{constructor(r=1,o=0){let c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],p=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(c,p,r,o),this.type="OctahedronGeometry",this.parameters={radius:r,detail:o}}static fromJSON(r){return new Bc(r.radius,r.detail)}}class Uc extends Or{constructor(r=.5,o=1,c=8,p=1,v=0,w=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:r,outerRadius:o,thetaSegments:c,phiSegments:p,thetaStart:v,thetaLength:w},c=Math.max(3,c),p=Math.max(1,p);let S=[],O=[],U=[],K=[],Y=r,Z=(o-r)/p,ne=new je,ce=new un;for(let ve=0;ve<=p;ve++){for(let Fe=0;Fe<=c;Fe++){let fe=v+Fe/c*w;ne.x=Y*Math.cos(fe),ne.y=Y*Math.sin(fe),O.push(ne.x,ne.y,ne.z),U.push(0,0,1),ce.x=(ne.x/o+1)/2,ce.y=(ne.y/o+1)/2,K.push(ce.x,ce.y)}Y+=Z}for(let ve=0;ve<p;ve++){let Fe=ve*(c+1);for(let fe=0;fe<c;fe++){let oe=fe+Fe,Pe=oe,Re=oe+c+1,We=oe+c+2,Je=oe+1;S.push(Pe,Re,Je),S.push(Re,We,Je)}}this.setIndex(S),this.setAttribute("position",new lr(O,3)),this.setAttribute("normal",new lr(U,3)),this.setAttribute("uv",new lr(K,2))}static fromJSON(r){return new Uc(r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength)}}class zc extends Or{constructor(r=new uu([new un(0,.5),new un(-.5,-.5),new un(.5,-.5)]),o=12){super(),this.type="ShapeGeometry",this.parameters={shapes:r,curveSegments:o};let c=[],p=[],v=[],w=[],S=0,O=0;if(Array.isArray(r)===!1)U(r);else for(let K=0;K<r.length;K++)U(r[K]),this.addGroup(S,O,K),S+=O,O=0;this.setIndex(c),this.setAttribute("position",new lr(p,3)),this.setAttribute("normal",new lr(v,3)),this.setAttribute("uv",new lr(w,2));function U(K){let Y=p.length/3,Z=K.extractPoints(o),ne=Z.shape,ce=Z.holes;el.isClockWise(ne)===!1&&(ne=ne.reverse());for(let Fe=0,fe=ce.length;Fe<fe;Fe++){let oe=ce[Fe];el.isClockWise(oe)===!0&&(ce[Fe]=oe.reverse())}let ve=el.triangulateShape(ne,ce);for(let Fe=0,fe=ce.length;Fe<fe;Fe++){let oe=ce[Fe];ne=ne.concat(oe)}for(let Fe=0,fe=ne.length;Fe<fe;Fe++){let oe=ne[Fe];p.push(oe.x,oe.y,0),v.push(0,0,1),w.push(oe.x,oe.y)}for(let Fe=0,fe=ve.length;Fe<fe;Fe++){let oe=ve[Fe],Pe=oe[0]+Y,Re=oe[1]+Y,We=oe[2]+Y;c.push(Pe,Re,We),O+=3}}}toJSON(){let r=super.toJSON(),o=this.parameters.shapes;return wb(o,r)}static fromJSON(r,o){let c=[];for(let p=0,v=r.shapes.length;p<v;p++){let w=o[r.shapes[p]];c.push(w)}return new zc(c,r.curveSegments)}}function wb(y,r){if(r.shapes=[],Array.isArray(y))for(let o=0,c=y.length;o<c;o++){let p=y[o];r.shapes.push(p.uuid)}else r.shapes.push(y.uuid);return r}class $c extends Or{constructor(r=1,o=32,c=16,p=0,v=Math.PI*2,w=0,S=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:o,heightSegments:c,phiStart:p,phiLength:v,thetaStart:w,thetaLength:S},o=Math.max(3,Math.floor(o)),c=Math.max(2,Math.floor(c));let O=Math.min(w+S,Math.PI),U=0,K=[],Y=new je,Z=new je,ne=[],ce=[],ve=[],Fe=[];for(let fe=0;fe<=c;fe++){let oe=[],Pe=fe/c,Re=0;fe==0&&w==0?Re=.5/o:fe==c&&O==Math.PI&&(Re=-.5/o);for(let We=0;We<=o;We++){let Je=We/o;Y.x=-r*Math.cos(p+Je*v)*Math.sin(w+Pe*S),Y.y=r*Math.cos(w+Pe*S),Y.z=r*Math.sin(p+Je*v)*Math.sin(w+Pe*S),ce.push(Y.x,Y.y,Y.z),Z.copy(Y).normalize(),ve.push(Z.x,Z.y,Z.z),Fe.push(Je+Re,1-Pe),oe.push(U++)}K.push(oe)}for(let fe=0;fe<c;fe++)for(let oe=0;oe<o;oe++){let Pe=K[fe][oe+1],Re=K[fe][oe],We=K[fe+1][oe],Je=K[fe+1][oe+1];(fe!==0||w>0)&&ne.push(Pe,Re,Je),(fe!==c-1||O<Math.PI)&&ne.push(Re,We,Je)}this.setIndex(ne),this.setAttribute("position",new lr(ce,3)),this.setAttribute("normal",new lr(ve,3)),this.setAttribute("uv",new lr(Fe,2))}static fromJSON(r){return new $c(r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength)}}class ep extends ou{constructor(r=1,o=0){let c=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],p=[2,1,0,0,3,2,1,3,0,2,3,1];super(c,p,r,o),this.type="TetrahedronGeometry",this.parameters={radius:r,detail:o}}static fromJSON(r){return new ep(r.radius,r.detail)}}class Vc extends Or{constructor(r=1,o=.4,c=8,p=6,v=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:o,radialSegments:c,tubularSegments:p,arc:v},c=Math.floor(c),p=Math.floor(p);let w=[],S=[],O=[],U=[],K=new je,Y=new je,Z=new je;for(let ne=0;ne<=c;ne++)for(let ce=0;ce<=p;ce++){let ve=ce/p*v,Fe=ne/c*Math.PI*2;Y.x=(r+o*Math.cos(Fe))*Math.cos(ve),Y.y=(r+o*Math.cos(Fe))*Math.sin(ve),Y.z=o*Math.sin(Fe),S.push(Y.x,Y.y,Y.z),K.x=r*Math.cos(ve),K.y=r*Math.sin(ve),Z.subVectors(Y,K).normalize(),O.push(Z.x,Z.y,Z.z),U.push(ce/p),U.push(ne/c)}for(let ne=1;ne<=c;ne++)for(let ce=1;ce<=p;ce++){let ve=(p+1)*ne+ce-1,Fe=(p+1)*(ne-1)+ce-1,fe=(p+1)*(ne-1)+ce,oe=(p+1)*ne+ce;w.push(ve,Fe,oe),w.push(Fe,fe,oe)}this.setIndex(w),this.setAttribute("position",new lr(S,3)),this.setAttribute("normal",new lr(O,3)),this.setAttribute("uv",new lr(U,2))}static fromJSON(r){return new Vc(r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc)}}class Hc extends Or{constructor(r=1,o=.4,c=64,p=8,v=2,w=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:r,tube:o,tubularSegments:c,radialSegments:p,p:v,q:w},c=Math.floor(c),p=Math.floor(p);let S=[],O=[],U=[],K=[],Y=new je,Z=new je,ne=new je,ce=new je,ve=new je,Fe=new je,fe=new je;for(let Pe=0;Pe<=c;++Pe){let Re=Pe/c*v*Math.PI*2;oe(Re,v,w,r,ne),oe(Re+.01,v,w,r,ce),Fe.subVectors(ce,ne),fe.addVectors(ce,ne),ve.crossVectors(Fe,fe),fe.crossVectors(ve,Fe),ve.normalize(),fe.normalize();for(let We=0;We<=p;++We){let Je=We/p*Math.PI*2,dt=-o*Math.cos(Je),wt=o*Math.sin(Je);Y.x=ne.x+(dt*fe.x+wt*ve.x),Y.y=ne.y+(dt*fe.y+wt*ve.y),Y.z=ne.z+(dt*fe.z+wt*ve.z),O.push(Y.x,Y.y,Y.z),Z.subVectors(Y,ne).normalize(),U.push(Z.x,Z.y,Z.z),K.push(Pe/c),K.push(We/p)}}for(let Pe=1;Pe<=c;Pe++)for(let Re=1;Re<=p;Re++){let We=(p+1)*(Pe-1)+(Re-1),Je=(p+1)*Pe+(Re-1),dt=(p+1)*Pe+Re,wt=(p+1)*(Pe-1)+Re;S.push(We,Je,wt),S.push(Je,dt,wt)}this.setIndex(S),this.setAttribute("position",new lr(O,3)),this.setAttribute("normal",new lr(U,3)),this.setAttribute("uv",new lr(K,2));function oe(Pe,Re,We,Je,dt){let wt=Math.cos(Pe),Dt=Math.sin(Pe),Ft=We/Re*Pe,De=Math.cos(Ft);dt.x=Je*(2+De)*.5*wt,dt.y=Je*(2+De)*Dt*.5,dt.z=Je*Math.sin(Ft)*.5}}static fromJSON(r){return new Hc(r.radius,r.tube,r.tubularSegments,r.radialSegments,r.p,r.q)}}class Gc extends Or{constructor(r=new Vm(new je(-1,-1,0),new je(-1,1,0),new je(1,1,0)),o=64,c=1,p=8,v=!1){super(),this.type="TubeGeometry",this.parameters={path:r,tubularSegments:o,radius:c,radialSegments:p,closed:v};let w=r.computeFrenetFrames(o,v);this.tangents=w.tangents,this.normals=w.normals,this.binormals=w.binormals;let S=new je,O=new je,U=new un,K=new je,Y=[],Z=[],ne=[],ce=[];ve(),this.setIndex(ce),this.setAttribute("position",new lr(Y,3)),this.setAttribute("normal",new lr(Z,3)),this.setAttribute("uv",new lr(ne,2));function ve(){for(let Pe=0;Pe<o;Pe++)Fe(Pe);Fe(v===!1?o:0),oe(),fe()}function Fe(Pe){K=r.getPointAt(Pe/o,K);let Re=w.normals[Pe],We=w.binormals[Pe];for(let Je=0;Je<=p;Je++){let dt=Je/p*Math.PI*2,wt=Math.sin(dt),Dt=-Math.cos(dt);O.x=Dt*Re.x+wt*We.x,O.y=Dt*Re.y+wt*We.y,O.z=Dt*Re.z+wt*We.z,O.normalize(),Z.push(O.x,O.y,O.z),S.x=K.x+c*O.x,S.y=K.y+c*O.y,S.z=K.z+c*O.z,Y.push(S.x,S.y,S.z)}}function fe(){for(let Pe=1;Pe<=o;Pe++)for(let Re=1;Re<=p;Re++){let We=(p+1)*(Pe-1)+(Re-1),Je=(p+1)*Pe+(Re-1),dt=(p+1)*Pe+Re,wt=(p+1)*(Pe-1)+Re;ce.push(We,Je,wt),ce.push(Je,dt,wt)}}function oe(){for(let Pe=0;Pe<=o;Pe++)for(let Re=0;Re<=p;Re++)U.x=Pe/o,U.y=Re/p,ne.push(U.x,U.y)}}toJSON(){let r=super.toJSON();return r.path=this.parameters.path.toJSON(),r}static fromJSON(r){return new Gc(new Q0[r.path.type]().fromJSON(r.path),r.tubularSegments,r.radius,r.radialSegments,r.closed)}}class kf extends Or{constructor(r=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:r},r!==null){let o=[],c=new Set,p=new je,v=new je;if(r.index!==null){let w=r.attributes.position,S=r.index,O=r.groups;O.length===0&&(O=[{start:0,count:S.count,materialIndex:0}]);for(let U=0,K=O.length;U<K;++U){let Y=O[U],Z=Y.start,ne=Y.count;for(let ce=Z,ve=Z+ne;ce<ve;ce+=3)for(let Fe=0;Fe<3;Fe++){let fe=S.getX(ce+Fe),oe=S.getX(ce+(Fe+1)%3);p.fromBufferAttribute(w,fe),v.fromBufferAttribute(w,oe),Km(p,v,c)===!0&&(o.push(p.x,p.y,p.z),o.push(v.x,v.y,v.z))}}}else{let w=r.attributes.position;for(let S=0,O=w.count/3;S<O;S++)for(let U=0;U<3;U++){let K=3*S+U,Y=3*S+(U+1)%3;p.fromBufferAttribute(w,K),v.fromBufferAttribute(w,Y),Km(p,v,c)===!0&&(o.push(p.x,p.y,p.z),o.push(v.x,v.y,v.z))}}this.setAttribute("position",new lr(o,3))}}}function Km(y,r,o){let c=`${y.x},${y.y},${y.z}-${r.x},${r.y},${r.z}`,p=`${r.x},${r.y},${r.z}-${y.x},${y.y},${y.z}`;return o.has(c)===!0||o.has(p)===!0?!1:(o.add(c,p),!0)}var Ab=Object.freeze({__proto__:null,BoxGeometry:st,BoxBufferGeometry:st,CircleGeometry:Uh,CircleBufferGeometry:Uh,ConeGeometry:Hu,ConeBufferGeometry:Hu,CylinderGeometry:Vu,CylinderBufferGeometry:Vu,DodecahedronGeometry:zh,DodecahedronBufferGeometry:zh,EdgesGeometry:q0,ExtrudeGeometry:tl,ExtrudeBufferGeometry:tl,IcosahedronGeometry:Hh,IcosahedronBufferGeometry:Hh,LatheGeometry:Gh,LatheBufferGeometry:Gh,OctahedronGeometry:Bc,OctahedronBufferGeometry:Bc,PlaneGeometry:eu,PlaneBufferGeometry:eu,PolyhedronGeometry:ou,PolyhedronBufferGeometry:ou,RingGeometry:Uc,RingBufferGeometry:Uc,ShapeGeometry:zc,ShapeBufferGeometry:zc,SphereGeometry:$c,SphereBufferGeometry:$c,TetrahedronGeometry:ep,TetrahedronBufferGeometry:ep,TorusGeometry:Vc,TorusBufferGeometry:Vc,TorusKnotGeometry:Hc,TorusKnotBufferGeometry:Hc,TubeGeometry:Gc,TubeBufferGeometry:Gc,WireframeGeometry:kf});class Rf extends ca{constructor(r){super(),this.type="ShadowMaterial",this.color=new Fn(0),this.transparent=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this}}Rf.prototype.isShadowMaterial=!0;class Nf extends ca{constructor(r){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Fn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bs,this.normalScale=new un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.defines={STANDARD:""},this.color.copy(r.color),this.roughness=r.roughness,this.metalness=r.metalness,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.roughnessMap=r.roughnessMap,this.metalnessMap=r.metalnessMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapIntensity=r.envMapIntensity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this}}Nf.prototype.isMeshStandardMaterial=!0;class Ym extends Nf{constructor(r){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new un(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Vs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(o){this.ior=(1+.4*o)/(1-.4*o)}}),this.sheenColor=new Fn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Fn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Fn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(r)}get sheen(){return this._sheen}set sheen(r){this._sheen>0!=r>0&&this.version++,this._sheen=r}get clearcoat(){return this._clearcoat}set clearcoat(r){this._clearcoat>0!=r>0&&this.version++,this._clearcoat=r}get transmission(){return this._transmission}set transmission(r){this._transmission>0!=r>0&&this.version++,this._transmission=r}copy(r){return super.copy(r),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=r.clearcoat,this.clearcoatMap=r.clearcoatMap,this.clearcoatRoughness=r.clearcoatRoughness,this.clearcoatRoughnessMap=r.clearcoatRoughnessMap,this.clearcoatNormalMap=r.clearcoatNormalMap,this.clearcoatNormalScale.copy(r.clearcoatNormalScale),this.ior=r.ior,this.sheen=r.sheen,this.sheenColor.copy(r.sheenColor),this.sheenColorMap=r.sheenColorMap,this.sheenRoughness=r.sheenRoughness,this.sheenRoughnessMap=r.sheenRoughnessMap,this.transmission=r.transmission,this.transmissionMap=r.transmissionMap,this.thickness=r.thickness,this.thicknessMap=r.thicknessMap,this.attenuationDistance=r.attenuationDistance,this.attenuationColor.copy(r.attenuationColor),this.specularIntensity=r.specularIntensity,this.specularIntensityMap=r.specularIntensityMap,this.specularColor.copy(r.specularColor),this.specularColorMap=r.specularColorMap,this}}Ym.prototype.isMeshPhysicalMaterial=!0;class Qm extends ca{constructor(r){super(),this.type="MeshPhongMaterial",this.color=new Fn(16777215),this.specular=new Fn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bs,this.normalScale=new un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ss,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this}}Qm.prototype.isMeshPhongMaterial=!0;class Zm extends ca{constructor(r){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Fn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bs,this.normalScale=new un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.gradientMap=r.gradientMap,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this}}Zm.prototype.isMeshToonMaterial=!0;class Jm extends ca{constructor(r){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bs,this.normalScale=new un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.flatShading=r.flatShading,this}}Jm.prototype.isMeshNormalMaterial=!0;class ey extends ca{constructor(r){super(),this.type="MeshLambertMaterial",this.color=new Fn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ss,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this}}ey.prototype.isMeshLambertMaterial=!0;class eg extends ca{constructor(r){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Fn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bs,this.normalScale=new un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.defines={MATCAP:""},this.color.copy(r.color),this.matcap=r.matcap,this.map=r.map,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.flatShading=r.flatShading,this}}eg.prototype.isMeshMatcapMaterial=!0;class tg extends ts{constructor(r){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(r)}copy(r){return super.copy(r),this.scale=r.scale,this.dashSize=r.dashSize,this.gapSize=r.gapSize,this}}tg.prototype.isLineDashedMaterial=!0;var X1=Object.freeze({__proto__:null,ShadowMaterial:Rf,SpriteMaterial:Rm,RawShaderMaterial:ja,ShaderMaterial:da,PointsMaterial:Dc,MeshPhysicalMaterial:Ym,MeshStandardMaterial:Nf,MeshPhongMaterial:Qm,MeshToonMaterial:Zm,MeshNormalMaterial:Jm,MeshLambertMaterial:ey,MeshDepthMaterial:rf,MeshDistanceMaterial:ru,MeshBasicMaterial:os,MeshMatcapMaterial:eg,LineDashedMaterial:tg,LineBasicMaterial:ts,Material:ca});let Es={arraySlice:function(y,r,o){return Es.isTypedArray(y)?new y.constructor(y.subarray(r,o!==void 0?o:y.length)):y.slice(r,o)},convertArray:function(y,r,o){return!y||!o&&y.constructor===r?y:typeof r.BYTES_PER_ELEMENT=="number"?new r(y):Array.prototype.slice.call(y)},isTypedArray:function(y){return ArrayBuffer.isView(y)&&!(y instanceof DataView)},getKeyframeOrder:function(y){function r(p,v){return y[p]-y[v]}let o=y.length,c=new Array(o);for(let p=0;p!==o;++p)c[p]=p;return c.sort(r),c},sortedArray:function(y,r,o){let c=y.length,p=new y.constructor(c);for(let v=0,w=0;w!==c;++v){let S=o[v]*r;for(let O=0;O!==r;++O)p[w++]=y[S+O]}return p},flattenJSON:function(y,r,o,c){let p=1,v=y[0];for(;v!==void 0&&v[c]===void 0;)v=y[p++];if(v===void 0)return;let w=v[c];if(w!==void 0)if(Array.isArray(w))do w=v[c],w!==void 0&&(r.push(v.time),o.push.apply(o,w)),v=y[p++];while(v!==void 0);else if(w.toArray!==void 0)do w=v[c],w!==void 0&&(r.push(v.time),w.toArray(o,o.length)),v=y[p++];while(v!==void 0);else do w=v[c],w!==void 0&&(r.push(v.time),o.push(w)),v=y[p++];while(v!==void 0)},subclip:function(y,r,o,c,p=30){let v=y.clone();v.name=r;let w=[];for(let O=0;O<v.tracks.length;++O){let U=v.tracks[O],K=U.getValueSize(),Y=[],Z=[];for(let ne=0;ne<U.times.length;++ne){let ce=U.times[ne]*p;if(!(ce<o||ce>=c)){Y.push(U.times[ne]);for(let ve=0;ve<K;++ve)Z.push(U.values[ne*K+ve])}}Y.length!==0&&(U.times=Es.convertArray(Y,U.times.constructor),U.values=Es.convertArray(Z,U.values.constructor),w.push(U))}v.tracks=w;let S=1/0;for(let O=0;O<v.tracks.length;++O)S>v.tracks[O].times[0]&&(S=v.tracks[O].times[0]);for(let O=0;O<v.tracks.length;++O)v.tracks[O].shift(-1*S);return v.resetDuration(),v},makeClipAdditive:function(y,r=0,o=y,c=30){c<=0&&(c=30);let p=o.tracks.length,v=r/c;for(let w=0;w<p;++w){let S=o.tracks[w],O=S.ValueTypeName;if(O==="bool"||O==="string")continue;let U=y.tracks.find(function(fe){return fe.name===S.name&&fe.ValueTypeName===O});if(U===void 0)continue;let K=0,Y=S.getValueSize();S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(K=Y/3);let Z=0,ne=U.getValueSize();U.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Z=ne/3);let ce=S.times.length-1,ve;if(v<=S.times[0]){let fe=K,oe=Y-K;ve=Es.arraySlice(S.values,fe,oe)}else if(v>=S.times[ce]){let fe=ce*Y+K,oe=fe+Y-K;ve=Es.arraySlice(S.values,fe,oe)}else{let fe=S.createInterpolant(),oe=K,Pe=Y-K;fe.evaluate(v),ve=Es.arraySlice(fe.resultBuffer,oe,Pe)}O==="quaternion"&&new Hs().fromArray(ve).normalize().conjugate().toArray(ve);let Fe=U.times.length;for(let fe=0;fe<Fe;++fe){let oe=fe*ne+Z;if(O==="quaternion")Hs.multiplyQuaternionsFlat(U.values,oe,ve,0,U.values,oe);else{let Pe=ne-Z*2;for(let Re=0;Re<Pe;++Re)U.values[oe+Re]-=ve[Re]}}}return y.blendMode=kr,y}};class cu{constructor(r,o,c,p){this.parameterPositions=r,this._cachedIndex=0,this.resultBuffer=p!==void 0?p:new o.constructor(c),this.sampleValues=o,this.valueSize=c,this.settings=null,this.DefaultSettings_={}}evaluate(r){let o=this.parameterPositions,c=this._cachedIndex,p=o[c],v=o[c-1];e:{t:{let w;n:{r:if(!(r<p)){for(let S=c+2;;){if(p===void 0){if(r<v)break r;return c=o.length,this._cachedIndex=c,this.afterEnd_(c-1,r,v)}if(c===S)break;if(v=p,p=o[++c],r<p)break t}w=o.length;break n}if(!(r>=v)){let S=o[1];r<S&&(c=2,v=S);for(let O=c-2;;){if(v===void 0)return this._cachedIndex=0,this.beforeStart_(0,r,p);if(c===O)break;if(p=v,v=o[--c-1],r>=v)break t}w=c,c=0;break n}break e}for(;c<w;){let S=c+w>>>1;r<o[S]?w=S:c=S+1}if(p=o[c],v=o[c-1],v===void 0)return this._cachedIndex=0,this.beforeStart_(0,r,p);if(p===void 0)return c=o.length,this._cachedIndex=c,this.afterEnd_(c-1,v,r)}this._cachedIndex=c,this.intervalChanged_(c,v,p)}return this.interpolate_(c,v,r,p)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(r){let o=this.resultBuffer,c=this.sampleValues,p=this.valueSize,v=r*p;for(let w=0;w!==p;++w)o[w]=c[v+w];return o}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}cu.prototype.beforeStart_=cu.prototype.copySampleValue_,cu.prototype.afterEnd_=cu.prototype.copySampleValue_;class ty extends cu{constructor(r,o,c,p){super(r,o,c,p),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Kn,endingEnd:Kn}}intervalChanged_(r,o,c){let p=this.parameterPositions,v=r-2,w=r+1,S=p[v],O=p[w];if(S===void 0)switch(this.getSettings_().endingStart){case hr:v=r,S=2*o-c;break;case Rr:v=p.length-2,S=o+p[v]-p[v+1];break;default:v=r,S=c}if(O===void 0)switch(this.getSettings_().endingEnd){case hr:w=r,O=2*c-o;break;case Rr:w=1,O=c+p[1]-p[0];break;default:w=r-1,O=o}let U=(c-o)*.5,K=this.valueSize;this._weightPrev=U/(o-S),this._weightNext=U/(O-c),this._offsetPrev=v*K,this._offsetNext=w*K}interpolate_(r,o,c,p){let v=this.resultBuffer,w=this.sampleValues,S=this.valueSize,O=r*S,U=O-S,K=this._offsetPrev,Y=this._offsetNext,Z=this._weightPrev,ne=this._weightNext,ce=(c-o)/(p-o),ve=ce*ce,Fe=ve*ce,fe=-Z*Fe+2*Z*ve-Z*ce,oe=(1+Z)*Fe+(-1.5-2*Z)*ve+(-.5+Z)*ce+1,Pe=(-1-ne)*Fe+(1.5+ne)*ve+.5*ce,Re=ne*Fe-ne*ve;for(let We=0;We!==S;++We)v[We]=fe*w[K+We]+oe*w[U+We]+Pe*w[O+We]+Re*w[Y+We];return v}}class ng extends cu{constructor(r,o,c,p){super(r,o,c,p)}interpolate_(r,o,c,p){let v=this.resultBuffer,w=this.sampleValues,S=this.valueSize,O=r*S,U=O-S,K=(c-o)/(p-o),Y=1-K;for(let Z=0;Z!==S;++Z)v[Z]=w[U+Z]*Y+w[O+Z]*K;return v}}class ny extends cu{constructor(r,o,c,p){super(r,o,c,p)}interpolate_(r){return this.copySampleValue_(r-1)}}class Lo{constructor(r,o,c,p){if(r===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(o===void 0||o.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+r);this.name=r,this.times=Es.convertArray(o,this.TimeBufferType),this.values=Es.convertArray(c,this.ValueBufferType),this.setInterpolation(p||this.DefaultInterpolation)}static toJSON(r){let o=r.constructor,c;if(o.toJSON!==this.toJSON)c=o.toJSON(r);else{c={name:r.name,times:Es.convertArray(r.times,Array),values:Es.convertArray(r.values,Array)};let p=r.getInterpolation();p!==r.DefaultInterpolation&&(c.interpolation=p)}return c.type=r.ValueTypeName,c}InterpolantFactoryMethodDiscrete(r){return new ny(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodLinear(r){return new ng(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodSmooth(r){return new ty(this.times,this.values,this.getValueSize(),r)}setInterpolation(r){let o;switch(r){case Pt:o=this.InterpolantFactoryMethodDiscrete;break;case hn:o=this.InterpolantFactoryMethodLinear;break;case zn:o=this.InterpolantFactoryMethodSmooth;break}if(o===void 0){let c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(r!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(c);return console.warn("THREE.KeyframeTrack:",c),this}return this.createInterpolant=o,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pt;case this.InterpolantFactoryMethodLinear:return hn;case this.InterpolantFactoryMethodSmooth:return zn}}getValueSize(){return this.values.length/this.times.length}shift(r){if(r!==0){let o=this.times;for(let c=0,p=o.length;c!==p;++c)o[c]+=r}return this}scale(r){if(r!==1){let o=this.times;for(let c=0,p=o.length;c!==p;++c)o[c]*=r}return this}trim(r,o){let c=this.times,p=c.length,v=0,w=p-1;for(;v!==p&&c[v]<r;)++v;for(;w!==-1&&c[w]>o;)--w;if(++w,v!==0||w!==p){v>=w&&(w=Math.max(w,1),v=w-1);let S=this.getValueSize();this.times=Es.arraySlice(c,v,w),this.values=Es.arraySlice(this.values,v*S,w*S)}return this}validate(){let r=!0,o=this.getValueSize();o-Math.floor(o)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);let c=this.times,p=this.values,v=c.length;v===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let w=null;for(let S=0;S!==v;S++){let O=c[S];if(typeof O=="number"&&isNaN(O)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,S,O),r=!1;break}if(w!==null&&w>O){console.error("THREE.KeyframeTrack: Out of order keys.",this,S,O,w),r=!1;break}w=O}if(p!==void 0&&Es.isTypedArray(p))for(let S=0,O=p.length;S!==O;++S){let U=p[S];if(isNaN(U)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,S,U),r=!1;break}}return r}optimize(){let r=Es.arraySlice(this.times),o=Es.arraySlice(this.values),c=this.getValueSize(),p=this.getInterpolation()===zn,v=r.length-1,w=1;for(let S=1;S<v;++S){let O=!1,U=r[S],K=r[S+1];if(U!==K&&(S!==1||U!==r[0]))if(p)O=!0;else{let Y=S*c,Z=Y-c,ne=Y+c;for(let ce=0;ce!==c;++ce){let ve=o[Y+ce];if(ve!==o[Z+ce]||ve!==o[ne+ce]){O=!0;break}}}if(O){if(S!==w){r[w]=r[S];let Y=S*c,Z=w*c;for(let ne=0;ne!==c;++ne)o[Z+ne]=o[Y+ne]}++w}}if(v>0){r[w]=r[v];for(let S=v*c,O=w*c,U=0;U!==c;++U)o[O+U]=o[S+U];++w}return w!==r.length?(this.times=Es.arraySlice(r,0,w),this.values=Es.arraySlice(o,0,w*c)):(this.times=r,this.values=o),this}clone(){let r=Es.arraySlice(this.times,0),o=Es.arraySlice(this.values,0),c=this.constructor,p=new c(this.name,r,o);return p.createInterpolant=this.createInterpolant,p}}Lo.prototype.TimeBufferType=Float32Array,Lo.prototype.ValueBufferType=Float32Array,Lo.prototype.DefaultInterpolation=hn;class Do extends Lo{}Do.prototype.ValueTypeName="bool",Do.prototype.ValueBufferType=Array,Do.prototype.DefaultInterpolation=Pt,Do.prototype.InterpolantFactoryMethodLinear=void 0,Do.prototype.InterpolantFactoryMethodSmooth=void 0;class rg extends Lo{}rg.prototype.ValueTypeName="color";class tp extends Lo{}tp.prototype.ValueTypeName="number";class Eb extends cu{constructor(r,o,c,p){super(r,o,c,p)}interpolate_(r,o,c,p){let v=this.resultBuffer,w=this.sampleValues,S=this.valueSize,O=(c-o)/(p-o),U=r*S;for(let K=U+S;U!==K;U+=4)Hs.slerpFlat(v,0,w,U-S,w,U,O);return v}}class np extends Lo{InterpolantFactoryMethodLinear(r){return new Eb(this.times,this.values,this.getValueSize(),r)}}np.prototype.ValueTypeName="quaternion",np.prototype.DefaultInterpolation=hn,np.prototype.InterpolantFactoryMethodSmooth=void 0;class Wh extends Lo{}Wh.prototype.ValueTypeName="string",Wh.prototype.ValueBufferType=Array,Wh.prototype.DefaultInterpolation=Pt,Wh.prototype.InterpolantFactoryMethodLinear=void 0,Wh.prototype.InterpolantFactoryMethodSmooth=void 0;class Lf extends Lo{}Lf.prototype.ValueTypeName="vector";class Df{constructor(r,o=-1,c,p=Nr){this.name=r,this.tracks=c,this.duration=o,this.blendMode=p,this.uuid=Da(),this.duration<0&&this.resetDuration()}static parse(r){let o=[],c=r.tracks,p=1/(r.fps||1);for(let w=0,S=c.length;w!==S;++w)o.push(K1(c[w]).scale(p));let v=new this(r.name,r.duration,o,r.blendMode);return v.uuid=r.uuid,v}static toJSON(r){let o=[],c=r.tracks,p={name:r.name,duration:r.duration,tracks:o,uuid:r.uuid,blendMode:r.blendMode};for(let v=0,w=c.length;v!==w;++v)o.push(Lo.toJSON(c[v]));return p}static CreateFromMorphTargetSequence(r,o,c,p){let v=o.length,w=[];for(let S=0;S<v;S++){let O=[],U=[];O.push((S+v-1)%v,S,(S+1)%v),U.push(0,1,0);let K=Es.getKeyframeOrder(O);O=Es.sortedArray(O,1,K),U=Es.sortedArray(U,1,K),!p&&O[0]===0&&(O.push(v),U.push(U[0])),w.push(new tp(".morphTargetInfluences["+o[S].name+"]",O,U).scale(1/c))}return new this(r,-1,w)}static findByName(r,o){let c=r;if(!Array.isArray(r)){let p=r;c=p.geometry&&p.geometry.animations||p.animations}for(let p=0;p<c.length;p++)if(c[p].name===o)return c[p];return null}static CreateClipsFromMorphTargetSequences(r,o,c){let p={},v=/^([\w-]*?)([\d]+)$/;for(let S=0,O=r.length;S<O;S++){let U=r[S],K=U.name.match(v);if(K&&K.length>1){let Y=K[1],Z=p[Y];Z||(p[Y]=Z=[]),Z.push(U)}}let w=[];for(let S in p)w.push(this.CreateFromMorphTargetSequence(S,p[S],o,c));return w}static parseAnimation(r,o){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let c=function(Y,Z,ne,ce,ve){if(ne.length!==0){let Fe=[],fe=[];Es.flattenJSON(ne,Fe,fe,ce),Fe.length!==0&&ve.push(new Y(Z,Fe,fe))}},p=[],v=r.name||"default",w=r.fps||30,S=r.blendMode,O=r.length||-1,U=r.hierarchy||[];for(let Y=0;Y<U.length;Y++){let Z=U[Y].keys;if(!(!Z||Z.length===0))if(Z[0].morphTargets){let ne={},ce;for(ce=0;ce<Z.length;ce++)if(Z[ce].morphTargets)for(let ve=0;ve<Z[ce].morphTargets.length;ve++)ne[Z[ce].morphTargets[ve]]=-1;for(let ve in ne){let Fe=[],fe=[];for(let oe=0;oe!==Z[ce].morphTargets.length;++oe){let Pe=Z[ce];Fe.push(Pe.time),fe.push(Pe.morphTarget===ve?1:0)}p.push(new tp(".morphTargetInfluence["+ve+"]",Fe,fe))}O=ne.length*(w||1)}else{let ne=".bones["+o[Y].name+"]";c(Lf,ne+".position",Z,"pos",p),c(np,ne+".quaternion",Z,"rot",p),c(Lf,ne+".scale",Z,"scl",p)}}return p.length===0?null:new this(v,O,p,S)}resetDuration(){let r=this.tracks,o=0;for(let c=0,p=r.length;c!==p;++c){let v=this.tracks[c];o=Math.max(o,v.times[v.times.length-1])}return this.duration=o,this}trim(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this}validate(){let r=!0;for(let o=0;o<this.tracks.length;o++)r=r&&this.tracks[o].validate();return r}optimize(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this}clone(){let r=[];for(let o=0;o<this.tracks.length;o++)r.push(this.tracks[o].clone());return new this.constructor(this.name,this.duration,r,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function q1(y){switch(y.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return tp;case"vector":case"vector2":case"vector3":case"vector4":return Lf;case"color":return rg;case"quaternion":return np;case"bool":case"boolean":return Do;case"string":return Wh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+y)}function K1(y){if(y.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let r=q1(y.type);if(y.times===void 0){let o=[],c=[];Es.flattenJSON(y.keys,o,c,"value"),y.times=o,y.values=c}return r.parse!==void 0?r.parse(y):new r(y.name,y.times,y.values,y.interpolation)}let jh={enabled:!1,files:{},add:function(y,r){this.enabled!==!1&&(this.files[y]=r)},get:function(y){if(this.enabled!==!1)return this.files[y]},remove:function(y){delete this.files[y]},clear:function(){this.files={}}};class ry{constructor(r,o,c){let p=this,v=!1,w=0,S=0,O,U=[];this.onStart=void 0,this.onLoad=r,this.onProgress=o,this.onError=c,this.itemStart=function(K){S++,v===!1&&p.onStart!==void 0&&p.onStart(K,w,S),v=!0},this.itemEnd=function(K){w++,p.onProgress!==void 0&&p.onProgress(K,w,S),w===S&&(v=!1,p.onLoad!==void 0&&p.onLoad())},this.itemError=function(K){p.onError!==void 0&&p.onError(K)},this.resolveURL=function(K){return O?O(K):K},this.setURLModifier=function(K){return O=K,this},this.addHandler=function(K,Y){return U.push(K,Y),this},this.removeHandler=function(K){let Y=U.indexOf(K);return Y!==-1&&U.splice(Y,2),this},this.getHandler=function(K){for(let Y=0,Z=U.length;Y<Z;Y+=2){let ne=U[Y],ce=U[Y+1];if(ne.global&&(ne.lastIndex=0),ne.test(K))return ce}return null}}}let Sb=new ry;class Za{constructor(r){this.manager=r!==void 0?r:Sb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,o){let c=this;return new Promise(function(p,v){c.load(r,p,o,v)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}}let ju={};class hu extends Za{constructor(r){super(r)}load(r,o,c,p){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);let v=jh.get(r);if(v!==void 0)return this.manager.itemStart(r),setTimeout(()=>{o&&o(v),this.manager.itemEnd(r)},0),v;if(ju[r]!==void 0){ju[r].push({onLoad:o,onProgress:c,onError:p});return}ju[r]=[],ju[r].push({onLoad:o,onProgress:c,onError:p});let w=new Request(r,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),S=this.mimeType,O=this.responseType;fetch(w).then(U=>{if(U.status===200||U.status===0){if(U.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||U.body.getReader===void 0)return U;let K=ju[r],Y=U.body.getReader(),Z=U.headers.get("Content-Length"),ne=Z?parseInt(Z):0,ce=ne!==0,ve=0,Fe=new ReadableStream({start(fe){oe();function oe(){Y.read().then(({done:Pe,value:Re})=>{if(Pe)fe.close();else{ve+=Re.byteLength;let We=new ProgressEvent("progress",{lengthComputable:ce,loaded:ve,total:ne});for(let Je=0,dt=K.length;Je<dt;Je++){let wt=K[Je];wt.onProgress&&wt.onProgress(We)}fe.enqueue(Re),oe()}})}}});return new Response(Fe)}else throw Error(`fetch for "${U.url}" responded with ${U.status}: ${U.statusText}`)}).then(U=>{switch(O){case"arraybuffer":return U.arrayBuffer();case"blob":return U.blob();case"document":return U.text().then(K=>new DOMParser().parseFromString(K,S));case"json":return U.json();default:if(S===void 0)return U.text();{let Y=/charset="?([^;"\s]*)"?/i.exec(S),Z=Y&&Y[1]?Y[1].toLowerCase():void 0,ne=new TextDecoder(Z);return U.arrayBuffer().then(ce=>ne.decode(ce))}}}).then(U=>{jh.add(r,U);let K=ju[r];delete ju[r];for(let Y=0,Z=K.length;Y<Z;Y++){let ne=K[Y];ne.onLoad&&ne.onLoad(U)}}).catch(U=>{let K=ju[r];if(K===void 0)throw this.manager.itemError(r),U;delete ju[r];for(let Y=0,Z=K.length;Y<Z;Y++){let ne=K[Y];ne.onError&&ne.onError(U)}this.manager.itemError(r)}).finally(()=>{this.manager.itemEnd(r)}),this.manager.itemStart(r)}setResponseType(r){return this.responseType=r,this}setMimeType(r){return this.mimeType=r,this}}class Y1 extends Za{constructor(r){super(r)}load(r,o,c,p){let v=this,w=new hu(this.manager);w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(r,function(S){try{o(v.parse(JSON.parse(S)))}catch(O){p?p(O):console.error(O),v.manager.itemError(r)}},c,p)}parse(r){let o=[];for(let c=0;c<r.length;c++){let p=Df.parse(r[c]);o.push(p)}return o}}class Q1 extends Za{constructor(r){super(r)}load(r,o,c,p){let v=this,w=[],S=new bf,O=new hu(this.manager);O.setPath(this.path),O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setWithCredentials(v.withCredentials);let U=0;function K(Y){O.load(r[Y],function(Z){let ne=v.parse(Z,!0);w[Y]={width:ne.width,height:ne.height,format:ne.format,mipmaps:ne.mipmaps},U+=1,U===6&&(ne.mipmapCount===1&&(S.minFilter=St),S.image=w,S.format=ne.format,S.needsUpdate=!0,o&&o(S))},c,p)}if(Array.isArray(r))for(let Y=0,Z=r.length;Y<Z;++Y)K(Y);else O.load(r,function(Y){let Z=v.parse(Y,!0);if(Z.isCubemap){let ne=Z.mipmaps.length/Z.mipmapCount;for(let ce=0;ce<ne;ce++){w[ce]={mipmaps:[]};for(let ve=0;ve<Z.mipmapCount;ve++)w[ce].mipmaps.push(Z.mipmaps[ce*Z.mipmapCount+ve]),w[ce].format=Z.format,w[ce].width=Z.width,w[ce].height=Z.height}S.image=w}else S.image.width=Z.width,S.image.height=Z.height,S.mipmaps=Z.mipmaps;Z.mipmapCount===1&&(S.minFilter=St),S.format=Z.format,S.needsUpdate=!0,o&&o(S)},c,p);return S}}class Ff extends Za{constructor(r){super(r)}load(r,o,c,p){this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);let v=this,w=jh.get(r);if(w!==void 0)return v.manager.itemStart(r),setTimeout(function(){o&&o(w),v.manager.itemEnd(r)},0),w;let S=sc("img");function O(){K(),jh.add(r,this),o&&o(this),v.manager.itemEnd(r)}function U(Y){K(),p&&p(Y),v.manager.itemError(r),v.manager.itemEnd(r)}function K(){S.removeEventListener("load",O,!1),S.removeEventListener("error",U,!1)}return S.addEventListener("load",O,!1),S.addEventListener("error",U,!1),r.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(S.crossOrigin=this.crossOrigin),v.manager.itemStart(r),S.src=r,S}}class Tb extends Za{constructor(r){super(r)}load(r,o,c,p){let v=new bh,w=new Ff(this.manager);w.setCrossOrigin(this.crossOrigin),w.setPath(this.path);let S=0;function O(U){w.load(r[U],function(K){v.images[U]=K,S++,S===6&&(v.needsUpdate=!0,o&&o(v))},void 0,p)}for(let U=0;U<r.length;++U)O(U);return v}}class Mb extends Za{constructor(r){super(r)}load(r,o,c,p){let v=this,w=new $u,S=new hu(this.manager);return S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(v.withCredentials),S.load(r,function(O){let U=v.parse(O);!U||(U.image!==void 0?w.image=U.image:U.data!==void 0&&(w.image.width=U.width,w.image.height=U.height,w.image.data=U.data),w.wrapS=U.wrapS!==void 0?U.wrapS:gn,w.wrapT=U.wrapT!==void 0?U.wrapT:gn,w.magFilter=U.magFilter!==void 0?U.magFilter:St,w.minFilter=U.minFilter!==void 0?U.minFilter:St,w.anisotropy=U.anisotropy!==void 0?U.anisotropy:1,U.encoding!==void 0&&(w.encoding=U.encoding),U.flipY!==void 0&&(w.flipY=U.flipY),U.format!==void 0&&(w.format=U.format),U.type!==void 0&&(w.type=U.type),U.mipmaps!==void 0&&(w.mipmaps=U.mipmaps,w.minFilter=cr),U.mipmapCount===1&&(w.minFilter=St),U.generateMipmaps!==void 0&&(w.generateMipmaps=U.generateMipmaps),w.needsUpdate=!0,o&&o(w,U))},c,p),w}}class _b extends Za{constructor(r){super(r)}load(r,o,c,p){let v=new Rs,w=new Ff(this.manager);return w.setCrossOrigin(this.crossOrigin),w.setPath(this.path),w.load(r,function(S){v.image=S,v.needsUpdate=!0,o!==void 0&&o(v)},c,p),v}}class _l extends bi{constructor(r,o=1){super(),this.type="Light",this.color=new Fn(r),this.intensity=o}dispose(){}copy(r){return super.copy(r),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){let o=super.toJSON(r);return o.object.color=this.color.getHex(),o.object.intensity=this.intensity,this.groundColor!==void 0&&(o.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(o.object.distance=this.distance),this.angle!==void 0&&(o.object.angle=this.angle),this.decay!==void 0&&(o.object.decay=this.decay),this.penumbra!==void 0&&(o.object.penumbra=this.penumbra),this.shadow!==void 0&&(o.object.shadow=this.shadow.toJSON()),o}}_l.prototype.isLight=!0;class iy extends _l{constructor(r,o,c){super(r,c),this.type="HemisphereLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.groundColor=new Fn(o)}copy(r){return _l.prototype.copy.call(this,r),this.groundColor.copy(r.groundColor),this}}iy.prototype.isHemisphereLight=!0;let Cb=new Wn,Ib=new je,kb=new je;class sy{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new un(512,512),this.map=null,this.mapPass=null,this.matrix=new Wn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vp,this._frameExtents=new un(1,1),this._viewportCount=1,this._viewports=[new Si(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){let o=this.camera,c=this.matrix;Ib.setFromMatrixPosition(r.matrixWorld),o.position.copy(Ib),kb.setFromMatrixPosition(r.target.matrixWorld),o.lookAt(kb),o.updateMatrixWorld(),Cb.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cb),c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(o.projectionMatrix),c.multiply(o.matrixWorldInverse)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}}class Rb extends sy{constructor(){super(new Ys(50,1,.5,500)),this.focus=1}updateMatrices(r){let o=this.camera,c=xu*2*r.angle*this.focus,p=this.mapSize.width/this.mapSize.height,v=r.distance||o.far;(c!==o.fov||p!==o.aspect||v!==o.far)&&(o.fov=c,o.aspect=p,o.far=v,o.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}}Rb.prototype.isSpotLightShadow=!0;class ay extends _l{constructor(r,o,c=0,p=Math.PI/3,v=0,w=1){super(r,o),this.type="SpotLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.target=new bi,this.distance=c,this.angle=p,this.penumbra=v,this.decay=w,this.shadow=new Rb}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}ay.prototype.isSpotLight=!0;let Nb=new Wn,Pf=new je,oy=new je;class Lb extends sy{constructor(){super(new Ys(90,1,.5,500)),this._frameExtents=new un(4,2),this._viewportCount=6,this._viewports=[new Si(2,1,1,1),new Si(0,1,1,1),new Si(3,1,1,1),new Si(1,1,1,1),new Si(3,0,1,1),new Si(1,0,1,1)],this._cubeDirections=[new je(1,0,0),new je(-1,0,0),new je(0,0,1),new je(0,0,-1),new je(0,1,0),new je(0,-1,0)],this._cubeUps=[new je(0,1,0),new je(0,1,0),new je(0,1,0),new je(0,1,0),new je(0,0,1),new je(0,0,-1)]}updateMatrices(r,o=0){let c=this.camera,p=this.matrix,v=r.distance||c.far;v!==c.far&&(c.far=v,c.updateProjectionMatrix()),Pf.setFromMatrixPosition(r.matrixWorld),c.position.copy(Pf),oy.copy(c.position),oy.add(this._cubeDirections[o]),c.up.copy(this._cubeUps[o]),c.lookAt(oy),c.updateMatrixWorld(),p.makeTranslation(-Pf.x,-Pf.y,-Pf.z),Nb.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Nb)}}Lb.prototype.isPointLightShadow=!0;class ly extends _l{constructor(r,o,c=0,p=1){super(r,o),this.type="PointLight",this.distance=c,this.decay=p,this.shadow=new Lb}get power(){return this.intensity*4*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}}ly.prototype.isPointLight=!0;class Db extends sy{constructor(){super(new Cd(-5,5,5,-5,.5,500))}}Db.prototype.isDirectionalLightShadow=!0;class uy extends _l{constructor(r,o){super(r,o),this.type="DirectionalLight",this.position.copy(bi.DefaultUp),this.updateMatrix(),this.target=new bi,this.shadow=new Db}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}uy.prototype.isDirectionalLight=!0;class cy extends _l{constructor(r,o){super(r,o),this.type="AmbientLight"}}cy.prototype.isAmbientLight=!0;class hy extends _l{constructor(r,o,c=10,p=10){super(r,o),this.type="RectAreaLight",this.width=c,this.height=p}get power(){return this.intensity*this.width*this.height*Math.PI}set power(r){this.intensity=r/(this.width*this.height*Math.PI)}copy(r){return super.copy(r),this.width=r.width,this.height=r.height,this}toJSON(r){let o=super.toJSON(r);return o.object.width=this.width,o.object.height=this.height,o}}hy.prototype.isRectAreaLight=!0;class dy{constructor(){this.coefficients=[];for(let r=0;r<9;r++)this.coefficients.push(new je)}set(r){for(let o=0;o<9;o++)this.coefficients[o].copy(r[o]);return this}zero(){for(let r=0;r<9;r++)this.coefficients[r].set(0,0,0);return this}getAt(r,o){let c=r.x,p=r.y,v=r.z,w=this.coefficients;return o.copy(w[0]).multiplyScalar(.282095),o.addScaledVector(w[1],.488603*p),o.addScaledVector(w[2],.488603*v),o.addScaledVector(w[3],.488603*c),o.addScaledVector(w[4],1.092548*(c*p)),o.addScaledVector(w[5],1.092548*(p*v)),o.addScaledVector(w[6],.315392*(3*v*v-1)),o.addScaledVector(w[7],1.092548*(c*v)),o.addScaledVector(w[8],.546274*(c*c-p*p)),o}getIrradianceAt(r,o){let c=r.x,p=r.y,v=r.z,w=this.coefficients;return o.copy(w[0]).multiplyScalar(.886227),o.addScaledVector(w[1],2*.511664*p),o.addScaledVector(w[2],2*.511664*v),o.addScaledVector(w[3],2*.511664*c),o.addScaledVector(w[4],2*.429043*c*p),o.addScaledVector(w[5],2*.429043*p*v),o.addScaledVector(w[6],.743125*v*v-.247708),o.addScaledVector(w[7],2*.429043*c*v),o.addScaledVector(w[8],.429043*(c*c-p*p)),o}add(r){for(let o=0;o<9;o++)this.coefficients[o].add(r.coefficients[o]);return this}addScaledSH(r,o){for(let c=0;c<9;c++)this.coefficients[c].addScaledVector(r.coefficients[c],o);return this}scale(r){for(let o=0;o<9;o++)this.coefficients[o].multiplyScalar(r);return this}lerp(r,o){for(let c=0;c<9;c++)this.coefficients[c].lerp(r.coefficients[c],o);return this}equals(r){for(let o=0;o<9;o++)if(!this.coefficients[o].equals(r.coefficients[o]))return!1;return!0}copy(r){return this.set(r.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(r,o=0){let c=this.coefficients;for(let p=0;p<9;p++)c[p].fromArray(r,o+p*3);return this}toArray(r=[],o=0){let c=this.coefficients;for(let p=0;p<9;p++)c[p].toArray(r,o+p*3);return r}static getBasisAt(r,o){let c=r.x,p=r.y,v=r.z;o[0]=.282095,o[1]=.488603*p,o[2]=.488603*v,o[3]=.488603*c,o[4]=1.092548*c*p,o[5]=1.092548*p*v,o[6]=.315392*(3*v*v-1),o[7]=1.092548*c*v,o[8]=.546274*(c*c-p*p)}}dy.prototype.isSphericalHarmonics3=!0;class Of extends _l{constructor(r=new dy,o=1){super(void 0,o),this.sh=r}copy(r){return super.copy(r),this.sh.copy(r.sh),this}fromJSON(r){return this.intensity=r.intensity,this.sh.fromArray(r.sh),this}toJSON(r){let o=super.toJSON(r);return o.object.sh=this.sh.toArray(),o}}Of.prototype.isLightProbe=!0;class Fb extends Za{constructor(r){super(r),this.textures={}}load(r,o,c,p){let v=this,w=new hu(v.manager);w.setPath(v.path),w.setRequestHeader(v.requestHeader),w.setWithCredentials(v.withCredentials),w.load(r,function(S){try{o(v.parse(JSON.parse(S)))}catch(O){p?p(O):console.error(O),v.manager.itemError(r)}},c,p)}parse(r){let o=this.textures;function c(v){return o[v]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",v),o[v]}let p=new X1[r.type];if(r.uuid!==void 0&&(p.uuid=r.uuid),r.name!==void 0&&(p.name=r.name),r.color!==void 0&&p.color!==void 0&&p.color.setHex(r.color),r.roughness!==void 0&&(p.roughness=r.roughness),r.metalness!==void 0&&(p.metalness=r.metalness),r.sheen!==void 0&&(p.sheen=r.sheen),r.sheenColor!==void 0&&(p.sheenColor=new Fn().setHex(r.sheenColor)),r.sheenRoughness!==void 0&&(p.sheenRoughness=r.sheenRoughness),r.emissive!==void 0&&p.emissive!==void 0&&p.emissive.setHex(r.emissive),r.specular!==void 0&&p.specular!==void 0&&p.specular.setHex(r.specular),r.specularIntensity!==void 0&&(p.specularIntensity=r.specularIntensity),r.specularColor!==void 0&&p.specularColor!==void 0&&p.specularColor.setHex(r.specularColor),r.shininess!==void 0&&(p.shininess=r.shininess),r.clearcoat!==void 0&&(p.clearcoat=r.clearcoat),r.clearcoatRoughness!==void 0&&(p.clearcoatRoughness=r.clearcoatRoughness),r.transmission!==void 0&&(p.transmission=r.transmission),r.thickness!==void 0&&(p.thickness=r.thickness),r.attenuationDistance!==void 0&&(p.attenuationDistance=r.attenuationDistance),r.attenuationColor!==void 0&&p.attenuationColor!==void 0&&p.attenuationColor.setHex(r.attenuationColor),r.fog!==void 0&&(p.fog=r.fog),r.flatShading!==void 0&&(p.flatShading=r.flatShading),r.blending!==void 0&&(p.blending=r.blending),r.combine!==void 0&&(p.combine=r.combine),r.side!==void 0&&(p.side=r.side),r.shadowSide!==void 0&&(p.shadowSide=r.shadowSide),r.opacity!==void 0&&(p.opacity=r.opacity),r.transparent!==void 0&&(p.transparent=r.transparent),r.alphaTest!==void 0&&(p.alphaTest=r.alphaTest),r.depthTest!==void 0&&(p.depthTest=r.depthTest),r.depthWrite!==void 0&&(p.depthWrite=r.depthWrite),r.colorWrite!==void 0&&(p.colorWrite=r.colorWrite),r.alphaWrite!==void 0&&(p.alphaWrite=r.alphaWrite),r.stencilWrite!==void 0&&(p.stencilWrite=r.stencilWrite),r.stencilWriteMask!==void 0&&(p.stencilWriteMask=r.stencilWriteMask),r.stencilFunc!==void 0&&(p.stencilFunc=r.stencilFunc),r.stencilRef!==void 0&&(p.stencilRef=r.stencilRef),r.stencilFuncMask!==void 0&&(p.stencilFuncMask=r.stencilFuncMask),r.stencilFail!==void 0&&(p.stencilFail=r.stencilFail),r.stencilZFail!==void 0&&(p.stencilZFail=r.stencilZFail),r.stencilZPass!==void 0&&(p.stencilZPass=r.stencilZPass),r.wireframe!==void 0&&(p.wireframe=r.wireframe),r.wireframeLinewidth!==void 0&&(p.wireframeLinewidth=r.wireframeLinewidth),r.wireframeLinecap!==void 0&&(p.wireframeLinecap=r.wireframeLinecap),r.wireframeLinejoin!==void 0&&(p.wireframeLinejoin=r.wireframeLinejoin),r.rotation!==void 0&&(p.rotation=r.rotation),r.linewidth!==1&&(p.linewidth=r.linewidth),r.dashSize!==void 0&&(p.dashSize=r.dashSize),r.gapSize!==void 0&&(p.gapSize=r.gapSize),r.scale!==void 0&&(p.scale=r.scale),r.polygonOffset!==void 0&&(p.polygonOffset=r.polygonOffset),r.polygonOffsetFactor!==void 0&&(p.polygonOffsetFactor=r.polygonOffsetFactor),r.polygonOffsetUnits!==void 0&&(p.polygonOffsetUnits=r.polygonOffsetUnits),r.dithering!==void 0&&(p.dithering=r.dithering),r.alphaToCoverage!==void 0&&(p.alphaToCoverage=r.alphaToCoverage),r.premultipliedAlpha!==void 0&&(p.premultipliedAlpha=r.premultipliedAlpha),r.visible!==void 0&&(p.visible=r.visible),r.toneMapped!==void 0&&(p.toneMapped=r.toneMapped),r.userData!==void 0&&(p.userData=r.userData),r.vertexColors!==void 0&&(typeof r.vertexColors=="number"?p.vertexColors=r.vertexColors>0:p.vertexColors=r.vertexColors),r.uniforms!==void 0)for(let v in r.uniforms){let w=r.uniforms[v];switch(p.uniforms[v]={},w.type){case"t":p.uniforms[v].value=c(w.value);break;case"c":p.uniforms[v].value=new Fn().setHex(w.value);break;case"v2":p.uniforms[v].value=new un().fromArray(w.value);break;case"v3":p.uniforms[v].value=new je().fromArray(w.value);break;case"v4":p.uniforms[v].value=new Si().fromArray(w.value);break;case"m3":p.uniforms[v].value=new Ts().fromArray(w.value);break;case"m4":p.uniforms[v].value=new Wn().fromArray(w.value);break;default:p.uniforms[v].value=w.value}}if(r.defines!==void 0&&(p.defines=r.defines),r.vertexShader!==void 0&&(p.vertexShader=r.vertexShader),r.fragmentShader!==void 0&&(p.fragmentShader=r.fragmentShader),r.extensions!==void 0)for(let v in r.extensions)p.extensions[v]=r.extensions[v];if(r.shading!==void 0&&(p.flatShading=r.shading===1),r.size!==void 0&&(p.size=r.size),r.sizeAttenuation!==void 0&&(p.sizeAttenuation=r.sizeAttenuation),r.map!==void 0&&(p.map=c(r.map)),r.matcap!==void 0&&(p.matcap=c(r.matcap)),r.alphaMap!==void 0&&(p.alphaMap=c(r.alphaMap)),r.bumpMap!==void 0&&(p.bumpMap=c(r.bumpMap)),r.bumpScale!==void 0&&(p.bumpScale=r.bumpScale),r.normalMap!==void 0&&(p.normalMap=c(r.normalMap)),r.normalMapType!==void 0&&(p.normalMapType=r.normalMapType),r.normalScale!==void 0){let v=r.normalScale;Array.isArray(v)===!1&&(v=[v,v]),p.normalScale=new un().fromArray(v)}return r.displacementMap!==void 0&&(p.displacementMap=c(r.displacementMap)),r.displacementScale!==void 0&&(p.displacementScale=r.displacementScale),r.displacementBias!==void 0&&(p.displacementBias=r.displacementBias),r.roughnessMap!==void 0&&(p.roughnessMap=c(r.roughnessMap)),r.metalnessMap!==void 0&&(p.metalnessMap=c(r.metalnessMap)),r.emissiveMap!==void 0&&(p.emissiveMap=c(r.emissiveMap)),r.emissiveIntensity!==void 0&&(p.emissiveIntensity=r.emissiveIntensity),r.specularMap!==void 0&&(p.specularMap=c(r.specularMap)),r.specularIntensityMap!==void 0&&(p.specularIntensityMap=c(r.specularIntensityMap)),r.specularColorMap!==void 0&&(p.specularColorMap=c(r.specularColorMap)),r.envMap!==void 0&&(p.envMap=c(r.envMap)),r.envMapIntensity!==void 0&&(p.envMapIntensity=r.envMapIntensity),r.reflectivity!==void 0&&(p.reflectivity=r.reflectivity),r.refractionRatio!==void 0&&(p.refractionRatio=r.refractionRatio),r.lightMap!==void 0&&(p.lightMap=c(r.lightMap)),r.lightMapIntensity!==void 0&&(p.lightMapIntensity=r.lightMapIntensity),r.aoMap!==void 0&&(p.aoMap=c(r.aoMap)),r.aoMapIntensity!==void 0&&(p.aoMapIntensity=r.aoMapIntensity),r.gradientMap!==void 0&&(p.gradientMap=c(r.gradientMap)),r.clearcoatMap!==void 0&&(p.clearcoatMap=c(r.clearcoatMap)),r.clearcoatRoughnessMap!==void 0&&(p.clearcoatRoughnessMap=c(r.clearcoatRoughnessMap)),r.clearcoatNormalMap!==void 0&&(p.clearcoatNormalMap=c(r.clearcoatNormalMap)),r.clearcoatNormalScale!==void 0&&(p.clearcoatNormalScale=new un().fromArray(r.clearcoatNormalScale)),r.transmissionMap!==void 0&&(p.transmissionMap=c(r.transmissionMap)),r.thicknessMap!==void 0&&(p.thicknessMap=c(r.thicknessMap)),r.sheenColorMap!==void 0&&(p.sheenColorMap=c(r.sheenColorMap)),r.sheenRoughnessMap!==void 0&&(p.sheenRoughnessMap=c(r.sheenRoughnessMap)),p}setTextures(r){return this.textures=r,this}}class ig{static decodeText(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let o="";for(let c=0,p=r.length;c<p;c++)o+=String.fromCharCode(r[c]);try{return decodeURIComponent(escape(o))}catch{return o}}static extractUrlBase(r){let o=r.lastIndexOf("/");return o===-1?"./":r.substr(0,o+1)}static resolveURL(r,o){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(o)&&/^\//.test(r)&&(o=o.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:o+r)}}class py extends Or{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(r){return super.copy(r),this.instanceCount=r.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let r=super.toJSON(this);return r.instanceCount=this.instanceCount,r.isInstancedBufferGeometry=!0,r}}py.prototype.isInstancedBufferGeometry=!0;class fy extends Za{constructor(r){super(r)}load(r,o,c,p){let v=this,w=new hu(v.manager);w.setPath(v.path),w.setRequestHeader(v.requestHeader),w.setWithCredentials(v.withCredentials),w.load(r,function(S){try{o(v.parse(JSON.parse(S)))}catch(O){p?p(O):console.error(O),v.manager.itemError(r)}},c,p)}parse(r){let o={},c={};function p(ne,ce){if(o[ce]!==void 0)return o[ce];let Fe=ne.interleavedBuffers[ce],fe=v(ne,Fe.buffer),oe=Au(Fe.type,fe),Pe=new su(oe,Fe.stride);return Pe.uuid=Fe.uuid,o[ce]=Pe,Pe}function v(ne,ce){if(c[ce]!==void 0)return c[ce];let Fe=ne.arrayBuffers[ce],fe=new Uint32Array(Fe).buffer;return c[ce]=fe,fe}let w=r.isInstancedBufferGeometry?new py:new Or,S=r.data.index;if(S!==void 0){let ne=Au(S.type,S.array);w.setIndex(new Ri(ne,1))}let O=r.data.attributes;for(let ne in O){let ce=O[ne],ve;if(ce.isInterleavedBufferAttribute){let Fe=p(r.data,ce.data);ve=new Cc(Fe,ce.itemSize,ce.offset,ce.normalized)}else{let Fe=Au(ce.type,ce.array),fe=ce.isInstancedBufferAttribute?Oh:Ri;ve=new fe(Fe,ce.itemSize,ce.normalized)}ce.name!==void 0&&(ve.name=ce.name),ce.usage!==void 0&&ve.setUsage(ce.usage),ce.updateRange!==void 0&&(ve.updateRange.offset=ce.updateRange.offset,ve.updateRange.count=ce.updateRange.count),w.setAttribute(ne,ve)}let U=r.data.morphAttributes;if(U)for(let ne in U){let ce=U[ne],ve=[];for(let Fe=0,fe=ce.length;Fe<fe;Fe++){let oe=ce[Fe],Pe;if(oe.isInterleavedBufferAttribute){let Re=p(r.data,oe.data);Pe=new Cc(Re,oe.itemSize,oe.offset,oe.normalized)}else{let Re=Au(oe.type,oe.array);Pe=new Ri(Re,oe.itemSize,oe.normalized)}oe.name!==void 0&&(Pe.name=oe.name),ve.push(Pe)}w.morphAttributes[ne]=ve}r.data.morphTargetsRelative&&(w.morphTargetsRelative=!0);let Y=r.data.groups||r.data.drawcalls||r.data.offsets;if(Y!==void 0)for(let ne=0,ce=Y.length;ne!==ce;++ne){let ve=Y[ne];w.addGroup(ve.start,ve.count,ve.materialIndex)}let Z=r.data.boundingSphere;if(Z!==void 0){let ne=new je;Z.center!==void 0&&ne.fromArray(Z.center),w.boundingSphere=new xl(ne,Z.radius)}return r.name&&(w.name=r.name),r.userData&&(w.userData=r.userData),w}}class Pb extends Za{constructor(r){super(r)}load(r,o,c,p){let v=this,w=this.path===""?ig.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||w;let S=new hu(this.manager);S.setPath(this.path),S.setRequestHeader(this.requestHeader),S.setWithCredentials(this.withCredentials),S.load(r,function(O){let U=null;try{U=JSON.parse(O)}catch(Y){p!==void 0&&p(Y),console.error("THREE:ObjectLoader: Can't parse "+r+".",Y.message);return}let K=U.metadata;if(K===void 0||K.type===void 0||K.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+r);return}v.parse(U,o)},c,p)}async loadAsync(r,o){let c=this,p=this.path===""?ig.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||p;let v=new hu(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials);let w=await v.loadAsync(r,o),S=JSON.parse(w),O=S.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+r);return await c.parseAsync(S)}parse(r,o){let c=this.parseAnimations(r.animations),p=this.parseShapes(r.shapes),v=this.parseGeometries(r.geometries,p),w=this.parseImages(r.images,function(){o!==void 0&&o(U)}),S=this.parseTextures(r.textures,w),O=this.parseMaterials(r.materials,S),U=this.parseObject(r.object,v,O,S,c),K=this.parseSkeletons(r.skeletons,U);if(this.bindSkeletons(U,K),o!==void 0){let Y=!1;for(let Z in w)if(w[Z]instanceof HTMLImageElement){Y=!0;break}Y===!1&&o(U)}return U}async parseAsync(r){let o=this.parseAnimations(r.animations),c=this.parseShapes(r.shapes),p=this.parseGeometries(r.geometries,c),v=await this.parseImagesAsync(r.images),w=this.parseTextures(r.textures,v),S=this.parseMaterials(r.materials,w),O=this.parseObject(r.object,p,S,w,o),U=this.parseSkeletons(r.skeletons,O);return this.bindSkeletons(O,U),O}parseShapes(r){let o={};if(r!==void 0)for(let c=0,p=r.length;c<p;c++){let v=new uu().fromJSON(r[c]);o[v.uuid]=v}return o}parseSkeletons(r,o){let c={},p={};if(o.traverse(function(v){v.isBone&&(p[v.uuid]=v)}),r!==void 0)for(let v=0,w=r.length;v<w;v++){let S=new Nm().fromJSON(r[v],p);c[S.uuid]=S}return c}parseGeometries(r,o){let c={};if(r!==void 0){let v=new fy;for(let w=0,S=r.length;w<S;w++){let O,U=r[w];switch(U.type){case"BufferGeometry":case"InstancedBufferGeometry":O=v.parse(U);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var p=new THREE.LegacyJSONLoader;O=p.parse(U,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:U.type in Ab?O=Ab[U.type].fromJSON(U,o):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${U.type}"`)}O.uuid=U.uuid,U.name!==void 0&&(O.name=U.name),O.isBufferGeometry===!0&&U.userData!==void 0&&(O.userData=U.userData),c[U.uuid]=O}}return c}parseMaterials(r,o){let c={},p={};if(r!==void 0){let v=new Fb;v.setTextures(o);for(let w=0,S=r.length;w<S;w++){let O=r[w];if(O.type==="MultiMaterial"){let U=[];for(let K=0;K<O.materials.length;K++){let Y=O.materials[K];c[Y.uuid]===void 0&&(c[Y.uuid]=v.parse(Y)),U.push(c[Y.uuid])}p[O.uuid]=U}else c[O.uuid]===void 0&&(c[O.uuid]=v.parse(O)),p[O.uuid]=c[O.uuid]}}return p}parseAnimations(r){let o={};if(r!==void 0)for(let c=0;c<r.length;c++){let p=r[c],v=Df.parse(p);o[v.uuid]=v}return o}parseImages(r,o){let c=this,p={},v;function w(O){return c.manager.itemStart(O),v.load(O,function(){c.manager.itemEnd(O)},void 0,function(){c.manager.itemError(O),c.manager.itemEnd(O)})}function S(O){if(typeof O=="string"){let U=O,K=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(U)?U:c.resourcePath+U;return w(K)}else return O.data?{data:Au(O.type,O.data),width:O.width,height:O.height}:null}if(r!==void 0&&r.length>0){let O=new ry(o);v=new Ff(O),v.setCrossOrigin(this.crossOrigin);for(let U=0,K=r.length;U<K;U++){let Y=r[U],Z=Y.url;if(Array.isArray(Z)){p[Y.uuid]=[];for(let ne=0,ce=Z.length;ne<ce;ne++){let ve=Z[ne],Fe=S(ve);Fe!==null&&(Fe instanceof HTMLImageElement?p[Y.uuid].push(Fe):p[Y.uuid].push(new $u(Fe.data,Fe.width,Fe.height)))}}else{let ne=S(Y.url);ne!==null&&(p[Y.uuid]=ne)}}}return p}async parseImagesAsync(r){let o=this,c={},p;async function v(w){if(typeof w=="string"){let S=w,O=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(S)?S:o.resourcePath+S;return await p.loadAsync(O)}else return w.data?{data:Au(w.type,w.data),width:w.width,height:w.height}:null}if(r!==void 0&&r.length>0){p=new Ff(this.manager),p.setCrossOrigin(this.crossOrigin);for(let w=0,S=r.length;w<S;w++){let O=r[w],U=O.url;if(Array.isArray(U)){c[O.uuid]=[];for(let K=0,Y=U.length;K<Y;K++){let Z=U[K],ne=await v(Z);ne!==null&&(ne instanceof HTMLImageElement?c[O.uuid].push(ne):c[O.uuid].push(new $u(ne.data,ne.width,ne.height)))}}else{let K=await v(O.url);K!==null&&(c[O.uuid]=K)}}}return c}parseTextures(r,o){function c(v,w){return typeof v=="number"?v:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",v),w[v])}let p={};if(r!==void 0)for(let v=0,w=r.length;v<w;v++){let S=r[v];S.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',S.uuid),o[S.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",S.image);let O,U=o[S.image];Array.isArray(U)?(O=new bh(U),U.length===6&&(O.needsUpdate=!0)):(U&&U.data?O=new $u(U.data,U.width,U.height):O=new Rs(U),U&&(O.needsUpdate=!0)),O.uuid=S.uuid,S.name!==void 0&&(O.name=S.name),S.mapping!==void 0&&(O.mapping=c(S.mapping,Z1)),S.offset!==void 0&&O.offset.fromArray(S.offset),S.repeat!==void 0&&O.repeat.fromArray(S.repeat),S.center!==void 0&&O.center.fromArray(S.center),S.rotation!==void 0&&(O.rotation=S.rotation),S.wrap!==void 0&&(O.wrapS=c(S.wrap[0],Ob),O.wrapT=c(S.wrap[1],Ob)),S.format!==void 0&&(O.format=S.format),S.type!==void 0&&(O.type=S.type),S.encoding!==void 0&&(O.encoding=S.encoding),S.minFilter!==void 0&&(O.minFilter=c(S.minFilter,Bb)),S.magFilter!==void 0&&(O.magFilter=c(S.magFilter,Bb)),S.anisotropy!==void 0&&(O.anisotropy=S.anisotropy),S.flipY!==void 0&&(O.flipY=S.flipY),S.premultiplyAlpha!==void 0&&(O.premultiplyAlpha=S.premultiplyAlpha),S.unpackAlignment!==void 0&&(O.unpackAlignment=S.unpackAlignment),S.userData!==void 0&&(O.userData=S.userData),p[S.uuid]=O}return p}parseObject(r,o,c,p,v){let w;function S(Z){return o[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Z),o[Z]}function O(Z){if(Z!==void 0){if(Array.isArray(Z)){let ne=[];for(let ce=0,ve=Z.length;ce<ve;ce++){let Fe=Z[ce];c[Fe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Fe),ne.push(c[Fe])}return ne}return c[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Z),c[Z]}}function U(Z){return p[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Z),p[Z]}let K,Y;switch(r.type){case"Scene":w=new po,r.background!==void 0&&(Number.isInteger(r.background)?w.background=new Fn(r.background):w.background=U(r.background)),r.environment!==void 0&&(w.environment=U(r.environment)),r.fog!==void 0&&(r.fog.type==="Fog"?w.fog=new Nh(r.fog.color,r.fog.near,r.fog.far):r.fog.type==="FogExp2"&&(w.fog=new Pu(r.fog.color,r.fog.density)));break;case"PerspectiveCamera":w=new Ys(r.fov,r.aspect,r.near,r.far),r.focus!==void 0&&(w.focus=r.focus),r.zoom!==void 0&&(w.zoom=r.zoom),r.filmGauge!==void 0&&(w.filmGauge=r.filmGauge),r.filmOffset!==void 0&&(w.filmOffset=r.filmOffset),r.view!==void 0&&(w.view=Object.assign({},r.view));break;case"OrthographicCamera":w=new Cd(r.left,r.right,r.top,r.bottom,r.near,r.far),r.zoom!==void 0&&(w.zoom=r.zoom),r.view!==void 0&&(w.view=Object.assign({},r.view));break;case"AmbientLight":w=new cy(r.color,r.intensity);break;case"DirectionalLight":w=new uy(r.color,r.intensity);break;case"PointLight":w=new ly(r.color,r.intensity,r.distance,r.decay);break;case"RectAreaLight":w=new hy(r.color,r.intensity,r.width,r.height);break;case"SpotLight":w=new ay(r.color,r.intensity,r.distance,r.angle,r.penumbra,r.decay);break;case"HemisphereLight":w=new iy(r.color,r.groundColor,r.intensity);break;case"LightProbe":w=new Of().fromJSON(r);break;case"SkinnedMesh":K=S(r.geometry),Y=O(r.material),w=new zu(K,Y),r.bindMode!==void 0&&(w.bindMode=r.bindMode),r.bindMatrix!==void 0&&w.bindMatrix.fromArray(r.bindMatrix),r.skeleton!==void 0&&(w.skeleton=r.skeleton);break;case"Mesh":K=S(r.geometry),Y=O(r.material),w=new Ks(K,Y);break;case"InstancedMesh":K=S(r.geometry),Y=O(r.material);let Z=r.count,ne=r.instanceMatrix,ce=r.instanceColor;w=new df(K,Y,Z),w.instanceMatrix=new Oh(new Float32Array(ne.array),16),ce!==void 0&&(w.instanceColor=new Oh(new Float32Array(ce.array),ce.itemSize));break;case"LOD":w=new cf;break;case"Line":w=new Qo(S(r.geometry),O(r.material));break;case"LineLoop":w=new Fm(S(r.geometry),O(r.material));break;case"LineSegments":w=new Ba(S(r.geometry),O(r.material));break;case"PointCloud":case"Points":w=new Fc(S(r.geometry),O(r.material));break;case"Sprite":w=new kc(O(r.material));break;case"Group":w=new Mc;break;case"Bone":w=new Wd;break;default:w=new bi}if(w.uuid=r.uuid,r.name!==void 0&&(w.name=r.name),r.matrix!==void 0?(w.matrix.fromArray(r.matrix),r.matrixAutoUpdate!==void 0&&(w.matrixAutoUpdate=r.matrixAutoUpdate),w.matrixAutoUpdate&&w.matrix.decompose(w.position,w.quaternion,w.scale)):(r.position!==void 0&&w.position.fromArray(r.position),r.rotation!==void 0&&w.rotation.fromArray(r.rotation),r.quaternion!==void 0&&w.quaternion.fromArray(r.quaternion),r.scale!==void 0&&w.scale.fromArray(r.scale)),r.castShadow!==void 0&&(w.castShadow=r.castShadow),r.receiveShadow!==void 0&&(w.receiveShadow=r.receiveShadow),r.shadow&&(r.shadow.bias!==void 0&&(w.shadow.bias=r.shadow.bias),r.shadow.normalBias!==void 0&&(w.shadow.normalBias=r.shadow.normalBias),r.shadow.radius!==void 0&&(w.shadow.radius=r.shadow.radius),r.shadow.mapSize!==void 0&&w.shadow.mapSize.fromArray(r.shadow.mapSize),r.shadow.camera!==void 0&&(w.shadow.camera=this.parseObject(r.shadow.camera))),r.visible!==void 0&&(w.visible=r.visible),r.frustumCulled!==void 0&&(w.frustumCulled=r.frustumCulled),r.renderOrder!==void 0&&(w.renderOrder=r.renderOrder),r.userData!==void 0&&(w.userData=r.userData),r.layers!==void 0&&(w.layers.mask=r.layers),r.children!==void 0){let Z=r.children;for(let ne=0;ne<Z.length;ne++)w.add(this.parseObject(Z[ne],o,c,p,v))}if(r.animations!==void 0){let Z=r.animations;for(let ne=0;ne<Z.length;ne++){let ce=Z[ne];w.animations.push(v[ce])}}if(r.type==="LOD"){r.autoUpdate!==void 0&&(w.autoUpdate=r.autoUpdate);let Z=r.levels;for(let ne=0;ne<Z.length;ne++){let ce=Z[ne],ve=w.getObjectByProperty("uuid",ce.object);ve!==void 0&&w.addLevel(ve,ce.distance)}}return w}bindSkeletons(r,o){Object.keys(o).length!==0&&r.traverse(function(c){if(c.isSkinnedMesh===!0&&c.skeleton!==void 0){let p=o[c.skeleton];p===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",c.skeleton):c.bind(p,c.bindMatrix)}})}setTexturePath(r){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(r)}}let Z1={UVMapping:X,CubeReflectionMapping:te,CubeRefractionMapping:me,EquirectangularReflectionMapping:Le,EquirectangularRefractionMapping:Ye,CubeUVReflectionMapping:rt,CubeUVRefractionMapping:Wt},Ob={RepeatWrapping:mn,ClampToEdgeWrapping:gn,MirroredRepeatWrapping:_n},Bb={NearestFilter:In,NearestMipmapNearestFilter:Yr,NearestMipmapLinearFilter:Ii,LinearFilter:St,LinearMipmapNearestFilter:Kt,LinearMipmapLinearFilter:cr};class Ub extends Za{constructor(r){super(r),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(r){return this.options=r,this}load(r,o,c,p){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);let v=this,w=jh.get(r);if(w!==void 0)return v.manager.itemStart(r),setTimeout(function(){o&&o(w),v.manager.itemEnd(r)},0),w;let S={};S.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",S.headers=this.requestHeader,fetch(r,S).then(function(O){return O.blob()}).then(function(O){return createImageBitmap(O,Object.assign(v.options,{colorSpaceConversion:"none"}))}).then(function(O){jh.add(r,O),o&&o(O),v.manager.itemEnd(r)}).catch(function(O){p&&p(O),v.manager.itemError(r),v.manager.itemEnd(r)}),v.manager.itemStart(r)}}Ub.prototype.isImageBitmapLoader=!0;let sg,my={getContext:function(){return sg===void 0&&(sg=new(window.AudioContext||window.webkitAudioContext)),sg},setContext:function(y){sg=y}};class zb extends Za{constructor(r){super(r)}load(r,o,c,p){let v=this,w=new hu(this.manager);w.setResponseType("arraybuffer"),w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(r,function(S){try{let O=S.slice(0);my.getContext().decodeAudioData(O,function(K){o(K)})}catch(O){p?p(O):console.error(O),v.manager.itemError(r)}},c,p)}}class $b extends Of{constructor(r,o,c=1){super(void 0,c);let p=new Fn().set(r),v=new Fn().set(o),w=new je(p.r,p.g,p.b),S=new je(v.r,v.g,v.b),O=Math.sqrt(Math.PI),U=O*Math.sqrt(.75);this.sh.coefficients[0].copy(w).add(S).multiplyScalar(O),this.sh.coefficients[1].copy(w).sub(S).multiplyScalar(U)}}$b.prototype.isHemisphereLightProbe=!0;class Vb extends Of{constructor(r,o=1){super(void 0,o);let c=new Fn().set(r);this.sh.coefficients[0].set(c.r,c.g,c.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Vb.prototype.isAmbientLightProbe=!0;let Hb=new Wn,Gb=new Wn,Wc=new Wn;class Wb{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ys,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ys,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(r){let o=this._cache;if(o.focus!==r.focus||o.fov!==r.fov||o.aspect!==r.aspect*this.aspect||o.near!==r.near||o.far!==r.far||o.zoom!==r.zoom||o.eyeSep!==this.eyeSep){o.focus=r.focus,o.fov=r.fov,o.aspect=r.aspect*this.aspect,o.near=r.near,o.far=r.far,o.zoom=r.zoom,o.eyeSep=this.eyeSep,Wc.copy(r.projectionMatrix);let p=o.eyeSep/2,v=p*o.near/o.focus,w=o.near*Math.tan(ml*o.fov*.5)/o.zoom,S,O;Gb.elements[12]=-p,Hb.elements[12]=p,S=-w*o.aspect+v,O=w*o.aspect+v,Wc.elements[0]=2*o.near/(O-S),Wc.elements[8]=(O+S)/(O-S),this.cameraL.projectionMatrix.copy(Wc),S=-w*o.aspect-v,O=w*o.aspect-v,Wc.elements[0]=2*o.near/(O-S),Wc.elements[8]=(O+S)/(O-S),this.cameraR.projectionMatrix.copy(Wc)}this.cameraL.matrixWorld.copy(r.matrixWorld).multiply(Gb),this.cameraR.matrixWorld.copy(r.matrixWorld).multiply(Hb)}}class jb{constructor(r=!0){this.autoStart=r,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Xb(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let o=Xb();r=(o-this.oldTime)/1e3,this.oldTime=o,this.elapsedTime+=r}return r}}function Xb(){return(typeof performance>"u"?Date:performance).now()}let Xh=new je,qb=new Hs,Kb=new je,jc=new je;class Yb extends bi{constructor(){super(),this.type="AudioListener",this.context=my.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new jb}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(r){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=r,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}updateMatrixWorld(r){super.updateMatrixWorld(r);let o=this.context.listener,c=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Xh,qb,Kb),jc.set(0,0,-1).applyQuaternion(qb),o.positionX){let p=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(Xh.x,p),o.positionY.linearRampToValueAtTime(Xh.y,p),o.positionZ.linearRampToValueAtTime(Xh.z,p),o.forwardX.linearRampToValueAtTime(jc.x,p),o.forwardY.linearRampToValueAtTime(jc.y,p),o.forwardZ.linearRampToValueAtTime(jc.z,p),o.upX.linearRampToValueAtTime(c.x,p),o.upY.linearRampToValueAtTime(c.y,p),o.upZ.linearRampToValueAtTime(c.z,p)}else o.setPosition(Xh.x,Xh.y,Xh.z),o.setOrientation(jc.x,jc.y,jc.z,c.x,c.y,c.z)}}class gy extends bi{constructor(r){super(),this.type="Audio",this.listener=r,this.context=r.context,this.gain=this.context.createGain(),this.gain.connect(r.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(r){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=r,this.connect(),this}setMediaElementSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(r),this.connect(),this}setMediaStreamSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(r),this.connect(),this}setBuffer(r){return this.buffer=r,this.sourceType="buffer",this.autoplay&&this.play(),this}play(r=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+r;let o=this.context.createBufferSource();return o.buffer=this.buffer,o.loop=this.loop,o.loopStart=this.loopStart,o.loopEnd=this.loopEnd,o.onended=this.onEnded.bind(this),o.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=o,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let r=1,o=this.filters.length;r<o;r++)this.filters[r-1].connect(this.filters[r]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let r=1,o=this.filters.length;r<o;r++)this.filters[r-1].disconnect(this.filters[r]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(r){return r||(r=[]),this._connected===!0?(this.disconnect(),this.filters=r.slice(),this.connect()):this.filters=r.slice(),this}setDetune(r){if(this.detune=r,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(r){return this.setFilters(r?[r]:[])}setPlaybackRate(r){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=r,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(r){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=r,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(r){return this.loopStart=r,this}setLoopEnd(r){return this.loopEnd=r,this}getVolume(){return this.gain.gain.value}setVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}}let Xu=new je,Js=new Hs,du=new je,Ea=new je;class mt extends gy{constructor(r){super(r),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(r){return this.panner.refDistance=r,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(r){return this.panner.rolloffFactor=r,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(r){return this.panner.distanceModel=r,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(r){return this.panner.maxDistance=r,this}setDirectionalCone(r,o,c){return this.panner.coneInnerAngle=r,this.panner.coneOuterAngle=o,this.panner.coneOuterGain=c,this}updateMatrixWorld(r){if(super.updateMatrixWorld(r),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Xu,Js,du),Ea.set(0,0,1).applyQuaternion(Js);let o=this.panner;if(o.positionX){let c=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(Xu.x,c),o.positionY.linearRampToValueAtTime(Xu.y,c),o.positionZ.linearRampToValueAtTime(Xu.z,c),o.orientationX.linearRampToValueAtTime(Ea.x,c),o.orientationY.linearRampToValueAtTime(Ea.y,c),o.orientationZ.linearRampToValueAtTime(Ea.z,c)}else o.setPosition(Xu.x,Xu.y,Xu.z),o.setOrientation(Ea.x,Ea.y,Ea.z)}}class Jr{constructor(r,o=2048){this.analyser=r.context.createAnalyser(),this.analyser.fftSize=o,this.data=new Uint8Array(this.analyser.frequencyBinCount),r.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let r=0,o=this.getFrequencyData();for(let c=0;c<o.length;c++)r+=o[c];return r/o.length}}class ag{constructor(r,o,c){this.binding=r,this.valueSize=c;let p,v,w;switch(o){case"quaternion":p=this._slerp,v=this._slerpAdditive,w=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(c*6),this._workIndex=5;break;case"string":case"bool":p=this._select,v=this._select,w=this._setAdditiveIdentityOther,this.buffer=new Array(c*5);break;default:p=this._lerp,v=this._lerpAdditive,w=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(c*5)}this._mixBufferRegion=p,this._mixBufferRegionAdditive=v,this._setIdentity=w,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(r,o){let c=this.buffer,p=this.valueSize,v=r*p+p,w=this.cumulativeWeight;if(w===0){for(let S=0;S!==p;++S)c[v+S]=c[S];w=o}else{w+=o;let S=o/w;this._mixBufferRegion(c,v,0,S,p)}this.cumulativeWeight=w}accumulateAdditive(r){let o=this.buffer,c=this.valueSize,p=c*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(o,p,0,r,c),this.cumulativeWeightAdditive+=r}apply(r){let o=this.valueSize,c=this.buffer,p=r*o+o,v=this.cumulativeWeight,w=this.cumulativeWeightAdditive,S=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,v<1){let O=o*this._origIndex;this._mixBufferRegion(c,p,O,1-v,o)}w>0&&this._mixBufferRegionAdditive(c,p,this._addIndex*o,1,o);for(let O=o,U=o+o;O!==U;++O)if(c[O]!==c[O+o]){S.setValue(c,p);break}}saveOriginalState(){let r=this.binding,o=this.buffer,c=this.valueSize,p=c*this._origIndex;r.getValue(o,p);for(let v=c,w=p;v!==w;++v)o[v]=o[p+v%c];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let r=this.valueSize*3;this.binding.setValue(this.buffer,r)}_setAdditiveIdentityNumeric(){let r=this._addIndex*this.valueSize,o=r+this.valueSize;for(let c=r;c<o;c++)this.buffer[c]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let r=this._origIndex*this.valueSize,o=this._addIndex*this.valueSize;for(let c=0;c<this.valueSize;c++)this.buffer[o+c]=this.buffer[r+c]}_select(r,o,c,p,v){if(p>=.5)for(let w=0;w!==v;++w)r[o+w]=r[c+w]}_slerp(r,o,c,p){Hs.slerpFlat(r,o,r,o,r,c,p)}_slerpAdditive(r,o,c,p,v){let w=this._workIndex*v;Hs.multiplyQuaternionsFlat(r,w,r,o,r,c),Hs.slerpFlat(r,o,r,o,r,w,p)}_lerp(r,o,c,p,v){let w=1-p;for(let S=0;S!==v;++S){let O=o+S;r[O]=r[O]*w+r[c+S]*p}}_lerpAdditive(r,o,c,p,v){for(let w=0;w!==v;++w){let S=o+w;r[S]=r[S]+r[c+w]*p}}}let qu="\\[\\]\\.:\\/",pu=new RegExp("["+qu+"]","g"),og="[^"+qu+"]",Ja="[^"+qu.replace("\\.","")+"]",fs=/((?:WC+[\/:])*)/.source.replace("WC",og),Ku=/(WCOD+)?/.source.replace("WCOD",Ja),qh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",og),nl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",og),yy=new RegExp("^"+fs+Ku+qh+nl+"$"),vy=["material","materials","bones"];class Bf{constructor(r,o,c){let p=c||Mi.parseTrackName(o);this._targetGroup=r,this._bindings=r.subscribe_(o,p)}getValue(r,o){this.bind();let c=this._targetGroup.nCachedObjects_,p=this._bindings[c];p!==void 0&&p.getValue(r,o)}setValue(r,o){let c=this._bindings;for(let p=this._targetGroup.nCachedObjects_,v=c.length;p!==v;++p)c[p].setValue(r,o)}bind(){let r=this._bindings;for(let o=this._targetGroup.nCachedObjects_,c=r.length;o!==c;++o)r[o].bind()}unbind(){let r=this._bindings;for(let o=this._targetGroup.nCachedObjects_,c=r.length;o!==c;++o)r[o].unbind()}}class Mi{constructor(r,o,c){this.path=o,this.parsedPath=c||Mi.parseTrackName(o),this.node=Mi.findNode(r,this.parsedPath.nodeName)||r,this.rootNode=r,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(r,o,c){return r&&r.isAnimationObjectGroup?new Mi.Composite(r,o,c):new Mi(r,o,c)}static sanitizeNodeName(r){return r.replace(/\s/g,"_").replace(pu,"")}static parseTrackName(r){let o=yy.exec(r);if(!o)throw new Error("PropertyBinding: Cannot parse trackName: "+r);let c={nodeName:o[2],objectName:o[3],objectIndex:o[4],propertyName:o[5],propertyIndex:o[6]},p=c.nodeName&&c.nodeName.lastIndexOf(".");if(p!==void 0&&p!==-1){let v=c.nodeName.substring(p+1);vy.indexOf(v)!==-1&&(c.nodeName=c.nodeName.substring(0,p),c.objectName=v)}if(c.propertyName===null||c.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+r);return c}static findNode(r,o){if(!o||o===""||o==="."||o===-1||o===r.name||o===r.uuid)return r;if(r.skeleton){let c=r.skeleton.getBoneByName(o);if(c!==void 0)return c}if(r.children){let c=function(v){for(let w=0;w<v.length;w++){let S=v[w];if(S.name===o||S.uuid===o)return S;let O=c(S.children);if(O)return O}return null},p=c(r.children);if(p)return p}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(r,o){r[o]=this.targetObject[this.propertyName]}_getValue_array(r,o){let c=this.resolvedProperty;for(let p=0,v=c.length;p!==v;++p)r[o++]=c[p]}_getValue_arrayElement(r,o){r[o]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(r,o){this.resolvedProperty.toArray(r,o)}_setValue_direct(r,o){this.targetObject[this.propertyName]=r[o]}_setValue_direct_setNeedsUpdate(r,o){this.targetObject[this.propertyName]=r[o],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(r,o){this.targetObject[this.propertyName]=r[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,o){let c=this.resolvedProperty;for(let p=0,v=c.length;p!==v;++p)c[p]=r[o++]}_setValue_array_setNeedsUpdate(r,o){let c=this.resolvedProperty;for(let p=0,v=c.length;p!==v;++p)c[p]=r[o++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,o){let c=this.resolvedProperty;for(let p=0,v=c.length;p!==v;++p)c[p]=r[o++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(r,o){this.resolvedProperty[this.propertyIndex]=r[o]}_setValue_arrayElement_setNeedsUpdate(r,o){this.resolvedProperty[this.propertyIndex]=r[o],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(r,o){this.resolvedProperty[this.propertyIndex]=r[o],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(r,o){this.resolvedProperty.fromArray(r,o)}_setValue_fromArray_setNeedsUpdate(r,o){this.resolvedProperty.fromArray(r,o),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(r,o){this.resolvedProperty.fromArray(r,o),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(r,o){this.bind(),this.getValue(r,o)}_setValue_unbound(r,o){this.bind(),this.setValue(r,o)}bind(){let r=this.node,o=this.parsedPath,c=o.objectName,p=o.propertyName,v=o.propertyIndex;if(r||(r=Mi.findNode(this.rootNode,o.nodeName)||this.rootNode,this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!r){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(c){let U=o.objectIndex;switch(c){case"materials":if(!r.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!r.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}r=r.material.materials;break;case"bones":if(!r.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}r=r.skeleton.bones;for(let K=0;K<r.length;K++)if(r[K].name===U){U=K;break}break;default:if(r[c]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}r=r[c]}if(U!==void 0){if(r[U]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);return}r=r[U]}}let w=r[p];if(w===void 0){let U=o.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+U+"."+p+" but it wasn't found.",r);return}let S=this.Versioning.None;this.targetObject=r,r.needsUpdate!==void 0?S=this.Versioning.NeedsUpdate:r.matrixWorldNeedsUpdate!==void 0&&(S=this.Versioning.MatrixWorldNeedsUpdate);let O=this.BindingType.Direct;if(v!==void 0){if(p==="morphTargetInfluences"){if(!r.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(r.geometry.isBufferGeometry){if(!r.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}r.morphTargetDictionary[v]!==void 0&&(v=r.morphTargetDictionary[v])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}O=this.BindingType.ArrayElement,this.resolvedProperty=w,this.propertyIndex=v}else w.fromArray!==void 0&&w.toArray!==void 0?(O=this.BindingType.HasFromToArray,this.resolvedProperty=w):Array.isArray(w)?(O=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=p;this.getValue=this.GetterByBindingType[O],this.setValue=this.SetterByBindingTypeAndVersioning[O][S]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Mi.Composite=Bf,Mi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Mi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Mi.prototype.GetterByBindingType=[Mi.prototype._getValue_direct,Mi.prototype._getValue_array,Mi.prototype._getValue_arrayElement,Mi.prototype._getValue_toArray],Mi.prototype.SetterByBindingTypeAndVersioning=[[Mi.prototype._setValue_direct,Mi.prototype._setValue_direct_setNeedsUpdate,Mi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Mi.prototype._setValue_array,Mi.prototype._setValue_array_setNeedsUpdate,Mi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Mi.prototype._setValue_arrayElement,Mi.prototype._setValue_arrayElement_setNeedsUpdate,Mi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Mi.prototype._setValue_fromArray,Mi.prototype._setValue_fromArray_setNeedsUpdate,Mi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Yu{constructor(){this.uuid=Da(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let r={};this._indicesByUUID=r;for(let c=0,p=arguments.length;c!==p;++c)r[arguments[c].uuid]=c;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let o=this;this.stats={objects:{get total(){return o._objects.length},get inUse(){return this.total-o.nCachedObjects_}},get bindingsPerObject(){return o._bindings.length}}}add(){let r=this._objects,o=this._indicesByUUID,c=this._paths,p=this._parsedPaths,v=this._bindings,w=v.length,S,O=r.length,U=this.nCachedObjects_;for(let K=0,Y=arguments.length;K!==Y;++K){let Z=arguments[K],ne=Z.uuid,ce=o[ne];if(ce===void 0){ce=O++,o[ne]=ce,r.push(Z);for(let ve=0,Fe=w;ve!==Fe;++ve)v[ve].push(new Mi(Z,c[ve],p[ve]))}else if(ce<U){S=r[ce];let ve=--U,Fe=r[ve];o[Fe.uuid]=ce,r[ce]=Fe,o[ne]=ve,r[ve]=Z;for(let fe=0,oe=w;fe!==oe;++fe){let Pe=v[fe],Re=Pe[ve],We=Pe[ce];Pe[ce]=Re,We===void 0&&(We=new Mi(Z,c[fe],p[fe])),Pe[ve]=We}}else r[ce]!==S&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=U}remove(){let r=this._objects,o=this._indicesByUUID,c=this._bindings,p=c.length,v=this.nCachedObjects_;for(let w=0,S=arguments.length;w!==S;++w){let O=arguments[w],U=O.uuid,K=o[U];if(K!==void 0&&K>=v){let Y=v++,Z=r[Y];o[Z.uuid]=K,r[K]=Z,o[U]=Y,r[Y]=O;for(let ne=0,ce=p;ne!==ce;++ne){let ve=c[ne],Fe=ve[Y],fe=ve[K];ve[K]=Fe,ve[Y]=fe}}}this.nCachedObjects_=v}uncache(){let r=this._objects,o=this._indicesByUUID,c=this._bindings,p=c.length,v=this.nCachedObjects_,w=r.length;for(let S=0,O=arguments.length;S!==O;++S){let U=arguments[S],K=U.uuid,Y=o[K];if(Y!==void 0)if(delete o[K],Y<v){let Z=--v,ne=r[Z],ce=--w,ve=r[ce];o[ne.uuid]=Y,r[Y]=ne,o[ve.uuid]=Z,r[Z]=ve,r.pop();for(let Fe=0,fe=p;Fe!==fe;++Fe){let oe=c[Fe],Pe=oe[Z],Re=oe[ce];oe[Y]=Pe,oe[Z]=Re,oe.pop()}}else{let Z=--w,ne=r[Z];Z>0&&(o[ne.uuid]=Y),r[Y]=ne,r.pop();for(let ce=0,ve=p;ce!==ve;++ce){let Fe=c[ce];Fe[Y]=Fe[Z],Fe.pop()}}}this.nCachedObjects_=v}subscribe_(r,o){let c=this._bindingsIndicesByPath,p=c[r],v=this._bindings;if(p!==void 0)return v[p];let w=this._paths,S=this._parsedPaths,O=this._objects,U=O.length,K=this.nCachedObjects_,Y=new Array(U);p=v.length,c[r]=p,w.push(r),S.push(o),v.push(Y);for(let Z=K,ne=O.length;Z!==ne;++Z){let ce=O[Z];Y[Z]=new Mi(ce,r,o)}return Y}unsubscribe_(r){let o=this._bindingsIndicesByPath,c=o[r];if(c!==void 0){let p=this._paths,v=this._parsedPaths,w=this._bindings,S=w.length-1,O=w[S],U=r[S];o[U]=c,w[c]=O,w.pop(),v[c]=v[S],v.pop(),p[c]=p[S],p.pop()}}}Yu.prototype.isAnimationObjectGroup=!0;class J1{constructor(r,o,c=null,p=o.blendMode){this._mixer=r,this._clip=o,this._localRoot=c,this.blendMode=p;let v=o.tracks,w=v.length,S=new Array(w),O={endingStart:Kn,endingEnd:Kn};for(let U=0;U!==w;++U){let K=v[U].createInterpolant(null);S[U]=K,K.settings=O}this._interpolantSettings=O,this._interpolants=S,this._propertyBindings=new Array(w),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Qt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(r){return this._startTime=r,this}setLoop(r,o){return this.loop=r,this.repetitions=o,this}setEffectiveWeight(r){return this.weight=r,this._effectiveWeight=this.enabled?r:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(r){return this._scheduleFading(r,0,1)}fadeOut(r){return this._scheduleFading(r,1,0)}crossFadeFrom(r,o,c){if(r.fadeOut(o),this.fadeIn(o),c){let p=this._clip.duration,v=r._clip.duration,w=v/p,S=p/v;r.warp(1,w,o),this.warp(S,1,o)}return this}crossFadeTo(r,o,c){return r.crossFadeFrom(this,o,c)}stopFading(){let r=this._weightInterpolant;return r!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}setEffectiveTimeScale(r){return this.timeScale=r,this._effectiveTimeScale=this.paused?0:r,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(r){return this.timeScale=this._clip.duration/r,this.stopWarping()}syncWith(r){return this.time=r.time,this.timeScale=r.timeScale,this.stopWarping()}halt(r){return this.warp(this._effectiveTimeScale,0,r)}warp(r,o,c){let p=this._mixer,v=p.time,w=this.timeScale,S=this._timeScaleInterpolant;S===null&&(S=p._lendControlInterpolant(),this._timeScaleInterpolant=S);let O=S.parameterPositions,U=S.sampleValues;return O[0]=v,O[1]=v+c,U[0]=r/w,U[1]=o/w,this}stopWarping(){let r=this._timeScaleInterpolant;return r!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(r,o,c,p){if(!this.enabled){this._updateWeight(r);return}let v=this._startTime;if(v!==null){let O=(r-v)*c;if(O<0||c===0)return;this._startTime=null,o=c*O}o*=this._updateTimeScale(r);let w=this._updateTime(o),S=this._updateWeight(r);if(S>0){let O=this._interpolants,U=this._propertyBindings;switch(this.blendMode){case kr:for(let K=0,Y=O.length;K!==Y;++K)O[K].evaluate(w),U[K].accumulateAdditive(S);break;case Nr:default:for(let K=0,Y=O.length;K!==Y;++K)O[K].evaluate(w),U[K].accumulate(p,S)}}}_updateWeight(r){let o=0;if(this.enabled){o=this.weight;let c=this._weightInterpolant;if(c!==null){let p=c.evaluate(r)[0];o*=p,r>c.parameterPositions[1]&&(this.stopFading(),p===0&&(this.enabled=!1))}}return this._effectiveWeight=o,o}_updateTimeScale(r){let o=0;if(!this.paused){o=this.timeScale;let c=this._timeScaleInterpolant;c!==null&&(o*=c.evaluate(r)[0],r>c.parameterPositions[1]&&(this.stopWarping(),o===0?this.paused=!0:this.timeScale=o))}return this._effectiveTimeScale=o,o}_updateTime(r){let o=this._clip.duration,c=this.loop,p=this.time+r,v=this._loopCount,w=c===At;if(r===0)return v===-1?p:w&&(v&1)===1?o-p:p;if(c===Yt){v===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(p>=o)p=o;else if(p<0)p=0;else{this.time=p;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=p,this._mixer.dispatchEvent({type:"finished",action:this,direction:r<0?-1:1})}}else{if(v===-1&&(r>=0?(v=0,this._setEndings(!0,this.repetitions===0,w)):this._setEndings(this.repetitions===0,!0,w)),p>=o||p<0){let S=Math.floor(p/o);p-=o*S,v+=Math.abs(S);let O=this.repetitions-v;if(O<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,p=r>0?o:0,this.time=p,this._mixer.dispatchEvent({type:"finished",action:this,direction:r>0?1:-1});else{if(O===1){let U=r<0;this._setEndings(U,!U,w)}else this._setEndings(!1,!1,w);this._loopCount=v,this.time=p,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:S})}}else this.time=p;if(w&&(v&1)===1)return o-p}return p}_setEndings(r,o,c){let p=this._interpolantSettings;c?(p.endingStart=hr,p.endingEnd=hr):(r?p.endingStart=this.zeroSlopeAtStart?hr:Kn:p.endingStart=Rr,o?p.endingEnd=this.zeroSlopeAtEnd?hr:Kn:p.endingEnd=Rr)}_scheduleFading(r,o,c){let p=this._mixer,v=p.time,w=this._weightInterpolant;w===null&&(w=p._lendControlInterpolant(),this._weightInterpolant=w);let S=w.parameterPositions,O=w.sampleValues;return S[0]=v,O[0]=o,S[1]=v+r,O[1]=c,this}}class Xc extends to{constructor(r){super(),this._root=r,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(r,o){let c=r._localRoot||this._root,p=r._clip.tracks,v=p.length,w=r._propertyBindings,S=r._interpolants,O=c.uuid,U=this._bindingsByRootAndName,K=U[O];K===void 0&&(K={},U[O]=K);for(let Y=0;Y!==v;++Y){let Z=p[Y],ne=Z.name,ce=K[ne];if(ce!==void 0)++ce.referenceCount,w[Y]=ce;else{if(ce=w[Y],ce!==void 0){ce._cacheIndex===null&&(++ce.referenceCount,this._addInactiveBinding(ce,O,ne));continue}let ve=o&&o._propertyBindings[Y].binding.parsedPath;ce=new ag(Mi.create(c,ne,ve),Z.ValueTypeName,Z.getValueSize()),++ce.referenceCount,this._addInactiveBinding(ce,O,ne),w[Y]=ce}S[Y].resultBuffer=ce.buffer}}_activateAction(r){if(!this._isActiveAction(r)){if(r._cacheIndex===null){let c=(r._localRoot||this._root).uuid,p=r._clip.uuid,v=this._actionsByClip[p];this._bindAction(r,v&&v.knownActions[0]),this._addInactiveAction(r,p,c)}let o=r._propertyBindings;for(let c=0,p=o.length;c!==p;++c){let v=o[c];v.useCount++===0&&(this._lendBinding(v),v.saveOriginalState())}this._lendAction(r)}}_deactivateAction(r){if(this._isActiveAction(r)){let o=r._propertyBindings;for(let c=0,p=o.length;c!==p;++c){let v=o[c];--v.useCount===0&&(v.restoreOriginalState(),this._takeBackBinding(v))}this._takeBackAction(r)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let r=this;this.stats={actions:{get total(){return r._actions.length},get inUse(){return r._nActiveActions}},bindings:{get total(){return r._bindings.length},get inUse(){return r._nActiveBindings}},controlInterpolants:{get total(){return r._controlInterpolants.length},get inUse(){return r._nActiveControlInterpolants}}}}_isActiveAction(r){let o=r._cacheIndex;return o!==null&&o<this._nActiveActions}_addInactiveAction(r,o,c){let p=this._actions,v=this._actionsByClip,w=v[o];if(w===void 0)w={knownActions:[r],actionByRoot:{}},r._byClipCacheIndex=0,v[o]=w;else{let S=w.knownActions;r._byClipCacheIndex=S.length,S.push(r)}r._cacheIndex=p.length,p.push(r),w.actionByRoot[c]=r}_removeInactiveAction(r){let o=this._actions,c=o[o.length-1],p=r._cacheIndex;c._cacheIndex=p,o[p]=c,o.pop(),r._cacheIndex=null;let v=r._clip.uuid,w=this._actionsByClip,S=w[v],O=S.knownActions,U=O[O.length-1],K=r._byClipCacheIndex;U._byClipCacheIndex=K,O[K]=U,O.pop(),r._byClipCacheIndex=null;let Y=S.actionByRoot,Z=(r._localRoot||this._root).uuid;delete Y[Z],O.length===0&&delete w[v],this._removeInactiveBindingsForAction(r)}_removeInactiveBindingsForAction(r){let o=r._propertyBindings;for(let c=0,p=o.length;c!==p;++c){let v=o[c];--v.referenceCount===0&&this._removeInactiveBinding(v)}}_lendAction(r){let o=this._actions,c=r._cacheIndex,p=this._nActiveActions++,v=o[p];r._cacheIndex=p,o[p]=r,v._cacheIndex=c,o[c]=v}_takeBackAction(r){let o=this._actions,c=r._cacheIndex,p=--this._nActiveActions,v=o[p];r._cacheIndex=p,o[p]=r,v._cacheIndex=c,o[c]=v}_addInactiveBinding(r,o,c){let p=this._bindingsByRootAndName,v=this._bindings,w=p[o];w===void 0&&(w={},p[o]=w),w[c]=r,r._cacheIndex=v.length,v.push(r)}_removeInactiveBinding(r){let o=this._bindings,c=r.binding,p=c.rootNode.uuid,v=c.path,w=this._bindingsByRootAndName,S=w[p],O=o[o.length-1],U=r._cacheIndex;O._cacheIndex=U,o[U]=O,o.pop(),delete S[v],Object.keys(S).length===0&&delete w[p]}_lendBinding(r){let o=this._bindings,c=r._cacheIndex,p=this._nActiveBindings++,v=o[p];r._cacheIndex=p,o[p]=r,v._cacheIndex=c,o[c]=v}_takeBackBinding(r){let o=this._bindings,c=r._cacheIndex,p=--this._nActiveBindings,v=o[p];r._cacheIndex=p,o[p]=r,v._cacheIndex=c,o[c]=v}_lendControlInterpolant(){let r=this._controlInterpolants,o=this._nActiveControlInterpolants++,c=r[o];return c===void 0&&(c=new ng(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=o,r[o]=c),c}_takeBackControlInterpolant(r){let o=this._controlInterpolants,c=r.__cacheIndex,p=--this._nActiveControlInterpolants,v=o[p];r.__cacheIndex=p,o[p]=r,v.__cacheIndex=c,o[c]=v}clipAction(r,o,c){let p=o||this._root,v=p.uuid,w=typeof r=="string"?Df.findByName(p,r):r,S=w!==null?w.uuid:r,O=this._actionsByClip[S],U=null;if(c===void 0&&(w!==null?c=w.blendMode:c=Nr),O!==void 0){let Y=O.actionByRoot[v];if(Y!==void 0&&Y.blendMode===c)return Y;U=O.knownActions[0],w===null&&(w=U._clip)}if(w===null)return null;let K=new J1(this,w,o,c);return this._bindAction(K,U),this._addInactiveAction(K,S,v),K}existingAction(r,o){let c=o||this._root,p=c.uuid,v=typeof r=="string"?Df.findByName(c,r):r,w=v?v.uuid:r,S=this._actionsByClip[w];return S!==void 0&&S.actionByRoot[p]||null}stopAllAction(){let r=this._actions,o=this._nActiveActions;for(let c=o-1;c>=0;--c)r[c].stop();return this}update(r){r*=this.timeScale;let o=this._actions,c=this._nActiveActions,p=this.time+=r,v=Math.sign(r),w=this._accuIndex^=1;for(let U=0;U!==c;++U)o[U]._update(p,r,v,w);let S=this._bindings,O=this._nActiveBindings;for(let U=0;U!==O;++U)S[U].apply(w);return this}setTime(r){this.time=0;for(let o=0;o<this._actions.length;o++)this._actions[o].time=0;return this.update(r)}getRoot(){return this._root}uncacheClip(r){let o=this._actions,c=r.uuid,p=this._actionsByClip,v=p[c];if(v!==void 0){let w=v.knownActions;for(let S=0,O=w.length;S!==O;++S){let U=w[S];this._deactivateAction(U);let K=U._cacheIndex,Y=o[o.length-1];U._cacheIndex=null,U._byClipCacheIndex=null,Y._cacheIndex=K,o[K]=Y,o.pop(),this._removeInactiveBindingsForAction(U)}delete p[c]}}uncacheRoot(r){let o=r.uuid,c=this._actionsByClip;for(let w in c){let S=c[w].actionByRoot,O=S[o];O!==void 0&&(this._deactivateAction(O),this._removeInactiveAction(O))}let p=this._bindingsByRootAndName,v=p[o];if(v!==void 0)for(let w in v){let S=v[w];S.restoreOriginalState(),this._removeInactiveBinding(S)}}uncacheAction(r,o){let c=this.existingAction(r,o);c!==null&&(this._deactivateAction(c),this._removeInactiveAction(c))}}Xc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class rp{constructor(r){typeof r=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),r=arguments[1]),this.value=r}clone(){return new rp(this.value.clone===void 0?this.value:this.value.clone())}}class na extends su{constructor(r,o,c=1){super(r,o),this.meshPerAttribute=c}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}clone(r){let o=super.clone(r);return o.meshPerAttribute=this.meshPerAttribute,o}toJSON(r){let o=super.toJSON(r);return o.isInstancedInterleavedBuffer=!0,o.meshPerAttribute=this.meshPerAttribute,o}}na.prototype.isInstancedInterleavedBuffer=!0;class by{constructor(r,o,c,p,v){this.buffer=r,this.type=o,this.itemSize=c,this.elementSize=p,this.count=v,this.version=0}set needsUpdate(r){r===!0&&this.version++}setBuffer(r){return this.buffer=r,this}setType(r,o){return this.type=r,this.elementSize=o,this}setItemSize(r){return this.itemSize=r,this}setCount(r){return this.count=r,this}}by.prototype.isGLBufferAttribute=!0;class Qb{constructor(r,o,c=0,p=1/0){this.ray=new Mo(r,o),this.near=c,this.far=p,this.camera=null,this.layers=new ph,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(r,o){this.ray.set(r,o)}setFromCamera(r,o){o&&o.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(o.matrixWorld),this.ray.direction.set(r.x,r.y,.5).unproject(o).sub(this.ray.origin).normalize(),this.camera=o):o&&o.isOrthographicCamera?(this.ray.origin.set(r.x,r.y,(o.near+o.far)/(o.near-o.far)).unproject(o),this.ray.direction.set(0,0,-1).transformDirection(o.matrixWorld),this.camera=o):console.error("THREE.Raycaster: Unsupported camera type: "+o.type)}intersectObject(r,o=!0,c=[]){return Kh(r,this,c,o),c.sort(lg),c}intersectObjects(r,o=!0,c=[]){for(let p=0,v=r.length;p<v;p++)Kh(r[p],this,c,o);return c.sort(lg),c}}function lg(y,r){return y.distance-r.distance}function Kh(y,r,o,c){if(y.layers.test(r.layers)&&y.raycast(r,o),c===!0){let p=y.children;for(let v=0,w=p.length;v<w;v++)Kh(p[v],r,o,!0)}}class xy{constructor(r=1,o=0,c=0){return this.radius=r,this.phi=o,this.theta=c,this}set(r,o,c){return this.radius=r,this.phi=o,this.theta=c,this}copy(r){return this.radius=r.radius,this.phi=r.phi,this.theta=r.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,o,c){return this.radius=Math.sqrt(r*r+o*o+c*c),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r,c),this.phi=Math.acos(Vs(o/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class wy{constructor(r=1,o=0,c=0){return this.radius=r,this.theta=o,this.y=c,this}set(r,o,c){return this.radius=r,this.theta=o,this.y=c,this}copy(r){return this.radius=r.radius,this.theta=r.theta,this.y=r.y,this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,o,c){return this.radius=Math.sqrt(r*r+c*c),this.theta=Math.atan2(r,c),this.y=o,this}clone(){return new this.constructor().copy(this)}}let ug=new un;class qc{constructor(r=new un(1/0,1/0),o=new un(-1/0,-1/0)){this.min=r,this.max=o}set(r,o){return this.min.copy(r),this.max.copy(o),this}setFromPoints(r){this.makeEmpty();for(let o=0,c=r.length;o<c;o++)this.expandByPoint(r[o]);return this}setFromCenterAndSize(r,o){let c=ug.copy(o).multiplyScalar(.5);return this.min.copy(r).sub(c),this.max.copy(r).add(c),this}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(r){return this.isEmpty()?r.set(0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y}getParameter(r,o){return o.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y)}clampPoint(r,o){return o.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return ug.copy(r).clamp(this.min,this.max).sub(r).length()}intersect(r){return this.min.max(r.min),this.max.min(r.max),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}qc.prototype.isBox2=!0;let Ay=new je,Ds=new je;class Ey{constructor(r=new je,o=new je){this.start=r,this.end=o}set(r,o){return this.start.copy(r),this.end.copy(o),this}copy(r){return this.start.copy(r.start),this.end.copy(r.end),this}getCenter(r){return r.addVectors(this.start,this.end).multiplyScalar(.5)}delta(r){return r.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(r,o){return this.delta(o).multiplyScalar(r).add(this.start)}closestPointToPointParameter(r,o){Ay.subVectors(r,this.start),Ds.subVectors(this.end,this.start);let c=Ds.dot(Ds),v=Ds.dot(Ay)/c;return o&&(v=Vs(v,0,1)),v}closestPointToPoint(r,o,c){let p=this.closestPointToPointParameter(r,o);return this.delta(c).multiplyScalar(p).add(this.start)}applyMatrix4(r){return this.start.applyMatrix4(r),this.end.applyMatrix4(r),this}equals(r){return r.start.equals(this.start)&&r.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}let ea=new je;class ew extends bi{constructor(r,o){super(),this.light=r,this.light.updateMatrixWorld(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=o;let c=new Or,p=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let w=0,S=1,O=32;w<O;w++,S++){let U=w/O*Math.PI*2,K=S/O*Math.PI*2;p.push(Math.cos(U),Math.sin(U),1,Math.cos(K),Math.sin(K),1)}c.setAttribute("position",new lr(p,3));let v=new ts({fog:!1,toneMapped:!1});this.cone=new Ba(c,v),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();let r=this.light.distance?this.light.distance:1e3,o=r*Math.tan(this.light.angle);this.cone.scale.set(o,o,r),ea.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ea),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}let Kc=new je,cg=new Wn,Sy=new Wn;class Zb extends Ba{constructor(r){let o=Jb(r),c=new Or,p=[],v=[],w=new Fn(0,0,1),S=new Fn(0,1,0);for(let U=0;U<o.length;U++){let K=o[U];K.parent&&K.parent.isBone&&(p.push(0,0,0),p.push(0,0,0),v.push(w.r,w.g,w.b),v.push(S.r,S.g,S.b))}c.setAttribute("position",new lr(p,3)),c.setAttribute("color",new lr(v,3));let O=new ts({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(c,O),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=r,this.bones=o,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(r){let o=this.bones,c=this.geometry,p=c.getAttribute("position");Sy.copy(this.root.matrixWorld).invert();for(let v=0,w=0;v<o.length;v++){let S=o[v];S.parent&&S.parent.isBone&&(cg.multiplyMatrices(Sy,S.matrixWorld),Kc.setFromMatrixPosition(cg),p.setXYZ(w,Kc.x,Kc.y,Kc.z),cg.multiplyMatrices(Sy,S.parent.matrixWorld),Kc.setFromMatrixPosition(cg),p.setXYZ(w+1,Kc.x,Kc.y,Kc.z),w+=2)}c.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(r)}}function Jb(y){let r=[];y&&y.isBone&&r.push(y);for(let o=0;o<y.children.length;o++)r.push.apply(r,Jb(y.children[o]));return r}class tw extends Ks{constructor(r,o,c){let p=new $c(o,4,2),v=new os({wireframe:!0,fog:!1,toneMapped:!1});super(p,v),this.light=r,this.light.updateMatrixWorld(),this.color=c,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}let nw=new je,ex=new Fn,Yh=new Fn;class Xs extends bi{constructor(r,o,c){super(),this.light=r,this.light.updateMatrixWorld(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=c;let p=new Bc(o);p.rotateY(Math.PI*.5),this.material=new os({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);let v=p.getAttribute("position"),w=new Float32Array(v.count*3);p.setAttribute("color",new Ri(w,3)),this.add(new Ks(p,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let r=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{let o=r.geometry.getAttribute("color");ex.copy(this.light.color),Yh.copy(this.light.groundColor);for(let c=0,p=o.count;c<p;c++){let v=c<p/2?ex:Yh;o.setXYZ(c,v.r,v.g,v.b)}o.needsUpdate=!0}r.lookAt(nw.setFromMatrixPosition(this.light.matrixWorld).negate())}}class fo extends Ba{constructor(r=10,o=10,c=4473924,p=8947848){c=new Fn(c),p=new Fn(p);let v=o/2,w=r/o,S=r/2,O=[],U=[];for(let Z=0,ne=0,ce=-S;Z<=o;Z++,ce+=w){O.push(-S,0,ce,S,0,ce),O.push(ce,0,-S,ce,0,S);let ve=Z===v?c:p;ve.toArray(U,ne),ne+=3,ve.toArray(U,ne),ne+=3,ve.toArray(U,ne),ne+=3,ve.toArray(U,ne),ne+=3}let K=new Or;K.setAttribute("position",new lr(O,3)),K.setAttribute("color",new lr(U,3));let Y=new ts({vertexColors:!0,toneMapped:!1});super(K,Y),this.type="GridHelper"}}class tx extends Ba{constructor(r=10,o=16,c=8,p=64,v=4473924,w=8947848){v=new Fn(v),w=new Fn(w);let S=[],O=[];for(let Y=0;Y<=o;Y++){let Z=Y/o*(Math.PI*2),ne=Math.sin(Z)*r,ce=Math.cos(Z)*r;S.push(0,0,0),S.push(ne,0,ce);let ve=Y&1?v:w;O.push(ve.r,ve.g,ve.b),O.push(ve.r,ve.g,ve.b)}for(let Y=0;Y<=c;Y++){let Z=Y&1?v:w,ne=r-r/c*Y;for(let ce=0;ce<p;ce++){let ve=ce/p*(Math.PI*2),Fe=Math.sin(ve)*ne,fe=Math.cos(ve)*ne;S.push(Fe,0,fe),O.push(Z.r,Z.g,Z.b),ve=(ce+1)/p*(Math.PI*2),Fe=Math.sin(ve)*ne,fe=Math.cos(ve)*ne,S.push(Fe,0,fe),O.push(Z.r,Z.g,Z.b)}}let U=new Or;U.setAttribute("position",new lr(S,3)),U.setAttribute("color",new lr(O,3));let K=new ts({vertexColors:!0,toneMapped:!1});super(U,K),this.type="PolarGridHelper"}}let ip=new je,fu=new je,Ty=new je;class nx extends bi{constructor(r,o,c){super(),this.light=r,this.light.updateMatrixWorld(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=c,o===void 0&&(o=1);let p=new Or;p.setAttribute("position",new lr([-o,o,0,o,o,0,o,-o,0,-o,-o,0,-o,o,0],3));let v=new ts({fog:!1,toneMapped:!1});this.lightPlane=new Qo(p,v),this.add(this.lightPlane),p=new Or,p.setAttribute("position",new lr([0,0,0,0,0,1],3)),this.targetLine=new Qo(p,v),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){ip.setFromMatrixPosition(this.light.matrixWorld),fu.setFromMatrixPosition(this.light.target.matrixWorld),Ty.subVectors(fu,ip),this.lightPlane.lookAt(fu),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(fu),this.targetLine.scale.z=Ty.length()}}let hg=new je,Fs=new ro;class Yc extends Ba{constructor(r){let o=new Or,c=new ts({color:16777215,vertexColors:!0,toneMapped:!1}),p=[],v=[],w={},S=new Fn(16755200),O=new Fn(16711680),U=new Fn(43775),K=new Fn(16777215),Y=new Fn(3355443);Z("n1","n2",S),Z("n2","n4",S),Z("n4","n3",S),Z("n3","n1",S),Z("f1","f2",S),Z("f2","f4",S),Z("f4","f3",S),Z("f3","f1",S),Z("n1","f1",S),Z("n2","f2",S),Z("n3","f3",S),Z("n4","f4",S),Z("p","n1",O),Z("p","n2",O),Z("p","n3",O),Z("p","n4",O),Z("u1","u2",U),Z("u2","u3",U),Z("u3","u1",U),Z("c","t",K),Z("p","c",Y),Z("cn1","cn2",Y),Z("cn3","cn4",Y),Z("cf1","cf2",Y),Z("cf3","cf4",Y);function Z(ce,ve,Fe){ne(ce,Fe),ne(ve,Fe)}function ne(ce,ve){p.push(0,0,0),v.push(ve.r,ve.g,ve.b),w[ce]===void 0&&(w[ce]=[]),w[ce].push(p.length/3-1)}o.setAttribute("position",new lr(p,3)),o.setAttribute("color",new lr(v,3)),super(o,c),this.type="CameraHelper",this.camera=r,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=w,this.update()}update(){let r=this.geometry,o=this.pointMap,c=1,p=1;Fs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ms("c",o,r,Fs,0,0,-1),ms("t",o,r,Fs,0,0,1),ms("n1",o,r,Fs,-c,-p,-1),ms("n2",o,r,Fs,c,-p,-1),ms("n3",o,r,Fs,-c,p,-1),ms("n4",o,r,Fs,c,p,-1),ms("f1",o,r,Fs,-c,-p,1),ms("f2",o,r,Fs,c,-p,1),ms("f3",o,r,Fs,-c,p,1),ms("f4",o,r,Fs,c,p,1),ms("u1",o,r,Fs,c*.7,p*1.1,-1),ms("u2",o,r,Fs,-c*.7,p*1.1,-1),ms("u3",o,r,Fs,0,p*2,-1),ms("cf1",o,r,Fs,-c,0,1),ms("cf2",o,r,Fs,c,0,1),ms("cf3",o,r,Fs,0,-p,1),ms("cf4",o,r,Fs,0,p,1),ms("cn1",o,r,Fs,-c,0,-1),ms("cn2",o,r,Fs,c,0,-1),ms("cn3",o,r,Fs,0,-p,-1),ms("cn4",o,r,Fs,0,p,-1),r.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ms(y,r,o,c,p,v,w){hg.set(p,v,w).unproject(c);let S=r[y];if(S!==void 0){let O=o.getAttribute("position");for(let U=0,K=S.length;U<K;U++)O.setXYZ(S[U],hg.x,hg.y,hg.z)}}let Cl=new va;class rl extends Ba{constructor(r,o=16776960){let c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=new Float32Array(8*3),v=new Or;v.setIndex(new Ri(c,1)),v.setAttribute("position",new Ri(p,3)),super(v,new ts({color:o,toneMapped:!1})),this.object=r,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(r){if(r!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Cl.setFromObject(this.object),Cl.isEmpty())return;let o=Cl.min,c=Cl.max,p=this.geometry.attributes.position,v=p.array;v[0]=c.x,v[1]=c.y,v[2]=c.z,v[3]=o.x,v[4]=c.y,v[5]=c.z,v[6]=o.x,v[7]=o.y,v[8]=c.z,v[9]=c.x,v[10]=o.y,v[11]=c.z,v[12]=c.x,v[13]=c.y,v[14]=o.z,v[15]=o.x,v[16]=c.y,v[17]=o.z,v[18]=o.x,v[19]=o.y,v[20]=o.z,v[21]=c.x,v[22]=o.y,v[23]=o.z,p.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(r){return this.object=r,this.update(),this}copy(r){return Ba.prototype.copy.call(this,r),this.object=r.object,this}}class dg extends Ba{constructor(r,o=16776960){let c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],v=new Or;v.setIndex(new Ri(c,1)),v.setAttribute("position",new lr(p,3)),super(v,new ts({color:o,toneMapped:!1})),this.box=r,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(r){let o=this.box;o.isEmpty()||(o.getCenter(this.position),o.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(r))}}class Uf extends Qo{constructor(r,o=1,c=16776960){let p=c,v=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],w=new Or;w.setAttribute("position",new lr(v,3)),w.computeBoundingSphere(),super(w,new ts({color:p,toneMapped:!1})),this.type="PlaneHelper",this.plane=r,this.size=o;let S=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],O=new Or;O.setAttribute("position",new lr(S,3)),O.computeBoundingSphere(),this.add(new Ks(O,new os({color:p,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(r){let o=-this.plane.constant;Math.abs(o)<1e-8&&(o=1e-8),this.scale.set(.5*this.size,.5*this.size,o),this.children[0].material.side=o<0?B:D,this.lookAt(this.plane.normal),super.updateMatrixWorld(r)}}let Qc=new je,sp,ap;class My extends bi{constructor(r=new je(0,0,1),o=new je(0,0,0),c=1,p=16776960,v=c*.2,w=v*.2){super(),this.type="ArrowHelper",sp===void 0&&(sp=new Or,sp.setAttribute("position",new lr([0,0,0,0,1,0],3)),ap=new Vu(0,.5,1,5,1),ap.translate(0,-.5,0)),this.position.copy(o),this.line=new Qo(sp,new ts({color:p,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ks(ap,new os({color:p,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(c,v,w)}setDirection(r){if(r.y>.99999)this.quaternion.set(0,0,0,1);else if(r.y<-.99999)this.quaternion.set(1,0,0,0);else{Qc.set(r.z,0,-r.x).normalize();let o=Math.acos(r.y);this.quaternion.setFromAxisAngle(Qc,o)}}setLength(r,o=r*.2,c=o*.2){this.line.scale.set(1,Math.max(1e-4,r-o),1),this.line.updateMatrix(),this.cone.scale.set(c,o,c),this.cone.position.y=r,this.cone.updateMatrix()}setColor(r){this.line.material.color.set(r),this.cone.material.color.set(r)}copy(r){return super.copy(r,!1),this.line.copy(r.line),this.cone.copy(r.cone),this}}class _y extends Ba{constructor(r=1){let o=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],c=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],p=new Or;p.setAttribute("position",new lr(o,3)),p.setAttribute("color",new lr(c,3));let v=new ts({vertexColors:!0,toneMapped:!1});super(p,v),this.type="AxesHelper"}setColors(r,o,c){let p=new Fn,v=this.geometry.attributes.color.array;return p.set(r),p.toArray(v,0),p.toArray(v,3),p.set(o),p.toArray(v,6),p.toArray(v,9),p.set(c),p.toArray(v,12),p.toArray(v,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Cy{constructor(){this.type="ShapePath",this.color=new Fn,this.subPaths=[],this.currentPath=null}moveTo(r,o){return this.currentPath=new Tf,this.subPaths.push(this.currentPath),this.currentPath.moveTo(r,o),this}lineTo(r,o){return this.currentPath.lineTo(r,o),this}quadraticCurveTo(r,o,c,p){return this.currentPath.quadraticCurveTo(r,o,c,p),this}bezierCurveTo(r,o,c,p,v,w){return this.currentPath.bezierCurveTo(r,o,c,p,v,w),this}splineThru(r){return this.currentPath.splineThru(r),this}toShapes(r,o){function c(oe){let Pe=[];for(let Re=0,We=oe.length;Re<We;Re++){let Je=oe[Re],dt=new uu;dt.curves=Je.curves,Pe.push(dt)}return Pe}function p(oe,Pe){let Re=Pe.length,We=!1;for(let Je=Re-1,dt=0;dt<Re;Je=dt++){let wt=Pe[Je],Dt=Pe[dt],Ft=Dt.x-wt.x,De=Dt.y-wt.y;if(Math.abs(De)>Number.EPSILON){if(De<0&&(wt=Pe[dt],Ft=-Ft,Dt=Pe[Je],De=-De),oe.y<wt.y||oe.y>Dt.y)continue;if(oe.y===wt.y){if(oe.x===wt.x)return!0}else{let nt=De*(oe.x-wt.x)-Ft*(oe.y-wt.y);if(nt===0)return!0;if(nt<0)continue;We=!We}}else{if(oe.y!==wt.y)continue;if(Dt.x<=oe.x&&oe.x<=wt.x||wt.x<=oe.x&&oe.x<=Dt.x)return!0}}return We}let v=el.isClockWise,w=this.subPaths;if(w.length===0)return[];if(o===!0)return c(w);let S,O,U,K=[];if(w.length===1)return O=w[0],U=new uu,U.curves=O.curves,K.push(U),K;let Y=!v(w[0].getPoints());Y=r?!Y:Y;let Z=[],ne=[],ce=[],ve=0,Fe;ne[ve]=void 0,ce[ve]=[];for(let oe=0,Pe=w.length;oe<Pe;oe++)O=w[oe],Fe=O.getPoints(),S=v(Fe),S=r?!S:S,S?(!Y&&ne[ve]&&ve++,ne[ve]={s:new uu,p:Fe},ne[ve].s.curves=O.curves,Y&&ve++,ce[ve]=[]):ce[ve].push({h:O,p:Fe[0]});if(!ne[0])return c(w);if(ne.length>1){let oe=!1,Pe=[];for(let Re=0,We=ne.length;Re<We;Re++)Z[Re]=[];for(let Re=0,We=ne.length;Re<We;Re++){let Je=ce[Re];for(let dt=0;dt<Je.length;dt++){let wt=Je[dt],Dt=!0;for(let Ft=0;Ft<ne.length;Ft++)p(wt.p,ne[Ft].p)&&(Re!==Ft&&Pe.push({froms:Re,tos:Ft,hole:dt}),Dt?(Dt=!1,Z[Ft].push(wt)):oe=!0);Dt&&Z[Re].push(wt)}}Pe.length>0&&(oe||(ce=Z))}let fe;for(let oe=0,Pe=ne.length;oe<Pe;oe++){U=ne[oe].s,K.push(U),fe=ce[oe];for(let Re=0,We=fe.length;Re<We;Re++)U.holes.push(fe[Re].h)}return K}}let zf=new Float32Array(1),Qu=new Int32Array(zf.buffer);class rx{static toHalfFloat(r){r>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),r=65504),zf[0]=r;let o=Qu[0],c=o>>16&32768,p=o>>12&2047,v=o>>23&255;return v<103?c:v>142?(c|=31744,c|=(v==255?0:1)&&o&8388607,c):v<113?(p|=2048,c|=(p>>114-v)+(p>>113-v&1),c):(c|=v-112<<10|p>>1,c+=p&1,c)}}let $f=0,Iy=1,Il=0,ix=1,Vf=2;function rw(y){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),y}function iw(y=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),y.isMultiMaterial=!0,y.materials=y,y.clone=function(){return y.slice()},y}function il(y,r){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Fc(y,r)}function ky(y){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new kc(y)}function pg(y,r){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Fc(y,r)}function Ry(y){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Dc(y)}function Ny(y){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Dc(y)}function Ly(y){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Dc(y)}function Dy(y,r,o){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new je(y,r,o)}function Fy(y,r){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ri(y,r).setUsage(fl)}function eo(y,r){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ql(y,r)}function fg(y,r){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Mu(y,r)}function mg(y,r){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ha(y,r)}function gg(y,r){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new jg(y,r)}function yg(y,r){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Co(y,r)}function vg(y,r){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new hc(y,r)}function bg(y,r){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new dm(y,r)}function Py(y,r){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new lr(y,r)}function sx(y,r){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new lv(y,r)}Ro.create=function(y,r){return console.log("THREE.Curve.create() has been deprecated"),y.prototype=Object.create(Ro.prototype),y.prototype.constructor=y,y.prototype.getPoint=r,y},Tf.prototype.fromPoints=function(y){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(y)};function ax(y){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new _y(y)}function Cs(y,r){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new rl(y,r)}function Ss(y,r){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ba(new q0(y.geometry),new ts({color:r!==void 0?r:16777215}))}fo.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Zb.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function sw(y,r){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ba(new kf(y.geometry),new ts({color:r!==void 0?r:16777215}))}Za.prototype.extractUrlBase=function(y){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ig.extractUrlBase(y)},Za.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function aw(y){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new hu(y)}function ow(y){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Mb(y)}qc.prototype.center=function(y){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(y)},qc.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},qc.prototype.isIntersectionBox=function(y){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(y)},qc.prototype.size=function(y){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(y)},va.prototype.center=function(y){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(y)},va.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},va.prototype.isIntersectionBox=function(y){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(y)},va.prototype.isIntersectionSphere=function(y){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(y)},va.prototype.size=function(y){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(y)},xl.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Vp.prototype.setFromMatrix=function(y){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(y)},Ey.prototype.center=function(y){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(y)},Ts.prototype.flattenToArrayOffset=function(y,r){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(y,r)},Ts.prototype.multiplyVector3=function(y){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),y.applyMatrix3(this)},Ts.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ts.prototype.applyToBufferAttribute=function(y){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),y.applyMatrix3(this)},Ts.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ts.prototype.getInverse=function(y){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(y).invert()},Wn.prototype.extractPosition=function(y){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(y)},Wn.prototype.flattenToArrayOffset=function(y,r){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(y,r)},Wn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new je().setFromMatrixColumn(this,3)},Wn.prototype.setRotationFromQuaternion=function(y){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(y)},Wn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Wn.prototype.multiplyVector3=function(y){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),y.applyMatrix4(this)},Wn.prototype.multiplyVector4=function(y){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),y.applyMatrix4(this)},Wn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Wn.prototype.rotateAxis=function(y){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),y.transformDirection(this)},Wn.prototype.crossVector=function(y){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),y.applyMatrix4(this)},Wn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Wn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Wn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Wn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Wn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Wn.prototype.applyToBufferAttribute=function(y){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),y.applyMatrix4(this)},Wn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Wn.prototype.makeFrustum=function(y,r,o,c,p,v){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(y,r,c,o,p,v)},Wn.prototype.getInverse=function(y){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(y).invert()},qo.prototype.isIntersectionLine=function(y){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(y)},Hs.prototype.multiplyVector3=function(y){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),y.applyQuaternion(this)},Hs.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Mo.prototype.isIntersectionBox=function(y){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(y)},Mo.prototype.isIntersectionPlane=function(y){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(y)},Mo.prototype.isIntersectionSphere=function(y){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(y)},Gs.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Gs.prototype.barycoordFromPoint=function(y,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(y,r)},Gs.prototype.midpoint=function(y){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(y)},Gs.prototypenormal=function(y){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(y)},Gs.prototype.plane=function(y){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(y)},Gs.barycoordFromPoint=function(y,r,o,c,p){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Gs.getBarycoord(y,r,o,c,p)},Gs.normal=function(y,r,o,c){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Gs.getNormal(y,r,o,c)},uu.prototype.extractAllPoints=function(y){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(y)},uu.prototype.extrude=function(y){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new tl(this,y)},uu.prototype.makeGeometry=function(y){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new zc(this,y)},un.prototype.fromAttribute=function(y,r,o){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(y,r,o)},un.prototype.distanceToManhattan=function(y){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(y)},un.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},je.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},je.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},je.prototype.getPositionFromMatrix=function(y){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(y)},je.prototype.getScaleFromMatrix=function(y){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(y)},je.prototype.getColumnFromMatrix=function(y,r){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(r,y)},je.prototype.applyProjection=function(y){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(y)},je.prototype.fromAttribute=function(y,r,o){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(y,r,o)},je.prototype.distanceToManhattan=function(y){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(y)},je.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Si.prototype.fromAttribute=function(y,r,o){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(y,r,o)},Si.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},bi.prototype.getChildByName=function(y){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(y)},bi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},bi.prototype.translate=function(y,r){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(r,y)},bi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},bi.prototype.applyMatrix=function(y){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(y)},Object.defineProperties(bi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(y){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=y}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Ks.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Ks.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),ki},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),zu.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ys.prototype.setLens=function(y,r){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),r!==void 0&&(this.filmGauge=r),this.setFocalLength(y)},Object.defineProperties(_l.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(y){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=y}},shadowCameraLeft:{set:function(y){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=y}},shadowCameraRight:{set:function(y){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=y}},shadowCameraTop:{set:function(y){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=y}},shadowCameraBottom:{set:function(y){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=y}},shadowCameraNear:{set:function(y){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=y}},shadowCameraFar:{set:function(y){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=y}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(y){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=y}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(y){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=y}},shadowMapHeight:{set:function(y){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=y}}}),Object.defineProperties(Ri.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===fl},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(fl)}}}),Ri.prototype.setDynamic=function(y){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(y===!0?fl:vu),this},Ri.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ri.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Or.prototype.addIndex=function(y){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(y)},Or.prototype.addAttribute=function(y,r){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(r&&r.isBufferAttribute)&&!(r&&r.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(y,new Ri(arguments[1],arguments[2]))):y==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(r),this):this.setAttribute(y,r)},Or.prototype.addDrawCall=function(y,r,o){o!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(y,r)},Or.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Or.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Or.prototype.removeAttribute=function(y){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(y)},Or.prototype.applyMatrix=function(y){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(y)},Object.defineProperties(Or.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),su.prototype.setDynamic=function(y){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(y===!0?fl:vu),this},su.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},tl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},tl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},tl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},po.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},rp.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(ca.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Fn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(y){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=y===j}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(y){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=y}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(da.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(y){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=y}}}),Gi.prototype.clearTarget=function(y,r,o,c){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(y),this.clear(r,o,c)},Gi.prototype.animate=function(y){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(y)},Gi.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Gi.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Gi.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Gi.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Gi.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Gi.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Gi.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Gi.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Gi.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Gi.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Gi.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Gi.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Gi.prototype.enableScissorTest=function(y){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(y)},Gi.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Gi.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Gi.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Gi.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Gi.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Gi.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Gi.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Gi.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Gi.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(y){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=y}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(y){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=y}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(y){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=y===!0?Qr:Ei}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(iu.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function lw(y,r,o){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new at(y,o)}Object.defineProperties(Ta.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(y){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=y}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(y){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=y}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(y){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=y}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(y){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=y}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(y){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=y}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(y){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=y}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(y){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=y}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(y){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=y}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(y){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=y}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(y){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=y}}}),gy.prototype.load=function(y){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let r=this;return new zb().load(y,function(c){r.setBuffer(c)}),this},Jr.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},dc.prototype.updateCubeMap=function(y,r){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(y,r)},dc.prototype.clear=function(y,r,o,c){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(y,r,o,c)},gl.crossOrigin=void 0,gl.loadTexture=function(y,r,o,c){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let p=new _b;p.setCrossOrigin(this.crossOrigin);let v=p.load(y,o,void 0,c);return r&&(v.mapping=r),v},gl.loadTextureCube=function(y,r,o,c){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let p=new Tb;p.setCrossOrigin(this.crossOrigin);let v=p.load(y,o,void 0,c);return r&&(v.mapping=r),v},gl.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},gl.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function uw(){console.error("THREE.CanvasRenderer has been removed")}function cw(){console.error("THREE.JSONLoader has been removed.")}let hw={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function dw(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function pw(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Or}function fw(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Or}function mw(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function gw(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function yw(){console.error("THREE.ImmediateRenderObject has been removed.")}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:z}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=z),E.ACESFilmicToneMapping=ee,E.AddEquation=we,E.AddOperation=ye,E.AdditiveAnimationBlendMode=kr,E.AdditiveBlending=xe,E.AlphaFormat=Fi,E.AlwaysDepth=_i,E.AlwaysStencilFunc=gp,E.AmbientLight=cy,E.AmbientLightProbe=Vb,E.AnimationClip=Df,E.AnimationLoader=Y1,E.AnimationMixer=Xc,E.AnimationObjectGroup=Yu,E.AnimationUtils=Es,E.ArcCurve=K0,E.ArrayCamera=_c,E.ArrowHelper=My,E.Audio=gy,E.AudioAnalyser=Jr,E.AudioContext=my,E.AudioListener=Yb,E.AudioLoader=zb,E.AxesHelper=_y,E.AxisHelper=ax,E.BackSide=B,E.BasicDepthPacking=oa,E.BasicShadowMap=b,E.BinaryTextureLoader=ow,E.Bone=Wd,E.BooleanKeyframeTrack=Do,E.BoundingBoxHelper=Cs,E.Box2=qc,E.Box3=va,E.Box3Helper=dg,E.BoxBufferGeometry=st,E.BoxGeometry=st,E.BoxHelper=rl,E.BufferAttribute=Ri,E.BufferGeometry=Or,E.BufferGeometryLoader=fy,E.ByteType=Ir,E.Cache=jh,E.Camera=ro,E.CameraHelper=Yc,E.CanvasRenderer=uw,E.CanvasTexture=j0,E.CatmullRomCurve3=wf,E.CineonToneMapping=ke,E.CircleBufferGeometry=Uh,E.CircleGeometry=Uh,E.ClampToEdgeWrapping=gn,E.Clock=jb,E.Color=Fn,E.ColorKeyframeTrack=rg,E.CompressedTexture=bf,E.CompressedTextureLoader=Q1,E.ConeBufferGeometry=Hu,E.ConeGeometry=Hu,E.CubeCamera=dc,E.CubeReflectionMapping=te,E.CubeRefractionMapping=me,E.CubeTexture=bh,E.CubeTextureLoader=Tb,E.CubeUVReflectionMapping=rt,E.CubeUVRefractionMapping=Wt,E.CubicBezierCurve=zm,E.CubicBezierCurve3=$m,E.CubicInterpolant=ty,E.CullFaceBack=C,E.CullFaceFront=M,E.CullFaceFrontBack=I,E.CullFaceNone=k,E.Curve=Ro,E.CurvePath=yb,E.CustomBlending=pe,E.CustomToneMapping=ie,E.CylinderBufferGeometry=Vu,E.CylinderGeometry=Vu,E.Cylindrical=wy,E.DataTexture=$u,E.DataTexture2DArray=vc,E.DataTexture3D=Rd,E.DataTextureLoader=Mb,E.DataUtils=rx,E.DecrementStencilOp=Ol,E.DecrementWrapStencilOp=Bl,E.DefaultLoadingManager=Sb,E.DepthFormat=zs,E.DepthStencilFormat=$e,E.DepthTexture=km,E.DirectionalLight=uy,E.DirectionalLightHelper=nx,E.DiscreteInterpolant=ny,E.DodecahedronBufferGeometry=zh,E.DodecahedronGeometry=zh,E.DoubleSide=$,E.DstAlphaFactor=Tn,E.DstColorFactor=Qn,E.DynamicBufferAttribute=Fy,E.DynamicCopyUsage=sd,E.DynamicDrawUsage=fl,E.DynamicReadUsage=vp,E.EdgesGeometry=q0,E.EdgesHelper=Ss,E.EllipseCurve=lu,E.EqualDepth=Qi,E.EqualStencilFunc=pl,E.EquirectangularReflectionMapping=Le,E.EquirectangularRefractionMapping=Ye,E.Euler=Go,E.EventDispatcher=to,E.ExtrudeBufferGeometry=tl,E.ExtrudeGeometry=tl,E.FaceColors=ix,E.FileLoader=hu,E.FlatShading=j,E.Float16BufferAttribute=ov,E.Float32Attribute=Py,E.Float32BufferAttribute=lr,E.Float64Attribute=sx,E.Float64BufferAttribute=lv,E.FloatType=ti,E.Fog=Nh,E.FogExp2=Pu,E.Font=gw,E.FontLoader=mw,E.FramebufferTexture=vf,E.FrontSide=D,E.Frustum=Vp,E.GLBufferAttribute=by,E.GLSL1=tm,E.GLSL3=od,E.GreaterDepth=Kr,E.GreaterEqualDepth=Di,E.GreaterEqualStencilFunc=Jf,E.GreaterStencilFunc=xs,E.GridHelper=fo,E.Group=Mc,E.HalfFloatType=Vi,E.HemisphereLight=iy,E.HemisphereLightHelper=Xs,E.HemisphereLightProbe=$b,E.IcosahedronBufferGeometry=Hh,E.IcosahedronGeometry=Hh,E.ImageBitmapLoader=Ub,E.ImageLoader=Ff,E.ImageUtils=gl,E.ImmediateRenderObject=yw,E.IncrementStencilOp=Pl,E.IncrementWrapStencilOp=Oo,E.InstancedBufferAttribute=Oh,E.InstancedBufferGeometry=py,E.InstancedInterleavedBuffer=na,E.InstancedMesh=df,E.Int16Attribute=gg,E.Int16BufferAttribute=jg,E.Int32Attribute=vg,E.Int32BufferAttribute=hc,E.Int8Attribute=eo,E.Int8BufferAttribute=ql,E.IntType=yi,E.InterleavedBuffer=su,E.InterleavedBufferAttribute=Cc,E.Interpolant=cu,E.InterpolateDiscrete=Pt,E.InterpolateLinear=hn,E.InterpolateSmooth=zn,E.InvertStencilOp=Bo,E.JSONLoader=cw,E.KeepStencilOp=Eo,E.KeyframeTrack=Lo,E.LOD=cf,E.LatheBufferGeometry=Gh,E.LatheGeometry=Gh,E.Layers=ph,E.LensFlare=dw,E.LessDepth=si,E.LessEqualDepth=mi,E.LessEqualStencilFunc=zo,E.LessStencilFunc=Uo,E.Light=_l,E.LightProbe=Of,E.Line=Qo,E.Line3=Ey,E.LineBasicMaterial=ts,E.LineCurve=Sf,E.LineCurve3=ka,E.LineDashedMaterial=tg,E.LineLoop=Fm,E.LinePieces=Iy,E.LineSegments=Ba,E.LineStrip=$f,E.LinearEncoding=Ei,E.LinearFilter=St,E.LinearInterpolant=ng,E.LinearMipMapLinearFilter=ir,E.LinearMipMapNearestFilter=vn,E.LinearMipmapLinearFilter=cr,E.LinearMipmapNearestFilter=Kt,E.LinearToneMapping=Me,E.Loader=Za,E.LoaderUtils=ig,E.LoadingManager=ry,E.LoopOnce=Yt,E.LoopPingPong=At,E.LoopRepeat=Qt,E.LuminanceAlphaFormat=nc,E.LuminanceFormat=aa,E.MOUSE=P,E.Material=ca,E.MaterialLoader=Fb,E.Math=ih,E.MathUtils=ih,E.Matrix3=Ts,E.Matrix4=Wn,E.MaxEquation=Ue,E.Mesh=Ks,E.MeshBasicMaterial=os,E.MeshDepthMaterial=rf,E.MeshDistanceMaterial=ru,E.MeshFaceMaterial=rw,E.MeshLambertMaterial=ey,E.MeshMatcapMaterial=eg,E.MeshNormalMaterial=Jm,E.MeshPhongMaterial=Qm,E.MeshPhysicalMaterial=Ym,E.MeshStandardMaterial=Nf,E.MeshToonMaterial=Zm,E.MinEquation=Ae,E.MirroredRepeatWrapping=_n,E.MixOperation=tn,E.MultiMaterial=iw,E.MultiplyBlending=be,E.MultiplyOperation=ss,E.NearestFilter=In,E.NearestMipMapLinearFilter=Pr,E.NearestMipMapNearestFilter=Zn,E.NearestMipmapLinearFilter=Ii,E.NearestMipmapNearestFilter=Yr,E.NeverDepth=Ar,E.NeverStencilFunc=Ul,E.NoBlending=Q,E.NoColors=Il,E.NoToneMapping=J,E.NormalAnimationBlendMode=Nr,E.NormalBlending=ue,E.NotEqualDepth=Ci,E.NotEqualStencilFunc=rd,E.NumberKeyframeTrack=tp,E.Object3D=bi,E.ObjectLoader=Pb,E.ObjectSpaceNormalMap=ua,E.OctahedronBufferGeometry=Bc,E.OctahedronGeometry=Bc,E.OneFactor=ht,E.OneMinusDstAlphaFactor=xn,E.OneMinusDstColorFactor=Cn,E.OneMinusSrcAlphaFactor=ln,E.OneMinusSrcColorFactor=Et,E.OrthographicCamera=Cd,E.PCFShadowMap=T,E.PCFSoftShadowMap=A,E.PMREMGenerator=tu,E.ParametricGeometry=pw,E.Particle=ky,E.ParticleBasicMaterial=Ny,E.ParticleSystem=pg,E.ParticleSystemMaterial=Ly,E.Path=Tf,E.PerspectiveCamera=Ys,E.Plane=qo,E.PlaneBufferGeometry=eu,E.PlaneGeometry=eu,E.PlaneHelper=Uf,E.PointCloud=il,E.PointCloudMaterial=Ry,E.PointLight=ly,E.PointLightHelper=tw,E.Points=Fc,E.PointsMaterial=Dc,E.PolarGridHelper=tx,E.PolyhedronBufferGeometry=ou,E.PolyhedronGeometry=ou,E.PositionalAudio=mt,E.PropertyBinding=Mi,E.PropertyMixer=ag,E.QuadraticBezierCurve=Zo,E.QuadraticBezierCurve3=Vm,E.Quaternion=Hs,E.QuaternionKeyframeTrack=np,E.QuaternionLinearInterpolant=Eb,E.REVISION=z,E.RGBADepthPacking=la,E.RGBAFormat=li,E.RGBAIntegerFormat=nn,E.RGBA_ASTC_10x10_Format=Ne,E.RGBA_ASTC_10x5_Format=le,E.RGBA_ASTC_10x6_Format=de,E.RGBA_ASTC_10x8_Format=_e,E.RGBA_ASTC_12x10_Format=He,E.RGBA_ASTC_12x12_Format=ct,E.RGBA_ASTC_4x4_Format=Zi,E.RGBA_ASTC_5x4_Format=ks,E.RGBA_ASTC_5x5_Format=Mr,E.RGBA_ASTC_6x5_Format=jr,E.RGBA_ASTC_6x6_Format=Xr,E.RGBA_ASTC_8x5_Format=qs,E.RGBA_ASTC_8x6_Format=Bi,E.RGBA_ASTC_8x8_Format=Ki,E.RGBA_BPTC_Format=gt,E.RGBA_ETC2_EAC_Format=ui,E.RGBA_PVRTC_2BPPV1_Format=qi,E.RGBA_PVRTC_4BPPV1_Format=Tr,E.RGBA_S3TC_DXT1_Format=qn,E.RGBA_S3TC_DXT3_Format=Sn,E.RGBA_S3TC_DXT5_Format=Xt,E.RGB_ETC1_Format=ai,E.RGB_ETC2_Format=Vr,E.RGB_PVRTC_2BPPV1_Format=yr,E.RGB_PVRTC_4BPPV1_Format=nr,E.RGB_S3TC_DXT1_Format=wn,E.RGFormat=Vt,E.RGIntegerFormat=Ge,E.RawShaderMaterial=ja,E.Ray=Mo,E.Raycaster=Qb,E.RectAreaLight=hy,E.RedFormat=et,E.RedIntegerFormat=xt,E.ReinhardToneMapping=Ee,E.RepeatWrapping=mn,E.ReplaceStencilOp=dl,E.ReverseSubtractEquation=Ie,E.RingBufferGeometry=Uc,E.RingGeometry=Uc,E.Scene=po,E.SceneUtils=hw,E.ShaderChunk=yn,E.ShaderLib=rs,E.ShaderMaterial=da,E.ShadowMaterial=Rf,E.Shape=uu,E.ShapeBufferGeometry=zc,E.ShapeGeometry=zc,E.ShapePath=Cy,E.ShapeUtils=el,E.ShortType=Sr,E.Skeleton=Nm,E.SkeletonHelper=Zb,E.SkinnedMesh=zu,E.SmoothShading=q,E.Sphere=xl,E.SphereBufferGeometry=$c,E.SphereGeometry=$c,E.Spherical=xy,E.SphericalHarmonics3=dy,E.SplineCurve=Hm,E.SpotLight=ay,E.SpotLightHelper=ew,E.Sprite=kc,E.SpriteMaterial=Rm,E.SrcAlphaFactor=Mt,E.SrcAlphaSaturateFactor=Mn,E.SrcColorFactor=lt,E.StaticCopyUsage=bp,E.StaticDrawUsage=vu,E.StaticReadUsage=yp,E.StereoCamera=Wb,E.StreamCopyUsage=ad,E.StreamDrawUsage=id,E.StreamReadUsage=em,E.StringKeyframeTrack=Wh,E.SubtractEquation=he,E.SubtractiveBlending=Se,E.TOUCH=L,E.TangentSpaceNormalMap=bs,E.TetrahedronBufferGeometry=ep,E.TetrahedronGeometry=ep,E.TextGeometry=fw,E.Texture=Rs,E.TextureLoader=_b,E.TorusBufferGeometry=Vc,E.TorusGeometry=Vc,E.TorusKnotBufferGeometry=Hc,E.TorusKnotGeometry=Hc,E.Triangle=Gs,E.TriangleFanDrawMode=vs,E.TriangleStripDrawMode=Ji,E.TrianglesDrawMode=ki,E.TubeBufferGeometry=Gc,E.TubeGeometry=Gc,E.UVMapping=X,E.Uint16Attribute=yg,E.Uint16BufferAttribute=Co,E.Uint32Attribute=bg,E.Uint32BufferAttribute=dm,E.Uint8Attribute=fg,E.Uint8BufferAttribute=Mu,E.Uint8ClampedAttribute=mg,E.Uint8ClampedBufferAttribute=ha,E.Uniform=rp,E.UniformsLib=qe,E.UniformsUtils=uv,E.UnsignedByteType=xr,E.UnsignedInt248Type=Xi,E.UnsignedIntType=hs,E.UnsignedShort4444Type=Rn,E.UnsignedShort5551Type=wo,E.UnsignedShortType=gi,E.VSMShadowMap=_,E.Vector2=un,E.Vector3=je,E.Vector4=Si,E.VectorKeyframeTrack=Lf,E.Vertex=Dy,E.VertexColors=Vf,E.VideoTexture=yf,E.WebGL1Renderer=Rh,E.WebGLCubeRenderTarget=at,E.WebGLMultipleRenderTargets=hd,E.WebGLMultisampleRenderTarget=ah,E.WebGLRenderTarget=Ta,E.WebGLRenderTargetCube=lw,E.WebGLRenderer=Gi,E.WebGLUtils=lb,E.WireframeGeometry=kf,E.WireframeHelper=sw,E.WrapAroundEnding=Rr,E.XHRLoader=aw,E.ZeroCurvatureEnding=Kn,E.ZeroFactor=Qe,E.ZeroSlopeEnding=hr,E.ZeroStencilOp=Ao,E._SRGBAFormat=bu,E.sRGBEncoding=Qr,Object.defineProperty(E,"__esModule",{value:!0})})},{}],58:[function(V,re,ae){(function(){class E{static fromCubeTexture(L){let k=0,C=new THREE.Vector3,M=new THREE.Vector3,I=new THREE.Color,b=[0,0,0,0,0,0,0,0,0],T=new THREE.SphericalHarmonics3,A=T.coefficients;for(let D=0;D<6;D++){let B=L.image[D],$=B.width,j=B.height,q=document.createElement("canvas");q.width=$,q.height=j;let Q=q.getContext("2d");Q.drawImage(B,0,0,$,j);let ue=Q.getImageData(0,0,$,j),xe=ue.data,Se=ue.width,be=2/Se;for(let pe=0,we=xe.length;pe<we;pe+=4){I.setRGB(xe[pe]/255,xe[pe+1]/255,xe[pe+2]/255),z(I,L.encoding);let he=pe/4,Ie=-1+(he%Se+.5)*be,Ae=1-(Math.floor(he/Se)+.5)*be;switch(D){case 0:C.set(-1,Ae,-Ie);break;case 1:C.set(1,Ae,Ie);break;case 2:C.set(-Ie,1,-Ae);break;case 3:C.set(-Ie,-1,Ae);break;case 4:C.set(-Ie,Ae,1);break;case 5:C.set(Ie,Ae,-1);break}let Ue=C.lengthSq(),Qe=4/(Math.sqrt(Ue)*Ue);k+=Qe,M.copy(C).normalize(),THREE.SphericalHarmonics3.getBasisAt(M,b);for(let ht=0;ht<9;ht++)A[ht].x+=b[ht]*I.r*Qe,A[ht].y+=b[ht]*I.g*Qe,A[ht].z+=b[ht]*I.b*Qe}}let _=4*Math.PI/k;for(let D=0;D<9;D++)A[D].x*=_,A[D].y*=_,A[D].z*=_;return new THREE.LightProbe(T)}static fromCubeRenderTarget(L,k){let C=0,M=new THREE.Vector3,I=new THREE.Vector3,b=new THREE.Color,T=[0,0,0,0,0,0,0,0,0],A=new THREE.SphericalHarmonics3,_=A.coefficients;for(let B=0;B<6;B++){let $=k.width,j=new Uint8Array($*$*4);L.readRenderTargetPixels(k,0,0,$,$,j,B);let q=2/$;for(let Q=0,ue=j.length;Q<ue;Q+=4){b.setRGB(j[Q]/255,j[Q+1]/255,j[Q+2]/255),z(b,k.texture.encoding);let xe=Q/4,Se=-1+(xe%$+.5)*q,be=1-(Math.floor(xe/$)+.5)*q;switch(B){case 0:M.set(1,be,-Se);break;case 1:M.set(-1,be,Se);break;case 2:M.set(Se,1,-be);break;case 3:M.set(Se,-1,be);break;case 4:M.set(Se,be,1);break;case 5:M.set(-Se,be,-1);break}let pe=M.lengthSq(),we=4/(Math.sqrt(pe)*pe);C+=we,I.copy(M).normalize(),THREE.SphericalHarmonics3.getBasisAt(I,T);for(let he=0;he<9;he++)_[he].x+=T[he]*b.r*we,_[he].y+=T[he]*b.g*we,_[he].z+=T[he]*b.b*we}}let D=4*Math.PI/C;for(let B=0;B<9;B++)_[B].x*=D,_[B].y*=D,_[B].z*=D;return new THREE.LightProbe(A)}}function z(P,L){switch(L){case THREE.sRGBEncoding:P.convertSRGBToLinear();break;case THREE.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.");break}return P}THREE.LightProbeGenerator=E})()},{}],59:[function(V,re,ae){(function(){let E=new WeakMap;class z extends THREE.Loader{constructor(k){super(k),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(k){return this.decoderPath=k,this}setDecoderConfig(k){return this.decoderConfig=k,this}setWorkerLimit(k){return this.workerLimit=k,this}load(k,C,M,I){let b=new THREE.FileLoader(this.manager);b.setPath(this.path),b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(k,T=>{let A={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(T,A).then(C).catch(I)},M,I)}decodeDracoFile(k,C,M,I){let b={attributeIDs:M||this.defaultAttributeIDs,attributeTypes:I||this.defaultAttributeTypes,useUniqueIDs:!!M};this.decodeGeometry(k,b).then(C)}decodeGeometry(k,C){for(let _ in C.attributeTypes){let D=C.attributeTypes[_];D.BYTES_PER_ELEMENT!==void 0&&(C.attributeTypes[_]=D.name)}let M=JSON.stringify(C);if(E.has(k)){let _=E.get(k);if(_.key===M)return _.promise;if(k.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let I,b=this.workerNextTaskID++,T=k.byteLength,A=this._getWorker(b,T).then(_=>(I=_,new Promise((D,B)=>{I._callbacks[b]={resolve:D,reject:B},I.postMessage({type:"decode",id:b,taskConfig:C,buffer:k},[k])}))).then(_=>this._createGeometry(_.geometry));return A.catch(()=>!0).then(()=>{I&&b&&this._releaseTask(I,b)}),E.set(k,{key:M,promise:A}),A}_createGeometry(k){let C=new THREE.BufferGeometry;k.index&&C.setIndex(new THREE.BufferAttribute(k.index.array,1));for(let M=0;M<k.attributes.length;M++){let I=k.attributes[M],b=I.name,T=I.array,A=I.itemSize;C.setAttribute(b,new THREE.BufferAttribute(T,A))}return C}_loadLibrary(k,C){let M=new THREE.FileLoader(this.manager);return M.setPath(this.decoderPath),M.setResponseType(C),M.setWithCredentials(this.withCredentials),new Promise((I,b)=>{M.load(k,I,void 0,b)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let k=typeof WebAssembly!="object"||this.decoderConfig.type==="js",C=[];return k?C.push(this._loadLibrary("draco_decoder.js","text")):(C.push(this._loadLibrary("draco_wasm_wrapper.js","text")),C.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(C).then(M=>{let I=M[0];k||(this.decoderConfig.wasmBinary=M[1]);let b=P.toString(),T=["/* draco decoder */",I,"","/* worker */",b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([T]))}),this.decoderPending}_getWorker(k,C){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let I=new Worker(this.workerSourceURL);I._callbacks={},I._taskCosts={},I._taskLoad=0,I.postMessage({type:"init",decoderConfig:this.decoderConfig}),I.onmessage=function(b){let T=b.data;switch(T.type){case"decode":I._callbacks[T.id].resolve(T);break;case"error":I._callbacks[T.id].reject(T);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+T.type+'"')}},this.workerPool.push(I)}else this.workerPool.sort(function(I,b){return I._taskLoad>b._taskLoad?-1:1});let M=this.workerPool[this.workerPool.length-1];return M._taskCosts[k]=C,M._taskLoad+=C,M})}_releaseTask(k,C){k._taskLoad-=k._taskCosts[C],delete k._callbacks[C],delete k._taskCosts[C]}debug(){console.log("Task load: ",this.workerPool.map(k=>k._taskLoad))}dispose(){for(let k=0;k<this.workerPool.length;++k)this.workerPool[k].terminate();return this.workerPool.length=0,this}}function P(){let L,k;onmessage=function(T){let A=T.data;switch(A.type){case"init":L=A.decoderConfig,k=new Promise(function(B){L.onModuleLoaded=function($){B({draco:$})},DracoDecoderModule(L)});break;case"decode":let _=A.buffer,D=A.taskConfig;k.then(B=>{let $=B.draco,j=new $.Decoder,q=new $.DecoderBuffer;q.Init(new Int8Array(_),_.byteLength);try{let Q=C($,j,q,D),ue=Q.attributes.map(xe=>xe.array.buffer);Q.index&&ue.push(Q.index.array.buffer),self.postMessage({type:"decode",id:A.id,geometry:Q},ue)}catch(Q){console.error(Q),self.postMessage({type:"error",id:A.id,error:Q.message})}finally{$.destroy(q),$.destroy(j)}});break}};function C(T,A,_,D){let B=D.attributeIDs,$=D.attributeTypes,j,q,Q=A.GetEncodedGeometryType(_);if(Q===T.TRIANGULAR_MESH)j=new T.Mesh,q=A.DecodeBufferToMesh(_,j);else if(Q===T.POINT_CLOUD)j=new T.PointCloud,q=A.DecodeBufferToPointCloud(_,j);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!q.ok()||j.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+q.error_msg());let ue={index:null,attributes:[]};for(let xe in B){let Se=self[$[xe]],be,pe;if(D.useUniqueIDs)pe=B[xe],be=A.GetAttributeByUniqueId(j,pe);else{if(pe=A.GetAttributeId(j,T[B[xe]]),pe===-1)continue;be=A.GetAttribute(j,pe)}ue.attributes.push(I(T,A,j,xe,Se,be))}return Q===T.TRIANGULAR_MESH&&(ue.index=M(T,A,j)),T.destroy(j),ue}function M(T,A,_){let B=_.num_faces()*3,$=B*4,j=T._malloc($);A.GetTrianglesUInt32Array(_,$,j);let q=new Uint32Array(T.HEAPF32.buffer,j,B).slice();return T._free(j),{array:q,itemSize:1}}function I(T,A,_,D,B,$){let j=$.num_components(),Q=_.num_points()*j,ue=Q*B.BYTES_PER_ELEMENT,xe=b(T,B),Se=T._malloc(ue);A.GetAttributeDataArrayForAllPoints(_,$,xe,ue,Se);let be=new B(T.HEAPF32.buffer,Se,Q).slice();return T._free(Se),{name:D,array:be,itemSize:j}}function b(T,A){switch(A){case Float32Array:return T.DT_FLOAT32;case Int8Array:return T.DT_INT8;case Int16Array:return T.DT_INT16;case Int32Array:return T.DT_INT32;case Uint8Array:return T.DT_UINT8;case Uint16Array:return T.DT_UINT16;case Uint32Array:return T.DT_UINT32}}}THREE.DRACOLoader=z})()},{}],60:[function(V,re,ae){(function(){class E extends THREE.Loader{constructor(ye){super(ye),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(J){return new C(J)}),this.register(function(J){return new _(J)}),this.register(function(J){return new D(J)}),this.register(function(J){return new M(J)}),this.register(function(J){return new I(J)}),this.register(function(J){return new b(J)}),this.register(function(J){return new T(J)}),this.register(function(J){return new A(J)}),this.register(function(J){return new L(J)}),this.register(function(J){return new B(J)})}load(ye,J,Me,Ee){let ke=this,ee;this.resourcePath!==""?ee=this.resourcePath:this.path!==""?ee=this.path:ee=THREE.LoaderUtils.extractUrlBase(ye),this.manager.itemStart(ye);let ie=function(te){Ee?Ee(te):console.error(te),ke.manager.itemError(ye),ke.manager.itemEnd(ye)},X=new THREE.FileLoader(this.manager);X.setPath(this.path),X.setResponseType("arraybuffer"),X.setRequestHeader(this.requestHeader),X.setWithCredentials(this.withCredentials),X.load(ye,function(te){try{ke.parse(te,ee,function(me){J(me),ke.manager.itemEnd(ye)},ie)}catch(me){ie(me)}},Me,ie)}setDRACOLoader(ye){return this.dracoLoader=ye,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(ye){return this.ktx2Loader=ye,this}setMeshoptDecoder(ye){return this.meshoptDecoder=ye,this}register(ye){return this.pluginCallbacks.indexOf(ye)===-1&&this.pluginCallbacks.push(ye),this}unregister(ye){return this.pluginCallbacks.indexOf(ye)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(ye),1),this}parse(ye,J,Me,Ee){let ke,ee={},ie={};if(typeof ye=="string")ke=ye;else if(THREE.LoaderUtils.decodeText(new Uint8Array(ye,0,4))===$){try{ee[P.KHR_BINARY_GLTF]=new Q(ye)}catch(Le){Ee&&Ee(Le);return}ke=ee[P.KHR_BINARY_GLTF].content}else ke=THREE.LoaderUtils.decodeText(new Uint8Array(ye));let X=JSON.parse(ke);if(X.asset===void 0||X.asset.version[0]<2){Ee&&Ee(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let te=new Qi(X,{path:J||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});te.fileLoader.setRequestHeader(this.requestHeader);for(let me=0;me<this.pluginCallbacks.length;me++){let Le=this.pluginCallbacks[me](te);ie[Le.name]=Le,ee[Le.name]=!0}if(X.extensionsUsed)for(let me=0;me<X.extensionsUsed.length;++me){let Le=X.extensionsUsed[me],Ye=X.extensionsRequired||[];switch(Le){case P.KHR_MATERIALS_UNLIT:ee[Le]=new k;break;case P.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:ee[Le]=new be;break;case P.KHR_DRACO_MESH_COMPRESSION:ee[Le]=new ue(X,this.dracoLoader);break;case P.KHR_TEXTURE_TRANSFORM:ee[Le]=new xe;break;case P.KHR_MESH_QUANTIZATION:ee[Le]=new pe;break;default:Ye.indexOf(Le)>=0&&ie[Le]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+Le+'".')}}te.setExtensions(ee),te.setPlugins(ie),te.parse(Me,Ee)}parseAsync(ye,J){let Me=this;return new Promise(function(Ee,ke){Me.parse(ye,J,Ee,ke)})}}function z(){let tn={};return{get:function(ye){return tn[ye]},add:function(ye,J){tn[ye]=J},remove:function(ye){delete tn[ye]},removeAll:function(){tn={}}}}let P={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class L{constructor(ye){this.parser=ye,this.name=P.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let ye=this.parser,J=this.parser.json.nodes||[];for(let Me=0,Ee=J.length;Me<Ee;Me++){let ke=J[Me];ke.extensions&&ke.extensions[this.name]&&ke.extensions[this.name].light!==void 0&&ye._addNodeRef(this.cache,ke.extensions[this.name].light)}}_loadLight(ye){let J=this.parser,Me="light:"+ye,Ee=J.cache.get(Me);if(Ee)return Ee;let ke=J.json,X=((ke.extensions&&ke.extensions[this.name]||{}).lights||[])[ye],te,me=new THREE.Color(16777215);X.color!==void 0&&me.fromArray(X.color);let Le=X.range!==void 0?X.range:0;switch(X.type){case"directional":te=new THREE.DirectionalLight(me),te.target.position.set(0,0,-1),te.add(te.target);break;case"point":te=new THREE.PointLight(me),te.distance=Le;break;case"spot":te=new THREE.SpotLight(me),te.distance=Le,X.spot=X.spot||{},X.spot.innerConeAngle=X.spot.innerConeAngle!==void 0?X.spot.innerConeAngle:0,X.spot.outerConeAngle=X.spot.outerConeAngle!==void 0?X.spot.outerConeAngle:Math.PI/4,te.angle=X.spot.outerConeAngle,te.penumbra=1-X.spot.innerConeAngle/X.spot.outerConeAngle,te.target.position.set(0,0,-1),te.add(te.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+X.type)}return te.position.set(0,0,0),te.decay=2,X.intensity!==void 0&&(te.intensity=X.intensity),te.name=J.createUniqueName(X.name||"light_"+ye),Ee=Promise.resolve(te),J.cache.add(Me,Ee),Ee}createNodeAttachment(ye){let J=this,Me=this.parser,ke=Me.json.nodes[ye],ie=(ke.extensions&&ke.extensions[this.name]||{}).light;return ie===void 0?null:this._loadLight(ie).then(function(X){return Me._getNodeRef(J.cache,ie,X)})}}class k{constructor(){this.name=P.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(ye,J,Me){let Ee=[];ye.color=new THREE.Color(1,1,1),ye.opacity=1;let ke=J.pbrMetallicRoughness;if(ke){if(Array.isArray(ke.baseColorFactor)){let ee=ke.baseColorFactor;ye.color.fromArray(ee),ye.opacity=ee[3]}ke.baseColorTexture!==void 0&&Ee.push(Me.assignTexture(ye,"map",ke.baseColorTexture))}return Promise.all(Ee)}}class C{constructor(ye){this.parser=ye,this.name=P.KHR_MATERIALS_CLEARCOAT}getMaterialType(ye){let Me=this.parser.json.materials[ye];return!Me.extensions||!Me.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(ye,J){let Me=this.parser,Ee=Me.json.materials[ye];if(!Ee.extensions||!Ee.extensions[this.name])return Promise.resolve();let ke=[],ee=Ee.extensions[this.name];if(ee.clearcoatFactor!==void 0&&(J.clearcoat=ee.clearcoatFactor),ee.clearcoatTexture!==void 0&&ke.push(Me.assignTexture(J,"clearcoatMap",ee.clearcoatTexture)),ee.clearcoatRoughnessFactor!==void 0&&(J.clearcoatRoughness=ee.clearcoatRoughnessFactor),ee.clearcoatRoughnessTexture!==void 0&&ke.push(Me.assignTexture(J,"clearcoatRoughnessMap",ee.clearcoatRoughnessTexture)),ee.clearcoatNormalTexture!==void 0&&(ke.push(Me.assignTexture(J,"clearcoatNormalMap",ee.clearcoatNormalTexture)),ee.clearcoatNormalTexture.scale!==void 0)){let ie=ee.clearcoatNormalTexture.scale;J.clearcoatNormalScale=new THREE.Vector2(ie,ie)}return Promise.all(ke)}}class M{constructor(ye){this.parser=ye,this.name=P.KHR_MATERIALS_SHEEN}getMaterialType(ye){let Me=this.parser.json.materials[ye];return!Me.extensions||!Me.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(ye,J){let Me=this.parser,Ee=Me.json.materials[ye];if(!Ee.extensions||!Ee.extensions[this.name])return Promise.resolve();let ke=[];J.sheenColor=new THREE.Color(0,0,0),J.sheenRoughness=0,J.sheen=1;let ee=Ee.extensions[this.name];return ee.sheenColorFactor!==void 0&&J.sheenColor.fromArray(ee.sheenColorFactor),ee.sheenRoughnessFactor!==void 0&&(J.sheenRoughness=ee.sheenRoughnessFactor),ee.sheenColorTexture!==void 0&&ke.push(Me.assignTexture(J,"sheenColorMap",ee.sheenColorTexture)),ee.sheenRoughnessTexture!==void 0&&ke.push(Me.assignTexture(J,"sheenRoughnessMap",ee.sheenRoughnessTexture)),Promise.all(ke)}}class I{constructor(ye){this.parser=ye,this.name=P.KHR_MATERIALS_TRANSMISSION}getMaterialType(ye){let Me=this.parser.json.materials[ye];return!Me.extensions||!Me.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(ye,J){let Me=this.parser,Ee=Me.json.materials[ye];if(!Ee.extensions||!Ee.extensions[this.name])return Promise.resolve();let ke=[],ee=Ee.extensions[this.name];return ee.transmissionFactor!==void 0&&(J.transmission=ee.transmissionFactor),ee.transmissionTexture!==void 0&&ke.push(Me.assignTexture(J,"transmissionMap",ee.transmissionTexture)),Promise.all(ke)}}class b{constructor(ye){this.parser=ye,this.name=P.KHR_MATERIALS_VOLUME}getMaterialType(ye){let Me=this.parser.json.materials[ye];return!Me.extensions||!Me.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(ye,J){let Me=this.parser,Ee=Me.json.materials[ye];if(!Ee.extensions||!Ee.extensions[this.name])return Promise.resolve();let ke=[],ee=Ee.extensions[this.name];J.thickness=ee.thicknessFactor!==void 0?ee.thicknessFactor:0,ee.thicknessTexture!==void 0&&ke.push(Me.assignTexture(J,"thicknessMap",ee.thicknessTexture)),J.attenuationDistance=ee.attenuationDistance||0;let ie=ee.attenuationColor||[1,1,1];return J.attenuationColor=new THREE.Color(ie[0],ie[1],ie[2]),Promise.all(ke)}}class T{constructor(ye){this.parser=ye,this.name=P.KHR_MATERIALS_IOR}getMaterialType(ye){let Me=this.parser.json.materials[ye];return!Me.extensions||!Me.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(ye,J){let Ee=this.parser.json.materials[ye];if(!Ee.extensions||!Ee.extensions[this.name])return Promise.resolve();let ke=Ee.extensions[this.name];return J.ior=ke.ior!==void 0?ke.ior:1.5,Promise.resolve()}}class A{constructor(ye){this.parser=ye,this.name=P.KHR_MATERIALS_SPECULAR}getMaterialType(ye){let Me=this.parser.json.materials[ye];return!Me.extensions||!Me.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(ye,J){let Me=this.parser,Ee=Me.json.materials[ye];if(!Ee.extensions||!Ee.extensions[this.name])return Promise.resolve();let ke=[],ee=Ee.extensions[this.name];J.specularIntensity=ee.specularFactor!==void 0?ee.specularFactor:1,ee.specularTexture!==void 0&&ke.push(Me.assignTexture(J,"specularIntensityMap",ee.specularTexture));let ie=ee.specularColorFactor||[1,1,1];return J.specularColor=new THREE.Color(ie[0],ie[1],ie[2]),ee.specularColorTexture!==void 0&&ke.push(Me.assignTexture(J,"specularColorMap",ee.specularColorTexture).then(function(X){X.encoding=THREE.sRGBEncoding})),Promise.all(ke)}}class _{constructor(ye){this.parser=ye,this.name=P.KHR_TEXTURE_BASISU}loadTexture(ye){let J=this.parser,Me=J.json,Ee=Me.textures[ye];if(!Ee.extensions||!Ee.extensions[this.name])return null;let ke=Ee.extensions[this.name],ee=Me.images[ke.source],ie=J.options.ktx2Loader;if(!ie){if(Me.extensionsRequired&&Me.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return J.loadTextureImage(ye,ee,ie)}}class D{constructor(ye){this.parser=ye,this.name=P.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(ye){let J=this.name,Me=this.parser,Ee=Me.json,ke=Ee.textures[ye];if(!ke.extensions||!ke.extensions[J])return null;let ee=ke.extensions[J],ie=Ee.images[ee.source],X=Me.textureLoader;if(ie.uri){let te=Me.options.manager.getHandler(ie.uri);te!==null&&(X=te)}return this.detectSupport().then(function(te){if(te)return Me.loadTextureImage(ye,ie,X);if(Ee.extensionsRequired&&Ee.extensionsRequired.indexOf(J)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Me.loadTexture(ye)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ye){let J=new Image;J.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",J.onload=J.onerror=function(){ye(J.height===1)}})),this.isSupported}}class B{constructor(ye){this.name=P.EXT_MESHOPT_COMPRESSION,this.parser=ye}loadBufferView(ye){let J=this.parser.json,Me=J.bufferViews[ye];if(Me.extensions&&Me.extensions[this.name]){let Ee=Me.extensions[this.name],ke=this.parser.getDependency("buffer",Ee.buffer),ee=this.parser.options.meshoptDecoder;if(!ee||!ee.supported){if(J.extensionsRequired&&J.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([ke,ee.ready]).then(function(ie){let X=Ee.byteOffset||0,te=Ee.byteLength||0,me=Ee.count,Le=Ee.byteStride,Ye=new ArrayBuffer(me*Le),rt=new Uint8Array(ie[0],X,te);return ee.decodeGltfBuffer(new Uint8Array(Ye),me,Le,rt,Ee.mode,Ee.filter),Ye})}else return null}}let $="glTF",j=12,q={JSON:1313821514,BIN:5130562};class Q{constructor(ye){this.name=P.KHR_BINARY_GLTF,this.content=null,this.body=null;let J=new DataView(ye,0,j);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(ye.slice(0,4))),version:J.getUint32(4,!0),length:J.getUint32(8,!0)},this.header.magic!==$)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let Me=this.header.length-j,Ee=new DataView(ye,j),ke=0;for(;ke<Me;){let ee=Ee.getUint32(ke,!0);ke+=4;let ie=Ee.getUint32(ke,!0);if(ke+=4,ie===q.JSON){let X=new Uint8Array(ye,j+ke,ee);this.content=THREE.LoaderUtils.decodeText(X)}else if(ie===q.BIN){let X=j+ke;this.body=ye.slice(X,X+ee)}ke+=ee}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ue{constructor(ye,J){if(!J)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=P.KHR_DRACO_MESH_COMPRESSION,this.json=ye,this.dracoLoader=J,this.dracoLoader.preload()}decodePrimitive(ye,J){let Me=this.json,Ee=this.dracoLoader,ke=ye.extensions[this.name].bufferView,ee=ye.extensions[this.name].attributes,ie={},X={},te={};for(let me in ee){let Le=Et[me]||me.toLowerCase();ie[Le]=ee[me]}for(let me in ye.attributes){let Le=Et[me]||me.toLowerCase();if(ee[me]!==void 0){let Ye=Me.accessors[ye.attributes[me]],rt=Ue[Ye.componentType];te[Le]=rt,X[Le]=Ye.normalized===!0}}return J.getDependency("bufferView",ke).then(function(me){return new Promise(function(Le){Ee.decodeDracoFile(me,function(Ye){for(let rt in Ye.attributes){let Wt=Ye.attributes[rt],mn=X[rt];mn!==void 0&&(Wt.normalized=mn)}Le(Ye)},ie,te)})})}}class xe{constructor(){this.name=P.KHR_TEXTURE_TRANSFORM}extendTexture(ye,J){return J.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),J.offset===void 0&&J.rotation===void 0&&J.scale===void 0||(ye=ye.clone(),J.offset!==void 0&&ye.offset.fromArray(J.offset),J.rotation!==void 0&&(ye.rotation=J.rotation),J.scale!==void 0&&ye.repeat.fromArray(J.scale),ye.needsUpdate=!0),ye}}class Se extends THREE.MeshStandardMaterial{constructor(ye){super(),this.isGLTFSpecularGlossinessMaterial=!0;let J=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),Me=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),Ee=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),ke=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),ee=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),ie={specular:{value:new THREE.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=ie,this.onBeforeCompile=function(X){for(let te in ie)X.uniforms[te]=ie[te];X.fragmentShader=X.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",J).replace("#include <metalnessmap_pars_fragment>",Me).replace("#include <roughnessmap_fragment>",Ee).replace("#include <metalnessmap_fragment>",ke).replace("#include <lights_physical_fragment>",ee)},Object.defineProperties(this,{specular:{get:function(){return ie.specular.value},set:function(X){ie.specular.value=X}},specularMap:{get:function(){return ie.specularMap.value},set:function(X){ie.specularMap.value=X,X?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return ie.glossiness.value},set:function(X){ie.glossiness.value=X}},glossinessMap:{get:function(){return ie.glossinessMap.value},set:function(X){ie.glossinessMap.value=X,X?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(ye)}copy(ye){return super.copy(ye),this.specularMap=ye.specularMap,this.specular.copy(ye.specular),this.glossinessMap=ye.glossinessMap,this.glossiness=ye.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class be{constructor(){this.name=P.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Se}extendParams(ye,J,Me){let Ee=J.extensions[this.name];ye.color=new THREE.Color(1,1,1),ye.opacity=1;let ke=[];if(Array.isArray(Ee.diffuseFactor)){let ee=Ee.diffuseFactor;ye.color.fromArray(ee),ye.opacity=ee[3]}if(Ee.diffuseTexture!==void 0&&ke.push(Me.assignTexture(ye,"map",Ee.diffuseTexture)),ye.emissive=new THREE.Color(0,0,0),ye.glossiness=Ee.glossinessFactor!==void 0?Ee.glossinessFactor:1,ye.specular=new THREE.Color(1,1,1),Array.isArray(Ee.specularFactor)&&ye.specular.fromArray(Ee.specularFactor),Ee.specularGlossinessTexture!==void 0){let ee=Ee.specularGlossinessTexture;ke.push(Me.assignTexture(ye,"glossinessMap",ee)),ke.push(Me.assignTexture(ye,"specularMap",ee))}return Promise.all(ke)}createMaterial(ye){let J=new Se(ye);return J.fog=!0,J.color=ye.color,J.map=ye.map===void 0?null:ye.map,J.lightMap=null,J.lightMapIntensity=1,J.aoMap=ye.aoMap===void 0?null:ye.aoMap,J.aoMapIntensity=1,J.emissive=ye.emissive,J.emissiveIntensity=1,J.emissiveMap=ye.emissiveMap===void 0?null:ye.emissiveMap,J.bumpMap=ye.bumpMap===void 0?null:ye.bumpMap,J.bumpScale=1,J.normalMap=ye.normalMap===void 0?null:ye.normalMap,J.normalMapType=THREE.TangentSpaceNormalMap,ye.normalScale&&(J.normalScale=ye.normalScale),J.displacementMap=null,J.displacementScale=1,J.displacementBias=0,J.specularMap=ye.specularMap===void 0?null:ye.specularMap,J.specular=ye.specular,J.glossinessMap=ye.glossinessMap===void 0?null:ye.glossinessMap,J.glossiness=ye.glossiness,J.alphaMap=null,J.envMap=ye.envMap===void 0?null:ye.envMap,J.envMapIntensity=1,J.refractionRatio=.98,J}}class pe{constructor(){this.name=P.KHR_MESH_QUANTIZATION}}class we extends THREE.Interpolant{constructor(ye,J,Me,Ee){super(ye,J,Me,Ee)}copySampleValue_(ye){let J=this.resultBuffer,Me=this.sampleValues,Ee=this.valueSize,ke=ye*Ee*3+Ee;for(let ee=0;ee!==Ee;ee++)J[ee]=Me[ke+ee];return J}}we.prototype.beforeStart_=we.prototype.copySampleValue_,we.prototype.afterEnd_=we.prototype.copySampleValue_,we.prototype.interpolate_=function(tn,ye,J,Me){let Ee=this.resultBuffer,ke=this.sampleValues,ee=this.valueSize,ie=ee*2,X=ee*3,te=Me-ye,me=(J-ye)/te,Le=me*me,Ye=Le*me,rt=tn*X,Wt=rt-X,mn=-2*Ye+3*Le,gn=Ye-Le,_n=1-mn,In=gn-Le+me;for(let Yr=0;Yr!==ee;Yr++){let Zn=ke[Wt+Yr+ee],Ii=ke[Wt+Yr+ie]*te,Pr=ke[rt+Yr+ee],St=ke[rt+Yr]*te;Ee[Yr]=_n*Zn+In*Ii+mn*Pr+gn*St}return Ee};let he=new THREE.Quaternion;class Ie extends we{interpolate_(ye,J,Me,Ee){let ke=super.interpolate_(ye,J,Me,Ee);return he.fromArray(ke).normalize().toArray(ke),ke}}let Ae={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ue={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qe={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},ht={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},lt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Et={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Mt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ln={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},Tn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function xn(tn){return tn.DefaultMaterial===void 0&&(tn.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),tn.DefaultMaterial}function Qn(tn,ye,J){for(let Me in J.extensions)tn[Me]===void 0&&(ye.userData.gltfExtensions=ye.userData.gltfExtensions||{},ye.userData.gltfExtensions[Me]=J.extensions[Me])}function Cn(tn,ye){ye.extras!==void 0&&(typeof ye.extras=="object"?Object.assign(tn.userData,ye.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+ye.extras))}function Mn(tn,ye,J){let Me=!1,Ee=!1;for(let ie=0,X=ye.length;ie<X;ie++){let te=ye[ie];if(te.POSITION!==void 0&&(Me=!0),te.NORMAL!==void 0&&(Ee=!0),Me&&Ee)break}if(!Me&&!Ee)return Promise.resolve(tn);let ke=[],ee=[];for(let ie=0,X=ye.length;ie<X;ie++){let te=ye[ie];if(Me){let me=te.POSITION!==void 0?J.getDependency("accessor",te.POSITION):tn.attributes.position;ke.push(me)}if(Ee){let me=te.NORMAL!==void 0?J.getDependency("accessor",te.NORMAL):tn.attributes.normal;ee.push(me)}}return Promise.all([Promise.all(ke),Promise.all(ee)]).then(function(ie){let X=ie[0],te=ie[1];return Me&&(tn.morphAttributes.position=X),Ee&&(tn.morphAttributes.normal=te),tn.morphTargetsRelative=!0,tn})}function Ar(tn,ye){if(tn.updateMorphTargets(),ye.weights!==void 0)for(let J=0,Me=ye.weights.length;J<Me;J++)tn.morphTargetInfluences[J]=ye.weights[J];if(ye.extras&&Array.isArray(ye.extras.targetNames)){let J=ye.extras.targetNames;if(tn.morphTargetInfluences.length===J.length){tn.morphTargetDictionary={};for(let Me=0,Ee=J.length;Me<Ee;Me++)tn.morphTargetDictionary[J[Me]]=Me}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _i(tn){let ye=tn.extensions&&tn.extensions[P.KHR_DRACO_MESH_COMPRESSION],J;return ye?J="draco:"+ye.bufferView+":"+ye.indices+":"+si(ye.attributes):J=tn.indices+":"+si(tn.attributes)+":"+tn.mode,J}function si(tn){let ye="",J=Object.keys(tn).sort();for(let Me=0,Ee=J.length;Me<Ee;Me++)ye+=J[Me]+":"+tn[J[Me]]+";";return ye}function mi(tn){switch(tn){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Qi{constructor(ye={},J={}){this.json=ye,this.extensions={},this.plugins={},this.options=J,this.cache=new z,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(ye){this.extensions=ye}setPlugins(ye){this.plugins=ye}parse(ye,J){let Me=this,Ee=this.json,ke=this.extensions;this.cache.removeAll(),this._invokeAll(function(ee){return ee._markDefs&&ee._markDefs()}),Promise.all(this._invokeAll(function(ee){return ee.beforeRoot&&ee.beforeRoot()})).then(function(){return Promise.all([Me.getDependencies("scene"),Me.getDependencies("animation"),Me.getDependencies("camera")])}).then(function(ee){let ie={scene:ee[0][Ee.scene||0],scenes:ee[0],animations:ee[1],cameras:ee[2],asset:Ee.asset,parser:Me,userData:{}};Qn(ke,ie,Ee),Cn(ie,Ee),Promise.all(Me._invokeAll(function(X){return X.afterRoot&&X.afterRoot(ie)})).then(function(){ye(ie)})}).catch(J)}_markDefs(){let ye=this.json.nodes||[],J=this.json.skins||[],Me=this.json.meshes||[];for(let Ee=0,ke=J.length;Ee<ke;Ee++){let ee=J[Ee].joints;for(let ie=0,X=ee.length;ie<X;ie++)ye[ee[ie]].isBone=!0}for(let Ee=0,ke=ye.length;Ee<ke;Ee++){let ee=ye[Ee];ee.mesh!==void 0&&(this._addNodeRef(this.meshCache,ee.mesh),ee.skin!==void 0&&(Me[ee.mesh].isSkinnedMesh=!0)),ee.camera!==void 0&&this._addNodeRef(this.cameraCache,ee.camera)}}_addNodeRef(ye,J){J!==void 0&&(ye.refs[J]===void 0&&(ye.refs[J]=ye.uses[J]=0),ye.refs[J]++)}_getNodeRef(ye,J,Me){if(ye.refs[J]<=1)return Me;let Ee=Me.clone(),ke=(ee,ie)=>{let X=this.associations.get(ee);X!=null&&this.associations.set(ie,X);for(let[te,me]of ee.children.entries())ke(me,ie.children[te])};return ke(Me,Ee),Ee.name+="_instance_"+ye.uses[J]++,Ee}_invokeOne(ye){let J=Object.values(this.plugins);J.push(this);for(let Me=0;Me<J.length;Me++){let Ee=ye(J[Me]);if(Ee)return Ee}return null}_invokeAll(ye){let J=Object.values(this.plugins);J.unshift(this);let Me=[];for(let Ee=0;Ee<J.length;Ee++){let ke=ye(J[Ee]);ke&&Me.push(ke)}return Me}getDependency(ye,J){let Me=ye+":"+J,Ee=this.cache.get(Me);if(!Ee){switch(ye){case"scene":Ee=this.loadScene(J);break;case"node":Ee=this.loadNode(J);break;case"mesh":Ee=this._invokeOne(function(ke){return ke.loadMesh&&ke.loadMesh(J)});break;case"accessor":Ee=this.loadAccessor(J);break;case"bufferView":Ee=this._invokeOne(function(ke){return ke.loadBufferView&&ke.loadBufferView(J)});break;case"buffer":Ee=this.loadBuffer(J);break;case"material":Ee=this._invokeOne(function(ke){return ke.loadMaterial&&ke.loadMaterial(J)});break;case"texture":Ee=this._invokeOne(function(ke){return ke.loadTexture&&ke.loadTexture(J)});break;case"skin":Ee=this.loadSkin(J);break;case"animation":Ee=this.loadAnimation(J);break;case"camera":Ee=this.loadCamera(J);break;default:throw new Error("Unknown type: "+ye)}this.cache.add(Me,Ee)}return Ee}getDependencies(ye){let J=this.cache.get(ye);if(!J){let Me=this,Ee=this.json[ye+(ye==="mesh"?"es":"s")]||[];J=Promise.all(Ee.map(function(ke,ee){return Me.getDependency(ye,ee)})),this.cache.add(ye,J)}return J}loadBuffer(ye){let J=this.json.buffers[ye],Me=this.fileLoader;if(J.type&&J.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+J.type+" buffer type is not supported.");if(J.uri===void 0&&ye===0)return Promise.resolve(this.extensions[P.KHR_BINARY_GLTF].body);let Ee=this.options;return new Promise(function(ke,ee){Me.load(THREE.LoaderUtils.resolveURL(J.uri,Ee.path),ke,void 0,function(){ee(new Error('THREE.GLTFLoader: Failed to load buffer "'+J.uri+'".'))})})}loadBufferView(ye){let J=this.json.bufferViews[ye];return this.getDependency("buffer",J.buffer).then(function(Me){let Ee=J.byteLength||0,ke=J.byteOffset||0;return Me.slice(ke,ke+Ee)})}loadAccessor(ye){let J=this,Me=this.json,Ee=this.json.accessors[ye];if(Ee.bufferView===void 0&&Ee.sparse===void 0)return Promise.resolve(null);let ke=[];return Ee.bufferView!==void 0?ke.push(this.getDependency("bufferView",Ee.bufferView)):ke.push(null),Ee.sparse!==void 0&&(ke.push(this.getDependency("bufferView",Ee.sparse.indices.bufferView)),ke.push(this.getDependency("bufferView",Ee.sparse.values.bufferView))),Promise.all(ke).then(function(ee){let ie=ee[0],X=lt[Ee.type],te=Ue[Ee.componentType],me=te.BYTES_PER_ELEMENT,Le=me*X,Ye=Ee.byteOffset||0,rt=Ee.bufferView!==void 0?Me.bufferViews[Ee.bufferView].byteStride:void 0,Wt=Ee.normalized===!0,mn,gn;if(rt&&rt!==Le){let _n=Math.floor(Ye/rt),In="InterleavedBuffer:"+Ee.bufferView+":"+Ee.componentType+":"+_n+":"+Ee.count,Yr=J.cache.get(In);Yr||(mn=new te(ie,_n*rt,Ee.count*rt/me),Yr=new THREE.InterleavedBuffer(mn,rt/me),J.cache.add(In,Yr)),gn=new THREE.InterleavedBufferAttribute(Yr,X,Ye%rt/me,Wt)}else ie===null?mn=new te(Ee.count*X):mn=new te(ie,Ye,Ee.count*X),gn=new THREE.BufferAttribute(mn,X,Wt);if(Ee.sparse!==void 0){let _n=lt.SCALAR,In=Ue[Ee.sparse.indices.componentType],Yr=Ee.sparse.indices.byteOffset||0,Zn=Ee.sparse.values.byteOffset||0,Ii=new In(ee[1],Yr,Ee.sparse.count*_n),Pr=new te(ee[2],Zn,Ee.sparse.count*X);ie!==null&&(gn=new THREE.BufferAttribute(gn.array.slice(),gn.itemSize,gn.normalized));for(let St=0,Kt=Ii.length;St<Kt;St++){let vn=Ii[St];if(gn.setX(vn,Pr[St*X]),X>=2&&gn.setY(vn,Pr[St*X+1]),X>=3&&gn.setZ(vn,Pr[St*X+2]),X>=4&&gn.setW(vn,Pr[St*X+3]),X>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return gn})}loadTexture(ye){let J=this.json,Me=this.options,Ee=J.textures[ye],ke=J.images[Ee.source],ee=this.textureLoader;if(ke.uri){let ie=Me.manager.getHandler(ke.uri);ie!==null&&(ee=ie)}return this.loadTextureImage(ye,ke,ee)}loadTextureImage(ye,J,Me){let Ee=this,ke=this.json,ee=this.options,ie=ke.textures[ye],X=(J.uri||J.bufferView)+":"+ie.sampler;if(this.textureCache[X])return this.textureCache[X];let te=self.URL||self.webkitURL,me=J.uri||"",Le=!1;if(J.bufferView!==void 0)me=Ee.getDependency("bufferView",J.bufferView).then(function(rt){Le=!0;let Wt=new Blob([rt],{type:J.mimeType});return me=te.createObjectURL(Wt),me});else if(J.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+ye+" is missing URI and bufferView");let Ye=Promise.resolve(me).then(function(rt){return new Promise(function(Wt,mn){let gn=Wt;Me.isImageBitmapLoader===!0&&(gn=function(_n){let In=new THREE.Texture(_n);In.needsUpdate=!0,Wt(In)}),Me.load(THREE.LoaderUtils.resolveURL(rt,ee.path),gn,void 0,mn)})}).then(function(rt){Le===!0&&te.revokeObjectURL(me),rt.flipY=!1,ie.name&&(rt.name=ie.name);let mn=(ke.samplers||{})[ie.sampler]||{};return rt.magFilter=Qe[mn.magFilter]||THREE.LinearFilter,rt.minFilter=Qe[mn.minFilter]||THREE.LinearMipmapLinearFilter,rt.wrapS=ht[mn.wrapS]||THREE.RepeatWrapping,rt.wrapT=ht[mn.wrapT]||THREE.RepeatWrapping,Ee.associations.set(rt,{textures:ye}),rt}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",me),null});return this.textureCache[X]=Ye,Ye}assignTexture(ye,J,Me){let Ee=this;return this.getDependency("texture",Me.index).then(function(ke){if(Me.texCoord!==void 0&&Me.texCoord!=0&&!(J==="aoMap"&&Me.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+Me.texCoord+" for texture "+J+" not yet supported."),Ee.extensions[P.KHR_TEXTURE_TRANSFORM]){let ee=Me.extensions!==void 0?Me.extensions[P.KHR_TEXTURE_TRANSFORM]:void 0;if(ee){let ie=Ee.associations.get(ke);ke=Ee.extensions[P.KHR_TEXTURE_TRANSFORM].extendTexture(ke,ee),Ee.associations.set(ke,ie)}}return ye[J]=ke,ke})}assignFinalMaterial(ye){let J=ye.geometry,Me=ye.material,Ee=J.attributes.tangent===void 0,ke=J.attributes.color!==void 0,ee=J.attributes.normal===void 0;if(ye.isPoints){let ie="PointsMaterial:"+Me.uuid,X=this.cache.get(ie);X||(X=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(X,Me),X.color.copy(Me.color),X.map=Me.map,X.sizeAttenuation=!1,this.cache.add(ie,X)),Me=X}else if(ye.isLine){let ie="LineBasicMaterial:"+Me.uuid,X=this.cache.get(ie);X||(X=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(X,Me),X.color.copy(Me.color),this.cache.add(ie,X)),Me=X}if(Ee||ke||ee){let ie="ClonedMaterial:"+Me.uuid+":";Me.isGLTFSpecularGlossinessMaterial&&(ie+="specular-glossiness:"),Ee&&(ie+="derivative-tangents:"),ke&&(ie+="vertex-colors:"),ee&&(ie+="flat-shading:");let X=this.cache.get(ie);X||(X=Me.clone(),ke&&(X.vertexColors=!0),ee&&(X.flatShading=!0),Ee&&(X.normalScale&&(X.normalScale.y*=-1),X.clearcoatNormalScale&&(X.clearcoatNormalScale.y*=-1)),this.cache.add(ie,X),this.associations.set(X,this.associations.get(Me))),Me=X}Me.aoMap&&J.attributes.uv2===void 0&&J.attributes.uv!==void 0&&J.setAttribute("uv2",J.attributes.uv),ye.material=Me}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(ye){let J=this,Me=this.json,Ee=this.extensions,ke=Me.materials[ye],ee,ie={},X=ke.extensions||{},te=[];if(X[P.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let Le=Ee[P.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];ee=Le.getMaterialType(),te.push(Le.extendParams(ie,ke,J))}else if(X[P.KHR_MATERIALS_UNLIT]){let Le=Ee[P.KHR_MATERIALS_UNLIT];ee=Le.getMaterialType(),te.push(Le.extendParams(ie,ke,J))}else{let Le=ke.pbrMetallicRoughness||{};if(ie.color=new THREE.Color(1,1,1),ie.opacity=1,Array.isArray(Le.baseColorFactor)){let Ye=Le.baseColorFactor;ie.color.fromArray(Ye),ie.opacity=Ye[3]}Le.baseColorTexture!==void 0&&te.push(J.assignTexture(ie,"map",Le.baseColorTexture)),ie.metalness=Le.metallicFactor!==void 0?Le.metallicFactor:1,ie.roughness=Le.roughnessFactor!==void 0?Le.roughnessFactor:1,Le.metallicRoughnessTexture!==void 0&&(te.push(J.assignTexture(ie,"metalnessMap",Le.metallicRoughnessTexture)),te.push(J.assignTexture(ie,"roughnessMap",Le.metallicRoughnessTexture))),ee=this._invokeOne(function(Ye){return Ye.getMaterialType&&Ye.getMaterialType(ye)}),te.push(Promise.all(this._invokeAll(function(Ye){return Ye.extendMaterialParams&&Ye.extendMaterialParams(ye,ie)})))}ke.doubleSided===!0&&(ie.side=THREE.DoubleSide);let me=ke.alphaMode||Tn.OPAQUE;if(me===Tn.BLEND?(ie.transparent=!0,ie.depthWrite=!1):(ie.transparent=!1,ie.alphaWrite=!1,me===Tn.MASK&&(ie.alphaTest=ke.alphaCutoff!==void 0?ke.alphaCutoff:.5)),ke.normalTexture!==void 0&&ee!==THREE.MeshBasicMaterial&&(te.push(J.assignTexture(ie,"normalMap",ke.normalTexture)),ie.normalScale=new THREE.Vector2(1,1),ke.normalTexture.scale!==void 0)){let Le=ke.normalTexture.scale;ie.normalScale.set(Le,Le)}return ke.occlusionTexture!==void 0&&ee!==THREE.MeshBasicMaterial&&(te.push(J.assignTexture(ie,"aoMap",ke.occlusionTexture)),ke.occlusionTexture.strength!==void 0&&(ie.aoMapIntensity=ke.occlusionTexture.strength)),ke.emissiveFactor!==void 0&&ee!==THREE.MeshBasicMaterial&&(ie.emissive=new THREE.Color().fromArray(ke.emissiveFactor)),ke.emissiveTexture!==void 0&&ee!==THREE.MeshBasicMaterial&&te.push(J.assignTexture(ie,"emissiveMap",ke.emissiveTexture)),Promise.all(te).then(function(){let Le;return ee===Se?Le=Ee[P.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(ie):Le=new ee(ie),ke.name&&(Le.name=ke.name),Le.map&&(Le.map.encoding=THREE.sRGBEncoding),Le.emissiveMap&&(Le.emissiveMap.encoding=THREE.sRGBEncoding),Cn(Le,ke),J.associations.set(Le,{materials:ye}),ke.extensions&&Qn(Ee,Le,ke),Le})}createUniqueName(ye){let J=THREE.PropertyBinding.sanitizeNodeName(ye||""),Me=J;for(let Ee=1;this.nodeNamesUsed[Me];++Ee)Me=J+"_"+Ee;return this.nodeNamesUsed[Me]=!0,Me}loadGeometries(ye){let J=this,Me=this.extensions,Ee=this.primitiveCache;function ke(ie){return Me[P.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(ie,J).then(function(X){return Ci(X,ie,J)})}let ee=[];for(let ie=0,X=ye.length;ie<X;ie++){let te=ye[ie],me=_i(te),Le=Ee[me];if(Le)ee.push(Le.promise);else{let Ye;te.extensions&&te.extensions[P.KHR_DRACO_MESH_COMPRESSION]?Ye=ke(te):Ye=Ci(new THREE.BufferGeometry,te,J),Ee[me]={primitive:te,promise:Ye},ee.push(Ye)}}return Promise.all(ee)}loadMesh(ye){let J=this,Me=this.json,Ee=this.extensions,ke=Me.meshes[ye],ee=ke.primitives,ie=[];for(let X=0,te=ee.length;X<te;X++){let me=ee[X].material===void 0?xn(this.cache):this.getDependency("material",ee[X].material);ie.push(me)}return ie.push(J.loadGeometries(ee)),Promise.all(ie).then(function(X){let te=X.slice(0,X.length-1),me=X[X.length-1],Le=[];for(let rt=0,Wt=me.length;rt<Wt;rt++){let mn=me[rt],gn=ee[rt],_n,In=te[rt];if(gn.mode===Ae.TRIANGLES||gn.mode===Ae.TRIANGLE_STRIP||gn.mode===Ae.TRIANGLE_FAN||gn.mode===void 0)_n=ke.isSkinnedMesh===!0?new THREE.SkinnedMesh(mn,In):new THREE.Mesh(mn,In),_n.isSkinnedMesh===!0&&!_n.geometry.attributes.skinWeight.normalized&&_n.normalizeSkinWeights(),gn.mode===Ae.TRIANGLE_STRIP?_n.geometry=ss(_n.geometry,THREE.TriangleStripDrawMode):gn.mode===Ae.TRIANGLE_FAN&&(_n.geometry=ss(_n.geometry,THREE.TriangleFanDrawMode));else if(gn.mode===Ae.LINES)_n=new THREE.LineSegments(mn,In);else if(gn.mode===Ae.LINE_STRIP)_n=new THREE.Line(mn,In);else if(gn.mode===Ae.LINE_LOOP)_n=new THREE.LineLoop(mn,In);else if(gn.mode===Ae.POINTS)_n=new THREE.Points(mn,In);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+gn.mode);Object.keys(_n.geometry.morphAttributes).length>0&&Ar(_n,ke),_n.name=J.createUniqueName(ke.name||"mesh_"+ye),Cn(_n,ke),gn.extensions&&Qn(Ee,_n,gn),J.assignFinalMaterial(_n),Le.push(_n)}for(let rt=0,Wt=Le.length;rt<Wt;rt++)J.associations.set(Le[rt],{meshes:ye,primitives:rt});if(Le.length===1)return Le[0];let Ye=new THREE.Group;J.associations.set(Ye,{meshes:ye});for(let rt=0,Wt=Le.length;rt<Wt;rt++)Ye.add(Le[rt]);return Ye})}loadCamera(ye){let J,Me=this.json.cameras[ye],Ee=Me[Me.type];if(!Ee){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return Me.type==="perspective"?J=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(Ee.yfov),Ee.aspectRatio||1,Ee.znear||1,Ee.zfar||2e6):Me.type==="orthographic"&&(J=new THREE.OrthographicCamera(-Ee.xmag,Ee.xmag,Ee.ymag,-Ee.ymag,Ee.znear,Ee.zfar)),Me.name&&(J.name=this.createUniqueName(Me.name)),Cn(J,Me),Promise.resolve(J)}loadSkin(ye){let J=this.json.skins[ye],Me={joints:J.joints};return J.inverseBindMatrices===void 0?Promise.resolve(Me):this.getDependency("accessor",J.inverseBindMatrices).then(function(Ee){return Me.inverseBindMatrices=Ee,Me})}loadAnimation(ye){let Me=this.json.animations[ye],Ee=[],ke=[],ee=[],ie=[],X=[];for(let te=0,me=Me.channels.length;te<me;te++){let Le=Me.channels[te],Ye=Me.samplers[Le.sampler],rt=Le.target,Wt=rt.node!==void 0?rt.node:rt.id,mn=Me.parameters!==void 0?Me.parameters[Ye.input]:Ye.input,gn=Me.parameters!==void 0?Me.parameters[Ye.output]:Ye.output;Ee.push(this.getDependency("node",Wt)),ke.push(this.getDependency("accessor",mn)),ee.push(this.getDependency("accessor",gn)),ie.push(Ye),X.push(rt)}return Promise.all([Promise.all(Ee),Promise.all(ke),Promise.all(ee),Promise.all(ie),Promise.all(X)]).then(function(te){let me=te[0],Le=te[1],Ye=te[2],rt=te[3],Wt=te[4],mn=[];for(let _n=0,In=me.length;_n<In;_n++){let Yr=me[_n],Zn=Le[_n],Ii=Ye[_n],Pr=rt[_n],St=Wt[_n];if(Yr===void 0)continue;Yr.updateMatrix(),Yr.matrixAutoUpdate=!0;let Kt;switch(Mt[St.path]){case Mt.weights:Kt=THREE.NumberKeyframeTrack;break;case Mt.rotation:Kt=THREE.QuaternionKeyframeTrack;break;case Mt.position:case Mt.scale:default:Kt=THREE.VectorKeyframeTrack;break}let vn=Yr.name?Yr.name:Yr.uuid,cr=Pr.interpolation!==void 0?ln[Pr.interpolation]:THREE.InterpolateLinear,ir=[];Mt[St.path]===Mt.weights?Yr.traverse(function(Ir){Ir.morphTargetInfluences&&ir.push(Ir.name?Ir.name:Ir.uuid)}):ir.push(vn);let xr=Ii.array;if(Ii.normalized){let Ir=mi(xr.constructor),Sr=new Float32Array(xr.length);for(let gi=0,yi=xr.length;gi<yi;gi++)Sr[gi]=xr[gi]*Ir;xr=Sr}for(let Ir=0,Sr=ir.length;Ir<Sr;Ir++){let gi=new Kt(ir[Ir]+"."+Mt[St.path],Zn.array,xr,cr);Pr.interpolation==="CUBICSPLINE"&&(gi.createInterpolant=function(hs){let ti=this instanceof THREE.QuaternionKeyframeTrack?Ie:we;return new ti(this.times,this.values,this.getValueSize()/3,hs)},gi.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),mn.push(gi)}}let gn=Me.name?Me.name:"animation_"+ye;return new THREE.AnimationClip(gn,void 0,mn)})}createNodeMesh(ye){let J=this.json,Me=this,Ee=J.nodes[ye];return Ee.mesh===void 0?null:Me.getDependency("mesh",Ee.mesh).then(function(ke){let ee=Me._getNodeRef(Me.meshCache,Ee.mesh,ke);return Ee.weights!==void 0&&ee.traverse(function(ie){if(!!ie.isMesh)for(let X=0,te=Ee.weights.length;X<te;X++)ie.morphTargetInfluences[X]=Ee.weights[X]}),ee})}loadNode(ye){let J=this.json,Me=this.extensions,Ee=this,ke=J.nodes[ye],ee=ke.name?Ee.createUniqueName(ke.name):"";return function(){let ie=[],X=Ee._invokeOne(function(te){return te.createNodeMesh&&te.createNodeMesh(ye)});return X&&ie.push(X),ke.camera!==void 0&&ie.push(Ee.getDependency("camera",ke.camera).then(function(te){return Ee._getNodeRef(Ee.cameraCache,ke.camera,te)})),Ee._invokeAll(function(te){return te.createNodeAttachment&&te.createNodeAttachment(ye)}).forEach(function(te){ie.push(te)}),Promise.all(ie)}().then(function(ie){let X;if(ke.isBone===!0?X=new THREE.Bone:ie.length>1?X=new THREE.Group:ie.length===1?X=ie[0]:X=new THREE.Object3D,X!==ie[0])for(let te=0,me=ie.length;te<me;te++)X.add(ie[te]);if(ke.name&&(X.userData.name=ke.name,X.name=ee),Cn(X,ke),ke.extensions&&Qn(Me,X,ke),ke.matrix!==void 0){let te=new THREE.Matrix4;te.fromArray(ke.matrix),X.applyMatrix4(te)}else ke.translation!==void 0&&X.position.fromArray(ke.translation),ke.rotation!==void 0&&X.quaternion.fromArray(ke.rotation),ke.scale!==void 0&&X.scale.fromArray(ke.scale);return Ee.associations.has(X)||Ee.associations.set(X,{}),Ee.associations.get(X).nodes=ye,X})}loadScene(ye){let J=this.json,Me=this.extensions,Ee=this.json.scenes[ye],ke=this,ee=new THREE.Group;Ee.name&&(ee.name=ke.createUniqueName(Ee.name)),Cn(ee,Ee),Ee.extensions&&Qn(Me,ee,Ee);let ie=Ee.nodes||[],X=[];for(let te=0,me=ie.length;te<me;te++)X.push(Di(ie[te],ee,J,ke));return Promise.all(X).then(function(){let te=me=>{let Le=new Map;for(let[Ye,rt]of ke.associations)(Ye instanceof THREE.Material||Ye instanceof THREE.Texture)&&Le.set(Ye,rt);return me.traverse(Ye=>{let rt=ke.associations.get(Ye);rt!=null&&Le.set(Ye,rt)}),Le};return ke.associations=te(ee),ee})}}function Di(tn,ye,J,Me){let Ee=J.nodes[tn];return Me.getDependency("node",tn).then(function(ke){if(Ee.skin===void 0)return ke;let ee;return Me.getDependency("skin",Ee.skin).then(function(ie){ee=ie;let X=[];for(let te=0,me=ee.joints.length;te<me;te++)X.push(Me.getDependency("node",ee.joints[te]));return Promise.all(X)}).then(function(ie){return ke.traverse(function(X){if(!X.isMesh)return;let te=[],me=[];for(let Le=0,Ye=ie.length;Le<Ye;Le++){let rt=ie[Le];if(rt){te.push(rt);let Wt=new THREE.Matrix4;ee.inverseBindMatrices!==void 0&&Wt.fromArray(ee.inverseBindMatrices.array,Le*16),me.push(Wt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ee.joints[Le])}X.bind(new THREE.Skeleton(te,me),X.matrixWorld)}),ke})}).then(function(ke){ye.add(ke);let ee=[];if(Ee.children){let ie=Ee.children;for(let X=0,te=ie.length;X<te;X++){let me=ie[X];ee.push(Di(me,ke,J,Me))}}return Promise.all(ee)})}function Kr(tn,ye,J){let Me=ye.attributes,Ee=new THREE.Box3;if(Me.POSITION!==void 0){let ie=J.json.accessors[Me.POSITION],X=ie.min,te=ie.max;if(X!==void 0&&te!==void 0){if(Ee.set(new THREE.Vector3(X[0],X[1],X[2]),new THREE.Vector3(te[0],te[1],te[2])),ie.normalized){let me=mi(Ue[ie.componentType]);Ee.min.multiplyScalar(me),Ee.max.multiplyScalar(me)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let ke=ye.targets;if(ke!==void 0){let ie=new THREE.Vector3,X=new THREE.Vector3;for(let te=0,me=ke.length;te<me;te++){let Le=ke[te];if(Le.POSITION!==void 0){let Ye=J.json.accessors[Le.POSITION],rt=Ye.min,Wt=Ye.max;if(rt!==void 0&&Wt!==void 0){if(X.setX(Math.max(Math.abs(rt[0]),Math.abs(Wt[0]))),X.setY(Math.max(Math.abs(rt[1]),Math.abs(Wt[1]))),X.setZ(Math.max(Math.abs(rt[2]),Math.abs(Wt[2]))),Ye.normalized){let mn=mi(Ue[Ye.componentType]);X.multiplyScalar(mn)}ie.max(X)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Ee.expandByVector(ie)}tn.boundingBox=Ee;let ee=new THREE.Sphere;Ee.getCenter(ee.center),ee.radius=Ee.min.distanceTo(Ee.max)/2,tn.boundingSphere=ee}function Ci(tn,ye,J){let Me=ye.attributes,Ee=[];function ke(ee,ie){return J.getDependency("accessor",ee).then(function(X){tn.setAttribute(ie,X)})}for(let ee in Me){let ie=Et[ee]||ee.toLowerCase();ie in tn.attributes||Ee.push(ke(Me[ee],ie))}if(ye.indices!==void 0&&!tn.index){let ee=J.getDependency("accessor",ye.indices).then(function(ie){tn.setIndex(ie)});Ee.push(ee)}return Cn(tn,ye),Kr(tn,ye,J),Promise.all(Ee).then(function(){return ye.targets!==void 0?Mn(tn,ye.targets,J):tn})}function ss(tn,ye){let J=tn.getIndex();if(J===null){let ee=[],ie=tn.getAttribute("position");if(ie!==void 0){for(let X=0;X<ie.count;X++)ee.push(X);tn.setIndex(ee),J=tn.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),tn}let Me=J.count-2,Ee=[];if(ye===THREE.TriangleFanDrawMode)for(let ee=1;ee<=Me;ee++)Ee.push(J.getX(0)),Ee.push(J.getX(ee)),Ee.push(J.getX(ee+1));else for(let ee=0;ee<Me;ee++)ee%2===0?(Ee.push(J.getX(ee)),Ee.push(J.getX(ee+1)),Ee.push(J.getX(ee+2))):(Ee.push(J.getX(ee+2)),Ee.push(J.getX(ee+1)),Ee.push(J.getX(ee)));Ee.length/3!==Me&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let ke=tn.clone();return ke.setIndex(Ee),ke}THREE.GLTFLoader=E})()},{}],61:[function(V,re,ae){(function(){class E extends THREE.Loader{constructor(L){super(L)}load(L,k,C,M){let I=this,b=this.path===""?THREE.LoaderUtils.extractUrlBase(L):this.path,T=new THREE.FileLoader(this.manager);T.setPath(this.path),T.setRequestHeader(this.requestHeader),T.setWithCredentials(this.withCredentials),T.load(L,function(A){try{k(I.parse(A,b))}catch(_){M?M(_):console.error(_),I.manager.itemError(L)}},C,M)}setMaterialOptions(L){return this.materialOptions=L,this}parse(L,k){let C=L.split(`
`),M={},I=/\s+/,b={};for(let A=0;A<C.length;A++){let _=C[A];if(_=_.trim(),_.length===0||_.charAt(0)==="#")continue;let D=_.indexOf(" "),B=D>=0?_.substring(0,D):_;B=B.toLowerCase();let $=D>=0?_.substring(D+1):"";if($=$.trim(),B==="newmtl")M={name:$},b[$]=M;else if(B==="ka"||B==="kd"||B==="ks"||B==="ke"){let j=$.split(I,3);M[B]=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2])]}else M[B]=$}let T=new z(this.resourcePath||k,this.materialOptions);return T.setCrossOrigin(this.crossOrigin),T.setManager(this.manager),T.setMaterials(b),T}}class z{constructor(L="",k={}){this.baseUrl=L,this.options=k,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:THREE.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:THREE.RepeatWrapping}setCrossOrigin(L){return this.crossOrigin=L,this}setManager(L){this.manager=L}setMaterials(L){this.materialsInfo=this.convert(L),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(L){if(!this.options)return L;let k={};for(let C in L){let M=L[C],I={};k[C]=I;for(let b in M){let T=!0,A=M[b],_=b.toLowerCase();switch(_){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(A=[A[0]/255,A[1]/255,A[2]/255]),this.options&&this.options.ignoreZeroRGBs&&A[0]===0&&A[1]===0&&A[2]===0&&(T=!1);break;default:break}T&&(I[_]=A)}}return k}preload(){for(let L in this.materialsInfo)this.create(L)}getIndex(L){return this.nameLookup[L]}getAsArray(){let L=0;for(let k in this.materialsInfo)this.materialsArray[L]=this.create(k),this.nameLookup[k]=L,L++;return this.materialsArray}create(L){return this.materials[L]===void 0&&this.createMaterial_(L),this.materials[L]}createMaterial_(L){let k=this,C=this.materialsInfo[L],M={name:L,side:this.side};function I(T,A){return typeof A!="string"||A===""?"":/^https?:\/\//i.test(A)?A:T+A}function b(T,A){if(M[T])return;let _=k.getTextureParams(A,M),D=k.loadTexture(I(k.baseUrl,_.url));D.repeat.copy(_.scale),D.offset.copy(_.offset),D.wrapS=k.wrap,D.wrapT=k.wrap,(T==="map"||T==="emissiveMap")&&(D.encoding=THREE.sRGBEncoding),M[T]=D}for(let T in C){let A=C[T],_;if(A!=="")switch(T.toLowerCase()){case"kd":M.color=new THREE.Color().fromArray(A).convertSRGBToLinear();break;case"ks":M.specular=new THREE.Color().fromArray(A).convertSRGBToLinear();break;case"ke":M.emissive=new THREE.Color().fromArray(A).convertSRGBToLinear();break;case"map_kd":b("map",A);break;case"map_ks":b("specularMap",A);break;case"map_ke":b("emissiveMap",A);break;case"norm":b("normalMap",A);break;case"map_bump":case"bump":b("bumpMap",A);break;case"map_d":b("alphaMap",A),M.transparent=!0;break;case"ns":M.shininess=parseFloat(A);break;case"d":_=parseFloat(A),_<1&&(M.opacity=_,M.transparent=!0);break;case"tr":_=parseFloat(A),this.options&&this.options.invertTrProperty&&(_=1-_),_>0&&(M.opacity=1-_,M.transparent=!0);break;default:break}}return this.materials[L]=new THREE.MeshPhongMaterial(M),this.materials[L]}getTextureParams(L,k){let C={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},M=L.split(/\s+/),I;return I=M.indexOf("-bm"),I>=0&&(k.bumpScale=parseFloat(M[I+1]),M.splice(I,2)),I=M.indexOf("-s"),I>=0&&(C.scale.set(parseFloat(M[I+1]),parseFloat(M[I+2])),M.splice(I,4)),I=M.indexOf("-o"),I>=0&&(C.offset.set(parseFloat(M[I+1]),parseFloat(M[I+2])),M.splice(I,4)),C.url=M.join(" ").trim(),C}loadTexture(L,k,C,M,I){let b=this.manager!==void 0?this.manager:THREE.DefaultLoadingManager,T=b.getHandler(L);T===null&&(T=new THREE.TextureLoader(b)),T.setCrossOrigin&&T.setCrossOrigin(this.crossOrigin);let A=T.load(L,C,M,I);return k!==void 0&&(A.mapping=k),A}}THREE.MTLLoader=E})()},{}],62:[function(V,re,ae){(function(){let E=/^[og]\s*(.+)?/,z=/^mtllib /,P=/^usemtl /,L=/^usemap /,k=new THREE.Vector3,C=new THREE.Vector3,M=new THREE.Vector3,I=new THREE.Vector3,b=new THREE.Vector3;function T(){let _={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(D,B){if(this.object&&this.object.fromDeclaration===!1){this.object.name=D,this.object.fromDeclaration=B!==!1;return}let $=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:D||"",fromDeclaration:B!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(j,q){let Q=this._finalize(!1);Q&&(Q.inherited||Q.groupCount<=0)&&this.materials.splice(Q.index,1);let ue={index:this.materials.length,name:j||"",mtllib:Array.isArray(q)&&q.length>0?q[q.length-1]:"",smooth:Q!==void 0?Q.smooth:this.smooth,groupStart:Q!==void 0?Q.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(xe){let Se={index:typeof xe=="number"?xe:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return Se.clone=this.clone.bind(Se),Se}};return this.materials.push(ue),ue},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(j){let q=this.currentMaterial();if(q&&q.groupEnd===-1&&(q.groupEnd=this.geometry.vertices.length/3,q.groupCount=q.groupEnd-q.groupStart,q.inherited=!1),j&&this.materials.length>1)for(let Q=this.materials.length-1;Q>=0;Q--)this.materials[Q].groupCount<=0&&this.materials.splice(Q,1);return j&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),q}},$&&$.name&&typeof $.clone=="function"){let j=$.clone(0);j.inherited=!0,this.object.materials.push(j)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(D,B){let $=parseInt(D,10);return($>=0?$-1:$+B/3)*3},parseNormalIndex:function(D,B){let $=parseInt(D,10);return($>=0?$-1:$+B/3)*3},parseUVIndex:function(D,B){let $=parseInt(D,10);return($>=0?$-1:$+B/2)*2},addVertex:function(D,B,$){let j=this.vertices,q=this.object.geometry.vertices;q.push(j[D+0],j[D+1],j[D+2]),q.push(j[B+0],j[B+1],j[B+2]),q.push(j[$+0],j[$+1],j[$+2])},addVertexPoint:function(D){let B=this.vertices;this.object.geometry.vertices.push(B[D+0],B[D+1],B[D+2])},addVertexLine:function(D){let B=this.vertices;this.object.geometry.vertices.push(B[D+0],B[D+1],B[D+2])},addNormal:function(D,B,$){let j=this.normals,q=this.object.geometry.normals;q.push(j[D+0],j[D+1],j[D+2]),q.push(j[B+0],j[B+1],j[B+2]),q.push(j[$+0],j[$+1],j[$+2])},addFaceNormal:function(D,B,$){let j=this.vertices,q=this.object.geometry.normals;k.fromArray(j,D),C.fromArray(j,B),M.fromArray(j,$),b.subVectors(M,C),I.subVectors(k,C),b.cross(I),b.normalize(),q.push(b.x,b.y,b.z),q.push(b.x,b.y,b.z),q.push(b.x,b.y,b.z)},addColor:function(D,B,$){let j=this.colors,q=this.object.geometry.colors;j[D]!==void 0&&q.push(j[D+0],j[D+1],j[D+2]),j[B]!==void 0&&q.push(j[B+0],j[B+1],j[B+2]),j[$]!==void 0&&q.push(j[$+0],j[$+1],j[$+2])},addUV:function(D,B,$){let j=this.uvs,q=this.object.geometry.uvs;q.push(j[D+0],j[D+1]),q.push(j[B+0],j[B+1]),q.push(j[$+0],j[$+1])},addDefaultUV:function(){let D=this.object.geometry.uvs;D.push(0,0),D.push(0,0),D.push(0,0)},addUVLine:function(D){let B=this.uvs;this.object.geometry.uvs.push(B[D+0],B[D+1])},addFace:function(D,B,$,j,q,Q,ue,xe,Se){let be=this.vertices.length,pe=this.parseVertexIndex(D,be),we=this.parseVertexIndex(B,be),he=this.parseVertexIndex($,be);if(this.addVertex(pe,we,he),this.addColor(pe,we,he),ue!==void 0&&ue!==""){let Ie=this.normals.length;pe=this.parseNormalIndex(ue,Ie),we=this.parseNormalIndex(xe,Ie),he=this.parseNormalIndex(Se,Ie),this.addNormal(pe,we,he)}else this.addFaceNormal(pe,we,he);if(j!==void 0&&j!==""){let Ie=this.uvs.length;pe=this.parseUVIndex(j,Ie),we=this.parseUVIndex(q,Ie),he=this.parseUVIndex(Q,Ie),this.addUV(pe,we,he),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(D){this.object.geometry.type="Points";let B=this.vertices.length;for(let $=0,j=D.length;$<j;$++){let q=this.parseVertexIndex(D[$],B);this.addVertexPoint(q),this.addColor(q)}},addLineGeometry:function(D,B){this.object.geometry.type="Line";let $=this.vertices.length,j=this.uvs.length;for(let q=0,Q=D.length;q<Q;q++)this.addVertexLine(this.parseVertexIndex(D[q],$));for(let q=0,Q=B.length;q<Q;q++)this.addUVLine(this.parseUVIndex(B[q],j))}};return _.startObject("",!1),_}class A extends THREE.Loader{constructor(D){super(D),this.materials=null}load(D,B,$,j){let q=this,Q=new THREE.FileLoader(this.manager);Q.setPath(this.path),Q.setRequestHeader(this.requestHeader),Q.setWithCredentials(this.withCredentials),Q.load(D,function(ue){try{B(q.parse(ue))}catch(xe){j?j(xe):console.error(xe),q.manager.itemError(D)}},$,j)}setMaterials(D){return this.materials=D,this}parse(D){let B=new T;D.indexOf(`\r
`)!==-1&&(D=D.replace(/\r\n/g,`
`)),D.indexOf(`\\
`)!==-1&&(D=D.replace(/\\\n/g,""));let $=D.split(`
`),j="",q="",Q=0,ue=[],xe=typeof"".trimLeft=="function";for(let pe=0,we=$.length;pe<we;pe++)if(j=$[pe],j=xe?j.trimLeft():j.trim(),Q=j.length,Q!==0&&(q=j.charAt(0),q!=="#"))if(q==="v"){let he=j.split(/\s+/);switch(he[0]){case"v":B.vertices.push(parseFloat(he[1]),parseFloat(he[2]),parseFloat(he[3])),he.length>=7?B.colors.push(parseFloat(he[4]),parseFloat(he[5]),parseFloat(he[6])):B.colors.push(void 0,void 0,void 0);break;case"vn":B.normals.push(parseFloat(he[1]),parseFloat(he[2]),parseFloat(he[3]));break;case"vt":B.uvs.push(parseFloat(he[1]),parseFloat(he[2]));break}}else if(q==="f"){let Ie=j.substr(1).trim().split(/\s+/),Ae=[];for(let Qe=0,ht=Ie.length;Qe<ht;Qe++){let lt=Ie[Qe];if(lt.length>0){let Et=lt.split("/");Ae.push(Et)}}let Ue=Ae[0];for(let Qe=1,ht=Ae.length-1;Qe<ht;Qe++){let lt=Ae[Qe],Et=Ae[Qe+1];B.addFace(Ue[0],lt[0],Et[0],Ue[1],lt[1],Et[1],Ue[2],lt[2],Et[2])}}else if(q==="l"){let he=j.substring(1).trim().split(" "),Ie=[],Ae=[];if(j.indexOf("/")===-1)Ie=he;else for(let Ue=0,Qe=he.length;Ue<Qe;Ue++){let ht=he[Ue].split("/");ht[0]!==""&&Ie.push(ht[0]),ht[1]!==""&&Ae.push(ht[1])}B.addLineGeometry(Ie,Ae)}else if(q==="p"){let Ie=j.substr(1).trim().split(" ");B.addPointGeometry(Ie)}else if((ue=E.exec(j))!==null){let he=(" "+ue[0].substr(1).trim()).substr(1);B.startObject(he)}else if(P.test(j))B.object.startMaterial(j.substring(7).trim(),B.materialLibraries);else if(z.test(j))B.materialLibraries.push(j.substring(7).trim());else if(L.test(j))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(q==="s"){if(ue=j.split(" "),ue.length>1){let Ie=ue[1].trim().toLowerCase();B.object.smooth=Ie!=="0"&&Ie!=="off"}else B.object.smooth=!0;let he=B.object.currentMaterial();he&&(he.smooth=B.object.smooth)}else{if(j==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+j+'"')}B.finalize();let Se=new THREE.Group;if(Se.materialLibraries=[].concat(B.materialLibraries),!(B.objects.length===1&&B.objects[0].geometry.vertices.length===0)===!0)for(let pe=0,we=B.objects.length;pe<we;pe++){let he=B.objects[pe],Ie=he.geometry,Ae=he.materials,Ue=Ie.type==="Line",Qe=Ie.type==="Points",ht=!1;if(Ie.vertices.length===0)continue;let lt=new THREE.BufferGeometry;lt.setAttribute("position",new THREE.Float32BufferAttribute(Ie.vertices,3)),Ie.normals.length>0&&lt.setAttribute("normal",new THREE.Float32BufferAttribute(Ie.normals,3)),Ie.colors.length>0&&(ht=!0,lt.setAttribute("color",new THREE.Float32BufferAttribute(Ie.colors,3))),Ie.hasUVIndices===!0&&lt.setAttribute("uv",new THREE.Float32BufferAttribute(Ie.uvs,2));let Et=[];for(let ln=0,Tn=Ae.length;ln<Tn;ln++){let xn=Ae[ln],Qn=xn.name+"_"+xn.smooth+"_"+ht,Cn=B.materials[Qn];if(this.materials!==null){if(Cn=this.materials.create(xn.name),Ue&&Cn&&!(Cn instanceof THREE.LineBasicMaterial)){let Mn=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(Mn,Cn),Mn.color.copy(Cn.color),Cn=Mn}else if(Qe&&Cn&&!(Cn instanceof THREE.PointsMaterial)){let Mn=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(Mn,Cn),Mn.color.copy(Cn.color),Mn.map=Cn.map,Cn=Mn}}Cn===void 0&&(Ue?Cn=new THREE.LineBasicMaterial:Qe?Cn=new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):Cn=new THREE.MeshPhongMaterial,Cn.name=xn.name,Cn.flatShading=!xn.smooth,Cn.vertexColors=ht,B.materials[Qn]=Cn),Et.push(Cn)}let Mt;if(Et.length>1){for(let ln=0,Tn=Ae.length;ln<Tn;ln++){let xn=Ae[ln];lt.addGroup(xn.groupStart,xn.groupCount,ln)}Ue?Mt=new THREE.LineSegments(lt,Et):Qe?Mt=new THREE.Points(lt,Et):Mt=new THREE.Mesh(lt,Et)}else Ue?Mt=new THREE.LineSegments(lt,Et[0]):Qe?Mt=new THREE.Points(lt,Et[0]):Mt=new THREE.Mesh(lt,Et[0]);Mt.name=he.name,Se.add(Mt)}else if(B.vertices.length>0){let pe=new THREE.PointsMaterial({size:1,sizeAttenuation:!1}),we=new THREE.BufferGeometry;we.setAttribute("position",new THREE.Float32BufferAttribute(B.vertices,3)),B.colors.length>0&&B.colors[0]!==void 0&&(we.setAttribute("color",new THREE.Float32BufferAttribute(B.colors,3)),pe.vertexColors=!0);let he=new THREE.Points(we,pe);Se.add(he)}return Se}}THREE.OBJLoader=A})()},{}],63:[function(V,re,ae){(function(){function E(b){b.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use THREE.BufferGeometry.computeTangents() instead.")}function z(b,T=!1){let A=b[0].index!==null,_=new Set(Object.keys(b[0].attributes)),D=new Set(Object.keys(b[0].morphAttributes)),B={},$={},j=b[0].morphTargetsRelative,q=new THREE.BufferGeometry,Q=0;for(let ue=0;ue<b.length;++ue){let xe=b[ue],Se=0;if(A!==(xe.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ue+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let be in xe.attributes){if(!_.has(be))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ue+'. All geometries must have compatible attributes; make sure "'+be+'" attribute exists among all geometries, or in none of them.'),null;B[be]===void 0&&(B[be]=[]),B[be].push(xe.attributes[be]),Se++}if(Se!==_.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ue+". Make sure all geometries have the same number of attributes."),null;if(j!==xe.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ue+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let be in xe.morphAttributes){if(!D.has(be))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ue+".  .morphAttributes must be consistent throughout all geometries."),null;$[be]===void 0&&($[be]=[]),$[be].push(xe.morphAttributes[be])}if(q.userData.mergedUserData=q.userData.mergedUserData||[],q.userData.mergedUserData.push(xe.userData),T){let be;if(A)be=xe.index.count;else if(xe.attributes.position!==void 0)be=xe.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ue+". The geometry must have either an index or a position attribute"),null;q.addGroup(Q,be,ue),Q+=be}}if(A){let ue=0,xe=[];for(let Se=0;Se<b.length;++Se){let be=b[Se].index;for(let pe=0;pe<be.count;++pe)xe.push(be.getX(pe)+ue);ue+=b[Se].attributes.position.count}q.setIndex(xe)}for(let ue in B){let xe=P(B[ue]);if(!xe)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+ue+" attribute."),null;q.setAttribute(ue,xe)}for(let ue in $){let xe=$[ue][0].length;if(xe===0)break;q.morphAttributes=q.morphAttributes||{},q.morphAttributes[ue]=[];for(let Se=0;Se<xe;++Se){let be=[];for(let we=0;we<$[ue].length;++we)be.push($[ue][we][Se]);let pe=P(be);if(!pe)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+ue+" morphAttribute."),null;q.morphAttributes[ue].push(pe)}}return q}function P(b){let T,A,_,D=0;for(let j=0;j<b.length;++j){let q=b[j];if(q.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(T===void 0&&(T=q.array.constructor),T!==q.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.array must be of consistent array types across matching attributes."),null;if(A===void 0&&(A=q.itemSize),A!==q.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.itemSize must be consistent across matching attributes."),null;if(_===void 0&&(_=q.normalized),_!==q.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.normalized must be consistent across matching attributes."),null;D+=q.array.length}let B=new T(D),$=0;for(let j=0;j<b.length;++j)B.set(b[j].array,$),$+=b[j].array.length;return new THREE.BufferAttribute(B,A,_)}function L(b){let T,A=0,_=0;for(let Q=0,ue=b.length;Q<ue;++Q){let xe=b[Q];if(T===void 0&&(T=xe.array.constructor),T!==xe.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;A+=xe.array.length,_+=xe.itemSize}let D=new THREE.InterleavedBuffer(new T(A),_),B=0,$=[],j=["getX","getY","getZ","getW"],q=["setX","setY","setZ","setW"];for(let Q=0,ue=b.length;Q<ue;Q++){let xe=b[Q],Se=xe.itemSize,be=xe.count,pe=new THREE.InterleavedBufferAttribute(D,Se,B,xe.normalized);$.push(pe),B+=Se;for(let we=0;we<be;we++)for(let he=0;he<Se;he++)pe[q[he]](we,xe[j[he]](we))}return $}function k(b){let T=0;for(let _ in b.attributes){let D=b.getAttribute(_);T+=D.count*D.itemSize*D.array.BYTES_PER_ELEMENT}let A=b.getIndex();return T+=A?A.count*A.itemSize*A.array.BYTES_PER_ELEMENT:0,T}function C(b,T=1e-4){T=Math.max(T,Number.EPSILON);let A={},_=b.getIndex(),D=b.getAttribute("position"),B=_?_.count:D.count,$=0,j=Object.keys(b.attributes),q={},Q={},ue=[],xe=["getX","getY","getZ","getW"];for(let we=0,he=j.length;we<he;we++){let Ie=j[we];q[Ie]=[];let Ae=b.morphAttributes[Ie];Ae&&(Q[Ie]=new Array(Ae.length).fill().map(()=>[]))}let Se=Math.log10(1/T),be=Math.pow(10,Se);for(let we=0;we<B;we++){let he=_?_.getX(we):we,Ie="";for(let Ae=0,Ue=j.length;Ae<Ue;Ae++){let Qe=j[Ae],ht=b.getAttribute(Qe),lt=ht.itemSize;for(let Et=0;Et<lt;Et++)Ie+=`${~~(ht[xe[Et]](he)*be)},`}if(Ie in A)ue.push(A[Ie]);else{for(let Ae=0,Ue=j.length;Ae<Ue;Ae++){let Qe=j[Ae],ht=b.getAttribute(Qe),lt=b.morphAttributes[Qe],Et=ht.itemSize,Mt=q[Qe],ln=Q[Qe];for(let Tn=0;Tn<Et;Tn++){let xn=xe[Tn];if(Mt.push(ht[xn](he)),lt)for(let Qn=0,Cn=lt.length;Qn<Cn;Qn++)ln[Qn].push(lt[Qn][xn](he))}}A[Ie]=$,ue.push($),$++}}let pe=b.clone();for(let we=0,he=j.length;we<he;we++){let Ie=j[we],Ae=b.getAttribute(Ie),Ue=new Ae.array.constructor(q[Ie]),Qe=new THREE.BufferAttribute(Ue,Ae.itemSize,Ae.normalized);if(pe.setAttribute(Ie,Qe),Ie in Q)for(let ht=0;ht<Q[Ie].length;ht++){let lt=b.morphAttributes[Ie][ht],Et=new lt.array.constructor(Q[Ie][ht]),Mt=new THREE.BufferAttribute(Et,lt.itemSize,lt.normalized);pe.morphAttributes[Ie][ht]=Mt}}return pe.setIndex(ue),pe}function M(b,T){if(T===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),b;if(T===THREE.TriangleFanDrawMode||T===THREE.TriangleStripDrawMode){let A=b.getIndex();if(A===null){let $=[],j=b.getAttribute("position");if(j!==void 0){for(let q=0;q<j.count;q++)$.push(q);b.setIndex($),A=b.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),b}let _=A.count-2,D=[];if(T===THREE.TriangleFanDrawMode)for(let $=1;$<=_;$++)D.push(A.getX(0)),D.push(A.getX($)),D.push(A.getX($+1));else for(let $=0;$<_;$++)$%2===0?(D.push(A.getX($)),D.push(A.getX($+1)),D.push(A.getX($+2))):(D.push(A.getX($+2)),D.push(A.getX($+1)),D.push(A.getX($)));D.length/3!==_&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let B=b.clone();return B.setIndex(D),B.clearGroups(),B}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",T),b}function I(b){if(b.geometry.isBufferGeometry!==!0)return console.error("THREE.BufferGeometryUtils: Geometry is not of type THREE.BufferGeometry."),null;let T=new THREE.Vector3,A=new THREE.Vector3,_=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Vector3,$=new THREE.Vector3,j=new THREE.Vector3,q=new THREE.Vector3,Q=new THREE.Vector3;function ue(Di,Kr,Ci,ss,tn,ye,J,Me,Ee){T.fromBufferAttribute(Ci,ye),A.fromBufferAttribute(Ci,J),_.fromBufferAttribute(Ci,Me);let ke=Di.morphTargetInfluences;if(Kr.morphTargets&&ss&&ke){j.set(0,0,0),q.set(0,0,0),Q.set(0,0,0);for(let ee=0,ie=ss.length;ee<ie;ee++){let X=ke[ee],te=ss[ee];X!==0&&(D.fromBufferAttribute(te,ye),B.fromBufferAttribute(te,J),$.fromBufferAttribute(te,Me),tn?(j.addScaledVector(D,X),q.addScaledVector(B,X),Q.addScaledVector($,X)):(j.addScaledVector(D.sub(T),X),q.addScaledVector(B.sub(A),X),Q.addScaledVector($.sub(_),X)))}T.add(j),A.add(q),_.add(Q)}Di.isSkinnedMesh&&(Di.boneTransform(ye,T),Di.boneTransform(J,A),Di.boneTransform(Me,_)),Ee[ye*3+0]=T.x,Ee[ye*3+1]=T.y,Ee[ye*3+2]=T.z,Ee[J*3+0]=A.x,Ee[J*3+1]=A.y,Ee[J*3+2]=A.z,Ee[Me*3+0]=_.x,Ee[Me*3+1]=_.y,Ee[Me*3+2]=_.z}let xe=b.geometry,Se=b.material,be,pe,we,he=xe.index,Ie=xe.attributes.position,Ae=xe.morphAttributes.position,Ue=xe.morphTargetsRelative,Qe=xe.attributes.normal,ht=xe.morphAttributes.position,lt=xe.groups,Et=xe.drawRange,Mt,ln,Tn,xn,Qn,Cn,Mn,Ar,_i=new Float32Array(Ie.count*Ie.itemSize),si=new Float32Array(Qe.count*Qe.itemSize);if(he!==null)if(Array.isArray(Se))for(Mt=0,Tn=lt.length;Mt<Tn;Mt++)for(Qn=lt[Mt],Cn=Se[Qn.materialIndex],Mn=Math.max(Qn.start,Et.start),Ar=Math.min(Qn.start+Qn.count,Et.start+Et.count),ln=Mn,xn=Ar;ln<xn;ln+=3)be=he.getX(ln),pe=he.getX(ln+1),we=he.getX(ln+2),ue(b,Cn,Ie,Ae,Ue,be,pe,we,_i),ue(b,Cn,Qe,ht,Ue,be,pe,we,si);else for(Mn=Math.max(0,Et.start),Ar=Math.min(he.count,Et.start+Et.count),Mt=Mn,Tn=Ar;Mt<Tn;Mt+=3)be=he.getX(Mt),pe=he.getX(Mt+1),we=he.getX(Mt+2),ue(b,Se,Ie,Ae,Ue,be,pe,we,_i),ue(b,Se,Qe,ht,Ue,be,pe,we,si);else if(Ie!==void 0)if(Array.isArray(Se))for(Mt=0,Tn=lt.length;Mt<Tn;Mt++)for(Qn=lt[Mt],Cn=Se[Qn.materialIndex],Mn=Math.max(Qn.start,Et.start),Ar=Math.min(Qn.start+Qn.count,Et.start+Et.count),ln=Mn,xn=Ar;ln<xn;ln+=3)be=ln,pe=ln+1,we=ln+2,ue(b,Cn,Ie,Ae,Ue,be,pe,we,_i),ue(b,Cn,Qe,ht,Ue,be,pe,we,si);else for(Mn=Math.max(0,Et.start),Ar=Math.min(Ie.count,Et.start+Et.count),Mt=Mn,Tn=Ar;Mt<Tn;Mt+=3)be=Mt,pe=Mt+1,we=Mt+2,ue(b,Se,Ie,Ae,Ue,be,pe,we,_i),ue(b,Se,Qe,ht,Ue,be,pe,we,si);let mi=new THREE.Float32BufferAttribute(_i,3),Qi=new THREE.Float32BufferAttribute(si,3);return{positionAttribute:Ie,normalAttribute:Qe,morphedPositionAttribute:mi,morphedNormalAttribute:Qi}}THREE.BufferGeometryUtils={},THREE.BufferGeometryUtils.computeMorphedAttributes=I,THREE.BufferGeometryUtils.computeTangents=E,THREE.BufferGeometryUtils.estimateBytesUsed=k,THREE.BufferGeometryUtils.interleaveAttributes=L,THREE.BufferGeometryUtils.mergeBufferAttributes=P,THREE.BufferGeometryUtils.mergeBufferGeometries=z,THREE.BufferGeometryUtils.mergeVertices=C,THREE.BufferGeometryUtils.toTrianglesDrawMode=M})()},{}],64:[function(V,re,ae){var E=V("layout-bmfont-text"),z=V("inherits"),P=V("quad-indices"),L=V("three-buffer-vertex-data"),k=V("object-assign"),C=V("./lib/vertices"),M=V("./lib/utils");re.exports=function(T){return new I(T)};class I extends THREE.BufferGeometry{constructor(T){super(),typeof T=="string"&&(T={text:T}),this._opt=k({},T),T&&this.update(T)}update(T){if(typeof T=="string"&&(T={text:T}),T=k({},this._opt,T),!T.font)throw new TypeError("must specify a { font } in options");this.layout=E(T);var A=T.flipY!==!1,_=T.font,D=_.common.scaleW,B=_.common.scaleH,$=this.layout.glyphs.filter(function(xe){var Se=xe.data;return Se.width*Se.height>0});this.visibleGlyphs=$;var j=C.positions($),q=C.uvs($,D,B,A),Q=P({clockwise:!0,type:"uint16",count:$.length});if(L.index(this,Q,1,"uint16"),L.attr(this,"position",j,2),L.attr(this,"uv",q,2),!T.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(T.multipage){var ue=C.pages($);L.attr(this,"page",ue,1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var T=this.attributes.position.array,A=this.attributes.position.itemSize;if(!T||!A||T.length<2){this.boundingSphere.radius=0,this.boundingSphere.center.set(0,0,0);return}M.computeSphere(T,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var T=this.boundingBox,A=this.attributes.position.array,_=this.attributes.position.itemSize;if(!A||!_||A.length<2){T.makeEmpty();return}M.computeBox(A,T)}}},{"./lib/utils":65,"./lib/vertices":66,inherits:30,"layout-bmfont-text":36,"object-assign":39,"quad-indices":51,"three-buffer-vertex-data":67}],65:[function(V,re,ae){var E=2,z={min:[0,0],max:[0,0]};function P(L){var k=L.length/E;z.min[0]=L[0],z.min[1]=L[1],z.max[0]=L[0],z.max[1]=L[1];for(var C=0;C<k;C++){var M=L[C*E+0],I=L[C*E+1];z.min[0]=Math.min(M,z.min[0]),z.min[1]=Math.min(I,z.min[1]),z.max[0]=Math.max(M,z.max[0]),z.max[1]=Math.max(I,z.max[1])}}re.exports.computeBox=function(L,k){P(L),k.min.set(z.min[0],z.min[1],0),k.max.set(z.max[0],z.max[1],0)},re.exports.computeSphere=function(L,k){P(L);var C=z.min[0],M=z.min[1],I=z.max[0],b=z.max[1],T=I-C,A=b-M,_=Math.sqrt(T*T+A*A);k.center.set(C+T/2,M+A/2,0),k.radius=_/2}},{}],66:[function(V,re,ae){re.exports.pages=function(z){var P=new Float32Array(z.length*4*1),L=0;return z.forEach(function(k){var C=k.data.page||0;P[L++]=C,P[L++]=C,P[L++]=C,P[L++]=C}),P},re.exports.uvs=function(z,P,L,k){var C=new Float32Array(z.length*4*2),M=0;return z.forEach(function(I){var b=I.data,T=b.x+b.width,A=b.y+b.height,_=b.x/P,D=b.y/L,B=T/P,$=A/L;k&&(D=(L-b.y)/L,$=(L-A)/L),C[M++]=_,C[M++]=D,C[M++]=_,C[M++]=$,C[M++]=B,C[M++]=$,C[M++]=B,C[M++]=D}),C},re.exports.positions=function(z){var P=new Float32Array(z.length*4*2),L=0;return z.forEach(function(k){var C=k.data,M=k.position[0]+C.xoffset,I=k.position[1]+C.yoffset,b=C.width,T=C.height;P[L++]=M,P[L++]=I,P[L++]=M,P[L++]=I+T,P[L++]=M+b,P[L++]=I+T,P[L++]=M+b,P[L++]=I}),P}},{}],67:[function(V,re,ae){var E=V("flatten-vertex-data"),z=!1;re.exports.attr=L,re.exports.index=P;function P(M,I,b,T){typeof b!="number"&&(b=1),typeof T!="string"&&(T="uint16");var A=!M.index&&typeof M.setIndex!="function",_=A?M.getAttribute("index"):M.index,D=k(_,I,b,T);D&&(A?M.addAttribute("index",D):M.index=D)}function L(M,I,b,T,A){if(typeof T!="number"&&(T=3),typeof A!="string"&&(A="float32"),Array.isArray(b)&&Array.isArray(b[0])&&b[0].length!==T)throw new Error("Nested vertex array has unexpected size; expected "+T+" but found "+b[0].length);var _=M.getAttribute(I),D=k(_,b,T,A);M.setAttribute(I,D)}function k(M,I,b,T){return I=I||[],I=E(I,T),M=new THREE.BufferAttribute(I,b),M.itemSize=b,M.needsUpdate=!0,M}function C(M,I,b){if(M.itemSize!==b||!M.array)return!0;var T=M.array.length;return Array.isArray(I)&&Array.isArray(I[0])?T!==I.length*b:T!==I.length}},{"flatten-vertex-data":23}],68:[function(V,re,ae){(function(E,z){var P=V("process/browser.js").nextTick,L=Function.prototype.apply,k=Array.prototype.slice,C={},M=0;ae.setTimeout=function(){return new I(L.call(setTimeout,window,arguments),clearTimeout)},ae.setInterval=function(){return new I(L.call(setInterval,window,arguments),clearInterval)},ae.clearTimeout=ae.clearInterval=function(b){b.close()};function I(b,T){this._id=b,this._clearFn=T}I.prototype.unref=I.prototype.ref=function(){},I.prototype.close=function(){this._clearFn.call(window,this._id)},ae.enroll=function(b,T){clearTimeout(b._idleTimeoutId),b._idleTimeout=T},ae.unenroll=function(b){clearTimeout(b._idleTimeoutId),b._idleTimeout=-1},ae._unrefActive=ae.active=function(b){clearTimeout(b._idleTimeoutId);var T=b._idleTimeout;T>=0&&(b._idleTimeoutId=setTimeout(function(){b._onTimeout&&b._onTimeout()},T))},ae.setImmediate=typeof E=="function"?E:function(b){var T=M++,A=arguments.length<2?!1:k.call(arguments,1);return C[T]=!0,P(function(){C[T]&&(A?b.apply(null,A):b.call(null),ae.clearImmediate(T))}),T},ae.clearImmediate=typeof z=="function"?z:function(b){delete C[b]}}).call(this,V("timers").setImmediate,V("timers").clearImmediate)},{"process/browser.js":49,timers:68}],69:[function(V,re,ae){(function(E){(function(z,P){typeof ae=="object"&&typeof re<"u"?re.exports=P():typeof ji=="function"&&ji.amd?ji(P):z.WebVRPolyfill=P()})(this,function(){"use strict";var z=typeof window<"u"?window:typeof E<"u"?E:typeof self<"u"?self:{};function P(j){return j&&j.__esModule&&Object.prototype.hasOwnProperty.call(j,"default")?j.default:j}function L(j,q){return q={exports:{}},j(q,q.exports),q.exports}var k=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},C=function(q,Q){for(var ue=0,xe=q.length;ue<xe;ue++)Q[ue]=q[ue]},M=function(q,Q){for(var ue in Q)Q.hasOwnProperty(ue)&&(q[ue]=Q[ue]);return q},I=L(function(j,q){(function(Q,ue){j.exports=ue()})(z,function(){var Q=function(le,de){if(!(le instanceof de))throw new TypeError("Cannot call a class as a function")},ue=function(){function le(de,_e){for(var Ne=0;Ne<_e.length;Ne++){var He=_e[Ne];He.enumerable=He.enumerable||!1,He.configurable=!0,"value"in He&&(He.writable=!0),Object.defineProperty(de,He.key,He)}}return function(de,_e,Ne){return _e&&le(de.prototype,_e),Ne&&le(de,Ne),de}}(),xe=function(){function le(de,_e){var Ne=[],He=!0,ct=!1,gt=void 0;try{for(var Yt=de[Symbol.iterator](),Qt;!(He=(Qt=Yt.next()).done)&&(Ne.push(Qt.value),!(_e&&Ne.length===_e));He=!0);}catch(At){ct=!0,gt=At}finally{try{!He&&Yt.return&&Yt.return()}finally{if(ct)throw gt}}return Ne}return function(de,_e){if(Array.isArray(de))return de;if(Symbol.iterator in Object(de))return le(de,_e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Se=.001,be=1,pe=function(de,_e){return"data:"+de+","+encodeURIComponent(_e)},we=function(de,_e,Ne){return de+(_e-de)*Ne},he=function(){var le=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return le}}(),Ie=function(){var le=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return le}}(),Ae=function(){var le=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return le}}(),Ue=function(){var le=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return le}}(),Qe=function(){var le=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),de=le?parseInt(le[1],10):null;return function(){return de}}(),ht=function(){var le=!1;return le=he()&&Ae()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return le}}(),lt=function(){var le=!1;if(Qe()===65){var de=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(de){var _e=de[1].split("."),Ne=xe(_e,4),He=Ne[0],ct=Ne[1],gt=Ne[2],Yt=Ne[3];le=parseInt(gt,10)===3325&&parseInt(Yt,10)<148}}return function(){return le}}(),Et=function(){var le=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return le}}(),Mt=function(){var de=window.orientation==90||window.orientation==-90;return Et()?!de:de},ln=function(de){return!(isNaN(de)||de<=Se||de>be)},Tn=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},xn=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Qn=function(de){if(Ie())return!1;if(de.requestFullscreen)de.requestFullscreen();else if(de.webkitRequestFullscreen)de.webkitRequestFullscreen();else if(de.mozRequestFullScreen)de.mozRequestFullScreen();else if(de.msRequestFullscreen)de.msRequestFullscreen();else return!1;return!0},Cn=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},Mn=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},Ar=function(de,_e,Ne,He){var ct=de.createShader(de.VERTEX_SHADER);de.shaderSource(ct,_e),de.compileShader(ct);var gt=de.createShader(de.FRAGMENT_SHADER);de.shaderSource(gt,Ne),de.compileShader(gt);var Yt=de.createProgram();de.attachShader(Yt,ct),de.attachShader(Yt,gt);for(var Qt in He)de.bindAttribLocation(Yt,He[Qt],Qt);return de.linkProgram(Yt),de.deleteShader(ct),de.deleteShader(gt),Yt},_i=function(de,_e){for(var Ne={},He=de.getProgramParameter(_e,de.ACTIVE_UNIFORMS),ct="",gt=0;gt<He;gt++){var Yt=de.getActiveUniform(_e,gt);ct=Yt.name.replace("[0]",""),Ne[ct]=de.getUniformLocation(_e,ct)}return Ne},si=function(de,_e,Ne,He,ct,gt,Yt){var Qt=1/(_e-Ne),At=1/(He-ct),Pt=1/(gt-Yt);return de[0]=-2*Qt,de[1]=0,de[2]=0,de[3]=0,de[4]=0,de[5]=-2*At,de[6]=0,de[7]=0,de[8]=0,de[9]=0,de[10]=2*Pt,de[11]=0,de[12]=(_e+Ne)*Qt,de[13]=(ct+He)*At,de[14]=(Yt+gt)*Pt,de[15]=1,de},mi=function(){var de=!1;return function(_e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(_e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(_e.substr(0,4)))&&(de=!0)}(navigator.userAgent||navigator.vendor||window.opera),de},Qi=function(de,_e){for(var Ne in _e)_e.hasOwnProperty(Ne)&&(de[Ne]=_e[Ne]);return de},Di=function(de){if(he()){var _e=de.style.width,Ne=de.style.height;de.style.width=parseInt(_e)+1+"px",de.style.height=parseInt(Ne)+"px",setTimeout(function(){de.style.width=_e,de.style.height=Ne},100)}window.canvas=de},Kr=function(){var le=Math.PI/180,de=Math.PI*.25;function _e(At,Pt,hn,zn){var Kn=Math.tan(Pt?Pt.upDegrees*le:de),hr=Math.tan(Pt?Pt.downDegrees*le:de),Rr=Math.tan(Pt?Pt.leftDegrees*le:de),Nr=Math.tan(Pt?Pt.rightDegrees*le:de),kr=2/(Rr+Nr),ki=2/(Kn+hr);return At[0]=kr,At[1]=0,At[2]=0,At[3]=0,At[4]=0,At[5]=ki,At[6]=0,At[7]=0,At[8]=-((Rr-Nr)*kr*.5),At[9]=(Kn-hr)*ki*.5,At[10]=zn/(hn-zn),At[11]=-1,At[12]=0,At[13]=0,At[14]=zn*hn/(hn-zn),At[15]=0,At}function Ne(At,Pt,hn){var zn=Pt[0],Kn=Pt[1],hr=Pt[2],Rr=Pt[3],Nr=zn+zn,kr=Kn+Kn,ki=hr+hr,Ji=zn*Nr,vs=zn*kr,Ei=zn*ki,Qr=Kn*kr,oa=Kn*ki,la=hr*ki,bs=Rr*Nr,ua=Rr*kr,Ao=Rr*ki;return At[0]=1-(Qr+la),At[1]=vs+Ao,At[2]=Ei-ua,At[3]=0,At[4]=vs-Ao,At[5]=1-(Ji+la),At[6]=oa+bs,At[7]=0,At[8]=Ei+ua,At[9]=oa-bs,At[10]=1-(Ji+Qr),At[11]=0,At[12]=hn[0],At[13]=hn[1],At[14]=hn[2],At[15]=1,At}function He(At,Pt,hn){var zn=hn[0],Kn=hn[1],hr=hn[2],Rr,Nr,kr,ki,Ji,vs,Ei,Qr,oa,la,bs,ua;return Pt===At?(At[12]=Pt[0]*zn+Pt[4]*Kn+Pt[8]*hr+Pt[12],At[13]=Pt[1]*zn+Pt[5]*Kn+Pt[9]*hr+Pt[13],At[14]=Pt[2]*zn+Pt[6]*Kn+Pt[10]*hr+Pt[14],At[15]=Pt[3]*zn+Pt[7]*Kn+Pt[11]*hr+Pt[15]):(Rr=Pt[0],Nr=Pt[1],kr=Pt[2],ki=Pt[3],Ji=Pt[4],vs=Pt[5],Ei=Pt[6],Qr=Pt[7],oa=Pt[8],la=Pt[9],bs=Pt[10],ua=Pt[11],At[0]=Rr,At[1]=Nr,At[2]=kr,At[3]=ki,At[4]=Ji,At[5]=vs,At[6]=Ei,At[7]=Qr,At[8]=oa,At[9]=la,At[10]=bs,At[11]=ua,At[12]=Rr*zn+Ji*Kn+oa*hr+Pt[12],At[13]=Nr*zn+vs*Kn+la*hr+Pt[13],At[14]=kr*zn+Ei*Kn+bs*hr+Pt[14],At[15]=ki*zn+Qr*Kn+ua*hr+Pt[15]),At}function ct(At,Pt){var hn=Pt[0],zn=Pt[1],Kn=Pt[2],hr=Pt[3],Rr=Pt[4],Nr=Pt[5],kr=Pt[6],ki=Pt[7],Ji=Pt[8],vs=Pt[9],Ei=Pt[10],Qr=Pt[11],oa=Pt[12],la=Pt[13],bs=Pt[14],ua=Pt[15],Ao=hn*Nr-zn*Rr,Eo=hn*kr-Kn*Rr,dl=hn*ki-hr*Rr,Pl=zn*kr-Kn*Nr,Ol=zn*ki-hr*Nr,Oo=Kn*ki-hr*kr,Bl=Ji*la-vs*oa,Bo=Ji*bs-Ei*oa,Ul=Ji*ua-Qr*oa,Uo=vs*bs-Ei*la,pl=vs*ua-Qr*la,zo=Ei*ua-Qr*bs,xs=Ao*zo-Eo*pl+dl*Uo+Pl*Ul-Ol*Bo+Oo*Bl;return xs?(xs=1/xs,At[0]=(Nr*zo-kr*pl+ki*Uo)*xs,At[1]=(Kn*pl-zn*zo-hr*Uo)*xs,At[2]=(la*Oo-bs*Ol+ua*Pl)*xs,At[3]=(Ei*Ol-vs*Oo-Qr*Pl)*xs,At[4]=(kr*Ul-Rr*zo-ki*Bo)*xs,At[5]=(hn*zo-Kn*Ul+hr*Bo)*xs,At[6]=(bs*dl-oa*Oo-ua*Eo)*xs,At[7]=(Ji*Oo-Ei*dl+Qr*Eo)*xs,At[8]=(Rr*pl-Nr*Ul+ki*Bl)*xs,At[9]=(zn*Ul-hn*pl-hr*Bl)*xs,At[10]=(oa*Ol-la*dl+ua*Ao)*xs,At[11]=(vs*dl-Ji*Ol-Qr*Ao)*xs,At[12]=(Nr*Bo-Rr*Uo-kr*Bl)*xs,At[13]=(hn*Uo-zn*Bo+Kn*Bl)*xs,At[14]=(la*Eo-oa*Pl-bs*Ao)*xs,At[15]=(Ji*Pl-vs*Eo+Ei*Ao)*xs,At):null}var gt=new Float32Array([0,0,0,1]),Yt=new Float32Array([0,0,0]);function Qt(At,Pt,hn,zn,Kn,hr){_e(At,zn||null,hr.depthNear,hr.depthFar);var Rr=hn.orientation||gt,Nr=hn.position||Yt;Ne(Pt,Rr,Nr),Kn&&He(Pt,Pt,Kn),ct(Pt,Pt)}return function(At,Pt,hn){return!At||!Pt?!1:(At.pose=Pt,At.timestamp=Pt.timestamp,Qt(At.leftProjectionMatrix,At.leftViewMatrix,Pt,hn._getFieldOfView("left"),hn._getEyeOffset("left"),hn),Qt(At.rightProjectionMatrix,At.rightViewMatrix,Pt,hn._getFieldOfView("right"),hn._getEyeOffset("right"),hn),!0)}}(),Ci=function(){var de=window.self!==window.top,_e=ss(document.referrer),Ne=ss(window.location.href);return de&&_e!==Ne},ss=function(de){var _e,Ne=de.indexOf("://");Ne!==-1?_e=Ne+3:_e=0;var He=de.indexOf("/",_e);return He===-1&&(He=de.length),de.substring(0,He)},tn=function(de){if(de.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var _e=2*Math.acos(de.w);return _e},ye=function(){var le={};return function(de,_e){le[de]===void 0&&(console.warn("webvr-polyfill: "+_e),le[de]=!0)}}(),J=function(de,_e){var Ne=_e?"Please use "+_e+" instead.":"";ye(de,de+" has been deprecated. This may not work on native WebVR displays. "+Ne)};function Me(le,de,_e){if(!de){_e(le);return}for(var Ne=[],He=null,ct=0;ct<de.length;++ct){var gt=de[ct];switch(gt){case le.TEXTURE_BINDING_2D:case le.TEXTURE_BINDING_CUBE_MAP:var Yt=de[++ct];if(Yt<le.TEXTURE0||Yt>le.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),Ne.push(null,null);break}He||(He=le.getParameter(le.ACTIVE_TEXTURE)),le.activeTexture(Yt),Ne.push(le.getParameter(gt),null);break;case le.ACTIVE_TEXTURE:He=le.getParameter(le.ACTIVE_TEXTURE),Ne.push(null);break;default:Ne.push(le.getParameter(gt));break}}_e(le);for(var ct=0;ct<de.length;++ct){var gt=de[ct],Qt=Ne[ct];switch(gt){case le.ACTIVE_TEXTURE:break;case le.ARRAY_BUFFER_BINDING:le.bindBuffer(le.ARRAY_BUFFER,Qt);break;case le.COLOR_CLEAR_VALUE:le.clearColor(Qt[0],Qt[1],Qt[2],Qt[3]);break;case le.COLOR_WRITEMASK:le.colorMask(Qt[0],Qt[1],Qt[2],Qt[3]);break;case le.CURRENT_PROGRAM:le.useProgram(Qt);break;case le.ELEMENT_ARRAY_BUFFER_BINDING:le.bindBuffer(le.ELEMENT_ARRAY_BUFFER,Qt);break;case le.FRAMEBUFFER_BINDING:le.bindFramebuffer(le.FRAMEBUFFER,Qt);break;case le.RENDERBUFFER_BINDING:le.bindRenderbuffer(le.RENDERBUFFER,Qt);break;case le.TEXTURE_BINDING_2D:var Yt=de[++ct];if(Yt<le.TEXTURE0||Yt>le.TEXTURE31)break;le.activeTexture(Yt),le.bindTexture(le.TEXTURE_2D,Qt);break;case le.TEXTURE_BINDING_CUBE_MAP:var Yt=de[++ct];if(Yt<le.TEXTURE0||Yt>le.TEXTURE31)break;le.activeTexture(Yt),le.bindTexture(le.TEXTURE_CUBE_MAP,Qt);break;case le.VIEWPORT:le.viewport(Qt[0],Qt[1],Qt[2],Qt[3]);break;case le.BLEND:case le.CULL_FACE:case le.DEPTH_TEST:case le.SCISSOR_TEST:case le.STENCIL_TEST:Qt?le.enable(gt):le.disable(gt);break;default:console.log("No GL restore behavior for 0x"+gt.toString(16));break}He&&le.activeTexture(He)}}var Ee=Me,ke=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),ee=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function ie(le,de,_e,Ne){this.gl=le,this.cardboardUI=de,this.bufferScale=_e,this.dirtySubmitFrameBindings=Ne,this.ctxAttribs=le.getContextAttributes(),this.instanceExt=le.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=le.drawingBufferWidth,this.bufferHeight=le.drawingBufferHeight,this.realBindFramebuffer=le.bindFramebuffer,this.realEnable=le.enable,this.realDisable=le.disable,this.realColorMask=le.colorMask,this.realClearColor=le.clearColor,this.realViewport=le.viewport,he()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(le.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(le.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=Ar(le,ke,ee,this.attribs),this.uniforms=_i(le,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=le.createBuffer(),this.indexBuffer=le.createBuffer(),this.indexCount=0,this.renderTarget=le.createTexture(),this.framebuffer=le.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=le.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=le.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=le.createRenderbuffer()),this.patch(),this.onResize()}ie.prototype.destroy=function(){var le=this.gl;this.unpatch(),le.deleteProgram(this.program),le.deleteBuffer(this.vertexBuffer),le.deleteBuffer(this.indexBuffer),le.deleteTexture(this.renderTarget),le.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&le.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&le.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&le.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},ie.prototype.onResize=function(){var le=this.gl,de=this,_e=[le.RENDERBUFFER_BINDING,le.TEXTURE_BINDING_2D,le.TEXTURE0];Ee(le,_e,function(Ne){de.realBindFramebuffer.call(Ne,Ne.FRAMEBUFFER,null),de.scissorTest&&de.realDisable.call(Ne,Ne.SCISSOR_TEST),de.realColorMask.call(Ne,!0,!0,!0,!0),de.realViewport.call(Ne,0,0,Ne.drawingBufferWidth,Ne.drawingBufferHeight),de.realClearColor.call(Ne,0,0,0,1),Ne.clear(Ne.COLOR_BUFFER_BIT),de.realBindFramebuffer.call(Ne,Ne.FRAMEBUFFER,de.framebuffer),Ne.bindTexture(Ne.TEXTURE_2D,de.renderTarget),Ne.texImage2D(Ne.TEXTURE_2D,0,de.ctxAttribs.alpha?Ne.RGBA:Ne.RGB,de.bufferWidth,de.bufferHeight,0,de.ctxAttribs.alpha?Ne.RGBA:Ne.RGB,Ne.UNSIGNED_BYTE,null),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MAG_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MIN_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.framebufferTexture2D(Ne.FRAMEBUFFER,Ne.COLOR_ATTACHMENT0,Ne.TEXTURE_2D,de.renderTarget,0),de.ctxAttribs.depth&&de.ctxAttribs.stencil?(Ne.bindRenderbuffer(Ne.RENDERBUFFER,de.depthStencilBuffer),Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.DEPTH_STENCIL,de.bufferWidth,de.bufferHeight),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_STENCIL_ATTACHMENT,Ne.RENDERBUFFER,de.depthStencilBuffer)):de.ctxAttribs.depth?(Ne.bindRenderbuffer(Ne.RENDERBUFFER,de.depthBuffer),Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.DEPTH_COMPONENT16,de.bufferWidth,de.bufferHeight),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_ATTACHMENT,Ne.RENDERBUFFER,de.depthBuffer)):de.ctxAttribs.stencil&&(Ne.bindRenderbuffer(Ne.RENDERBUFFER,de.stencilBuffer),Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.STENCIL_INDEX8,de.bufferWidth,de.bufferHeight),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.STENCIL_ATTACHMENT,Ne.RENDERBUFFER,de.stencilBuffer)),!Ne.checkFramebufferStatus(Ne.FRAMEBUFFER)===Ne.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),de.realBindFramebuffer.call(Ne,Ne.FRAMEBUFFER,de.lastBoundFramebuffer),de.scissorTest&&de.realEnable.call(Ne,Ne.SCISSOR_TEST),de.realColorMask.apply(Ne,de.colorMask),de.realViewport.apply(Ne,de.viewport),de.realClearColor.apply(Ne,de.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},ie.prototype.patch=function(){if(!this.isPatched){var le=this,de=this.gl.canvas,_e=this.gl;he()||(de.width=Tn()*this.bufferScale,de.height=xn()*this.bufferScale,Object.defineProperty(de,"width",{configurable:!0,enumerable:!0,get:function(){return le.bufferWidth},set:function(He){le.bufferWidth=He,le.realCanvasWidth.set.call(de,He),le.onResize()}}),Object.defineProperty(de,"height",{configurable:!0,enumerable:!0,get:function(){return le.bufferHeight},set:function(He){le.bufferHeight=He,le.realCanvasHeight.set.call(de,He),le.onResize()}})),this.lastBoundFramebuffer=_e.getParameter(_e.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(_e.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(Ne,He){le.lastBoundFramebuffer=He||le.framebuffer,le.realBindFramebuffer.call(_e,Ne,le.lastBoundFramebuffer)},this.cullFace=_e.getParameter(_e.CULL_FACE),this.depthTest=_e.getParameter(_e.DEPTH_TEST),this.blend=_e.getParameter(_e.BLEND),this.scissorTest=_e.getParameter(_e.SCISSOR_TEST),this.stencilTest=_e.getParameter(_e.STENCIL_TEST),_e.enable=function(Ne){switch(Ne){case _e.CULL_FACE:le.cullFace=!0;break;case _e.DEPTH_TEST:le.depthTest=!0;break;case _e.BLEND:le.blend=!0;break;case _e.SCISSOR_TEST:le.scissorTest=!0;break;case _e.STENCIL_TEST:le.stencilTest=!0;break}le.realEnable.call(_e,Ne)},_e.disable=function(Ne){switch(Ne){case _e.CULL_FACE:le.cullFace=!1;break;case _e.DEPTH_TEST:le.depthTest=!1;break;case _e.BLEND:le.blend=!1;break;case _e.SCISSOR_TEST:le.scissorTest=!1;break;case _e.STENCIL_TEST:le.stencilTest=!1;break}le.realDisable.call(_e,Ne)},this.colorMask=_e.getParameter(_e.COLOR_WRITEMASK),_e.colorMask=function(Ne,He,ct,gt){le.colorMask[0]=Ne,le.colorMask[1]=He,le.colorMask[2]=ct,le.colorMask[3]=gt,le.realColorMask.call(_e,Ne,He,ct,gt)},this.clearColor=_e.getParameter(_e.COLOR_CLEAR_VALUE),_e.clearColor=function(Ne,He,ct,gt){le.clearColor[0]=Ne,le.clearColor[1]=He,le.clearColor[2]=ct,le.clearColor[3]=gt,le.realClearColor.call(_e,Ne,He,ct,gt)},this.viewport=_e.getParameter(_e.VIEWPORT),_e.viewport=function(Ne,He,ct,gt){le.viewport[0]=Ne,le.viewport[1]=He,le.viewport[2]=ct,le.viewport[3]=gt,le.realViewport.call(_e,Ne,He,ct,gt)},this.isPatched=!0,Di(de)}},ie.prototype.unpatch=function(){if(!!this.isPatched){var le=this.gl,de=this.gl.canvas;he()||(Object.defineProperty(de,"width",this.realCanvasWidth),Object.defineProperty(de,"height",this.realCanvasHeight)),de.width=this.bufferWidth,de.height=this.bufferHeight,le.bindFramebuffer=this.realBindFramebuffer,le.enable=this.realEnable,le.disable=this.realDisable,le.colorMask=this.realColorMask,le.clearColor=this.realClearColor,le.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&le.bindFramebuffer(le.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){Di(de)},1)}},ie.prototype.setTextureBounds=function(le,de){le||(le=[0,0,.5,1]),de||(de=[.5,0,.5,1]),this.viewportOffsetScale[0]=le[0],this.viewportOffsetScale[1]=le[1],this.viewportOffsetScale[2]=le[2],this.viewportOffsetScale[3]=le[3],this.viewportOffsetScale[4]=de[0],this.viewportOffsetScale[5]=de[1],this.viewportOffsetScale[6]=de[2],this.viewportOffsetScale[7]=de[3]},ie.prototype.submitFrame=function(){var le=this.gl,de=this,_e=[];if(this.dirtySubmitFrameBindings||_e.push(le.CURRENT_PROGRAM,le.ARRAY_BUFFER_BINDING,le.ELEMENT_ARRAY_BUFFER_BINDING,le.TEXTURE_BINDING_2D,le.TEXTURE0),Ee(le,_e,function(He){de.realBindFramebuffer.call(He,He.FRAMEBUFFER,null);var ct=0,gt=0;de.instanceExt&&(ct=He.getVertexAttrib(de.attribs.position,de.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),gt=He.getVertexAttrib(de.attribs.texCoord,de.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),de.cullFace&&de.realDisable.call(He,He.CULL_FACE),de.depthTest&&de.realDisable.call(He,He.DEPTH_TEST),de.blend&&de.realDisable.call(He,He.BLEND),de.scissorTest&&de.realDisable.call(He,He.SCISSOR_TEST),de.stencilTest&&de.realDisable.call(He,He.STENCIL_TEST),de.realColorMask.call(He,!0,!0,!0,!0),de.realViewport.call(He,0,0,He.drawingBufferWidth,He.drawingBufferHeight),(de.ctxAttribs.alpha||he())&&(de.realClearColor.call(He,0,0,0,1),He.clear(He.COLOR_BUFFER_BIT)),He.useProgram(de.program),He.bindBuffer(He.ELEMENT_ARRAY_BUFFER,de.indexBuffer),He.bindBuffer(He.ARRAY_BUFFER,de.vertexBuffer),He.enableVertexAttribArray(de.attribs.position),He.enableVertexAttribArray(de.attribs.texCoord),He.vertexAttribPointer(de.attribs.position,2,He.FLOAT,!1,20,0),He.vertexAttribPointer(de.attribs.texCoord,3,He.FLOAT,!1,20,8),de.instanceExt&&(ct!=0&&de.instanceExt.vertexAttribDivisorANGLE(de.attribs.position,0),gt!=0&&de.instanceExt.vertexAttribDivisorANGLE(de.attribs.texCoord,0)),He.activeTexture(He.TEXTURE0),He.uniform1i(de.uniforms.diffuse,0),He.bindTexture(He.TEXTURE_2D,de.renderTarget),He.uniform4fv(de.uniforms.viewportOffsetScale,de.viewportOffsetScale),He.drawElements(He.TRIANGLES,de.indexCount,He.UNSIGNED_SHORT,0),de.cardboardUI&&de.cardboardUI.renderNoState(),de.realBindFramebuffer.call(de.gl,He.FRAMEBUFFER,de.framebuffer),de.ctxAttribs.preserveDrawingBuffer||(de.realClearColor.call(He,0,0,0,0),He.clear(He.COLOR_BUFFER_BIT)),de.dirtySubmitFrameBindings||de.realBindFramebuffer.call(He,He.FRAMEBUFFER,de.lastBoundFramebuffer),de.cullFace&&de.realEnable.call(He,He.CULL_FACE),de.depthTest&&de.realEnable.call(He,He.DEPTH_TEST),de.blend&&de.realEnable.call(He,He.BLEND),de.scissorTest&&de.realEnable.call(He,He.SCISSOR_TEST),de.stencilTest&&de.realEnable.call(He,He.STENCIL_TEST),de.realColorMask.apply(He,de.colorMask),de.realViewport.apply(He,de.viewport),(de.ctxAttribs.alpha||!de.ctxAttribs.preserveDrawingBuffer)&&de.realClearColor.apply(He,de.clearColor),de.instanceExt&&(ct!=0&&de.instanceExt.vertexAttribDivisorANGLE(de.attribs.position,ct),gt!=0&&de.instanceExt.vertexAttribDivisorANGLE(de.attribs.texCoord,gt))}),he()){var Ne=le.canvas;(Ne.width!=de.bufferWidth||Ne.height!=de.bufferHeight)&&(de.bufferWidth=Ne.width,de.bufferHeight=Ne.height,de.onResize())}},ie.prototype.updateDeviceInfo=function(le){var de=this.gl,_e=this,Ne=[de.ARRAY_BUFFER_BINDING,de.ELEMENT_ARRAY_BUFFER_BINDING];Ee(de,Ne,function(He){var ct=_e.computeMeshVertices_(_e.meshWidth,_e.meshHeight,le);if(He.bindBuffer(He.ARRAY_BUFFER,_e.vertexBuffer),He.bufferData(He.ARRAY_BUFFER,ct,He.STATIC_DRAW),!_e.indexCount){var gt=_e.computeMeshIndices_(_e.meshWidth,_e.meshHeight);He.bindBuffer(He.ELEMENT_ARRAY_BUFFER,_e.indexBuffer),He.bufferData(He.ELEMENT_ARRAY_BUFFER,gt,He.STATIC_DRAW),_e.indexCount=gt.length}})},ie.prototype.computeMeshVertices_=function(le,de,_e){for(var Ne=new Float32Array(2*le*de*5),He=_e.getLeftEyeVisibleTanAngles(),ct=_e.getLeftEyeNoLensTanAngles(),gt=_e.getLeftEyeVisibleScreenRect(ct),Yt=0,Qt=0;Qt<2;Qt++){for(var At=0;At<de;At++)for(var Pt=0;Pt<le;Pt++,Yt++){var hn=Pt/(le-1),zn=At/(de-1),Kn=hn,hr=zn,Rr=we(He[0],He[2],hn),Nr=we(He[3],He[1],zn),kr=Math.sqrt(Rr*Rr+Nr*Nr),ki=_e.distortion.distortInverse(kr),Ji=Rr*ki/kr,vs=Nr*ki/kr;hn=(Ji-ct[0])/(ct[2]-ct[0]),zn=(vs-ct[3])/(ct[1]-ct[3]),hn=(gt.x+hn*gt.width-.5)*2,zn=(gt.y+zn*gt.height-.5)*2,Ne[Yt*5+0]=hn,Ne[Yt*5+1]=zn,Ne[Yt*5+2]=Kn,Ne[Yt*5+3]=hr,Ne[Yt*5+4]=Qt}var Ei=He[2]-He[0];He[0]=-(Ei+He[0]),He[2]=Ei-He[2],Ei=ct[2]-ct[0],ct[0]=-(Ei+ct[0]),ct[2]=Ei-ct[2],gt.x=1-(gt.x+gt.width)}return Ne},ie.prototype.computeMeshIndices_=function(le,de){for(var _e=new Uint16Array(2*(le-1)*(de-1)*6),Ne=le/2,He=de/2,ct=0,gt=0,Yt=0;Yt<2;Yt++)for(var Qt=0;Qt<de;Qt++)for(var At=0;At<le;At++,ct++)At==0||Qt==0||(At<=Ne==Qt<=He?(_e[gt++]=ct,_e[gt++]=ct-le-1,_e[gt++]=ct-le,_e[gt++]=ct-le-1,_e[gt++]=ct,_e[gt++]=ct-1):(_e[gt++]=ct-1,_e[gt++]=ct-le,_e[gt++]=ct,_e[gt++]=ct-le,_e[gt++]=ct-1,_e[gt++]=ct-le-1));return _e},ie.prototype.getOwnPropertyDescriptor_=function(le,de){var _e=Object.getOwnPropertyDescriptor(le,de);return(_e.get===void 0||_e.set===void 0)&&(_e.configurable=!0,_e.enumerable=!0,_e.get=function(){return this.getAttribute(de)},_e.set=function(Ne){this.setAttribute(de,Ne)}),_e};var X=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),te=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),me=Math.PI/180,Le=60,Ye=12,rt=20,Wt=1,mn=.75,gn=.3125,_n=4,In=28,Yr=1.5;function Zn(le){this.gl=le,this.attribs={position:0},this.program=Ar(le,X,te,this.attribs),this.uniforms=_i(le,this.program),this.vertexBuffer=le.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Zn.prototype.destroy=function(){var le=this.gl;this.listener&&le.canvas.removeEventListener("click",this.listener,!1),le.deleteProgram(this.program),le.deleteBuffer(this.vertexBuffer)},Zn.prototype.listen=function(le,de){var _e=this.gl.canvas;this.listener=function(Ne){var He=_e.clientWidth/2,ct=In*Yr;Ne.clientX>He-ct&&Ne.clientX<He+ct&&Ne.clientY>_e.clientHeight-ct?le(Ne):Ne.clientX<ct&&Ne.clientY<ct&&de(Ne)},_e.addEventListener("click",this.listener,!1)},Zn.prototype.onResize=function(){var le=this.gl,de=this,_e=[le.ARRAY_BUFFER_BINDING];Ee(le,_e,function(Ne){var He=[],ct=Ne.drawingBufferWidth/2,gt=Math.max(screen.width,screen.height)*window.devicePixelRatio,Yt=Ne.drawingBufferWidth/gt,Qt=Yt*window.devicePixelRatio,At=_n*Qt/2,Pt=In*Yr*Qt,hn=In*Qt/2,zn=(In*Yr-In)*Qt;He.push(ct-At,Pt),He.push(ct-At,Ne.drawingBufferHeight),He.push(ct+At,Pt),He.push(ct+At,Ne.drawingBufferHeight),de.gearOffset=He.length/2;function Kn(ki,Ji){var vs=(90-ki)*me,Ei=Math.cos(vs),Qr=Math.sin(vs);He.push(gn*Ei*hn+ct,gn*Qr*hn+hn),He.push(Ji*Ei*hn+ct,Ji*Qr*hn+hn)}for(var hr=0;hr<=6;hr++){var Rr=hr*Le;Kn(Rr,Wt),Kn(Rr+Ye,Wt),Kn(Rr+rt,mn),Kn(Rr+(Le-rt),mn),Kn(Rr+(Le-Ye),Wt)}de.gearVertexCount=He.length/2-de.gearOffset,de.arrowOffset=He.length/2;function Nr(ki,Ji){He.push(zn+ki,Ne.drawingBufferHeight-zn-Ji)}var kr=At/Math.sin(45*me);Nr(0,hn),Nr(hn,0),Nr(hn+kr,kr),Nr(kr,hn+kr),Nr(kr,hn-kr),Nr(0,hn),Nr(hn,hn*2),Nr(hn+kr,hn*2-kr),Nr(kr,hn-kr),Nr(0,hn),Nr(kr,hn-At),Nr(In*Qt,hn-At),Nr(kr,hn+At),Nr(In*Qt,hn+At),de.arrowVertexCount=He.length/2-de.arrowOffset,Ne.bindBuffer(Ne.ARRAY_BUFFER,de.vertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,new Float32Array(He),Ne.STATIC_DRAW)})},Zn.prototype.render=function(){var le=this.gl,de=this,_e=[le.CULL_FACE,le.DEPTH_TEST,le.BLEND,le.SCISSOR_TEST,le.STENCIL_TEST,le.COLOR_WRITEMASK,le.VIEWPORT,le.CURRENT_PROGRAM,le.ARRAY_BUFFER_BINDING];Ee(le,_e,function(Ne){Ne.disable(Ne.CULL_FACE),Ne.disable(Ne.DEPTH_TEST),Ne.disable(Ne.BLEND),Ne.disable(Ne.SCISSOR_TEST),Ne.disable(Ne.STENCIL_TEST),Ne.colorMask(!0,!0,!0,!0),Ne.viewport(0,0,Ne.drawingBufferWidth,Ne.drawingBufferHeight),de.renderNoState()})},Zn.prototype.renderNoState=function(){var le=this.gl;le.useProgram(this.program),le.bindBuffer(le.ARRAY_BUFFER,this.vertexBuffer),le.enableVertexAttribArray(this.attribs.position),le.vertexAttribPointer(this.attribs.position,2,le.FLOAT,!1,8,0),le.uniform4f(this.uniforms.color,1,1,1,1),si(this.projMat,0,le.drawingBufferWidth,0,le.drawingBufferHeight,.1,1024),le.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),le.drawArrays(le.TRIANGLE_STRIP,0,4),le.drawArrays(le.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),le.drawArrays(le.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Ii(le){this.coefficients=le}Ii.prototype.distortInverse=function(le){for(var de=0,_e=1,Ne=le-this.distort(de);Math.abs(_e-de)>1e-4;){var He=le-this.distort(_e),ct=_e-He*((_e-de)/(He-Ne));de=_e,_e=ct,Ne=He}return _e},Ii.prototype.distort=function(le){for(var de=le*le,_e=0,Ne=0;Ne<this.coefficients.length;Ne++)_e=de*(_e+this.coefficients[Ne]);return(_e+1)*le};var Pr=Math.PI/180,St=180/Math.PI,Kt=function(de,_e,Ne){this.x=de||0,this.y=_e||0,this.z=Ne||0};Kt.prototype={constructor:Kt,set:function(de,_e,Ne){return this.x=de,this.y=_e,this.z=Ne,this},copy:function(de){return this.x=de.x,this.y=de.y,this.z=de.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var de=this.length();if(de!==0){var _e=1/de;this.multiplyScalar(_e)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(de){this.x*=de,this.y*=de,this.z*=de},applyQuaternion:function(de){var _e=this.x,Ne=this.y,He=this.z,ct=de.x,gt=de.y,Yt=de.z,Qt=de.w,At=Qt*_e+gt*He-Yt*Ne,Pt=Qt*Ne+Yt*_e-ct*He,hn=Qt*He+ct*Ne-gt*_e,zn=-ct*_e-gt*Ne-Yt*He;return this.x=At*Qt+zn*-ct+Pt*-Yt-hn*-gt,this.y=Pt*Qt+zn*-gt+hn*-ct-At*-Yt,this.z=hn*Qt+zn*-Yt+At*-gt-Pt*-ct,this},dot:function(de){return this.x*de.x+this.y*de.y+this.z*de.z},crossVectors:function(de,_e){var Ne=de.x,He=de.y,ct=de.z,gt=_e.x,Yt=_e.y,Qt=_e.z;return this.x=He*Qt-ct*Yt,this.y=ct*gt-Ne*Qt,this.z=Ne*Yt-He*gt,this}};var vn=function(de,_e,Ne,He){this.x=de||0,this.y=_e||0,this.z=Ne||0,this.w=He!==void 0?He:1};vn.prototype={constructor:vn,set:function(de,_e,Ne,He){return this.x=de,this.y=_e,this.z=Ne,this.w=He,this},copy:function(de){return this.x=de.x,this.y=de.y,this.z=de.z,this.w=de.w,this},setFromEulerXYZ:function(de,_e,Ne){var He=Math.cos(de/2),ct=Math.cos(_e/2),gt=Math.cos(Ne/2),Yt=Math.sin(de/2),Qt=Math.sin(_e/2),At=Math.sin(Ne/2);return this.x=Yt*ct*gt+He*Qt*At,this.y=He*Qt*gt-Yt*ct*At,this.z=He*ct*At+Yt*Qt*gt,this.w=He*ct*gt-Yt*Qt*At,this},setFromEulerYXZ:function(de,_e,Ne){var He=Math.cos(de/2),ct=Math.cos(_e/2),gt=Math.cos(Ne/2),Yt=Math.sin(de/2),Qt=Math.sin(_e/2),At=Math.sin(Ne/2);return this.x=Yt*ct*gt+He*Qt*At,this.y=He*Qt*gt-Yt*ct*At,this.z=He*ct*At-Yt*Qt*gt,this.w=He*ct*gt+Yt*Qt*At,this},setFromAxisAngle:function(de,_e){var Ne=_e/2,He=Math.sin(Ne);return this.x=de.x*He,this.y=de.y*He,this.z=de.z*He,this.w=Math.cos(Ne),this},multiply:function(de){return this.multiplyQuaternions(this,de)},multiplyQuaternions:function(de,_e){var Ne=de.x,He=de.y,ct=de.z,gt=de.w,Yt=_e.x,Qt=_e.y,At=_e.z,Pt=_e.w;return this.x=Ne*Pt+gt*Yt+He*At-ct*Qt,this.y=He*Pt+gt*Qt+ct*Yt-Ne*At,this.z=ct*Pt+gt*At+Ne*Qt-He*Yt,this.w=gt*Pt-Ne*Yt-He*Qt-ct*At,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var de=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return de===0?(this.x=0,this.y=0,this.z=0,this.w=1):(de=1/de,this.x=this.x*de,this.y=this.y*de,this.z=this.z*de,this.w=this.w*de),this},slerp:function(de,_e){if(_e===0)return this;if(_e===1)return this.copy(de);var Ne=this.x,He=this.y,ct=this.z,gt=this.w,Yt=gt*de.w+Ne*de.x+He*de.y+ct*de.z;if(Yt<0?(this.w=-de.w,this.x=-de.x,this.y=-de.y,this.z=-de.z,Yt=-Yt):this.copy(de),Yt>=1)return this.w=gt,this.x=Ne,this.y=He,this.z=ct,this;var Qt=Math.acos(Yt),At=Math.sqrt(1-Yt*Yt);if(Math.abs(At)<.001)return this.w=.5*(gt+this.w),this.x=.5*(Ne+this.x),this.y=.5*(He+this.y),this.z=.5*(ct+this.z),this;var Pt=Math.sin((1-_e)*Qt)/At,hn=Math.sin(_e*Qt)/At;return this.w=gt*Pt+this.w*hn,this.x=Ne*Pt+this.x*hn,this.y=He*Pt+this.y*hn,this.z=ct*Pt+this.z*hn,this},setFromUnitVectors:function(){var le,de,_e=1e-6;return function(Ne,He){return le===void 0&&(le=new Kt),de=Ne.dot(He)+1,de<_e?(de=0,Math.abs(Ne.x)>Math.abs(Ne.z)?le.set(-Ne.y,Ne.x,0):le.set(0,-Ne.z,Ne.y)):le.crossVectors(Ne,He),this.x=le.x,this.y=le.y,this.z=le.z,this.w=de,this.normalize(),this}}()};function cr(le){this.width=le.width||Tn(),this.height=le.height||xn(),this.widthMeters=le.widthMeters,this.heightMeters=le.heightMeters,this.bevelMeters=le.bevelMeters}var ir=new cr({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),xr=new cr({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Ir={CardboardV1:new gi({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new gi({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Sr(le,de){this.viewer=Ir.CardboardV2,this.updateDeviceParams(le),this.distortion=new Ii(this.viewer.distortionCoefficients);for(var _e=0;_e<de.length;_e++){var Ne=de[_e];Ir[Ne.id]=new gi(Ne)}}Sr.prototype.updateDeviceParams=function(le){this.device=this.determineDevice_(le)||this.device},Sr.prototype.getDevice=function(){return this.device},Sr.prototype.setViewer=function(le){this.viewer=le,this.distortion=new Ii(this.viewer.distortionCoefficients)},Sr.prototype.determineDevice_=function(le){if(!le)return he()?(console.warn("Using fallback iOS device measurements."),xr):(console.warn("Using fallback Android device measurements."),ir);var de=.0254,_e=de/le.xdpi,Ne=de/le.ydpi,He=Tn(),ct=xn();return new cr({widthMeters:_e*He,heightMeters:Ne*ct,bevelMeters:le.bevelMm*.001})},Sr.prototype.getDistortedFieldOfViewLeftEye=function(){var le=this.viewer,de=this.device,_e=this.distortion,Ne=le.screenLensDistance,He=(de.widthMeters-le.interLensDistance)/2,ct=le.interLensDistance/2,gt=le.baselineLensDistance-de.bevelMeters,Yt=de.heightMeters-gt,Qt=St*Math.atan(_e.distort(He/Ne)),At=St*Math.atan(_e.distort(ct/Ne)),Pt=St*Math.atan(_e.distort(gt/Ne)),hn=St*Math.atan(_e.distort(Yt/Ne));return{leftDegrees:Math.min(Qt,le.fov),rightDegrees:Math.min(At,le.fov),downDegrees:Math.min(Pt,le.fov),upDegrees:Math.min(hn,le.fov)}},Sr.prototype.getLeftEyeVisibleTanAngles=function(){var le=this.viewer,de=this.device,_e=this.distortion,Ne=Math.tan(-Pr*le.fov),He=Math.tan(Pr*le.fov),ct=Math.tan(Pr*le.fov),gt=Math.tan(-Pr*le.fov),Yt=de.widthMeters/4,Qt=de.heightMeters/2,At=le.baselineLensDistance-de.bevelMeters-Qt,Pt=le.interLensDistance/2-Yt,hn=-At,zn=le.screenLensDistance,Kn=_e.distort((Pt-Yt)/zn),hr=_e.distort((hn+Qt)/zn),Rr=_e.distort((Pt+Yt)/zn),Nr=_e.distort((hn-Qt)/zn),kr=new Float32Array(4);return kr[0]=Math.max(Ne,Kn),kr[1]=Math.min(He,hr),kr[2]=Math.min(ct,Rr),kr[3]=Math.max(gt,Nr),kr},Sr.prototype.getLeftEyeNoLensTanAngles=function(){var le=this.viewer,de=this.device,_e=this.distortion,Ne=new Float32Array(4),He=_e.distortInverse(Math.tan(-Pr*le.fov)),ct=_e.distortInverse(Math.tan(Pr*le.fov)),gt=_e.distortInverse(Math.tan(Pr*le.fov)),Yt=_e.distortInverse(Math.tan(-Pr*le.fov)),Qt=de.widthMeters/4,At=de.heightMeters/2,Pt=le.baselineLensDistance-de.bevelMeters-At,hn=le.interLensDistance/2-Qt,zn=-Pt,Kn=le.screenLensDistance,hr=(hn-Qt)/Kn,Rr=(zn+At)/Kn,Nr=(hn+Qt)/Kn,kr=(zn-At)/Kn;return Ne[0]=Math.max(He,hr),Ne[1]=Math.min(ct,Rr),Ne[2]=Math.min(gt,Nr),Ne[3]=Math.max(Yt,kr),Ne},Sr.prototype.getLeftEyeVisibleScreenRect=function(le){var de=this.viewer,_e=this.device,Ne=de.screenLensDistance,He=(_e.widthMeters-de.interLensDistance)/2,ct=de.baselineLensDistance-_e.bevelMeters,gt=(le[0]*Ne+He)/_e.widthMeters,Yt=(le[1]*Ne+ct)/_e.heightMeters,Qt=(le[2]*Ne+He)/_e.widthMeters,At=(le[3]*Ne+ct)/_e.heightMeters;return{x:gt,y:At,width:Qt-gt,height:Yt-At}},Sr.prototype.getFieldOfViewLeftEye=function(le){return le?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Sr.prototype.getFieldOfViewRightEye=function(le){var de=this.getFieldOfViewLeftEye(le);return{leftDegrees:de.rightDegrees,rightDegrees:de.leftDegrees,upDegrees:de.upDegrees,downDegrees:de.downDegrees}},Sr.prototype.getUndistortedFieldOfViewLeftEye=function(){var le=this.getUndistortedParams_();return{leftDegrees:St*Math.atan(le.outerDist),rightDegrees:St*Math.atan(le.innerDist),downDegrees:St*Math.atan(le.bottomDist),upDegrees:St*Math.atan(le.topDist)}},Sr.prototype.getUndistortedViewportLeftEye=function(){var le=this.getUndistortedParams_(),de=this.viewer,_e=this.device,Ne=de.screenLensDistance,He=_e.widthMeters/Ne,ct=_e.heightMeters/Ne,gt=_e.width/He,Yt=_e.height/ct,Qt=Math.round((le.eyePosX-le.outerDist)*gt),At=Math.round((le.eyePosY-le.bottomDist)*Yt);return{x:Qt,y:At,width:Math.round((le.eyePosX+le.innerDist)*gt)-Qt,height:Math.round((le.eyePosY+le.topDist)*Yt)-At}},Sr.prototype.getUndistortedParams_=function(){var le=this.viewer,de=this.device,_e=this.distortion,Ne=le.screenLensDistance,He=le.interLensDistance/2/Ne,ct=de.widthMeters/Ne,gt=de.heightMeters/Ne,Yt=ct/2-He,Qt=(le.baselineLensDistance-de.bevelMeters)/Ne,At=le.fov,Pt=_e.distortInverse(Math.tan(Pr*At)),hn=Math.min(Yt,Pt),zn=Math.min(He,Pt),Kn=Math.min(Qt,Pt),hr=Math.min(gt-Qt,Pt);return{outerDist:hn,innerDist:zn,topDist:hr,bottomDist:Kn,eyePosX:Yt,eyePosY:Qt}};function gi(le){this.id=le.id,this.label=le.label,this.fov=le.fov,this.interLensDistance=le.interLensDistance,this.baselineLensDistance=le.baselineLensDistance,this.screenLensDistance=le.screenLensDistance,this.distortionCoefficients=le.distortionCoefficients,this.inverseCoefficients=le.inverseCoefficients}Sr.Viewers=Ir;var yi=1,hs="2019-11-09T17:36:14Z",ti=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Vi={format:yi,last_updated:hs,devices:ti};function Rn(le,de){if(this.dpdb=Vi,this.recalculateDeviceParams_(),le){this.onDeviceParamsUpdated=de;var _e=new XMLHttpRequest,Ne=this;_e.open("GET",le,!0),_e.addEventListener("load",function(){Ne.loading=!1,_e.status>=200&&_e.status<=299?(Ne.dpdb=JSON.parse(_e.response),Ne.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),_e.send()}}Rn.prototype.getDeviceParams=function(){return this.deviceParams},Rn.prototype.recalculateDeviceParams_=function(){var le=this.calcDeviceParams_();le?(this.deviceParams=le,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Rn.prototype.calcDeviceParams_=function(){var le=this.dpdb;if(!le)return console.error("DPDB not available."),null;if(le.format!=1)return console.error("DPDB has unexpected format version."),null;if(!le.devices||!le.devices.length)return console.error("DPDB does not have a devices section."),null;var de=navigator.userAgent||navigator.vendor||window.opera,_e=Tn(),Ne=xn();if(!le.devices)return console.error("DPDB has no devices section."),null;for(var He=0;He<le.devices.length;He++){var ct=le.devices[He];if(!ct.rules){console.warn("Device["+He+"] has no rules section.");continue}if(ct.type!="ios"&&ct.type!="android"){console.warn("Device["+He+"] has invalid type.");continue}if(he()==(ct.type=="ios")){for(var gt=!1,Yt=0;Yt<ct.rules.length;Yt++){var Qt=ct.rules[Yt];if(this.ruleMatches_(Qt,de,_e,Ne)){gt=!0;break}}if(!!gt){var At=ct.dpi[0]||ct.dpi,Pt=ct.dpi[1]||ct.dpi;return new wo({xdpi:At,ydpi:Pt,bevelMm:ct.bw})}}}return console.warn("No DPDB device match."),null},Rn.prototype.ruleMatches_=function(le,de,_e,Ne){if(!le.ua&&!le.res||(le.ua&&le.ua.substring(0,2)==="SM"&&(le.ua=le.ua.substring(0,7)),le.ua&&de.indexOf(le.ua)<0))return!1;if(le.res){if(!le.res[0]||!le.res[1])return!1;var He=le.res[0],ct=le.res[1];if(Math.min(_e,Ne)!=Math.min(He,ct)||Math.max(_e,Ne)!=Math.max(He,ct))return!1}return!0};function wo(le){this.xdpi=le.xdpi,this.ydpi=le.ydpi,this.bevelMm=le.bevelMm}function Xi(le,de){this.set(le,de)}Xi.prototype.set=function(le,de){this.sample=le,this.timestampS=de},Xi.prototype.copy=function(le){this.set(le.sample,le.timestampS)};function Fi(le,de){this.kFilter=le,this.isDebug=de,this.currentAccelMeasurement=new Xi,this.currentGyroMeasurement=new Xi,this.previousGyroMeasurement=new Xi,he()?this.filterQ=new vn(-1,0,0,1):this.filterQ=new vn(1,0,0,1),this.previousFilterQ=new vn,this.previousFilterQ.copy(this.filterQ),this.accelQ=new vn,this.isOrientationInitialized=!1,this.estimatedGravity=new Kt,this.measuredGravity=new Kt,this.gyroIntegralQ=new vn}Fi.prototype.addAccelMeasurement=function(le,de){this.currentAccelMeasurement.set(le,de)},Fi.prototype.addGyroMeasurement=function(le,de){this.currentGyroMeasurement.set(le,de);var _e=de-this.previousGyroMeasurement.timestampS;ln(_e)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Fi.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var le=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,de=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,le);this.gyroIntegralQ.multiply(de),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(de);var _e=new vn;_e.copy(this.filterQ),_e.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(_e),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var Ne=new vn;Ne.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),Ne.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",St*tn(Ne),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var He=new vn;He.copy(this.filterQ),He.multiply(Ne),this.filterQ.slerp(He,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Fi.prototype.getOrientation=function(){return this.filterQ},Fi.prototype.accelToQuaternion_=function(le){var de=new Kt;de.copy(le),de.normalize();var _e=new vn;return _e.setFromUnitVectors(new Kt(0,0,-1),de),_e.inverse(),_e},Fi.prototype.gyroToQuaternionDelta_=function(le,de){var _e=new vn,Ne=new Kt;return Ne.copy(le),Ne.normalize(),_e.setFromAxisAngle(Ne,le.length()*de),_e};function li(le,de){this.predictionTimeS=le,this.isDebug=de,this.previousQ=new vn,this.previousTimestampS=null,this.deltaQ=new vn,this.outQ=new vn}li.prototype.getPrediction=function(le,de,_e){if(!this.previousTimestampS)return this.previousQ.copy(le),this.previousTimestampS=_e,le;var Ne=new Kt;Ne.copy(de),Ne.normalize();var He=de.length();if(He<Pr*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(St*He).toFixed(1)),this.outQ.copy(le),this.previousQ.copy(le),this.outQ;var ct=He*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(Ne,ct),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(le),this.previousTimestampS=_e,this.outQ};function aa(le,de,_e,Ne){this.yawOnly=_e,this.accelerometer=new Kt,this.gyroscope=new Kt,this.filter=new Fi(le,Ne),this.posePredictor=new li(de,Ne),this.isFirefoxAndroid=Ue(),this.isIOS=he();var He=Qe();this.isDeviceMotionInRadians=!this.isIOS&&He&&He<66,this.isWithoutDeviceMotion=lt()||ht(),this.filterToWorldQ=new vn,he()?this.filterToWorldQ.setFromAxisAngle(new Kt(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Kt(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new vn,this.worldToScreenQ=new vn,this.originalPoseAdjustQ=new vn,this.originalPoseAdjustQ.setFromAxisAngle(new Kt(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),Mt()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new vn,this.orientationOut_=new Float32Array(4),this.start()}aa.prototype.getPosition=function(){return null},aa.prototype.getOrientation=function(){var le=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var He=new vn().setFromAxisAngle(new Kt(0,0,-1),0),ct=new vn;return window.orientation===-90?ct.setFromAxisAngle(new Kt(0,1,0),Math.PI/-2):ct.setFromAxisAngle(new Kt(0,1,0),Math.PI/2),He.multiply(ct)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var He=new vn;return He.setFromAxisAngle(new Kt(1,0,0),-Math.PI/2),He}(),le=this._deviceOrientationQ;var _e=new vn;return _e.copy(le),_e.multiply(this.deviceOrientationFilterToWorldQ),_e.multiply(this.resetQ),_e.multiply(this.worldToScreenQ),_e.multiplyQuaternions(this.deviceOrientationFixQ,_e),this.yawOnly&&(_e.x=0,_e.z=0,_e.normalize()),this.orientationOut_[0]=_e.x,this.orientationOut_[1]=_e.y,this.orientationOut_[2]=_e.z,this.orientationOut_[3]=_e.w,this.orientationOut_}else{var de=this.filter.getOrientation();le=this.posePredictor.getPrediction(de,this.gyroscope,this.previousTimestampS)}var _e=new vn;return _e.copy(this.filterToWorldQ),_e.multiply(this.resetQ),_e.multiply(le),_e.multiply(this.worldToScreenQ),this.yawOnly&&(_e.x=0,_e.z=0,_e.normalize()),this.orientationOut_[0]=_e.x,this.orientationOut_[1]=_e.y,this.orientationOut_[2]=_e.z,this.orientationOut_[3]=_e.w,this.orientationOut_},aa.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),Mt()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},aa.prototype.onDeviceOrientation_=function(le){this._deviceOrientationQ=this._deviceOrientationQ||new vn;var de=le.alpha,_e=le.beta,Ne=le.gamma;de=(de||0)*Math.PI/180,_e=(_e||0)*Math.PI/180,Ne=(Ne||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(_e,de,-Ne)},aa.prototype.onDeviceMotion_=function(le){this.updateDeviceMotion_(le)},aa.prototype.updateDeviceMotion_=function(le){var de=le.accelerationIncludingGravity,_e=le.rotationRate,Ne=le.timeStamp/1e3,He=Ne-this.previousTimestampS;if(He<0){ye("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=Ne;return}else if(He<=Se||He>be){ye("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=Ne;return}this.accelerometer.set(-de.x,-de.y,-de.z),_e&&(Et()?this.gyroscope.set(-_e.beta,_e.alpha,_e.gamma):this.gyroscope.set(_e.alpha,_e.beta,_e.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,Ne)),this.filter.addAccelMeasurement(this.accelerometer,Ne),this.previousTimestampS=Ne},aa.prototype.onOrientationChange_=function(le){this.setScreenTransform_()},aa.prototype.onMessage_=function(le){var de=le.data;if(!(!de||!de.type)){var _e=de.type.toLowerCase();_e==="devicemotion"&&this.updateDeviceMotion_(de.deviceMotionEvent)}},aa.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Kt(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Kt(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},aa.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),he()&&Ci()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},aa.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var nc=60,zs=new Kt(1,0,0),$e=new Kt(0,0,1),et=new vn;et.setFromAxisAngle(zs,-Math.PI/2),et.multiply(new vn().setFromAxisAngle($e,Math.PI/2));var xt=function(){function le(de){Q(this,le),this.config=de,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new vn,this._outQ=new vn,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return ue(le,[{key:"init",value:function(){var _e=null;try{_e=new RelativeOrientationSensor({frequency:nc,referenceFrame:"screen"}),_e.addEventListener("error",this._onSensorError)}catch(Ne){this.errors.push(Ne),Ne.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):Ne.name==="ReferenceError"?this.useDeviceMotion():console.error(Ne)}_e&&(this.api="sensor",this.sensor=_e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new aa(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var _e=this.sensor.quaternion;this._sensorQ.set(_e[0],_e[1],_e[2],_e[3]);var Ne=this._outQ;return Ne.copy(et),Ne.multiply(this._sensorQ),this.config.YAW_ONLY&&(Ne.x=Ne.z=0,Ne.normalize()),this._out[0]=Ne.x,this._out[1]=Ne.y,this._out[2]=Ne.z,this._out[3]=Ne.w,this._out}},{key:"_onSensorError",value:function(_e){this.errors.push(_e.error),_e.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):_e.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(_e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),le}(),Vt="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Ge(){this.loadIcon_();var le=document.createElement("div"),gt=le.style;gt.position="fixed",gt.top=0,gt.right=0,gt.bottom=0,gt.left=0,gt.backgroundColor="gray",gt.fontFamily="sans-serif",gt.zIndex=1e6;var de=document.createElement("img");de.src=this.icon;var gt=de.style;gt.marginLeft="25%",gt.marginTop="25%",gt.width="50%",le.appendChild(de);var _e=document.createElement("div"),gt=_e.style;gt.textAlign="center",gt.fontSize="16px",gt.lineHeight="24px",gt.margin="24px 25%",gt.width="50%",_e.innerHTML="Place your phone into your Cardboard viewer.",le.appendChild(_e);var Ne=document.createElement("div"),gt=Ne.style;gt.backgroundColor="#CFD8DC",gt.position="fixed",gt.bottom=0,gt.width="100%",gt.height="48px",gt.padding="14px 24px",gt.boxSizing="border-box",gt.color="#656A6B",le.appendChild(Ne);var He=document.createElement("div");He.style.float="left",He.innerHTML="No Cardboard viewer?";var ct=document.createElement("a");ct.href="https://www.google.com/get/cardboard/get-cardboard/",ct.innerHTML="get one",ct.target="_blank";var gt=ct.style;gt.float="right",gt.fontWeight=600,gt.textTransform="uppercase",gt.borderLeft="1px solid gray",gt.paddingLeft="24px",gt.textDecoration="none",gt.color="#656A6B",Ne.appendChild(He),Ne.appendChild(ct),this.overlay=le,this.text=_e,this.hide()}Ge.prototype.show=function(le){!le&&!this.overlay.parentElement?document.body.appendChild(this.overlay):le&&(this.overlay.parentElement&&this.overlay.parentElement!=le&&this.overlay.parentElement.removeChild(this.overlay),le.appendChild(this.overlay)),this.overlay.style.display="block";var de=this.overlay.querySelector("img"),_e=de.style;Mt()?(_e.width="20%",_e.marginLeft="40%",_e.marginTop="3%"):(_e.width="50%",_e.marginLeft="25%",_e.marginTop="25%")},Ge.prototype.hide=function(){this.overlay.style.display="none"},Ge.prototype.showTemporarily=function(le,de){this.show(de),this.timer=setTimeout(this.hide.bind(this),le)},Ge.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Ge.prototype.update=function(){this.disableShowTemporarily(),!Mt()&&mi()?this.show():this.hide()},Ge.prototype.loadIcon_=function(){this.icon=pe("image/svg+xml",Vt)};var nn="CardboardV1",wn="WEBVR_CARDBOARD_VIEWER",qn="webvr-polyfill-viewer-selector";function Sn(le){try{this.selectedKey=localStorage.getItem(wn)}catch(de){console.error("Failed to load viewer profile: %s",de)}this.selectedKey||(this.selectedKey=le||nn),this.dialog=this.createDialog_(Sr.Viewers),this.root=null,this.onChangeCallbacks_=[]}Sn.prototype.show=function(le){this.root=le,le.appendChild(this.dialog);var de=this.dialog.querySelector("#"+this.selectedKey);de.checked=!0,this.dialog.style.display="block"},Sn.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Sn.prototype.getCurrentViewer=function(){return Sr.Viewers[this.selectedKey]},Sn.prototype.getSelectedKey_=function(){var le=this.dialog.querySelector("input[name=field]:checked");return le?le.id:null},Sn.prototype.onChange=function(le){this.onChangeCallbacks_.push(le)},Sn.prototype.fireOnChange_=function(le){for(var de=0;de<this.onChangeCallbacks_.length;de++)this.onChangeCallbacks_[de](le)},Sn.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Sr.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Sr.Viewers[this.selectedKey]);try{localStorage.setItem(wn,this.selectedKey)}catch(le){console.error("Failed to save viewer profile: %s",le)}this.hide()},Sn.prototype.createDialog_=function(le){var de=document.createElement("div");de.classList.add(qn),de.style.display="none";var _e=document.createElement("div"),ct=_e.style;ct.position="fixed",ct.left=0,ct.top=0,ct.width="100%",ct.height="100%",ct.background="rgba(0, 0, 0, 0.3)",_e.addEventListener("click",this.hide.bind(this));var Ne=280,He=document.createElement("div"),ct=He.style;ct.boxSizing="border-box",ct.position="fixed",ct.top="24px",ct.left="50%",ct.marginLeft=-Ne/2+"px",ct.width=Ne+"px",ct.padding="24px",ct.overflow="hidden",ct.background="#fafafa",ct.fontFamily="'Roboto', sans-serif",ct.boxShadow="0px 5px 20px #666",He.appendChild(this.createH1_("Select your viewer"));for(var gt in le)He.appendChild(this.createChoice_(gt,le[gt].label));return He.appendChild(this.createButton_("Save",this.onSave_.bind(this))),de.appendChild(_e),de.appendChild(He),de},Sn.prototype.createH1_=function(le){var de=document.createElement("h1"),_e=de.style;return _e.color="black",_e.fontSize="20px",_e.fontWeight="bold",_e.marginTop=0,_e.marginBottom="24px",de.innerHTML=le,de},Sn.prototype.createChoice_=function(le,de){var _e=document.createElement("div");_e.style.marginTop="8px",_e.style.color="black";var Ne=document.createElement("input");Ne.style.fontSize="30px",Ne.setAttribute("id",le),Ne.setAttribute("type","radio"),Ne.setAttribute("value",le),Ne.setAttribute("name","field");var He=document.createElement("label");return He.style.marginLeft="4px",He.setAttribute("for",le),He.innerHTML=de,_e.appendChild(Ne),_e.appendChild(He),_e},Sn.prototype.createButton_=function(le,de){var _e=document.createElement("button");_e.innerHTML=le;var Ne=_e.style;return Ne.float="right",Ne.textTransform="uppercase",Ne.color="#1094f7",Ne.fontSize="14px",Ne.letterSpacing=0,Ne.border=0,Ne.background="none",Ne.marginTop="16px",_e.addEventListener("click",de),_e};var Xt=typeof window<"u"?window:typeof z<"u"?z:typeof self<"u"?self:{};function nr(le){return le&&le.__esModule&&Object.prototype.hasOwnProperty.call(le,"default")?le.default:le}function yr(le,de){return de={exports:{}},le(de,de.exports),de.exports}var Tr=yr(function(le,de){(function(Ne,He){le.exports=He()})(Xt,function(){return function(_e){var Ne={};function He(ct){if(Ne[ct])return Ne[ct].exports;var gt=Ne[ct]={i:ct,l:!1,exports:{}};return _e[ct].call(gt.exports,gt,gt.exports,He),gt.l=!0,gt.exports}return He.m=_e,He.c=Ne,He.d=function(ct,gt,Yt){He.o(ct,gt)||Object.defineProperty(ct,gt,{configurable:!1,enumerable:!0,get:Yt})},He.n=function(ct){var gt=ct&&ct.__esModule?function(){return ct.default}:function(){return ct};return He.d(gt,"a",gt),gt},He.o=function(ct,gt){return Object.prototype.hasOwnProperty.call(ct,gt)},He.p="",He(He.s=0)}([function(_e,Ne,He){var ct=function(){function Pt(hn,zn){for(var Kn=0;Kn<zn.length;Kn++){var hr=zn[Kn];hr.enumerable=hr.enumerable||!1,hr.configurable=!0,"value"in hr&&(hr.writable=!0),Object.defineProperty(hn,hr.key,hr)}}return function(hn,zn,Kn){return zn&&Pt(hn.prototype,zn),Kn&&Pt(hn,Kn),hn}}();function gt(Pt,hn){if(!(Pt instanceof hn))throw new TypeError("Cannot call a class as a function")}var Yt=He(1),Qt=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,At=function(){function Pt(){gt(this,Pt),Qt?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",Yt),this.noSleepVideo.addEventListener("timeupdate",function(hn){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return ct(Pt,[{key:"enable",value:function(){Qt?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Qt?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),Pt}();_e.exports=At},function(_e,Ne,He){_e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),qi=nr(Tr),ai=1e3,Vr=[0,0,.5,1],ui=[.5,0,.5,1],Zi=window.requestAnimationFrame,ks=window.cancelAnimationFrame;function Mr(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function jr(le){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:le.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:le.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:le.canPresent},maxLayers:{writable:!1,enumerable:!0,value:le.maxLayers},hasOrientation:{enumerable:!0,get:function(){return J("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),le.hasOrientation}}})}function Xr(le){le=le||{};var de="wakelock"in le?le.wakelock:!0;this.isPolyfilled=!0,this.displayId=ai++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return J("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new jr({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,de&&mi()&&(this.wakelock_=new qi)}Xr.prototype.getFrameData=function(le){return Kr(le,this._getPose(),this)},Xr.prototype.getPose=function(){return J("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Xr.prototype.resetPose=function(){return J("VRDisplay.prototype.resetPose"),this._resetPose()},Xr.prototype.getImmediatePose=function(){return J("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Xr.prototype.requestAnimationFrame=function(le){return Zi(le)},Xr.prototype.cancelAnimationFrame=function(le){return ks(le)},Xr.prototype.wrapForFullscreen=function(le){if(he())return le;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var de=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",de.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==le)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=le,this.originalParent_=le.parentElement,this.originalParent_||document.body.appendChild(le),!this.fullscreenWrapper_.parentElement){var _e=this.fullscreenElement_.parentElement;_e.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),_e.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var Ne=this;function He(){if(!!Ne.fullscreenElement_){var ct=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];Ne.fullscreenElement_.setAttribute("style",ct.join("; ")+";")}}return He(),this.fullscreenWrapper_},Xr.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var le=this.fullscreenElement_;this.fullscreenElementCachedStyle_?le.setAttribute("style",this.fullscreenElementCachedStyle_):le.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var de=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(le),this.originalParent_===de?de.insertBefore(le,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(le),de.removeChild(this.fullscreenWrapper_),le}},Xr.prototype.requestPresent=function(le){var de=this.isPresenting,_e=this;return le instanceof Array||(J("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),le=[le]),new Promise(function(Ne,He){if(!_e.capabilities.canPresent){He(new Error("VRDisplay is not capable of presenting."));return}if(le.length==0||le.length>_e.capabilities.maxLayers){He(new Error("Invalid number of layers."));return}var ct=le[0];if(!ct.source){Ne();return}var gt=ct.leftBounds||Vr,Yt=ct.rightBounds||ui;if(de){var Qt=_e.layer_;Qt.source!==ct.source&&(Qt.source=ct.source);for(var At=0;At<4;At++)Qt.leftBounds[At]=gt[At],Qt.rightBounds[At]=Yt[At];_e.wrapForFullscreen(_e.layer_.source),_e.updatePresent_(),Ne();return}if(_e.layer_={predistorted:ct.predistorted,source:ct.source,leftBounds:gt.slice(0),rightBounds:Yt.slice(0)},_e.waitingForPresent_=!1,_e.layer_&&_e.layer_.source){var Pt=_e.wrapForFullscreen(_e.layer_.source),hn=function(){var hr=Mn();_e.isPresenting=Pt===hr,_e.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Rr){console.error("screen.orientation.lock() failed due to",Rr.message)}),_e.waitingForPresent_=!1,_e.beginPresent_(),Ne()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),_e.removeFullscreenWrapper(),_e.disableWakeLock(),_e.endPresent_(),_e.removeFullscreenListeners_()),_e.fireVRDisplayPresentChange_()},zn=function(){!_e.waitingForPresent_||(_e.removeFullscreenWrapper(),_e.removeFullscreenListeners_(),_e.disableWakeLock(),_e.waitingForPresent_=!1,_e.isPresenting=!1,He(new Error("Unable to present.")))};_e.addFullscreenListeners_(Pt,hn,zn),Qn(Pt)?(_e.enableWakeLock(),_e.waitingForPresent_=!0):(he()||Ie())&&(_e.enableWakeLock(),_e.isPresenting=!0,_e.beginPresent_(),_e.fireVRDisplayPresentChange_(),Ne())}!_e.waitingForPresent_&&!he()&&(Cn(),He(new Error("Unable to present.")))})},Xr.prototype.exitPresent=function(){var le=this.isPresenting,de=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(_e,Ne){le?(!Cn()&&he()&&(de.endPresent_(),de.fireVRDisplayPresentChange_()),Ie()&&(de.removeFullscreenWrapper(),de.removeFullscreenListeners_(),de.endPresent_(),de.fireVRDisplayPresentChange_()),_e()):Ne(new Error("Was not presenting to VRDisplay."))})},Xr.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Xr.prototype.fireVRDisplayPresentChange_=function(){var le=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(le)},Xr.prototype.fireVRDisplayConnect_=function(){var le=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(le)},Xr.prototype.addFullscreenListeners_=function(le,de,_e){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=le,this.fullscreenChangeHandler_=de,this.fullscreenErrorHandler_=_e,de&&(document.fullscreenEnabled?le.addEventListener("fullscreenchange",de,!1):document.webkitFullscreenEnabled?le.addEventListener("webkitfullscreenchange",de,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",de,!1):document.msFullscreenEnabled&&le.addEventListener("msfullscreenchange",de,!1)),_e&&(document.fullscreenEnabled?le.addEventListener("fullscreenerror",_e,!1):document.webkitFullscreenEnabled?le.addEventListener("webkitfullscreenerror",_e,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",_e,!1):document.msFullscreenEnabled&&le.addEventListener("msfullscreenerror",_e,!1))},Xr.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var le=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var de=this.fullscreenChangeHandler_;le.removeEventListener("fullscreenchange",de,!1),le.removeEventListener("webkitfullscreenchange",de,!1),document.removeEventListener("mozfullscreenchange",de,!1),le.removeEventListener("msfullscreenchange",de,!1)}if(this.fullscreenErrorHandler_){var _e=this.fullscreenErrorHandler_;le.removeEventListener("fullscreenerror",_e,!1),le.removeEventListener("webkitfullscreenerror",_e,!1),document.removeEventListener("mozfullscreenerror",_e,!1),le.removeEventListener("msfullscreenerror",_e,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Xr.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Xr.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Xr.prototype.beginPresent_=function(){},Xr.prototype.endPresent_=function(){},Xr.prototype.submitFrame=function(le){},Xr.prototype.getEyeParameters=function(le){return null};var qs={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Bi={LEFT:"left",RIGHT:"right"};function Ki(le){var de=Qi({},qs);le=Qi(de,le||{}),Xr.call(this,{wakelock:le.MOBILE_WAKE_LOCK}),this.config=le,this.displayName="Cardboard VRDisplay",this.capabilities=new jr({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new xt(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Rn(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Sr(this.dpdb_.getDeviceParams(),le.ADDITIONAL_VIEWERS),this.viewerSelector_=new Sn(le.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Ge),he()&&window.addEventListener("resize",this.onResize_.bind(this))}return Ki.prototype=Object.create(Xr.prototype),Ki.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Ki.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Ki.prototype._getFieldOfView=function(le){var de;if(le==Bi.LEFT)de=this.deviceInfo_.getFieldOfViewLeftEye();else if(le==Bi.RIGHT)de=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",le),null;return de},Ki.prototype._getEyeOffset=function(le){var de;if(le==Bi.LEFT)de=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(le==Bi.RIGHT)de=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",le),null;return de},Ki.prototype.getEyeParameters=function(le){var de=this._getEyeOffset(le),_e=this._getFieldOfView(le),Ne={offset:de,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(Ne,"fieldOfView",{enumerable:!0,get:function(){return J("VRFieldOfView","VRFrameData's projection matrices"),_e}}),Ne},Ki.prototype.onDeviceParamsUpdated_=function(le){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(le),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Ki.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Ki.prototype.beginPresent_=function(){var le=this.layer_.source.getContext("webgl");le||(le=this.layer_.source.getContext("experimental-webgl")),le||(le=this.layer_.source.getContext("webgl2")),le&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(le.canvas.width=Tn()*this.bufferScale_,le.canvas.height=xn()*this.bufferScale_,this.cardboardUI_=new Zn(le)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Zn(le)),this.distorter_=new ie(le,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(de){this.viewerSelector_.show(this.layer_.source.parentElement),de.stopPropagation(),de.preventDefault()}.bind(this),function(de){this.exitPresent(),de.stopPropagation(),de.preventDefault()}.bind(this)),this.rotateInstructions_&&(Mt()&&mi()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Ki.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Ki.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Ki.prototype.submitFrame=function(le){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var de=this.layer_.source.getContext("webgl");de||(de=this.layer_.source.getContext("experimental-webgl")),de||(de=this.layer_.source.getContext("webgl2"));var _e=de.canvas;(_e.width!=this.lastWidth||_e.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=_e.width,this.lastHeight=_e.height,this.cardboardUI_.render()}},Ki.prototype.onOrientationChange_=function(le){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Ki.prototype.onResize_=function(le){if(this.layer_){var de=this.layer_.source.getContext("webgl");de||(de=this.layer_.source.getContext("experimental-webgl")),de||(de=this.layer_.source.getContext("webgl2"));var _e=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];de.canvas.setAttribute("style",_e.join("; ")+";"),Di(de.canvas)}},Ki.prototype.onViewerChanged_=function(le){this.deviceInfo_.setViewer(le),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Ki.prototype.fireVRDisplayDeviceParamsChange_=function(){var le=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(le)},Ki.VRFrameData=Mr,Ki.VRDisplay=Xr,Ki})}),b=P(I),T="0.10.12",A={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function _(j){this.config=M(M({},A),j),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&k())&&(this.enable(),this.getVRDisplays().then(function(q){q&&q[0]&&q[0].fireVRDisplayConnect_&&q[0].fireVRDisplayConnect_()}))}_.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(k()){var j=new b({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(j)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},_.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var j=this.native.VRFrameData,q=new this.native.VRFrameData,Q=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(ue){if(ue instanceof j){Q.call(this,ue);return}Q.call(this,q),ue.pose=q.pose,C(q.leftProjectionMatrix,ue.leftProjectionMatrix),C(q.rightProjectionMatrix,ue.rightProjectionMatrix),C(q.leftViewMatrix,ue.leftViewMatrix),C(q.rightViewMatrix,ue.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=b.VRDisplay,window.VRFrameData=b.VRFrameData},_.prototype.getVRDisplays=function(){var j=this,q=this.config;return this.hasNative?this.native.getVRDisplays.call(navigator).then(function(Q){return Q.length>0?Q:j.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},_.version=T,_.VRFrameData=b.VRFrameData,_.VRDisplay=b.VRDisplay;var D=Object.freeze({default:_}),B=D&&_||D;typeof z<"u"&&z.window&&(z.document||(z.document=z.window.document),z.navigator||(z.navigator=z.window.navigator));var $=B;return $})}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],70:[function(V,re,ae){var E=/\n/,z=`
`,P=/\s/;re.exports=function(b,T){var A=re.exports.lines(b,T);return A.map(function(_){return b.substring(_.start,_.end)}).join(`
`)},re.exports.lines=function(T,A){if(A=A||{},A.width===0&&A.mode!=="nowrap")return[];T=T||"";var _=typeof A.width=="number"?A.width:Number.MAX_VALUE,D=Math.max(0,A.start||0),B=typeof A.end=="number"?A.end:T.length,$=A.mode,j=A.measure||I;return $==="pre"?C(j,T,D,B,_):M(j,T,D,B,_,$)};function L(b,T,A,_){var D=b.indexOf(T,A);return D===-1||D>_?_:D}function k(b){return P.test(b)}function C(b,T,A,_,D){for(var B=[],$=A,j=A;j<_&&j<T.length;j++){var q=T.charAt(j),Q=E.test(q);if(Q||j===_-1){var ue=Q?j:j+1,xe=b(T,$,ue,D);B.push(xe),$=j+1}}return B}function M(b,T,A,_,D,B){var $=[],j=D;for(B==="nowrap"&&(j=Number.MAX_VALUE);A<_&&A<T.length;){for(var q=L(T,z,A,_);A<q&&k(T.charAt(A));)A++;var Q=b(T,A,q,j),ue=A+(Q.end-Q.start),xe=ue+z.length;if(ue<q){for(;ue>A&&!k(T.charAt(ue));)ue--;if(ue===A)xe>A+z.length&&xe--,ue=xe;else for(xe=ue;ue>A&&k(T.charAt(ue-z.length));)ue--}if(ue>=A){var Se=b(T,A,ue,j);$.push(Se)}A=xe}return $}function I(b,T,A,_){var D=Math.min(_,A-T);return{start:T,end:T+D}}},{}],71:[function(V,re,ae){"use strict";var E=V("global/window"),z=V("is-function"),P=V("parse-headers"),L=V("xtend");re.exports=I,re.exports.default=I,I.XMLHttpRequest=E.XMLHttpRequest||A,I.XDomainRequest="withCredentials"in new I.XMLHttpRequest?I.XMLHttpRequest:E.XDomainRequest,k(["get","put","post","patch","head","delete"],function(_){I[_==="delete"?"del":_]=function(D,B,$){return B=M(D,B,$),B.method=_.toUpperCase(),b(B)}});function k(_,D){for(var B=0;B<_.length;B++)D(_[B])}function C(_){for(var D in _)if(_.hasOwnProperty(D))return!1;return!0}function M(_,D,B){var $=_;return z(D)?(B=D,typeof _=="string"&&($={uri:_})):$=L(D,{uri:_}),$.callback=B,$}function I(_,D,B){return D=M(_,D,B),b(D)}function b(_){if(typeof _.callback>"u")throw new Error("callback argument missing");var D=!1,B=function(lt,Et,Mt){D||(D=!0,_.callback(lt,Et,Mt))};function $(){ue.readyState===4&&setTimeout(Q,0)}function j(){var ht=void 0;if(ue.response?ht=ue.response:ht=ue.responseText||T(ue),Ae)try{ht=JSON.parse(ht)}catch{}return ht}function q(ht){return clearTimeout(Ue),ht instanceof Error||(ht=new Error(""+(ht||"Unknown XMLHttpRequest Error"))),ht.statusCode=0,B(ht,Qe)}function Q(){if(!Se){var ht;clearTimeout(Ue),_.useXDR&&ue.status===void 0?ht=200:ht=ue.status===1223?204:ue.status;var lt=Qe,Et=null;return ht!==0?(lt={body:j(),statusCode:ht,method:pe,headers:{},url:be,rawRequest:ue},ue.getAllResponseHeaders&&(lt.headers=P(ue.getAllResponseHeaders()))):Et=new Error("Internal XMLHttpRequest Error"),B(Et,lt,lt.body)}}var ue=_.xhr||null;ue||(_.cors||_.useXDR?ue=new I.XDomainRequest:ue=new I.XMLHttpRequest);var xe,Se,be=ue.url=_.uri||_.url,pe=ue.method=_.method||"GET",we=_.body||_.data,he=ue.headers=_.headers||{},Ie=!!_.sync,Ae=!1,Ue,Qe={body:void 0,headers:{},statusCode:0,method:pe,url:be,rawRequest:ue};if("json"in _&&_.json!==!1&&(Ae=!0,he.accept||he.Accept||(he.Accept="application/json"),pe!=="GET"&&pe!=="HEAD"&&(he["content-type"]||he["Content-Type"]||(he["Content-Type"]="application/json"),we=JSON.stringify(_.json===!0?we:_.json))),ue.onreadystatechange=$,ue.onload=Q,ue.onerror=q,ue.onprogress=function(){},ue.onabort=function(){Se=!0},ue.ontimeout=q,ue.open(pe,be,!Ie,_.username,_.password),Ie||(ue.withCredentials=!!_.withCredentials),!Ie&&_.timeout>0&&(Ue=setTimeout(function(){if(!Se){Se=!0,ue.abort("timeout");var ht=new Error("XMLHttpRequest timeout");ht.code="ETIMEDOUT",q(ht)}},_.timeout)),ue.setRequestHeader)for(xe in he)he.hasOwnProperty(xe)&&ue.setRequestHeader(xe,he[xe]);else if(_.headers&&!C(_.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in _&&(ue.responseType=_.responseType),"beforeSend"in _&&typeof _.beforeSend=="function"&&_.beforeSend(ue),ue.send(we||null),ue}function T(_){try{if(_.responseType==="document")return _.responseXML;var D=_.responseXML&&_.responseXML.documentElement.nodeName==="parsererror";if(_.responseType===""&&!D)return _.responseXML}catch{}return null}function A(){}},{"global/window":27,"is-function":33,"parse-headers":47,xtend:73}],72:[function(V,re,ae){re.exports=function(){return typeof self.DOMParser<"u"?function(z){var P=new self.DOMParser;return P.parseFromString(z,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(z){var P=new self.ActiveXObject("Microsoft.XMLDOM");return P.async="false",P.loadXML(z),P}:function(z){var P=document.createElement("div");return P.innerHTML=z,P}}()},{}],73:[function(V,re,ae){re.exports=z;var E=Object.prototype.hasOwnProperty;function z(){for(var P={},L=0;L<arguments.length;L++){var k=arguments[L];for(var C in k)E.call(k,C)&&(P[C]=k[C])}return P}},{}],74:[function(V,re,ae){re.exports={name:"aframe",version:"1.3.0",description:"A web framework for building virtual reality experiences.",homepage:"https://aframe.io/",main:"dist/aframe-master.js",scripts:{browserify:"browserify src/index.js -s 'AFRAME' -p browserify-derequire",build:"shx mkdir -p build/ && npm run browserify -- --debug -t [ envify --INSPECTOR_VERSION dev ] -o build/aframe.js",codecov:"codecov",dev:"npm run build && cross-env INSPECTOR_VERSION=dev node ./scripts/budo -t envify",dist:"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"npm run browserify -s -- --debug | exorcist dist/aframe-master.js.map > dist/aframe-master.js","dist:min":"npm run browserify -s -- --debug -p [ minifyify --map aframe-master.min.js.map --output dist/aframe-master.min.js.map ] -o dist/aframe-master.min.js",docs:"markserv --dir docs --port 9001",preghpages:"node ./scripts/preghpages.js",ghpages:"ghpages -p gh-pages/",lint:"semistandard -v | snazzy","lint:fix":"semistandard --fix",precommit:"npm run lint",prepush:"node scripts/testOnlyCheck.js",prerelease:"node scripts/release.js 1.1.0 1.2.0",start:"npm run dev","start:https":"cross-env SSL=true npm run dev",test:"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"mocha --ui tdd tests/node"},repository:"aframevr/aframe",license:"MIT",files:["dist/*","docs/**/*","src/**/*","vendor/**/*"],dependencies:{"custom-event-polyfill":"^1.0.6",debug:"ngokevin/debug#noTimestamp","deep-assign":"^2.0.0","document-register-element":"dmarcos/document-register-element#8ccc532b7f3744be954574caf3072a5fd260ca90","load-bmfont":"^1.2.3","object-assign":"^4.0.1",present:"0.0.6","promise-polyfill":"^3.1.0","super-animejs":"^3.1.0","super-three":"^0.137.0","three-bmfont-text":"dmarcos/three-bmfont-text#21d017046216e318362c48abd1a48bddfb6e0733","webvr-polyfill":"^0.10.12"},devDependencies:{browserify:"^13.1.0","browserify-css":"^0.8.4","browserify-derequire":"^0.9.4","browserify-istanbul":"^2.0.0",budo:"^9.2.0",chai:"^3.5.0","chai-shallow-deep-equal":"^1.4.0",chalk:"^1.1.3",codecov:"^1.0.1","cross-env":"^5.0.1",envify:"^3.4.1",exorcist:"^0.4.0",ghpages:"0.0.8","git-rev":"^0.2.1",glob:"^7.1.1",husky:"^0.11.7",istanbul:"^0.4.5",jsdom:"^9.11.0",karma:"1.4.1","karma-browserify":"^5.1.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^1.2.0","karma-mocha":"^1.1.1","karma-mocha-reporter":"^2.1.0","karma-sinon-chai":"1.2.4",lolex:"^1.5.1",markserv:"github:sukima/markserv#feature/fix-broken-websoketio-link",minifyify:"^7.3.3",mocha:"^3.0.2","mozilla-download":"^1.1.1","replace-in-file":"^2.5.3",semistandard:"^9.0.0",shelljs:"^0.7.7",shx:"^0.2.2",sinon:"^1.17.5","sinon-chai":"2.8.0",snazzy:"^5.0.0","too-wordy":"ngokevin/too-wordy",uglifyjs:"^2.4.10","write-good":"^0.9.1"},link:!0,browserify:{transform:["browserify-css","envify"]},semistandard:{ignore:["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},keywords:["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","web-components","webvr"],"browserify-css":{minify:!0},engines:{node:">= 4.6.0",npm:">= 2.15.9"}}},{}],75:[function(V,re,ae){var E=V("super-animejs"),z=V("../core/component").components,P=V("../core/component").registerComponent,L=V("../lib/three"),k=V("../utils"),C=new L.Color,M=new L.Color,I=k.entity.getComponentProperty,b=k.entity.setComponentProperty,T={},A="color",_="position",D="rotation",B="scale",$="components",j="object3D";re.exports.Component=P("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(he){return he===!0||he==="true"?!0:he===!1||he==="false"?!1:parseInt(he,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var he=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){he.animationIsPlaying=!1,he.el.emit("animationcomplete",he.eventDetail,!1),he.id&&he.el.emit("animationcomplete__"+he.id,he.eventDetail,!1)}}},update:function(he){var Ie=this.config,Ae=this.data;this.animationIsPlaying=!1,this.data.enabled&&(!Ae.property||(Ie.autoplay=!1,Ie.direction=Ae.dir,Ie.duration=Ae.dur,Ie.easing=Ae.easing,Ie.elasticity=Ae.elasticity,Ie.loop=Ae.loop,Ie.round=Ae.round,this.createAndStartAnimation()))},tick:function(he,Ie){!this.animationIsPlaying||(this.time+=Ie,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){!this.paused||(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var he=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=E(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!he.autoplay||he.startEvents&&he.startEvents.length)){if(he.delay){setTimeout(this.beginAnimation,he.delay);return}this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(!!this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=E(this.config),this.data.delay){setTimeout(this.beginAnimation,this.data.delay);return}this.beginAnimation()}},updateConfigForRawColor:function(){var he=this.config,Ie=this.data,Ae=this.el,Ue,Qe,ht;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){Ue=Ie.from===""?Se(Ae,Ie.property):Ie.from,ht=Ie.to,this.setColorConfig(Ue,ht),Ue=this.fromColor,ht=this.toColor,this.targetsArray.length=0,this.targetsArray.push(Ue),he.targets=this.targetsArray;for(Qe in ht)he[Qe]=ht[Qe];he.update=function(){var lt={};return function(Et){var Mt;Mt=Et.animatables[0].target,!(Mt.r===lt.r&&Mt.g===lt.g&&Mt.b===lt.b)&&be(Ae,Ie.property,Mt,Ie.type)}}()}},updateConfigForDefault:function(){var he=this.config,Ie=this.data,Ae=this.el,Ue,Qe,ht,lt;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(Ie.from===""?Ue=we(Ie)?Se(Ae,Ie.property):I(Ae,Ie.property):Ue=Ie.from,lt=Ie.to,ht=!isNaN(Ue||lt),ht?(Ue=parseFloat(Ue),lt=parseFloat(lt)):(Ue=Ue&&Ue.toString(),lt=lt&&lt.toString()),Qe=Ie.to==="true"||Ie.to==="false"||Ie.to===!0||Ie.to===!1,Qe&&(Ue=Ie.from==="true"||Ie.from===!0?1:0,lt=Ie.to==="true"||Ie.to===!0?1:0),this.targets.aframeProperty=Ue,he.targets=this.targets,he.aframeProperty=lt,he.update=function(){var Et;return function(Mt){var ln;ln=Mt.animatables[0].target.aframeProperty,ln!==Et&&(Et=ln,Qe&&(ln=ln>=1),we(Ie)?be(Ae,Ie.property,ln,Ie.type):b(Ae,Ie.property,ln))}}())},updateConfigForVector:function(){var he=this.config,Ie=this.data,Ae=this.el,Ue,Qe,ht;Qe=Ie.from!==""?k.coordinates.parse(Ie.from):I(Ae,Ie.property),ht=k.coordinates.parse(Ie.to),Ie.property===D&&(Q(Qe),Q(ht)),this.targetsArray.length=0,this.targetsArray.push(Qe),he.targets=this.targetsArray;for(Ue in ht)he[Ue]=ht[Ue];if(Ie.property===_||Ie.property===D||Ie.property===B){he.update=function(){var lt={};return function(Et){var Mt=Et.animatables[0].target;Ie.property===B&&(Mt.x=Math.max(1e-4,Mt.x),Mt.y=Math.max(1e-4,Mt.y),Mt.z=Math.max(1e-4,Mt.z)),!(Mt.x===lt.x&&Mt.y===lt.y&&Mt.z===lt.z)&&(lt.x=Mt.x,lt.y=Mt.y,lt.z=Mt.z,Ae.object3D[Ie.property].set(Mt.x,Mt.y,Mt.z))}}();return}he.update=function(){var lt={};return function(Et){var Mt=Et.animatables[0].target;Mt.x===lt.x&&Mt.y===lt.y&&Mt.z===lt.z||(lt.x=Mt.x,lt.y=Mt.y,lt.z=Mt.z,b(Ae,Ie.property,Mt))}}()},updateConfig:function(){var he;he=q(this.el,this.data.property),we(this.data)&&this.data.type===A?this.updateConfigForRawColor():he==="vec2"||he==="vec3"||he==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(he){var Ie,Ae=this.data,Ue=this.el,Qe=this;return Ae.from!==""||!Ae.property.startsWith($)||(Ie=pe(Ae.property)[1],Ue.components[Ie])?!1:(Ue.addEventListener("componentinitialized",function ht(lt){lt.detail.name===Ie&&(he(),Qe.animation=E(Qe.config),Ue.removeEventListener("componentinitialized",ht))}),!0)},stopRelatedAnimations:function(){var he,Ie;for(Ie in this.el.components)he=this.el.components[Ie],Ie!==this.attrName&&he.name==="animation"&&(!he.animationIsPlaying||he.data.property===this.data.property&&(he.animationIsPlaying=!1))},addEventListeners:function(){var he=this.data,Ie=this.el;ue(Ie,he.startEvents,this.onStartEvent),ue(Ie,he.pauseEvents,this.pauseAnimation),ue(Ie,he.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var he=this.data,Ie=this.el;xe(Ie,he.startEvents,this.onStartEvent),xe(Ie,he.pauseEvents,this.pauseAnimation),xe(Ie,he.resumeEvents,this.resumeAnimation)},setColorConfig:function(he,Ie){C.set(he),M.set(Ie),he=this.fromColor,Ie=this.toColor,he.r=C.r,he.g=C.g,he.b=C.b,Ie.r=M.r,Ie.g=M.g,Ie.b=M.b}});function q(he,Ie){var Ae,Ue,Qe,ht;return Qe=Ie.split("."),Ue=Qe[0],ht=Qe[1],Ae=he.components[Ue]||z[Ue],!Ae||ht&&!Ae.schema[ht]?null:ht?Ae.schema[ht].type:Ae.schema.type}function Q(he){he.x=L.Math.degToRad(he.x),he.y=L.Math.degToRad(he.y),he.z=L.Math.degToRad(he.z)}function ue(he,Ie,Ae){var Ue;for(Ue=0;Ue<Ie.length;Ue++)he.addEventListener(Ie[Ue],Ae)}function xe(he,Ie,Ae){var Ue;for(Ue=0;Ue<Ie.length;Ue++)he.removeEventListener(Ie[Ue],Ae)}function Se(he,Ie){var Ae,Ue,Qe;for(Ue=pe(Ie),Qe=he,Ae=0;Ae<Ue.length;Ae++)Qe=Qe[Ue[Ae]];if(Qe===void 0)throw console.log(he),new Error("[animation] property ("+Ie+") could not be found");return Qe}function be(he,Ie,Ae,Ue){var Qe,ht,lt,Et;for(Ie.startsWith("object3D.rotation")&&(Ae=L.Math.degToRad(Ae)),ht=pe(Ie),Et=he,Qe=0;Qe<ht.length-1;Qe++)Et=Et[ht[Qe]];if(lt=ht[ht.length-1],Ue===A){"r"in Et[lt]?(Et[lt].r=Ae.r,Et[lt].g=Ae.g,Et[lt].b=Ae.b):(Et[lt].x=Ae.r,Et[lt].y=Ae.g,Et[lt].z=Ae.b);return}Et[lt]=Ae}function pe(he){return he in T||(T[he]=he.split(".")),T[he]}function we(he){return he.isRawProperty||he.property.startsWith($)||he.property.startsWith(j)}},{"../core/component":136,"../lib/three":184,"../utils":212,"super-animejs":56}],76:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../lib/three");re.exports.Component=E("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var P,L=this.el;P=this.camera=new z.PerspectiveCamera,L.setObject3D("camera",P)},update:function(P){var L=this.data,k=this.camera;k.aspect=L.aspect||window.innerWidth/window.innerHeight,k.far=L.far,k.fov=L.fov,k.near=L.near,k.zoom=L.zoom,k.updateProjectionMatrix(),this.updateActiveCamera(P),this.updateSpectatorCamera(P)},updateActiveCamera:function(P){var L=this.data,k=this.el,C=this.system;P&&P.active===L.active||L.spectator||(L.active&&C.activeCameraEl!==k?C.setActiveCamera(k):!L.active&&C.activeCameraEl===k&&C.disableActiveCamera())},updateSpectatorCamera:function(P){var L=this.data,k=this.el,C=this.system;P&&P.spectator===L.spectator||(L.spectator&&C.spectatorCameraEl!==k?C.setSpectatorCamera(k):!L.spectator&&C.spectatorCameraEl===k&&C.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},{"../core/component":136,"../lib/three":184}],77:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/"),P=z.bind,L={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},k={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},C={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},M={DOWN:["selectstart"],UP:["selectend"]},I="a-mouse-cursor-hover";re.exports.Component=E("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:z.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var b=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.updateCanvasBounds=z.debounce(function(){b.canvasBounds=b.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=P(this.onCursorDown,this),this.onCursorUp=P(this.onCursorUp,this),this.onIntersection=P(this.onIntersection,this),this.onIntersectionCleared=P(this.onIntersectionCleared,this),this.onMouseMove=P(this.onMouseMove,this),this.onEnterVR=P(this.onEnterVR,this)},update:function(b){this.data.rayOrigin!==b.rayOrigin&&this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var b=this.el;b.removeState(k.HOVERING),b.removeState(k.FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(k.HOVERED),this.removeEventListeners()},addEventListeners:function(){var b,T=this.data,A=this.el,_=this;function D(){b=A.sceneEl.canvas,!(T.downEvents.length||T.upEvents.length)&&(C.DOWN.forEach(function(B){b.addEventListener(B,_.onCursorDown)}),C.UP.forEach(function(B){b.addEventListener(B,_.onCursorUp)}))}b=A.sceneEl.canvas,b?D():A.sceneEl.addEventListener("render-target-loaded",D),T.downEvents.forEach(function(B){A.addEventListener(B,_.onCursorDown)}),T.upEvents.forEach(function(B){A.addEventListener(B,_.onCursorUp)}),A.addEventListener("raycaster-intersection",this.onIntersection),A.addEventListener("raycaster-closest-entity-changed",this.onIntersection),A.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),A.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),A.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var b,T=this.data,A=this.el,_=this;b=A.sceneEl.canvas,b&&!T.downEvents.length&&!T.upEvents.length&&(C.DOWN.forEach(function(D){b.removeEventListener(D,_.onCursorDown)}),C.UP.forEach(function(D){b.removeEventListener(D,_.onCursorUp)})),T.downEvents.forEach(function(D){A.removeEventListener(D,_.onCursorDown)}),T.upEvents.forEach(function(D){A.removeEventListener(D,_.onCursorUp)}),A.removeEventListener("raycaster-intersection",this.onIntersection),A.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),b.removeEventListener("mousemove",this.onMouseMove),b.removeEventListener("touchstart",this.onMouseMove),b.removeEventListener("touchmove",this.onMouseMove),A.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),A.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var b,T=this.el;b=T.sceneEl.canvas,b.removeEventListener("mousemove",this.onMouseMove),b.removeEventListener("touchmove",this.onMouseMove),T.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(b.addEventListener("mousemove",this.onMouseMove,!1),b.addEventListener("touchmove",this.onMouseMove,!1),T.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:function(){var b=new THREE.Vector3,T=new THREE.Vector2,A=new THREE.Vector3,_={origin:A,direction:b};return function(D){var B=this.canvasBounds,$=this.el.sceneEl.camera,j,q,Q;$.parent.updateMatrixWorld(),D.type==="touchmove"||D.type==="touchstart"?q=D.touches.item(0):q=D,j=q.clientX-B.left,Q=q.clientY-B.top,T.x=j/B.width*2-1,T.y=-(Q/B.height)*2+1,$&&$.isPerspectiveCamera?(A.setFromMatrixPosition($.matrixWorld),b.set(T.x,T.y,.5).unproject($).sub(A).normalize()):$&&$.isOrthographicCamera?(A.set(T.x,T.y,($.near+$.far)/($.near-$.far)).unproject($),b.set(0,0,-1).transformDirection($.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+$.type),this.el.setAttribute("raycaster",_),D.type==="touchmove"&&D.preventDefault()}}(),onCursorDown:function(b){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&b.type==="touchstart"&&(this.onMouseMove(b),this.el.components.raycaster.checkIntersections(),b.preventDefault()),this.twoWayEmit(L.MOUSEDOWN),this.cursorDownEl=this.intersectedEl},onCursorUp:function(b){if(!!this.isCursorDown){this.isCursorDown=!1;var T=this.data;this.twoWayEmit(L.MOUSEUP),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(L.MOUSEUP,this.intersectedEventDetail)),(!T.fuse||T.rayOrigin==="mouse")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(L.CLICK),this.cursorDownEl=null,b.type==="touchend"&&b.preventDefault()}},onIntersection:function(b){var T,A=this.el,_,D,B;_=b.detail.els[0]===A?1:0,B=b.detail.intersections[_],D=b.detail.els[_],!!D&&this.intersectedEl!==D&&(this.intersectedEl&&(T=this.el.components.raycaster.getIntersection(this.intersectedEl),T&&T.distance<=B.distance)||(this.clearCurrentIntersection(!0),this.setIntersection(D,B)))},onIntersectionCleared:function(b){var T=b.detail.clearedEls;T.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var b=this.el.sceneEl.xrSession,T=this;!b||this.data.rayOrigin!=="mouse"&&(M.DOWN.forEach(function(A){b.addEventListener(A,T.onCursorDown)}),M.UP.forEach(function(A){b.addEventListener(A,T.onCursorUp)}))},setIntersection:function(b,T){var A=this.el,_=this.data,D=this;this.intersectedEl!==b&&(this.intersectedEl=b,A.addState(k.HOVERING),b.addState(k.HOVERED),this.twoWayEmit(L.MOUSEENTER),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(I),!(_.fuseTimeout===0||!_.fuse)&&(A.addState(k.FUSING),this.twoWayEmit(L.FUSING),this.fuseTimeout=setTimeout(function(){A.removeState(k.FUSING),D.twoWayEmit(L.CLICK)},_.fuseTimeout)))},clearCurrentIntersection:function(b){var T,A,_,D=this.el;!this.intersectedEl||(this.intersectedEl.removeState(k.HOVERED),D.removeState(k.HOVERING),D.removeState(k.FUSING),this.twoWayEmit(L.MOUSELEAVE),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(I),this.intersectedEl=null,clearTimeout(this.fuseTimeout),b!==!0&&(_=this.el.components.raycaster.intersections,_.length!==0&&(T=_[0].object.el===D?1:0,A=_[T],A&&this.setIntersection(A.object.el,A))))},twoWayEmit:function(b){var T=this.el,A=this.intersectedEl,_;_=this.el.components.raycaster.getIntersection(A),this.eventDetail.intersectedEl=A,this.eventDetail.intersection=_,T.emit(b,this.eventDetail),A&&(this.intersectedEventDetail.intersection=_,A.emit(b,this.intersectedEventDetail))}})},{"../core/component":136,"../utils/":212}],78:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M="https://cdn.aframe.io/controllers/google/",I=M+"vr_controller_daydream.obj",b=M+"vr_controller_daydream.mtl",T=V("../utils/").device.isWebXRAvailable,A="google-daydream",_="Daydream Controller",D=T?A:_,B={axes:{trackpad:[0,1]},buttons:["trackpad","menu","system"]},$={axes:{touchpad:[0,1]},buttons:["none","none","touchpad","menu","system"]},j=T?$:B;re.exports.Component=E("daydream-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:j,bindMethods:function(){this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},init:function(){var q=this;this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(Q){C(Q.detail.id,"down",q)},this.onButtonUp=function(Q){C(Q.detail.id,"up",q)},this.onButtonTouchStart=function(Q){C(Q.detail.id,"touchstart",q)},this.onButtonTouchEnd=function(Q){C(Q.detail.id,"touchend",q)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var q=this.el;q.addEventListener("buttonchanged",this.onButtonChanged),q.addEventListener("buttondown",this.onButtonDown),q.addEventListener("buttonup",this.onButtonUp),q.addEventListener("touchstart",this.onButtonTouchStart),q.addEventListener("touchend",this.onButtonTouchEnd),q.addEventListener("model-loaded",this.onModelLoaded),q.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var q=this.el;q.removeEventListener("buttonchanged",this.onButtonChanged),q.removeEventListener("buttondown",this.onButtonDown),q.removeEventListener("buttonup",this.onButtonUp),q.removeEventListener("touchstart",this.onButtonTouchStart),q.removeEventListener("touchend",this.onButtonTouchEnd),q.removeEventListener("model-loaded",this.onModelLoaded),q.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){L(this,D,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var q=this.el,Q=this.data;q.setAttribute("tracked-controls",{armModel:Q.armModel,hand:Q.hand,idPrefix:D,id:D,orientationOffset:Q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:I,mtl:b})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(q){var Q=q.detail.model,ue;!this.data.model||(ue=this.buttonMeshes={},ue.menu=Q.getObjectByName("AppButton_AppButton_Cylinder.004"),ue.system=Q.getObjectByName("HomeButton_HomeButton_Cylinder.005"),ue.trackpad=Q.getObjectByName("TouchPad_TouchPad_Cylinder.003"),ue.touchpad=Q.getObjectByName("TouchPad_TouchPad_Cylinder.003"),Q.position.set(0,0,-.04))},onAxisMoved:function(q){k(this,this.mapping.axes,q)},onButtonChanged:function(q){var Q=this.mapping.buttons[q.detail.id];!Q||this.el.emit(Q+"changed",q.detail.state)},updateModel:function(q,Q){!this.data.model||this.updateButtonModel(q,Q)},updateButtonModel:function(q,Q){var ue=this.buttonMeshes;if(!(!ue||!ue[q])){var xe;switch(Q){case"down":xe=this.data.buttonHighlightColor;break;case"touchstart":xe=this.data.buttonTouchedColor;break;default:xe=this.data.buttonColor}ue[q].material.color.set(xe)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],79:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M=V("../utils/").device.isWebXRAvailable,I="https://cdn.aframe.io/controllers/samsung/",b=I+"gear_vr_controller.obj",T=I+"gear_vr_controller.mtl",A="samsung-gearvr",_="Gear VR",D=M?A:_,B={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},$={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},j=M?$:B;re.exports.Component=E("gearvr-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:j,bindMethods:function(){this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},init:function(){var q=this;this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(Q){C(Q.detail.id,"down",q)},this.onButtonUp=function(Q){C(Q.detail.id,"up",q)},this.onButtonTouchStart=function(Q){C(Q.detail.id,"touchstart",q)},this.onButtonTouchEnd=function(Q){C(Q.detail.id,"touchend",q)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var q=this.el;q.addEventListener("buttonchanged",this.onButtonChanged),q.addEventListener("buttondown",this.onButtonDown),q.addEventListener("buttonup",this.onButtonUp),q.addEventListener("touchstart",this.onButtonTouchStart),q.addEventListener("touchend",this.onButtonTouchEnd),q.addEventListener("model-loaded",this.onModelLoaded),q.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var q=this.el;q.removeEventListener("buttonchanged",this.onButtonChanged),q.removeEventListener("buttondown",this.onButtonDown),q.removeEventListener("buttonup",this.onButtonUp),q.removeEventListener("touchstart",this.onButtonTouchStart),q.removeEventListener("touchend",this.onButtonTouchEnd),q.removeEventListener("model-loaded",this.onModelLoaded),q.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){L(this,D,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var q=this.el,Q=this.data;q.setAttribute("tracked-controls",{armModel:Q.armModel,hand:Q.hand,idPrefix:D,id:D,orientationOffset:Q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:b,mtl:T})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(q){var Q=q.detail.model,ue;!this.data.model||(ue=this.buttonMeshes={},ue.trigger=Q.children[2],ue.trackpad=Q.children[1],ue.touchpad=Q.children[1])},onButtonChanged:function(q){var Q=this.mapping.buttons[q.detail.id];!Q||this.el.emit(Q+"changed",q.detail.state)},onAxisMoved:function(q){k(this,this.mapping.axes,q)},updateModel:function(q,Q){!this.data.model||this.updateButtonModel(q,Q)},updateButtonModel:function(q,Q){var ue=this.buttonMeshes;if(!(!ue||!ue[q])){var xe;switch(Q){case"down":xe=this.data.buttonHighlightColor;break;case"touchstart":xe=this.data.buttonTouchedColor;break;default:xe=this.data.buttonColor}ue[q].material.color.set(xe)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],80:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M="generic",I={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]};re.exports.Component=E("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},mapping:I,bindMethods:function(){this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},init:function(){var b=this;this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(T){C(T.detail.id,"down",b)},this.onButtonUp=function(T){C(T.detail.id,"up",b)},this.onButtonTouchStart=function(T){C(T.detail.id,"touchstart",b)},this.onButtonTouchEnd=function(T){C(T.detail.id,"touchend",b)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods(),this.el.addEventListener("controllerconnected",function(T){T.detail.name!==b.name&&(b.wasControllerConnected=!0,b.removeEventListeners(),b.removeControllersUpdateListener())})},addEventListeners:function(){var b=this.el;b.addEventListener("buttonchanged",this.onButtonChanged),b.addEventListener("buttondown",this.onButtonDown),b.addEventListener("buttonup",this.onButtonUp),b.addEventListener("touchstart",this.onButtonTouchStart),b.addEventListener("touchend",this.onButtonTouchEnd),b.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var b=this.el;b.removeEventListener("buttonchanged",this.onButtonChanged),b.removeEventListener("buttondown",this.onButtonDown),b.removeEventListener("buttonup",this.onButtonUp),b.removeEventListener("touchstart",this.onButtonTouchStart),b.removeEventListener("touchend",this.onButtonTouchEnd),b.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var b=this.data,T=b.hand?b.hand:void 0;L(this,M,{hand:T,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var b=this.el,T=this.data;if(this.el.components["tracked-controls"]){this.removeEventListeners();return}b.setAttribute("tracked-controls",{hand:T.hand,idPrefix:M,orientationOffset:T.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(b){var T=this.mapping.buttons[b.detail.id];!T||this.el.emit(T+"changed",b.detail.state)},onAxisMoved:function(b){k(this,this.mapping.axes,b)},initDefaultModel:function(){var b=this.modelEl=document.createElement("a-entity");b.setAttribute("geometry",{primitive:"sphere",radius:.03}),b.setAttribute("material",{color:this.data.color}),this.el.appendChild(b)}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],81:[function(V,re,ae){var E=V("../core/geometry").geometries,z=V("../core/geometry").geometryNames,P=V("../core/component").registerComponent,L=V("../lib/three"),k=new L.BufferGeometry;re.exports.Component=P("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:z,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(C){var M=this.data,I=this.el,b,T=this.system;this.geometry&&(T.unuseGeometry(C),this.geometry=null),this.geometry=T.getOrCreateGeometry(M),b=I.getObject3D("mesh"),b?b.geometry=this.geometry:(b=new L.Mesh,b.geometry=this.geometry,this.el.getAttribute("material")||(b.material=new L.MeshStandardMaterial({color:Math.random()*16777215,metalness:0,roughness:.5})),I.setObject3D("mesh",b))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=k,this.geometry=null},updateSchema:function(C){var M=this.oldData&&this.oldData.primitive,I=C.primitive,b=E[I]&&E[I].schema;if(!b)throw new Error("Unknown geometry schema `"+I+"`");M&&M===I||this.extendSchema(b)}})},{"../core/component":136,"../core/geometry":137,"../lib/three":184}],82:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../lib/three"),P=V("../utils/"),L=P.debug("components:gltf-model:warn");re.exports.Component=E("gltf-model",{schema:{type:"model"},init:function(){var k=this,C=this.system.getDRACOLoader(),M=this.system.getMeshoptDecoder();this.model=null,this.loader=new z.GLTFLoader,C&&this.loader.setDRACOLoader(C),M?this.ready=M.then(function(I){k.loader.setMeshoptDecoder(I)}):this.ready=Promise.resolve()},update:function(){var k=this,C=this.el,M=this.data;!M||(this.remove(),this.ready.then(function(){k.loader.load(M,function(b){k.model=b.scene||b.scenes[0],k.model.animations=b.animations,C.setObject3D("mesh",k.model),C.emit("model-loaded",{format:"gltf",model:k.model})},void 0,function(b){var T=b&&b.message?b.message:"Failed to load glTF model";L(T),C.emit("model-error",{format:"gltf",src:M})})}))},remove:function(){!this.model||this.el.removeObject3D("mesh")}})},{"../core/component":136,"../lib/three":184,"../utils/":212}],83:[function(V,re,ae){var E=V("../core/component").registerComponent,z={toonLeft:"https://cdn.aframe.io/controllers/hands/leftHand.glb",toonRight:"https://cdn.aframe.io/controllers/hands/rightHand.glb",lowPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandLow.glb",lowPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandLow.glb",highPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandHigh.glb",highPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandHigh.glb"},P={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},L={};L[P.fist]="grip",L[P.thumbUp]="pistol",L[P.point]="pointing",re.exports.Component=E("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},init:function(){var M=this,I=this.el;this.gesture=P.open,this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){M.handleButton("grip","down")},this.onGripUp=function(){M.handleButton("grip","up")},this.onTrackpadDown=function(){M.handleButton("trackpad","down")},this.onTrackpadUp=function(){M.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){M.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){M.handleButton("trackpad","touchend")},this.onTriggerDown=function(){M.handleButton("trigger","down")},this.onTriggerUp=function(){M.handleButton("trigger","up")},this.onTriggerTouchStart=function(){M.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){M.handleButton("trigger","touchend")},this.onGripTouchStart=function(){M.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){M.handleButton("grip","touchend")},this.onThumbstickDown=function(){M.handleButton("thumbstick","down")},this.onThumbstickUp=function(){M.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){M.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){M.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){M.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){M.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){M.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){M.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),I.addEventListener("controllerconnected",this.onControllerConnected),I.addEventListener("controllerdisconnected",this.onControllerDisconnected),I.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(M,I){var b=this.el.getObject3D("mesh");!b||!b.mixer||b.mixer.update(I/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var M=this.el;M.addEventListener("gripdown",this.onGripDown),M.addEventListener("gripup",this.onGripUp),M.addEventListener("trackpaddown",this.onTrackpadDown),M.addEventListener("trackpadup",this.onTrackpadUp),M.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),M.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),M.addEventListener("triggerdown",this.onTriggerDown),M.addEventListener("triggerup",this.onTriggerUp),M.addEventListener("triggertouchstart",this.onTriggerTouchStart),M.addEventListener("triggertouchend",this.onTriggerTouchEnd),M.addEventListener("griptouchstart",this.onGripTouchStart),M.addEventListener("griptouchend",this.onGripTouchEnd),M.addEventListener("thumbstickdown",this.onThumbstickDown),M.addEventListener("thumbstickup",this.onThumbstickUp),M.addEventListener("abuttontouchstart",this.onAorXTouchStart),M.addEventListener("abuttontouchend",this.onAorXTouchEnd),M.addEventListener("bbuttontouchstart",this.onBorYTouchStart),M.addEventListener("bbuttontouchend",this.onBorYTouchEnd),M.addEventListener("xbuttontouchstart",this.onAorXTouchStart),M.addEventListener("xbuttontouchend",this.onAorXTouchEnd),M.addEventListener("ybuttontouchstart",this.onBorYTouchStart),M.addEventListener("ybuttontouchend",this.onBorYTouchEnd),M.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),M.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var M=this.el;M.removeEventListener("gripdown",this.onGripDown),M.removeEventListener("gripup",this.onGripUp),M.removeEventListener("trackpaddown",this.onTrackpadDown),M.removeEventListener("trackpadup",this.onTrackpadUp),M.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),M.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),M.removeEventListener("triggerdown",this.onTriggerDown),M.removeEventListener("triggerup",this.onTriggerUp),M.removeEventListener("triggertouchstart",this.onTriggerTouchStart),M.removeEventListener("triggertouchend",this.onTriggerTouchEnd),M.removeEventListener("griptouchstart",this.onGripTouchStart),M.removeEventListener("griptouchend",this.onGripTouchEnd),M.removeEventListener("thumbstickdown",this.onThumbstickDown),M.removeEventListener("thumbstickup",this.onThumbstickUp),M.removeEventListener("abuttontouchstart",this.onAorXTouchStart),M.removeEventListener("abuttontouchend",this.onAorXTouchEnd),M.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),M.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),M.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),M.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),M.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),M.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),M.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),M.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(M){var I,b=this.el,T=this.data.hand,A=this.data.handModelStyle,_=this.data.color,D=this;if(I={hand:T,model:!1},T!==M){var B=z[A+T.charAt(0).toUpperCase()+T.slice(1)];this.loader.load(B,function($){var j=$.scene.children[0],q=T==="left"?Math.PI/2:-Math.PI/2;j.mixer=new THREE.AnimationMixer(j),D.clips=$.animations,b.setObject3D("mesh",j);var Q=j.children[1].material;Q.color=new THREE.Color(_),j.position.set(0,0,0),j.rotation.set(0,0,q),b.setAttribute("magicleap-controls",I),b.setAttribute("vive-controls",I),b.setAttribute("oculus-touch-controls",I),b.setAttribute("windows-motion-controls",I),b.setAttribute("hp-mixed-reality-controls",I)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(M,I){var b,T=I==="down",A=I==="touchstart";if(I.indexOf("touch")===0){if(A===this.touchedButtons[M])return;this.touchedButtons[M]=A}else{if(T===this.pressedButtons[M])return;this.pressedButtons[M]=T}b=this.gesture,this.gesture=this.determineGesture(),this.gesture!==b&&(this.animateGesture(this.gesture,b),this.emitGestureEvents(this.gesture,b))},determineGesture:function(){var M,I=this.pressedButtons.grip,b=this.pressedButtons.surface||this.touchedButtons.surface,T=this.pressedButtons.trackpad||this.touchedButtons.trackpad,A=this.pressedButtons.trigger||this.touchedButtons.trigger,_=this.touchedButtons.AorX||this.touchedButtons.BorY,D=C(this.el.components["tracked-controls"]);return D?I||A?M=P.fist:T&&(M=P.point):I?b||_||T?M=A?P.fist:P.point:M=A?P.thumbUp:P.pointThumb:A&&(M=P.hold),M},getClip:function(M){var I,b;for(b=0;b<this.clips.length;b++)if(I=this.clips[b],I.name===M)return I},animateGesture:function(M,I){if(M){this.playAnimation(M||P.open,I,!1);return}this.playAnimation(I,I,!0)},emitGestureEvents:function(M,I){var b=this.el,T;I!==M&&(T=k(I,!1),T&&b.emit(T),T=k(M,!0),T&&b.emit(T))},playAnimation:function(M,I,b){var T,A,_=this.el.getObject3D("mesh"),D;if(!!_){if(_.mixer.stopAllAction(),T=this.getClip(M),D=_.mixer.clipAction(T),D.clampWhenFinished=!0,D.loop=THREE.LoopRepeat,D.repetitions=0,D.timeScale=b?-1:1,D.time=b?T.duration:0,D.weight=1,!I||M===I){_.mixer.stopAllAction(),D.play();return}T=this.getClip(I),A=_.mixer.clipAction(T),A.weight=.15,A.play(),D.play(),A.crossFadeTo(D,.15,!0)}}});function k(M,I){var b;if(!!M){if(b=L[M],b==="grip")return b+(I?"close":"open");if(b==="point")return b+(I?"up":"down");if(b==="pointing"||b==="pistol")return b+(I?"start":"end")}}function C(M){var I=M&&M.controller,b=I&&(I.id&&I.id.indexOf("OpenVR ")===0||I.profiles&&I.profiles[0]&&I.profiles[0]==="htc-vive");return b}},{"../core/component":136}],84:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k="https://cdn.aframe.io/controllers/oculus-hands/v3/left.glb",C="https://cdn.aframe.io/controllers/oculus-hands/v3/right.glb",M={left:"b_l_",right:"b_r_"},I=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],b={wrist:"wrist","thumb-metacarpal":"thumb1","thumb-phalanx-proximal":"thumb2","thumb-phalanx-distal":"thumb3","thumb-tip":"thumb_null","index-finger-metacarpal":"index0","index-finger-phalanx-proximal":"index1","index-finger-phalanx-intermediate":"index2","index-finger-phalanx-distal":"index3","index-finger-tip":"index_null","middle-finger-metacarpal":"middle0","middle-finger-phalanx-proximal":"middle1","middle-finger-phalanx-intermediate":"middle2","middle-finger-phalanx-distal":"middle3","middle-finger-tip":"middle_null","ring-finger-metacarpal":"ring0","ring-finger-phalanx-proximal":"ring1","ring-finger-phalanx-intermediate":"ring2","ring-finger-phalanx-distal":"ring3","ring-finger-tip":"ring_null","pinky-finger-metacarpal":"pinky0","pinky-finger-phalanx-proximal":"pinky1","pinky-finger-phalanx-intermediate":"pinky2","pinky-finger-phalanx-distal":"pinky3","pinky-finger-tip":"pinky_null"},T=.015,A=.03,_=.5;re.exports.Component=E("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"}},bindMethods:function(){this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var D=0;D<this.jointEls.length;++D)this.jointEls[D].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var D=0;D<this.jointEls.length;++D)this.jointEls[D].object3D.visible=!1},init:function(){var D=this.el.sceneEl,B=D.getAttribute("webxr").optionalFeatures;B.push("hand-tracking"),D.setAttribute("webxr",{optionalFeatures:B}),this.onModelLoaded=this.onModelLoaded.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3},this.indexTipPosition=new THREE.Vector3,this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace)},updateReferenceSpace:function(){var D=this,B=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,!!B){var $=D.el.sceneEl.systems.webxr.sessionReferenceSpaceType;B.requestReferenceSpace($).then(function(j){D.referenceSpace=j.getOffsetReferenceSpace(new XRRigidTransform({x:0,y:1.5,z:0}))}).catch(function(j){throw D.el.sceneEl.systems.webxr.warnIfFeatureNotRequested($,"tracked-controls-webxr uses reference space "+$),j})}},checkIfControllerPresent:function(){var D=this.data,B=D.hand?D.hand:void 0;L(this,"",{hand:B,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var D=this.el.sceneEl,B=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,$=D.frame,j=this.el.components["tracked-controls-webxr"];!B||!$||!j||B.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),$.getJointPose&&this.updateHandModel(),this.detectGesture())},updateHandModel:function(){this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(D){for(var B=this.bones,$=0;$<B.length;$++)if(B[$].name===D)return B[$];return null},updateHandMeshModel:function(){var D=this.el.sceneEl.frame,B=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,$=this.referenceSpace;if(!(!B||!this.mesh||!$)){this.mesh.visible=!1;for(var j of B.hand.values()){var q,Q,ue;Q=D.getJointPose(j,$),b[j.jointName]&&(q=this.getBone(M[this.data.hand]+b[j.jointName]),q!=null&&Q&&(ue=Q.transform,this.mesh.visible=!0,q.position.copy(ue.position).multiplyScalar(100),q.quaternion.set(ue.orientation.x,ue.orientation.y,ue.orientation.z,ue.orientation.w)))}}},updateHandDotsModel:function(){var D=this.el.sceneEl.frame,B=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,$=this.el.components["tracked-controls-webxr"],j=$.system.referenceSpace,q,Q,ue,xe=0;for(var Se of B.hand.values())q=this.jointEls[xe++],Q=q.object3D,ue=D.getJointPose(Se,j),q.object3D.visible=!!ue,ue&&(Q.matrix.elements=ue.transform.matrix,Q.matrix.decompose(Q.position,Q.rotation,Q.scale),q.setAttribute("scale",{x:ue.radius,y:ue.radius,z:ue.radius}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var D=new THREE.Vector3;return function(){var B=this.el.sceneEl.frame,$=this.indexTipPosition,j=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,q=this.el.components["tracked-controls-webxr"],Q=this.referenceSpace||q.system.referenceSpace,ue=j.hand.get("index-finger-tip"),xe=j.hand.get("thumb-tip");if(!(!ue||!xe)){var Se=B.getJointPose(ue,Q),be=B.getJointPose(xe,Q);if(!(!Se||!be)){D.copy(be.transform.position),$.copy(Se.transform.position);var pe=$.distanceTo(D);pe<T&&this.isPinched===!1&&(this.isPinched=!0,this.pinchEventDetail.position.copy($).lerp(D,_),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchstarted",this.pinchEventDetail)),pe>A&&this.isPinched===!0&&(this.isPinched=!1,this.pinchEventDetail.position.copy($).lerp(D,_),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchended",this.pinchEventDetail)),this.isPinched&&(this.pinchEventDetail.position.copy($).lerp(D,_),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchmoved",this.pinchEventDetail)),$.y+=1.5}}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var D=this.el,B=this.data;D.setAttribute("tracked-controls",{hand:B.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var D;this.checkIfControllerPresent(),D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,!!this.el.getObject3D("mesh")&&(!D||!D.hand||!D.hand[0])&&(this.el.getObject3D("mesh").visible=!1)},initDefaultModel:function(){this.el.getObject3D("mesh")||(this.data.modelStyle==="dots"&&this.initDotsModel(),this.data.modelStyle==="mesh"&&this.initMeshHandModel())},initDotsModel:function(){if(this.jointEls.length===0)for(var D=0;D<I.length;++D){var B=this.jointEl=document.createElement("a-entity");B.setAttribute("geometry",{primitive:"sphere",radius:1}),B.setAttribute("material",{color:this.data.modelColor}),B.object3D.visible=!1,this.el.appendChild(B),this.jointEls.push(B)}},initMeshHandModel:function(){var D=this.data.hand==="left"?k:C;this.el.setAttribute("gltf-model",D)},onModelLoaded:function(){var D=this.mesh=this.el.getObject3D("mesh").children[0],B=this.skinnedMesh=D.children[30];!this.skinnedMesh||(this.bones=B.skeleton.bones,this.el.removeObject3D("mesh"),D.position.set(0,1.5,0),D.rotation.set(0,0,0),B.frustumCulled=!1,B.material=new THREE.MeshStandardMaterial({skinning:!0,color:this.data.modelColor}),this.el.setObject3D("mesh",D))}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],85:[function(V,re,ae){var E=V("../core/component").registerComponent;re.exports.Component=E("hide-on-enter-ar",{init:function(){var z=this;this.el.sceneEl.addEventListener("enter-vr",function(){z.el.sceneEl.is("ar-mode")&&(z.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){z.el.object3D.visible=!0})}})},{"../core/component":136}],86:[function(V,re,ae){var E=V("../utils/bind"),z=V("../core/component").registerComponent,P=V("../lib/three"),L=V("../utils/tracked-controls"),k=L.checkControllerPresentAndSetup,C=L.emitIfAxesChanged,M=L.onButtonEvent,I="hp-mixed-reality",b="https://cdn.aframe.io/controllers/hp/mixed-reality/",T={x:0,y:0,z:.06},A={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},_={left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}};re.exports.Component=z("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:_,init:function(){var D=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=E(this.onButtonChanged,this),this.onButtonDown=function(B){M(B.detail.id,"down",D,D.data.hand)},this.onButtonUp=function(B){M(B.detail.id,"up",D,D.data.hand)},this.onButtonTouchEnd=function(B){M(B.detail.id,"touchend",D,D.data.hand)},this.onButtonTouchStart=function(B){M(B.detail.id,"touchstart",D,D.data.hand)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var D=this.data;this.controllerIndex=D.hand==="right"?0:D.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=E(this.onModelLoaded,this),this.onControllersUpdate=E(this.onControllersUpdate,this),this.checkIfControllerPresent=E(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=E(this.removeControllersUpdateListener,this),this.onAxisMoved=E(this.onAxisMoved,this)},addEventListeners:function(){var D=this.el;D.addEventListener("buttonchanged",this.onButtonChanged),D.addEventListener("buttondown",this.onButtonDown),D.addEventListener("buttonup",this.onButtonUp),D.addEventListener("touchstart",this.onButtonTouchStart),D.addEventListener("touchend",this.onButtonTouchEnd),D.addEventListener("axismove",this.onAxisMoved),D.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var D=this.el;D.removeEventListener("buttonchanged",this.onButtonChanged),D.removeEventListener("buttondown",this.onButtonDown),D.removeEventListener("buttonup",this.onButtonUp),D.removeEventListener("touchstart",this.onButtonTouchStart),D.removeEventListener("touchend",this.onButtonTouchEnd),D.removeEventListener("axismove",this.onAxisMoved),D.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var D=this.data;k(this,I,{index:this.controllerIndex,hand:D.hand})},injectTrackedControls:function(){var D=this.el,B=this.data;D.setAttribute("tracked-controls",{idPrefix:I,hand:B.hand,controller:this.controllerIndex,orientationOffset:B.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",b+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(D){var B=this.mapping[this.data.hand].buttons[D.detail.id],$;!B||(B==="trigger"&&($=D.detail.state.value,console.log("analog value of trigger press: "+$)),this.el.emit(B+"changed",D.detail.state))},onModelLoaded:function(D){var B=D.detail.model;!this.data.model||(B.position.copy(T),B.rotation.copy(A),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new P.Vector3(0,0,0)}))},onAxisMoved:function(D){C(this,this.mapping.axes,D)}})},{"../core/component":136,"../lib/three":184,"../utils/bind":206,"../utils/tracked-controls":221}],87:[function(V,re,ae){V("./animation"),V("./camera"),V("./cursor"),V("./daydream-controls"),V("./gearvr-controls"),V("./geometry"),V("./generic-tracked-controller-controls"),V("./gltf-model"),V("./hand-tracking-controls"),V("./hand-controls"),V("./hide-on-enter-ar"),V("./hp-mixed-reality-controls"),V("./layer"),V("./laser-controls"),V("./light"),V("./line"),V("./link"),V("./look-controls"),V("./magicleap-controls"),V("./material"),V("./obj-model"),V("./oculus-go-controls"),V("./oculus-touch-controls"),V("./position"),V("./raycaster"),V("./rotation"),V("./scale"),V("./shadow"),V("./sound"),V("./text"),V("./tracked-controls"),V("./tracked-controls-webvr"),V("./tracked-controls-webxr"),V("./visible"),V("./valve-index-controls"),V("./vive-controls"),V("./vive-focus-controls"),V("./wasd-controls"),V("./windows-motion-controls"),V("./scene/ar-hit-test"),V("./scene/background"),V("./scene/debug"),V("./scene/device-orientation-permission-ui"),V("./scene/embedded"),V("./scene/inspector"),V("./scene/fog"),V("./scene/keyboard-shortcuts"),V("./scene/pool"),V("./scene/reflection"),V("./scene/screenshot"),V("./scene/stats"),V("./scene/vr-mode-ui")},{"./animation":75,"./camera":76,"./cursor":77,"./daydream-controls":78,"./gearvr-controls":79,"./generic-tracked-controller-controls":80,"./geometry":81,"./gltf-model":82,"./hand-controls":83,"./hand-tracking-controls":84,"./hide-on-enter-ar":85,"./hp-mixed-reality-controls":86,"./laser-controls":88,"./layer":89,"./light":90,"./line":91,"./link":92,"./look-controls":93,"./magicleap-controls":94,"./material":95,"./obj-model":96,"./oculus-go-controls":97,"./oculus-touch-controls":98,"./position":99,"./raycaster":100,"./rotation":101,"./scale":102,"./scene/ar-hit-test":103,"./scene/background":104,"./scene/debug":105,"./scene/device-orientation-permission-ui":106,"./scene/embedded":107,"./scene/fog":108,"./scene/inspector":109,"./scene/keyboard-shortcuts":110,"./scene/pool":111,"./scene/reflection":112,"./scene/screenshot":113,"./scene/stats":114,"./scene/vr-mode-ui":115,"./shadow":116,"./sound":117,"./text":118,"./tracked-controls":121,"./tracked-controls-webvr":119,"./tracked-controls-webxr":120,"./valve-index-controls":122,"./visible":123,"./vive-controls":124,"./vive-focus-controls":125,"./wasd-controls":126,"./windows-motion-controls":127}],88:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/");E("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var P=this.config,L=this.data,k=this.el,C=this,M={hand:L.hand,model:L.model};k.setAttribute("daydream-controls",M),k.setAttribute("gearvr-controls",M),k.setAttribute("hp-mixed-reality-controls",M),k.setAttribute("magicleap-controls",M),k.setAttribute("oculus-go-controls",M),k.setAttribute("oculus-touch-controls",M),k.setAttribute("valve-index-controls",M),k.setAttribute("vive-controls",M),k.setAttribute("vive-focus-controls",M),k.setAttribute("windows-motion-controls",M),k.setAttribute("generic-tracked-controller-controls",M),k.addEventListener("controllerconnected",I),k.addEventListener("controllerdisconnected",b),k.addEventListener("controllermodelready",function(T){I(T),C.modelReady=!0});function I(T){var A=P[T.detail.name];if(!!A){var _=z.extend({showLine:!0},A.raycaster||{});T.detail.rayOrigin&&(_.origin=T.detail.rayOrigin.origin,_.direction=T.detail.rayOrigin.direction,_.showLine=!0),T.detail.rayOrigin||!C.modelReady?k.setAttribute("raycaster",_):k.setAttribute("raycaster","showLine",!0),k.setAttribute("cursor",z.extend({fuse:!1},A.cursor))}}function b(){k.setAttribute("raycaster","showLine",!1)}},config:{"daydream-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"gearvr-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:.001,z:0}}},"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},{"../core/component":136,"../utils/":212}],89:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/"),P=z.debug("components:layer:warn");re.exports.Component=E("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var k=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=k.createFramebuffer();var C=this.el.sceneEl.getAttribute("webxr").requiredFeatures;C.push("layers"),this.el.sceneEl.getAttribute("webxr","requiredFeatures",C),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(k){this.data.src!==k.src&&this.updateSrc()},updateSrc:function(){var k=this.data.type;if(this.texture=void 0,k==="quad"){this.loadQuadImage();return}if(k==="monocubemap"||k==="stereocubemap"){this.loadCubeMapImages();return}},loadCubeMapImages:function(){var k,C=this.xrGLFactory,M=this.el.sceneEl.frame,I=this.data.src,b=this.data.type;this.visibilityChanged=!1,this.layer&&(b!=="monocubemap"&&b!=="stereocubemap"||(I.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,b==="monocubemap"?(k=C.getSubImage(this.layer,M),this.loadCubeMapImage(k.colorTexture,I,0)):(k=C.getSubImage(this.layer,M,"left"),this.loadCubeMapImage(k.colorTexture,I,0),k=C.getSubImage(this.layer,M,"right"),this.loadCubeMapImage(k.colorTexture,I,6))))},loadQuadImage:function(){var k=this.data.src,C=this;this.el.sceneEl.systems.material.loadTexture(k,{src:k},function(I){C.el.sceneEl.renderer.initTexture(I),C.texture=I,k.tagName==="VIDEO"&&setTimeout(function(){C.textureIsVideo=!0},1e3),C.layer&&(C.layer.height=C.data.height/2||C.texture.image.height/1e3,C.layer.width=C.data.width/2||C.texture.image.width/1e3,C.needsRedraw=!0),C.updateQuadPanel()})},preGenerateCubeMapTextures:function(k,C){this.data.type==="monocubemap"?this.generateCubeMapTextures(k,0,C):(this.generateCubeMapTextures(k,0,C),this.generateCubeMapTextures(k,6,C))},generateCubeMapTextures:function(k,C,M){for(var I=this.data,b=this.cubeFaceSize,T=Math.min(k.width,k.height),A=[],_,D,B=0;B<6;B++){var $=document.createElement("CANVAS");$.width=$.height=b;var j=$.getContext("2d");I.rotateCubemap&&(B===2||B===3)&&(j.save(),j.translate(b,b),j.rotate(Math.PI)),j.drawImage(k,(B+C)*T,0,T,T,0,0,b,b),j.restore(),M&&M(),A.push($)}return I.rotateCubemap&&(_=A[0],D=A[1],A[0]=D,A[1]=_,_=A[4],D=A[5],A[4]=D,A[5]=_),M&&M(),A},loadCubeMapImage:function(k,C,M){var I=this.el.sceneEl.renderer.getContext(),b;I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,!1),I.bindTexture(I.TEXTURE_CUBE_MAP,k),!C.complete||this.loadingScreen?b=this.loadingScreenImages:b=this.generateCubeMapTextures(C,M);var T=0;b.forEach(function(A,_){I.texSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,0,0,I.RGBA,I.UNSIGNED_BYTE,A),T=I.getError()}),T!==0&&console.log("renderingError, WebGL Error Code: "+T),I.bindTexture(I.TEXTURE_CUBE_MAP,null)},tick:function(){!this.el.sceneEl.xrSession||(!this.layer&&this.el.sceneEl.is("vr-mode")&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),!(!this.needsRedraw&&!this.layer.needsRedraw&&!this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var k=this,C=this.data.type;if(this.el.sceneEl.xrSession.onvisibilitychange=function(M){k.visibilityChanged=M.session.visibilityState!=="hidden"},C==="quad"){this.initQuadLayer();return}if(C==="monocubemap"||C==="stereocubemap"){this.initCubeMapLayer();return}},initQuadLayer:function(){var k=this.el.sceneEl,C=k.renderer.getContext(),M=this.xrGLFactory=new XRWebGLBinding(k.xrSession,C);!this.texture||(this.layer=M.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),k.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var k=this.data.src,C=this.el.sceneEl,M=C.renderer.getContext(),I=M.getParameter(M.MAX_CUBE_MAP_TEXTURE_SIZE),b=this.cubeFaceSize=Math.min(I,Math.min(k.width,k.height)),T=this.xrGLFactory=new XRWebGLBinding(C.xrSession,M);this.layer=T.createCubeLayer({space:this.referenceSpace,viewPixelWidth:b,viewPixelHeight:b,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),C.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var k=this.cubeFaceSize,C=this.loadingScreenImages=[],M=0;M<6;M++){var I=document.createElement("CANVAS");I.width=I.height=k;var b=I.getContext("2d");I.width=I.height=k,b.fillStyle="black",b.fillRect(0,0,k,k),M!==2&&M!==3&&(b.translate(k,0),b.scale(-1,1),b.fillStyle="white",b.font="30px Arial",b.fillText("Loading",k/2,k/2)),C.push(I)}},destroyLayer:function(){!this.layer||(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(k){this.layerEnabled=k,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var k=this.quadPanelEl;this.quadPanelEl||(k=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(k)),k.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),k.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var k=this.el.sceneEl,C=this.el.sceneEl.renderer.getContext(),M=this.xrGLFactory.getSubImage(this.layer,k.frame),I=k.renderer.properties.get(this.texture).__webglTexture,b=C.getParameter(C.FRAMEBUFFER_BINDING);C.viewport(M.viewport.x,M.viewport.y,M.viewport.width,M.viewport.height),C.bindFramebuffer(C.FRAMEBUFFER,this.frameBuffer),C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,M.colorTexture,0),L(C,I,M,this.data.src),C.bindFramebuffer(C.FRAMEBUFFER,b)},updateTransform:function(){var k=this.el,C=this.position,M=this.quaternion;k.object3D.updateMatrixWorld(),C.setFromMatrixPosition(k.object3D.matrixWorld),M.setFromRotationMatrix(k.object3D.matrixWorld),this.layerEnabled||C.set(0,0,1e8),this.layer.transform=new XRRigidTransform(C,M)},onEnterVR:function(){var k=this.el.sceneEl,C=k.xrSession;if(!k.hasWebXR||!XRWebGLBinding||!C){P("The layer component requires WebXR and the layers API enabled");return}C.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.needsRedraw=!0,this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(k){this.referenceSpace=k}});function L(k,C,M,I){var b=k.createFramebuffer();let T=M.viewport.x,A=M.viewport.y,_=M.viewport.x+M.viewport.width,D=M.viewport.y+M.viewport.height;I.tagName==="VIDEO"&&(k.bindTexture(k.TEXTURE_2D,C),k.texSubImage2D(k.TEXTURE_2D,0,0,0,I.width,I.height,k.RGB,k.UNSIGNED_BYTE,I)),k.bindFramebuffer(k.READ_FRAMEBUFFER,b),k.framebufferTexture2D(k.READ_FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,C,0),k.readBuffer(k.COLOR_ATTACHMENT0),k.blitFramebuffer(0,0,I.width,I.height,T,A,_,D,k.COLOR_BUFFER_BIT,k.NEAREST),k.bindFramebuffer(k.READ_FRAMEBUFFER,null),k.deleteFramebuffer(b)}},{"../core/component":136,"../utils/":212}],90:[function(V,re,ae){var E=V("../utils/bind"),z=V("../utils"),P=z.diff,L=V("../utils/debug"),k=V("../core/component").registerComponent,C=V("../lib/three"),M=C.Math.degToRad,I=L("components:light:warn"),b=new C.CubeTextureLoader,T={};re.exports.Component=k("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var A=this.el;this.light=null,this.defaultTarget=null,this.rendererSystem=this.el.sceneEl.systems.renderer,this.system.registerLight(A)},update:function(A){var _=this.data,D=P(_,A),B=this.light,$=this.rendererSystem,j=this;if(B&&!("type"in D)){var q=!1;Object.keys(D).forEach(function(Q){var ue=_[Q];switch(Q){case"color":{B.color.set(ue),$.applyColorCorrection(B.color);break}case"groundColor":{B.groundColor.set(ue),$.applyColorCorrection(B.groundColor);break}case"angle":{B.angle=M(ue);break}case"target":{ue===null?(_.type==="spot"||_.type==="directional")&&(B.target=j.defaultTarget):ue.hasLoaded?j.onSetTarget(ue,B):ue.addEventListener("loaded",E(j.onSetTarget,j,ue,B));break}case"envMap":this.updateProbeMap(_,B);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":q||(j.updateShadow(),q=!0);break;default:B[Q]=ue}});return}this.setLight(this.data),this.updateShadow()},setLight:function(A){var _=this.el,D=this.getLight(A);D&&(this.light&&_.removeObject3D("light"),this.light=D,this.light.el=_,_.setObject3D("light",this.light),(A.type==="spot"||A.type==="directional"||A.type==="hemisphere")&&_.getObject3D("light").translateY(-1),A.type==="spot"&&(_.setObject3D("light-target",this.defaultTarget),_.getObject3D("light-target").position.set(0,0,-1)))},updateShadow:function(){var A=this.el,_=this.data,D=this.light;D.castShadow=_.castShadow;var B=A.getObject3D("cameraHelper");if(_.shadowCameraVisible&&!B?A.setObject3D("cameraHelper",new C.CameraHelper(D.shadow.camera)):!_.shadowCameraVisible&&B&&A.removeObject3D("cameraHelper"),!_.castShadow)return D;D.shadow.bias=_.shadowBias,D.shadow.radius=_.shadowRadius,D.shadow.mapSize.height=_.shadowMapHeight,D.shadow.mapSize.width=_.shadowMapWidth,D.shadow.camera.near=_.shadowCameraNear,D.shadow.camera.far=_.shadowCameraFar,D.shadow.camera instanceof C.OrthographicCamera?(D.shadow.camera.top=_.shadowCameraTop,D.shadow.camera.right=_.shadowCameraRight,D.shadow.camera.bottom=_.shadowCameraBottom,D.shadow.camera.left=_.shadowCameraLeft):D.shadow.camera.fov=_.shadowCameraFov,D.shadow.camera.updateProjectionMatrix(),B&&B.update()},getLight:function(A){var _=A.angle,D=new C.Color(A.color);this.rendererSystem.applyColorCorrection(D),D=D.getHex();var B=A.decay,$=A.distance,j=new C.Color(A.groundColor);this.rendererSystem.applyColorCorrection(j),j=j.getHex();var q=A.intensity,Q=A.type,ue=A.target,xe=null;switch(Q.toLowerCase()){case"ambient":return new C.AmbientLight(D,q);case"directional":return xe=new C.DirectionalLight(D,q),this.defaultTarget=xe.target,ue&&(ue.hasLoaded?this.onSetTarget(ue,xe):ue.addEventListener("loaded",E(this.onSetTarget,this,ue,xe))),xe;case"hemisphere":return new C.HemisphereLight(D,j,q);case"point":return new C.PointLight(D,q,$,B);case"spot":return xe=new C.SpotLight(D,q,$,M(_),A.penumbra,B),this.defaultTarget=xe.target,ue&&(ue.hasLoaded?this.onSetTarget(ue,xe):ue.addEventListener("loaded",E(this.onSetTarget,this,ue,xe))),xe;case"probe":return xe=new C.LightProbe,this.updateProbeMap(A,xe),xe;default:I("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",Q)}},updateProbeMap:function(A,_){A.envMap||_.copy(new C.LightProbe),T[A.envMap]instanceof window.Promise&&T[A.envMap].then(function(D){_.copy(D)}),T[A.envMap]instanceof C.LightProbe&&_.copy(T[A.envMap]),T[A.envMap]=new window.Promise(function(D){z.srcLoader.validateCubemapSrc(A.envMap,function($){b.load($,function(j){var q=C.LightProbeGenerator.fromCubeTexture(j);T[A.envMap]=q,_.copy(q)})})})},onSetTarget:function(A,_){_.target=A.object3D},remove:function(){var A=this.el;A.removeObject3D("light"),A.getObject3D("cameraHelper")&&A.removeObject3D("cameraHelper")}})},{"../core/component":136,"../lib/three":184,"../utils":212,"../utils/bind":206,"../utils/debug":208}],91:[function(V,re,ae){var E=V("../core/component").registerComponent;re.exports.Component=E("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var P=this.data,L,k;this.rendererSystem=this.el.sceneEl.systems.renderer,k=this.material=new THREE.LineBasicMaterial({color:P.color,opacity:P.opacity,transparent:P.opacity<1,visible:P.visible}),L=this.geometry=new THREE.BufferGeometry,L.setAttribute("position",new THREE.BufferAttribute(new Float32Array(2*3),3)),this.rendererSystem.applyColorCorrection(k.color),this.line=new THREE.Line(L,k),this.el.setObject3D(this.attrName,this.line)},update:function(P){var L=this.data,k=this.geometry,C=!1,M=this.material,I=k.attributes.position.array;z(L.start,P.start)||(I[0]=L.start.x,I[1]=L.start.y,I[2]=L.start.z,C=!0),z(L.end,P.end)||(I[3]=L.end.x,I[4]=L.end.y,I[5]=L.end.z,C=!0),C&&(k.attributes.position.needsUpdate=!0,k.computeBoundingSphere()),M.color.setStyle(L.color),this.rendererSystem.applyColorCorrection(M.color),M.opacity=L.opacity,M.transparent=L.opacity<1,M.visible=L.visible},remove:function(){this.el.removeObject3D("line",this.line)}});function z(P,L){return!P||!L?!1:P.x===L.x&&P.y===L.y&&P.z===L.z}},{"../core/component":136}],92:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../core/shader").registerShader,P=V("../lib/three");re.exports.Component=E("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new P.Quaternion,this.hiddenEls=[]},update:function(L){var k=this.data,C=this.el,M,I;!k.visualAspectEnabled||(this.initVisualAspect(),M=k.highlighted?k.highlightedColor:k.backgroundColor,I=k.highlighted?k.highlightedColor:k.borderColor,C.setAttribute("material","backgroundColor",M),C.setAttribute("material","strokeColor",I),k.on!==L.on&&this.updateEventListener(),L.peekMode!==void 0&&k.peekMode!==L.peekMode&&this.updatePeekMode(),!(!k.image||L.image===k.image)&&C.setAttribute("material","pano",typeof k.image=="string"?k.image:k.image.src))},updatePeekMode:function(){var L=this.el,k=this.sphereEl;this.data.peekMode?(this.hideAll(),L.getObject3D("mesh").visible=!1,k.setAttribute("visible",!0)):(this.showAll(),L.getObject3D("mesh").visible=!0,k.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var L=this.el;!L.isPlaying||(this.removeEventListener(),L.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var L=this.data.on;!L||this.el.removeEventListener(L,this.navigate)},initVisualAspect:function(){var L=this.el,k,C,M;!this.data.visualAspectEnabled||this.visualAspectInitialized||(M=this.textEl=this.textEl||document.createElement("a-entity"),C=this.sphereEl=this.sphereEl||document.createElement("a-entity"),k=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),L.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),L.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),M.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),M.setAttribute("position","0 1.5 0"),L.appendChild(M),k.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),k.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),k.setAttribute("rotation","0 180 0"),k.setAttribute("position","0 0 0"),k.setAttribute("visible",!1),L.appendChild(k),C.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),C.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),C.setAttribute("visible",!1),L.appendChild(C),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var L=new P.Vector3,k=new P.Vector3,C=new P.Quaternion,M=new P.Vector3;return function(){var I=this.el,b=I.object3D,T=I.sceneEl.camera,A,_,D=this.textEl;if(!!this.data.visualAspectEnabled)if(b.updateMatrixWorld(),T.parent.updateMatrixWorld(),T.updateMatrixWorld(),b.matrix.decompose(k,C,M),k.setFromMatrixPosition(b.matrixWorld),L.setFromMatrixPosition(T.matrixWorld),_=k.distanceTo(L),_>20)this.previousQuaternion||(this.quaternionClone.copy(C),this.previousQuaternion=this.quaternionClone),b.lookAt(L);else{if(A=this.calculateCameraPortalOrientation(),_<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;D.setAttribute("text","width",1.5),A<=0?(D.setAttribute("position","0 0 0.75"),D.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(D.setAttribute("position","0 0 -0.75"),D.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),I.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=A}else A<=0?D.setAttribute("rotation","0 180 0"):D.setAttribute("rotation","0 0 0"),D.setAttribute("text","width",5),D.setAttribute("position","0 1.5 0"),I.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(b.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var L=this.el,k=this.hiddenEls,C=this;k.length>0||L.sceneEl.object3D.traverse(function(M){M&&M.el&&M.el.hasAttribute("link-controls")||!M.el||M===L.sceneEl.object3D||M.el===L||M.el===C.sphereEl||M.el===L.sceneEl.cameraEl||M.el.getAttribute("visible")===!1||M.el===C.textEl||M.el===C.semiSphereEl||(M.el.setAttribute("visible",!1),k.push(M.el))})},showAll:function(){this.hiddenEls.forEach(function(L){L.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var L=new P.Matrix4,k=new P.Vector3,C=new P.Vector3(0,0,1),M=new P.Vector3(0,0,0);return function(){var I=this.el,b=I.sceneEl.camera;return k.set(0,0,0),C.set(0,0,1),M.set(0,0,0),I.object3D.matrixWorld.extractRotation(L),C.applyMatrix4(L),I.object3D.updateMatrixWorld(),I.object3D.localToWorld(M),b.parent.parent.updateMatrixWorld(),b.parent.updateMatrixWorld(),b.updateMatrixWorld(),b.localToWorld(k),k.sub(M).normalize(),C.normalize(),Math.sign(C.dot(k))}}(),remove:function(){this.removeEventListener()}}),z("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join(`
`)})},{"../core/component":136,"../core/shader":146,"../lib/three":184}],93:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../lib/three"),P=V("../utils/"),L=P.bind,k=Math.PI/2;re.exports.Component=E("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new z.Vector3,this.hmdQuaternion=new z.Quaternion,this.magicWindowAbsoluteEuler=new z.Euler,this.magicWindowDeltaEuler=new z.Euler,this.position=new z.Vector3,this.magicWindowObject=new z.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new z.Vector3,rotation:new z.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var C,M=this.data;(P.device.isMobile()||P.device.isMobileDeviceRequestingDesktopSite())&&(C=this.magicWindowControls=new z.DeviceOrientationControls(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(C.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?C.enabled=M.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){C.enabled=M.magicWindowTrackingEnabled})))},update:function(C){var M=this.data;M.enabled!==C.enabled&&this.updateGrabCursor(M.enabled),C&&!M.magicWindowTrackingEnabled&&C.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=M.magicWindowTrackingEnabled),C&&!M.pointerLockEnabled!==C.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(C){var M=this.data;!M.enabled||this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=L(this.onMouseDown,this),this.onMouseMove=L(this.onMouseMove,this),this.onMouseUp=L(this.onMouseUp,this),this.onTouchStart=L(this.onTouchStart,this),this.onTouchMove=L(this.onTouchMove,this),this.onTouchEnd=L(this.onTouchEnd,this),this.onEnterVR=L(this.onEnterVR,this),this.onExitVR=L(this.onExitVR,this),this.onPointerLockChange=L(this.onPointerLockChange,this),this.onPointerLockError=L(this.onPointerLockError,this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new z.Object3D,this.yawObject=new z.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var C=this.el.sceneEl,M=C.canvas;if(!M){C.addEventListener("render-target-loaded",L(this.addEventListeners,this));return}M.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),M.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),C.addEventListener("enter-vr",this.onEnterVR),C.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))},removeEventListeners:function(){var C=this.el.sceneEl,M=C&&C.canvas;!M||(M.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),M.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),C.removeEventListener("enter-vr",this.onEnterVR),C.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var C=this.el.object3D,M=this.pitchObject,I=this.yawObject,b=this.el.sceneEl;(b.is("vr-mode")||b.is("ar-mode"))&&b.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),C.rotation.x=this.magicWindowDeltaEuler.x+M.rotation.x,C.rotation.y=this.magicWindowDeltaEuler.y+I.rotation.y,C.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var C=this.magicWindowAbsoluteEuler,M=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),C.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&C.y!==0&&(this.previousMagicWindowYaw=C.y),this.previousMagicWindowYaw&&(M.x=C.x,M.y+=C.y-this.previousMagicWindowYaw,M.z=C.z,this.previousMagicWindowYaw=C.y))},onMouseMove:function(C){var M,I,b,T=this.pitchObject,A=this.previousMouseEvent,_=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(I=C.movementX||C.mozMovementX||0,b=C.movementY||C.mozMovementY||0):(I=C.screenX-A.screenX,b=C.screenY-A.screenY),this.previousMouseEvent.screenX=C.screenX,this.previousMouseEvent.screenY=C.screenY,M=this.data.reverseMouseDrag?1:-1,_.rotation.y+=I*.002*M,T.rotation.x+=b*.002*M,T.rotation.x=Math.max(-k,Math.min(k,T.rotation.x)))},onMouseDown:function(C){var M=this.el.sceneEl;if(!(!this.data.enabled||!this.data.mouseEnabled||(M.is("vr-mode")||M.is("ar-mode"))&&M.checkHeadsetConnected())&&C.button===0){var I=M&&M.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=C.screenX,this.previousMouseEvent.screenY=C.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(I.requestPointerLock?I.requestPointerLock():I.mozRequestPointerLock&&I.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(C){C.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:C.touches[0].pageX,y:C.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(C){var M,I=this.el.sceneEl.canvas,b,T=this.yawObject;!this.touchStarted||!this.data.touchEnabled||(b=2*Math.PI*(C.touches[0].pageX-this.touchStart.x)/I.clientWidth,M=this.data.reverseTouchDrag?1:-1,T.rotation.y-=b*.5*M,this.touchStart={x:C.touches[0].pageX,y:C.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var C=this.el.sceneEl;!C.checkHeadsetConnected()||(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),C.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){!this.el.sceneEl.checkHeadsetConnected()||(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(C){var M=this.el.sceneEl;function I(){M.canvas.classList.add("a-grab-cursor")}function b(){M.canvas.classList.remove("a-grab-cursor")}if(!M.canvas){C?M.addEventListener("render-target-loaded",I):M.addEventListener("render-target-loaded",b);return}if(C){I();return}b()},saveCameraPose:function(){var C=this.el;this.savedPose.position.copy(C.object3D.position),this.savedPose.rotation.copy(C.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var C=this.el,M=this.savedPose;!this.hasSavedPose||(C.object3D.position.copy(M.position),C.object3D.rotation.copy(M.rotation),this.hasSavedPose=!1)}})},{"../core/component":136,"../lib/three":184,"../utils/":212}],94:[function(V,re,ae){var E=V("../utils/bind"),z=V("../core/component").registerComponent,P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M="magicleap",I="-one",b=M+I,T="https://cdn.aframe.io/controllers/magicleap/magicleap-one-controller.glb",A={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]};re.exports.Component=z("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:A,init:function(){var _=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=E(this.onButtonChanged,this),this.onButtonDown=function(D){C(D.detail.id,"down",_)},this.onButtonUp=function(D){C(D.detail.id,"up",_)},this.onButtonTouchEnd=function(D){C(D.detail.id,"touchend",_)},this.onButtonTouchStart=function(D){C(D.detail.id,"touchstart",_)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var _=this.data;this.controllerIndex=_.hand==="right"?0:_.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=E(this.onModelLoaded,this),this.onControllersUpdate=E(this.onControllersUpdate,this),this.checkIfControllerPresent=E(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=E(this.removeControllersUpdateListener,this),this.onAxisMoved=E(this.onAxisMoved,this)},addEventListeners:function(){var _=this.el;_.addEventListener("buttonchanged",this.onButtonChanged),_.addEventListener("buttondown",this.onButtonDown),_.addEventListener("buttonup",this.onButtonUp),_.addEventListener("touchstart",this.onButtonTouchStart),_.addEventListener("touchend",this.onButtonTouchEnd),_.addEventListener("axismove",this.onAxisMoved),_.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var _=this.el;_.removeEventListener("buttonchanged",this.onButtonChanged),_.removeEventListener("buttondown",this.onButtonDown),_.removeEventListener("buttonup",this.onButtonUp),_.removeEventListener("touchstart",this.onButtonTouchStart),_.removeEventListener("touchend",this.onButtonTouchEnd),_.removeEventListener("axismove",this.onAxisMoved),_.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var _=this.data;L(this,b,{index:this.controllerIndex,hand:_.hand})},injectTrackedControls:function(){var _=this.el,D=this.data;_.setAttribute("tracked-controls",{idPrefix:b,hand:D.hand,controller:this.controllerIndex,orientationOffset:D.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",T)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(_){var D=this.mapping.buttons[_.detail.id],B;!D||(D==="trigger"&&(B=_.detail.state.value,console.log("analog value of trigger press: "+B)),this.el.emit(D+"changed",_.detail.state))},onModelLoaded:function(_){var D=_.detail.model;D.scale.set(.01,.01,.01)},onAxisMoved:function(_){k(this,this.mapping.axes,_)},updateModel:function(_,D){},setButtonColor:function(_,D){}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],95:[function(V,re,ae){var E=V("../utils/"),z=V("../core/component"),P=V("../lib/three"),L=V("../core/shader"),k=E.debug("components:material:error"),C=z.registerComponent,M=L.shaders,I=L.shaderNames;re.exports.Component=C("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:I,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColors:{type:"string",default:"none",oneOf:["face","vertex"]},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0}},init:function(){this.material=null},update:function(D){var B=this.data;(!this.shader||B.shader!==D.shader)&&this.updateShader(B.shader),this.shader.update(this.data),this.updateMaterial(D)},updateSchema:function(D){var B,$,j,q;$=D&&D.shader,B=this.oldData&&this.oldData.shader,q=$||B,j=M[q]&&M[q].schema,j||k("Unknown shader schema "+q),!(B&&$===B)&&(this.extendSchema(j),this.updateBehavior())},updateBehavior:function(){var D,B=this.el.sceneEl,$=this.schema,j=this,q;function Q(ue,xe){var Se;for(Se in q)q[Se]=ue;j.shader.update(q)}this.tick=void 0,q={};for(D in $)$[D].type==="time"&&(this.tick=Q,q[D]=!0);!B||(this.tick?B.addBehavior(this):B.removeBehavior(this))},updateShader:function(D){var B=this.data,$=M[D]&&M[D].Shader,j;if(!$)throw new Error("Unknown shader "+D);j=this.shader=new $,j.el=this.el,j.init(B),this.setMaterial(j.material),this.updateSchema(B)},updateMaterial:function(D){var B=this.data,$=this.material,j;$.alphaTest=B.alphaTest,$.depthTest=B.depthTest!==!1,$.depthWrite=B.depthWrite!==!1,$.opacity=B.opacity,$.flatShading=B.flatShading,$.side=b(B.side),$.transparent=B.transparent!==!1||B.opacity<1,$.vertexColors=T(B.vertexColors),$.visible=B.visible,$.blending=A(B.blending),$.dithering=B.dithering;for(j in D)break;j&&(D.alphaTest!==B.alphaTest||D.side!==B.side||D.vertexColors!==B.vertexColors)&&($.needsUpdate=!0)},remove:function(){var D=new P.MeshBasicMaterial,B=this.material,$=this.el.getObject3D("mesh");$&&($.material=D),_(B,this.system)},setMaterial:function(D){var B=this.el,$,j=this.system;this.material&&_(this.material,j),this.material=D,j.registerMaterial(D),$=B.getObject3D("mesh"),$?$.material=D:B.addEventListener("object3dset",function q(Q){Q.detail.type!=="mesh"||Q.target!==B||(B.getObject3D("mesh").material=D,B.removeEventListener("object3dset",q))})}});function b(D){switch(D){case"back":return P.BackSide;case"double":return P.DoubleSide;default:return P.FrontSide}}function T(D){switch(D){case"face":return P.FaceColors;case"vertex":return P.VertexColors;default:return P.NoColors}}function A(D){switch(D){case"none":return P.NoBlending;case"additive":return P.AdditiveBlending;case"subtractive":return P.SubtractiveBlending;case"multiply":return P.MultiplyBlending;default:return P.NormalBlending}}function _(D,B){D.dispose(),B.unregisterMaterial(D)}},{"../core/component":136,"../core/shader":146,"../lib/three":184,"../utils/":212}],96:[function(V,re,ae){var E=V("../utils/debug"),z=V("../core/component").registerComponent,P=V("../lib/three"),L=E("components:obj-model:warn");re.exports.Component=z("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var k=this;this.model=null,this.objLoader=new P.OBJLoader,this.mtlLoader=new P.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(C){!k.model||C.detail.name==="material"&&k.applyMaterial()})},update:function(){var k=this.data;!k.obj||(this.resetMesh(),this.loadObj(k.obj,k.mtl))},remove:function(){!this.model||this.resetMesh()},resetMesh:function(){this.el.removeObject3D("mesh")},loadObj:function(k,C){var M=this,I=this.el,b=this.mtlLoader,T=this.objLoader,A=this.el.sceneEl.systems.renderer,_=C.substr(0,C.lastIndexOf("/")+1);if(C){I.hasAttribute("material")&&L("Material component properties are ignored when a .MTL is provided"),b.setResourcePath(_),b.load(C,function(D){D.preload(),T.setMaterials(D),T.load(k,function(B){M.model=B,M.model.traverse(function($){if($.isMesh){var j=$.material;j.color&&A.applyColorCorrection(j.color),j.map&&A.applyColorCorrection(j.map),j.emissive&&A.applyColorCorrection(j.emissive),j.emissiveMap&&A.applyColorCorrection(j.emissiveMap)}}),I.setObject3D("mesh",B),I.emit("model-loaded",{format:"obj",model:B})})});return}T.load(k,function(B){M.model=B,M.applyMaterial(),I.setObject3D("mesh",B),I.emit("model-loaded",{format:"obj",model:B})})},applyMaterial:function(){var k=this.el.components.material;!k||this.model.traverse(function(C){C instanceof P.Mesh&&(C.material=k.material)})}})},{"../core/component":136,"../lib/three":184,"../utils/debug":208}],97:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M=V("../utils/").device.isWebXRAvailable,I="oculus-go",b="Oculus Go",T="https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf",A=M?I:b,_={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},D={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},B=M?D:_;re.exports.Component=E("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:B,bindMethods:function(){this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},init:function(){var $=this;this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(j){C(j.detail.id,"down",$)},this.onButtonUp=function(j){C(j.detail.id,"up",$)},this.onButtonTouchStart=function(j){C(j.detail.id,"touchstart",$)},this.onButtonTouchEnd=function(j){C(j.detail.id,"touchend",$)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var $=this.el;$.addEventListener("buttonchanged",this.onButtonChanged),$.addEventListener("buttondown",this.onButtonDown),$.addEventListener("buttonup",this.onButtonUp),$.addEventListener("touchstart",this.onButtonTouchStart),$.addEventListener("touchend",this.onButtonTouchEnd),$.addEventListener("model-loaded",this.onModelLoaded),$.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var $=this.el;$.removeEventListener("buttonchanged",this.onButtonChanged),$.removeEventListener("buttondown",this.onButtonDown),$.removeEventListener("buttonup",this.onButtonUp),$.removeEventListener("touchstart",this.onButtonTouchStart),$.removeEventListener("touchend",this.onButtonTouchEnd),$.removeEventListener("model-loaded",this.onModelLoaded),$.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){L(this,A,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var $=this.el,j=this.data;$.setAttribute("tracked-controls",{armModel:j.armModel,hand:j.hand,idPrefix:A,orientationOffset:j.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",T)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function($){var j=$.detail.model,q;!this.data.model||(q=this.buttonMeshes={},q.trigger=j.getObjectByName("oculus_go_button_trigger"),q.trackpad=j.getObjectByName("oculus_go_touchpad"),q.touchpad=j.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function($){var j=this.mapping.buttons[$.detail.id];!j||this.el.emit(j+"changed",$.detail.state)},onAxisMoved:function($){k(this,this.mapping.axes,$)},updateModel:function($,j){!this.data.model||this.updateButtonModel($,j)},updateButtonModel:function($,j){var q=this.buttonMeshes;if(!(!q||!q[$])){var Q,ue;switch(j){case"down":Q=this.data.buttonHighlightColor;break;case"touchstart":Q=this.data.buttonTouchedColor;break;default:Q=this.data.buttonColor}ue=q[$],ue.material.color.set(Q),this.rendererSystem.applyColorCorrection(ue.material.color)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],98:[function(V,re,ae){var E=V("../utils/bind"),z=V("../core/component").registerComponent,P=V("../lib/three"),L=V("../utils/tracked-controls"),k=L.checkControllerPresentAndSetup,C=L.emitIfAxesChanged,M=L.onButtonEvent,I=V("../utils/").device.isWebXRAvailable,b="oculus-touch",T="Oculus Touch",A=I?b:T,_="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-",D={left:{modelUrl:_+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new P.Vector3(-.005,.003,-.055),modelPivotRotation:new P.Euler(0,0,0)},right:{modelUrl:_+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new P.Vector3(.005,.003,-.055),modelPivotRotation:new P.Euler(0,0,0)}},B={left:{modelUrl:_+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new P.Vector3(-.005,.036,-.037),modelPivotRotation:new P.Euler(Math.PI/4.5,0,0)},right:{modelUrl:_+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new P.Vector3(.005,.036,-.037),modelPivotRotation:new P.Euler(Math.PI/4.5,0,0)}},$=I?B:D,j="oculus-touch",q={"oculus-touch":$,"oculus-touch-v2":{left:{modelUrl:_+"gen2-left.gltf",rayOrigin:{origin:{x:-.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new P.Vector3(0,0,0),modelPivotRotation:new P.Euler(0,0,0)},right:{modelUrl:_+"gen2-right.gltf",rayOrigin:{origin:{x:.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new P.Vector3(0,0,0),modelPivotRotation:new P.Euler(0,0,0)}},"oculus-touch-v3":{left:{modelUrl:_+"v3-left.glb",rayOrigin:{origin:{x:.015,y:.005,z:0},direction:{x:0,y:0,z:-1}},modelPivotOffset:new P.Vector3(.01,-.01,.05),modelPivotRotation:new P.Euler(Math.PI/4,0,0)},right:{modelUrl:_+"v3-right.glb",rayOrigin:{origin:{x:-.015,y:.005,z:0},direction:{x:0,y:0,z:-1}},modelPivotOffset:new P.Vector3(-.01,-.01,.05),modelPivotRotation:new P.Euler(Math.PI/4,0,0)}}},Q={left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},ue={left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},xe=I?ue:Q;re.exports.Component=z("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},mapping:xe,bindMethods:function(){this.onModelLoaded=E(this.onModelLoaded,this),this.onControllersUpdate=E(this.onControllersUpdate,this),this.checkIfControllerPresent=E(this.checkIfControllerPresent,this),this.onAxisMoved=E(this.onAxisMoved,this)},init:function(){var Se=this;this.onButtonChanged=E(this.onButtonChanged,this),this.onButtonDown=function(be){M(be.detail.id,"down",Se,Se.data.hand)},this.onButtonUp=function(be){M(be.detail.id,"up",Se,Se.data.hand)},this.onButtonTouchStart=function(be){M(be.detail.id,"touchstart",Se,Se.data.hand)},this.onButtonTouchEnd=function(be){M(be.detail.id,"touchend",Se,Se.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var Se=this.el;Se.addEventListener("buttonchanged",this.onButtonChanged),Se.addEventListener("buttondown",this.onButtonDown),Se.addEventListener("buttonup",this.onButtonUp),Se.addEventListener("touchstart",this.onButtonTouchStart),Se.addEventListener("touchend",this.onButtonTouchEnd),Se.addEventListener("axismove",this.onAxisMoved),Se.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var Se=this.el;Se.removeEventListener("buttonchanged",this.onButtonChanged),Se.removeEventListener("buttondown",this.onButtonDown),Se.removeEventListener("buttonup",this.onButtonUp),Se.removeEventListener("touchstart",this.onButtonTouchStart),Se.removeEventListener("touchend",this.onButtonTouchEnd),Se.removeEventListener("axismove",this.onAxisMoved),Se.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){k(this,A,{hand:this.data.hand})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(Se){var be=this.data,pe;if(!!be.model){if(this.displayModel=q[be.controllerType]||q[j],be.controllerType==="auto"){var we=this.el.sceneEl.systems["tracked-controls-webvr"];if(we&&we.vrDisplay){var he=we.vrDisplay.displayName;/^Oculus Quest$/.test(he)&&(this.displayModel=q["oculus-touch-v2"])}else pe=j,pe=Se.profiles.indexOf("oculus-touch-v2")!==-1?"oculus-touch-v2":pe,pe=Se.profiles.indexOf("oculus-touch-v3")!==-1?"oculus-touch-v3":pe,this.displayModel=q[pe]}var Ie=this.displayModel[be.hand].modelUrl;this.el.setAttribute("gltf-model",Ie)}},injectTrackedControls:function(Se){var be=this.data,pe=b,we=be.hand==="right"?"Oculus Touch (Right)":"Oculus Touch (Left)",he=I?pe:we;this.el.setAttribute("tracked-controls",{id:he,hand:be.hand,orientationOffset:be.orientationOffset,handTrackingEnabled:!1}),this.loadModel(Se)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(Se){var be=this.mapping[this.data.hand].buttons[Se.detail.id],pe=this.buttonMeshes,we;!be||((be==="trigger"||be==="grip")&&(we=Se.detail.state.value),pe&&(be==="trigger"&&pe.trigger&&(pe.trigger.rotation.x=this.originalXRotationTrigger-we*(Math.PI/26)),be==="grip"&&pe.grip&&(pe.grip.position.x=this.originalXPositionGrip+(this.data.hand==="left"?-1:1)*we*.004)),this.el.emit(be+"changed",Se.detail.state))},onModelLoaded:function(Se){var be=this.controllerObject3D=Se.detail.model,pe;!this.data.model||(pe=this.buttonMeshes={},pe.grip=be.getObjectByName("buttonHand"),this.originalXPositionGrip=pe.grip&&pe.grip.position.x,pe.thumbstick=be.getObjectByName("stick"),pe.trigger=be.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=pe.trigger&&pe.trigger.rotation.x,pe.xbutton=be.getObjectByName("buttonX"),pe.abutton=be.getObjectByName("buttonA"),pe.ybutton=be.getObjectByName("buttonY"),pe.bbutton=be.getObjectByName("buttonB"),be.position.copy(this.displayModel[this.data.hand].modelPivotOffset),be.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin}))},onAxisMoved:function(Se){C(this,this.mapping[this.data.hand].axes,Se)},updateModel:function(Se,be){!this.data.model||this.updateButtonModel(Se,be)},updateButtonModel:function(Se,be){var pe,we=be==="up"||be==="touchend"?this.data.buttonColor:be==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,he=this.buttonMeshes;!this.data.model||he&&he[Se]&&(pe=he[Se],pe.material.color.set(we),this.rendererSystem.applyColorCorrection(pe.material.color))}})},{"../core/component":136,"../lib/three":184,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],99:[function(V,re,ae){var E=V("../core/component").registerComponent;re.exports.Component=E("position",{schema:{type:"vec3"},update:function(){var z=this.el.object3D,P=this.data;z.position.set(P.x,P.y,P.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},{"../core/component":136}],100:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../lib/three"),P=V("../utils/"),L=P.debug("components:raycaster:warn"),k=/^[\w\s-.,[\]#]*$/,C={childList:!0,attributes:!0,subtree:!0},M={INTERSECT:"raycaster-intersected",INTERSECTION:"raycaster-intersection",INTERSECT_CLEAR:"raycaster-intersected-cleared",INTERSECTION_CLEAR:"raycaster-intersection-cleared",INTERSECTION_CLOSEST_ENTITY_CHANGED:"raycaster-closest-entity-changed"};re.exports.Component=E("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new z.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new z.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new z.Vector3,this.otherLineEndVec3=new z.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(b){var T=this.data,A=this.el,_=this.raycaster;_.far=T.far,_.near=T.near,T.showLine&&(T.far!==b.far||T.origin!==b.origin||T.direction!==b.direction||!b.showLine)&&(this.unitLineEndVec3.copy(T.origin).add(T.direction).normalize(),this.drawLine()),!T.showLine&&b.showLine&&A.removeAttribute("line"),T.objects!==b.objects&&!k.test(T.objects)&&L('[raycaster] Selector "'+T.objects+'" may not update automatically with DOM changes.'),T.objects||L('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),T.autoRefresh!==b.autoRefresh&&A.isPlaying&&(T.autoRefresh?this.addEventListeners():this.removeEventListeners()),b.enabled&&!T.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){!this.data.autoRefresh||(this.observer.observe(this.el.sceneEl,C),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var b=this.data,T;T=b.objects?this.el.sceneEl.querySelectorAll(b.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(T),this.dirty=!1},tock:function(b){var T=this.data,A=this.prevCheckTime;!T.enabled||A&&b-A<T.interval||(this.prevCheckTime=b,this.checkIntersections())},checkIntersections:function(){var b=this.clearedIntersectedEls,T=this.el,A=this.data,_,D=this.intersectedEls,B,$=this.intersections,j=this.newIntersectedEls,q=this.newIntersections,Q=this.prevIntersectedEls,ue=this.rawIntersections;for(this.dirty&&this.refreshObjects(),I(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),ue.length=0,this.raycaster.intersectObjects(this.objects,!0,ue),$.length=0,D.length=0,_=0;_<ue.length;_++)B=ue[_],!(A.showLine&&B.object===T.getObject3D("line"))&&B.object.el&&($.push(B),D.push(B.object.el));for(q.length=0,j.length=0,_=0;_<$.length;_++)Q.indexOf($[_].object.el)===-1&&(q.push($[_]),j.push($[_].object.el));for(b.length=0,_=0;_<Q.length;_++)D.indexOf(Q[_])===-1&&(Q[_].emit(M.INTERSECT_CLEAR,this.intersectedClearedDetail),b.push(Q[_]));for(b.length&&T.emit(M.INTERSECTION_CLEAR,this.intersectionClearedDetail),_=0;_<j.length;_++)j[_].emit(M.INTERSECT,this.intersectedDetail);q.length&&(this.intersectionDetail.els=j,this.intersectionDetail.intersections=q,T.emit(M.INTERSECTION,this.intersectionDetail)),(Q.length===0&&$.length>0||Q.length>0&&$.length===0||Q.length&&$.length&&Q[0]!==$[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=$,T.emit(M.INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),A.showLine&&setTimeout(this.updateLine)},updateLine:function(){var b=this.el,T=this.intersections,A;T.length&&(T[0].object.el===b&&T[1]?A=T[1].distance:A=T[0].distance),this.drawLine(A)},getIntersection:function(b){var T,A;for(T=0;T<this.intersections.length;T++)if(A=this.intersections[T],A.object.el===b)return A;return null},updateOriginDirection:function(){var b=new z.Vector3,T=new z.Vector3;return function(){var _=this.el,D=this.data;if(D.useWorldCoordinates){this.raycaster.set(D.origin,D.direction);return}_.object3D.updateMatrixWorld(),T.setFromMatrixPosition(_.object3D.matrixWorld),(D.origin.x!==0||D.origin.y!==0||D.origin.z!==0)&&(T=_.object3D.localToWorld(T.copy(D.origin))),b.copy(D.direction).transformDirection(_.object3D.matrixWorld).normalize(),this.raycaster.set(T,b)}}(),drawLine:function(b){var T=this.data,A=this.el,_;_=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,b===void 0&&(b=T.far===1/0?1e3:T.far),this.lineData.start=T.origin,this.lineData.end=_.copy(this.unitLineEndVec3).multiplyScalar(b),this.lineData.color=T.lineColor,this.lineData.opacity=T.lineOpacity,A.setAttribute("line",this.lineData)},flattenObject3DMaps:function(b){var T,A,_=this.objects;for(_.length=0,A=0;A<b.length;A++)if(b[A].isEntity&&b[A].object3D)for(T in b[A].object3DMap)_.push(b[A].getObject3D(T));return _},clearAllIntersections:function(){var b;for(b=0;b<this.intersectedEls.length;b++)this.intersectedEls[b].emit(M.INTERSECT_CLEAR,this.intersectedClearedDetail);I(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(M.INTERSECTION_CLEAR,this.intersectionClearedDetail)}});function I(b,T){var A;for(b.length=T.length,A=0;A<T.length;A++)b[A]=T[A]}},{"../core/component":136,"../lib/three":184,"../utils/":212}],101:[function(V,re,ae){var E=V("../lib/three").Math.degToRad,z=V("../core/component").registerComponent;re.exports.Component=z("rotation",{schema:{type:"vec3"},update:function(){var P=this.data,L=this.el.object3D;L.rotation.set(E(P.x),E(P.y),E(P.z)),L.rotation.order="YXZ"},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},{"../core/component":136,"../lib/three":184}],102:[function(V,re,ae){var E=V("../core/component").registerComponent,z=1e-5;re.exports.Component=E("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var P=this.data,L=this.el.object3D,k=P.x===0?z:P.x,C=P.y===0?z:P.y,M=P.z===0?z:P.z;L.scale.set(k,C,M)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},{"../core/component":136}],103:[function(V,re,ae){var E="data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",z=V("../../core/component").registerComponent,P=V("../../lib/three"),L=21,k=function(){var b=new P.Quaternion,T=new P.Vector3;function A(_,D,B){D.position.copy(_.transform.position),D.quaternion.copy(_.transform.orientation),T.copy(B),b.copy(_.transform.orientation),T.applyQuaternion(b),D.position.sub(T)}return A}();k.tempFakePose={transform:{orientation:new P.Quaternion,position:new P.Vector3}};function C(b,T){this.renderer=b,this.xrHitTestSource=null,b.xr.addEventListener("sessionend",function(){this.xrHitTestSource=null}.bind(this)),b.xr.addEventListener("sessionstart",function(){this.sessionStart(T)}.bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(T)}C.prototype.previousFrameAnchors=new Set,C.prototype.anchorToObject3D=new Map;function M(b){console.warn(b.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}C.prototype.sessionStart=function(T){if(this.session=this.renderer.xr.getSession(),!("requestHitTestSource"in this.session)){M({message:"No requestHitTestSource on the session."});return}T.space?this.session.requestHitTestSource(T).then(function(A){this.xrHitTestSource=A}.bind(this)).catch(M):T.profile&&this.session.requestHitTestSourceForTransientInput(T).then(function(A){this.xrHitTestSource=A,this.transient=!0}.bind(this)).catch(M)},C.prototype.anchorFromLastHitTestResult=function(b,T){var A=this.lastHitTest;if(!!A){var _={object3D:b,offset:T};Array.from(this.anchorToObject3D.entries()).forEach(function(D){var B=D[1].object3D,$=D[0];B===b&&(this.anchorToObject3D.delete($),$.delete())}.bind(this)),A.createAnchor&&A.createAnchor().then(function(D){this.anchorToObject3D.set(D,_)}.bind(this)).catch(function(D){console.warn(D.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},C.prototype.doHit=function(T){if(!!this.renderer.xr.isPresenting){var A=this.renderer.xr.getReferenceSpace(),_=T.getViewerPose(A),D,B;if(this.xrHitTestSource&&_)return this.transient?(D=T.getHitTestResultsForTransientInput(this.xrHitTestSource),D.length>0?(B=D[0].results,B.length>0?(this.lastHitTest=B[0],B[0].getPose(A)):!1):!1):(D=T.getHitTestResults(this.xrHitTestSource),D.length>0?(this.lastHitTest=D[0],D[0].getPose(A)):!1)}},C.updateAnchorPoses=function(b,T){var A=b.trackedAnchors||C.prototype.previousFrameAnchors;C.prototype.previousFrameAnchors.forEach(function(_){A.has(_)||C.prototype.anchorToObject3D.delete(_)}),A.forEach(function(_){var D,B,$,j;try{D=b.getPose(_.anchorSpace,T)}catch{}D&&(B=C.prototype.anchorToObject3D.get(_),$=B.offset,j=B.object3D,k(D,j,$))})};var I;re.exports.Component=z("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:E,type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(512*512*4),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new P.OrthographicCamera,this.orthoCam.layers.set(L),this.textureTarget=new P.WebGLRenderTarget(512,512,{}),this.basicMaterial=new P.MeshBasicMaterial({color:0,side:P.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new P.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var b=this.el.getAttribute("webxr"),T=b.optionalFeatures;(!T.includes("hit-test")||!T.includes("anchors"))&&(T.push("hit-test"),T.push("anchors"),this.el.setAttribute("webxr",b)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",function(){this.hitTest=null}.bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",function(){if(!!this.el.is("ar-mode")){var A=this.el.sceneEl.renderer,_=this.session=A.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,I||(I=new Map),_.requestReferenceSpace("viewer").then(function($){this.hitTest=new C(A,{space:$}),I.set($,this.hitTest),this.el.emit("ar-hit-test-start")}.bind(this));var D="generic-touchscreen",B=new C(A,{profile:D});_.addEventListener("selectstart",function($){if(this.data.enabled===!0){var j=$.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:j,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),j.profiles[0]===D?this.hitTest=B:(this.hitTest=I.get(j)||new C(A,{space:j.targetRaySpace}),I.set(j,this.hitTest)))}}.bind(this)),_.addEventListener("selectend",function($){if(!this.hitTest||this.data.enabled!==!0){this.hitTest=null;return}var j=$.inputSource,q;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(q=this.data.target.object3D,q&&(k.tempFakePose.transform.position.copy(this.bboxMesh.position),k.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),k(k.tempFakePose,q,this.bboxOffset),q.visible=!0,this.hitTest.anchorFromLastHitTestResult(q,this.bboxOffset))),this.el.emit("ar-hit-test-select",{inputSource:j,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}.bind(this))}}.bind(this)),this.bboxOffset=new P.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(L),this.data.target.object3D.traverse(function(b){b.layers.enable(L)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var b=new P.PlaneGeometry(1,1),T=new P.MeshBasicMaterial({transparent:!0,color:16777215});b.rotateX(-Math.PI/2),b.rotateY(-Math.PI/2),this.bbox=new P.Box3,this.bboxMesh=new P.Mesh(b,T),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var b,T=this.el.sceneEl.renderer,A,_,D=T.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),A=T.getRenderTarget(),T.setRenderTarget(this.textureTarget),T.xr.enabled=!1,_=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,T.render(this.el.object3D,this.orthoCam),this.el.object3D.background=_,this.el.object3D.overrideMaterial=null,T.xr.enabled=D,T.setRenderTarget(A),T.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),b=this.context.getImageData(0,0,512,512);for(var B=0;B<512*512;B++)b.data[B*4+3]!==0&&b.data[B*4+3]!==255&&(b.data[B*4+3]=128);this.context.putImageData(b,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var b,T=this.el.sceneEl.frame,A=this.el.sceneEl.renderer;if(T&&C.updateAnchorPoses(T,A.xr.getReferenceSpace()),this.bboxNeedsUpdate){if(this.bboxNeedsUpdate=!1,!this.data.target||this.data.type==="map"){var _;this.textureCache.has(this.data.src)?_=this.textureCache.get(this.data.src):(_=new P.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,_)),this.bboxMesh.material.map=_,this.bboxMesh.material.needsUpdate=!0}this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)}this.hitTest&&(b=this.hitTest.doHit(T),b&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(b.transform.position),this.bboxMesh.quaternion.copy(b.transform.orientation)))}})},{"../../core/component":136,"../../lib/three":184}],104:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../core/component").components;re.exports.Component=E("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},update:function(){var P=this.data,L=this.el.object3D;P.transparent?L.background=null:L.background=new THREE.Color(P.color)},remove:function(){var P=this.data,L=this.el.object3D;if(P.transparent){L.background=null;return}L.background=z[this.name].schema.color.default}})},{"../../core/component":136}],105:[function(V,re,ae){var E=V("../../core/component").registerComponent;re.exports.Component=E("debug",{schema:{default:!0}})},{"../../core/component":136}],106:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../utils/"),P=z.bind,L=V("../../constants/"),k="a-modal",C="a-dialog",M="a-dialog-text",I="a-dialog-text-container",b="a-dialog-buttons-container",T="a-dialog-button",A="a-dialog-allow-button",_="a-dialog-deny-button",D="a-dialog-ok-button";re.exports.Component=E("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},init:function(){var q=this;if(!!this.data.enabled){if(location.hostname!=="localhost"&&location.hostname!=="127.0.0.1"&&location.protocol==="http:"&&this.showHTTPAlert(),typeof DeviceOrientationEvent>"u"||!DeviceOrientationEvent.requestPermission){this.permissionGranted=!0;return}this.onDeviceMotionDialogAllowClicked=P(this.onDeviceMotionDialogAllowClicked,this),this.onDeviceMotionDialogDenyClicked=P(this.onDeviceMotionDialogDenyClicked,this),DeviceOrientationEvent.requestPermission().catch(function(){q.devicePermissionDialogEl=B(q.data.denyButtonText,q.data.allowButtonText,q.data.deviceMotionMessage,q.onDeviceMotionDialogAllowClicked,q.onDeviceMotionDialogDenyClicked),q.el.appendChild(q.devicePermissionDialogEl)}).then(function(){q.el.emit("deviceorientationpermissiongranted"),q.permissionGranted=!0})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var q=this,Q=$(q.data.cancelButtonText,q.data.httpsMessage,function(){q.el.removeChild(Q)});this.el.appendChild(Q)},onDeviceMotionDialogAllowClicked:function(){var q=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(Q){Q==="granted"?(q.el.emit("deviceorientationpermissiongranted"),q.permissionGranted=!0):q.el.emit("deviceorientationpermissionrejected"),q.remove()}).catch(console.error)}});function B(q,Q,ue,xe,Se){var be,pe,we;return be=document.createElement("div"),be.classList.add(b),pe=document.createElement("button"),pe.classList.add(T,_),pe.setAttribute(L.AFRAME_INJECTED,""),pe.innerHTML=q,be.appendChild(pe),we=document.createElement("button"),we.classList.add(T,A),we.setAttribute(L.AFRAME_INJECTED,""),we.innerHTML=Q,be.appendChild(we),we.addEventListener("click",function(he){he.stopPropagation(),xe()}),pe.addEventListener("click",function(he){he.stopPropagation(),Se()}),j(ue,be)}function $(q,Q,ue){var xe,Se;return xe=document.createElement("div"),xe.classList.add(b),Se=document.createElement("button"),Se.classList.add(T,D),Se.setAttribute(L.AFRAME_INJECTED,""),Se.innerHTML=q,xe.appendChild(Se),Se.addEventListener("click",function(be){be.stopPropagation(),ue()}),j(Q,xe)}function j(q,Q){var ue,xe,Se,be;return ue=document.createElement("div"),ue.classList.add(k),ue.setAttribute(L.AFRAME_INJECTED,""),xe=document.createElement("div"),xe.className=C,xe.setAttribute(L.AFRAME_INJECTED,""),ue.appendChild(xe),Se=document.createElement("div"),Se.classList.add(I),xe.appendChild(Se),be=document.createElement("div"),be.classList.add(M),be.innerHTML=q,Se.appendChild(be),xe.appendChild(Q),ue}},{"../../constants/":128,"../../core/component":136,"../../utils/":212}],107:[function(V,re,ae){var E=V("../../core/component").registerComponent;re.exports.Component=E("embedded",{dependencies:["vr-mode-ui"],schema:{default:!0},update:function(){var z=this.el,P=z.querySelector(".a-enter-vr");this.data===!0?(P&&P.classList.add("embedded"),z.removeFullScreenStyles()):(P&&P.classList.remove("embedded"),z.addFullScreenStyles())}})},{"../../core/component":136}],108:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../lib/three"),P=V("../../utils/debug"),L=P("components:fog:warn");re.exports.Component=E("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},update:function(){var C=this.data,M=this.el,I=this.el.object3D.fog;if(!M.isScene){L("Fog component can only be applied to <a-scene>");return}if(!I||C.type!==I.name){M.object3D.fog=k(C),M.systems.material.updateMaterials();return}Object.keys(this.schema).forEach(function(b){var T=C[b];b==="color"&&(T=new z.Color(T)),I[b]=T})},remove:function(){var C=this.el.object3D.fog;!C||(C.far=0,C.near=.1)}});function k(C){var M;return C.type==="exponential"?M=new z.FogExp2(C.color,C.density):M=new z.Fog(C.color,C.near,C.far),M.name=C.type,M}},{"../../core/component":136,"../../lib/three":184,"../../utils/debug":208}],109:[function(V,re,ae){(function(E){var z=V("../../constants").AFRAME_INJECTED,P=V("../../../package"),L=V("../../core/component").registerComponent,k=V("../../utils/");function C(_){var D=_.split(".");return D[2]="x",D.join(".")}var M="https://aframe.io/aframe-inspector/dist/aframe-inspector.js",I="https://unpkg.com/aframe-inspector@"+C(P.version)+"/dist/aframe-inspector.min.js",b=E.env.INSPECTOR_VERSION==="dev"?M:I,T="Loading Inspector",A="Error loading Inspector";re.exports.Component=L("inspector",{schema:{url:{default:b}},init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var _;!this.firstPlay||(_=k.getUrlParameter("inspector"),_!=="false"&&!!_&&(this.openInspector(),this.firstPlay=!1))},initOverlay:function(){var _='<span class="dots"><span>.</span><span>.</span><span>.</span></span>';this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML=T+_},remove:function(){this.removeEventListeners()},onKeydown:function(_){var D=_.keyCode===73&&(_.ctrlKey&&_.altKey||_.getModifierState("AltGraph"));!D||this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(_){_.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(_){var D=this,B;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){AFRAME.INSPECTOR.open(_);return}this.showLoader(),B=document.createElement("script"),B.src=this.data.url,B.setAttribute("data-name","aframe-inspector"),B.setAttribute(z,""),B.onload=function(){AFRAME.INSPECTOR.open(_),D.hideLoader(),D.removeEventListeners()},B.onerror=function(){D.loadingMessageEl.innerHTML=A},document.head.appendChild(B),AFRAME.inspectorInjected=!0},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})}).call(this,V("_process"))},{"../../../package":74,"../../constants":128,"../../core/component":136,"../../utils/":212,_process:49}],110:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../utils/").shouldCaptureKeyEvent;re.exports.Component=E("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(P){var L=this.data;this.enterVREnabled=L.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(P){var L=this.el;!z(P)||(this.enterVREnabled&&P.keyCode===70&&L.enterVR(),this.enterVREnabled&&P.keyCode===27&&L.exitVR())}})},{"../../core/component":136,"../../utils/":212}],111:[function(V,re,ae){var E=V("../../utils/debug"),z=V("../../core/component").registerComponent,P=E("components:pool:warn");re.exports.Component=z("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},multiple:!0,initPool:function(){var L;for(this.availableEls=[],this.usedEls=[],this.data.mixin||P("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||P("Container "+this.data.container+" not found.")),this.container=this.container||this.el,L=0;L<this.data.size;++L)this.createEntity()},update:function(L){var k=this.data;(L.mixin!==k.mixin||L.size!==k.size)&&this.initPool()},createEntity:function(){var L;L=document.createElement("a-entity"),L.play=this.wrapPlay(L.play),L.setAttribute("mixin",this.data.mixin),L.object3D.visible=!1,L.pause(),this.container.appendChild(L),this.availableEls.push(L)},wrapPlay:function(L){var k=this.usedEls;return function(){k.indexOf(this)!==-1&&L.call(this)}},requestEntity:function(){var L;if(this.availableEls.length===0){if(this.data.dynamic===!1){P("Requested entity from empty pool: "+this.attrName);return}else P("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName);this.createEntity()}return L=this.availableEls.shift(),this.usedEls.push(L),L.object3D.visible=!0,L},returnEntity:function(L){var k=this.usedEls.indexOf(L);if(k===-1){P("The returned entity was not previously pooled from "+this.attrName);return}return this.usedEls.splice(k,1),this.availableEls.push(L),L.object3D.visible=!1,L.pause(),L}})},{"../../core/component":136,"../../utils/debug":208}],112:[function(V,re,ae){var E=V("../../core/component").registerComponent;function z(P,L,k,C){var M=Math.max(P.primaryLightIntensity.x,Math.max(P.primaryLightIntensity.y,P.primaryLightIntensity.z));L.sh.fromArray(P.sphericalHarmonicsCoefficients),L.intensity=1,k&&(k.color.setRGB(P.primaryLightIntensity.x/M,P.primaryLightIntensity.y/M,P.primaryLightIntensity.z/M),k.intensity=M,C.copy(P.primaryLightDirection))}re.exports.Component=E("reflection",{schema:{directionalLight:{type:"selector"}},init:function(){var P=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var L=this.el.getAttribute("webxr"),k=L.optionalFeatures;k.includes("light-estimation")||(k.push("light-estimation"),this.el.setAttribute("webxr",L)),this.el.addEventListener("enter-vr",function(){var C=P.el.renderer,M=C.xr.getSession();M.requestLightProbe&&P.el.is("ar-mode")&&P.startLightProbe()}),this.el.addEventListener("exit-vr",function(){P.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var P=this.el.renderer,L=P.xr.getSession(),k=this,C=P.getContext();if(!this.probeLight){var M=document.createElement("a-light");M.setAttribute("type","probe"),M.setAttribute("intensity",0),this.el.appendChild(M),this.probeLight=M}switch(L.preferredReflectionFormat){case"srgba8":C.getExtension("EXT_sRGB");break;case"rgba16f":C.getExtension("OES_texture_half_float");break}this.glBinding=new XRWebGLBinding(L,C),C.getExtension("EXT_sRGB"),C.getExtension("OES_texture_half_float"),L.requestLightProbe().then(function(I){k.xrLightProbe=I,I.addEventListener("reflectionchange",k.updateXRCubeMap.bind(k))}).catch(function(I){console.warn("Lighting estimation not supported: "+I.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var P=this.el.renderer,L=this.glBinding.getReflectionCubeMap(this.xrLightProbe);if(L){var k=P.properties.get(this.lightingEstimationTexture);k.__webglTexture=L,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture}},tick:function(){var P=this.el.object3D,L=this.el.renderer,k=this.el.frame;if(k&&this.xrLightProbe){var C=k.getLightEstimate(this.xrLightProbe);C&&z(C,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(P.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(L,P),this.el.object3D.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&k&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.removeChild(this.probeLight)}})},{"../../core/component":136}],113:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../lib/three"),P=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),L=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`);re.exports.Component=E("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},init:function(){var k=this.el,C=this;k.renderer?M():k.addEventListener("render-target-loaded",M);function M(){var I=k.renderer.getContext();!I||(C.cubeMapSize=I.getParameter(I.MAX_CUBE_MAP_TEXTURE_SIZE),C.material=new z.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:P,fragmentShader:L,side:z.DoubleSide}),C.quad=new z.Mesh(new z.PlaneBufferGeometry(1,1),C.material),C.quad.visible=!1,C.camera=new z.OrthographicCamera(-1/2,1/2,1/2,-1/2,-1e4,1e4),C.canvas=document.createElement("canvas"),C.ctx=C.canvas.getContext("2d"),k.object3D.add(C.quad),C.onKeyDown=C.onKeyDown.bind(C))}},getRenderTarget:function(k,C){return new z.WebGLRenderTarget(k,C,{encoding:z.sRGBEncoding,minFilter:z.LinearFilter,magFilter:z.LinearFilter,wrapS:z.ClampToEdgeWrapping,wrapT:z.ClampToEdgeWrapping,format:z.RGBAFormat,type:z.UnsignedByteType})},resize:function(k,C){this.quad.scale.set(k,C,1),this.camera.left=-1*k/2,this.camera.right=k/2,this.camera.top=C/2,this.camera.bottom=-1*C/2,this.camera.updateProjectionMatrix(),this.canvas.width=k,this.canvas.height=C},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(k){var C=k.keyCode===83&&k.ctrlKey&&k.altKey;if(!(!this.data||!C)){var M=k.shiftKey?"equirectangular":"perspective";this.capture(M)}},setCapture:function(k){var C=this.el,M,I,b,T;return k==="perspective"?(this.quad.visible=!1,I=this.data.camera&&this.data.camera.components.camera.camera||C.camera,M={width:this.data.width,height:this.data.height}):(I=this.camera,T=new z.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:z.RGBFormat,generateMipmaps:!0,minFilter:z.LinearMipmapLinearFilter,encoding:z.sRGBEncoding}),b=new z.CubeCamera(C.camera.near,C.camera.far,T),C.camera.getWorldPosition(b.position),C.camera.getWorldQuaternion(b.quaternion),b.update(C.renderer,C.object3D),this.quad.material.uniforms.map.value=b.renderTarget.texture,M={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:I,size:M,projection:k}},capture:function(k){var C=this.el.renderer.xr.enabled,M=this.el.renderer,I;M.xr.enabled=!1,I=this.setCapture(k),this.renderCapture(I.camera,I.size,I.projection),this.saveCapture(),M.xr.enabled=C},getCanvas:function(k){var C=this.el.renderer.xr.enabled,M=this.el.renderer,I=this.setCapture(k);return M.xr.enabled=!1,this.renderCapture(I.camera,I.size,I.projection),M.xr.enabled=C,this.canvas},renderCapture:function(k,C,M){var I=this.el.renderer.autoClear,b=this.el,T,A,_,D=b.renderer;A=this.getRenderTarget(C.width,C.height),_=new Uint8Array(4*C.width*C.height),this.resize(C.width,C.height),D.autoClear=!0,D.clear(),D.setRenderTarget(A),D.render(b.object3D,k),D.autoClear=I,D.readRenderTargetPixels(A,0,0,C.width,C.height,_),D.setRenderTarget(null),M==="perspective"&&(_=this.flipPixelsVertically(_,C.width,C.height)),T=new ImageData(new Uint8ClampedArray(_),C.width,C.height),this.quad.visible=!1,this.ctx.putImageData(T,0,0)},flipPixelsVertically:function(k,C,M){for(var I=k.slice(0),b=0;b<C;++b)for(var T=0;T<M;++T)I[b*4+T*C*4]=k[b*4+(M-T)*C*4],I[b*4+1+T*C*4]=k[b*4+1+(M-T)*C*4],I[b*4+2+T*C*4]=k[b*4+2+(M-T)*C*4],I[b*4+3+T*C*4]=k[b*4+3+(M-T)*C*4];return I},saveCapture:function(){this.canvas.toBlob(function(k){var C="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",M=document.createElement("a"),I=URL.createObjectURL(k);M.href=I,M.setAttribute("download",C),M.innerHTML="downloading...",M.style.display="none",document.body.appendChild(M),setTimeout(function(){M.click(),document.body.removeChild(M)},1)},"image/png")}})},{"../../core/component":136,"../../lib/three":184}],114:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../../vendor/rStats"),P=V("../../utils");V("../../../vendor/rStats.extras"),V("../../lib/rStatsAframe");var L=window.aframeStats,k=P.bind,C="a-hidden",M=window.threeStats;re.exports.Component=E("stats",{schema:{default:!0},init:function(){var b=this.el;P.getUrlParameter("stats")!=="false"&&(this.stats=I(b),this.statsEl=document.querySelector(".rs-base"),this.hideBound=k(this.hide,this),this.showBound=k(this.show,this),b.addEventListener("enter-vr",this.hideBound),b.addEventListener("exit-vr",this.showBound))},update:function(){if(!!this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var b=this.stats;!b||(b("rAF").tick(),b("FPS").frame(),b().update())},hide:function(){this.statsEl.classList.add(C)},show:function(){this.statsEl.classList.remove(C)}});function I(b){var T=new M(b.renderer),A=new L(b),_=b.isMobile?[]:[T,A];return new z({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:_})}},{"../../../vendor/rStats":224,"../../../vendor/rStats.extras":223,"../../core/component":136,"../../lib/rStatsAframe":183,"../../utils":212}],115:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../constants/"),P=V("../../utils/"),L=P.bind,k="a-enter-vr",C="a-enter-ar",M="a-enter-vr-button",I="a-enter-ar-button",b="a-hidden",T="a-orientation-modal";re.exports.Component=E("vr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterARButton:{default:""}},init:function(){var $=this,j=this.el;P.getUrlParameter("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),j.addEventListener("enter-vr",this.updateEnterInterfaces),j.addEventListener("exit-vr",this.updateEnterInterfaces),j.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(q){q.data.type==="loaderReady"&&($.insideLoader=!0,$.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=L(this.onEnterVRButtonClick,this),this.onEnterARButtonClick=L(this.onEnterARButtonClick,this),this.onModalClick=L(this.onModalClick,this),this.toggleOrientationModalIfNeeded=L(this.toggleOrientationModalIfNeeded,this),this.updateEnterInterfaces=L(this.updateEnterInterfaces,this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var $=this.data,j=this.el;if(!$.enabled||this.insideLoader||P.getUrlParameter("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||($.enterVRButton?(this.enterVREl=document.querySelector($.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=A(this.onEnterVRButtonClick),j.appendChild(this.enterVREl)),$.enterARButton?(this.enterAREl=document.querySelector($.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=_(this.onEnterARButtonClick),j.appendChild(this.enterAREl)),this.orientationModalEl=D(this.onModalClick),j.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function($){$&&$.parentNode&&$.parentNode.removeChild($)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var $=this.el;!this.enterVREl||($.is("vr-mode")?this.enterVREl.classList.add(b):this.enterVREl.classList.remove(b))},toggleEnterARButtonIfNeeded:function(){var $=this.el;!this.enterAREl||($.is("vr-mode")||!P.device.checkARSupport()?this.enterAREl.classList.add(b):this.enterAREl.classList.remove(b))},toggleOrientationModalIfNeeded:function(){var $=this.el,j=this.orientationModalEl;!j||!$.isMobile||(!P.device.isLandscape()&&$.is("vr-mode")?j.classList.remove(b):j.classList.add(b))}});function A($){var j,q;return q=document.createElement("div"),q.classList.add(k),q.setAttribute(z.AFRAME_INJECTED,""),j=document.createElement("button"),j.className=M,j.setAttribute("title","Enter VR mode with a headset or fullscreen mode on a desktop. Visit https://webvr.rocks or https://webvr.info for more information."),j.setAttribute(z.AFRAME_INJECTED,""),P.device.isMobile()&&B(j),q.appendChild(j),j.addEventListener("click",function(Q){$(),Q.stopPropagation()}),q}function _($){var j,q;return q=document.createElement("div"),q.classList.add(C),q.setAttribute(z.AFRAME_INJECTED,""),j=document.createElement("button"),j.className=I,j.setAttribute("title","Enter AR mode with a headset or handheld device. Visit https://webvr.rocks or https://webvr.info for more information."),j.setAttribute(z.AFRAME_INJECTED,""),P.device.isMobile()&&B(j),q.appendChild(j),j.addEventListener("click",function(Q){$(),Q.stopPropagation()}),q}function D($){var j=document.createElement("div");j.className=T,j.classList.add(b),j.setAttribute(z.AFRAME_INJECTED,"");var q=document.createElement("button");return q.setAttribute(z.AFRAME_INJECTED,""),q.innerHTML="Exit VR",q.addEventListener("click",$),j.appendChild(q),j}function B($){$.addEventListener("touchstart",function(){$.classList.remove("resethover")}),$.addEventListener("touchend",function(){$.classList.add("resethover")})}},{"../../constants/":128,"../../core/component":136,"../../utils/":212}],116:[function(V,re,ae){var E=V("../core/component"),z=V("../lib/three"),P=V("../utils/bind"),L=E.registerComponent;re.exports.Component=L("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=P(this.update,this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var k=this.data;this.updateDescendants(k.cast,k.receive)},remove:function(){var k=this.el;k.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(k,C){var M=this.el.sceneEl;this.el.object3D.traverse(function(I){if(I instanceof z.Mesh&&(I.castShadow=k,I.receiveShadow=C,M.hasLoaded&&I.material))for(var b=Array.isArray(I.material)?I.material:[I.material],T=0;T<b.length;T++)b[T].needsUpdate=!0})}})},{"../core/component":136,"../lib/three":184,"../utils/bind":206}],117:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/debug"),P=V("../lib/three"),L=z("components:sound:warn");re.exports.Component=E("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var k=this;this.listener=null,this.audioLoader=new P.AudioLoader,this.pool=new P.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){k.playSound()}},update:function(k){var C=this.data,M,I,b=C.src!==k.src;if(b){if(!C.src)return;this.setupSound()}for(M=0;M<this.pool.children.length;M++)I=this.pool.children[M],C.positional&&(I.setDistanceModel(C.distanceModel),I.setMaxDistance(C.maxDistance),I.setRefDistance(C.refDistance),I.setRolloffFactor(C.rolloffFactor)),I.setLoop(C.loop),I.setVolume(C.volume),I.isPaused=!1;if(C.on!==k.on&&this.updateEventListener(k.on),b){var T=this;this.loaded=!1,this.audioLoader.load(C.src,function(A){for(M=0;M<T.pool.children.length;M++)I=T.pool.children[M],I.setBuffer(A);T.loaded=!0,P.Cache.remove(C.src),(T.data.autoplay||T.mustPlay)&&T.playSound(),T.el.emit("sound-loaded",T.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var k,C;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(k=0;k<this.pool.children.length;k++)C=this.pool.children[k],C.disconnect()}catch{L("Audio source not properly disconnected")}},updateEventListener:function(k){var C=this.el;k&&C.removeEventListener(k,this.playSoundBound),C.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var k=this.el,C,M=k.sceneEl,I=this,b;this.pool.children.length>0&&(this.stopSound(),k.removeObject3D("sound"));var T=this.listener=M.audioListener||new P.AudioListener;for(M.audioListener=T,M.camera&&M.camera.add(T),M.addEventListener("camera-set-active",function(A){A.detail.cameraEl.getObject3D("camera").add(T)}),this.pool=new P.Group,C=0;C<this.data.poolSize;C++)b=this.data.positional?new P.PositionalAudio(T):new P.Audio(T),this.pool.add(b);for(k.setObject3D(this.attrName,this.pool),C=0;C<this.pool.children.length;C++)b=this.pool.children[C],b.onEnded=function(){this.isPlaying=!1,I.el.emit("sound-ended",I.evtDetail,!1)}},pauseSound:function(){var k,C;for(this.isPlaying=!1,k=0;k<this.pool.children.length;k++)C=this.pool.children[k],!(!C.source||!C.source.buffer||!C.isPlaying||C.isPaused)&&(C.isPaused=!0,C.pause())},playSound:function(k){var C,M,I;if(!this.loaded){L("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0;return}for(C=!1,this.isPlaying=!0,M=0;M<this.pool.children.length;M++)if(I=this.pool.children[M],!I.isPlaying&&I.buffer&&!C){k&&k(I),I.play(),I.isPaused=!1,C=!0;continue}if(!C){L("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1},stopSound:function(){var k,C;for(this.isPlaying=!1,k=0;k<this.pool.children.length;k++){if(C=this.pool.children[k],!C.source||!C.source.buffer)return;C.stop()}}})},{"../core/component":136,"../lib/three":184,"../utils/debug":208}],118:[function(V,re,ae){var E=V("three-bmfont-text"),z=V("load-bmfont"),P=V("../core/component").registerComponent,L=V("../core/shader"),k=V("../lib/three"),C=V("../utils/"),M=C.debug("components:text:error"),I=L.shaders,b=C.debug("components:text:warn"),T=1,A=16,_="https://cdn.aframe.io/fonts/",D={aileronsemibold:_+"Aileron-Semibold.fnt",dejavu:_+"DejaVu-sdf.fnt",exo2bold:_+"Exo2Bold.fnt",exo2semibold:_+"Exo2SemiBold.fnt",kelsonsans:_+"KelsonSans.fnt",monoid:_+"Monoid.fnt",mozillavr:_+"mozillavr.fnt",roboto:_+"Roboto-msdf.json",sourcecodepro:_+"SourceCodePro.fnt"},B=["roboto"],$="roboto";re.exports.FONTS=D;var j=new Ie,q={},Q={},ue=/^\w+:/;re.exports.Component=P("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:$},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:I},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=E(),this.createOrUpdateMaterial()},update:function(Ae){var Ue=this.data,Qe=this.currentFont;if(Q[Ue.font]?this.texture=Q[Ue.font]:(this.texture=Q[Ue.font]=new k.Texture,this.texture.anisotropy=A),this.createOrUpdateMaterial(),Ae.font!==Ue.font){this.updateFont();return}Qe&&(this.updateGeometry(this.geometry,Qe),this.updateLayout())},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var Ae=this.data,Ue,Qe=this.material,ht,lt=this.shaderData,Et;if(Et=Ae.shader,B.indexOf(Ae.font)!==-1||Ae.font.indexOf("-msdf.")>=0?Et="msdf":Ae.font in D&&B.indexOf(Ae.font)===-1&&(Et="sdf"),Ue=(this.shaderObject&&this.shaderObject.name)!==Et,lt.alphaTest=Ae.alphaTest,lt.color=Ae.color,lt.map=this.texture,lt.opacity=Ae.opacity,lt.side=xe(Ae.side),lt.transparent=Ae.transparent,lt.negate=Ae.negate,!Ue){this.shaderObject.update(lt),Qe.transparent=lt.transparent,Qe.side=lt.side;return}ht=pe(this.el,Et,lt),this.material=ht.material,this.shaderObject=ht.shader,this.material.side=lt.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var Ae=this.data,Ue=this.el,Qe,ht=this.geometry,lt=this;Ae.font||b("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),Qe=this.lookupFont(Ae.font||$)||Ae.font,j.get(Qe,function(){return Se(Qe,Ae.yOffset)}).then(function(Mt){var ln;if(Mt.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");q[Qe]||(Mt.widthFactor=q[Mt]=he(Mt)),lt.currentFont=Mt,ln=lt.getFontImageSrc(),j.get(ln,function(){return be(ln)}).then(function(Tn){var xn=lt.texture;xn.image=Tn,xn.needsUpdate=!0,Q[Ae.font]=xn,lt.texture=xn,lt.initMesh(),lt.currentFont=Mt,lt.updateGeometry(ht,Mt),lt.updateLayout(),lt.mesh.visible=!0,Ue.emit("textfontset",{font:Ae.font,fontObj:Mt})}).catch(function(Tn){M(Tn.message),M(Tn.stack)})}).catch(function(Et){M(Et.message),M(Et.stack)})},initMesh:function(){this.mesh||(this.mesh=new k.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var Ae=this.lookupFont(this.data.font||$)||this.data.font,Ue=this.currentFont.pages[0];return Ue.match(ue)&&Ue.indexOf("http")!==0?Ae.replace(/(\.fnt)|(\.json)/,".png"):k.LoaderUtils.extractUrlBase(Ae)+Ue},updateLayout:function(){var Ae,Ue,Qe=this.el,ht=this.data,lt=this.geometry,Et,Mt,ln,Tn=this.mesh,xn,Qn,Cn,Mn,Ar;if(!(!Tn||!lt.layout)){if(Et=Qe.getAttribute("geometry"),Cn=ht.width||Et&&Et.width||T,xn=we(ht.wrapPixels,ht.wrapCount,this.currentFont.widthFactor),Qn=Cn/xn,ln=lt.layout,Mt=Qn*(ln.height+ln.descender),Et&&Et.primitive==="plane"&&(Et.width||Qe.setAttribute("geometry","width",Cn),Et.height||Qe.setAttribute("geometry","height",Mt)),Ae=ht.anchor==="align"?ht.align:ht.anchor,Ae==="left")Mn=0;else if(Ae==="right")Mn=-1*ln.width;else if(Ae==="center")Mn=-1*ln.width/2;else throw new TypeError("Invalid text.anchor property value",Ae);if(Ue=ht.baseline,Ue==="bottom")Ar=0;else if(Ue==="top")Ar=-1*ln.height+ln.ascender;else if(Ue==="center")Ar=-1*ln.height/2;else throw new TypeError("Invalid text.baseline property value",Ue);Tn.position.x=Mn*Qn+ht.xOffset,Tn.position.y=Ar*Qn,Tn.position.z=ht.zOffset,Tn.scale.set(Qn,-1*Qn,Qn)}},lookupFont:function(Ae){return D[Ae]},updateGeometry:function(){var Ae={},Ue={},Qe=/\\n/g,ht=/\\t/g;return function(lt,Et){var Mt=this.data;Ue.font=Et,Ue.lineHeight=Mt.lineHeight&&isFinite(Mt.lineHeight)?Mt.lineHeight:Et.common.lineHeight,Ue.text=Mt.value.toString().replace(Qe,`
`).replace(ht,"	"),Ue.width=we(Mt.wrapPixels,Mt.wrapCount,Et.widthFactor),lt.update(C.extend(Ae,Mt,Ue))}}()});function xe(Ae){switch(Ae){case"back":return k.FrontSide;case"double":return k.DoubleSide;default:return k.BackSide}}function Se(Ae,Ue){return new Promise(function(Qe,ht){z(Ae,function(lt,Et){if(lt){M("Error loading font",Ae),ht(lt);return}Ae.indexOf("/Roboto-msdf.json")>=0&&(Ue=30),Ue&&Et.chars.map(function(ln){ln.yoffset+=Ue}),Qe(Et)})})}function be(Ae){return new Promise(function(Ue,Qe){new k.ImageLoader().load(Ae,function(ht){Ue(ht)},void 0,function(){M("Error loading font image",Ae),Qe(null)})})}function pe(Ae,Ue,Qe){var ht,lt;return lt=new I[Ue].Shader,lt.el=Ae,lt.init(Qe),lt.update(Qe),ht=lt.material,ht.transparent=Qe.transparent,{material:ht,shader:lt}}function we(Ae,Ue,Qe){return Ae||(.5+Ue)*Qe}function he(Ae){var Ue=0,Qe=0,ht=0;return Ae.chars.map(function(lt){Ue+=lt.xadvance,lt.id>=48&&lt.id<=57&&(ht++,Qe+=lt.xadvance)}),ht?Qe/ht:Ue/Ae.chars.length}function Ie(){var Ae=this.cache={};this.get=function(Ue,Qe){return Ue in Ae||(Ae[Ue]=Qe()),Ae[Ue]}}},{"../core/component":136,"../core/shader":146,"../lib/three":184,"../utils/":212,"load-bmfont":37,"three-bmfont-text":64}],119:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/tracked-controls"),P=V("../constants").DEFAULT_CAMERA_HEIGHT,L=V("../lib/three"),k=V("../constants").DEFAULT_HANDEDNESS,C={x:.175,y:-.3,z:-.03},M={x:0,y:0,z:-.175},I={touches:[]},b={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};re.exports.Component=E("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new L.Vector3,this.controllerQuaternion=new L.Quaternion,this.controllerEuler=new L.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(T,A){var _=this.el.getObject3D("mesh");_&&_.update&&_.update(A/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return P},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var T=this.data,A=z.findMatchingControllerWebVR(this.system.controllers,T.id,T.idPrefix,T.hand,T.controller);this.controller=A,this.el.components["tracked-controls"].controller=A,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(T){var A=this.controller,_=this.controllerEuler,D=this.controllerQuaternion,B=this.deltaControllerPosition,$,j,q,Q,ue;j=this.getHeadElement(),q=j.object3D,ue=this.defaultUserHeight(),Q=A.pose,$=(A?A.hand:void 0)||k,T.copy(q.position),B.set(C.x*($==="left"?-1:$==="right"?1:0),C.y,C.z),B.multiplyScalar(ue),B.applyAxisAngle(q.up,q.rotation.y),T.add(B),B.set(M.x,M.y,M.z),B.multiplyScalar(ue),Q.orientation?D.fromArray(Q.orientation):D.copy(q.quaternion),_.setFromQuaternion(D),_.set(_.x,_.y,0),B.applyEuler(_),T.add(B)},updatePose:function(){var T=this.controller,A=this.data,_=this.el.object3D,D,B=this.system.vrDisplay,$;!T||(D=T.pose,D.position?_.position.fromArray(D.position):A.armModel&&this.applyArmModel(_.position),D.orientation&&_.quaternion.fromArray(D.orientation),B&&D.position&&($=this.el.sceneEl.renderer.xr.getStandingMatrix(),_.matrix.compose(_.position,_.quaternion,_.scale),_.matrix.multiplyMatrices($,_.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale)),_.rotateX(this.data.orientationOffset.x*L.Math.DEG2RAD),_.rotateY(this.data.orientationOffset.y*L.Math.DEG2RAD),_.rotateZ(this.data.orientationOffset.z*L.Math.DEG2RAD))},updateButtons:function(){var T,A=this.controller,_;if(!!A){for(_=0;_<A.buttons.length;++_)this.buttonStates[_]||(this.buttonStates[_]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[_]||(this.buttonEventDetails[_]={id:_,state:this.buttonStates[_]}),T=A.buttons[_],this.handleButton(_,T);this.handleAxes()}},handleButton:function(T,A){var _;return _=this.handlePress(T,A)|this.handleTouch(T,A)|this.handleValue(T,A),_?(this.el.emit(b.BUTTONCHANGED,this.buttonEventDetails[T],!1),!0):!1},handleAxes:function(){var T=!1,A=this.controller.axes,_,D=this.axis,B=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),_=0;_<A.length;++_)B.push(D[_]!==A[_]),B[_]&&(T=!0);if(!T)return!1;for(this.axis.splice(0,this.axis.length),_=0;_<A.length;_++)this.axis.push(A[_]);return this.el.emit(b.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(T,A){var _,D=this.buttonStates[T];return A.pressed===D.pressed?!1:(_=A.pressed?b.BUTTONDOWN:b.BUTTONUP,this.el.emit(_,this.buttonEventDetails[T],!1),D.pressed=A.pressed,!0)},handleTouch:function(T,A){var _,D=this.buttonStates[T];return A.touched===D.touched?!1:(_=A.touched?b.TOUCHSTART:b.TOUCHEND,this.el.emit(_,this.buttonEventDetails[T],!1,I),D.touched=A.touched,!0)},handleValue:function(T,A){var _=this.buttonStates[T];return A.value===_.value?!1:(_.value=A.value,!0)}})},{"../constants":128,"../core/component":136,"../lib/three":184,"../utils/tracked-controls":221}],120:[function(V,re,ae){var E=V("../utils/tracked-controls"),z=V("../core/component").registerComponent,P={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};re.exports.Component=z("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var L=this.el.sceneEl;this.updateController(),L.addEventListener("controllersupdated",this.updateController)},pause:function(){var L=this.el.sceneEl;L.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(L){return!(!this.controller||this.controller.gamepad||L.inputSource.handedness!=="none"&&L.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=E.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var L=this.el.sceneEl,k=this.controller,C=L.frame;!k||!L.frame||!this.system.referenceSpace||k.hand||(this.pose=C.getPose(k.targetRaySpace,this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var L=this.el.object3D,k=this.pose;!k||(L.matrix.elements=k.transform.matrix,L.matrix.decompose(L.position,L.rotation,L.scale))},updateButtons:function(){var L,k,C=this.controller,M;if(!(!C||!C.gamepad)){for(M=C.gamepad,k=0;k<M.buttons.length;++k)this.buttonStates[k]||(this.buttonStates[k]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[k]||(this.buttonEventDetails[k]={id:k,state:this.buttonStates[k]}),L=M.buttons[k],this.handleButton(k,L);this.handleAxes()}},handleButton:function(L,k){var C;return C=this.handlePress(L,k)|this.handleTouch(L,k)|this.handleValue(L,k),C?(this.el.emit(P.BUTTONCHANGED,this.buttonEventDetails[L],!1),!0):!1},handleAxes:function(){var L=!1,k=this.controller.gamepad.axes,C,M=this.axis,I=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),C=0;C<k.length;++C)I.push(M[C]!==k[C]),I[C]&&(L=!0);if(!L)return!1;for(this.axis.splice(0,this.axis.length),C=0;C<k.length;C++)this.axis.push(k[C]);return this.el.emit(P.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(L,k){var C,M=this.buttonStates[L];return k.pressed===M.pressed?!1:(C=k.pressed?P.BUTTONDOWN:P.BUTTONUP,this.el.emit(C,this.buttonEventDetails[L],!1),M.pressed=k.pressed,!0)},handleTouch:function(L,k){var C,M=this.buttonStates[L];return k.touched===M.touched?!1:(C=k.touched?P.TOUCHSTART:P.TOUCHEND,this.el.emit(C,this.buttonEventDetails[L],!1),M.touched=k.touched,!0)},handleValue:function(L,k){var C=this.buttonStates[L];return k.value===C.value?!1:(C.value=k.value,!0)}})},{"../core/component":136,"../utils/tracked-controls":221}],121:[function(V,re,ae){var E=V("../core/component").registerComponent;re.exports.Component=E("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1}},update:function(){var z=this.data,P=this.el;P.sceneEl.hasWebXR?P.setAttribute("tracked-controls-webxr",{id:z.id,hand:z.hand,index:z.controller,iterateControllerProfiles:z.iterateControllerProfiles,handTrackingEnabled:z.handTrackingEnabled}):P.setAttribute("tracked-controls-webvr",z)}})},{"../core/component":136}],122:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../lib/three"),L=V("../utils/tracked-controls"),k=L.checkControllerPresentAndSetup,C=L.emitIfAxesChanged,M=L.onButtonEvent,I="https://cdn.aframe.io/controllers/valve/index/valve-index-",b={left:I+"left.glb",right:I+"right.glb"},T="valve",A=V("../utils/").device.isWebXRAvailable,_={left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}},D={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},B={left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},$={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},j=A?$:B,q=A?D:_;re.exports.Component=E("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var Q=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(ue){M(ue.detail.id,"down",Q)},this.onButtonUp=function(ue){M(ue.detail.id,"up",Q)},this.onButtonTouchEnd=function(ue){M(ue.detail.id,"touchend",Q)},this.onButtonTouchStart=function(ue){M(ue.detail.id,"touchstart",Q)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},addEventListeners:function(){var Q=this.el;Q.addEventListener("buttonchanged",this.onButtonChanged),Q.addEventListener("buttondown",this.onButtonDown),Q.addEventListener("buttonup",this.onButtonUp),Q.addEventListener("touchend",this.onButtonTouchEnd),Q.addEventListener("touchstart",this.onButtonTouchStart),Q.addEventListener("model-loaded",this.onModelLoaded),Q.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var Q=this.el;Q.removeEventListener("buttonchanged",this.onButtonChanged),Q.removeEventListener("buttondown",this.onButtonDown),Q.removeEventListener("buttonup",this.onButtonUp),Q.removeEventListener("touchend",this.onButtonTouchEnd),Q.removeEventListener("touchstart",this.onButtonTouchStart),Q.removeEventListener("model-loaded",this.onModelLoaded),Q.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var Q=this.data,ue=Q.hand==="right"?0:Q.hand==="left"?1:2;k(this,T,{index:ue,iterateControllerProfiles:!0,hand:Q.hand})},injectTrackedControls:function(){var Q=this.el,ue=this.data;Q.setAttribute("tracked-controls",{idPrefix:T,controller:ue.hand==="right"?1:ue.hand==="left"?0:2,hand:ue.hand,orientationOffset:ue.orientationOffset}),this.loadModel()},loadModel:function(){var Q=this.data;!Q.model||this.el.setAttribute("gltf-model",""+b[Q.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(Q){var ue=this.mapping.buttons[Q.detail.id],xe=this.buttonMeshes,Se;!ue||(ue==="trigger"&&(Se=Q.detail.state.value,xe&&xe.trigger&&(xe.trigger.rotation.x=this.triggerOriginalRotationX-Se*(Math.PI/40))),this.el.emit(ue+"changed",Q.detail.state))},onModelLoaded:function(Q){var ue,xe=Q.detail.model,Se=this;!this.data.model||(ue=this.buttonMeshes={},ue.grip={left:xe.getObjectByName("leftgrip"),right:xe.getObjectByName("rightgrip")},ue.menu=xe.getObjectByName("menubutton"),ue.system=xe.getObjectByName("systembutton"),ue.trackpad=xe.getObjectByName("touchpad"),ue.trigger=xe.getObjectByName("trigger"),this.triggerOriginalRotationX=ue.trigger.rotation.x,Object.keys(ue).forEach(function(be){Se.setButtonColor(be,Se.data.buttonColor)}),xe.position.copy(q[this.data.hand]),xe.rotation.copy(j[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controlls",model:this.data.model,rayOrigin:new P.Vector3(0,0,0)}))},onAxisMoved:function(Q){C(this,this.mapping.axes,Q)},updateModel:function(Q,ue){var xe,Se;!this.data.model||(Se=ue.indexOf("touch")!==-1,!Se&&(xe=ue==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(Q,xe)))},setButtonColor:function(Q,ue){}})},{"../core/component":136,"../lib/three":184,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],123:[function(V,re,ae){var E=V("../core/component").registerComponent;re.exports.Component=E("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},{"../core/component":136}],124:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M="https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj",I="https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl",b=V("../utils/").device.isWebXRAvailable,T="htc-vive",A="OpenVR ",_=b?T:A,D={axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},B={axes:{thumbstick:[0,1]},buttons:["trigger","grip","trackpad","none","menu"]},$=b?B:D;re.exports.Component=E("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:$,init:function(){var j=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(q){C(q.detail.id,"down",j)},this.onButtonUp=function(q){C(q.detail.id,"up",j)},this.onButtonTouchEnd=function(q){C(q.detail.id,"touchend",j)},this.onButtonTouchStart=function(q){C(q.detail.id,"touchstart",j)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var j=this.data;this.controllerIndex=j.hand==="right"?0:j.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},addEventListeners:function(){var j=this.el;j.addEventListener("buttonchanged",this.onButtonChanged),j.addEventListener("buttondown",this.onButtonDown),j.addEventListener("buttonup",this.onButtonUp),j.addEventListener("touchend",this.onButtonTouchEnd),j.addEventListener("touchstart",this.onButtonTouchStart),j.addEventListener("model-loaded",this.onModelLoaded),j.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var j=this.el;j.removeEventListener("buttonchanged",this.onButtonChanged),j.removeEventListener("buttondown",this.onButtonDown),j.removeEventListener("buttonup",this.onButtonUp),j.removeEventListener("touchend",this.onButtonTouchEnd),j.removeEventListener("touchstart",this.onButtonTouchStart),j.removeEventListener("model-loaded",this.onModelLoaded),j.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var j=this.data;L(this,_,{index:this.controllerIndex,hand:j.hand})},injectTrackedControls:function(){var j=this.el,q=this.data;j.setAttribute("tracked-controls",{idPrefix:_,hand:q.hand,controller:this.controllerIndex,orientationOffset:q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:M,mtl:I})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(j){var q=this.mapping.buttons[j.detail.id],Q=this.buttonMeshes,ue;!q||(q==="trigger"&&(ue=j.detail.state.value,Q&&Q.trigger&&(Q.trigger.rotation.x=-ue*(Math.PI/12))),this.el.emit(q+"changed",j.detail.state))},onModelLoaded:function(j){var q,Q=j.detail.model,ue=this;!this.data.model||(q=this.buttonMeshes={},q.grip={left:Q.getObjectByName("leftgrip"),right:Q.getObjectByName("rightgrip")},q.menu=Q.getObjectByName("menubutton"),q.system=Q.getObjectByName("systembutton"),q.trackpad=Q.getObjectByName("touchpad"),q.trigger=Q.getObjectByName("trigger"),Object.keys(q).forEach(function(xe){ue.setButtonColor(xe,ue.data.buttonColor)}),Q.position.set(0,-.015,.04))},onAxisMoved:function(j){k(this,this.mapping.axes,j)},updateModel:function(j,q){var Q,ue;!this.data.model||(ue=q.indexOf("touch")!==-1,!ue&&(Q=q==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(j,Q)))},setButtonColor:function(j,q){var Q=this.buttonMeshes,ue=this.rendererSystem;if(!!Q){if(j==="grip"){Q.grip.left.material.color.set(q),Q.grip.right.material.color.set(q),ue.applyColorCorrection(Q.grip.left.material.color),ue.applyColorCorrection(Q.grip.right.material.color);return}Q[j].material.color.set(q),ue.applyColorCorrection(Q[j].material.color)}}})},{"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],125:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M="HTC Vive Focus",I="https://cdn.aframe.io/controllers/vive/focus-controller/focus-controller.gltf";re.exports.Component=E("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=z(this.removeControllersUpdateListener,this),this.onAxisMoved=z(this.onAxisMoved,this)},init:function(){var b=this;this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(T){C(T.detail.id,"down",b)},this.onButtonUp=function(T){C(T.detail.id,"up",b)},this.onButtonTouchStart=function(T){C(T.detail.id,"touchstart",b)},this.onButtonTouchEnd=function(T){C(T.detail.id,"touchend",b)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var b=this.el;b.addEventListener("buttonchanged",this.onButtonChanged),b.addEventListener("buttondown",this.onButtonDown),b.addEventListener("buttonup",this.onButtonUp),b.addEventListener("touchstart",this.onButtonTouchStart),b.addEventListener("touchend",this.onButtonTouchEnd),b.addEventListener("model-loaded",this.onModelLoaded),b.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var b=this.el;b.removeEventListener("buttonchanged",this.onButtonChanged),b.removeEventListener("buttondown",this.onButtonDown),b.removeEventListener("buttonup",this.onButtonUp),b.removeEventListener("touchstart",this.onButtonTouchStart),b.removeEventListener("touchend",this.onButtonTouchEnd),b.removeEventListener("model-loaded",this.onModelLoaded),b.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){L(this,M,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var b=this.el,T=this.data;b.setAttribute("tracked-controls",{armModel:T.armModel,idPrefix:M,orientationOffset:T.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",I)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(b){var T=b.detail.model,A;!this.data.model||(A=this.buttonMeshes={},A.trigger=T.getObjectByName("BumperKey"),A.triggerPressed=T.getObjectByName("BumperKey_Press"),A.triggerPressed&&(A.triggerPressed.visible=!1),A.trackpad=T.getObjectByName("TouchPad"),A.trackpadPressed=T.getObjectByName("TouchPad_Press"),A.trackpadPressed&&(A.trackpadPressed.visible=!1))},onButtonChanged:function(b){var T=this.mapping.buttons[b.detail.id];!T||this.el.emit(T+"changed",b.detail.state)},onAxisMoved:function(b){k(this,this.mapping.axes,b)},updateModel:function(b,T){!this.data.model||this.updateButtonModel(b,T)},updateButtonModel:function(b,T){var A=this.buttonMeshes,_=b+"Pressed";if(!(!A||!A[b]||!A[_])){var D;switch(T){case"down":D=this.data.buttonHighlightColor;break;case"touchstart":D=this.data.buttonTouchedColor;break}D&&A[_].material.color.set(D),A[_].visible=!!D,A[b].visible=!D}}})},{"../core/component":136,"../utils/bind":206,"../utils/tracked-controls":221}],126:[function(V,re,ae){var E=V("../constants").keyboardevent.KEYCODE_TO_CODE,z=V("../core/component").registerComponent,P=V("../lib/three"),L=V("../utils/"),k=L.bind,C=L.shouldCaptureKeyEvent,M=1e-5,I=.2,b=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];re.exports.Component=z("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},init:function(){this.keys={},this.easing=1.1,this.velocity=new P.Vector3,this.onBlur=k(this.onBlur,this),this.onContextMenu=k(this.onContextMenu,this),this.onFocus=k(this.onFocus,this),this.onKeyDown=k(this.onKeyDown,this),this.onKeyUp=k(this.onKeyUp,this),this.onVisibilityChange=k(this.onVisibilityChange,this),this.attachVisibilityEventListeners()},tick:function(A,_){var D=this.data,B=this.el,$=this.velocity;!$[D.adAxis]&&!$[D.wsAxis]&&T(this.keys)||(_=_/1e3,this.updateVelocity(_),!(!$[D.adAxis]&&!$[D.wsAxis])&&B.object3D.position.add(this.getMovementVector(_)))},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(A){var _,D,B,$=this.data,j=this.keys,q=this.velocity,Q,ue;if(D=$.adAxis,Q=$.wsAxis,A>I){q[D]=0,q[Q]=0;return}var xe=Math.pow(1/this.easing,A*60);q[D]!==0&&(q[D]=q[D]*xe),q[Q]!==0&&(q[Q]=q[Q]*xe),Math.abs(q[D])<M&&(q[D]=0),Math.abs(q[Q])<M&&(q[Q]=0),$.enabled&&(_=$.acceleration,$.adEnabled&&(B=$.adInverted?-1:1,(j.KeyA||j.ArrowLeft)&&(q[D]-=B*_*A),(j.KeyD||j.ArrowRight)&&(q[D]+=B*_*A)),$.wsEnabled&&(ue=$.wsInverted?-1:1,(j.KeyW||j.ArrowUp)&&(q[Q]-=ue*_*A),(j.KeyS||j.ArrowDown)&&(q[Q]+=ue*_*A)))},getMovementVector:function(){var A=new P.Vector3(0,0,0),_=new P.Euler(0,0,0,"YXZ");return function(D){var B=this.el.getAttribute("rotation"),$=this.velocity,j;return A.copy($),A.multiplyScalar(D),B&&(j=this.data.fly?B.x:0,_.set(P.Math.degToRad(j),P.Math.degToRad(B.y),0),A.applyEuler(_)),A}}(),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var A=Object.keys(this.keys),_=0;_<A.length;_++)delete this.keys[A[_]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(A){var _;!C(A)||(_=A.code||E[A.keyCode],b.indexOf(_)!==-1&&(this.keys[_]=!0))},onKeyUp:function(A){var _;_=A.code||E[A.keyCode],delete this.keys[_]}});function T(A){var _;for(_ in A)return!1;return!0}},{"../constants":128,"../core/component":136,"../lib/three":184,"../utils/":212}],127:[function(V,re,ae){var E=V("../core/component").registerComponent,z=V("../utils/bind"),P=V("../utils/tracked-controls"),L=P.checkControllerPresentAndSetup,k=P.emitIfAxesChanged,C=P.onButtonEvent,M=V("../utils/"),I=M.debug("components:windows-motion-controls:debug"),b=M.debug("components:windows-motion-controls:warn"),T=V("../constants").DEFAULT_HANDEDNESS,A="https://cdn.aframe.io/controllers/microsoft/",_={left:"left.glb",right:"right.glb",default:"universal.glb"},D=V("../utils/").device.isWebXRAvailable,B="windows-mixed-reality",$="Spatial Controller (Spatial Interaction Source) ",j=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,q=D?B:$,Q={axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},ue={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},xe=D?ue:Q;re.exports.Component=E("windows-motion-controls",{schema:{hand:{default:T},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},mapping:xe,bindMethods:function(){this.onModelError=z(this.onModelError,this),this.onModelLoaded=z(this.onModelLoaded,this),this.onControllersUpdate=z(this.onControllersUpdate,this),this.checkIfControllerPresent=z(this.checkIfControllerPresent,this),this.onAxisMoved=z(this.onAxisMoved,this)},init:function(){var Se=this,be=this.el;this.onButtonChanged=z(this.onButtonChanged,this),this.onButtonDown=function(pe){C(pe.detail.id,"down",Se)},this.onButtonUp=function(pe){C(pe.detail.id,"up",Se)},this.onButtonTouchStart=function(pe){C(pe.detail.id,"touchstart",Se)},this.onButtonTouchEnd=function(pe){C(pe.detail.id,"touchend",Se)},this.onControllerConnected=function(){Se.setModelVisibility(!0)},this.onControllerDisconnected=function(){Se.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},be.addEventListener("controllerconnected",this.onControllerConnected),be.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var Se=this.el;Se.addEventListener("buttonchanged",this.onButtonChanged),Se.addEventListener("buttondown",this.onButtonDown),Se.addEventListener("buttonup",this.onButtonUp),Se.addEventListener("touchstart",this.onButtonTouchStart),Se.addEventListener("touchend",this.onButtonTouchEnd),Se.addEventListener("axismove",this.onAxisMoved),Se.addEventListener("model-error",this.onModelError),Se.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var Se=this.el;Se.removeEventListener("buttonchanged",this.onButtonChanged),Se.removeEventListener("buttondown",this.onButtonDown),Se.removeEventListener("buttonup",this.onButtonUp),Se.removeEventListener("touchstart",this.onButtonTouchStart),Se.removeEventListener("touchend",this.onButtonTouchEnd),Se.removeEventListener("axismove",this.onAxisMoved),Se.removeEventListener("model-error",this.onModelError),Se.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){L(this,q,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var Se=this.createControllerModelUrl();this.loadModel(Se)},createControllerModelUrl:function(Se){var be=this.el.components["tracked-controls"],pe=be?be.controller:null,we="default",he=this.data.hand,Ie;if(pe&&!window.hasNativeWebXRImplementation&&(he=pe.hand,!Se)){var Ae=pe.id.match(j);we=Ae&&Ae[0]||we}return Ie=_[he]||_.default,A+we+"/"+Ie},injectTrackedControls:function(){var Se=this.data;this.el.setAttribute("tracked-controls",{idPrefix:q,controller:Se.pair,hand:Se.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(Se){var be=this.createControllerModelUrl(!0);Se.detail.src!==be?(b("Failed to load controller model for device, attempting to load default."),this.loadModel(be)):b("Failed to load default controller model.")},loadModel:function(Se){this.el.setAttribute("gltf-model","url("+Se+")")},onModelLoaded:function(Se){var be=this.controllerModel=Se.detail.model,pe=this.loadedMeshInfo,we,he,Ie,Ae;if(I("Processing model"),pe.buttonMeshes={},pe.axisMeshes={},be){for(we=0;we<this.mapping.buttons.length;we++){if(he=this.mapping.buttonMeshNames[this.mapping.buttons[we]],!he){I("Skipping unknown button at index: "+we+" with mapped name: "+this.mapping.buttons[we]);continue}if(Ie=be.getObjectByName(he),!Ie){b("Missing button mesh with name: "+he);continue}Ae={index:we,value:Ue(Ie,"VALUE"),pressed:Ue(Ie,"PRESSED"),unpressed:Ue(Ie,"UNPRESSED")},Ae.value&&Ae.pressed&&Ae.unpressed?pe.buttonMeshes[this.mapping.buttons[we]]=Ae:b("Missing button submesh under mesh with name: "+he+"(VALUE: "+!!Ae.value+", PRESSED: "+!!Ae.pressed+", UNPRESSED:"+!!Ae.unpressed+")")}for(we=0;we<this.mapping.axisMeshNames.length;we++){if(he=this.mapping.axisMeshNames[we],!he){I("Skipping unknown axis at index: "+we);continue}if(Ie=be.getObjectByName(he),!Ie){b("Missing axis mesh with name: "+he);continue}Ae={index:we,value:Ue(Ie,"VALUE"),min:Ue(Ie,"MIN"),max:Ue(Ie,"MAX")},Ae.value&&Ae.min&&Ae.max?pe.axisMeshes[we]=Ae:b("Missing axis submesh under mesh with name: "+he+"(VALUE: "+!!Ae.value+", MIN: "+!!Ae.min+", MAX:"+!!Ae.max+")")}this.calculateRayOriginFromMesh(be),this.setModelVisibility()}I("Model load complete.");function Ue(Qe,ht){for(var lt=0,Et=Qe.children.length;lt<Et;lt++){var Mt=Qe.children[lt];if(Mt&&Mt.name===ht)return Mt}}},calculateRayOriginFromMesh:function(){var Se=new THREE.Quaternion;return function(be){var pe;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,pe=be.getObjectByName(this.mapping.pointingPoseMeshName),pe){var we=be.parent;we&&(be.parent=null,be.updateMatrixWorld(!0),be.parent=we),pe.getWorldPosition(this.rayOrigin.origin),pe.getWorldQuaternion(Se),this.rayOrigin.direction.applyQuaternion(Se),we&&be.updateMatrixWorld(!0)}else I("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var Se=new THREE.Quaternion;return function(be,pe){var we=this.loadedMeshInfo.axisMeshes[be];if(!!we){var he=we.min,Ie=we.max,Ae=we.value,Ue=pe*.5+.5;Ae.setRotationFromQuaternion(Se.copy(he.quaternion).slerp(Ie.quaternion,Ue)),Ae.position.lerpVectors(he.position,Ie.position,Ue)}}}(),lerpButtonTransform:function(){var Se=new THREE.Quaternion;return function(be,pe){var we=this.loadedMeshInfo.buttonMeshes[be];if(!!we){var he=we.unpressed,Ie=we.pressed,Ae=we.value;Ae.setRotationFromQuaternion(Se.copy(he.quaternion).slerp(Ie.quaternion,pe)),Ae.position.lerpVectors(he.position,Ie.position,pe)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(Se){var be=this.mapping.buttons[Se.detail.id];be&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(be,Se.detail.state.value),this.el.emit(be+"changed",Se.detail.state))},onAxisMoved:function(Se){var be=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var pe=0;pe<be;pe++)this.lerpAxisTransform(pe,Se.detail.axis[pe]||0);k(this,this.mapping.axes,Se)},setModelVisibility:function(Se){var be=this.el.getObject3D("mesh");Se=Se!==void 0?Se:this.modelVisible,this.modelVisible=Se,be&&(be.visible=Se)}})},{"../constants":128,"../core/component":136,"../utils/":212,"../utils/bind":206,"../utils/tracked-controls":221}],128:[function(V,re,ae){re.exports={AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:V("./keyboardevent")}},{"./keyboardevent":129}],129:[function(V,re,ae){re.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},{}],130:[function(V,re,ae){var E=V("./a-node"),z=V("../utils/bind"),P=V("../utils/debug"),L=V("./a-register-element").registerElement,k=V("../lib/three"),C=new k.FileLoader,M=P("core:a-assets:warn");re.exports=L("a-assets",{prototype:Object.create(E.prototype,{createdCallback:{value:function(){this.isAssets=!0,this.fileLoader=C,this.timeout=null}},attachedCallback:{value:function(){var B=this,$,j=[],q,Q,ue,xe,Se;if(!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(xe=this.querySelectorAll("img"),$=0;$<xe.length;$++)ue=b(xe[$]),j.push(new Promise(function(be,pe){k.Cache.add(xe[$].getAttribute("src"),ue),ue.onload=be,ue.onerror=pe}));for(Q=this.querySelectorAll("audio, video"),$=0;$<Q.length;$++)q=b(Q[$]),!q.src&&!q.srcObject&&M("Audio/video asset has neither `src` nor `srcObject` attributes."),j.push(I(q));Promise.all(j).then(z(this.load,this)),Se=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){B.hasLoaded||(M("Asset loading timed out in ",Se,"ms"),B.emit("timeout"),B.load())},Se)}},detachedCallback:{value:function(){this.timeout&&clearTimeout(this.timeout)}},load:{value:function(){E.prototype.load.call(this,null,function($){return $.isAssetItem&&$.hasAttribute("src")})}}})}),L("a-asset-item",{prototype:Object.create(E.prototype,{createdCallback:{value:function(){this.data=null,this.isAssetItem=!0}},attachedCallback:{value:function(){var B=this,$=this.getAttribute("src");C.setResponseType(this.getAttribute("response-type")||_($)),C.load($,function(q){B.data=q,setTimeout(function(){E.prototype.load.call(B)})},function(q){B.emit("progress",{loadedBytes:q.loaded,totalBytes:q.total,xhr:q})},function(q){B.emit("error",{xhr:q})})}}})});function I(B){if(!(!B.hasAttribute("autoplay")&&B.getAttribute("preload")!=="auto"))return new Promise(function($,j){if(B.readyState===4)return $();if(B.error)return j();B.addEventListener("loadeddata",q,!1),B.addEventListener("progress",q,!1),B.addEventListener("error",j,!1);function q(){for(var Q=0,ue=0;ue<B.buffered.length;ue++)Q+=B.buffered.end(ue)-B.buffered.start(ue);Q>=B.duration&&(B.tagName==="VIDEO"&&k.Cache.add(B.getAttribute("src"),B),$())}})}function b(B){var $=T(B);return $.tagName&&$.tagName.toLowerCase()==="video"&&($.setAttribute("playsinline",""),$.setAttribute("webkit-playsinline","")),$!==B&&(B.parentNode.appendChild($),B.parentNode.removeChild(B)),$}function T(B){var $,j;return B.hasAttribute("crossorigin")||(j=B.getAttribute("src"),j!==null&&(j.indexOf("://")===-1||A(j)===window.location.host))?B:(M('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',j),B.crossOrigin="anonymous",$=B.cloneNode(!0),$)}function A(B){var $=B.indexOf("://")>-1?B.split("/")[2]:B.split("/")[0];return $.substring(0,$.indexOf(":"))}function _(B){var $=D(B),j=$.lastIndexOf(".");if(j>=0){var q=$.slice(j,B.search(/\?|#|$/));if(q===".glb")return"arraybuffer"}return"text"}re.exports.inferResponseType=_;function D(B){var $=document.createElement("a");$.href=B;var j=$.search.replace(/^\?/,""),q=B.replace(j,"").replace("?","");return q.substring(q.lastIndexOf("/")+1)}re.exports.getFileNameFromURL=D},{"../lib/three":184,"../utils/bind":206,"../utils/debug":208,"./a-node":134,"./a-register-element":135}],131:[function(V,re,ae){var E=V("../utils/debug"),z=V("./a-register-element").registerElement,P=E("core:cubemap:warn");re.exports=z("a-cubemap",{prototype:Object.create(window.HTMLElement.prototype,{attachedCallback:{value:function(){this.srcs=this.validate()},writable:window.debug},validate:{value:function(){var L=this.querySelectorAll("[src]"),k,C=[];if(L.length===6){for(k=0;k<L.length;k++)C.push(L[k].getAttribute("src"));return C}P("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")},writable:window.debug}})})},{"../utils/debug":208,"./a-register-element":135}],132:[function(V,re,ae){var E=V("./a-node"),z=V("./component").components,P=V("./a-register-element").registerElement,L=V("../lib/three"),k=V("../utils/"),C,M=k.debug("core:a-entity:debug"),I=k.debug("core:a-entity:warn"),b="__",T=["position","rotation","scale","visible"],A={once:!0},_=Object.create(E.prototype,{createdCallback:{value:function(){this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new L.Group,this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}},attributeChangedCallback:{value:function(Q,ue,xe){var Se=this.components[Q];if(Se&&Se.justInitialized&&xe===""){delete Se.justInitialized;return}!Se&&xe===null||this.setEntityAttribute(Q,ue,xe)}},attachedCallback:{value:function(){var Q,ue=this.sceneEl,xe=this;if(this.addToParent(),!this.isScene){if(!ue){this.load();return}if(Q=ue.querySelector("a-assets"),Q&&!Q.hasLoaded){Q.addEventListener("loaded",function(){xe.load()});return}this.load()}}},detachedCallback:{value:function(){var Q;if(!!this.parentEl){for(Q in this.components)this.removeComponent(Q,!1);this.isScene||(this.removeFromParent(),E.prototype.detachedCallback.call(this),this.object3D.el=null)}}},getObject3D:{value:function(Q){return this.object3DMap[Q]}},setObject3D:{value:function(Q,ue){var xe,Se=this;if(!(ue instanceof L.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");xe=this.getObject3D(Q),xe&&this.object3D.remove(xe),ue.el=this,ue.children.length&&ue.traverse(function(pe){pe.el=Se}),this.object3D.add(ue),this.object3DMap[Q]=ue,this.emit("object3dset",{object:ue,type:Q})}},removeObject3D:{value:function(Q){var ue=this.getObject3D(Q);if(!ue){I("Tried to remove `Object3D` of type:",Q,"which was not defined.");return}this.object3D.remove(ue),delete this.object3DMap[Q],this.emit("object3dremove",{type:Q})}},getOrCreateObject3D:{value:function(Q,ue){var xe=this.getObject3D(Q);return!xe&&ue&&(xe=new ue,this.setObject3D(Q,xe)),I("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),xe}},add:{value:function(Q){if(!Q.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(Q.object3D),this.emit("child-attached",{el:Q})}},addToParent:{value:function(){var Q=this.parentEl=this.parentNode;!Q||!Q.add||this.attachedToParent||(Q.add(this),this.attachedToParent=!0)}},removeFromParent:{value:function(){var Q=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,Q.emit("child-detached",{el:this})}},load:{value:function(){var Q=this;this.hasLoaded||!this.parentEl||E.prototype.load.call(this,function(){!Q.parentEl||(Q.updateComponents(),(Q.isScene||Q.parentEl.isPlaying)&&Q.play())})},writable:window.debug},remove:{value:function(Q){Q?this.object3D.remove(Q.object3D):this.parentNode.removeChild(this)}},getChildEntities:{value:function(){for(var Q=this.children,ue=[],xe=0;xe<Q.length;xe++){var Se=Q[xe];Se instanceof C&&ue.push(Se)}return ue}},initComponent:{value:function(Q,ue,xe){var Se,be,pe,we,he;if(pe=k.split(Q,b),we=pe[0],be=pe.length>2?pe.slice(1).join("__"):pe[1],!!z[we]&&(he=D(this,Q)||ue!==void 0,!(!he&&!xe)&&!(Q in this.components))){if(this.initComponentDependencies(we),be&&!z[we].multiple)throw new Error("Trying to initialize multiple components of type `"+we+"`. There can only be one component of this type per entity.");Se=new z[we].Component(this,ue,be),this.isPlaying&&Se.play(),this.hasAttribute(Q)||(Se.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,Q,"")),M("Component initialized: %s",Q)}},writable:window.debug},initComponentDependencies:{value:function(Q){var ue=this,xe=z[Q],Se,be;if(!!xe&&(Se=z[Q].dependencies,!!Se))for(be=0;be<Se.length;be++)ue.initComponent(Se[be],window.HTMLElement.prototype.getAttribute.call(ue,Se[be])||void 0,!0)}},removeComponent:{value:function(Q,ue){var xe;if(xe=this.components[Q],!!xe){if(!xe.initialized){this.addEventListener("componentinitialized",function Se(be){be.detail.name===Q&&(this.removeComponent(Q,ue),this.removeEventListener("componentinitialized",Se))});return}xe.pause(),xe.remove(),ue&&(xe.destroy(),delete this.components[Q]),this.emit("componentremoved",xe.evtDetail,!1)}},writable:window.debug},updateComponents:{value:function(){var Q,ue,xe,Se,be=this.componentsToUpdate;if(!!this.hasLoaded){for(xe=0;xe<this.mixinEls.length;xe++)for(Se in this.mixinEls[xe].componentCache)j(Se)&&(be[Se]=!0);if(this.getExtraComponents){ue=this.getExtraComponents();for(Se in ue)j(Se)&&(be[Se]=!0)}for(xe=0;xe<this.attributes.length;++xe)Se=this.attributes[xe].name,T.indexOf(Se)===-1&&j(Se)&&(be[Se]=!0);for(xe=0;xe<T.length;xe++)Se=T[xe],this.hasAttribute(Se)&&this.updateComponent(Se,this.getDOMAttribute(Se));for(Se in be)Q=$(this.getDOMAttribute(Se),ue&&ue[Se]),this.updateComponent(Se,Q),delete be[Se]}},writable:window.debug},updateComponent:{value:function(Q,ue,xe){var Se=this.components[Q];if(Se){if(ue===null&&!D(this,Q)){this.removeComponent(Q,!0);return}Se.updateProperties(ue,xe);return}this.initComponent(Q,ue,!1)}},removeAttribute:{value:function(Q,ue){var xe=this.components[Q];if(xe&&ue===void 0&&this.removeComponent(Q,!0),xe&&ue!==void 0){xe.resetProperty(ue);return}Q==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,Q)}},play:{value:function(){var Q,ue,xe;if(!(this.isPlaying||!this.hasLoaded)){this.isPlaying=!0;for(xe in this.components)this.components[xe].play();for(Q=this.getChildEntities(),ue=0;ue<Q.length;ue++)Q[ue].play();this.emit("play")}},writable:!0},pause:{value:function(){var Q,ue,xe;if(!!this.isPlaying){this.isPlaying=!1;for(xe in this.components)this.components[xe].pause();for(Q=this.getChildEntities(),ue=0;ue<Q.length;ue++)Q[ue].pause();this.emit("pause")}},writable:!0},setEntityAttribute:{value:function(Q,ue,xe){if(z[Q]||this.components[Q]){this.updateComponent(Q,xe);return}if(Q==="mixin"){if(xe===this.computedMixinStr)return;this.mixinUpdate(xe,ue)}}},mixinUpdate:{value:function(){var Q=[];return function(ue,xe){var Se,be,pe,we,he=this;if(!this.hasLoaded){this.addEventListener("loaded",function(){he.mixinUpdate(ue,xe)},A);return}for(xe=xe||this.getAttribute("mixin"),pe=this.updateMixins(ue,xe),Q.length=0,we=0;we<this.mixinEls.length;we++)for(Se in this.mixinEls[we].componentCache)Q.indexOf(Se)===-1&&(this.components[Se]?this.components[Se].handleMixinUpdate():this.initComponent(Se,null),Q.push(Se));for(we=0;we<pe.oldMixinIds.length;we++)if(be=document.getElementById(pe.oldMixinIds[we]),!!be)for(Se in be.componentCache)Q.indexOf(Se)===-1&&this.components[Se]&&(this.getDOMAttribute(Se)?this.components[Se].handleMixinUpdate():this.removeComponent(Se,!0))}}()},setAttribute:{value:function(){var Q={};return function(ue,xe,Se){var be,pe,we,he,Ie,Ae;if(he=ue.indexOf(b),we=he>0?ue.substring(0,he):ue,!z[we]){ue==="mixin"&&this.mixinUpdate(xe),E.prototype.setAttribute.call(this,ue,xe);return}if(!this.components[ue]&&this.hasAttribute(ue)&&this.updateComponent(ue,window.HTMLElement.prototype.getAttribute.call(this,ue)),typeof Se<"u"&&typeof xe=="string"&&xe.length>0&&typeof k.styleParser.parse(xe)=="string"){for(Ae in Q)delete Q[Ae];be=Q,be[xe]=Se,pe=!1}else be=xe,pe=Se===!0;this.updateComponent(ue,be,pe),Ie=this.sceneEl&&this.sceneEl.getAttribute("debug"),Ie&&this.components[ue].flushToDOM()}}(),writable:window.debug},flushToDOM:{value:function(Q){var ue=this.components,xe,Se=this.children,be,pe;for(pe in ue)ue[pe].flushToDOM();if(!!Q)for(be=0;be<Se.length;++be)xe=Se[be],xe.flushToDOM&&xe.flushToDOM(Q)}},getAttribute:{value:function(Q){var ue;return Q==="position"?this.object3D.position:Q==="rotation"?q(this):Q==="scale"?this.object3D.scale:Q==="visible"?this.object3D.visible:(ue=this.components[Q],ue?ue.data:window.HTMLElement.prototype.getAttribute.call(this,Q))},writable:window.debug},getDOMAttribute:{value:function(Q){var ue=this.components[Q];return ue?ue.attrValue:window.HTMLElement.prototype.getAttribute.call(this,Q)},writable:window.debug},addState:{value:function(Q){this.is(Q)||(this.states.push(Q),this.emit("stateadded",Q))}},removeState:{value:function(Q){var ue=this.states.indexOf(Q);ue!==-1&&(this.states.splice(ue,1),this.emit("stateremoved",Q))}},is:{value:function(Q){return this.states.indexOf(Q)!==-1}},inspect:{value:function(){this.sceneEl.components.inspector.openInspector(this)}},destroy:{value:function(){var Q;if(this.parentNode){I("Entity can only be destroyed if detached from scenegraph.");return}for(Q in this.components)this.components[Q].destroy()}}});function D(Q,ue){return Q.components[ue]&&Q.components[ue].attrValue?!0:B(ue,Q.mixinEls)}function B(Q,ue){var xe,Se=!1;for(xe=0;xe<ue.length&&(Se=ue[xe].hasAttribute(Q),!Se);++xe);return Se}function $(Q,ue){return ue?ue.constructor===Object?k.extend(ue,k.styleParser.parse(Q||{})):Q||ue:Q}function j(Q){return Q.indexOf(b)!==-1&&(Q=k.split(Q,b)[0]),!!z[Q]}function q(Q){var ue=L.Math.radToDeg,xe=Q.object3D.rotation,Se=Q.rotationObj;return Se.x=ue(xe.x),Se.y=ue(xe.y),Se.z=ue(xe.z),Se}C=P("a-entity",{prototype:_}),re.exports=C},{"../lib/three":184,"../utils/":212,"./a-node":134,"./a-register-element":135,"./component":136}],133:[function(V,re,ae){var E=V("./a-node"),z=V("./a-register-element").registerElement,P=V("./component").components,L=V("../utils"),k="__";re.exports=z("a-mixin",{prototype:Object.create(E.prototype,{createdCallback:{value:function(){this.componentCache={},this.id=this.getAttribute("id"),this.isMixin=!0}},attributeChangedCallback:{value:function(C,M,I){this.cacheAttribute(C,I),this.updateEntities()}},attachedCallback:{value:function(){this.sceneEl=this.closestScene(),this.cacheAttributes(),this.updateEntities(),this.load()}},setAttribute:{value:function(C,M){window.HTMLElement.prototype.setAttribute.call(this,C,M),this.cacheAttribute(C,M)}},cacheAttribute:{value:function(C,M){var I,b;b=L.split(C,k)[0],I=P[b],I&&(M===void 0&&(M=window.HTMLElement.prototype.getAttribute.call(this,C)),this.componentCache[C]=I.parseAttrValueForCache(M))}},getAttribute:{value:function(C){return this.componentCache[C]||window.HTMLElement.prototype.getAttribute.call(this,C)}},cacheAttributes:{value:function(){var C=this.attributes,M,I;for(I=0;I<C.length;I++)M=C[I].name,this.cacheAttribute(M)}},updateEntities:{value:function(){var C,M,I;if(!!this.sceneEl)for(M=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),I=0;I<M.length;I++)C=M[I],!(!C.hasLoaded||C.isMixin)&&C.mixinUpdate(this.id)}}})})},{"../utils":212,"./a-node":134,"./a-register-element":135,"./component":136}],134:[function(V,re,ae){var E=V("./a-register-element").registerElement,z=V("./a-register-element").isNode,P=V("../utils/"),L=P.debug("core:a-node:warn"),k=P.debug("core:a-node:error");re.exports=E("a-node",{prototype:Object.create(window.HTMLElement.prototype,{createdCallback:{value:function(){this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]},writable:window.debug},attachedCallback:{value:function(){var C;this.sceneEl=this.closestScene(),this.sceneEl||L("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(C=this.getAttribute("mixin"),C&&this.updateMixins(C))},writable:window.debug},attributeChangedCallback:{value:function(C,M,I){I!==this.computedMixinStr&&C==="mixin"&&!this.isMixin&&this.updateMixins(I,M)}},closestScene:{value:function(){for(var M=this;M&&!M.isScene;)M=M.parentElement;return M}},closest:{value:function(M){for(var I=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,b=this;b&&!I.call(b,M);)b=b.parentElement;return b}},detachedCallback:{value:function(){this.hasLoaded=!1}},load:{value:function(C,M){var I,b,T=this;this.hasLoaded||(M=M||z,I=this.getChildren(),b=I.filter(M).map(function(A){return new Promise(function(D){if(A.hasLoaded)return D();A.addEventListener("loaded",D)})}),Promise.all(b).then(function(){T.hasLoaded=!0,C&&C(),T.emit("loaded",void 0,!1)}).catch(function(A){k("Failure loading node: ",A)}))},writable:!0},getChildren:{value:function(){return Array.prototype.slice.call(this.children,0)}},updateMixins:{value:function(){var C=[],M=[],I={};return function(b,T){var A,_,D;for(C.length=0,M.length=0,_=b?P.split(b.trim(),/\s+/):C,D=T?P.split(T.trim(),/\s+/):M,I.newMixinIds=_,I.oldMixinIds=D,A=0;A<D.length;A++)_.indexOf(D[A])===-1&&this.unregisterMixin(D[A]);for(this.computedMixinStr="",this.mixinEls.length=0,A=0;A<_.length;A++)this.registerMixin(document.getElementById(_[A]));return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),I}}()},registerMixin:{value:function(C){var M,I,b;if(!!C){if(b=C.getAttribute("mixin"),b)for(M=P.split(b.trim(),/\s+/),I=0;I<M.length;I++)this.registerMixin(document.getElementById(M[I]));this.computedMixinStr=this.computedMixinStr+" "+C.id,this.mixinEls.push(C)}}},setAttribute:{value:function(C,M){C==="mixin"&&this.updateMixins(M),window.HTMLElement.prototype.setAttribute.call(this,C,M)}},unregisterMixin:{value:function(C){var M,I=this.mixinEls,b;for(M=0;M<I.length;++M)if(b=I[M],C===b.id){I.splice(M,1);break}}},emit:{value:function(){var C={};return function(M,I,b,T){b===void 0&&(b=!0),C.bubbles=!!b,C.detail=I,T&&(C=P.extend({},T,C)),this.dispatchEvent(new CustomEvent(M,C))}}(),writable:window.debug}})})},{"../utils/":212,"./a-register-element":135}],135:[function(V,re,ae){V("document-register-element");var E,z,P=re.exports.knownTags={};function L(T){P[T.toLowerCase()]=!0}re.exports.isNode=function(T){return T.tagName.toLowerCase()in P||T.isNode},re.exports.registerElement=function(T,A){var _=Object.getPrototypeOf(A.prototype),D=A,B=E&&_===E.prototype,$=z&&_===z.prototype;return(B||$)&&L(T),B&&(D=k(A.prototype),D={prototype:Object.create(_,D)}),$&&(D=C(A.prototype),D={prototype:Object.create(_,D)}),Object.getOwnPropertyNames(D.prototype).forEach(function(j){var q=D.prototype[j];typeof q=="function"&&(q.displayName=j)}),document.registerElement(T,D)};function k(T){var A={},_=["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"];return M(A,_,T,E.prototype),b(T,A),A}function C(T){var A={},_=["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],D=["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"];return M(A,_,T,E.prototype),M(A,D,T,z.prototype),b(T,A),A}function M(T,A,_,D){A.forEach(function(B){I(T,B,_,D)})}re.exports.wrapMethods=M;function I(T,A,_,D){var B=_[A],$=D[A];!B||!$||B!==$&&(T[A]={value:function(){return $.apply(this,arguments),B.apply(this,arguments)},writable:window.debug})}function b(T,A){var _=Object.getOwnPropertyNames(T);_.forEach(function(D){var B;A[D]||(B=Object.getOwnPropertyDescriptor(T,D),A[D]={value:T[D],writable:B.writable})})}E=V("./a-node"),z=V("./a-entity")},{"./a-entity":132,"./a-node":134,"document-register-element":12}],136:[function(V,re,ae){var E=V("./schema"),z=V("./scene/scenes"),P=V("./system"),L=V("../utils/"),k=re.exports.components={},C=E.parseProperties,M=E.parseProperty,I=E.process,b=E.isSingleProperty,T=E.stringifyProperties,A=E.stringifyProperty,_=L.styleParser,D=L.debug("core:component:warn"),B=document.currentScript,$=new RegExp("[A-Z]+"),j={},q=re.exports.Component=function(Ae,Ue,Qe){var ht=this;this.el=Ae,this.id=Qe,this.attrName=this.name+(Qe?"__"+Qe:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.isSingleProperty=b(this.schema),this.isSinglePropertyObject=this.isSingleProperty&&he(M(void 0,this.schema))&&!(this.schema.default instanceof window.HTMLElement),this.isObjectBased=!this.isSingleProperty||this.isSinglePropertyObject,this.el.components[this.attrName]=this,this.objectPool=j[this.name];let lt=this.events;this.events={},Q(this,lt),this.attrValue=void 0,this.isObjectBased?(this.nextData=this.objectPool.use(),L.objectPool.removeUnusedKeys(this.nextData,this.schema),this.oldData=this.objectPool.use(),L.objectPool.removeUnusedKeys(this.oldData,this.schema),this.previousOldData=this.objectPool.use(),L.objectPool.removeUnusedKeys(this.previousOldData,this.schema),this.parsingAttrValue=this.objectPool.use(),L.objectPool.removeUnusedKeys(this.parsingAttrValue,this.schema)):(this.nextData=void 0,this.oldData=void 0,this.previousOldData=void 0,this.parsingAttrValue=void 0),this.throttledEmitComponentChanged=L.throttleComponentChanged(function(){Ae.emit("componentchanged",ht.evtDetail,!1)},200),this.updateProperties(Ue)};q.prototype={schema:{},init:function(){},events:{},update:function(Ae){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},parse:function(Ae,Ue){var Qe=this.schema;return this.isSingleProperty?M(Ae,Qe):C(_.parse(Ae),Qe,!0,this.name,Ue)},stringify:function(Ae){var Ue=this.schema;return typeof Ae=="string"?Ae:this.isSingleProperty?A(Ae,Ue):(Ae=T(Ae,Ue),_.stringify(Ae))},updateCachedAttrValue:function(Ae,Ue){var Qe,ht,lt;if(Ae!==void 0){if(Ae===null){this.isObjectBased&&this.attrValue&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0;return}if(Ae instanceof Object&&!(Ae instanceof window.HTMLElement)?(ht=this.objectPool.use(),Qe=L.extend(ht,Ae)):Qe=this.parseAttrValueForCache(Ae),this.isObjectBased&&!Ue&&this.attrValue)for(lt in this.attrValue)Qe[lt]===void 0&&(Qe[lt]=this.attrValue[lt]);this.isObjectBased&&!this.attrValue&&(this.attrValue=this.objectPool.use()),L.objectPool.clearObject(this.attrValue),this.attrValue=Se(this.attrValue,Qe,this.isObjectBased),L.objectPool.clearObject(ht)}},parseAttrValueForCache:function(Ae){var Ue;return typeof Ae!="string"?Ae:(this.isSingleProperty?(Ue=this.schema.parse(Ae),typeof Ue=="string"&&(Ue=Ae)):(L.objectPool.clearObject(this.parsingAttrValue),Ue=_.parse(Ae,this.parsingAttrValue)),Ue)},flushToDOM:function(Ae){var Ue=Ae?this.data:this.attrValue;Ue!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(Ue))},updateProperties:function(Ae,Ue){var Qe=this.el;if(!Qe.hasLoaded){this.updateCachedAttrValue(Ae);return}Ae!==null&&(Ae=this.parseAttrValueForCache(Ae)),this.updateCachedAttrValue(Ae,Ue),this.initialized?(this.updateComponent(Ae,Ue),this.callUpdateHandler()):this.initComponent()},initComponent:function(){var Ae=this.el,Ue;this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!1,!0)),this.data=this.buildData(this.attrValue),!Ae.initializingComponents[this.name]&&(Ae.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete Ae.initializingComponents[this.name],this.oldData=Se(this.oldData,this.data,this.isObjectBased),Ue=this.isObjectBased?this.objectPool.use():void 0,this.update(Ue),this.isObjectBased&&this.objectPool.recycle(Ue),Ae.isPlaying&&this.play(),Ae.emit("componentinitialized",this.evtDetail,!1))},updateComponent:function(Ae,Ue){var Qe,ht;if(Ue){this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),this.data=this.buildData(this.attrValue,!0,!1);return}if(this.isSingleProperty){this.isObjectBased&&M(Ae,this.schema),this.data=Ae;return}if(C(Ae,this.schema,!0,this.name),this.schemaChangeKeys.length){for(Qe in Ae)if(this.schema[Qe].schemaChange){ht=!0;break}}if(ht){this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),this.data=this.buildData(this.attrValue,!0,!1);return}for(Qe in Ae)Ae[Qe]!==void 0&&(this.data[Qe]=Ae[Qe])},callUpdateHandler:function(){var Ae;this.previousOldData instanceof Object&&L.objectPool.clearObject(this.previousOldData),this.isObjectBased?xe(this.previousOldData,this.oldData):this.previousOldData=this.oldData,Ae=!L.deepEqual(this.oldData,this.data),!(!this.isPositionRotationScale&&!Ae)&&(this.oldData instanceof Object&&L.objectPool.clearObject(this.oldData),this.oldData=Se(this.oldData,this.data,this.isObjectBased),this.update(this.previousOldData),this.throttledEmitComponentChanged())},handleMixinUpdate:function(){this.data=this.buildData(this.attrValue),this.callUpdateHandler()},resetProperty:function(Ae){if(this.isObjectBased){if(!(Ae in this.attrValue))return;delete this.attrValue[Ae],this.data[Ae]=this.schema[Ae].default}else this.attrValue=this.schema.default,this.data=this.schema.default;this.updateProperties(this.attrValue)},extendSchema:function(Ae){var Ue;Ue=L.extend({},k[this.name].schema),L.extend(Ue,Ae),this.schema=I(Ue),this.el.emit("schemachanged",this.evtDetail)},buildData:function(Ae,Ue,Qe){var ht,lt,Et,Mt,ln,Tn=this.nextData,xn=this.schema,Qn,Cn=this.el.mixinEls,Mn;if(ht=Ae&&Ae.constructor===Array?Ae.length:Ae!=null,this.isObjectBased&&L.objectPool.clearObject(Tn),this.isSingleProperty)this.isObjectBased?lt=xe(Tn,xn.default):lt=Ie(xn.default)?L.clone(xn.default):xn.default;else{Mn=!Ue&&this.attrValue,lt=Mn instanceof Object?xe(Tn,Mn):Tn;for(Mt in xn)Et=xn[Mt].default,lt[Mt]===void 0&&(lt[Mt]=Ie(Et)?L.clone(Et):Et)}for(Qn=0;Qn<Cn.length;Qn++)ln=Cn[Qn].getAttribute(this.attrName),ln&&(lt=Se(lt,ln,this.isObjectBased));if(ht){if(this.isSingleProperty)return he(Ae)?(xe(this.parsingAttrValue,Ae),M(this.parsingAttrValue,xn)):M(Ae,xn);lt=Se(lt,Ae,this.isObjectBased)}else if(this.isSingleProperty)return M(lt,xn);return C(lt,xn,void 0,this.name,Qe)},eventsAttach:function(){var Ae;this.eventsDetach();for(Ae in this.events)this.el.addEventListener(Ae,this.events[Ae])},eventsDetach:function(){var Ae;for(Ae in this.events)this.el.removeEventListener(Ae,this.events[Ae])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.oldData),this.objectPool.recycle(this.parsingAttrValue),this.attrValue=this.oldData=this.parsingAttrValue=void 0}};function Q(Ae,Ue){var Qe;for(Qe in Ue)Ae.events[Qe]=Ue[Qe].bind(Ae)}if(window.debug)var ue=re.exports.registrationOrderWarnings={};re.exports.registerComponent=function(Ae,Ue){var Qe,ht,lt={},Et,Mt;if(document.currentScript&&document.currentScript!==B&&z.forEach(function(Tn){Tn.hasLoaded||document.currentScript.compareDocumentPosition(Tn)!==Node.DOCUMENT_POSITION_FOLLOWING&&(D("The component `"+Ae+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(ue[Ae]=!0))}),$.test(Ae)===!0&&D("The component name `"+Ae+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+Ae.toLowerCase()+"`"),Ae.indexOf("__")!==-1)throw new Error("The component name `"+Ae+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(Ue).forEach(function(ln){lt[ln]={value:Ue[ln],writable:!0}}),k[Ae])throw new Error("The component `"+Ae+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");if(Qe=function(ln,Tn,xn){q.call(this,ln,Tn,xn)},Qe.prototype=Object.create(q.prototype,lt),Qe.prototype.name=Ae,Qe.prototype.isPositionRotationScale=Ae==="position"||Ae==="rotation"||Ae==="scale",Qe.prototype.constructor=Qe,Qe.prototype.system=P&&P.systems[Ae],Qe.prototype.play=we(Qe.prototype.play),Qe.prototype.pause=pe(Qe.prototype.pause),Et=L.extend(I(Qe.prototype.schema,Qe.prototype.name)),Mt=b(Qe.prototype.schema),!Mt){Qe.prototype.schemaChangeKeys=[];for(ht in Et)Et[ht].schemaChange&&Qe.prototype.schemaChangeKeys.push(ht)}return j[Ae]=L.objectPool.createPool(),k[Ae]={Component:Qe,dependencies:Qe.prototype.dependencies,isSingleProp:Mt,multiple:Qe.prototype.multiple,name:Ae,parse:Qe.prototype.parse,parseAttrValueForCache:Qe.prototype.parseAttrValueForCache,schema:Et,stringify:Qe.prototype.stringify,type:Qe.prototype.type},Qe};function xe(Ae,Ue){var Qe,ht;for(ht in Ue)Ue[ht]!==void 0&&(Qe=Ue[ht],Ae[ht]=Ie(Qe)?L.clone(Qe):Qe);return Ae}function Se(Ae,Ue,Qe){var ht;if(Qe&&Ue.constructor===Object){for(ht in Ue)Ue[ht]!==void 0&&(Ue[ht]&&Ue[ht].constructor===Object?Ae[ht]=L.clone(Ue[ht]):Ae[ht]=Ue[ht]);return Ae}return Ue}function be(Ae){return Ae.tick||Ae.tock}function pe(Ae){return function(){var Qe=this.el.sceneEl;!this.isPlaying||(Ae.call(this),this.isPlaying=!1,this.eventsDetach(),be(this)&&Qe.removeBehavior(this))}}function we(Ae){return function(){var Qe=this.el.sceneEl,ht=this.el.isPlaying&&!this.isPlaying;!this.initialized||!ht||(Ae.call(this),this.isPlaying=!0,this.eventsAttach(),be(this)&&Qe.addBehavior(this))}}function he(Ae){return Ae&&Ae.constructor===Object&&!(Ae instanceof window.HTMLElement)}function Ie(Ae){return Ae&&(Ae.constructor===Object||Ae.constructor===Array)&&!(Ae instanceof window.HTMLElement)}},{"../utils/":212,"./scene/scenes":143,"./schema":145,"./system":147}],137:[function(V,re,ae){var E=V("./schema"),z=E.process,P=re.exports.geometries={},L=re.exports.geometryNames=[],k=V("../lib/three"),C=re.exports.Geometry=function(){};C.prototype={schema:{},init:function(M){return this.geometry=new k.BufferGeometry,this.geometry},update:function(M){}},re.exports.registerGeometry=function(M,I){var b,T={};if(Object.keys(I).forEach(function(_){T[_]={value:I[_],writable:!0}}),P[M])throw new Error("The geometry `"+M+"` has been already registered");return b=function(){C.call(this)},b.prototype=Object.create(C.prototype,T),b.prototype.name=M,b.prototype.constructor=b,P[M]={Geometry:b,schema:z(b.prototype.schema)},L.push(M),b}},{"../lib/three":184,"./schema":145}],138:[function(V,re,ae){var E=V("../utils/coordinates"),z=V("debug"),P=z("core:propertyTypes:warn"),L=z("core:propertyTypes:warn"),k=re.exports.propertyTypes={},C=/[,> .[\]:]/,M=/\url\((.+)\)/;I("audio","",A),I("array",[],b,T),I("asset","",A),I("boolean",!1,B),I("color","#FFF",_,D),I("int",0,$),I("number",0,j),I("map","",A),I("model","",A),I("selector",null,q,ue),I("selectorAll",null,Q,xe),I("src","",Se),I("string","",_,D),I("time",0,$),I("vec2",{x:0,y:0},be,E.stringify),I("vec3",{x:0,y:0,z:0},be,E.stringify),I("vec4",{x:0,y:0,z:0,w:1},be,E.stringify);function I(he,Ie,Ae,Ue){if("type"in k){P("Property type "+he+" is already registered.");return}k[he]={default:Ie,parse:Ae||_,stringify:Ue||D}}re.exports.registerPropertyType=I;function b(he){if(Array.isArray(he))return he;if(!he||typeof he!="string")return[];return he.split(",").map(Ie);function Ie(Ae){return Ae.trim()}}function T(he){return he.join(", ")}function A(he){var Ie,Ae;if(typeof he!="string")return he;if(Ae=he.match(M),Ae)return Ae[1];if(he.charAt(0)==="#"){if(Ie=document.getElementById(he.substring(1)),Ie)return Ie.tagName==="CANVAS"||Ie.tagName==="VIDEO"||Ie.tagName==="IMG"?Ie:Ie.getAttribute("src");L('"'+he+'" asset not found.');return}return he}function _(he){return he}function D(he){return he===null?"null":he.toString()}function B(he){return he!=="false"&&he!==!1}function $(he){return parseInt(he,10)}function j(he){return parseFloat(he,10)}function q(he){return he?typeof he!="string"?he:he[0]==="#"&&!C.test(he)?document.getElementById(he.substring(1)):document.querySelector(he):null}function Q(he){return he?typeof he!="string"?he:Array.prototype.slice.call(document.querySelectorAll(he),0):null}function ue(he){return he.getAttribute?"#"+he.getAttribute("id"):D(he)}function xe(he){return he instanceof Array?he.map(function(Ie){return"#"+Ie.getAttribute("id")}).join(", "):D(he)}function Se(he){return L("`src` property type is deprecated. Use `asset` instead."),A(he)}function be(he){return E.parse(he,this.default)}function pe(he,Ie){return he==="audio"&&typeof Ie!="string"||he==="array"&&!Array.isArray(Ie)||he==="asset"&&typeof Ie!="string"||he==="boolean"&&typeof Ie!="boolean"||he==="color"&&typeof Ie!="string"||he==="int"&&typeof Ie!="number"||he==="number"&&typeof Ie!="number"||he==="map"&&typeof Ie!="string"||he==="model"&&typeof Ie!="string"||he==="selector"&&typeof Ie!="string"&&Ie!==null||he==="selectorAll"&&typeof Ie!="string"&&Ie!==null||he==="src"&&typeof Ie!="string"||he==="string"&&typeof Ie!="string"||he==="time"&&typeof Ie!="number"?!1:he==="vec2"?we(Ie,2):he==="vec3"?we(Ie,3):he==="vec4"?we(Ie,4):!0}re.exports.isValidDefaultValue=pe;function we(he,Ie){if(he===null)return!0;if(typeof he!="object"||Object.keys(he).length!==Ie)return!1;var Ae=he.x,Ue=he.y,Qe=he.z,ht=he.w;return!(typeof Ae!="number"||typeof Ue!="number"||Ie>2&&typeof Qe!="number"||Ie>3&&typeof ht!="number")}re.exports.isValidDefaultCoordinate=we},{"../utils/coordinates":207,debug:8}],139:[function(V,re,ae){var E=V("./metaTags").inject,z=V("./wakelock"),P=V("./loadingScreen"),L=V("../a-register-element"),k=V("./scenes"),C=V("../system").systems,M=V("../../lib/three"),I=V("../../utils/"),b=V("../a-entity"),T=V("../a-node"),A=V("./postMessage"),_=I.bind,D=I.device.isIOS(),B=I.device.isMobile(),$=I.device.isWebXRAvailable,j=L.registerElement,q=I.debug("core:a-scene:warn");D&&V("../../utils/ios-orientationchange-blank-bug"),re.exports.AScene=j("a-scene",{prototype:Object.create(b.prototype,{createdCallback:{value:function(){this.clock=new M.Clock,this.isIOS=D,this.isMobile=B,this.hasWebXR=$,this.isAR=!1,this.isScene=!0,this.object3D=new M.Scene;var we=this;this.object3D.onAfterRender=function(he,Ie,Ae){we.isPlaying&&we.tock(we.time,we.delta,Ae)},this.resize=_(this.resize,this),this.render=_(this.render,this),this.systems={},this.systemNames=[],this.time=this.delta=0,this.behaviors={tick:[],tock:[]},this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("vr-mode-ui",""),this.setAttribute("device-orientation-permission-ui","")}},addFullScreenStyles:{value:function(){document.documentElement.classList.add("a-fullscreen")}},removeFullScreenStyles:{value:function(){document.documentElement.classList.remove("a-fullscreen")}},attachedCallback:{value:function(){var we=this,he=this.hasAttribute("embedded");pe(this),this.setupRenderer(),P.setup(this,ue),this.resize(),he||this.addFullScreenStyles(),A(this),E(this),z(this),this.onVRPresentChangeBound=_(this.onVRPresentChange,this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){we.enterVR()},this.exitVRBound=function(){we.exitVR()},this.exitVRTrueBound=function(){we.exitVR(!0)},this.pointerRestrictedBound=function(){we.pointerRestricted()},this.pointerUnrestrictedBound=function(){we.pointerUnrestricted()},$||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){we.attachedCallbackPostCamera()}),this.initSystems(),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){we.enterVR()})}},attachedCallbackPostCamera:{value:function(){var we,he=this;window.addEventListener("load",we),window.addEventListener("resize",function(){he.isIOS?setTimeout(he.resize,100):he.resize()}),this.play(),k.push(this)},writable:window.debug},initSystems:{value:function(){var we;this.initSystem("camera");for(we in C)we!=="camera"&&this.initSystem(we)}},initSystem:{value:function(we){this.systems[we]||(this.systems[we]=new C[we](this),this.systemNames.push(we))}},detachedCallback:{value:function(){var we=k.indexOf(this);k.splice(we,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.xr.dispose()}},addBehavior:{value:function(we){var he,Ie=this.behaviors,Ae;for(Ae in Ie)!we[Ae]||(he=this.behaviors[Ae],he.indexOf(we)===-1&&he.push(we))}},getPointerLockElement:{value:function(){return document.pointerLockElement},writable:window.debug},checkHeadsetConnected:{value:I.device.checkHeadsetConnected,writable:window.debug},enterAR:{value:function(){var we;if(!this.hasWebXR)throw we="Failed to enter AR mode, WebXR not supported.",new Error(we);if(!I.device.checkARSupport())throw we="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(we);return this.enterVR(!0)}},enterVR:{value:function(we){var he=this,Ie,Ae=he.renderer.xr,Ue;if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile)if(Ae.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var Qe=this.sceneEl.systems.webxr.sessionReferenceSpaceType;Ae.setReferenceSpaceType(Qe);var ht=we?"immersive-ar":"immersive-vr";return Ue=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(Tn,xn){navigator.xr.requestSession(ht,Ue).then(function(Cn){he.xrSession=Cn,Ae.layersEnabled=Ue.requiredFeatures.indexOf("layers")!==-1,Ae.setSession(Cn),Cn.addEventListener("end",he.exitVRBound),Mt(Tn)},function(Cn){var Mn=ht==="immersive-ar",Ar=Mn?"AR":"VR";throw new Error("Failed to enter "+Ar+" mode (`requestSession`) "+Cn)})})}else{if(Ie=I.device.getVRDisplay(),Ae.setDevice(Ie),Ie.isPresenting&&!window.hasNativeWebVRImplementation)return Mt(),Promise.resolve();var lt=this.getAttribute("renderer"),Et={highRefreshRate:lt.highRefreshRate,foveationLevel:lt.foveationLevel};return Ie.requestPresent([{source:this.canvas,attributes:Et}]).then(Mt,ln)}return Mt(),Promise.resolve();function Mt(Tn){var xn;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(xn=new CustomEvent("vrdisplaypresentchange",{detail:{display:I.device.getVRDisplay()}}),window.dispatchEvent(xn)),we?he.addState("ar-mode"):he.addState("vr-mode"),he.emit("enter-vr",{target:he}),!$&&he.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),he.addFullScreenStyles(),!he.isMobile&&!he.checkHeadsetConnected()&&Se(he.canvas),he.resize(),Tn&&Tn()}function ln(Tn){throw he.removeState("vr-mode"),Tn&&Tn.message?new Error("Failed to enter VR mode (`requestPresent`): "+Tn.message):new Error("Failed to enter VR mode (`requestPresent`).")}},writable:!0},exitVR:{value:function(){var we=this,he,Ie=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(Ie.enabled=!1,he=I.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0,Ie.setSession(null);else if(he.isPresenting)return he.exitPresent().then(Ae,Ue)}else be();return Ae(),Promise.resolve();function Ae(){we.removeState("vr-mode"),we.removeState("ar-mode"),we.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),we.hasAttribute("embedded")&&we.removeFullScreenStyles(),we.resize(),we.isIOS&&I.forceCanvasResizeSafariMobile(we.canvas),we.renderer.setPixelRatio(window.devicePixelRatio),we.emit("exit-vr",{target:we})}function Ue(Qe){throw Qe&&Qe.message?new Error("Failed to exit VR mode (`exitPresent`): "+Qe.message):new Error("Failed to exit VR mode (`exitPresent`).")}},writable:!0},pointerRestricted:{value:function(){if(this.canvas){var we=this.getPointerLockElement();we&&we!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}},pointerUnrestricted:{value:function(){var we=this.getPointerLockElement();we&&we===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}},onVRPresentChange:{value:function(we){var he=we.display||we.detail.display;if(he&&he.isPresenting){this.enterVR();return}this.exitVR()}},getAttribute:{value:function(we){var he=this.systems[we];return he?he.data:b.prototype.getAttribute.call(this,we)}},getComputedAttribute:{value:function(we){q("`getComputedAttribute` is deprecated. Use `getAttribute` instead."),this.getAttribute(we)}},getDOMAttribute:{value:function(we){var he=this.systems[we];return he?he.data:b.prototype.getDOMAttribute.call(this,we)}},setAttribute:{value:function(we,he,Ie){var Ae=this.systems[we];if(Ae){T.prototype.setAttribute.call(this,we,he),Ae.updateProperties(he);return}b.prototype.setAttribute.call(this,we,he,Ie)}},removeBehavior:{value:function(we){var he,Ie,Ae=this.behaviors,Ue;for(Ie in Ae)!we[Ie]||(he=this.behaviors[Ie],Ue=he.indexOf(we),Ue!==-1&&he.splice(Ue,1))}},resize:{value:function(){var we=this.camera,he=this.canvas,Ie,Ae,Ue,Qe=this.renderer.xr.isPresenting;Ae=this.renderer.xr.enabled&&Qe,!(!we||!he||this.is("vr-mode")&&(this.isMobile||Ae))&&(Ie=this.getAttribute("embedded")&&!this.is("vr-mode"),Ue=ue(he,Ie,this.maxCanvasSize,this.is("vr-mode")),we.aspect=Ue.width/Ue.height,we.updateProjectionMatrix(),this.renderer.setSize(Ue.width,Ue.height,!1),this.emit("rendererresize",null,!1))},writable:!0},setupRenderer:{value:function(){var we=this,he,Ie,Ae,Ue;Ue={alpha:!0,antialias:!B,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:1920,width:1920},this.hasAttribute("renderer")&&(Ae=this.getAttribute("renderer"),Ie=I.styleParser.parse(Ae),Ie.precision&&(Ue.precision=Ie.precision+"p"),Ie.antialias&&Ie.antialias!=="auto"&&(Ue.antialias=Ie.antialias==="true"),Ie.logarithmicDepthBuffer&&Ie.logarithmicDepthBuffer!=="auto"&&(Ue.logarithmicDepthBuffer=Ie.logarithmicDepthBuffer==="true"),Ie.alpha&&(Ue.alpha=Ie.alpha==="true"),this.maxCanvasSize={width:Ie.maxCanvasWidth?parseInt(Ie.maxCanvasWidth):this.maxCanvasSize.width,height:Ie.maxCanvasHeight?parseInt(Ie.maxCanvasHeight):this.maxCanvasSize.height}),he=this.renderer=new M.WebGLRenderer(Ue),he.setPixelRatio(window.devicePixelRatio),he.sortObjects=!1,this.camera&&he.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){he.xr.setPoseTarget(we.camera.el.object3D)})},writable:window.debug},play:{value:function(){var we=this,he=this;if(this.renderStarted){b.prototype.play.call(this);return}this.addEventListener("loaded",function(){var Ie=this.renderer,Ae,Ue=this.renderer.xr;b.prototype.play.call(this),!he.renderStarted&&(he.resize(),he.renderer&&(window.performance&&window.performance.mark("render-started"),P.remove(),Ae=I.device.getVRDisplay(),Ae&&Ae.isPresenting&&(Ue.setDevice(Ae),Ue.enabled=!0,he.enterVR()),Ie.setAnimationLoop(this.render),he.renderStarted=!0,he.emit("renderstart")))}),setTimeout(function(){b.prototype.load.call(we)})}},updateComponent:{value:function(we){we in C||b.prototype.updateComponent.apply(this,arguments)}},tick:{value:function(we,he){var Ie,Ae=this.systems;for(Ie=0;Ie<this.behaviors.tick.length;Ie++)!this.behaviors.tick[Ie].el.isPlaying||this.behaviors.tick[Ie].tick(we,he);for(Ie=0;Ie<this.systemNames.length;Ie++)!Ae[this.systemNames[Ie]].tick||Ae[this.systemNames[Ie]].tick(we,he)}},tock:{value:function(we,he,Ie){var Ae,Ue=this.systems;for(Ae=0;Ae<this.behaviors.tock.length;Ae++)!this.behaviors.tock[Ae].el.isPlaying||this.behaviors.tock[Ae].tock(we,he,Ie);for(Ae=0;Ae<this.systemNames.length;Ae++)!Ue[this.systemNames[Ae]].tock||Ue[this.systemNames[Ae]].tock(we,he,Ie)}},render:{value:function(we,he){var Ie=this.renderer;this.frame=he,this.delta=this.clock.getDelta()*1e3,this.time=this.clock.elapsedTime*1e3,this.isPlaying&&this.tick(this.time,this.delta);var Ae=null;this.is("ar-mode")&&(Ae=this.object3D.background,this.object3D.background=null),Ie.render(this.object3D,this.camera),Ae&&(this.object3D.background=Ae)},writable:!0}})});function Q(we,he){var Ie,Ae=window.devicePixelRatio;return!he||he.width===-1&&he.height===-1||we.width*Ae<he.width&&we.height*Ae<he.height||(Ie=we.width/we.height,we.width*Ae>he.width&&he.width!==-1&&(we.width=Math.round(he.width/Ae),we.height=Math.round(he.width/Ie/Ae)),we.height*Ae>he.height&&he.height!==-1&&(we.height=Math.round(he.height/Ae),we.width=Math.round(he.height*Ie/Ae))),we}function ue(we,he,Ie,Ae){if(!we.parentElement)return{height:0,width:0};if(he){var Ue;return Ue={height:we.parentElement.offsetHeight,width:we.parentElement.offsetWidth},Q(Ue,Ie)}return xe(Ie,Ae)}function xe(we,he){var Ie;return Ie={height:document.body.offsetHeight,width:document.body.offsetWidth},he?Ie:Q(Ie,we)}function Se(we){var he=we.requestFullscreen||we.webkitRequestFullscreen||we.mozRequestFullScreen||we.msRequestFullscreen;he.apply(we,[{navigationUI:"hide"}])}function be(){var we=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;!we||(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function pe(we){var he;he=document.createElement("canvas"),he.classList.add("a-canvas"),he.dataset.aframeCanvas=!0,we.appendChild(he),document.addEventListener("fullscreenchange",Ie),document.addEventListener("mozfullscreenchange",Ie),document.addEventListener("webkitfullscreenchange",Ie),document.addEventListener("MSFullscreenChange",Ie),he.addEventListener("touchmove",function(Ae){Ae.preventDefault()}),we.canvas=he,we.emit("render-target-loaded",{target:he}),setTimeout(_(we.resize,we),0);function Ie(){var Ae=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;Ae||we.exitVR(),document.activeElement.blur(),document.body.focus()}}re.exports.setupCanvas=pe},{"../../lib/three":184,"../../utils/":212,"../../utils/ios-orientationchange-blank-bug":213,"../a-entity":132,"../a-node":134,"../a-register-element":135,"../system":147,"./loadingScreen":140,"./metaTags":141,"./postMessage":142,"./scenes":143,"./wakelock":144}],140:[function(V,re,ae){var E=V("../../utils/"),z=E.styleParser,P,L,k,C="loading-screen",M="a-loader-title";re.exports.setup=function(A,_){P=A,k=_;var D=P.hasAttribute(C)?z.parse(P.getAttribute(C)):void 0,B=D&&D.dotsColor||"white",$=D&&D.backgroundColor||"#24CAFF",j=D===void 0||D.enabled==="true"||D.enabled===void 0,q,Q,ue,xe,Se,be,pe,we,he,Ie;!j||(q=new THREE.Scene,Q=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),ue=new THREE.MeshBasicMaterial({color:B}),xe=new THREE.Mesh(Q,ue),Se=xe.clone(),be=xe.clone(),pe=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),we=new THREE.Clock,he=0,Ie=function(){P.renderer.render(q,pe),he=we.getElapsedTime()%4,xe.visible=he>=1,Se.visible=he>=2,be.visible=he>=3},q.background=new THREE.Color($),q.add(pe),xe.position.set(-1,0,-15),Se.position.set(0,0,-15),be.position.set(1,0,-15),pe.add(xe),pe.add(Se),pe.add(be),b(),setTimeout(function(){P.hasLoaded||(I(pe),L.style.display="block",window.addEventListener("resize",function(){I(pe)}),P.renderer.setAnimationLoop(Ie))},200))},re.exports.remove=function(){window.removeEventListener("resize",I),L&&(L.style.display="none")};function I(T){var A=P.hasAttribute("embedded"),_=k(P.canvas,A,P.maxCanvasSize,P.is("vr-mode"));T.aspect=_.width/_.height,T.updateProjectionMatrix(),P.renderer.setSize(_.width,_.height,!1)}function b(){L=document.createElement("div"),L.className=M,L.innerHTML=document.title,L.style.display="none",P.appendChild(L)}},{"../../utils/":212}],141:[function(V,re,ae){var E=V("../../constants/"),z=V("../../utils").extend,P=re.exports.MOBILE_HEAD_TAGS=[k({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),k({name:"mobile-web-app-capable",content:"yes"}),k({name:"theme-color",content:"black"})],L=[k({name:"apple-mobile-web-app-capable",content:"yes"}),k({name:"apple-mobile-web-app-status-bar-style",content:"black"}),C({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function k(I){return{tagName:"meta",attributes:I,exists:function(){return document.querySelector('meta[name="'+I.name+'"]')}}}function C(I){return{tagName:"link",attributes:I,exists:function(){return document.querySelector('link[rel="'+I.rel+'"]')}}}re.exports.inject=function(b){var T=document.head,A=T.querySelector("script"),_,D=[];return P.forEach(B),b.isIOS&&L.forEach(B),D;function B($){!$||$.exists()||(_=M($),_&&(A?A.parentNode.insertBefore(_,A):T.appendChild(_),D.push(_)))}};function M(I){if(!(!I||!I.tagName)){var b=document.createElement(I.tagName);return b.setAttribute(E.AFRAME_INJECTED,""),z(b,I.attributes)}}},{"../../constants/":128,"../../utils":212}],142:[function(V,re,ae){var E=V("../../utils/bind"),z=V("../../utils/").isIframed;re.exports=function(k){!z()||window.addEventListener("message",E(P,k))};function P(L){var k=this;if(!!L.data)switch(L.data.type){case"vr":switch(L.data.data){case"enter":k.enterVR();break;case"exit":k.exitVR();break}}}},{"../../utils/":212,"../../utils/bind":206}],143:[function(V,re,ae){re.exports=[]},{}],144:[function(V,re,ae){var E=V("../../../vendor/wakelock/wakelock");re.exports=function(P){if(!!P.isMobile){var L=P.wakelock=new E;P.addEventListener("enter-vr",function(){L.request()}),P.addEventListener("exit-vr",function(){L.release()})}}},{"../../../vendor/wakelock/wakelock":227}],145:[function(V,re,ae){var E=V("../utils/"),z=V("./propertyTypes"),P=E.debug,L=z.isValidDefaultValue,k=z.propertyTypes,C=P("core:schema:warn");function M(A){return"type"in A?typeof A.type=="string":"default"in A}re.exports.isSingleProperty=M,re.exports.process=function(A,_){var D;if(M(A))return I(A,_);for(D in A)A[D]=I(A[D],_);return A};function I(A,_){var D=A.default,B,$,j=A.type;return A.type?A.type==="bool"?j="boolean":A.type==="float"&&(j="number"):D!==void 0&&(typeof D=="boolean"||typeof D=="number")?j=typeof D:Array.isArray(D)?j="array":j="string",$=k[j],$||C("Unknown property type for component `"+_+"`: "+j),B=!!A.parse,A.parse=A.parse||$.parse,A.stringify=A.stringify||$.stringify,A.type=j,"default"in A?!B&&!L(j,D)&&C("Default value `"+D+"` does not match type `"+j+"` in component `"+_+"`"):A.default=$.default,A}re.exports.processPropertyDefinition=I,re.exports.parseProperties=function(){var A=[];return function(_,D,B,$,j){var q,Q,ue,xe;A.length=0;for(Q in B?_:D)B&&_[Q]===void 0||A.push(Q);if(_===null||typeof _!="object")return _;for(Q in _)_[Q]!==void 0&&!D[Q]&&!j&&C("Unknown property `"+Q+"` for component/system `"+$+"`.");for(q=0;q<A.length;q++){if(Q=A[q],ue=D[Q],xe=_[Q],!D[Q])return;_[Q]=b(xe,ue)}return _}}();function b(A,_){return(A==null||A==="")&&(A=_.default,Array.isArray(A)&&(A=A.slice())),_.parse(A,_.default)}re.exports.parseProperty=b,re.exports.stringifyProperties=function(A,_){var D,B,$,j={},q;for(D in A)B=_[D],$=A[D],q=$,typeof q=="object"&&(q=T($,B),B||C("Unknown component property: "+D)),j[D]=q;return j};function T(A,_){return typeof A!="object"?A:!_||A===null?JSON.stringify(A):_.stringify(A)}re.exports.stringifyProperty=T},{"../utils/":212,"./propertyTypes":138}],146:[function(V,re,ae){var E=V("./schema"),z=E.process,P=re.exports.shaders={},L=re.exports.shaderNames=[],k=V("../lib/three"),C=V("../utils"),M={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},I=re.exports.Shader=function(){};I.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(b){return this.attributes=this.initVariables(b,"attribute"),this.uniforms=this.initVariables(b,"uniform"),this.material=new(this.raw?k.RawShaderMaterial:k.ShaderMaterial)({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initVariables:function(b,T){var A,_=this.schema,D={},B;for(A in _)_[A].is===T&&(B=M[_[A].type],D[A]={type:B,value:void 0});return D},update:function(b){this.updateVariables(b,"attribute"),this.updateVariables(b,"uniform")},updateVariables:function(b,T){var A,_,D=this.schema,B;B=T==="uniform"?this.uniforms:this.attributes;for(A in b)if(!(!D[A]||D[A].is!==T)){if(D[A].type==="map"){if(!B[A]||B[A].value===b[A])continue;_="_texture_"+A,this.setMapOnTextureLoad(B,A,_),C.material.updateMapMaterialFromData(_,A,this,b);continue}B[A].value=this.parseValue(D[A].type,b[A]),B[A].needsUpdate=!0}},parseValue:function(b,T){var A;switch(b){case"vec2":return new k.Vector2(T.x,T.y);case"vec3":return new k.Vector3(T.x,T.y,T.z);case"vec4":return new k.Vector4(T.x,T.y,T.z,T.w);case"color":return A=new k.Color(T),new k.Vector3(A.r,A.g,A.b);case"map":return k.ImageUtils.loadTexture(T);default:return T}},setMapOnTextureLoad:function(b,T,A){var _=this;this.el.addEventListener("materialtextureloaded",function(){b[T].value=_.material[A],b[T].needsUpdate=!0})}},re.exports.registerShader=function(b,T){var A,_={};if(Object.keys(T).forEach(function(D){_[D]={value:T[D],writable:!0}}),P[b])throw new Error("The shader "+b+" has been already registered");return A=function(){I.call(this)},A.prototype=Object.create(I.prototype,_),A.prototype.name=b,A.prototype.constructor=A,P[b]={Shader:A,schema:z(A.prototype.schema)},L.push(b),A}},{"../lib/three":184,"../utils":212,"./schema":145}],147:[function(V,re,ae){var E=V("./component"),z=V("./schema"),P=V("../utils/"),L=z.parseProperties,k=z.parseProperty,C=z.process,M=z.isSingleProperty,I=P.styleParser,b=re.exports.systems={},T=re.exports.System=function(A){var _=E&&E.components[this.name];this.el=A,this.sceneEl=A,_&&(_.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};T.prototype={schema:{},init:function(){},update:function(A){},updateProperties:function(A){var _=this.data;!Object.keys(z).length||(this.buildData(A),this.update(_))},buildData:function(A){var _=this.schema;!Object.keys(_).length||(A=A||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),M(_)?this.data=k(A,_):this.data=L(I.parse(A)||{},_))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},re.exports.registerSystem=function(A,_){var D,B,$={},j=P.findAllScenes(document);if(Object.keys(_).forEach(function(q){$[q]={value:_[q],writable:!0}}),b[A])throw new Error("The system `"+A+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");for(B=function(q){T.call(this,q)},B.prototype=Object.create(T.prototype,$),B.prototype.name=A,B.prototype.constructor=B,B.prototype.schema=P.extend(C(B.prototype.schema)),b[A]=B,D=0;D<j.length;D++)j[D].initSystem(A)}},{"../utils/":212,"./component":136,"./schema":145}],148:[function(V,re,ae){V("./pivot")},{"./pivot":149}],149:[function(V,re,ae){var E=V("../../core/component").registerComponent,z=V("../../lib/three"),P=new z.Vector3,L=new z.Vector3;E("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var k=this.data,C=this.el,M=C.object3D.parent,I=C.object3D,b=new z.Group;P.copy(I.position),L.copy(I.rotation),M.remove(I),b.add(I),M.add(b),C.object3D=b,I.position.set(-1*k.x,-1*k.y,-1*k.z),b.position.set(k.x+P.x,k.y+P.y,k.z+P.z),b.rotation.copy(I.rotation),I.rotation.set(0,0,0)}})},{"../../core/component":136,"../../lib/three":184}],150:[function(V,re,ae){var E=V("../../core/component").components,z=V("../../core/shader").shaders,P=V("../../utils/"),L={};Object.keys(E.material.schema).forEach(k),Object.keys(z.standard.schema).forEach(k);function k(C){var M=C.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();C==="fog"&&(M="material-fog"),C==="visible"&&(M="material-visible"),L[M]="material."+C}re.exports=function(){return{defaultComponents:{material:{}},mappings:P.extend({},L)}}},{"../../core/component":136,"../../core/shader":146,"../../utils/":212}],151:[function(V,re,ae){V("./primitives/a-camera"),V("./primitives/a-cursor"),V("./primitives/a-curvedimage"),V("./primitives/a-gltf-model"),V("./primitives/a-image"),V("./primitives/a-light"),V("./primitives/a-link"),V("./primitives/a-obj-model"),V("./primitives/a-sky"),V("./primitives/a-sound"),V("./primitives/a-text"),V("./primitives/a-video"),V("./primitives/a-videosphere"),V("./primitives/meshPrimitives")},{"./primitives/a-camera":153,"./primitives/a-cursor":154,"./primitives/a-curvedimage":155,"./primitives/a-gltf-model":156,"./primitives/a-image":157,"./primitives/a-light":158,"./primitives/a-link":159,"./primitives/a-obj-model":160,"./primitives/a-sky":161,"./primitives/a-sound":162,"./primitives/a-text":163,"./primitives/a-video":164,"./primitives/a-videosphere":165,"./primitives/meshPrimitives":166}],152:[function(V,re,ae){var E=V("../../core/a-entity"),z=V("../../core/component").components,P=V("../../core/a-register-element").registerElement,L=V("../../utils/"),k=L.debug,C=L.entity.setComponentProperty,M=k("extras:primitives:debug"),I=k("extras:primitives:warn"),b=re.exports.primitives={};re.exports.registerPrimitive=function(D,B){D=D.toLowerCase(),M("Registering <%s>",D),B.defaultAttributes&&I("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var $=P(D,{prototype:Object.create(E.prototype,{defaultComponentsFromPrimitive:{value:B.defaultComponents||B.defaultAttributes||{}},deprecated:{value:B.deprecated||null},deprecatedMappings:{value:B.deprecatedMappings||{}},mappings:{value:B.mappings||{}},createdCallback:{value:function(){B.deprecated&&console.warn(B.deprecated),this.resolveMappingCollisions()}},resolveMappingCollisions:{value:function(){var j=this.mappings,q=this;Object.keys(j).forEach(function(ue){var xe;ue!==ue.toLowerCase()&&I("Mapping keys should be specified in lower case. The mapping key "+ue+" may not be recognized"),z[ue]&&(xe=j[ue].replace(".","-"),j[xe]=j[ue],delete j[ue],console.warn("The primitive "+q.tagName.toLowerCase()+" has a mapping collision. The attribute "+ue+" has the same name as a registered component and has been renamed to "+xe))})}},getExtraComponents:{value:function(){var j,q,Q,ue,xe,Se,be=this;for(q=L.clone(this.defaultComponentsFromPrimitive),xe=this.getAttribute("mixin"),xe&&(xe=xe.trim().split(" "),xe.forEach(function(Ue){var Qe=be.sceneEl.querySelector("#"+Ue).componentCache;Object.keys(Qe).forEach(function(lt){q[lt]=pe(q[lt],Qe[lt])})})),Q=0;Q<this.attributes.length;Q++)if(j=this.attributes[Q],ue=this.mappings[j.name],ue){Se=L.entity.getComponentPropertyPath(ue),Se.constructor===Array?(q[Se[0]]=q[Se[0]]||{},q[Se[0]][Se[1]]=j.value.trim()):q[Se]=j.value.trim();continue}return q;function pe(Ae,Ue){return we(Ae)?he(Ue):we(Ue)?he(Ae):Ie(Ae)&&Ie(Ue)?L.extendDeep(Ae,Ue):he(Ue)}function we(Ae){return typeof Ae>"u"}function he(Ae){return Ie(Ae)?L.extendDeep({},Ae):Ae}function Ie(Ae){return Ae!==null&&Ae.constructor===Object}}},attributeChangedCallback:{value:function(j,q,Q){var ue=this.mappings[j];j in this.deprecatedMappings&&console.warn(this.deprecatedMappings[j]),!(!j||!ue)&&C(this,ue,Q)}}})});return b[D]=$,$};function T(_,D){var B=z[_].schema;Object.keys(B).map(function($){var j=$.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();D[j]!==void 0&&(j=_+"-"+$),D[j]=_+"."+$})}function A(_,D,B){B=B||{},Object.keys(D).map(function(j){T(j,B)}),re.exports.registerPrimitive(_,L.extendDeep({},null,{defaultComponents:D,mappings:B}))}re.exports.definePrimitive=A},{"../../core/a-entity":132,"../../core/a-register-element":135,"../../core/component":136,"../../utils/":212}],153:[function(V,re,ae){var E=V("../primitives").registerPrimitive;E("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},{"../primitives":152}],154:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../primitives").registerPrimitive,P=V("../../../utils/");z("a-cursor",P.extendDeep({},E(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],155:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../primitives").registerPrimitive,P=V("../../../utils/");z("a-curvedimage",P.extendDeep({},E(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],156:[function(V,re,ae){var E=V("../primitives").registerPrimitive;E("a-gltf-model",{mappings:{src:"gltf-model"}})},{"../primitives":152}],157:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../primitives").registerPrimitive,P=V("../../../utils/");z("a-image",P.extendDeep({},E(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],158:[function(V,re,ae){var E=V("../primitives").registerPrimitive;E("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap"}})},{"../primitives":152}],159:[function(V,re,ae){var E=V("../primitives").registerPrimitive;E("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},{"../primitives":152}],160:[function(V,re,ae){var E=V("../getMeshMixin")(),z=V("../primitives").registerPrimitive,P=V("../../../utils/");z("a-obj-model",P.extendDeep({},E,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],161:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../primitives").registerPrimitive,P=V("../../../utils/"),L=V("./meshPrimitives");z("a-sky",P.extendDeep({},E(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:P.extendDeep({},L["a-sphere"].prototype.mappings)}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152,"./meshPrimitives":166}],162:[function(V,re,ae){var E=V("../primitives").registerPrimitive;E("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},{"../primitives":152}],163:[function(V,re,ae){var E=V("../primitives").definePrimitive;E("a-text",{text:{anchor:"align",width:5}})},{"../primitives":152}],164:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../primitives").registerPrimitive,P=V("../../../utils/");z("a-video",P.extendDeep({},E(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],165:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../primitives").registerPrimitive,P=V("../../../utils/");z("a-videosphere",P.extendDeep({},E(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},{"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],166:[function(V,re,ae){var E=V("../getMeshMixin"),z=V("../../../core/geometry").geometries,P=V("../../../core/geometry").geometryNames,L=V("../primitives").registerPrimitive,k=V("../../../utils/"),C=re.exports={};P.forEach(function(b){var T=z[b],A=M(b),_={};Object.keys(T.schema).forEach(function(j){_[M(j)]="geometry."+j});var D="a-"+A,B=L(D,k.extendDeep({},E(),{defaultComponents:{geometry:{primitive:b}},mappings:_}));C[D]=B});function M(I){return I.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}},{"../../../core/geometry":137,"../../../utils/":212,"../getMeshMixin":150,"../primitives":152}],167:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(P){this.geometry=new z.BoxGeometry(P.width,P.height,P.depth,P.segmentsWidth,P.segmentsHeight,P.segmentsDepth)}})},{"../core/geometry":137,"../lib/three":184}],168:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=z.Math.degToRad;E("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(L){this.geometry=new z.CircleGeometry(L.radius,L.segments,P(L.thetaStart),P(L.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],169:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=z.Math.degToRad;E("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(L){this.geometry=new z.CylinderGeometry(L.radiusTop,L.radiusBottom,L.height,L.segmentsRadial,L.segmentsHeight,L.openEnded,P(L.thetaStart),P(L.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],170:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=z.Math.degToRad;E("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(L){this.geometry=new z.CylinderGeometry(L.radius,L.radius,L.height,L.segmentsRadial,L.segmentsHeight,L.openEnded,P(L.thetaStart),P(L.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],171:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(P){this.geometry=new z.DodecahedronGeometry(P.radius,P.detail)}})},{"../core/geometry":137,"../lib/three":184}],172:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(P){this.geometry=new z.IcosahedronGeometry(P.radius,P.detail)}})},{"../core/geometry":137,"../lib/three":184}],173:[function(V,re,ae){V("./box.js"),V("./circle.js"),V("./cone.js"),V("./cylinder.js"),V("./dodecahedron.js"),V("./icosahedron.js"),V("./octahedron.js"),V("./plane.js"),V("./ring.js"),V("./sphere.js"),V("./tetrahedron.js"),V("./torus.js"),V("./torusKnot.js"),V("./triangle.js")},{"./box.js":167,"./circle.js":168,"./cone.js":169,"./cylinder.js":170,"./dodecahedron.js":171,"./icosahedron.js":172,"./octahedron.js":174,"./plane.js":175,"./ring.js":176,"./sphere.js":177,"./tetrahedron.js":178,"./torus.js":179,"./torusKnot.js":180,"./triangle.js":181}],174:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(P){this.geometry=new z.OctahedronGeometry(P.radius,P.detail)}})},{"../core/geometry":137,"../lib/three":184}],175:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(P){this.geometry=new z.PlaneGeometry(P.width,P.height,P.segmentsWidth,P.segmentsHeight)}})},{"../core/geometry":137,"../lib/three":184}],176:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=z.Math.degToRad;E("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(L){this.geometry=new z.RingGeometry(L.radiusInner,L.radiusOuter,L.segmentsTheta,L.segmentsPhi,P(L.thetaStart),P(L.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],177:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=z.Math.degToRad;E("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(L){this.geometry=new z.SphereGeometry(L.radius,L.segmentsWidth,L.segmentsHeight,P(L.phiStart),P(L.phiLength),P(L.thetaStart),P(L.thetaLength))}})},{"../core/geometry":137,"../lib/three":184}],178:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(P){this.geometry=new z.TetrahedronGeometry(P.radius,P.detail)}})},{"../core/geometry":137,"../lib/three":184}],179:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=z.Math.degToRad;E("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(L){this.geometry=new z.TorusGeometry(L.radius,L.radiusTubular*2,L.segmentsRadial,L.segmentsTubular,P(L.arc))}})},{"../core/geometry":137,"../lib/three":184}],180:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three");E("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(P){this.geometry=new z.TorusKnotGeometry(P.radius,P.radiusTubular*2,P.segmentsTubular,P.segmentsRadial,P.p,P.q)}})},{"../core/geometry":137,"../lib/three":184}],181:[function(V,re,ae){var E=V("../core/geometry").registerGeometry,z=V("../lib/three"),P=new z.Quaternion,L=new z.Vector3(0,0,1),k=new z.Vector2,C=new z.Vector2,M=new z.Vector2;E("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(I){var b,T,A,_,D,B,$,j,q;A=new z.Triangle,A.a.set(I.vertexA.x,I.vertexA.y,I.vertexA.z),A.b.set(I.vertexB.x,I.vertexB.y,I.vertexB.z),A.c.set(I.vertexC.x,I.vertexC.y,I.vertexC.z),T=A.getNormal(new z.Vector3),P.setFromUnitVectors(T,L),_=A.a.clone().applyQuaternion(P),D=A.b.clone().applyQuaternion(P),B=A.c.clone().applyQuaternion(P),k.set(Math.min(_.x,D.x,B.x),Math.min(_.y,D.y,B.y)),C.set(Math.max(_.x,D.x,B.x),Math.max(_.y,D.y,B.y)),M.set(0,0).subVectors(C,k),_=new z.Vector2().subVectors(_,k).divide(M),D=new z.Vector2().subVectors(D,k).divide(M),B=new z.Vector2().subVectors(B,k).divide(M),b=this.geometry=new z.BufferGeometry,$=[A.a.x,A.a.y,A.a.z,A.b.x,A.b.y,A.b.z,A.c.x,A.c.y,A.c.z],j=[T.x,T.y,T.z,T.x,T.y,T.z,T.x,T.y,T.z],q=[_.x,_.y,D.x,D.y,B.x,B.y],b.setAttribute("position",new z.Float32BufferAttribute($,3)),b.setAttribute("normal",new z.Float32BufferAttribute(j,3)),b.setAttribute("uv",new z.Float32BufferAttribute(q,2))}})},{"../core/geometry":137,"../lib/three":184}],182:[function(V,re,ae){if(window.Promise=window.Promise||V("promise-polyfill"),window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=navigator.xr!==void 0,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var E=V("./utils/isIOSOlderThan10"),z=E(window.navigator.userAgent)?1/window.devicePixelRatio:1,P=V("webvr-polyfill"),L={BUFFER_SCALE:z,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new P(L)}var k=V("./utils/"),C=k.debug;k.isIE11&&(V("custom-event-polyfill"),V("../vendor/starts-with-polyfill"));var M=C("A-Frame:error"),I=C("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&I("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&window.location.protocol==="file:"&&M("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/0.5.0/introduction/getting-started.html#using-a-local-server."),V("present"),k.device.isBrowserEnvironment&&(V("./style/aframe.css"),V("./style/rStats.css"));var b=V("./core/scene/a-scene").AScene,T=V("./core/component").components,A=V("./core/component").registerComponent,_=V("./core/geometry").registerGeometry,D=V("./extras/primitives/primitives").registerPrimitive,B=V("./core/shader").registerShader,$=V("./core/system").registerSystem,j=V("./core/shader").shaders,q=V("./core/system").systems,Q=window.THREE=V("./lib/three"),ue=V("../package");V("./components/index"),V("./geometries/index"),V("./shaders/index"),V("./systems/index");var xe=V("./core/a-node"),Se=V("./core/a-entity");V("./core/a-assets"),V("./core/a-cubemap"),V("./core/a-mixin"),V("./extras/components/"),V("./extras/primitives/"),console.log("A-Frame Version: 1.3.0 (Date 2022-02-04, Commit #cc3516ce)"),console.log("THREE Version (https://github.com/supermedium/three.js):",ue.dependencies["super-three"]),console.log("WebVR Polyfill Version:",ue.dependencies["webvr-polyfill"]),re.exports=window.AFRAME={AComponent:V("./core/component").Component,AEntity:Se,ANode:xe,ANIME:V("super-animejs"),AScene:b,components:T,coreComponents:Object.keys(T),geometries:V("./core/geometry").geometries,registerComponent:A,registerElement:V("./core/a-register-element").registerElement,registerGeometry:_,registerPrimitive:D,registerShader:B,registerSystem:$,primitives:{getMeshMixin:V("./extras/primitives/getMeshMixin"),primitives:V("./extras/primitives/primitives").primitives},scenes:V("./core/scene/scenes"),schema:V("./core/schema"),shaders:j,systems:q,THREE:Q,utils:k,version:ue.version}},{"../package":74,"../vendor/starts-with-polyfill":225,"./components/index":87,"./core/a-assets":130,"./core/a-cubemap":131,"./core/a-entity":132,"./core/a-mixin":133,"./core/a-node":134,"./core/a-register-element":135,"./core/component":136,"./core/geometry":137,"./core/scene/a-scene":139,"./core/scene/scenes":143,"./core/schema":145,"./core/shader":146,"./core/system":147,"./extras/components/":148,"./extras/primitives/":151,"./extras/primitives/getMeshMixin":150,"./extras/primitives/primitives":152,"./geometries/index":173,"./lib/three":184,"./shaders/index":186,"./style/aframe.css":193,"./style/rStats.css":194,"./systems/index":198,"./utils/":212,"./utils/isIOSOlderThan10":215,"custom-event-polyfill":7,present:48,"promise-polyfill":50,"super-animejs":56,"webvr-polyfill":69}],183:[function(V,re,ae){window.aframeStats=function(E){var z=null,P=E,L={te:{caption:"Entities"},lt:{caption:"Load Time"}},k=[{caption:"A-Frame",values:["te","lt"]}];function C(){z("te").set(M()),window.performance.getEntriesByName&&z("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))}function M(){var A=P.querySelectorAll("*");return Array.prototype.slice.call(A).filter(function(_){return _.isEntity}),A.length}function I(){}function b(){}function T(A){z=A}return{update:C,start:I,end:b,attach:T,values:L,groups:k,fractions:[]}},typeof re=="object"&&(re.exports={aframeStats:window.aframeStats})},{}],184:[function(V,re,ae){(function(E){var z=E.THREE=V("super-three");z.TextureLoader&&(z.TextureLoader.prototype.crossOrigin="anonymous"),z.ImageLoader&&(z.ImageLoader.prototype.crossOrigin="anonymous"),z.Cache&&(z.Cache.enabled=!0),V("../../vendor/DeviceOrientationControls"),V("super-three/examples/js/loaders/DRACOLoader"),V("super-three/examples/js/loaders/GLTFLoader"),V("super-three/examples/js/loaders/OBJLoader"),V("super-three/examples/js/loaders/MTLLoader"),V("super-three/examples/js/utils/BufferGeometryUtils"),V("super-three/examples/js/lights/LightProbeGenerator"),z.DRACOLoader.prototype.crossOrigin="anonymous",z.GLTFLoader.prototype.crossOrigin="anonymous",z.MTLLoader.prototype.crossOrigin="anonymous",z.OBJLoader.prototype.crossOrigin="anonymous",re.exports=z}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../../vendor/DeviceOrientationControls":222,"super-three":57,"super-three/examples/js/lights/LightProbeGenerator":58,"super-three/examples/js/loaders/DRACOLoader":59,"super-three/examples/js/loaders/GLTFLoader":60,"super-three/examples/js/loaders/MTLLoader":61,"super-three/examples/js/loaders/OBJLoader":62,"super-three/examples/js/utils/BufferGeometryUtils":63}],185:[function(V,re,ae){var E=V("../core/shader").registerShader,z=V("../lib/three"),P=V("../utils/");re.exports.Shader=E("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(k){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new z.Color},this.textureSrc=null,L(k,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new z.MeshBasicMaterial(this.materialData),P.material.updateMap(this,k)},update:function(k){this.updateMaterial(k),P.material.updateMap(this,k)},updateMaterial:function(k){var C;L(k,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color);for(C in this.materialData)this.material[C]=this.materialData[C]}});function L(k,C){return C.color.set(k.color),C.fog=k.fog,C.wireframe=k.wireframe,C.wireframeLinewidth=k.wireframeLinewidth,C}},{"../core/shader":146,"../lib/three":184,"../utils/":212}],186:[function(V,re,ae){V("./flat"),V("./standard"),V("./phong"),V("./sdf"),V("./msdf"),V("./ios10hls"),V("./shadow")},{"./flat":185,"./ios10hls":187,"./msdf":188,"./phong":189,"./sdf":190,"./shadow":191,"./standard":192}],187:[function(V,re,ae){var E=V("../core/shader").registerShader;re.exports.Shader=E("ios10hls",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","void main() {","  vec2 offset = vec2(0, 0);","  vec2 repeat = vec2(1, 1);","  vec4 color = texture2D(src, vec2(vUV.x / repeat.x + offset.x, (1.0 - vUV.y) / repeat.y + offset.y)).bgra;","  gl_FragColor = vec4(color.rgb, opacity);","}"].join(`
`)})},{"../core/shader":146}],188:[function(V,re,ae){var E=V("../core/shader").registerShader,z=!!document.createElement("canvas").getContext("webgl2"),P=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),L=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),k=z?L:P,C=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture2D(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","}"].join(`
`),M=["#version 300 es","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  fragColor = vec4(color.xyz, alpha * opacity);","}"].join(`
`),I=z?M:C;re.exports.Shader=E("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:k,fragmentShader:I})},{"../core/shader":146}],189:[function(V,re,ae){var E=V("../core/shader").registerShader,z=V("../lib/three"),P=V("../utils/"),L=new z.CubeTextureLoader,k={};re.exports.Shader=E("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(M){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new z.Color,specular:new z.Color,emissive:new z.Color},this.textureSrc=null,C(M,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new z.MeshPhongMaterial(this.materialData),P.material.updateMap(this,M)},update:function(M){this.updateMaterial(M),P.material.updateMap(this,M),M.normalMap&&P.material.updateDistortionMap("normal",this,M),M.displacementMap&&P.material.updateDistortionMap("displacement",this,M),M.ambientOcclusionMap&&P.material.updateDistortionMap("ambientOcclusion",this,M),M.bump&&P.material.updateDistortionMap("bump",this,M),this.updateEnvMap(M)},updateMaterial:function(M){var I;C(M,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color);for(I in this.materialData)this.material[I]=this.materialData[I]},updateEnvMap:function(M){var I=this,b=this.material,T=M.envMap,A=M.sphericalEnvMap,_=M.refract,D=this.el.sceneEl;if(!T&&!A||this.isLoadingEnvMap){Object.defineProperty(b,"envMap",{get:function(){return D.object3D.environment},set:function(B){delete this.envMap,this.envMap=B}}),b.needsUpdate=!0;return}if(this.isLoadingEnvMap=!0,delete b.envMap,A){this.el.sceneEl.systems.material.loadTexture(A,{src:A},function($){I.isLoadingEnvMap=!1,$.mapping=_?z.EquirectangularRefractionMapping:z.EquirectangularReflectionMapping,b.envMap=$,P.material.handleTextureEvents(I.el,$),b.needsUpdate=!0});return}if(k[T]){k[T].then(function(B){I.isLoadingEnvMap=!1,b.envMap=B,P.material.handleTextureEvents(I.el,B),b.needsUpdate=!0});return}k[T]=new Promise(function(B){P.srcLoader.validateCubemapSrc(T,function(j){L.load(j,function(q){I.isLoadingEnvMap=!1,b.envMap=q,q.mapping=_?z.CubeRefractionMapping:z.CubeReflectionMapping,P.material.handleTextureEvents(I.el,q),B(q)})})})}});function C(M,I){switch(I.color.set(M.color),I.specular.set(M.emissive),I.emissive.set(M.emissive),I.emissiveIntensity=M.emissiveIntensity,I.fog=M.fog,I.transparent=M.transparent,I.wireframe=M.wireframe,I.wireframeLinewidth=M.wireframeLinewidth,I.shininess=M.shininess,I.flatShading=M.flatShading,I.wireframe=M.wireframe,I.wireframeLinewidth=M.wireframeLinewidth,I.reflectivity=M.reflectivity,I.refractionRatio=M.refractionRatio,M.combine){case"mix":I.combine=z.MixOperation;break;case"multiply":I.combine=z.MultiplyOperation;break;case"add":I.combine=z.AddOperation;break}return M.normalMap&&(I.normalScale=M.normalScale),M.ambientOcclusionMap&&(I.aoMapIntensity=M.ambientOcclusionMapIntensity),M.bumpMap&&(I.aoMapIntensity=M.bumpMapScale),M.displacementMap&&(I.displacementScale=M.displacementScale,I.displacementBias=M.displacementBias),I}},{"../core/shader":146,"../lib/three":184,"../utils/":212}],190:[function(V,re,ae){var E=V("../core/shader").registerShader,z=!!document.createElement("canvas").getContext("webgl2"),P=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),L=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),k=z?L:P,C=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture2D(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture2D(map, box.xy).a, width)","        + contour(texture2D(map, box.zw).a, width)","        + contour(texture2D(map, box.xw).a, width)","        + contour(texture2D(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture2D(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  gl_FragColor = vec4(color, opacity * alpha);","}"].join(`
`),M=["#version 300 es","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture(map, box.xy).a, width)","        + contour(texture(map, box.zw).a, width)","        + contour(texture(map, box.xw).a, width)","        + contour(texture(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  fragColor = vec4(color, opacity * alpha);","}"].join(`
`),I=z?M:C;re.exports.Shader=E("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:k,fragmentShader:I})},{"../core/shader":146}],191:[function(V,re,ae){var E=V("../core/shader").registerShader,z=V("../lib/three");re.exports.Shader=E("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(P){this.rendererSystem=this.el.sceneEl.systems.renderer,this.material=new z.ShadowMaterial},update:function(P){this.material.opacity=P.opacity,this.material.alphaToCoverage=P.alphaToCoverage,this.material.transparent=P.transparent}})},{"../core/shader":146,"../lib/three":184}],192:[function(V,re,ae){var E=V("../core/shader").registerShader,z=V("../lib/three"),P=V("../utils/"),L=new z.CubeTextureLoader,k={};re.exports.Shader=E("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(M){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new z.Color,emissive:new z.Color},C(M,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.material=new z.MeshStandardMaterial(this.materialData),P.material.updateMap(this,M),M.normalMap&&P.material.updateDistortionMap("normal",this,M),M.displacementMap&&P.material.updateDistortionMap("displacement",this,M),M.ambientOcclusionMap&&P.material.updateDistortionMap("ambientOcclusion",this,M),M.metalnessMap&&P.material.updateDistortionMap("metalness",this,M),M.roughnessMap&&P.material.updateDistortionMap("roughness",this,M),this.updateEnvMap(M)},update:function(M){this.updateMaterial(M),P.material.updateMap(this,M),M.normalMap&&P.material.updateDistortionMap("normal",this,M),M.displacementMap&&P.material.updateDistortionMap("displacement",this,M),M.ambientOcclusionMap&&P.material.updateDistortionMap("ambientOcclusion",this,M),M.metalnessMap&&P.material.updateDistortionMap("metalness",this,M),M.roughnessMap&&P.material.updateDistortionMap("roughness",this,M),this.updateEnvMap(M)},updateMaterial:function(M){var I,b=this.material;C(M,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive);for(I in this.materialData)b[I]=this.materialData[I]},updateEnvMap:function(M){var I=this,b=this.material,T=M.envMap,A=M.sphericalEnvMap;if(!T&&!A||this.isLoadingEnvMap){b.envMap=null,b.needsUpdate=!0;return}if(this.isLoadingEnvMap=!0,A){this.el.sceneEl.systems.material.loadTexture(A,{src:A},function(D){I.isLoadingEnvMap=!1,D.mapping=z.EquirectangularReflectionMapping,b.envMap=D,P.material.handleTextureEvents(I.el,D),b.needsUpdate=!0});return}if(k[T]){k[T].then(function(_){I.isLoadingEnvMap=!1,b.envMap=_,P.material.handleTextureEvents(I.el,_),b.needsUpdate=!0});return}k[T]=new Promise(function(_){P.srcLoader.validateCubemapSrc(T,function(B){L.load(B,function($){I.isLoadingEnvMap=!1,b.envMap=$,P.material.handleTextureEvents(I.el,$),_($)})})})}});function C(M,I){return I.color.set(M.color),I.emissive.set(M.emissive),I.emissiveIntensity=M.emissiveIntensity,I.fog=M.fog,I.metalness=M.metalness,I.roughness=M.roughness,I.wireframe=M.wireframe,I.wireframeLinewidth=M.wireframeLinewidth,M.normalMap&&(I.normalScale=M.normalScale),M.ambientOcclusionMap&&(I.aoMapIntensity=M.ambientOcclusionMapIntensity),M.displacementMap&&(I.displacementScale=M.displacementScale,I.displacementBias=M.displacementBias),I}},{"../core/shader":146,"../lib/three":184,"../utils/":212}],193:[function(V,re,ae){var E=`html.a-fullscreen{bottom:0;left:0;position:fixed;right:0;top:0}html.a-fullscreen body{height:100%;margin:0;overflow:hidden;padding:0;width:100%}html.a-fullscreen .a-canvas{width:100%!important;height:100%!important;top:0!important;left:0!important;right:0!important;bottom:0!important;position:fixed!important}html:not(.a-fullscreen) .a-enter-ar,html:not(.a-fullscreen) .a-enter-vr{right:5px;bottom:5px}:-webkit-full-screen{background-color:transparent}.a-hidden{display:none!important}.a-canvas{height:100%;left:0;position:absolute;top:0;width:100%}.a-canvas.a-grab-cursor:hover{cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}canvas.a-canvas.a-mouse-cursor-hover:hover{cursor:pointer}.a-inspector-loader{background-color:#ed3160;position:fixed;left:3px;top:3px;padding:6px 10px;color:#fff;text-decoration:none;font-size:12px;font-family:Roboto,sans-serif;text-align:center;z-index:99999;width:204px}@keyframes dots-1{from{opacity:0}25%{opacity:1}}@keyframes dots-2{from{opacity:0}50%{opacity:1}}@keyframes dots-3{from{opacity:0}75%{opacity:1}}@-webkit-keyframes dots-1{from{opacity:0}25%{opacity:1}}@-webkit-keyframes dots-2{from{opacity:0}50%{opacity:1}}@-webkit-keyframes dots-3{from{opacity:0}75%{opacity:1}}.a-inspector-loader .dots span{animation:dots-1 2s infinite steps(1);-webkit-animation:dots-1 2s infinite steps(1)}.a-inspector-loader .dots span:first-child+span{animation-name:dots-2;-webkit-animation-name:dots-2}.a-inspector-loader .dots span:first-child+span+span{animation-name:dots-3;-webkit-animation-name:dots-3}a-scene{display:block;position:relative;height:100%;width:100%}a-assets,a-scene audio,a-scene img,a-scene video{display:none}.a-enter-vr-modal,.a-orientation-modal{font-family:Consolas,Andale Mono,Courier New,monospace}.a-enter-vr-modal a{border-bottom:1px solid #fff;padding:2px 0;text-decoration:none;transition:.1s color ease-in}.a-enter-vr-modal a:hover{background-color:#fff;color:#111;padding:2px 4px;position:relative;left:-4px}.a-enter-ar,.a-enter-vr{font-family:sans-serif,monospace;font-size:13px;width:100%;font-weight:200;line-height:16px;position:absolute;right:20px;bottom:20px}.a-enter-ar{right:80px}.a-enter-vr-button,.a-enter-vr-modal,.a-enter-vr-modal a{color:#fff;user-select:none;outline:0}.a-enter-vr-button{background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat rgba(0,0,0,.35)}.a-enter-ar-button{background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat rgba(0,0,0,.2)}.a-enter-ar-button,.a-enter-vr-button{background-size:90% 90%;border:0;bottom:0;cursor:pointer;min-width:58px;min-height:34px;padding-right:0;padding-top:0;position:absolute;right:0;transition:background-color .05s ease;-webkit-transition:background-color .05s ease;z-index:9999;border-radius:8px;touch-action:manipulation}.a-enter-ar-button{background-size:100% 90%;margin-right:10px;border-radius:7px}.a-enter-ar-button:active,.a-enter-ar-button:hover,.a-enter-vr-button:active,.a-enter-vr-button:hover{background-color:#ef2d5e}.a-enter-vr-button.resethover{background-color:rgba(0,0,0,.35)}[data-a-enter-vr-no-webvr] .a-enter-vr-button{border-color:#666;opacity:.65}[data-a-enter-vr-no-webvr] .a-enter-vr-button:active,[data-a-enter-vr-no-webvr] .a-enter-vr-button:hover{background-color:rgba(0,0,0,.35);cursor:not-allowed}.a-enter-vr-modal{background-color:#666;border-radius:0;display:none;min-height:32px;margin-right:70px;padding:9px;width:280px;right:2%;position:absolute}.a-enter-vr-modal:after{border-bottom:10px solid transparent;border-left:10px solid #666;border-top:10px solid transparent;display:inline-block;content:'';position:absolute;right:-5px;top:5px;width:0;height:0}.a-enter-vr-modal a,.a-enter-vr-modal p{display:inline}.a-enter-vr-modal p{margin:0}.a-enter-vr-modal p:after{content:' '}[data-a-enter-vr-no-headset].a-enter-vr:hover .a-enter-vr-modal,[data-a-enter-vr-no-webvr].a-enter-vr:hover .a-enter-vr-modal{display:block}.a-orientation-modal{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center/50% 50% no-repeat rgba(244,244,244,1);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-orientation-modal:after{color:#666;content:"Insert phone into Cardboard holder.";display:block;position:absolute;text-align:center;top:70%;transform:translateY(-70%);width:100%}.a-orientation-modal button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;border:none;height:50px;text-indent:-9999px;width:50px}.a-loader-title{background-color:rgba(0,0,0,.6);font-family:sans-serif,monospace;text-align:center;font-size:20px;height:50px;font-weight:300;line-height:50px;position:absolute;right:0;left:0;top:0;color:#fff}.a-modal{background:0 0/50% 50% rgba(0,0,0,.6);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-dialog{position:relative;left:50%;top:50%;transform:translate(-50%,-50%);z-index:199995;width:300px;height:200px;background-size:contain;background-color:#fff;font-family:sans-serif,monospace;font-size:20px;border-radius:3px;padding:6px}.a-dialog-text-container{width:100%;height:70%;align-self:flex-start;display:flex;justify-content:center;align-content:center;flex-direction:column}.a-dialog-text{display:inline-block;font-weight:400;font-size:14pt;margin:8px}.a-dialog-buttons-container{display:inline-flex;align-self:flex-end;width:100%;height:30%}.a-dialog-button{cursor:pointer;align-self:center;opacity:.9;height:80%;width:50%;font-size:12pt;margin:4px;border-radius:2px;text-align:center;border:none;display:inline-block;-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.2);user-select:none}.a-dialog-permission-button:hover{box-shadow:0 7px 14px rgba(0,0,0,.2),0 2px 2px rgba(0,0,0,.2)}.a-dialog-allow-button{background-color:#00ceff}.a-dialog-deny-button{background-color:#ff005b}.a-dialog-ok-button{background-color:#00ceff;width:100%}.a-dom-overlay:not(.a-no-style){overflow:hidden;position:absolute;pointer-events:none;box-sizing:border-box;bottom:0;left:0;right:0;top:0;padding:1em}.a-dom-overlay:not(.a-no-style)>*{pointer-events:auto}`;V("browserify-css").createStyle(E,{href:"src/style/aframe.css"}),re.exports=E},{"browserify-css":4}],194:[function(V,re,ae){var E=".rs-base{background-color:#333;color:#fafafa;border-radius:0;font:10px monospace;left:5px;line-height:1em;opacity:.85;overflow:hidden;padding:10px;position:fixed;top:5px;width:300px;z-index:10000}.rs-base div.hidden{display:none}.rs-base h1{color:#fff;cursor:pointer;font-size:1.4em;font-weight:300;margin:0 0 5px;padding:0}.rs-group{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;margin-bottom:5px}.rs-group:last-child{margin-bottom:0}.rs-counter-base{align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:10px;-webkit-justify-content:space-between;justify-content:space-between;margin:2px 0}.rs-counter-base.alarm{color:#b70000;text-shadow:0 0 0 #b70000,0 0 1px #fff,0 0 1px #fff,0 0 2px #fff,0 0 2px #fff,0 0 3px #fff,0 0 3px #fff,0 0 4px #fff,0 0 4px #fff}.rs-counter-id{font-weight:300;-webkit-box-ordinal-group:0;-webkit-order:0;order:0;width:54px}.rs-counter-value{font-weight:300;-webkit-box-ordinal-group:1;-webkit-order:1;order:1;text-align:right;width:35px}.rs-canvas{-webkit-box-ordinal-group:2;-webkit-order:2;order:2}@media (min-width:480px){.rs-base{left:20px;top:20px}}";V("browserify-css").createStyle(E,{href:"src/style/rStats.css"}),re.exports=E},{"browserify-css":4}],195:[function(V,re,ae){var E=V("../constants/"),z=V("../core/system").registerSystem,P="data-aframe-default-camera";re.exports.System=z("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var k,C,M=this.sceneEl,I=this;if(M.camera&&!M.camera.el.getAttribute("camera").spectator){M.emit("cameraready",{cameraEl:M.camera.el});return}if(k=M.querySelectorAll("a-camera, [camera]"),!k.length){this.createDefaultCamera();return}for(this.numUserCameras=k.length,C=0;C<k.length;C++)k[C].addEventListener("object3dset",function(b){b.detail.type==="camera"&&I.checkUserCamera(this)}),k[C].isNode?k[C].load():k[C].addEventListener("nodeready",function(){this.load()})},checkUserCamera:function(k){var C,M=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(C=k.getAttribute("camera"),!C.active||C.spectator){this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera();return}this.initialCameraFound=!0,M.camera=k.getObject3D("camera"),M.emit("cameraready",{cameraEl:k})}},createDefaultCamera:function(){var k,C=this.sceneEl;k=document.createElement("a-entity"),k.setAttribute("camera",{active:!0}),k.setAttribute("position",{x:0,y:E.DEFAULT_CAMERA_HEIGHT,z:0}),k.setAttribute("wasd-controls",""),k.setAttribute("look-controls",""),k.setAttribute(E.AFRAME_INJECTED,""),k.addEventListener("object3dset",function(M){M.detail.type==="camera"&&(C.camera=M.detail.object,C.emit("cameraready",{cameraEl:k}))}),C.appendChild(k)},disableActiveCamera:function(){var k,C;k=this.sceneEl.querySelectorAll("[camera]"),C=k[k.length-1],C.setAttribute("camera","active",!0)},setActiveCamera:function(k){var C,M,I,b,T=this.activeCameraEl,A=this.sceneEl;if(b=k.getObject3D("camera"),!(!b||k===this.activeCameraEl)){var _=A.querySelector("["+P+"]"),D=_&&_.querySelector("[camera]");for(k!==D&&L(A),this.activeCameraEl=k,this.activeCameraEl.play(),A.camera=b,T&&T.setAttribute("camera","active",!1),M=A.querySelectorAll("[camera]"),I=0;I<M.length;I++)C=M[I],!(!C.isEntity||k===C)&&(C.setAttribute("camera","active",!1),C.pause());A.emit("camera-set-active",{cameraEl:k})}},setSpectatorCamera:function(k){var C,M=this.spectatorCameraEl,I=this.sceneEl,b;C=k.getObject3D("camera"),!(!C||k===this.spectatorCameraEl)&&(M&&M.setAttribute("camera","spectator",!1),b=this.spectatorCameraEl=k,I.addEventListener("enter-vr",this.wrapRender),I.addEventListener("exit-vr",this.unwrapRender),b.setAttribute("camera","active",!1),b.play(),I.emit("camera-set-spectator",{cameraEl:k}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){!this.originalRender||(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(k,C){var M,I=this.sceneEl,b;M=I.renderer.xr.enabled,this.originalRender.call(I.renderer,k,C),!(!this.spectatorCameraEl||I.isMobile||!M)&&(b=this.spectatorCameraEl.components.camera.camera,I.renderer.xr.enabled=!1,this.originalRender.call(I.renderer,k,b),I.renderer.xr.enabled=M)}});function L(k){var C,M=k.camera;!M||(C=k.querySelector("["+P+"]"),C&&k.removeChild(C))}},{"../constants/":128,"../core/system":147}],196:[function(V,re,ae){var E=V("../core/geometry").geometries,z=V("../core/system").registerSystem;re.exports.System=z("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(C){var M=this.cache,I,b;return C.skipCache?P(C):(b=this.hash(C),I=M[b],k(this.cacheCount,b),I||(I=P(C),M[b]=I,I))},unuseGeometry:function(C){var M=this.cache,I=this.cacheCount,b,T;C.skipCache||(T=this.hash(C),M[T]&&(L(I,T),!(I[T]>0)&&(b=M[T],b.dispose(),delete M[T],delete I[T])))},hash:function(C){return JSON.stringify(C)}});function P(C){var M=C.primitive,I=E[M]&&E[M].Geometry,b=new I;if(!I)throw new Error("Unknown geometry `"+M+"`");return b.init(C),b.geometry}function L(C,M){C[M]--}function k(C,M){C[M]=C[M]===void 0?1:C[M]+1}},{"../core/geometry":137,"../core/system":147}],197:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../lib/three");function P(L){return new Promise(function(k,C){var M=document.createElement("script");document.body.appendChild(M),M.onload=k,M.onerror=C,M.async=!0,M.src=L})}re.exports.System=E("gltf-model",{schema:{dracoDecoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var L=this.data.dracoDecoderPath,k=this.data.meshoptDecoderPath;!this.dracoLoader&&L&&(this.dracoLoader=new z.DRACOLoader,this.dracoLoader.setDecoderPath(L)),!this.meshoptDecoder&&k&&(this.meshoptDecoder=P(k).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},{"../core/system":147,"../lib/three":184}],198:[function(V,re,ae){V("./camera"),V("./geometry"),V("./gltf-model"),V("./light"),V("./material"),V("./renderer"),V("./shadow"),V("./tracked-controls-webvr"),V("./tracked-controls-webxr"),V("./webxr")},{"./camera":195,"./geometry":196,"./gltf-model":197,"./light":199,"./material":200,"./renderer":201,"./shadow":202,"./tracked-controls-webvr":203,"./tracked-controls-webxr":204,"./webxr":205}],199:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../utils/bind"),P=V("../constants/"),L="data-aframe-default-light";re.exports.System=E("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",z(this.setupDefaultLights,this))},registerLight:function(k){k.hasAttribute(L)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var k,C=this.sceneEl;if(!!this.defaultLights){k=document.querySelectorAll("["+L+"]");for(var M=0;M<k.length;M++)C.removeChild(k[M]);this.defaultLights=!1}},setupDefaultLights:function(){var k=this.sceneEl,C,M;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||(C=document.createElement("a-entity"),C.setAttribute("light",{color:"#BBB",type:"ambient"}),C.setAttribute(L,""),C.setAttribute(P.AFRAME_INJECTED,""),k.appendChild(C),M=document.createElement("a-entity"),M.setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),M.setAttribute("position",{x:-.5,y:1,z:1}),M.setAttribute(L,""),M.setAttribute(P.AFRAME_INJECTED,""),k.appendChild(M),this.defaultLights=!0)}})},{"../constants/":128,"../core/system":147,"../utils/bind":206}],200:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../lib/three"),P=V("../utils/"),L=V("../utils/material").isHLS,k=V("../utils/material").setTextureProperties,C=P.bind,M=P.debug,I=M("components:texture:error"),b=new z.TextureLoader,T=M("components:texture:warn");b.setCrossOrigin("anonymous"),re.exports.System=E("material",{init:function(){this.materials={},this.textureCounts={},this.textureCache={},this.sceneEl.addEventListener("materialtextureloaded",C(this.onMaterialTextureLoaded,this))},clearTextureCache:function(){this.textureCache={}},loadTexture:function($,j,q){var Q=this;if($.tagName==="CANVAS"){this.loadCanvas($,j,q);return}if($.tagName==="VIDEO"){!$.src&&!$.srcObject&&!$.childElementCount&&T("Video element was defined with neither `source` elements nor `src` / `srcObject` attributes."),this.loadVideo($,j,q);return}P.srcLoader.validateSrc($,ue,xe);function ue(Se){Q.loadImage(Se,j,q)}function xe(Se){Q.loadVideo(Se,j,q)}},loadImage:function($,j,q){var Q=this.hash(j),ue=this.textureCache;if(ue[Q]){ue[Q].then(q);return}ue[Q]=_($,j),ue[Q].then(q)},loadCanvas:function($,j,q){var Q;Q=new z.CanvasTexture($),k(Q,j),q(Q)},loadVideo:function($,j,q){var Q,ue,xe=this.textureCache,Se,be;function pe(we){we.texture.needsUpdate=!0,q(we.texture,we.videoEl)}if(typeof $!="string"){if(Se=$,Q=this.hashVideo(j,Se),xe[Q]){xe[Q].then(pe);return}B(Se)}if(Se=Se||D($,j.width,j.height),Q=this.hashVideo(j,Se),xe[Q]){xe[Q].then(pe);return}ue=new z.VideoTexture(Se),ue.minFilter=z.LinearFilter,k(ue,j),this.sceneEl.isIOS&&L(Se.src||Se.getAttribute("src"),Se.type||Se.getAttribute("type"))&&(ue.format=z.RGBAFormat,ue.needsCorrectionBGRA=!0,ue.flipY=!1,ue.needsCorrectionFlipY=!0),be={texture:ue,videoEl:Se},xe[Q]=Promise.resolve(be),pe(be)},hash:function($){return $.src.tagName&&($=P.extendDeep({},$),$.src=$.src.src),JSON.stringify($)},hashVideo:function($,j){return A($,j)},registerMaterial:function($){this.materials[$.uuid]=$},unregisterMaterial:function($){delete this.materials[$.uuid];var j=this.textureCounts;Object.keys($).filter(function(q){return $[q]&&$[q].isTexture}).forEach(function(q){j[$[q].uuid]--,j[$[q].uuid]<=0&&$[q].dispose()})},updateMaterials:function($){var j=this.materials;Object.keys(j).forEach(function(q){j[q].needsUpdate=!0})},onMaterialTextureLoaded:function($){this.textureCounts[$.detail.texture.uuid]||(this.textureCounts[$.detail.texture.uuid]=0),this.textureCounts[$.detail.texture.uuid]++}});function A($,j){var q,Q=j.getAttribute("id"),ue,xe;if(Q)return Q;for(ue="",xe=$||{},q=0;q<j.attributes.length;q++)xe[j.attributes[q].name]=j.attributes[q].value;return Object.keys(xe).sort().forEach(function(Se){ue+=Se+":"+xe[Se]+";"}),ue}function _($,j){return new Promise(q);function q(Q,ue){var xe=typeof $!="string";function Se(be){k(be,j),be.needsUpdate=!0,Q(be)}if(xe){Se(new z.Texture($));return}b.load($,Se,function(){},function(be){I("`$s` could not be fetched (Error code: %s; Response: %s)",be.status,be.statusText)})}}function D($,j,q){var Q=document.createElement("video");return Q.width=j,Q.height=q,Q.setAttribute("playsinline",""),Q.setAttribute("webkit-playsinline",""),Q.autoplay=!0,Q.loop=!0,Q.crossOrigin="anonymous",Q.addEventListener("error",function(){T("`$s` is not a valid video",$)},!0),Q.src=$,Q}function B($){return $.autoplay=$.hasAttribute("autoplay")&&$.getAttribute("autoplay")!=="false",$.controls=$.hasAttribute("controls")&&$.getAttribute("controls")!=="false",$.getAttribute("loop")==="false"&&$.removeAttribute("loop"),$.getAttribute("preload")==="false"&&($.preload="none"),$.crossOrigin=$.crossOrigin||"anonymous",$.setAttribute("playsinline",""),$.setAttribute("webkit-playsinline",""),$}},{"../core/system":147,"../lib/three":184,"../utils/":212,"../utils/material":216}],201:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../utils/"),P=V("../lib/three"),L=z.debug,k=L("components:renderer:warn");re.exports.System=E("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:z.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:1920},maxCanvasHeight:{default:1920},physicallyCorrectLights:{default:!1},precision:{default:"high",oneOf:["high","medium","low"]},sortObjects:{default:!1},colorManagement:{default:!1},gammaOutput:{default:!1},alpha:{default:!0},foveationLevel:{default:0}},init:function(){var C=this.data,M=this.el,I=M.renderer;I.sortObjects=C.sortObjects,I.physicallyCorrectLights=C.physicallyCorrectLights,(C.colorManagement||C.gammaOutput)&&(I.outputEncoding=P.sRGBEncoding,C.gammaOutput&&k('Property `gammaOutput` is deprecated. Use `renderer="colorManagement: true;"` instead.')),M.hasAttribute("antialias")&&k('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),M.hasAttribute("logarithmicDepthBuffer")&&k('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.')},applyColorCorrection:function(C){!this.data.colorManagement||!C||(C.isColor?C.convertSRGBToLinear():C.isTexture&&(C.encoding=P.sRGBEncoding))}})},{"../core/system":147,"../lib/three":184,"../utils/":212}],202:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../lib/three"),P={basic:z.BasicShadowMap,pcf:z.PCFShadowMap,pcfsoft:z.PCFSoftShadowMap};re.exports.System=E("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var L=this.sceneEl,k=this.data;this.shadowMapEnabled=!1,L.renderer&&(L.renderer.shadowMap.type=P[k.type],L.renderer.shadowMap.autoUpdate=k.autoUpdate,this.setShadowMapEnabled(this.shadowMapEnabled))},update:function(L){L.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.data.enabled)},setShadowMapEnabled:function(L){var k=this.sceneEl.renderer;this.shadowMapEnabled=this.data.enabled&&L,k&&(k.shadowMap.enabled=this.shadowMapEnabled)}})},{"../core/system":147,"../lib/three":184}],203:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../utils"),P=z.device.isWebXRAvailable;re.exports.System=E("tracked-controls-webvr",{init:function(){var L=this;this.controllers=[],this.isChrome=navigator.userAgent.indexOf("Chrome")!==-1,this.updateControllerList(),this.throttledUpdateControllerList=z.throttle(this.updateControllerList,500,this),!P&&(!navigator.getVRDisplays||this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(k){k.length&&(L.vrDisplay=k[0])})}))},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var L=this.controllers,k,C,M,I;if(C=navigator.getGamepads&&navigator.getGamepads(),!!C){for(I=L.length,L.length=0,M=0;M<C.length;++M)k=C[M],k&&k.pose&&L.push(k);L.length!==I&&this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":147,"../utils":212}],204:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../utils");re.exports.System=E("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=z.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var P=this,L=this.el.xrSession;if(!L){this.referenceSpace=void 0,this.controllers=[],this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1));return}var k=P.el.sceneEl.systems.webxr.sessionReferenceSpaceType;L.requestReferenceSpace(k).then(function(C){P.referenceSpace=C}).catch(function(C){throw P.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(k,'tracked-controls-webxr uses reference space "'+k+'".'),C})},updateControllerList:function(){var P=this.el.xrSession,L=this.oldControllers,k;if(!P){if(this.oldControllersLength===0)return;this.oldControllersLength=0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1);return}if(!!P.inputSources){if(this.controllers=P.inputSources,this.oldControllersLength===this.controllers.length){var C=!0;for(k=0;k<this.controllers.length;++k)if(!(this.controllers[k]===L[k]&&this.controllers[k].gamepad===L[k].gamepad)){C=!1;break}if(C)return}for(L.length=0,k=0;k<this.controllers.length;k++)L.push(this.controllers[k]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":147,"../utils":212}],205:[function(V,re,ae){var E=V("../core/system").registerSystem,z=V("../utils/"),P=z.debug("systems:webxr:warn");re.exports.System=E("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var L=this.data;this.sessionConfiguration={requiredFeatures:L.requiredFeatures,optionalFeatures:L.optionalFeatures},this.sessionReferenceSpaceType=L.referenceSpaceType,L.overlayElement&&(L.overlayElement.classList.remove("a-dom-overlay"),L.optionalFeatures.includes("dom-overlay")||(L.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",L)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:L.overlayElement},L.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(L){return!!(L==="viewer"||L==="local"||this.sessionConfiguration.requiredFeatures.includes(L)||this.sessionConfiguration.optionalFeatures.includes(L))},warnIfFeatureNotRequested:function(L,k){if(!this.wasFeatureRequested(L)){var C='Please add the feature "'+L+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`;P((k?k+" ":"")+C)}}})},{"../core/system":147,"../utils/":212}],206:[function(V,re,ae){re.exports=function(z,P){return function(L){return function(){var C=L.concat(Array.prototype.slice.call(arguments,0));return z.apply(P,C)}}(Array.prototype.slice.call(arguments,2))}},{}],207:[function(V,re,ae){var E=V("./debug"),z=V("object-assign"),P=E("utils:coordinates:warn"),L=["x","y","z","w"],k=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;re.exports.regex=k;var C="object",M=/\s+/g;function I(_,D){var B,$,j,q,Q,ue,xe,Se,be;if(_&&_ instanceof Object)return ue=_.x===void 0?D&&D.x:_.x,xe=_.y===void 0?D&&D.y:_.y,Se=_.z===void 0?D&&D.z:_.z,be=_.w===void 0?D&&D.w:_.w,ue!=null&&(_.x=A(ue)),xe!=null&&(_.y=A(xe)),Se!=null&&(_.z=A(Se)),be!=null&&(_.w=A(be)),_;if(_==null)return typeof D===C?z({},D):D;for(B=_.trim().split(M),Q={},q=0;q<L.length;q++)if(j=L[q],B[q])Q[j]=parseFloat(B[q],10);else{if($=D&&D[j],$===void 0)continue;Q[j]=A($)}return Q}re.exports.parse=I;function b(_){var D;return typeof _!==C?_:(D=_.x+" "+_.y,_.z!=null&&(D+=" "+_.z),_.w!=null&&(D+=" "+_.w),D)}re.exports.stringify=b;function T(_){return k.test(_)}re.exports.isCoordinates=T,re.exports.isCoordinate=function(_){return P("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),T(_)};function A(_){return _!=null&&_.constructor===String?parseFloat(_,10):_}re.exports.toVector3=function(_){return new THREE.Vector3(_.x,_.y,_.z)}},{"./debug":208,"object-assign":39}],208:[function(V,re,ae){(function(E){var z=V("debug"),P=V("object-assign"),L={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},k=function(T){var A=z(T);return A.color=M(T),A};P(k,z);function C(T){var A=T.split(":");return A[A.length-1]}function M(T){var A=C(T),_=L.colors&&L.colors[A];return _||null}function I(){try{return window.localStorage}catch{}}var b=I();b&&(parseInt(b.logs,10)||b.logs==="true")?k.enable("*"):k.enable("*:error,*:info,*:warn"),E.browser&&(window.logs=k),re.exports=k}).call(this,V("_process"))},{_process:49,debug:8,"object-assign":39}],209:[function(V,re,ae){(function(E){var z=V("debug")("device:error"),P,L=!1,k=!1,C=re.exports.isWebXRAvailable=!window.debug&&navigator.xr!==void 0;if(window.addEventListener("vrdisplayactivate",function(xe){var Se;C||(Se=document.createElement("canvas"),P=xe.display,Se.getContext("webgl",{}),P.requestPresent([{source:Se}]).then(function(){},function(){}))}),C){var M=function(){var xe=document.querySelector("a-scene");if(!xe){window.addEventListener("DOMContentLoaded",M);return}xe.hasLoaded?xe.components["vr-mode-ui"].updateEnterInterfaces():xe.addEventListener("loaded",M)},I=function(xe){z("WebXR session support error: "+xe.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(xe){L=xe,M()}).catch(I),navigator.xr.isSessionSupported("immersive-ar").then(function(xe){k=xe,M()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){L=!0,M()}).catch(I),navigator.xr.supportsSession("immersive-ar").then(function(){k=!0,M()}).catch(function(){})):z("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(xe){var Se=document.querySelector("a-scene");P=xe.length&&xe[0],Se&&Se.emit("displayconnected",{vrDisplay:P})});function b(){return P}re.exports.getVRDisplay=b;function T(){return L||k||!!b()}re.exports.checkHeadsetConnected=T;function A(){return k}re.exports.checkARSupport=A;var _=function(){var xe=!1;return function(Se){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(Se)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Se.substr(0,4)))&&(xe=!0),(B()||D()||ue())&&(xe=!0),Q()&&(xe=!1)}(window.navigator.userAgent||window.navigator.vendor||window.opera),function(){return xe}}();re.exports.isMobile=_;function D(xe){var Se=xe||window.navigator.userAgent;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(Se)}re.exports.isTablet=D;function B(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}re.exports.isIOS=B;function $(){return!_()&&!Q()&&window.orientation!==void 0}re.exports.isMobileDeviceRequestingDesktopSite=$;function j(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}re.exports.isOculusBrowser=j;function q(){return/(Mobile VR)/i.test(window.navigator.userAgent)}re.exports.isFirefoxReality=q;function Q(){return j()||q()}re.exports.isMobileVR=Q;function ue(){return/R7 Build/.test(window.navigator.userAgent)}re.exports.isR7=ue,re.exports.isLandscape=function(){var xe=window.orientation;return ue()&&(xe+=90),xe===90||xe===-90},re.exports.isBrowserEnvironment=!!(!E||E.browser),re.exports.isNodeEnvironment=!re.exports.isBrowserEnvironment}).call(this,V("_process"))},{_process:49,debug:8}],210:[function(V,re,ae){var E={};function z(P,L){return L=L||".",E[L]||(E[L]={}),P.indexOf(L)!==-1?E[L][P]=P.split(L):E[L][P]=P,E[L][P]}re.exports.getComponentPropertyPath=z,re.exports.propertyPathCache=E,re.exports.getComponentProperty=function(P,L,k){var C;return k=k||".",L.indexOf(k)!==-1?(C=z(L,k),C.constructor===String?P.getAttribute(C):P.getAttribute(C[0])[C[1]]):P.getAttribute(L)},re.exports.setComponentProperty=function(P,L,k,C){var M;if(C=C||".",L.indexOf(C)!==-1){M=z(L,C),M.constructor===String?P.setAttribute(M,k):P.setAttribute(M[0],M[1],k);return}P.setAttribute(L,k)}},{}],211:[function(V,re,ae){re.exports=function(z){var P=z.style.width,L=z.style.height;z.style.width=parseInt(P,10)+1+"px",z.style.height=parseInt(L,10)+1+"px",setTimeout(function(){z.style.width=P,z.style.height=L},200)}},{}],212:[function(V,re,ae){var E=V("./debug"),z=V("deep-assign"),P=V("./device"),L=V("object-assign"),k=V("./object-pool"),C=E("utils:warn");re.exports.bind=V("./bind"),re.exports.coordinates=V("./coordinates"),re.exports.debug=E,re.exports.device=P,re.exports.entity=V("./entity"),re.exports.forceCanvasResizeSafariMobile=V("./forceCanvasResizeSafariMobile"),re.exports.isIE11=V("./is-ie11"),re.exports.material=V("./material"),re.exports.objectPool=k,re.exports.split=V("./split").split,re.exports.styleParser=V("./styleParser"),re.exports.trackedControls=V("./tracked-controls"),re.exports.checkHeadsetConnected=function(){return C("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),P.checkHeadsetConnected(arguments)},re.exports.isGearVR=re.exports.device.isGearVR=function(){C("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},re.exports.isIOS=function(){return C("`utils.isIOS` has moved to `utils.device.isIOS`"),P.isIOS(arguments)},re.exports.isOculusGo=re.exports.device.isOculusGo=function(){C("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},re.exports.isMobile=function(){return C("`utils.isMobile has moved to `utils.device.isMobile`"),P.isMobile(arguments)},re.exports.throttle=function(I,b,T){var A;return T&&(I=re.exports.bind(I,T)),function(){var _=Date.now(),D=typeof A>"u"?b:_-A;(typeof A>"u"||D>=b)&&(A=_,I.apply(null,arguments))}},re.exports.throttleComponentChanged=function(I,b,T){var A,_;return T&&(I=re.exports.bind(I,T)),function(){var D=Date.now(),B=typeof A>"u"?b:D-A,$=arguments;typeof A>"u"||B>=b?(clearTimeout(_),A=D,I.apply(null,$)):(clearTimeout(_),_=setTimeout(function(){A=Date.now(),I.apply(this,$)},b-B))}},re.exports.throttleTick=function(I,b,T){var A;return T&&(I=re.exports.bind(I,T)),function(_,D){var B=typeof A>"u"?D:_-A;(typeof A>"u"||B>=b)&&(A=_,I(_,B))}},re.exports.debounce=function(I,b,T){var A;return function(){var _=this,D=arguments,B=function(){A=null,T||I.apply(_,D)},$=T&&!A;clearTimeout(A),A=setTimeout(B,b),$&&I.apply(_,D)}},re.exports.extend=L,re.exports.extendDeep=z,re.exports.clone=function(I){return JSON.parse(JSON.stringify(I))};var M=function(){var I=k.createPool(function(){return[]});return function(b,T){var A,_,D,B,$,j;if(b===void 0||T===void 0||b===null||T===null||!(b&&T&&b.constructor===Object&&T.constructor===Object||b.constructor===Array&&T.constructor===Array))return b===T;_=I.use(),D=I.use(),_.length=0,D.length=0;for(A in b)_.push(A);for(A in T)D.push(A);if(_.length!==D.length)return I.recycle(_),I.recycle(D),!1;for(B=0;B<_.length;++B)if($=b[_[B]],j=T[_[B]],typeof $=="object"||typeof j=="object"||Array.isArray($)&&Array.isArray(j)){if($===j)continue;if(!M($,j))return I.recycle(_),I.recycle(D),!1}else if($!==j)return I.recycle(_),I.recycle(D),!1;return I.recycle(_),I.recycle(D),!0}}();re.exports.deepEqual=M,re.exports.diff=function(){var I=[];return function(b,T,A){var _,D,B,$,j,q,Q;$=A||{},I.length=0;for(j in b)I.push(j);if(!T)return $;for(B in T)I.indexOf(B)===-1&&I.push(B);for(q=0;q<I.length;q++)j=I[q],_=b[j],D=T[j],Q=_&&D&&_.constructor===Object&&D.constructor===Object,(Q&&!M(_,D)||!Q&&_!==D)&&($[j]=D);return $}}(),re.exports.shouldCaptureKeyEvent=function(I){return I.metaKey?!1:document.activeElement===document.body},re.exports.splitString=function(I,b){typeof b>"u"&&(b=" ");var T=new RegExp(b,"g");return I=(I||"").replace(T,b),I.split(b)},re.exports.getElData=function(I,b){b=b||{};var T={};Object.keys(b).forEach(A);function A(_){I.hasAttribute(_)&&(T[_]=I.getAttribute(_))}return T},re.exports.getUrlParameter=function(I){I=I.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+I+"=([^&#]*)"),T=b.exec(location.search);return T===null?"":decodeURIComponent(T[1].replace(/\+/g," "))},re.exports.isIframed=function(){return window.top!==window.self},re.exports.findAllScenes=function(I){for(var b=[],T=I.getElementsByTagName("*"),A=0,_=T.length;A<_;A++)T[A].isScene&&b.push(T[A]);return b},re.exports.srcLoader=V("./src-loader")},{"./bind":206,"./coordinates":207,"./debug":208,"./device":209,"./entity":210,"./forceCanvasResizeSafariMobile":211,"./is-ie11":214,"./material":216,"./object-pool":217,"./split":218,"./src-loader":219,"./styleParser":220,"./tracked-controls":221,"deep-assign":10,"object-assign":39}],213:[function(V,re,ae){window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},{}],214:[function(V,re,ae){function E(){var z=-1,P=navigator.userAgent,L;return navigator.appName==="Microsoft Internet Explorer"?(L=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),L.exec(P)!=null&&(z=parseFloat(RegExp.$1))):navigator.appName==="Netscape"&&(L=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})"),L.exec(P)!=null&&(z=parseFloat(RegExp.$1))),z}re.exports=E()===11},{}],215:[function(V,re,ae){re.exports=function(z){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(z)}},{}],216:[function(V,re,ae){var E=V("../lib/three"),z=["application/x-mpegurl","application/vnd.apple.mpegurl"],P=new Set(["emissiveMap","envMap","map","specularMap"]);function L(C,M){var I=M.offset||{x:0,y:0},b=M.repeat||{x:1,y:1},T=M.npot||!1;T&&(C.wrapS=E.ClampToEdgeWrapping,C.wrapT=E.ClampToEdgeWrapping,C.magFilter=E.LinearFilter,C.minFilter=E.LinearFilter),(b.x!==1||b.y!==1)&&(C.wrapS=E.RepeatWrapping,C.wrapT=E.RepeatWrapping,C.repeat.set(b.x,b.y)),(I.x!==0||I.y!==0)&&C.offset.set(I.x,I.y)}re.exports.setTextureProperties=L,re.exports.updateMapMaterialFromData=function(C,M,I,b){var T=I.el,A=I.material,_=T.sceneEl.systems.renderer,D=b[M];if(I.materialSrcs||(I.materialSrcs={}),!D){delete I.materialSrcs[C],$(null);return}if(D===I.materialSrcs[C]&&A[C]){L(A[C],b);return}I.materialSrcs[C]=D,D instanceof E.Texture?$(D):T.sceneEl.systems.material.loadTexture(D,{src:D,repeat:b.repeat,offset:b.offset,npot:b.npot},B);function B(j){I.materialSrcs[C]===D&&$(j)}function $(j){A[C]=j,j&&P.has(C)&&_.applyColorCorrection(j),A.needsUpdate=!0,k(T,j)}},re.exports.updateMap=function(C,M){return re.exports.updateMapMaterialFromData("map","src",C,M)},re.exports.updateDistortionMap=function(C,M,I){var b=C;C==="ambientOcclusion"&&(b="ao");var T=M.el,A=M.material,_=T.sceneEl.systems.renderer,D=I[C+"Map"],B={};if(B.src=D,B.offset=I[C+"TextureOffset"],B.repeat=I[C+"TextureRepeat"],B.wrap=I[C+"TextureWrap"],D){if(D===M[C+"TextureSrc"])return;M[C+"TextureSrc"]=D,T.sceneEl.systems.material.loadTexture(D,B,$);return}if(!A.map)return;$(null);function $(j){var q=b+"Map";A[q]=j,j&&P.has(q)&&_.applyColorCorrection(j),j&&L(j,I),A.needsUpdate=!0,k(T,j)}};function k(C,M){!M||(C.emit("materialtextureloaded",{src:M.image,texture:M}),!(!M.image||M.image.tagName!=="VIDEO")&&(M.image.addEventListener("loadeddata",function(){!C.components||!C.components.material||(M.needsCorrectionBGRA&&M.needsCorrectionFlipY&&["standard","flat"].indexOf(C.components.material.data.shader)!==-1&&C.setAttribute("material","shader","ios10hls"),C.emit("materialvideoloadeddata",{src:M.image,texture:M}))}),M.image.addEventListener("ended",function(){C.emit("materialvideoended",{src:M.image,texture:M})})))}re.exports.handleTextureEvents=k,re.exports.isHLS=function(C,M){return!!(M&&z.includes(M.toLowerCase())||C&&C.toLowerCase().indexOf(".m3u8")>0)}},{"../lib/three":184}],217:[function(V,re,ae){var E=Object.freeze(Object.create(null));function z(){return{}}re.exports.createPool=function(C){var M=[],I=null;C=C||z;function b(){var D;return(I===null||I===M.length)&&A(M.length||5),D=M[I],M[I++]=E,P(D),D}function T(D){if(D instanceof Object){if(I===null||I===-1){M[M.length]=D;return}M[--I]=D}}function A(D){var B,$;if(D=D===void 0?M.length:D,D>0&&I==null&&(I=0),D>0)for(B=M.length,M.length+=Number(D),$=B;$<M.length;$++)M[$]=C();return M.length}function _(){return M.length}return{grow:A,pool:M,recycle:T,size:_,use:b}};function P(k){var C;if(!(!k||k.constructor!==Object))for(C in k)k[C]=void 0}re.exports.clearObject=P;function L(k,C){var M;if(!(!k||k.constructor!==Object))for(M in k)M in C||delete k[M]}re.exports.removeUnusedKeys=L},{}],218:[function(V,re,ae){re.exports.split=function(){var E={};return function(z,P){return P in E||(E[P]={}),z in E[P]||(E[P][z]=z.split(P)),E[P][z]}}()},{}],219:[function(V,re,ae){var E=V("./debug"),z=E("utils:src-loader:warn");function P(b,T,A){C(b,function(D){if(D){T(b);return}A(b)})}function L(b,T){var A,_="",D,B,$=[];for(D=0;D<5;D++)_+="(url\\((?:[^\\)]+)\\),\\s*)";_+="(url\\((?:[^\\)]+)\\)\\s*)",B=b.match(new RegExp(_));function j(q){$.push(q),$.length===6&&T($)}if(B){for(D=1;D<7;D++)P(k(B[D]),j);return}if(A=I(b),!!A){if(A.tagName==="A-CUBEMAP"&&A.srcs)return T(A.srcs);z('Selector "%s" does not point to <a-cubemap>',b)}}function k(b){var T=b.match(/\url\((.+)\)/);if(!!T)return T[1]}function C(b,T){var A;if(b.tagName){T(b.tagName==="IMG");return}A=new XMLHttpRequest,A.open("HEAD",b),A.addEventListener("load",function(_){var D;A.status>=200&&A.status<300?(D=A.getResponseHeader("Content-Type"),D==null?M(b,T):D.startsWith("image")?T(!0):T(!1)):M(b,T),A.abort()}),A.send()}function M(b,T){var A=new Image;A.addEventListener("load",_);function _(){T(!0)}A.addEventListener("error",D);function D(){T(!1)}A.src=b}function I(b){try{var T=document.querySelector(b);return T||z('No element was found matching the selector: "%s"',b),T}catch{z('"%s" is not a valid selector',b);return}}re.exports={parseUrl:k,validateSrc:P,validateCubemapSrc:L}},{"./debug":208}],220:[function(V,re,ae){var E=/-([a-z])/g;re.exports.parse=function(I,b){var T;return typeof I!="string"||(T=k(I,b),T[""])?I:P(T)},re.exports.stringify=function(I){return typeof I=="string"?I:C(I)};function z(I){return I.replace(E,M)}re.exports.toCamelCase=z;function P(I){var b,T;for(T in I)b=z(T),T!==b&&(I[b]=I[T],delete I[T]);return I}re.exports.transformKeysToCamelCase=P;var L=function(){var I=[],b=/url\([^)]+$/;return function(A){var _="",D,B=0,$=";";for(I.length=0;B<A.length;){if(D=A.indexOf($,B),D===-1&&(D=A.length),_+=A.substring(B,D),b.test(_)){_+=";",B=D+1;continue}I.push(_.trim()),_="",B=D+1}return I}}();function k(I,b){var T,A,_,D,B,$;for(b=b||{},T=L(I),A=0;A<T.length;A++)_=T[A],_&&(D=_.indexOf(":"),B=_.substr(0,D).trim(),$=_.substr(D+1).trim(),b[B]=$);return b}function C(I){var b,T=0,A=0,_="";for(b in I)T++;for(b in I)_+=b+": "+I[b],A<T-1&&(_+="; "),A++;return _}function M(I){return I[1].toUpperCase()}},{}],221:[function(V,re,ae){var E=V("../constants").DEFAULT_HANDEDNESS,z=["x","y","z","w"],P=2;re.exports.checkControllerPresentAndSetup=function(I,b,T){var A=I.el,_,D=A.sceneEl.hasWebXR,B=D?k:L,$;if(_=B(I,b,T),$=!!_,I.controllerPresent&&!I.controllerEventsActive&&!D&&I.addEventListeners(),$===I.controllerPresent)return $;I.controllerPresent=$,$?(I.addEventListeners(),I.injectTrackedControls(_),A.emit("controllerconnected",{name:I.name,component:I})):(I.removeEventListeners(),A.emit("controllerdisconnected",{name:I.name,component:I}))};function L(I,b,T){var A,_=I.el.sceneEl,D,B=T.index||0;return!b||(D=_&&_.systems["tracked-controls-webvr"],!D)||(A=D.controllers,!A.length)?!1:!!C(A,null,b,T.hand,B)}function k(I,b,T){var A,_=I.el.sceneEl,D=_&&_.systems["tracked-controls-webxr"];return!D||(A=D.controllers,!A||!A.length)?!1:M(A,b,T.hand,T.index,T.iterateControllerProfiles,T.handTracking)}re.exports.isControllerPresentWebVR=L,re.exports.isControllerPresentWebXR=k;function C(I,b,T,A,_){var D,B,$=0,j=_>=0?_:0;for(B=0;B<I.length;B++)if(D=I[B],!(T&&!D.id.startsWith(T))&&!(!T&&D.id!==b)&&!(A&&D.hand&&A!==D.hand)){if(A&&!D.hand)j=P*_+(A===E?0:1);else return D;if($===j)return D;++$}}function M(I,b,T,A,_,D){var B,$,j,q=!1,Q,ue;for(B=0;B<I.length;B++){if(j=I[B],ue=j.profiles,D)q=j.hand;else if(_)for($=0;$<ue.length&&(q=ue[$].startsWith(b),!q);$++);else q=ue.length>0&&ue[0].startsWith(b);if(!!q){if(Q=j.handedness==="right"||j.handedness==="left",Q){if(j.handedness===T)return I[B]}else if(B===A)return I[B]}}}re.exports.findMatchingControllerWebVR=C,re.exports.findMatchingControllerWebXR=M,re.exports.emitIfAxesChanged=function(I,b,T){var A,_,D,B,$;for(_ in b){for(A=b[_],D=!1,$=0;$<A.length;$++)T.detail.changed[A[$]]&&(D=!0);if(!!D){for(B={},$=0;$<A.length;$++)B[z[$]]=T.detail.axis[A[$]];I.el.emit(_+"moved",B)}}},re.exports.onButtonEvent=function(I,b,T,A){var _=A?T.mapping[A]:T.mapping,D=_.buttons[I];T.el.emit(D+b),T.updateModel&&T.updateModel(D,b)}},{"../constants":128}],222:[function(V,re,ae){THREE.DeviceOrientationControls=function(E){var z=this;this.object=E,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var P=function(C){z.deviceOrientation=C},L=function(){z.screenOrientation=window.orientation||0},k=function(){var C=new THREE.Vector3(0,0,1),M=new THREE.Euler,I=new THREE.Quaternion,b=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(T,A,_,D,B){M.set(_,A,-D,"YXZ"),T.setFromEuler(M),T.multiply(b),T.multiply(I.setFromAxisAngle(C,-B))}}();this.connect=function(){L(),window.addEventListener("orientationchange",L,!1),window.addEventListener("deviceorientation",P,!1),z.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",L,!1),window.removeEventListener("deviceorientation",P,!1),z.enabled=!1},this.update=function(){if(z.enabled!==!1){var C=z.deviceOrientation;if(C){var M=C.alpha?THREE.Math.degToRad(C.alpha)+z.alphaOffset:0,I=C.beta?THREE.Math.degToRad(C.beta):0,b=C.gamma?THREE.Math.degToRad(C.gamma):0,T=z.screenOrientation?THREE.Math.degToRad(z.screenOrientation):0;k(z.object.quaternion,M,I,b,T)}}},this.dispose=function(){z.disconnect()},this.connect()}},{}],223:[function(V,re,ae){window.glStats=function(){var E=null,z=0,P=0,L=0,k=0,C=0,M=0,I=0;function b(q,Q){return function(){Q.apply(this,arguments),q.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=b(WebGLRenderingContext.prototype.drawArrays,function(){z++,arguments[0]==this.POINTS?M+=arguments[2]:C+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=b(WebGLRenderingContext.prototype.drawElements,function(){P++,k+=arguments[1]/3,C+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=b(WebGLRenderingContext.prototype.useProgram,function(){L++}),WebGLRenderingContext.prototype.bindTexture=b(WebGLRenderingContext.prototype.bindTexture,function(){I++});var T={allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},A=[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],_=[{base:"allcalls",steps:["drawelements","drawarrays"]}];function D(){E("allcalls").set(z+P),E("drawElements").set(P),E("drawArrays").set(z),E("bindTexture").set(I),E("useProgram").set(L),E("glfaces").set(k),E("glvertices").set(C),E("glpoints").set(M)}function B(){z=0,P=0,L=0,k=0,C=0,M=0,I=0}function $(){}function j(q){E=q}return{update:D,start:B,end:$,attach:j,values:T,groups:A,fractions:_}},window.threeStats=function(E){var z=null,P={"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},L=[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],k=[];function C(){z("renderer.info.memory.geometries").set(E.info.memory.geometries),z("renderer.info.programs").set(E.info.programs.length),z("renderer.info.memory.textures").set(E.info.memory.textures),z("renderer.info.render.calls").set(E.info.render.calls),z("renderer.info.render.triangles").set(E.info.render.triangles),z("renderer.info.render.points").set(E.info.render.points)}function M(){}function I(){}function b(T){z=T}return{update:C,start:M,end:I,attach:b,values:P,groups:L,fractions:k}},window.BrowserStats=function(){var E=null,z=0,P=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var L={memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},k=[{caption:"Browser",values:["memory","total"]}],C=[{base:"total",steps:["memory"]}],M=Math.log(1024);function I(D){var B=100,$=Math.floor(Math.log(D)/M);return Math.round(D*B/Math.pow(1024,$))/B}function b(){z=I(performance.memory.usedJSHeapSize),P=I(performance.memory.totalJSHeapSize),E("memory").set(z),E("total").set(P)}function T(){z=0}function A(){}function _(D){E=D}return{update:b,start:T,end:A,attach:_,values:L,groups:k,fractions:C}},typeof re=="object"&&(re.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats})},{}],224:[function(V,re,ae){"use strict";(function(){"performance"in window||(window.performance={});var E=window.performance;if(!("now"in E)){var z=Date.now();E.timing&&E.timing.navigationStart&&(z=E.timing.navigationStart),E.now=function(){return Date.now()-z}}E.mark||(E.mark=function(){}),E.measure||(E.measure=function(){})})(),window.rStats=function(z){function P(be,pe){for(var we=Object.keys(be),he=0,Ie=we.length;he<Ie;he++)pe(we[he])}function L(be){var pe=document.createElement("link");pe.href=be,pe.rel="stylesheet",pe.type="text/css",document.getElementsByTagName("head")[0].appendChild(pe)}var k=z||{},C=k.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],M="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",I=(k.CSSPath?k.CSSPath:"")+"rStats.css",b=k.css||[M,I];b.forEach(function(be){L(be)}),k.values||(k.values={});var T,A,_=10,D=200,B={};function $(be,pe,we){var he=we||{},Ie=document.createElement("canvas"),Ae=Ie.getContext("2d"),Ue=0,Qe=0,ht=he.color?he.color:"#666666",lt=document.createElement("canvas"),Et=lt.getContext("2d");lt.width=1,lt.height=2*_,Et.fillStyle="#444444",Et.fillRect(0,0,1,2*_),Et.fillStyle=ht,Et.fillRect(0,_,1,_),Et.fillStyle="#ffffff",Et.globalAlpha=.5,Et.fillRect(0,_,1,1),Et.globalAlpha=1;var Mt=document.createElement("canvas"),ln=Mt.getContext("2d");Mt.width=1,Mt.height=2*_,ln.fillStyle="#444444",ln.fillRect(0,0,1,2*_),ln.fillStyle="#b70000",ln.fillRect(0,_,1,_),ln.globalAlpha=.5,ln.fillStyle="#ffffff",ln.fillRect(0,_,1,1),ln.globalAlpha=1;function Tn(){Ie.width=D,Ie.height=_,Ie.style.width=Ie.width+"px",Ie.style.height=Ie.height+"px",Ie.className="rs-canvas",be.appendChild(Ie),Ae.fillStyle="#444444",Ae.fillRect(0,0,Ie.width,Ie.height)}function xn(Qn,Cn){Qe+=(Qn-Qe)*.1,Ue*=.99,Qe>Ue&&(Ue=Qe),Ae.drawImage(Ie,1,0,Ie.width-1,Ie.height,0,0,Ie.width-1,Ie.height),Cn?Ae.drawImage(Mt,Ie.width-1,Ie.height-Qe*Ie.height/Ue-_):Ae.drawImage(lt,Ie.width-1,Ie.height-Qe*Ie.height/Ue-_)}return Tn(),{draw:xn}}function j(be,pe){var we=document.createElement("canvas"),he=we.getContext("2d");function Ie(){we.width=D,we.height=_*pe,we.style.width=we.width+"px",we.style.height=we.height+"px",we.className="rs-canvas",be.appendChild(we),he.fillStyle="#444444",he.fillRect(0,0,we.width,we.height)}function Ae(Ue){he.drawImage(we,1,0,we.width-1,we.height,0,0,we.width-1,we.height);var Qe=0;P(Ue,function(ht){var lt=Ue[ht]*we.height;he.fillStyle=C[ht],he.fillRect(we.width-1,Qe,1,lt),Qe+=lt})}return Ie(),{draw:Ae}}function q(be,pe){var we=be,he,Ie=0,Ae=0,Ue=0,Qe=0,ht=performance.now(),lt=0,Et=document.createElement("div"),Mt=document.createElement("span"),ln=document.createElement("div"),Tn=document.createTextNode(""),xn=k?k.values[we.toLowerCase()]:null,Qn=new $(Et,we,xn),Cn=!1;Mt.className="rs-counter-id",Mt.textContent=xn&&xn.caption?xn.caption:we,ln.className="rs-counter-value",ln.appendChild(Tn),Et.appendChild(Mt),Et.appendChild(ln),pe?pe.div.appendChild(Et):A.appendChild(Et),he=performance.now();function Mn(Kr){if(xn&&xn.average){Qe+=Kr,lt++;var Ci=performance.now();Ci-ht>=(xn.avgMs||1e3)&&(Ue=Qe/lt,Qe=0,ht=Ci,lt=0)}}function Ar(){he=performance.now(),k.userTimingAPI&&performance.mark(we+"-start"),Cn=!0}function _i(){Ie=performance.now()-he,k.userTimingAPI&&(performance.mark(we+"-end"),Cn&&performance.measure(we,we+"-start",we+"-end")),Mn(Ie)}function si(){_i(),Ar()}function mi(){var Kr=xn&&xn.average?Ue:Ie;Tn.nodeValue=Math.round(Kr*100)/100;var Ci=xn&&(xn.below&&Ie<xn.below||xn.over&&Ie>xn.over);Qn.draw(Ie,Ci),Et.className=Ci?"rs-counter-base alarm":"rs-counter-base"}function Qi(){var Kr=performance.now(),Ci=Kr-he;Ae++,Ci>1e3&&(xn&&xn.interpolate===!1?Ie=Ae:Ie=Ae*1e3/Ci,Ae=0,he=Kr,Mn(Ie))}function Di(Kr){Ie=Kr,Mn(Ie)}return{set:Di,start:Ar,tick:si,end:_i,frame:Qi,value:function(){return Ie},draw:mi}}function Q(){var be=0;function pe(we){be=we}return{set:pe,value:function(){return be}}}function ue(be){var pe=be.toLowerCase();if(pe===void 0&&(pe="default"),B[pe])return B[pe];var we=null;k&&k.groups&&P(k.groups,function(Ie){var Ae=k.groups[parseInt(Ie,10)];!we&&Ae.values.indexOf(pe.toLowerCase())!==-1&&(we=Ae)});var he=new q(pe,we);return B[pe]=he,he}function xe(){if(k.plugins){k.values||(k.values={}),k.groups||(k.groups=[]),k.fractions||(k.fractions=[]);for(var be=0;be<k.plugins.length;be++)k.plugins[be].attach(ue),P(k.plugins[be].values,function(pe){k.values[pe]=k.plugins[be].values[pe]}),k.groups=k.groups.concat(k.plugins[be].groups),k.fractions=k.fractions.concat(k.plugins[be].fractions)}else k.plugins={};T=document.createElement("div"),T.className="rs-base",A=document.createElement("div"),A.className="rs-container",A.style.height="auto",T.appendChild(A),document.body.appendChild(T),k&&(k.groups&&P(k.groups,function(pe){var we=k.groups[parseInt(pe,10)],he=document.createElement("div");he.className="rs-group",we.div=he;var Ie=document.createElement("h1");Ie.textContent=we.caption,Ie.addEventListener("click",function(Ae){this.classList.toggle("hidden"),Ae.preventDefault()}.bind(he)),A.appendChild(Ie),A.appendChild(he)}),k.fractions&&P(k.fractions,function(pe){var we=k.fractions[parseInt(pe,10)],he=document.createElement("div");he.className="rs-fraction";var Ie=document.createElement("div");Ie.className="rs-legend";var Ae=0;P(k.fractions[pe].steps,function(Qe){var ht=document.createElement("p");ht.textContent=k.fractions[pe].steps[Qe],ht.style.color=C[Ae],Ie.appendChild(ht),Ae++}),he.appendChild(Ie),he.style.height=Ae*_+"px",we.div=he;var Ue=new j(he,Ae);we.graph=Ue,A.appendChild(he)}))}function Se(){P(k.plugins,function(be){k.plugins[be].update()}),P(B,function(be){B[be].draw()}),k&&k.fractions&&P(k.fractions,function(be){var pe=k.fractions[parseInt(be,10)],we=[],he=B[pe.base.toLowerCase()];he&&(he=he.value(),P(k.fractions[be].steps,function(Ie){var Ae=k.fractions[be].steps[parseInt(Ie,10)].toLowerCase(),Ue=B[Ae];Ue&&we.push(Ue.value()/he)})),pe.graph.draw(we)})}return xe(),function(be){return be?ue(be):{element:T,update:Se}}},typeof re=="object"&&(re.exports=window.rStats)},{}],225:[function(V,re,ae){String.prototype.startsWith||(String.prototype.startsWith=function(E,z){return z=z||0,this.substr(z,E.length)===E})},{}],226:[function(V,re,ae){var E={};E.base64=function(z,P){return"data:"+z+";base64,"+P},E.isMobile=function(){var z=!1;return function(P){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(P)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(P.substr(0,4)))&&(z=!0)}(navigator.userAgent||navigator.vendor||window.opera),z},E.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},E.isIFrame=function(){try{return window.self!==window.top}catch{return!0}},E.appendQueryParameter=function(z,P,L){var k=z.indexOf("?")<0?"?":"&";return z+=k+P+"="+L,z},E.getQueryParameter=function(z){z=z.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var P=new RegExp("[\\?&]"+z+"=([^&#]*)"),L=P.exec(location.search);return L===null?"":decodeURIComponent(L[1].replace(/\+/g," "))},E.isLandscapeMode=function(){return window.orientation==90||window.orientation==-90},re.exports=E},{}],227:[function(V,re,ae){var E=V("./util.js");function z(){var k=document.createElement("video");k.addEventListener("ended",function(){k.play()}),this.request=function(){k.paused&&(k.src=E.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),k.play())},this.release=function(){k.pause(),k.src=""}}function P(){var k=null;this.request=function(){k||(k=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){k&&(clearInterval(k),k=null)}}function L(){var k=navigator.userAgent||navigator.vendor||window.opera;return k.match(/iPhone/i)||k.match(/iPod/i)?P:z}re.exports=L()},{"./util.js":226}]},{},[182])(182)})});var tM=fE(()=>{(()=>{let{Controller:ji,UI:cs}=window.MINDAR.IMAGE;AFRAME.registerSystem("mindar-image-system",{container:null,video:null,processingImage:!1,init:function(){this.anchorEntities=[]},tick:function(){},setup:function({imageTargetSrc:pr,maxTrack:V,showStats:re,uiLoading:ae,uiScanning:E,uiError:z,missTolerance:P,warmupTolerance:L,filterMinCF:k,filterBeta:C}){this.imageTargetSrc=pr,this.maxTrack=V,this.filterMinCF=k,this.filterBeta=C,this.missTolerance=P,this.warmupTolerance=L,this.showStats=re,this.ui=new cs({uiLoading:ae,uiScanning:E,uiError:z})},registerAnchor:function(pr,V){this.anchorEntities.push({el:pr,targetIndex:V})},start:function(){this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new Stats,this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position:absolute;top:0px;left:0px;z-index:999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo()},switchTarget:function(pr){this.controller.interestedTargetIndex=pr},stop:function(){this.pause(),this.video.srcObject.getTracks().forEach(function(pr){pr.stop()}),this.video.remove()},pause:function(pr=!1){pr||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return this.el.emit("arError",{error:"VIDEO_FAIL"}),void this.ui.showCompatibility();navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(pr=>{this.video.addEventListener("loadedmetadata",()=>{this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight),this._startAR()}),this.video.srcObject=pr}).catch(pr=>{console.log("getUserMedia error",pr),this.el.emit("arError",{error:"VIDEO_FAIL"})})},_startAR:async function(){let pr=this.video;this.container,this.controller=new ji({inputWidth:pr.videoWidth,inputHeight:pr.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:re=>{if(re.type==="processDone")this.mainStats&&this.mainStats.update();else if(re.type==="updateMatrix"){let{targetIndex:ae,worldMatrix:E}=re;for(let z=0;z<this.anchorEntities.length;z++)this.anchorEntities[z].targetIndex===ae&&(this.anchorEntities[z].el.updateWorldMatrix(E),E&&this.ui.hideScanning())}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));let{dimensions:V}=await this.controller.addImageTargets(this.imageTargetSrc);for(let re=0;re<this.anchorEntities.length;re++){let{el:ae,targetIndex:E}=this.anchorEntities[re];E<V.length&&ae.setupMarker(V[E])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){let pr=this.video,V=this.container,re,ae,E=pr.videoWidth/pr.videoHeight;E>V.clientWidth/V.clientHeight?(ae=V.clientHeight,re=ae*E):(re=V.clientWidth,ae=re/E);let z=this.controller.getProjectionMatrix(),P=2*Math.atan(1/z[5]/ae*V.clientHeight)*180/Math.PI,L=z[14]/(z[10]-1),k=z[14]/(z[10]+1),C=(z[5],z[0],V.clientWidth/V.clientHeight),M=V.getElementsByTagName("a-camera")[0].getObject3D("camera");M.fov=P,M.aspect=C,M.near=L,M.far=k,M.updateProjectionMatrix(),this.video.style.top=-(ae-V.clientHeight)/2+"px",this.video.style.left=-(re-V.clientWidth)/2+"px",this.video.style.width=re+"px",this.video.style.height=ae+"px"}}),AFRAME.registerComponent("mindar-image",{dependencies:["mindar-image-system"],schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"}},init:function(){let pr=this.el.sceneEl.systems["mindar-image-system"];pr.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:this.data.filterMinCF===-1?null:this.data.filterMinCF,filterBeta:this.data.filterBeta===-1?null:this.data.filterBeta,missTolerance:this.data.missTolerance===-1?null:this.data.missTolerance,warmupTolerance:this.data.warmupTolerance===-1?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",()=>{pr.start()})}}),AFRAME.registerComponent("mindar-image-target",{dependencies:["mindar-image-system"],schema:{targetIndex:{type:"number"}},postMatrix:null,init:function(){this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex);let pr=this.el.object3D;pr.visible=!1,pr.matrixAutoUpdate=!1},setupMarker([pr,V]){let re=new AFRAME.THREE.Vector3,ae=new AFRAME.THREE.Quaternion,E=new AFRAME.THREE.Vector3;re.x=pr/2,re.y=pr/2+(V-pr)/2,E.x=pr,E.y=pr,E.z=pr,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(re,ae,E)},updateWorldMatrix(pr){if(this.el.object3D.visible||pr===null?this.el.object3D.visible&&pr===null&&this.el.emit("targetLost"):this.el.emit("targetFound"),this.el.object3D.visible=pr!==null,pr!==null){var V=new AFRAME.THREE.Matrix4;V.elements=pr,V.multiply(this.postMatrix),this.el.object3D.matrix=V}}})})()});var L4=mE(ZT()),D4=mE(eM()),F4=mE(tM());window.handler=ji=>{};})();
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
/*! (C) WebReflection Mit Style License */
/*! For license information please see mindar-image.prod.js.LICENSE.txt */
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
/**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
/**
 * @license
 * webvr-polyfill
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
