const sleep=t=>new Promise(e=>setTimeout(e,t)),q=t=>document.querySelector(t),target=q("#target"),dencon=q("#dencon"),denconAnime=q("#denconAnime"),denconAnimationRot="property: rotation; to: 0 360 0; dur: 4000; easing: linear; loop: true";denconAnimationLookback="property: rotation; to: 0 0 0; dur: 1000; easing: easeInOutQuad",denconAnimationCenter="property: position; to: 0 0 0; dur: 1000; easing: easeInOutQuad";let fuwafuwaLast=!0,front,animeLast=denconAnimationRot,dancing=0;function stopFuwafuwa(){front=void 0}function resumeFuwafuwa(){front=q(".frontView"),fuwafuwaLast&&startFuwafuwa()}function startFuwafuwa(t){fuwafuwaLast=!0,front&&(front?.setAttribute("position",`0 ${(Math.sin(t/200)+1)/4} 0`),requestAnimationFrame(startFuwafuwa))}function pauseAnime(t=!1){if(!t&&dancing){stopDance();return}stopFuwafuwa(),dencon.removeAttribute("animation")}function resumeAnime(){resumeFuwafuwa(),dencon.setAttribute("animation",animeLast)}function startRotation(){animeLast=denconAnimationRot,dencon.setAttribute("animation",denconAnimationRot)}const lookback=()=>new Promise(t=>{pauseAnime(!0),dencon.setAttribute("animation__rot",denconAnimationLookback),dencon.setAttribute("animation__ctr",denconAnimationCenter),dencon.addEventListener("animationcomplete",e);function e(){dencon.removeEventListener("animationcomplete",e),dencon.removeAttribute("animation__rot"),dencon.removeAttribute("animation__ctr"),t()}});function stopDance(){switch(dancing){case 0:break;case 1:dancing=0;break;case 2:dancing=0,denconAnime.removeEventListener("animation-finished",onDanceEnd),denconAnime.setAttribute("visible","false"),denconAnime.removeAttribute("animation-mixer"),dencon.setAttribute("visible","true");break;case 3:dancing=0;break}}dencon.addEventListener("click",async()=>{if(!dancing){if(dancing=1,await lookback(),await sleep(250),!dancing)return;dancing=2,dencon.setAttribute("visible","false"),dencon.setAttribute("position","0 0 0"),denconAnime.setAttribute("visible","true"),denconAnime.setAttribute("animation-mixer","loop: once"),denconAnime.addEventListener("animation-finished",onDanceEnd)}});async function onDanceEnd(){!dancing||(dancing=3,denconAnime.removeEventListener("animation-finished",onDanceEnd),denconAnime.setAttribute("visible","false"),denconAnime.removeAttribute("animation-mixer"),dencon.setAttribute("visible","true"),await sleep(500),dancing&&(dancing=0,resumeAnime()))}target.addEventListener("targetFound",resumeAnime),target.addEventListener("targetLost",pauseAnime),window.handler=t=>{},resumeFuwafuwa(),startRotation();
